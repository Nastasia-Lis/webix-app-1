(()=>{"use strict";function e(){!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("underscore",t):(e="undefined"!=typeof globalThis?globalThis:e||self,function(){var i=e._,n=e._=t();n.noConflict=function(){return e._=i,n}}())}(this,(function(){var e="1.13.4",t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},i=Array.prototype,n=Object.prototype,o="undefined"!=typeof Symbol?Symbol.prototype:null,r=i.push,s=i.slice,l=n.toString,a=n.hasOwnProperty,c="undefined"!=typeof ArrayBuffer,u="undefined"!=typeof DataView,d=Array.isArray,h=Object.keys,f=Object.create,p=c&&ArrayBuffer.isView,b=isNaN,$=isFinite,m=!{toString:null}.propertyIsEnumerable("toString"),g=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],w=Math.pow(2,53)-1;function v(e,t){return t=null==t?e.length-1:+t,function(){for(var i=Math.max(arguments.length-t,0),n=Array(i),o=0;o<i;o++)n[o]=arguments[o+t];switch(t){case 0:return e.call(this,n);case 1:return e.call(this,arguments[0],n);case 2:return e.call(this,arguments[0],arguments[1],n)}var r=Array(t+1);for(o=0;o<t;o++)r[o]=arguments[o];return r[t]=n,e.apply(this,r)}}function y(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function x(e){return void 0===e}function _(e){return!0===e||!1===e||"[object Boolean]"===l.call(e)}function E(e){var t="[object "+e+"]";return function(e){return l.call(e)===t}}var k=E("String"),A=E("Number"),I=E("Date"),V=E("RegExp"),S=E("Error"),T=E("Symbol"),j=E("ArrayBuffer"),F=E("Function"),B=t.document&&t.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof B&&(F=function(e){return"function"==typeof e||!1});var L=F,R=E("Object"),O=u&&R(new DataView(new ArrayBuffer(8))),N="undefined"!=typeof Map&&R(new Map),C=E("DataView"),P=O?function(e){return null!=e&&L(e.getInt8)&&j(e.buffer)}:C,U=d||E("Array");function H(e,t){return null!=e&&a.call(e,t)}var z=E("Arguments");!function(){z(arguments)||(z=function(e){return H(e,"callee")})}();var M=z;function q(e){return A(e)&&b(e)}function W(e){return function(){return e}}function D(e){return function(t){var i=e(t);return"number"==typeof i&&i>=0&&i<=w}}function J(e){return function(t){return null==t?void 0:t[e]}}var Y=J("byteLength"),K=D(Y),G=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,Q=c?function(e){return p?p(e)&&!P(e):K(e)&&G.test(l.call(e))}:W(!1),X=J("length");function Z(e,t){t=function(e){for(var t={},i=e.length,n=0;n<i;++n)t[e[n]]=!0;return{contains:function(e){return!0===t[e]},push:function(i){return t[i]=!0,e.push(i)}}}(t);var i=g.length,o=e.constructor,r=L(o)&&o.prototype||n,s="constructor";for(H(e,s)&&!t.contains(s)&&t.push(s);i--;)(s=g[i])in e&&e[s]!==r[s]&&!t.contains(s)&&t.push(s)}function ee(e){if(!y(e))return[];if(h)return h(e);var t=[];for(var i in e)H(e,i)&&t.push(i);return m&&Z(e,t),t}function te(e,t){var i=ee(t),n=i.length;if(null==e)return!n;for(var o=Object(e),r=0;r<n;r++){var s=i[r];if(t[s]!==o[s]||!(s in o))return!1}return!0}function ie(e){return e instanceof ie?e:this instanceof ie?void(this._wrapped=e):new ie(e)}function ne(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,Y(e))}ie.VERSION=e,ie.prototype.value=function(){return this._wrapped},ie.prototype.valueOf=ie.prototype.toJSON=ie.prototype.value,ie.prototype.toString=function(){return String(this._wrapped)};var oe="[object DataView]";function re(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=typeof e;return("function"===o||"object"===o||"object"==typeof t)&&se(e,t,i,n)}function se(e,t,i,n){e instanceof ie&&(e=e._wrapped),t instanceof ie&&(t=t._wrapped);var r=l.call(e);if(r!==l.call(t))return!1;if(O&&"[object Object]"==r&&P(e)){if(!P(t))return!1;r=oe}switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return o.valueOf.call(e)===o.valueOf.call(t);case"[object ArrayBuffer]":case oe:return se(ne(e),ne(t),i,n)}var s="[object Array]"===r;if(!s&&Q(e)){if(Y(e)!==Y(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;s=!0}if(!s){if("object"!=typeof e||"object"!=typeof t)return!1;var a=e.constructor,c=t.constructor;if(a!==c&&!(L(a)&&a instanceof a&&L(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}n=n||[];for(var u=(i=i||[]).length;u--;)if(i[u]===e)return n[u]===t;if(i.push(e),n.push(t),s){if((u=e.length)!==t.length)return!1;for(;u--;)if(!re(e[u],t[u],i,n))return!1}else{var d,h=ee(e);if(u=h.length,ee(t).length!==u)return!1;for(;u--;)if(!H(t,d=h[u])||!re(e[d],t[d],i,n))return!1}return i.pop(),n.pop(),!0}function le(e){if(!y(e))return[];var t=[];for(var i in e)t.push(i);return m&&Z(e,t),t}function ae(e){var t=X(e);return function(i){if(null==i)return!1;var n=le(i);if(X(n))return!1;for(var o=0;o<t;o++)if(!L(i[e[o]]))return!1;return e!==fe||!L(i[ce])}}var ce="forEach",ue=["clear","delete"],de=["get","has","set"],he=ue.concat(ce,de),fe=ue.concat(de),pe=["add"].concat(ue,ce,"has"),be=N?ae(he):E("Map"),$e=N?ae(fe):E("WeakMap"),me=N?ae(pe):E("Set"),ge=E("WeakSet");function we(e){for(var t=ee(e),i=t.length,n=Array(i),o=0;o<i;o++)n[o]=e[t[o]];return n}function ve(e){for(var t={},i=ee(e),n=0,o=i.length;n<o;n++)t[e[i[n]]]=i[n];return t}function ye(e){var t=[];for(var i in e)L(e[i])&&t.push(i);return t.sort()}function xe(e,t){return function(i){var n=arguments.length;if(t&&(i=Object(i)),n<2||null==i)return i;for(var o=1;o<n;o++)for(var r=arguments[o],s=e(r),l=s.length,a=0;a<l;a++){var c=s[a];t&&void 0!==i[c]||(i[c]=r[c])}return i}}var _e=xe(le),Ee=xe(ee),ke=xe(le,!0);function Ae(e){if(!y(e))return{};if(f)return f(e);var t=function(){};t.prototype=e;var i=new t;return t.prototype=null,i}function Ie(e){return U(e)?e:[e]}function Ve(e){return ie.toPath(e)}function Se(e,t){for(var i=t.length,n=0;n<i;n++){if(null==e)return;e=e[t[n]]}return i?e:void 0}function Te(e,t,i){var n=Se(e,Ve(t));return x(n)?i:n}function je(e){return e}function Fe(e){return e=Ee({},e),function(t){return te(t,e)}}function Be(e){return e=Ve(e),function(t){return Se(t,e)}}function Le(e,t,i){if(void 0===t)return e;switch(null==i?3:i){case 1:return function(i){return e.call(t,i)};case 3:return function(i,n,o){return e.call(t,i,n,o)};case 4:return function(i,n,o,r){return e.call(t,i,n,o,r)}}return function(){return e.apply(t,arguments)}}function Re(e,t,i){return null==e?je:L(e)?Le(e,t,i):y(e)&&!U(e)?Fe(e):Be(e)}function Oe(e,t){return Re(e,t,1/0)}function Ne(e,t,i){return ie.iteratee!==Oe?ie.iteratee(e,t):Re(e,t,i)}function Ce(){}function Pe(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}ie.toPath=Ie,ie.iteratee=Oe;var Ue=Date.now||function(){return(new Date).getTime()};function He(e){var t=function(t){return e[t]},i="(?:"+ee(e).join("|")+")",n=RegExp(i),o=RegExp(i,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(o,t):e}}var ze={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Me=He(ze),qe=He(ve(ze)),We=ie.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},De=/(.)^/,Je={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Ye=/\\|'|\r|\n|\u2028|\u2029/g;function Ke(e){return"\\"+Je[e]}var Ge=/^\s*(\w|\$)+\s*$/,Qe=0;function Xe(e,t,i,n,o){if(!(n instanceof t))return e.apply(i,o);var r=Ae(e.prototype),s=e.apply(r,o);return y(s)?s:r}var Ze=v((function(e,t){var i=Ze.placeholder,n=function(){for(var o=0,r=t.length,s=Array(r),l=0;l<r;l++)s[l]=t[l]===i?arguments[o++]:t[l];for(;o<arguments.length;)s.push(arguments[o++]);return Xe(e,n,this,this,s)};return n}));Ze.placeholder=ie;var et=v((function(e,t,i){if(!L(e))throw new TypeError("Bind must be called on a function");var n=v((function(o){return Xe(e,n,t,this,i.concat(o))}));return n})),tt=D(X);function it(e,t,i,n){if(n=n||[],t||0===t){if(t<=0)return n.concat(e)}else t=1/0;for(var o=n.length,r=0,s=X(e);r<s;r++){var l=e[r];if(tt(l)&&(U(l)||M(l)))if(t>1)it(l,t-1,i,n),o=n.length;else for(var a=0,c=l.length;a<c;)n[o++]=l[a++];else i||(n[o++]=l)}return n}var nt=v((function(e,t){var i=(t=it(t,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var n=t[i];e[n]=et(e[n],e)}return e})),ot=v((function(e,t,i){return setTimeout((function(){return e.apply(null,i)}),t)})),rt=Ze(ot,ie,1);function st(e){return function(){return!e.apply(this,arguments)}}function lt(e,t){var i;return function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=null),i}}var at=Ze(lt,2);function ct(e,t,i){t=Ne(t,i);for(var n,o=ee(e),r=0,s=o.length;r<s;r++)if(t(e[n=o[r]],n,e))return n}function ut(e){return function(t,i,n){i=Ne(i,n);for(var o=X(t),r=e>0?0:o-1;r>=0&&r<o;r+=e)if(i(t[r],r,t))return r;return-1}}var dt=ut(1),ht=ut(-1);function ft(e,t,i,n){for(var o=(i=Ne(i,n,1))(t),r=0,s=X(e);r<s;){var l=Math.floor((r+s)/2);i(e[l])<o?r=l+1:s=l}return r}function pt(e,t,i){return function(n,o,r){var l=0,a=X(n);if("number"==typeof r)e>0?l=r>=0?r:Math.max(r+a,l):a=r>=0?Math.min(r+1,a):r+a+1;else if(i&&r&&a)return n[r=i(n,o)]===o?r:-1;if(o!=o)return(r=t(s.call(n,l,a),q))>=0?r+l:-1;for(r=e>0?l:a-1;r>=0&&r<a;r+=e)if(n[r]===o)return r;return-1}}var bt=pt(1,dt,ft),$t=pt(-1,ht);function mt(e,t,i){var n=(tt(e)?dt:ct)(e,t,i);if(void 0!==n&&-1!==n)return e[n]}function gt(e,t,i){var n,o;if(t=Le(t,i),tt(e))for(n=0,o=e.length;n<o;n++)t(e[n],n,e);else{var r=ee(e);for(n=0,o=r.length;n<o;n++)t(e[r[n]],r[n],e)}return e}function wt(e,t,i){t=Ne(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=Array(o),s=0;s<o;s++){var l=n?n[s]:s;r[s]=t(e[l],l,e)}return r}function vt(e){var t=function(t,i,n,o){var r=!tt(t)&&ee(t),s=(r||t).length,l=e>0?0:s-1;for(o||(n=t[r?r[l]:l],l+=e);l>=0&&l<s;l+=e){var a=r?r[l]:l;n=i(n,t[a],a,t)}return n};return function(e,i,n,o){var r=arguments.length>=3;return t(e,Le(i,o,4),n,r)}}var yt=vt(1),xt=vt(-1);function _t(e,t,i){var n=[];return t=Ne(t,i),gt(e,(function(e,i,o){t(e,i,o)&&n.push(e)})),n}function Et(e,t,i){t=Ne(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=0;r<o;r++){var s=n?n[r]:r;if(!t(e[s],s,e))return!1}return!0}function kt(e,t,i){t=Ne(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=0;r<o;r++){var s=n?n[r]:r;if(t(e[s],s,e))return!0}return!1}function At(e,t,i,n){return tt(e)||(e=we(e)),("number"!=typeof i||n)&&(i=0),bt(e,t,i)>=0}var It=v((function(e,t,i){var n,o;return L(t)?o=t:(t=Ve(t),n=t.slice(0,-1),t=t[t.length-1]),wt(e,(function(e){var r=o;if(!r){if(n&&n.length&&(e=Se(e,n)),null==e)return;r=e[t]}return null==r?r:r.apply(e,i)}))}));function Vt(e,t){return wt(e,Be(t))}function St(e,t,i){var n,o,r=-1/0,s=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var l=0,a=(e=tt(e)?e:we(e)).length;l<a;l++)null!=(n=e[l])&&n>r&&(r=n);else t=Ne(t,i),gt(e,(function(e,i,n){((o=t(e,i,n))>s||o===-1/0&&r===-1/0)&&(r=e,s=o)}));return r}var Tt=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function jt(e){return e?U(e)?s.call(e):k(e)?e.match(Tt):tt(e)?wt(e,je):we(e):[]}function Ft(e,t,i){if(null==t||i)return tt(e)||(e=we(e)),e[Pe(e.length-1)];var n=jt(e),o=X(n);t=Math.max(Math.min(t,o),0);for(var r=o-1,s=0;s<t;s++){var l=Pe(s,r),a=n[s];n[s]=n[l],n[l]=a}return n.slice(0,t)}function Bt(e,t){return function(i,n,o){var r=t?[[],[]]:{};return n=Ne(n,o),gt(i,(function(t,o){var s=n(t,o,i);e(r,t,s)})),r}}var Lt=Bt((function(e,t,i){H(e,i)?e[i].push(t):e[i]=[t]})),Rt=Bt((function(e,t,i){e[i]=t})),Ot=Bt((function(e,t,i){H(e,i)?e[i]++:e[i]=1})),Nt=Bt((function(e,t,i){e[i?0:1].push(t)}),!0);function Ct(e,t,i){return t in i}var Pt=v((function(e,t){var i={},n=t[0];if(null==e)return i;L(n)?(t.length>1&&(n=Le(n,t[1])),t=le(e)):(n=Ct,t=it(t,!1,!1),e=Object(e));for(var o=0,r=t.length;o<r;o++){var s=t[o],l=e[s];n(l,s,e)&&(i[s]=l)}return i})),Ut=v((function(e,t){var i,n=t[0];return L(n)?(n=st(n),t.length>1&&(i=t[1])):(t=wt(it(t,!1,!1),String),n=function(e,i){return!At(t,i)}),Pt(e,n,i)}));function Ht(e,t,i){return s.call(e,0,Math.max(0,e.length-(null==t||i?1:t)))}function zt(e,t,i){return null==e||e.length<1?null==t||i?void 0:[]:null==t||i?e[0]:Ht(e,e.length-t)}function Mt(e,t,i){return s.call(e,null==t||i?1:t)}var qt=v((function(e,t){return t=it(t,!0,!0),_t(e,(function(e){return!At(t,e)}))})),Wt=v((function(e,t){return qt(e,t)}));function Dt(e,t,i,n){_(t)||(n=i,i=t,t=!1),null!=i&&(i=Ne(i,n));for(var o=[],r=[],s=0,l=X(e);s<l;s++){var a=e[s],c=i?i(a,s,e):a;t&&!i?(s&&r===c||o.push(a),r=c):i?At(r,c)||(r.push(c),o.push(a)):At(o,a)||o.push(a)}return o}var Jt=v((function(e){return Dt(it(e,!0,!0))}));function Yt(e){for(var t=e&&St(e,X).length||0,i=Array(t),n=0;n<t;n++)i[n]=Vt(e,n);return i}var Kt=v(Yt);function Gt(e,t){return e._chain?ie(t).chain():t}function Qt(e){return gt(ye(e),(function(t){var i=ie[t]=e[t];ie.prototype[t]=function(){var e=[this._wrapped];return r.apply(e,arguments),Gt(this,i.apply(ie,e))}})),ie}gt(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=i[e];ie.prototype[e]=function(){var i=this._wrapped;return null!=i&&(t.apply(i,arguments),"shift"!==e&&"splice"!==e||0!==i.length||delete i[0]),Gt(this,i)}})),gt(["concat","join","slice"],(function(e){var t=i[e];ie.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),Gt(this,e)}}));var Xt={__proto__:null,VERSION:e,restArguments:v,isObject:y,isNull:function(e){return null===e},isUndefined:x,isBoolean:_,isElement:function(e){return!(!e||1!==e.nodeType)},isString:k,isNumber:A,isDate:I,isRegExp:V,isError:S,isSymbol:T,isArrayBuffer:j,isDataView:P,isArray:U,isFunction:L,isArguments:M,isFinite:function(e){return!T(e)&&$(e)&&!isNaN(parseFloat(e))},isNaN:q,isTypedArray:Q,isEmpty:function(e){if(null==e)return!0;var t=X(e);return"number"==typeof t&&(U(e)||k(e)||M(e))?0===t:0===X(ee(e))},isMatch:te,isEqual:function(e,t){return re(e,t)},isMap:be,isWeakMap:$e,isSet:me,isWeakSet:ge,keys:ee,allKeys:le,values:we,pairs:function(e){for(var t=ee(e),i=t.length,n=Array(i),o=0;o<i;o++)n[o]=[t[o],e[t[o]]];return n},invert:ve,functions:ye,methods:ye,extend:_e,extendOwn:Ee,assign:Ee,defaults:ke,create:function(e,t){var i=Ae(e);return t&&Ee(i,t),i},clone:function(e){return y(e)?U(e)?e.slice():_e({},e):e},tap:function(e,t){return t(e),e},get:Te,has:function(e,t){for(var i=(t=Ve(t)).length,n=0;n<i;n++){var o=t[n];if(!H(e,o))return!1;e=e[o]}return!!i},mapObject:function(e,t,i){t=Ne(t,i);for(var n=ee(e),o=n.length,r={},s=0;s<o;s++){var l=n[s];r[l]=t(e[l],l,e)}return r},identity:je,constant:W,noop:Ce,toPath:Ie,property:Be,propertyOf:function(e){return null==e?Ce:function(t){return Te(e,t)}},matcher:Fe,matches:Fe,times:function(e,t,i){var n=Array(Math.max(0,e));t=Le(t,i,1);for(var o=0;o<e;o++)n[o]=t(o);return n},random:Pe,now:Ue,escape:Me,unescape:qe,templateSettings:We,template:function(e,t,i){!t&&i&&(t=i),t=ke({},t,ie.templateSettings);var n=RegExp([(t.escape||De).source,(t.interpolate||De).source,(t.evaluate||De).source].join("|")+"|$","g"),o=0,r="__p+='";e.replace(n,(function(t,i,n,s,l){return r+=e.slice(o,l).replace(Ye,Ke),o=l+t.length,i?r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?r+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(r+="';\n"+s+"\n__p+='"),t})),r+="';\n";var s,l=t.variable;if(l){if(!Ge.test(l))throw new Error("variable is not a bare identifier: "+l)}else r="with(obj||{}){\n"+r+"}\n",l="obj";r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{s=new Function(l,"_",r)}catch(e){throw e.source=r,e}var a=function(e){return s.call(this,e,ie)};return a.source="function("+l+"){\n"+r+"}",a},result:function(e,t,i){var n=(t=Ve(t)).length;if(!n)return L(i)?i.call(e):i;for(var o=0;o<n;o++){var r=null==e?void 0:e[t[o]];void 0===r&&(r=i,o=n),e=L(r)?r.call(e):r}return e},uniqueId:function(e){var t=++Qe+"";return e?e+t:t},chain:function(e){var t=ie(e);return t._chain=!0,t},iteratee:Oe,partial:Ze,bind:et,bindAll:nt,memoize:function(e,t){var i=function(n){var o=i.cache,r=""+(t?t.apply(this,arguments):n);return H(o,r)||(o[r]=e.apply(this,arguments)),o[r]};return i.cache={},i},delay:ot,defer:rt,throttle:function(e,t,i){var n,o,r,s,l=0;i||(i={});var a=function(){l=!1===i.leading?0:Ue(),n=null,s=e.apply(o,r),n||(o=r=null)},c=function(){var c=Ue();l||!1!==i.leading||(l=c);var u=t-(c-l);return o=this,r=arguments,u<=0||u>t?(n&&(clearTimeout(n),n=null),l=c,s=e.apply(o,r),n||(o=r=null)):n||!1===i.trailing||(n=setTimeout(a,u)),s};return c.cancel=function(){clearTimeout(n),l=0,n=o=r=null},c},debounce:function(e,t,i){var n,o,r,s,l,a=function(){var c=Ue()-o;t>c?n=setTimeout(a,t-c):(n=null,i||(s=e.apply(l,r)),n||(r=l=null))},c=v((function(c){return l=this,r=c,o=Ue(),n||(n=setTimeout(a,t),i&&(s=e.apply(l,r))),s}));return c.cancel=function(){clearTimeout(n),n=r=l=null},c},wrap:function(e,t){return Ze(t,e)},negate:st,compose:function(){var e=arguments,t=e.length-1;return function(){for(var i=t,n=e[t].apply(this,arguments);i--;)n=e[i].call(this,n);return n}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:lt,once:at,findKey:ct,findIndex:dt,findLastIndex:ht,sortedIndex:ft,indexOf:bt,lastIndexOf:$t,find:mt,detect:mt,findWhere:function(e,t){return mt(e,Fe(t))},each:gt,forEach:gt,map:wt,collect:wt,reduce:yt,foldl:yt,inject:yt,reduceRight:xt,foldr:xt,filter:_t,select:_t,reject:function(e,t,i){return _t(e,st(Ne(t)),i)},every:Et,all:Et,some:kt,any:kt,contains:At,includes:At,include:At,invoke:It,pluck:Vt,where:function(e,t){return _t(e,Fe(t))},max:St,min:function(e,t,i){var n,o,r=1/0,s=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var l=0,a=(e=tt(e)?e:we(e)).length;l<a;l++)null!=(n=e[l])&&n<r&&(r=n);else t=Ne(t,i),gt(e,(function(e,i,n){((o=t(e,i,n))<s||o===1/0&&r===1/0)&&(r=e,s=o)}));return r},shuffle:function(e){return Ft(e,1/0)},sample:Ft,sortBy:function(e,t,i){var n=0;return t=Ne(t,i),Vt(wt(e,(function(e,i,o){return{value:e,index:n++,criteria:t(e,i,o)}})).sort((function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index-t.index})),"value")},groupBy:Lt,indexBy:Rt,countBy:Ot,partition:Nt,toArray:jt,size:function(e){return null==e?0:tt(e)?e.length:ee(e).length},pick:Pt,omit:Ut,first:zt,head:zt,take:zt,initial:Ht,last:function(e,t,i){return null==e||e.length<1?null==t||i?void 0:[]:null==t||i?e[e.length-1]:Mt(e,Math.max(0,e.length-t))},rest:Mt,tail:Mt,drop:Mt,compact:function(e){return _t(e,Boolean)},flatten:function(e,t){return it(e,t,!1)},without:Wt,uniq:Dt,unique:Dt,union:Jt,intersection:function(e){for(var t=[],i=arguments.length,n=0,o=X(e);n<o;n++){var r=e[n];if(!At(t,r)){var s;for(s=1;s<i&&At(arguments[s],r);s++);s===i&&t.push(r)}}return t},difference:qt,unzip:Yt,transpose:Yt,zip:Kt,object:function(e,t){for(var i={},n=0,o=X(e);n<o;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},range:function(e,t,i){null==t&&(t=e||0,e=0),i||(i=t<e?-1:1);for(var n=Math.max(Math.ceil((t-e)/i),0),o=Array(n),r=0;r<n;r++,e+=i)o[r]=e;return o},chunk:function(e,t){if(null==t||t<1)return[];for(var i=[],n=0,o=e.length;n<o;)i.push(s.call(e,n,n+=t));return i},mixin:Qt,default:ie},Zt=Qt(Xt);return Zt._=Zt,Zt})),function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],(function(i,n,o){t.Backbone=e(t,o,i,n)}));else if("undefined"!=typeof exports){var i,n=require("underscore");try{i=require("jquery")}catch(e){}e(t,exports,n,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}((function(e,t,i,n){var o=e.Backbone,r=Array.prototype.slice;t.VERSION="1.4.1",t.$=n,t.noConflict=function(){return e.Backbone=o,this},t.emulateHTTP=!1,t.emulateJSON=!1;var s,l=t.Events={},a=/\s+/,c=function(e,t,n,o,r){var s,l=0;if(n&&"object"==typeof n){void 0!==o&&"context"in r&&void 0===r.context&&(r.context=o);for(s=i.keys(n);l<s.length;l++)t=c(e,t,s[l],n[s[l]],r)}else if(n&&a.test(n))for(s=n.split(a);l<s.length;l++)t=e(t,s[l],o,r);else t=e(t,n,o,r);return t};l.on=function(e,t,i){return this._events=c(u,this._events||{},e,t,{context:i,ctx:this,listening:s}),s&&((this._listeners||(this._listeners={}))[s.id]=s,s.interop=!1),this},l.listenTo=function(e,t,n){if(!e)return this;var o=e._listenId||(e._listenId=i.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),l=s=r[o];l||(this._listenId||(this._listenId=i.uniqueId("l")),l=s=r[o]=new $(this,e));var a=d(e,t,n,this);if(s=void 0,a)throw a;return l.interop&&l.on(t,n),this};var u=function(e,t,i,n){if(i){var o=e[t]||(e[t]=[]),r=n.context,s=n.ctx,l=n.listening;l&&l.count++,o.push({callback:i,context:r,ctx:r||s,listening:l})}return e},d=function(e,t,i,n){try{e.on(t,i,n)}catch(e){return e}};l.off=function(e,t,i){return this._events?(this._events=c(h,this._events,e,t,{context:i,listeners:this._listeners}),this):this},l.stopListening=function(e,t,n){var o=this._listeningTo;if(!o)return this;for(var r=e?[e._listenId]:i.keys(o),s=0;s<r.length;s++){var l=o[r[s]];if(!l)break;l.obj.off(t,n,this),l.interop&&l.off(t,n)}return i.isEmpty(o)&&(this._listeningTo=void 0),this};var h=function(e,t,n,o){if(e){var r,s=o.context,l=o.listeners,a=0;if(t||s||n){for(r=t?[t]:i.keys(e);a<r.length;a++){var c=e[t=r[a]];if(!c)break;for(var u=[],d=0;d<c.length;d++){var h=c[d];if(n&&n!==h.callback&&n!==h.callback._callback||s&&s!==h.context)u.push(h);else{var f=h.listening;f&&f.off(t,n)}}u.length?e[t]=u:delete e[t]}return e}for(r=i.keys(l);a<r.length;a++)l[r[a]].cleanup()}};l.once=function(e,t,i){var n=c(f,{},e,t,this.off.bind(this));return"string"==typeof e&&null==i&&(t=void 0),this.on(n,t,i)},l.listenToOnce=function(e,t,i){var n=c(f,{},t,i,this.stopListening.bind(this,e));return this.listenTo(e,n)};var f=function(e,t,n,o){if(n){var r=e[t]=i.once((function(){o(t,r),n.apply(this,arguments)}));r._callback=n}return e};l.trigger=function(e){if(!this._events)return this;for(var t=Math.max(0,arguments.length-1),i=Array(t),n=0;n<t;n++)i[n]=arguments[n+1];return c(p,this._events,e,void 0,i),this};var p=function(e,t,i,n){if(e){var o=e[t],r=e.all;o&&r&&(r=r.slice()),o&&b(o,n),r&&b(r,[t].concat(n))}return e},b=function(e,t){var i,n=-1,o=e.length,r=t[0],s=t[1],l=t[2];switch(t.length){case 0:for(;++n<o;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r);return;case 2:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r,s);return;case 3:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r,s,l);return;default:for(;++n<o;)(i=e[n]).callback.apply(i.ctx,t);return}},$=function(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0};$.prototype.on=l.on,$.prototype.off=function(e,t){var i;this.interop?(this._events=c(h,this._events,e,t,{context:void 0,listeners:void 0}),i=!this._events):(this.count--,i=0===this.count),i&&this.cleanup()},$.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},l.bind=l.on,l.unbind=l.off,i.extend(t,l);var m=t.Model=function(e,t){var n=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});var o=i.result(this,"defaults");n=i.defaults(i.extend({},o,n),o),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(m.prototype,l,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!i.iteratee(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;var o;if("object"==typeof e?(o=e,n=t):(o={})[e]=t,n||(n={}),!this._validate(o,n))return!1;var r=n.unset,s=n.silent,l=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=i.clone(this.attributes),this.changed={});var c=this.attributes,u=this.changed,d=this._previousAttributes;for(var h in o)t=o[h],i.isEqual(c[h],t)||l.push(h),i.isEqual(d[h],t)?delete u[h]:u[h]=t,r?delete c[h]:c[h]=t;if(this.idAttribute in o){var f=this.id;this.id=this.get(this.idAttribute),this.trigger("changeId",this,f,n)}if(!s){l.length&&(this._pending=n);for(var p=0;p<l.length;p++)this.trigger("change:"+l[p],this,c[l[p]],n)}if(a)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&i.clone(this.changed);var t,n=this._changing?this._previousAttributes:this.attributes,o={};for(var r in e){var s=e[r];i.isEqual(n[r],s)||(o[r]=s,t=!0)}return!!t&&o},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=i.extend({parse:!0},e);var t=this,n=e.success;return e.success=function(i){var o=e.parse?t.parse(i,e):i;if(!t.set(o,e))return!1;n&&n.call(e.context,t,i,e),t.trigger("sync",t,i,e)},q(this,e),this.sync("read",this,e)},save:function(e,t,n){var o;null==e||"object"==typeof e?(o=e,n=t):(o={})[e]=t;var r=(n=i.extend({validate:!0,parse:!0},n)).wait;if(o&&!r){if(!this.set(o,n))return!1}else if(!this._validate(o,n))return!1;var s=this,l=n.success,a=this.attributes;n.success=function(e){s.attributes=a;var t=n.parse?s.parse(e,n):e;if(r&&(t=i.extend({},o,t)),t&&!s.set(t,n))return!1;l&&l.call(n.context,s,e,n),s.trigger("sync",s,e,n)},q(this,n),o&&r&&(this.attributes=i.extend({},a,o));var c=this.isNew()?"create":n.patch?"patch":"update";"patch"!==c||n.attrs||(n.attrs=o);var u=this.sync(c,this,n);return this.attributes=a,u},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,o=e.wait,r=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(i){o&&r(),n&&n.call(e.context,t,i,e),t.isNew()||t.trigger("sync",t,i,e)};var s=!1;return this.isNew()?i.defer(e.success):(q(this,e),s=this.sync("delete",this,e)),o||r(),s},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||M();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1)}});var g=t.Collection=function(e,t){t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},w={add:!0,remove:!0,merge:!0},v={add:!0,remove:!1},y=function(e,t,i){i=Math.min(Math.max(i,0),e.length);var n,o=Array(e.length-i),r=t.length;for(n=0;n<o.length;n++)o[n]=e[n+i];for(n=0;n<r;n++)e[n+i]=t[n];for(n=0;n<o.length;n++)e[n+r+i]=o[n]};i.extend(g.prototype,l,{model:m,preinitialize:function(){},initialize:function(){},toJSON:function(e){return this.map((function(t){return t.toJSON(e)}))},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,v))},remove:function(e,t){t=i.extend({},t);var n=!i.isArray(e);e=n?[e]:e.slice();var o=this._removeModels(e,t);return!t.silent&&o.length&&(t.changes={added:[],merged:[],removed:o},this.trigger("update",this,t)),n?o[0]:o},set:function(e,t){if(null!=e){(t=i.extend({},w,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var n=!i.isArray(e);e=n?[e]:e.slice();var o=t.at;null!=o&&(o=+o),o>this.length&&(o=this.length),o<0&&(o+=this.length+1);var r,s,l=[],a=[],c=[],u=[],d={},h=t.add,f=t.merge,p=t.remove,b=!1,$=this.comparator&&null==o&&!1!==t.sort,m=i.isString(this.comparator)?this.comparator:null;for(s=0;s<e.length;s++){r=e[s];var g=this.get(r);if(g){if(f&&r!==g){var v=this._isModel(r)?r.attributes:r;t.parse&&(v=g.parse(v,t)),g.set(v,t),c.push(g),$&&!b&&(b=g.hasChanged(m))}d[g.cid]||(d[g.cid]=!0,l.push(g)),e[s]=g}else h&&(r=e[s]=this._prepareModel(r,t))&&(a.push(r),this._addReference(r,t),d[r.cid]=!0,l.push(r))}if(p){for(s=0;s<this.length;s++)d[(r=this.models[s]).cid]||u.push(r);u.length&&this._removeModels(u,t)}var x=!1,_=!$&&h&&p;if(l.length&&_?(x=this.length!==l.length||i.some(this.models,(function(e,t){return e!==l[t]})),this.models.length=0,y(this.models,l,0),this.length=this.models.length):a.length&&($&&(b=!0),y(this.models,a,null==o?this.length:o),this.length=this.models.length),b&&this.sort({silent:!0}),!t.silent){for(s=0;s<a.length;s++)null!=o&&(t.index=o+s),(r=a[s]).trigger("add",r,this,t);(b||x)&&this.trigger("sort",this,t),(a.length||u.length||c.length)&&(t.changes={added:a,removed:u,merged:c},this.trigger("update",this,t))}return n?e[0]:e}},reset:function(e,t){t=t?i.clone(t):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return r.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e,e.idAttribute)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var n=t.length;return i.isFunction(t)&&(t=t.bind(this)),1===n||i.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){var t=(e=i.extend({parse:!0},e)).success,n=this;return e.success=function(i){var o=e.reset?"reset":"set";n[o](i,e),t&&t.call(e.context,n,i,e),n.trigger("sync",n,i,e)},q(this,e),this.sync("read",this,e)},create:function(e,t){var n=(t=t?i.clone(t):{}).wait;if(!(e=this._prepareModel(e,t)))return!1;n||this.add(e,t);var o=this,r=t.success;return t.success=function(e,t,i){n&&o.add(e,i),r&&r.call(i.context,e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e,t){return e[t||this.model.prototype.idAttribute||"id"]},values:function(){return new _(this,E)},keys:function(){return new _(this,k)},entries:function(){return new _(this,A)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){return this._isModel(e)?(e.collection||(e.collection=this),e):((t=t?i.clone(t):{}).collection=this,(n=this.model.prototype?new this.model(e,t):this.model(e,t)).validationError?(this.trigger("invalid",this,n.validationError,t),!1):n);var n},_removeModels:function(e,t){for(var i=[],n=0;n<e.length;n++){var o=this.get(e[n]);if(o){var r=this.indexOf(o);this.models.splice(r,1),this.length--,delete this._byId[o.cid];var s=this.modelId(o.attributes,o.idAttribute);null!=s&&delete this._byId[s],t.silent||(t.index=r,o.trigger("remove",o,this,t)),i.push(o),this._removeReference(o,t)}}return i},_isModel:function(e){return e instanceof m},_addReference:function(e,t){this._byId[e.cid]=e;var i=this.modelId(e.attributes,e.idAttribute);null!=i&&(this._byId[i]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var i=this.modelId(e.attributes,e.idAttribute);null!=i&&delete this._byId[i],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){if(t){if(("add"===e||"remove"===e)&&i!==this)return;if("destroy"===e&&this.remove(t,n),"changeId"===e){var o=this.modelId(t.previousAttributes(),t.idAttribute),r=this.modelId(t.attributes,t.idAttribute);null!=o&&delete this._byId[o],null!=r&&(this._byId[r]=t)}}this.trigger.apply(this,arguments)}});var x="function"==typeof Symbol&&Symbol.iterator;x&&(g.prototype[x]=g.prototype.values);var _=function(e,t){this._collection=e,this._kind=t,this._index=0},E=1,k=2,A=3;x&&(_.prototype[x]=function(){return this}),_.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var e,t=this._collection.at(this._index);if(this._index++,this._kind===E)e=t;else{var i=this._collection.modelId(t.attributes,t.idAttribute);e=this._kind===k?i:[i,t]}return{value:e,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var I=t.View=function(e){this.cid=i.uniqueId("view"),this.preinitialize.apply(this,arguments),i.extend(this,i.pick(e,S)),this._ensureElement(),this.initialize.apply(this,arguments)},V=/^(\S+)\s*(.*)$/,S=["model","collection","el","id","attributes","className","tagName","events"];i.extend(I.prototype,l,{tagName:"div",$:function(e){return this.$el.find(e)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=i.result(this,"events")),!e)return this;for(var t in this.undelegateEvents(),e){var n=e[t];if(i.isFunction(n)||(n=this[n]),n){var o=t.match(V);this.delegate(o[1],o[2],n.bind(this))}}return this},delegate:function(e,t,i){return this.$el.on(e+".delegateEvents"+this.cid,t,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,i){return this.$el.off(e+".delegateEvents"+this.cid,t,i),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e.class=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}});var T=function(e,t,n,o){i.each(n,(function(i,n){t[n]&&(e.prototype[n]=function(e,t,i,n){switch(t){case 1:return function(){return e[i](this[n])};case 2:return function(t){return e[i](this[n],t)};case 3:return function(t,o){return e[i](this[n],j(t,this),o)};case 4:return function(t,o,r){return e[i](this[n],j(t,this),o,r)};default:return function(){var t=r.call(arguments);return t.unshift(this[n]),e[i].apply(e,t)}}}(t,i,n,o))}))},j=function(e,t){return i.isFunction(e)?e:i.isObject(e)&&!t._isModel(e)?F(e):i.isString(e)?function(t){return t.get(e)}:e},F=function(e){var t=i.matches(e);return function(e){return t(e.attributes)}};i.each([[g,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"],[m,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],(function(e){var t=e[0],n=e[1],o=e[2];t.mixin=function(e){var n=i.reduce(i.functions(e),(function(e,t){return e[t]=0,e}),{});T(t,e,n,o)},T(t,i,n,o)})),t.sync=function(e,n,o){var r=B[e];i.defaults(o||(o={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var s={type:r,dataType:"json"};if(o.url||(s.url=i.result(n,"url")||M()),null!=o.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(o.attrs||n.toJSON(o))),o.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),o.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){s.type="POST",o.emulateJSON&&(s.data._method=r);var l=o.beforeSend;o.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",r),l)return l.apply(this,arguments)}}"GET"===s.type||o.emulateJSON||(s.processData=!1);var a=o.error;o.error=function(e,t,i){o.textStatus=t,o.errorThrown=i,a&&a.call(o.context,e,t,i)};var c=o.xhr=t.ajax(i.extend(s,o));return n.trigger("request",n,c,o),c};var B={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var L=t.Router=function(e){e||(e={}),this.preinitialize.apply(this,arguments),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},R=/\((.*?)\)/g,O=/(\(\?)?:\w+/g,N=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(L.prototype,l,{preinitialize:function(){},initialize:function(){},route:function(e,n,o){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(o=n,n=""),o||(o=this[n]);var r=this;return t.history.route(e,(function(i){var s=r._extractParameters(e,i);!1!==r.execute(o,s,n)&&(r.trigger.apply(r,["route:"+n].concat(s)),r.trigger("route",n,s),t.history.trigger("route",r,n,s))})),this},execute:function(e,t,i){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(C,"\\$&").replace(R,"(?:$1)?").replace(O,(function(e,t){return t?e:"([^/?]+)"})).replace(N,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,(function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null}))}});var P=t.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},U=/^[#\/]|\s+$/g,H=/^\/+|\/+$/g,z=/#.*$/;P.started=!1,i.extend(P.prototype,l,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(U,"")},start:function(e){if(P.started)throw new Error("Backbone.history has already been started");if(P.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(H,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,o=n.insertBefore(this.iframe,n.firstChild).contentWindow;o.document.open(),o.document.close(),o.location.hash="#"+this.fragment}var r=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),P.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),i.some(this.handlers,(function(t){if(t.route.test(e))return t.callback(e),!0})))},navigate:function(e,t){if(!P.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");var i=this.root;""!==e&&"?"!==e.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+e;e=e.replace(z,"");var o=this.decodeFragment(e);if(this.fragment!==o){if(this.fragment=o,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;t.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new P,m.extend=g.extend=L.extend=I.extend=P.extend=function(e,t){var n,o=this;return n=e&&i.has(e,"constructor")?e.constructor:function(){return o.apply(this,arguments)},i.extend(n,o,t),n.prototype=i.create(o.prototype,e),n.prototype.constructor=n,n.__super__=o.prototype,n};var M=function(){throw new Error('A "url" property or function must be specified')},q=function(e,t){var i=t.error;t.error=function(n){i&&i.call(t.context,e,n,t),e.trigger("error",e,n,t)}};return t}))}function t(e,t){"undefined"!=typeof Storage&&localStorage.setItem(e,t)}function i(e,i){const n=new Date;let o=`${n.getDate()}.${String(n.getMonth()+1).padStart(2,"0")}.${n.getFullYear()} ${n.getHours()}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`;try{let n,r=null;if(void 0!==$$("tree").getSelectedItem()&&(r=$$("tree").getSelectedItem().id,r.includes("single"))){let e=r.search("-single");r=r.slice(0,e)}if(r){let e;C.forEach((function(t,i){t.id==r&&(e=t.name)})),$$("logBlock-list").add({date:o,value:i,src:e})}else $$("logBlock-list").add({date:o,value:i,src:"Expa v1.0.19"});let s=document.querySelector(".webix_log-block");s&&s.querySelectorAll(".webix_list_item").forEach((function(e,t){n=t}));let l=document.querySelectorAll(".webix_list_item")[n];"error"==e&&(void 0!==l&&l.style.setProperty("color","red","important"),"wxi-eye"==$$("webix_log-btn").config.icon&&($$("logLayout").config.height=90,$$("logLayout").resize(),$$("webix_log-btn").setValue(2),$$("webix_log-btn").config.icon="wxi-eye-slash",$$("webix_log-btn").refresh(),t("LogVisible",JSON.stringify("show"))))}catch(e){console.log(e),r("006-000",e)}}let n=0;const o={id:"logLayout",height:80,rows:[{template:"<div class='webix_log-headline'>Системные сообщения</div>",height:30},{id:"logBlock-list",css:"webix_log-block",view:"list",template:"#date# — #value#  (Источник: #src#)",data:[],on:{onAfterLoad:function(){try{i("success","Интерфейс загружен")}catch(e){console.log(e),r("006-000",e)}},onAfterAdd:function(e,t){"wxi-eye"==$$("webix_log-btn").config.icon?(""==$$("webix_log-btn").config.badge&&(n=0),n++,$$("webix_log-btn").config.badge=n,$$("webix_log-btn").setValue(1),$$("webix_log-btn").refresh()):"wxi-eye-slash"==$$("webix_log-btn").config.icon&&(n=0,$$("webix_log-btn").config.badge="",$$("webix_log-btn").setValue(2),$$("webix_log-btn").refresh())}}}]};function r(e,t,i=!1){return $$("webix_log-btn").setValue(2),n=0,k("error",i?"ОШИБКА "+e+": "+t:"ОШИБКА "+e+": "+t.stack,!0)}function s(e,t,i,o){return $$("webix_log-btn").setValue(2),n=0,k("error","ОШИБКА "+e+": СТАТУС: "+t+" "+i+". ПОДРОБНОСТИ: "+o,!0)}let l,a,c,u,d="",h=!1;function f(e,t,i,n){let o=[];if("get"==i)if("refresh"==n)try{e.forEach(((e,t)=>{e.id.includes("customCombo")?o.push(e.name+"="+$$(e.id).getText()):(e.id.includes("customInputs")||e.id.includes("customDatepicker"))&&o.push(e.name+"="+$$(e.id).getValue())})),webix.ajax(t+"?"+o.join("&"),{success:function(e,t,i){try{$$("table-view").clearAll(),0!==(t=t.json().content).length?($$("table-view").hideOverlay("Ничего не найдено"),$$("table-view").parse(t)):$$("table-view").showOverlay("Ничего не найдено"),l=$$("table-view").count(),$$("table-view-findElements").setValues(l.toString())}catch(e){console.log(e),r("009-000",e)}},error:function(e,t,i){s("009-000",i.status,i.statusText,i.responseURL),$$("table-newAddBtnId")&&!$$("table-newAddBtnId").isEnabled()&&$$("table-newAddBtnId").enable()}}).catch((e=>{console.log(e),s("009-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),r("009-000",e)}else"download"==n&&webix.ajax().response("blob").get(t,(function(e,t,i){try{webix.html.download(t,"table.docx")}catch(e){console.log(e),r("009-000",e)}})).catch((e=>{console.log(e),s("009-000",e.status,e.statusText,e.responseURL)}));else if("post"==i)try{e.forEach(((e,t)=>{e.id.includes("customUploader")&&$$(e.id).send((function(t){"e"==t.err_type?($$("table-view").parse($$(e.id).getValue()),k("error",t.err,!0)):"i"==t.err_type?(k("success",t.err,!0),$$("table-view").refresh()):"x"==t.err_type&&k("debug",t.err,!0)}))}))}catch(e){console.log(e),r("009-000",e)}}function p(e){return new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get("/init/default/api/"+e).then((function(e){try{e=e.json().content;let t,i=[];return e.forEach(((e,n)=>{let o=0;for(;o<=Object.values(e).length;){if("string"==typeof Object.values(e)[o]){t=Object.keys(e)[o];break}o++}if(null==e[t])for(;o<=Object.values(e).length;){if("number"==typeof Object.values(e)[1]){t=Object.keys(e)[1];break}o++}i.push({id:e.id,value:e[t]})})),i}catch(e){console.log(e),r("009-000",e)}})).catch((e=>{console.log(e),s("009-000",e.status,e.statusText,e.responseURL)}))}}})}function b(e,t,i,n,o=!1){d=i;let c=$$("tree").getItem(i);try{if($$(e).clearAll(),null==c)k("error","Данные не найдены");else{let t;if("table-view"==e){let e=$$("table-view-filterIdView").getParentView();$$("customInputs")&&e.removeView($$("customInputs"))}webix.ajax().get("/init/default/api/fields.json").then((function(c){let u=c.json().content;u.treeTemplate={fields:{id:{type:"id",unique:!1,notnull:!1,length:512,label:"Id",comment:null,default:"None"},pid:{type:"reference trees",unique:!1,notnull:!1,length:512,label:"Родитель",comment:null,default:"None"},owner:{type:"reference auth_user",unique:!1,notnull:!1,length:512,label:"Владелец",comment:null,default:"None"},ttype:{type:"integer",unique:!1,notnull:!1,length:512,label:"Тип",comment:"Тип записи|1=системная;2=пользовательская|Перечисление",default:"1"},name:{type:"string",unique:!1,notnull:!1,length:100,label:"Наименование",comment:null,default:""},descr:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Описание",comment:null,default:""},value:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Значение",comment:null,default:""},cdt:{type:"datetime",unique:!1,notnull:!1,length:512,label:"Создано",comment:null,default:"now"}},singular:"Классификатор-пример",ref_name:"name",plural:"Классификаторы-пример",type:"treeConf"};let b,$,m=(c=u[i]).fields,g=Object.keys(c.fields),w=[];try{if(o){let e=i.search("-single");i=i.slice(0,e)}g.forEach((function(e){if(m[e].type.includes("reference")){let t=m[e].type.slice(10);m[e].editor="combo",m[e].collection=p(t),m[e].template=function(e,t,i,n){let o=n.collection.getItem(e[n.id]);return o?o.value:""}}else"datetime"==m[e].type?(m[e].format=webix.i18n.fullDateFormatStr,m[e].editor="date"):"string"==m[e].type||"text"==m[e].type?m[e].editor="text":"integer"==m[e].type?(m[e].editor="text",m[e].numberFormat="1 111"):"boolean"==m[e].type&&(m[e].editor="combo",m[e].collection=[{id:1,value:"Да"},{id:2,value:"Нет"}]);m[e].id=e,m[e].fillspace=!0,m[e].header=m[e].label,"id"==m[e].id&&(m[e].hidden=!0),w.push(m[e])})),$$(e).refreshColumns(w)}catch(e){console.log(e),r("009-000",e)}h=!1;try{w.forEach((function(e,t){"action"==e.type&&"detail"==c.actions[e.id].rtype&&(h=!0,b=t,$=e.id)})),void 0!==$&&(a=c.actions[$].url,h)&&($$(e).config.columns.splice(0,0,{id:"action-first"+b,maxWidth:130,header:"Подробнее",template:"<span class='webix_icon wxi-angle-down'></span> "}),$$(e).refreshColumns())}catch(e){console.log(e),r("009-000",e)}try{if(c.inputs){let i=Object.keys(c.inputs),n=[],o=[],l=c.inputs;i.forEach(((t,i)=>{if("string"==l[t].type)n.push({view:"text",placeholder:l[t].label,id:"customInputs"+i,maxWidth:300,minWidth:150,height:48,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",l[t].comment)}}});else if("apiselect"==l[t].type){let e=new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get("/init/default/api/"+l[t].apiname).then((function(e){let t=e.json().content,i=[];try{return void 0!==t[0].name?t.forEach((function(e,t){i.push({id:t+1,value:e.name})})):t.forEach((function(e,t){i.push({id:t+1,value:e})})),i}catch(e){console.log(e),r("009-000",e)}})).catch((e=>{console.log(e),s("009-000",e.status,e.statusText,e.responseURL)}))}}});n.push({view:"combo",width:250,height:48,id:"customCombo"+i,placeholder:l[t].label,labelPosition:"top",options:{data:e},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",l[t].comment)}}})}else if("submit"==l[t].type||"button"==l[t].type){let r=l[t].action,s=c.actions[r];if("DELETE"==s.verb&&"submit"!==r){let t=$$(e).getColumns().length;$$(e).config.columns.splice(t,0,{id:"action"+i,header:"Действие",maxWidth:100,template:"{common.trashIcon()}"}),$$(e).refreshColumns()}else"DELETE"==s.verb?n.push({view:"button",id:"customBtnDel"+i,css:"webix_danger",type:"icon",icon:"wxi-trash",inputHeight:48,height:48,width:100,value:l[t].label,click:function(e){f(o,s.url,"delete")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",l[t].comment)}}}):n.push({view:"button",css:"webix_primary",id:"customBtn"+i,inputHeight:48,height:48,minWidth:100,maxWidth:550,value:l[t].label,click:function(e){"GET"==s.verb?"refresh"==s.rtype?f(o,s.url,"get","refresh"):"download"==s.rtype&&f(o,s.url,"get","download"):"POST"==s.verb?f(o,s.url,"post"):"download"==s.verb&&f(o,s.url,"get","download")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",l[t].comment)}}})}else"upload"==l[t].type?n.push({view:"uploader",value:"Upload file",id:"customUploader"+i,height:48,autosend:!1,upload:c.actions.submit.url,label:l[t].label,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",l[t].comment)}}}):"datetime"==l[t].type?n.push({view:"datepicker",format:"%d.%m.%Y %H:%i:%s",placeholder:l[t].label,id:"customDatepicker"+i,timepicker:!0,labelPosition:"top",width:300,minWidth:100,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",l[t].comment)}}}):"checkbox"==l[t].type&&n.push({view:"checkbox",id:"customСheckbox"+i,minWidth:220,css:"webix_checkbox-style",labelRight:l[t].label,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",l[t].comment)}}});n.push({width:10})})),n.forEach(((e,t)=>{void 0!==e.id&&("text"==e.view?o.push({id:e.id,name:"substr"}):"combo"==e.view?o.push({id:e.id,name:"valtype"}):("uploader"==e.view||"datepicker"==e.view)&&o.push({id:e.id}))})),t={id:"customInputs",css:"webix_custom-inp",cols:n};let a=$$("table-view-filterIdView").getParentView();$$(a.config.id).addView(t,2)}}catch(e){console.log(e),r("009-000",e)}function v(t){$$(t).load({$proxy:!0,load:function(t,i){return webix.ajax().get("/init/default/api/"+d,{success:function(t,i,o){try{$$(e).clearAll(),$$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable(),$$("table-filterId").isEnabled()||$$("table-filterId").enable(),$$("table-exportBtn").isEnabled()||$$("table-exportBtn").enable(),0!==(i=i.json().content).length?($$(e).hideOverlay("Ничего не найдено"),$$(e).parse(i)):($$(e).showOverlay("Ничего не найдено"),$$(e).clearAll()),l=$$(e).count(),$$(n).setValues(l.toString()),"table"==e&&$$("table-findElements").setValues(l.toString())}catch(e){console.log(e),r("009-000",e)}},error:function(e,t,i){s("009-000",i.status,i.statusText,i.responseURL),l="-";try{$$(n).setValues(l.toString()),$$("table-findElements").setValues(l.toString()),$$("table-newAddBtnId").isEnabled()&&$$("table-newAddBtnId").disable(),$$("table-filterId")&&$$("table-filterId").disable(),$$("table-exportBtn")&&$$("table-exportBtn").disable()}catch(e){console.log(e),r("009-000",e)}}}).catch((e=>{console.log(e),s("009-000",e.status,e.statusText,e.responseURL)}))}})}o&&(d=i),$$("table")?v("table"):$$("table-view")&&v("table-view"),c.autorefresh&&setInterval((function(){v()}),5e4)})).catch((e=>{console.log(e),s("009-000",e.status,e.statusText,e.responseURL),$$("btnFilterSubmit")&&$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").disable()}))}}catch(e){console.log(e),r("009-000",e)}}function $(e,t=!1){function i(e,t,i=!1){webix.ajax().get(e,{success:function(i,n,o){let s=[{type:"wide",rows:[]}],l=n.json().charts,a={};try{if($$("dashboard-tool")&&$$("dashboardTool").removeView($$("dashboard-tool")),$$("dash-template")&&$$("dash-template").getParentView().removeView($$("dash-template")),$$("dashBodyScroll")&&$$("dashBodyScroll").getParentView().removeView($$("dashBodyScroll")),null==l)$$("dashboardTool").addView({view:"scrollview",id:"dashboard-tool",borderless:!0,css:{margin:"20px!important",height:"50px!important"},body:{view:"flexlayout",rows:[]}},0),$$("dashboardTool").addView({rows:[{template:"",id:"dash-template",css:"webix_style-template-count webix_dash-title",borderless:!1,height:40}]},1),$$("dashboardInfoContainer").addView({view:"scrollview",scroll:"auto",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",borderless:!0,body:{view:"flexlayout",rows:[]}}]}}),k("error","Ошибка при загрузке данных",!0);else{let e;l.forEach((function(e,t){a=e.title,delete e.title,e.borderless=!0,e.minWidth=250,s[0].rows.push({css:"webix_dash-chart-headline",rows:[{template:a,borderless:!0,css:{"font-weight":"400!important","font-size":"17px!important"},height:35},e]})})),d.includes("single")&&(d=d.slice(0,d.search("-single"))),C.forEach((function(t,i){t.id==d&&(e=t.name)})),$$("dashboardTool").addView({id:"dashboard-tool",padding:20,minWidth:250,rows:[{rows:[{template:"Фильтр",height:30,css:"webix_dash-filter-headline",borderless:!0}]},{rows:t}]}),$$("dashboardInfoContainer").addView({rows:[{template:e,id:"dash-template",css:"webix_style-template-count webix_dash-title",borderless:!1,height:75},{view:"scrollview",scroll:"auto",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",rows:s}]}}]})}"wxi-eye"==$$("webix_log-btn").config.icon?($$("logLayout").config.height=90,$$("logLayout").resize(),$$("logLayout").config.height=5,$$("logLayout").resize()):($$("logLayout").config.height=5,$$("logLayout").resize(),$$("logLayout").config.height=90,$$("logLayout").resize()),(e.includes("?")||e.includes("sdt")&&e.includes("edt"))&&k("success","Данные обновлены",!0)}catch(e){console.log(e),r("009-004",e)}},error:function(e,t,i){s("009-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("009-000",e.status,e.statusText,e.responseURL)}))}try{$$("dashBodyScroll")&&$$("dashBodyScroll").getParentView().removeView($$("dashBodyScroll")),$$("dashBodyScroll")||webix.ajax().get("/init/default/api/fields",{success:function(n,o,s){let l,a,c,u=[];o=o.json().content;try{if(t){let t=e.search("-single");e=e.slice(0,t)}if(Object.values(o).forEach((function(t,i){t.nameObj=Object.keys(o)[i],t.nameObj==e&&(c=t)})),t){let e=c.inputs;Object.keys(e),Object.values(e).forEach((function(t,n){"datetime"==t.type&&3==t.order?(Object.keys(e)[n],u.push({width:200,id:"datepicker-containersdt",rows:[{template:"Начиная с:",height:30,borderless:!0,css:"webix_template-datepicker"},{view:"datepicker",format:"%d.%m.%Y",value:new Date,id:"dashDatepicker_sdt",placeholder:t.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",t.comment)}}},{height:10},{view:"datepicker",format:"%H:%i:%s",id:"dashDatepicker_sdt-time",placeholder:"Время",height:48,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}},{height:20},{template:"Заканчивая:",height:30,borderless:!0,css:"webix_template-datepicker"},{view:"datepicker",format:"%d.%m.%Y",value:new Date,id:"dashDatepicker_edt",placeholder:t.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",t.comment)}}},{height:10},{view:"datepicker",format:"%H:%i:%s",id:"dashDatepicker_edt-time",placeholder:"Время",height:48,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",hotkey:"enter",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}}]})):"submit"==t.type&&(l=t.action,a=c.actions[l],u.push({rows:[{height:10},{view:"button",css:"webix_primary",id:"dashBtn"+n,inputHeight:48,height:48,minWidth:100,maxWidth:200,value:t.label,click:function(){let e,t=[],o=webix.Date.dateToStr("%d.%m.%Y"),r=[],s=webix.Date.dateToStr("%H:%i:%s"),l="",c="";if(u.forEach((function(e,t){e.id.includes("container")&&$$(e.id).getChildViews().forEach((function(e,t){e.config.id.includes("sdt")?l=e.config.id.includes("time")?l.concat(" "+s($$(e.config.id).getValue())):o($$(e.config.id).getValue()):e.config.id.includes("edt")&&(c=e.config.id.includes("time")?c.concat(" "+s($$(e.config.id).getValue())):o($$(e.config.id).getValue()))}))})),t.push("sdt="+l),t.push("edt="+c),r.push(l),r.push(c),t.length>0&&r[0]&&r[1]){let o=webix.Date.dateToStr("%Y/%m/%d %H:%i:%s");webix.filters.date.greater(o(r[0]),o(r[1]))&&r[0]!=r[1]?k("error","Начало периода больше, чем конец",!0):(e=a.url+"?"+t.join("&"),$$("dashboard-charts")&&$$("dashboardBody").removeView($$("dashboard-charts")),$$("dashboard-charts")||i(e,u,!0),$$("dashBtn"+n).disable(),setInterval((function(){$$("dashBtn"+n).enable()}),1e4))}else k("error","Не все поля заполнены",!0)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",t.comment)}}},{}]}))})),i(c.actions.submit.url,u),c.autorefresh&&setInterval((function(){i(c.actions.submit.url,u)}),5e4)}else{let e=o;Object.values(e).forEach((function(e,t){if("dashboard"==e.type&&e.nameObj==d){let t=e.inputs;Object.values(t).forEach((function(n,o){"datetime"==n.type&&3==n.order?(Object.keys(t)[o],u.push({width:200,id:"datepicker-containersdt",rows:[{template:"Начиная с:",height:30,borderless:!0,css:"webix_template-datepicker"},{view:"datepicker",format:"%d.%m.%Y",value:new Date,id:"dashDatepicker_sdt",placeholder:n.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",n.comment)}}},{height:10},{view:"datepicker",format:"%H:%i:%s",id:"dashDatepicker_sdt-time",placeholder:"Время",height:48,value:"00:00:00",type:"time",hotkey:"enter",seconds:!0,suggest:{type:"timeboard",hotkey:"enter",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}},{height:20},{template:"Заканчивая:",height:30,borderless:!0,css:"webix_template-datepicker"},{view:"datepicker",format:"%d.%m.%Y",value:new Date,id:"dashDatepicker_edt",placeholder:n.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",n.comment)}}},{height:10},{view:"datepicker",format:"%H:%i:%s",id:"dashDatepicker_edt-time",placeholder:"Время",height:48,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",body:{button:!0,seconds:!0,twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}}]})):"submit"==n.type&&(l=n.action,a=e.actions[l],u.push({rows:[{height:10},{view:"button",css:"webix_primary",id:"dashBtn"+o,hotkey:"enter",inputHeight:48,height:48,minWidth:100,maxWidth:200,value:n.label,click:function(){let e,t=[],n=webix.Date.dateToStr("%d.%m.%Y"),r=[],s=webix.Date.dateToStr("%H:%i:%s"),l="",c="";if(u.forEach((function(e,t){e.id.includes("container")&&$$(e.id).getChildViews().forEach((function(e,t){e.config.id.includes("sdt")?l=e.config.id.includes("time")?l.concat(" "+s($$(e.config.id).getValue())):n($$(e.config.id).getValue()):e.config.id.includes("edt")&&(c=e.config.id.includes("time")?c.concat(" "+s($$(e.config.id).getValue())):n($$(e.config.id).getValue()))}))})),t.push("sdt="+l),t.push("edt="+c),r.push(l),r.push(c),t.length>0&&r[0]&&r[1]){let n=webix.Date.dateToStr("%Y/%m/%d %H:%i:%s");webix.filters.date.greater(n(r[0]),n(r[1]))&&r[0]!=r[1]?k("error","Начало периода больше, чем конец",!0):(e=a.url+"?"+t.join("&"),$$("dashboard-charts")&&$$("dashboardBody").removeView($$("dashboard-charts")),i(e,u,!0),$$("dashBtn"+o).disable(),setInterval((function(){$$("dashBtn"+o).enable()}),1e4))}else k("error","Не все поля заполнены",!0)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",n.comment)}}},{}]}))})),i(e.actions.submit.url,u),e.autorefresh&&setInterval((function(){i(c.actions.submit.url,u)}),5e4)}}))}}catch(e){console.log(e),r("009-000",e)}},error:function(e,t,i){console.log(i),s("009-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("009-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),r("009-000",e)}}function m(){const e={view:"toolbar",id:"header",padding:10,css:"webix_header-style",elements:[{cols:[{view:"button",type:"icon",id:"collapseBtn",icon:"wxi-angle-double-left",css:"webix_collapse",title:"текст",height:45,width:40,click:function(){try{$$("tree").isVisible()?(this.config.icon="wxi-angle-double-right",this.refresh(),$$("tree").hide(),$$("sideMenuResizer")&&$$("sideMenuResizer").hide()):($$("tree").show(),this.config.icon="wxi-angle-double-left",this.refresh(),window.innerWidth>=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").show())}catch(e){console.log(e),r("009-000",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Видимость бокового меню")}}},{view:"label",label:"<img src='/init/static/images/expalogo.png' style='height:30px; margin: 10px;'>",height:30}]},{},{view:"search",placeholder:"Поиск",css:"searchTable",maxWidth:250,minWidth:40},{view:"button",id:"webix_log-btn",type:"icon",icon:"wxi-eye-slash",height:48,badge:0,width:60,css:"webix_log-btn",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть системные сообщения")},onChange:function(){let e=$$("logBlock-list").getLastId();2==this.getValue()&&(this.config.badge="",$$("logBlock-list").showItem(e))}},click:function(){try{"wxi-eye-slash"==this.config.icon?($$("logLayout").config.height=5,$$("webix_log-btn").setValue(1),$$("logLayout").resize(),this.config.icon="wxi-eye",this.refresh(),t("LogVisible",JSON.stringify("hide")),$$("webix_log-btn").config.badge="",$$("webix_log-btn").refresh()):"wxi-eye"==this.config.icon&&($$("logLayout").config.height=90,$$("webix_log-btn").setValue(2),$$("logLayout").resize(),this.config.icon="wxi-eye-slash",this.refresh(),t("LogVisible",JSON.stringify("show")))}catch(e){console.log(e),r("005-000",e)}}},{view:"button",id:"button-context-menu",type:"icon",disabled:!0,icon:"wxi-user",height:48,width:60,popup:{view:"contextmenu",id:"contextmenu",css:"webix_contextmenu",data:[],on:{onItemClick:function(e,t,i){try{let t;if(t=window.location.host.includes("localhost:3000")?"/index.html/logout":"/init/default/spaw/logout","logout"==e){if($$("table-editForm")&&$$("table-editForm").isDirty()||$$("cp-form")&&$$("cp-form").isDirty())return E().then((function(e){if(1==e)window.location.replace(t);else if(2==e){if(!$$("table-editForm").validate())return k("error","Заполните пустые поля",!0),!1;$$("table-editForm").getValues().id?w():v(),window.location.replace(t)}})),!1;window.location.replace(t)}}catch(e){console.log(e),r("005-000",e)}}}},on:{onItemClick:function(){try{!function(e,i){try{let n=(i=window.location.href).search("//localhost:3000/index.html");i=i.slice(n),console.log(i);let o,r,s=i.slice(i.lastIndexOf("/")+1);e.forEach((function(e,t){e.id==s&&(o=e.name)})),void 0!==o&&(r={tableName:o,tableId:s,href:i},t("userLocation",JSON.stringify(r)))}catch(e){console.log(e),r("010-000",e)}}(C,void 0)}catch(e){console.log(e),r("005-000",e)}}}}]};return e}function g(){let e=$$("tree").getSelectedItem().id;c=0==e.length?void 0:e}function w(e=!1){try{g();let t=$$("table-editForm").getValues();$$("table-editForm").validate()?t.id&&webix.ajax().put("/init/default/api/"+c+"/"+t.id,t,{success:function(){$$("table").updateItem(t.id,t),k("success","Данные сохранены",!0),x(),_(),$$("table").clearSelection(),e?($$("table").filter(!1),y("table-editForm"),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show()):($$("inputsTable")&&$$("inputsTable").hide(),$$("table-newAddBtnId").enable(),$$("EditEmptyTempalte")&&!$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").show())},error:function(e,t,i){s("003-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("003-011",e.status,e.statusText,e.responseURL)})):k("error","Заполните пустые поля",!0)}catch(e){r("003-000",e)}}function v(){try{if(g(),$$("table-editForm").validate())if($$("table-editForm").isDirty()){let e=$$("table-editForm").getValues();e.id=webix.uid(),webix.ajax().post("/init/default/api/"+c,e,{success:function(){$$("table").add(e),x(),_(),$$("inputsTable")&&$$("inputsTable").hide(),$$("table-newAddBtnId").enable(),$$("EditEmptyTempalte")&&!$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").show(),k("success","Данные успешно добавлены",!0)},error:function(e,t,i){s("003-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("003-001",e.status,e.statusText,e.responseURL)}))}else k("debug","Форма пуста");else k("error","Заполните пустые поля",!0)}catch(e){r("003-000",e)}}function y(e,t=1){try{let i=$$("table").getColumns();if(0==Object.keys($$(e).elements).length){let n=[];i.forEach(((t,i)=>{if("datetime"==t.type)n.push({view:"datepicker",format:"%d.%m.%Y %H:%i:%s",id:t.id,name:t.id,label:t.label,placeholder:"дд.мм.гг",timepicker:!0,labelPosition:"top",on:{onItemClick:function(){$$(e).clearValidation()}}});else if(t.type.includes("reference")){let i,o=t.type.slice(10);C.forEach((function(e,t){e.id==o&&(i=e.name)})),n.push({cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id,name:t.id,labelPosition:"top",options:{data:p(o)},on:{onItemClick:function(){$$(e).clearValidation()}}},{view:"button",css:{"vertical-align":"bottom!important",height:"38px!important"},type:"icon",icon:"wxi-angle-right",inputHeight:38,width:40,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Перейти в таблицу «"+i+"»")}},click:function(){try{$$("tree").select(o)}catch(e){console.log(e),k("error","Таблица не найдена",!0),$$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide()}}}]})}else t.type.includes("boolean")?n.push({cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id,name:t.id,labelPosition:"top",options:[{id:1,value:"Да"},{id:2,value:"Нет"}],on:{onItemClick:function(){$$(e).clearValidation()}}}]}):t.type.includes("integer")?n.push({cols:[{view:"text",name:t.id,id:t.id,label:t.label,labelPosition:"top",invalidMessage:"Поле поддерживает только числовой формат",on:{onKeyPress:function(){$$(e).clearValidation()}},validate:function(e){return!isNaN(1*e)}}]}):n.push({view:"text",name:t.id,id:t.id,label:t.label,labelPosition:"top",on:{onKeyPress:function(){$$(e).clearValidation()}}})}));let o={margin:8,id:"inputsTable",rows:n};return"table-editForm"==e&&$$("table-delBtnId").enable(),$$(e).addView(o,t)}$$(e).clear(),$$(e).clearValidation(),"table-editForm"==e&&$$("table-delBtnId").enable(),$$("inputsTable").show()}catch(e){r("003-000",e)}}function x(){$$("table-editForm").clear(),$$("table-editForm").clearValidation(),_()}function _(){$$("table-saveNewBtn").isVisible()?$$("table-saveNewBtn").hide():$$("table-saveBtn").isVisible()&&$$("table-saveBtn").hide(),$$("table-delBtnId").disable()}function E(){return webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"})}function k(e,t,n=!1,o=!1){o&&(webix.message.position="bottom",webix.message({type:e,text:t})),n&&i(e,t)}try{u={view:"form",id:"table-editForm",css:"webix_form-edit",minHeight:350,minWidth:210,width:320,scroll:!0,elements:[{minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{margin:5,rows:[{margin:5,cols:[{view:"button",id:"table-newAddBtnId",height:48,minWidth:90,hotkey:"shift",value:"Новая запись",click:function(){try{$$("table-editForm").isDirty()?E().then((function(e){if(1==e)$$("table").filter(!1),y("table-editForm"),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show();else if(2==e){if(!$$("table-editForm").validate())return k("error","Заполните пустые поля",!0),!1;w(!0)}})):($$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide(),$$("table").clearSelection(),$$("table").filter(!1),$$("table").hideOverlay("Ничего не найдено"),y("table-editForm"),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show(),$$("table-newAddBtnId").disable())}catch(e){r("003-000",e)}}},{view:"button",id:"table-delBtnId",disabled:!0,height:48,minWidth:90,width:100,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"wxi-trash",click:function(){try{g(),("Запись будет удалена",webix.confirm({width:300,ok:"Да",cancel:"Отмена",title:"Запись будет удалена",text:"Вы уверены, что хотите продолжить?"})).then((function(){$$("table").remove($$("table-editForm").getValues().id);let e=$$("table-editForm").getValues();webix.ajax().del("/init/default/api/"+c+"/"+e.id+".json",e,{success:function(){x(),_(),$$("inputsTable").hide(),k("success","Данные успешно удалены",!0)},error:function(e,t,i){s("003-002",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("003-002",e.status,e.statusText,e.responseURL)}))}))}catch(e){r("003-000",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить запись из таблицы")}}}]}]},{margin:10,rows:[{view:"button",id:"table-saveBtn",hidden:!0,value:"Сохранить",height:48,css:"webix_primary",click:function(){w()},hotkey:"enter"},{view:"button",id:"table-saveNewBtn",value:"Сохранить новую запись",hidden:!0,height:48,hotkey:"enter",css:"webix_primary",click:v},{id:"EditEmptyTempalte",template:"<div style='color:#858585;font-size:13px!important'>Добавьте новую запись или выберите существующую из таблицы</div>",borderless:!0}]}]}],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}}}catch(e){alert("Ошибка при выполнении "+e),console.log(e),window.stop()}const A={id:"dashboardTool",css:"webix_dashTool",rows:[]};function I(e,t,i,n,o,s,l,a=!1){function c(e,t,i){let n,o=e.type.slice(10);function s(s){try{if(n=$$(e.id+"_filter_rows").getChildViews().length,"text"==i)return{view:"text",placeholder:"Введите текст",name:e.id+"_filter-child-"+s+"-"+n,id:e.id+"_filter-child-"+s+"-"+n,on:{onKeyPress:function(){$$(t).clearValidation(),$$("btnFilterSubmit")&&!$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").enable()}}};if("combo"==i)return{view:"combo",name:e.id+"_filter-child-"+s+"-"+n,id:e.id+"_filter-child-"+s+"-"+n,placeholder:"Выберите вариант",options:{data:getComboOptions(o)},on:{onItemClick:function(){$$(t).clearValidation(),$$("btnFilterSubmit").enable()}}};if("boolean"==i)return{view:"combo",name:e.id+"_filter-child-"+s+"-"+n,id:e.id+"_filter-child-"+s+"-"+n,placeholder:"Выберите вариант",options:[{id:1,value:"Да"},{id:2,value:"Нет"}],on:{onItemClick:function(){$$(t).clearValidation(),$$("btnFilterSubmit").enable()}}};if("datepicker"==i)return{view:"datepicker",name:e.id+"_filter-child-"+s+"-"+n,id:e.id+"_filter-child-"+s+"-"+n,format:"%d.%m.%Y %H:%i:%s",placeholder:"дд.мм.гг",timepicker:!0,on:{onItemClick:function(){$$(t).clearValidation(),$$("btnFilterSubmit").enable()}}};if("integer"==i)return{view:"text",name:e.id+"_filter-child-"+s+"-"+n,id:e.id+"_filter-child-"+s+"-"+n,invalidMessage:"Поле поддерживает только числовой формат",placeholder:"Введите число",on:{onItemClick:function(){$$(t).clearValidation(),$$("btnFilterSubmit").enable()}},validate:function(e){return!isNaN(1*e)}}}catch(e){console.log(e),r("012-000",e)}}function l(e,t){try{let i=$$(e);if(t.includes("eql"))return i.setValue("=");if(t.includes("notEqual"))return i.setValue("!=");if(t.includes("less"))return i.setValue("<");if(t.includes("more"))return i.setValue(">");if(t.includes("mrEqual"))return i.setValue(">=");if(t.includes("lsEqual"))i.setValue("<=");else if(t.includes("contains"))return i.setValue("⊆")}catch(e){console.log(e),r("012-000",e)}}function a(){return webix.once((function(){"combo"==i?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"})):"text"==i?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"содержит",id:"operations_contains"})):"datepicker"==i?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"<",id:"operations_less"}),this.add({value:">",id:"operations_more"}),this.add({value:">=",id:"operations_mrEqual"}),this.add({value:"<=",id:"operations_lsEqual"})):"integer"==i&&(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"<",id:"operations_less"}),this.add({value:">",id:"operations_more"}),this.add({value:">=",id:"operations_mrEqual"}),this.add({value:"<=",id:"operations_lsEqual"}),this.add({value:"содержит",id:"operations_contains"}))}))}return{id:e.id+"_filter_container-btns",css:{"margin-top":"27px!important"},hidden:!0,cols:[{view:"button",id:e.id+"_filter-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){l(e.id+"_filter-btnFilterOperations",t)},onAfterLoad:a()}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns",value:"+",id:e.id+"_filter_condition",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[{value:"и",id:"add_and"},{value:"или",id:"add_or"}],on:{onMenuItemClick(t){let i=$$(e.id+"_filter_rows").getChildViews().length;t.includes("and")?$$(e.id+"_filter_rows").addView({id:e.id+"_filter-container-child-"+i,padding:5,rows:[{template:"<div style='color:var(--primary)'>+ и</div>",height:30,borderless:!0},{cols:[s("operAnd"),{id:e.id+"_filter_container-btns"+i,cols:[{view:"button",id:e.id+"_filter-child-operAnd-"+i+"-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){l(e.id+"_filter-child-operAnd-"+i+"-btnFilterOperations",t)},onAfterLoad:a()}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns webix_danger",id:e.id+"_filter-"+i+"_remove",type:"icon",icon:"wxi-trash",inputHeight:38,width:40,click:function(){try{popupExec("Поле фильтра будет удалено").then((function(){$$(e.id+"_filter_rows").removeView($$(e.id+"_filter-container-child-"+i)),$$(e.id+"_filter_rows").refresh(),k("success","Поле удалено")}))}catch(e){k("error","Ошибка удаления поля",!0)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить поле фильтра")}}}]}]}]},i):t.includes("or")&&$$(e.id+"_filter_rows").addView({id:e.id+"_filter-container-child-operOr-"+i,padding:5,rows:[{template:"<div style='color:var(--primary)'>+ или</div>",height:30,borderless:!0},{cols:[s("operOr"),{id:e.id+"_filter_container-btns"+i,cols:[{view:"button",id:e.id+"_filter-child-operOr-"+i+"-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){l(e.id+"_filter-child-operOr-"+i+"-btnFilterOperations",t)},onAfterLoad:a()}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns webix_danger",id:e.id+"_filter-operOr-"+i+"_remove",type:"icon",icon:"wxi-trash",inputHeight:38,width:40,click:function(){try{popupExec("Поле фильтра будет удалено").then((function(){$$(e.id+"_filter_rows").removeView($$(e.id+"_filter-container-child-operOr-"+i)),k("success","Поле удалено")}))}catch(e){k("error","Ошибка удаления поля",!0)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить поле фильтра")}}}]}]}]},i)}}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить ещё вариант поля")}}}]}}return{rows:[{css:"webix_filterBar",padding:17,height:80,margin:5,cols:[{view:"button",width:50,type:"icon",id:l,hidden:a,icon:"wxi-filter",css:"webix_btn-filter",title:"текст",height:50,click:function(){try{$$(s).clearSelection();let e=document.querySelector(".webix_btn-filter");e.classList.contains("webix_primary")?($$("filterTableForm").hide(),$$("table-editForm").show(),e.classList.add("webix_secondary"),e.classList.remove("webix_primary"),$$(i).hide()):($$("filterTableForm").show(),$$("table-editForm").hide(),0!==$$("filterTableForm").getChildViews()&&function(e,t=1){try{let i=$$("table").getColumns();if(0==Object.keys($$(e).elements).length){let n=[];i.forEach(((t,i)=>{if("datetime"==t.type)n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"datepicker",format:"%d.%m.%Y %H:%i:%s",id:t.id+"_filter",name:t.id+"_filter",hidden:!0,label:t.label,placeholder:"дд.мм.гг",timepicker:!0,labelPosition:"top",on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},c(t,e,"datepicker")]}]});else if(t.type.includes("reference")){let i=t.type.slice(10);n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id+"_filter",hidden:!0,name:t.id+"_filter",labelPosition:"top",options:{data:getComboOptions(i)},on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},c(t,e,"combo")]}]})}else t.type.includes("boolean")?n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id+"_filter",hidden:!0,name:t.id+"_filter",labelPosition:"top",options:[{id:1,value:"Да"},{id:2,value:"Нет"}],on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},c(t,e,"combo")]}]}):t.type.includes("integer")?n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,css:"webix_inputs-show",cols:[{view:"text",name:t.id+"_filter",id:t.id+"_filter",css:{"padding-bottom":"5px!important"},placeholder:"Введите число",hidden:!0,label:t.label,labelPosition:"top",invalidMessage:"Поле поддерживает только числовой формат",on:{onKeyPress:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}},validate:function(e){return!isNaN(1*e)}},c(t,e,"integer")]}]}):n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,css:"webix_inputs-show",cols:[{view:"text",name:t.id+"_filter",id:t.id+"_filter",css:{"passing-bottom":"5px!important"},placeholder:"Введите текст",hidden:!0,label:t.label,labelPosition:"top",on:{onKeyPress:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},c(t,e,"text")]}]})}));let o={margin:8,id:"inputsFilter",css:"webix_inputs-table-filter",rows:n};return"table-editForm"==e&&$$("table-delBtnId").enable(),$$(e).addView(o,t)}$$(e).clear(),$$(e).clearValidation(),"table-editForm"==e&&$$("table-delBtnId").enable(),$$("inputsFilter").show()}catch(e){console.log(e),r("012-000",e)}}("filterTableForm",3),e.classList.add("webix_primary"),e.classList.remove("webix_secondary"),$$(i).show())}catch(e){console.log(e),r("012-000",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть фильтры")}}},{view:"button",maxWidth:200,value:"<span class='webix_icon wxi-pencil'></span><span style='padding-left: 4px'>Редактор таблицы</span>",id:i,hidden:!0,css:"webix_btn-edit",title:"текст",height:50,click:function(){try{let e=document.querySelector(".webix_btn-filter");$$("filterTableForm").hide(),$$("table-editForm").show(),e.classList.add("webix_secondary"),e.classList.remove("webix_primary"),$$(i).hide(),this.hide()}catch(e){console.log(e),r("012-000",e)}},on:{onAfterRender:function(){"table"!==s&&this.isVisible()&&this.hide(),this.getInputNode().setAttribute("title","Редактировать таблицу")}}},{},{view:"button",width:50,type:"icon",id:t,hidden:a,icon:"wxi-download",css:"webix_btn-download",title:"текст",height:50,click:function(){webix.toExcel(s,{filename:"Table",filterHTML:!0,styles:!0}),k("success","Таблица сохранена",!0)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Экспорт таблицы")}}}]},{cols:[{view:"template",id:n,css:"webix_style-template-count",height:30,template:function(){return 0!==Object.keys($$(n).getValues()).length?"<div style='color:#999898;'> Общее количество записей: "+$$(n).getValues()+" </div>":""}},{view:"template",id:o,css:"webix_style-template-count",height:30,template:function(){return 0!==Object.keys($$(o).getValues()).length?"<div style='color:#999898;'>Видимое количество записей: "+$$(o).getValues()+" </div>":""}}]}]}}function V(e,t,i=!1){return{view:"datatable",id:e,css:"webix_table-style webix_header_border webix_data_border",resizeColumn:!0,autoConfig:!0,editable:i,editaction:"dblclick",minHeight:350,datafetch:5,datathrottle:5e3,loadahead:100,footer:!0,minWidth:500,select:!0,minColumnWidth:200,on:t,onClick:{"wxi-trash":function(){try{popupExec("Запись будет удалена").then((function(){let t=$$(e).getItem(id),i=$$("tree").getSelectedItem().id;webix.ajax().del("/init/default/api/"+i+"/"+t.id+".json",t,{success:function(){$$(e).remove($$(e).getSelectedId()),k("success","Данные успешно удалены",!0)},error:function(e,t,i){s("012-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("012-000",e.status,e.statusText,e.responseURL)}))}))}catch(e){console.log(e),r("012-000",e)}},"wxi-angle-down":function(e,t,i){try{if($$("propTableView").isVisible())$$("propTableView").hide(),$$("propResize").hide();else{let e=t.row,i=urlFieldAction.search("{"),n=urlFieldAction.slice(0,i);webix.ajax(n+e+".json",{success:function(e,t,i){try{t=t.json().content;let e=[];t.forEach((function(t,i){e.push({type:"text",id:i+1,label:t.name,value:t.value})})),$$("propTableView").define("elements",e),$$("propTableView").show(),$$("propResize").show()}catch(e){console.log(e),r("012-000",e)}},error:function(e,t,i){s("012-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("012-000",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),r("012-000",e)}}}}}let S={onBeforeLoad:function(){this.showOverlay("Загрузка...")},onAfterEditStop:function(e,t,i){try{e.value!=e.old&&($$(t.column).setValue(e.value),w())}catch(e){console.log(e),r("012-011",e)}},onAfterSelect(e){try{if($$("table-editTableBtnId").isVisible()&&$$("table-editTableBtnId").hide(),$$("table-newAddBtnId")&&$$("table-newAddBtnId").enable(),$$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide(),!$$("table-editForm").isVisible()){$$("table-editForm").show(),$$("filterTableForm").hide();let e=document.querySelector(".webix_btn-filter");e.classList.add("webix_secondary"),e.classList.remove("webix_primary")}}catch(e){console.log(e),r("012-000",e)}let t=$$("table").getItem(e);function i(){try{$$("table-editForm").setValues(t),$$("table-saveNewBtn").hide(),$$("table-saveBtn").show(),$$("table-editForm").clearValidation()}catch(e){console.log(e),r("012-000",e)}}if($$("table-editForm").isDirty())try{E().then((function(e){if(1==e)$$("table-editForm").clear(),$$("table-delBtnId").enable(),i();else if(2==e){if(!$$("table-editForm").validate())return k("error","Заполните пустые поля",!0),!1;$$("table-editForm").getValues().id?w():v(),$$("table-editForm").clear(),$$("table-delBtnId").enable(),i()}}))}catch(e){console.log(e),r("012-000",e)}else y("table-editForm"),i()},onAfterLoad:function(){try{this.hideOverlay(),_()}catch(e){console.log(e),r("012-000",e)}},onAfterDelete:function(){try{$$("table-findElements").setValues($$("table").count().toString()),this.count()||this.showOverlay("Ничего не найдено"),this.count()&&this.hideOverlay()}catch(e){console.log(e),r("012-000",e)}},onAfterAdd:function(){try{$$("table-findElements").setValues($$("table").count().toString()),this.hideOverlay()}catch(e){console.log(e),r("012-000",e)}}};const T={id:"layout-cp",cols:[{view:"form",id:"cp-form",borderless:!0,margin:5,elements:[{template:"<div>Изменение пароля</div>",css:"webix_cp-form",height:35,borderless:!0},{view:"template",id:"authName",css:"webix_userprefs-info",template:function(){return 0!==Object.keys($$("authName").getValues()).length?"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600' >"+$$("authName").getValues()+"<div>":"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀ <div style='display:inline-block;font-size:13px!important;font-weight:600'>не указано</div>"},height:50,borderless:!0},{view:"text",width:300,labelPosition:"top",type:"password",label:"Старый пароль",name:"oldPass"},{view:"text",width:300,labelPosition:"top",type:"password",label:"Новый пароль",name:"newPass"},{view:"text",width:300,labelPosition:"top",type:"password",label:"Повтор нового пароля",name:"repeatPass"},{margin:5,cols:[{view:"button",height:48,width:300,value:"Сменить пароль",css:"webix_primary",click:function(){try{if($$("cp-form").validate()){let e={op:"",np:""},t=$$("cp-form").getValues();e.np=t.newPass,e.op=t.oldPass,webix.ajax().post("/init/default/api/cp",e,{success:function(){k("success","Пароль обновлён",!0)},error:function(e,t,i){s("011-000",i.status,i.statusText,i.responseURL)}})}}catch(e){console.log(e),r("011-000",e)}}}]}],rules:{$all:webix.rules.isNotEmpty,$obj:function(e){return e.newPass!=e.repeatPass?(k("error","Новый пароль не совпадает с повтором",!0),!1):e.newPass!=e.oldPass||!$$("cp-form").isDirty()||(k("error","Новый пароль должен отличаться от старого",!0),!1)}}},{}]};let j=!1,F={userprefsOther:"",userprefsWorkspace:""};const B={rows:[{padding:{top:15,bottom:0,left:20,right:0},rows:[{view:"template",template:"<div>Настройки</div>",css:"webix_headline-userprefs",height:35,borderless:!0},{view:"template",id:"userprefsName",css:"webix_userprefs-info",template:function(){return 0!==Object.keys($$("userprefsName").getValues()).length?"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600' >"+$$("userprefsName").getValues()+"<div>":"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div><div style='display:inline-block;font-size:13px!important;font-weight:600'>не указано</div>"},height:50,borderless:!0}]},{rows:[{view:"tabbar",type:"top",id:"userprefsTabbar",css:"webix_filter-popup-tabbar",multiview:!0,options:[{value:"<span class='webix_tabbar-filter-headline'>Рабочее пространство</span>",id:"userprefsWorkspace"},{value:"<span class=webix_tabbar-filter-headline'>Другое</span>",id:"userprefsOther"}],height:50,on:{onBeforeTabClick:function(e){let t;if($$("userprefsTabbar").config.options.forEach((function(e,i){$$(e.id).isVisible()&&(t=e.id)})),j)return webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"}).then((function(i){1==i?($$("userprefsTabbar").setValue(e),j=!1,$$(t+"Form").setValues(F)):2==i&&($$("userprefsTabbar").setValue(e),j=!1)})),!1}}},{cells:[{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsWorkspace",scroll:"y",body:{view:"form",id:"userprefsWorkspaceForm",borderless:!0,elements:[{cols:[{rows:[{view:"radio",labelPosition:"top",name:"logBlockOpt",label:"Отображение блока системных сообщений",value:1,options:[{id:1,value:"Показать"},{id:2,value:"Скрыть"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть по умолчанию блок системных сообщений")},onChange:function(e,t,i){e!==t&&(j=!0)}}},{height:15},{view:"select",name:"LoginActionOpt",label:"Действие после входа в систему",labelPosition:"top",value:2,options:[{id:1,value:"Перейти на главную страницу"},{id:2,value:"Предложить вернуться на последнюю открытую страницу"},{id:3,value:"Сразу перейти на последнюю открытую страницу"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показывать/не показывать всплывающее окно при загрузке приложения")},onChange:function(e,t,i){e!==t&&(j=!0)}}}]},{}]}]}},{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsOther",scroll:"y",body:{view:"form",id:"userprefsOtherForm",borderless:!0,elements:[{view:"radio",labelPosition:"top",label:"Автообновление специфичных страниц",value:1,name:"autorefOpt",options:[{id:1,value:"Включено"},{id:2,value:"Выключено"}],on:{onChange:function(e,t){1!=e||$$("userprefsAutorefCounter").isVisible()||$$("userprefsAutorefCounter").show(),2==e&&$$("userprefsAutorefCounter").isVisible()&&$$("userprefsAutorefCounter").hide(),e!==t&&(j=!0)}}},{height:5},{view:"counter",id:"userprefsAutorefCounter",labelPosition:"top",name:"autorefCounterOpt",label:"Интервал автообновления",min:30,max:7200,on:{onChange:function(e,t){e!==t&&(j=!0);const i=$$("userprefsAutorefCounter").config.min,n=$$("userprefsAutorefCounter").config.max;e==i?(console.log("uueuue"),webix.message({type:"debug",expire:1e3,text:"Минимальное возможное значение"})):e==n&&webix.message({type:"debug",expire:1e3,text:"Максимальное возможное значение"})}}},{}],on:{}}}]},{cols:[{view:"button",value:"Сохранить настройки",height:48,css:"webix_primary"},{width:10},{view:"button",height:48,value:"Сбросить"}]}]}]};let L,R={};function O(){try{let e=$$("filterPopupTabbar").getValue();if("editFormPopupLib"==e)k("debug","Библиотека в разработке");else if("editFormScroll"==e){$$("filterLibrarySaveBtn")&&!$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").enable();let e,t,i,n=$$("editFormPopup").getValues();Object.keys(n).forEach((function(o,r){if(i=o.lastIndexOf("_"),t=o.slice(0,i),e=document.querySelectorAll(".webix_filter-inputs"),n[o])$$(o).isVisible()||(e.forEach((function(e,i){e.classList.contains(t)?(e.classList.contains("webix_show-content")||e.classList.add("webix_show-content"),e.classList.contains("webix_hide-content")&&e.classList.remove("webix_hide-content")):e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content")})),$$(o).show(),$$(o+"_container-btns")&&!$$(o+"_container-btns").isVisible()&&$$(o+"_container-btns").show()),$$("resetFilterBtn").enable(),$$("filterEmptyTempalte").isVisible()&&($$("filterEmptyTempalte").hide(),$$("filterEmptyTempalte").refresh());else if($$(o).isVisible()&&(e.forEach((function(e,i){e.classList.contains(t)&&(e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content"),e.classList.contains("webix_show-content")&&e.classList.remove("webix_show-content"))})),$$(o).hide()),$$(o+"_container-btns")&&$$(o+"_container-btns").isVisible()&&$$(o+"_container-btns").hide(),$$(o+"_rows")){let e=$$(o+"_rows").getChildViews();Object.values(e).forEach((function(e,t){e.config.id.includes("child")&&$$(o+"_rows").removeView($$(e.config.id))}))}$$(o).refresh()}));let o=0;Object.values($$("filterTableForm").elements).forEach((function(e,t){e.config.hidden||o++})),o||$$("filterEmptyTempalte").isVisible()||($$("filterEmptyTempalte").show(),$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").disable(),$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").disable()),$$("popupFilterEdit").destructor(),k("success","Рабочая область фильтра обновлена",!0)}}catch(e){$$("popupFilterEdit").destructor(),k("error","Ошибка при обновлении фильтров",!0)}}try{L={view:"form",hidden:!0,id:"filterTableForm",minHeight:350,minWidth:210,width:320,scroll:!0,elements:[{id:"form-adaptive",minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{margin:5,rows:[{responsive:"form-adaptive",margin:5,cols:[{view:"button",value:"Редактор фильтров",height:48,minWidth:140,click:function(){webix.ui({view:"popup",id:"popupFilterEdit",css:"webix_popup-filter-container",modal:!0,escHide:!0,position:"center",height:400,width:400,body:{scroll:"y",rows:[{cols:[{template:"Редактор фильтров",css:"webix_template-recover",borderless:!0,height:40},{width:150},{view:"button",id:"buttonClosePopup",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("popupFilterEdit")&&$$("popupFilterEdit").destructor()}}]},{template:"Выберите нужные поля или шаблон из библиотеки",borderless:!0,height:47},{view:"form",id:"editFormPopup",css:"webix_edit-form-popup",borderless:!0,elements:[{rows:[{view:"tabbar",type:"top",id:"filterPopupTabbar",css:"webix_filter-popup-tabbar",multiview:!0,options:[{value:"<span class='webix_tabbar-filter-headline'>Поля</span>",id:"editFormScroll"},{value:"<span class=webix_tabbar-filter-headline'>Библиотека</span>",id:"editFormPopupLib"}],height:50,on:{onAfterTabClick:function(e){!function(e){function t(e){try{"enable"==e?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():"disable"==e&&$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable()}catch(e){console.log(e),r("004-000",e)}}try{if("editFormPopupLib"==e&&(""!==$$("filterEditLib").getValue()?t("enable"):t("disable")),"editFormScroll"==e){let e=$$("editFormPopup").getValues(),i=0;Object.values(e).forEach((function(e,t){e&&i++})),t(i>0?"enable":"disable")}}catch(e){console.log(e),r("004-000",e)}}(e)}}},{height:200,cells:[{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"editFormScroll",scroll:"y",body:{id:"editFormPopupScroll",rows:[]}},{view:"form",id:"editFormPopupLib",css:"webix_multivew-cell",borderless:!0,elements:[{view:"radio",id:"filterEditLib",vertical:!0,options:[{id:"radioNoneContent",disabled:!0,value:"Сохранённых шаблонов нет"}],on:{onChange:function(){try{this.getValue()&&$$("popupFilterSubmitBtn")&&($$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable())}catch(e){console.log(e),r("004-000",e)}},onAfterRender:function(){try{Object.keys(R).length>0&&($$("filterEditLib").addOption(R),$$("filterEditLib").removeOption("radioNoneContent"))}catch(e){console.log(e),r("004-000",e)}}}}]}]},{height:20},{view:"button",id:"popupFilterSubmitBtn",height:48,minWidth:140,disabled:!0,css:"webix_primary",hotkey:"Enter",value:"Применить",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбранные фильтры будут добавлены в рабочее поле, остальные скрыты")}},click:O}]},{}]}]}}).show();let e=[{cols:[{id:"editFormPopupScrollContent",css:"webix_edit-form-popup-scroll-content",rows:[{view:"checkbox",id:"selectAll",labelRight:"<div style='font-weight:600'>Выбрать всё</div>",labelWidth:0,name:"selectAll",on:{onChange:function(){try{this.getValue()?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable(),$$("editFormPopupScrollContent").getChildViews().forEach((function(e,t){e.config.id.includes("checkbox")&&($$("selectAll").getValue()?e.config.value=1:e.config.value=0,$$(e).refresh())}))}catch(e){console.log(e),r("004-000",e)}}}}]}]}],t=[],i=$$("filterTableForm").elements;try{Object.values(i).forEach((function(e,i){t.push({id:e.config.id,label:e.config.label})}))}catch(e){console.log(e),r("004-000",e)}function n(e){try{let t=$$(e.id+"_checkbox").getParentView().getChildViews(),i=0,n=0;t.forEach((function(e,t){e.config.id.includes("checkbox")&&(e.config.value&&""!=e.config.value||i++),e.config.value&&n++})),n>0?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable(),0==i?($$("selectAll").config.value=1,$$("selectAll").refresh()):0!==$$("selectAll").config.value&&($$("selectAll").config.value=0,$$("selectAll").refresh())}catch(e){console.log(e),r("004-000",e)}}try{t.forEach((function(t,i){t.id.includes("child")||($$(t.id)&&$$(t.id).isVisible()?e[0].cols[0].rows.push({view:"checkbox",id:t.id+"_checkbox",labelRight:t.label,labelWidth:0,name:t.id,value:1,on:{onChange:function(){n(t)}}}):e[0].cols[0].rows.push({view:"checkbox",id:t.id+"_checkbox",labelRight:t.label,labelWidth:0,name:t.id,on:{onChange:function(){n(t)}}}))})),$$("editFormPopupScroll").addView({rows:e},1)}catch(e){console.log(e),r("004-000",e)}let o=0,s=$$("editFormPopupScrollContent").getChildViews();try{s.forEach((function(e,t){e.config.id.includes("checkbox")&&(e.config.value&&""!=e.config.value||o++)})),0==o&&($$("selectAll").config.value=1,$$("selectAll").refresh())}catch(e){console.log(e),r("004-000",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить/удалить фильтры")}}},{view:"button",id:"resetFilterBtn",disabled:!0,height:48,minWidth:50,width:65,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"wxi-trash",click:function(){try{let e=$$("tree").getSelectedItem().id;webix.ajax("/init/default/api/smarts?query="+e+".id >= 0&sorts="+e+".id&offset=0",{success:function(e,t,i){0!==(t=t.json().content).length?($$("table").hideOverlay("Ничего не найдено"),$$("table").clearAll(),$$("table").parse(t)):($$("table").clearAll(),$$("table").showOverlay("Ничего не найдено"));let n=$$("table").count();$$("table-idFilterElements").setValues(n.toString()),k("success","Фильтры очищены",!0)},error:function(e,t,i){s("004-000",i.status,i.statusText,i.responseURL),k("error","Ошибка очистки фильтров",!0)}}).catch((e=>{console.log(e),s("004-000",e.status,e.statusText,e.responseURL)}))}catch(e){k("error","Ошибка при очищении фильтров",!0)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Сбросить фильтры")}}}]}]},{id:"btns-adaptive",css:{"margin-top":"5px!important"},rows:[{responsive:"btns-adaptive",margin:5,cols:[{view:"button",id:"btnFilterSubmit",height:48,minWidth:70,css:"webix_primary",hotkey:"Enter",disabled:!0,value:"Применить фильтры",click:function(){let e=$$("filterTableForm").getValues(),t=[];function i(e,i,n,o,s,l=!1){let a=$$("tree").getSelectedItem().id,c=$$(n+"-btnFilterOperations").config.value;try{"parent"==s?l?"="==c?t.push("+and+"+a+"."+i+"+=+"+e):"!="==c?t.push("+and+"+a+"."+i+"+!=+"+e):"<"==c?t.push("+and+"+a+"."+i+"+<+"+e):">"==c?t.push("+and+"+a+"."+i+"+>+"+e):"<="==c?t.push("+and+"+a+"."+i+"+<=+"+e):">="==c?t.push("+and+"+a+"."+i+"+>=+"+e):"⊆"==c&&t.push("+and+"+a+"."+i+"+contains+"+e):"="==c?t.push(a+"."+i+"+=+"+e):"!="==c?t.push(a+"."+i+"+!=+"+e):"<"==c?t.push(a+"."+i+"+<+"+e):">"==c?t.push(a+"."+i+"+>+"+e):"<="==c?t.push(a+"."+i+"+<=+"+e):">="==c?t.push(a+"."+i+"+>=+"+e):"⊆"==c&&t.push(a+"."+i+"+contains+"+e):"child"==s&&("="==c?t.push("+"+o+"+"+i+"+=+"+e):"!="==c?t.push("+"+o+"+"+i+"+!=+"+e):"<"==c?t.push("+"+o+"+"+i+"+<+"+e):">"==c?t.push("+"+o+"+"+i+"+>+"+e):">="==c?t.push("+"+o+"+"+i+"+>=+"+e):"<="==c?t.push("+"+o+"+"+i+"+<=+"+e):"⊆"==c&&t.push("+"+o+"+"+i+"+contains+"+e))}catch(e){console.log(e),r("004-000",e)}}if($$("filterTableForm").validate()){let n,o,l=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s");try{Object.keys(e).sort().forEach((function(t,r){n=t,o=e[t],o&&("datepicker"==$$(t).config.view&&(o=l(e[t])),$$(t).config.text&&"Нет"==$$(t).config.text&&(o=0),t.includes("filter")&&!t.includes("condition")&&(n=t.lastIndexOf("_"),n=t.slice(0,n)),t.includes("condition")||""===e[t]||"selectAll"===t||t.includes("child")?t.includes("child")&&(t.includes("operAnd")?i(o,n,t,"and","child"):t.includes("operOr")&&i(o,n,t,"or","child")):r>0?i(o,n,t,"and","parent",!0):i(o,n,t,"and","parent"))}))}catch(e){console.log(e),r("004-000",e)}webix.ajax("/init/default/api/smarts?query="+t.join(""),{success:function(e,t,i){let n=t.json().err_type,o=t.json().err;0!==(t=t.json().content).length?($$("table").hideOverlay("Ничего не найдено"),$$("table").clearAll(),$$("table").parse(t)):($$("table").clearAll(),$$("table").showOverlay("Ничего не найдено"));let r=$$("table").count();$$("table-idFilterElements").setValues(r.toString()),"i"==n?k("success","Фильтры успшено применены",!0):"e"==n?k("error",o,!0):"x"==n&&k("error","Ошибка фильтрации данных",!0)},error:function(e,t,i){s("003-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("003-011",e.status,e.statusText,e.responseURL)}))}else k("error","Не все поля формы заполнены",!0)}},{view:"button",id:"filterLibrarySaveBtn",disabled:!0,height:48,minWidth:50,width:65,hotkey:"shift+esc",type:"icon",icon:"wxi-file",click:function(){try{webix.prompt({title:"Название шаблона",ok:"Сохранить",cancel:"Отменить",css:"webix_prompt-filter-lib",input:{required:!0,placeholder:"Введите название шаблона..."},width:350}).then((function(e){let t=e,i=$$("filterTableForm").elements,n=[];Object.values(i).forEach((function(e,t){$$(e.config.id).isVisible()&&n.push(e)})),R={id:webix.uid(),value:t},k("success","Шаблон «"+t+"»  сохранён в библиотеку",!0)})).fail((function(){}))}catch(e){console.log(e),k("error","Не удалось сохранить шаблон"),r("004-001",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Сохранить шаблон с полями в библиотеку")}}}]},{height:10},{id:"filterEmptyTempalte",template:"<div style='color:#858585;font-size:13px!important'>Добавьте фильтры из редактора</div>",borderless:!0}]}]}],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}}}catch(e){console.log(e),r("004-003",e)}e();let N=null;"http://localhost:3000/index.html#"!==window.location.href&&(N=window.location.href);let C=[],P=[];function U(e){try{e||($$("dashboards")||$$("container").addView({view:"layout",id:"dashboards",hidden:!0,scroll:"auto",rows:[{view:"scrollview",id:"dashScroll",body:{view:"flexlayout",id:"dashboardContainer",cols:[{id:"dashboardInfoContainer",minWidth:250,rows:[]},{view:"resizer"},A]}}]},3),$$("treeTempl")||($$("container").addView({view:"layout",id:"treeTempl",hidden:!0,scroll:"auto",rows:[{id:"treeEditContainer",cols:[{rows:[{view:"edittree",id:"treeEdit",editable:!0,editor:"text",editValue:"value",css:"webix_tree-edit",editaction:"dblclick",data:[],on:{onAfterEditStop:function(e,t,i){try{let i="/init/default/api/trees/";if(e.value!=e.old){let n=$$("treeEdit").getParentId(t.id),o={name:e.value,pid:n,id:t.id,owner:null,descr:"",ttype:1,value:"",cdt:null};webix.ajax().put(i+t.id,o).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?k("success","Данные изменены",!0):r("013-011",e.json().err,!0)})).fail((function(e){console.log(e),s("013-011",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),r("012-011",e)}}}}]},{}]}]},4),webix.ui({view:"contextmenu",id:"contextMenuEditTree",data:["Добавить","Переименовать",{$template:"Separator"},"Свернуть всё","Развернуть всё",{$template:"Separator"},"Удалить"],master:$$("treeEdit"),on:{onMenuItemClick:function(e){let t=this.getContext(),i=$$("treeEdit"),n=i.getItem(t.id),o=this.getMenu(e).getItem(e).value,l="/init/default/api/trees/",a={name:"",pid:"",owner:null,descr:"",ttype:1,value:"",cdt:null};try{switch(o){case"Добавить":{let e=prompt("Имя нового подэлемента '"+n.value+"'","");null!=e&&(console.log(n.id),a.name=e,a.pid=n.id,webix.ajax().post(l,a).then((function(t){if("e"!==t.json().err_type&&"x"!==t.json().err_type){let o=t.json().content.id;i.data.add({id:o,value:e,pid:n.id},0,n.id),i.open(n.id),k("success","Данные добавлены",!0)}else r("013-001",t.json().err,!0)})).fail((function(e){console.log(e),s("013-001",e.status,e.statusText,e.responseURL)})));break}case"Переименовать":var c=prompt("Новое имя",n.value);null!=c&&(a.name=c,a.id=n.id,a.pid=n.pid,webix.ajax().put(l+n.id,a).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?(n.value=c,i.updateItem(n.id,n),k("success","Данные изменены",!0)):r("013-011",e.json().err,!0)})).fail((function(e){console.log(e),s("013-011",e.status,e.statusText,e.responseURL)})));break;case"Удалить":webix.ajax().del(l+n.id).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?(i.remove(n.id),k("success","Данные удалены",!0)):r("013-002",e.json().err,!0)})).fail((function(e){console.log(e),s("013-002",e.status,e.statusText,e.responseURL)}));break;case"Развернуть всё":try{i.open(n.id),i.data.eachSubItem(n.id,(function(e){i.open(e.id)}))}catch(e){console.log(e),r("013-000",e)}break;case"Свернуть всё":try{i.close(n.id),i.data.eachSubItem(n.id,(function(e){i.close(e.id)}))}catch(e){console.log(e),r("013-000",e)}}}catch(e){console.log(e),r("013-000",e)}}}})),$$("tables")||$$("container").addView({id:"tables",hidden:!0,view:"scrollview",body:{view:"flexlayout",cols:[{id:"tableContainer",rows:[I(0,"table-exportBtn","table-editTableBtnId","table-findElements","table-idFilterElements","table","table-filterId"),{view:"resizer",class:"webix_resizers"},V("table",S,!0)]},{view:"resizer",class:"webix_resizers"},u,L]}},5),$$("forms")||$$("container").addView({view:"layout",id:"forms",css:"webix_tableView",hidden:!0,rows:[I(0,"table-view-exportBtn","table-view-editTableBtnId","table-view-findElements","table-view-idFilterElements","table-view","table-view-filterIdView",!0),{view:"resizer",class:"webix_resizers"},{view:"scrollview",body:{view:"flexlayout",cols:[V("table-view"),{view:"resizer",class:"webix_resizers",id:"propResize",hidden:!0},("propTableView",{view:"property",id:"propTableView",tooltip:"Имя: #label#<br> Значение: #value#",width:350,nameWidth:150,editable:!0,scroll:!0,hidden:!0})]}}]},6)),"cp"==e&&$$("container").addView({view:"layout",id:"user_auth",css:"webix_auth",hidden:!0,rows:[T,{}]},7),"userprefs"==e&&$$("container").addView({view:"layout",id:"userprefs",css:"webix_auth",hidden:!0,rows:[B]},8)}catch(e){console.log(e),r("007-004",e)}}function H(){try{$$("tables")&&$$("container").removeView($$("tables")),$$("dashboards")&&$$("container").removeView($$("dashboards")),$$("forms")&&$$("container").removeView($$("forms")),$$("user_auth")&&$$("container").removeView($$("user_auth"))}catch(e){console.log(e),r("007-004",e)}}function z(e,t){return webix.ajax("/init/default/api/whoami",{success:function(i,n,o){$$("userAuth").hide(),$$("mainLayout").show(),P.push(n.json().content.first_name,n.json().content.username),U(),webix.ajax().get("/init/default/api/fields.json",!1).then((function(i){let n=i.json().content;n.treeTemplate={fields:{id:{type:"id",unique:!1,notnull:!1,length:512,label:"Id",comment:null,default:"None"},pid:{type:"reference trees",unique:!1,notnull:!1,length:512,label:"Родитель",comment:null,default:"None"},owner:{type:"reference auth_user",unique:!1,notnull:!1,length:512,label:"Владелец",comment:null,default:"None"},ttype:{type:"integer",unique:!1,notnull:!1,length:512,label:"Тип",comment:"Тип записи|1=системная;2=пользовательская|Перечисление",default:"1"},name:{type:"string",unique:!1,notnull:!1,length:100,label:"Наименование",comment:null,default:""},descr:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Описание",comment:null,default:""},value:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Значение",comment:null,default:""},cdt:{type:"datetime",unique:!1,notnull:!1,length:512,label:"Создано",comment:null,default:"now"}},singular:"Классификатор-пример",ref_name:"name",plural:"Классификаторы-пример",type:"treeConf"};let l=Object.keys(n),a={tables:[],forms:[],dashboards:[],treeConf:[]};try{$$("tree").unselectAll(),l.forEach((function(e){"treeConf"==n[e].type&&(a.treeConf.push({id:e,value:n[e].plural,type:n[e].type}),C.push({name:n[e].plural,id:e})),"dbtable"==n[e].type&&(n[e].plural?(a.tables.push({id:e,value:n[e].plural,type:n[e].type}),C.push({name:n[e].plural,id:e})):n[e].singular&&(a.tables.push({id:e,value:n[e].singular,type:n[e].type}),C.push({name:n[e].singular,id:e}))),"tform"==n[e].type&&(n[e].plural?(a.forms.push({id:e,value:n[e].plural,type:n[e].type}),C.push({name:n[e].plural,id:e})):n[e].singular&&(a.forms.push({id:e,value:n[e].singular,type:n[e].type}),C.push({name:n[e].singular,id:e}))),"dashboard"==n[e].type&&(n[e].plural?(a.dashboards.push({id:e,value:n[e].plural,type:n[e].type}),C.push({name:n[e].plural,id:e})):n[e].singular&&(a.dashboards.push({id:e,value:n[e].singular,type:n[e].type}),C.push({name:n[e].singular,id:e})))}))}catch(e){console.log(e),r("007-000",e)}webix.ajax().get("/init/default/api/mmenu.json").then((function(e){let t=e.json().mmenu,i=[];t.push({id:7,name:"sales",title:"Salasll",mtype:2,ltype:1,childs:[]});let o,s=[],c=[];o=window.location.host.includes("localhost:3000")?"/index.html/":"/init/default/spaw/";try{t.forEach((function(e,t){if("user_auth"==e.name||"userprefs"==e.name)e.childs.length>0&&(e.childs.forEach((function(e,t){"login"==e.name?c.push({id:e.name,value:e.title,href:o+e.name}):"logout"!==e.name&&s.push({id:e.name,value:e.title,href:o+e.name}),C.push({name:e.title,id:e.name})})),e.childs.forEach((function(e,t){"logout"==e.name&&s.push({id:e.name,value:e.title,css:"webix_logout"}),C.push({name:e.title,id:e.name})}))),e.childs.length<=0&&s.push({id:e.name,value:e.title,href:o+e.name});else if(e.childs.length>0&&(a[e.name]=[],e.childs.forEach((function(t,i){a[e.name].push({id:t.name,value:t.title}),C.push({name:t.title,id:t.name})}))),e.name.includes("delim"));else{let t;l.forEach((function(o){o==e.name&&(t=e.title,i.push({id:e.name+"-single",value:e.title,typeof:n[o].type}))})),t||(e.title?e.typeof?i.push({id:e.name,value:e.title,typeof:e.typeof,data:a[e.name]}):i.push({id:e.name,value:e.title,data:a[e.name]}):i.push({id:e.name,value:"Без названия",data:a[e.name]}))}})),$$("tree").clearAll(),i.push({id:"treeTempl",value:"Классификатор-пример",data:a.treeConf}),$$("tree").parse(i),$$("button-context-menu").config.popup.data=s,$$("button-context-menu").enable()}catch(e){console.log(e),r("007-000",e)}})).catch((e=>{console.log(e),s("007-000",o.status,o.statusText,o.responseURL)})),$$("tree").attachEvent("onAfterSelect",(function(t){e.navigate("tree/"+t,{trigger:!0})})),"userprefs"==t&&$$("userprefsName").setValues(P[0].toString()),"cp"==t&&$$("authName").setValues(P[0].toString())})).catch((e=>{console.log(e),s("007-000",o.status,o.statusText,o.responseURL)}))},error:function(t,i,n){e.navigate("",{trigger:!0}),s("007-006",n.status,n.statusText,n.responseURL)}})}function M(){try{$$("container").getChildViews().forEach((function(e,t){"scrollview"!=e.config.view&&"layout"!=e.config.view||$$(e.config.id).isVisible()&&$$(e.config.id).hide()}))}catch(e){console.log(e),r("007-000",e)}}function q(){let e=new(Backbone.Router.extend({routes:{"":"index",content:"content",userprefs:"userprefs",cp:"cp",logout:"logout","tree/:id":"tree"},content:function(){try{z(e).then((function(e){let t=webix.storage.local.get("userLocation");t&&void 0!==t.tableName&&setTimeout((function(){webix.ui({view:"popup",id:"popupPrevHref",css:"webix_popup-prev-href",width:340,height:150,position:"center",body:{rows:[{rows:[{cols:[{template:"Прошлая сессия",width:200,css:"webix_template-recover",borderless:!0,height:40},{},{view:"button",css:"webix_close-btn",type:"icon",width:25,icon:"wxi-close",click:function(){$$("popupPrevHref").destructor()}}]},{template:"В прошлый раз Вы остановились во вкладке «"+t.tableName+"»",css:"webix_template-recover-descr",borderless:!0,height:50},{view:"button",css:"webix_btn-recover",height:38,value:"Перейти ко вкладке",click:function(){if(window.location.assign(t.href),window.history.pushState({page:1},"",""),t.href.includes("tree")){let e=$$("tree").getItem(t.tableId).$parent;0!==e&&$$("tree").open(e),$$("tree").select(t.tableId)}$$("popupPrevHref").destructor()}},{height:20}]}]},on:{onHide:function(){this.destructor()}}}).show()}),1500)}))}catch(e){console.log(e),r("007-005",e)}},index:function(){webix.ajax("/init/default/api/whoami",{success:function(e,t,i){try{Backbone.history.navigate("content",{trigger:!0})}catch(e){console.log(e),r("007-005",e)}},error:function(e,t,i){$$("mainLayout").hide(),$$("userAuth").show(),s("007-007",i.status,i.statusText,i.responseURL)}}).catch((e=>{s("007-007",e.status,e.statusText,e.responseURL)}))},tree:function(t){try{if(0==$$("tree").data.order.length){z(e);let i=t;$$("tree").attachEvent("onAfterLoad",(function(e){let t;e=i,$$("tree").getItem(e)?(t=$$("tree").getParentId(e),$$("tree").open(t),$$("tree").select(e)):setTimeout((function(){webix.ui({view:"popup",id:"popupPrevHref",css:"webix_popup-prev-href",width:340,height:130,position:"center",body:{rows:[{rows:[{cols:[{template:"Что-то пошло не так...",width:250,css:"webix_template-recover",borderless:!0,height:20},{},{view:"button",id:"buttonClosePopup",css:"webix_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){$$("popupPrevHref").hide()}}]},{template:"Страница не найдена",css:"webix_template-back-descr",borderless:!0,height:45},{view:"button",id:"btnRecover",css:"webix_btn-back",height:38,value:"Вернуться на главную",click:function(){window.location.host.includes("localhost:3000")?window.location.replace("/index.html/content"):window.location.replace("/init/default/spaw/content"),$$("popupPrevHref").destructor()}},{height:20}]}]}}).show()}),1500)}))}}catch(e){console.log(e),r("007-005",e)}},cp:function(){try{$$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),M(),$$("webix__none-content").hide(),0==$$("tree").data.order.length&&z(e,"cp"),$$("user_auth")?$$("user_auth").show():(U("cp"),$$("user_auth").show(),P.length>0&&$$("authName").setValues(P[0].toString())),$$("tree").closeAll()}catch(e){console.log(e),r("007-005",e)}},userprefs:function(){try{$$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),M(),$$("webix__none-content").hide(),0==$$("tree").data.order.length&&z(e,"userprefs"),$$("userprefs")?$$("userprefs").show():(U("userprefs"),$$("userprefs").show(),P.length>0&&$$("userprefsName").setValues(P[0].toString())),$$("tree").closeAll()}catch(e){console.log(e),r("007-005",e)}},logout:function(){webix.ajax().post("/init/default/logout/",{success:function(e,t,i){try{history.back(),H(),$$("webix__none-content").show(),$$("tree").clearAll()}catch(e){console.log(e),k("error","Не удалось выполнить выход",!0,!0),r("007-000",e)}},error:function(e,t,i){k("error","Не удалось выполнить выход",!0,!0),s("007-006",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("007-006",e.status,e.statusText,e.responseURL)}))}}));return{view:"form",id:"formAuth",maxWidth:300,borderless:!0,elements:[{view:"text",label:"Логин",name:"username",invalidMessage:"Поле должно быть заполнено"},{view:"text",label:"Пароль",name:"password",invalidMessage:"Поле должно быть заполнено",type:"password"},{view:"button",value:"Войти",css:"webix_primary",hotkey:"enter",align:"center",click:function(){let e=$$("formAuth").getValues(),t=[];try{$$("formAuth").validate(),t.push("un="+e.username),t.push("np="+e.password),webix.ajax("/init/default/login?"+t.join("&"),{success:function(e,t,i){webix.ajax("/init/default/api/whoami",{success:function(e,t,i){try{N?(window.location.replace(N),N=null,$$("formAuth")&&$$("formAuth").clear()):(Backbone.history.navigate("content",{trigger:!0}),$$("formAuth")&&$$("formAuth").clear(),window.location.reload())}catch(e){console.log(e),r("007-005",e)}},error:function(e,t,i){$$("formAuth")&&$$("formAuth").isDirty()&&k("error","Неверный логин или пароль",!0,!0),s("007-006",i.status,i.statusText,i.responseURL)}})},error:function(e,t,i){k("error","Не удалось выполнить выход",!0,!0),s("007-006",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("007-006",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),r("007-000",e)}}}],rules:{username:webix.rules.isNotEmpty,password:webix.rules.isNotEmpty},elementsConfig:{labelPosition:"top"}}}window.location.href,console.log("expa 1.0.19"),e();try{webix.ready((function(){webix.protoUI({name:"edittree"},webix.EditAbility,webix.ui.tree),webix.ui({view:"scrollview",type:"clean",id:"layout",scroll:"y",body:{cells:[{},{hidden:!0,id:"userAuth",cols:[{},{rows:[{},q(),{}]},{}]},{hidden:!0,id:"mainLayout",rows:[{id:"mainContent",css:"webix_mainContent",cols:[{rows:[m(),{id:"adaptive",rows:[]},{id:"container",responsive:"adaptive",cols:[{view:"edittree",id:"tree",css:"webix_tree-main",minWidth:100,width:250,editable:!1,select:!0,editor:"text",editValue:"value",activeTitle:!0,clipboard:!0,data:[],on:{onSelectChange:function(e){d=e[0];let t=$$("tree").getSelectedItem().id,i=$$("tree").getParentId(t),n=$$("tree").data.order,o=[],l="";try{$$("inputsTable")&&($$("table-editForm").removeView($$("inputsTable")),$$("EditEmptyTempalte").show()),n.forEach((function(e,t){0==$$("tree").getParentId(e)&&o.push(e)})),t.includes("single")&&(l=$$("tree").getSelectedItem().typeof),(e[0]&&0!==i||l)&&$$("webix__none-content").hide()}catch(e){console.log(e),r("009-000",e)}function a(e,t){try{return $$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),$$("user_auth")&&$$("user_auth").isVisible()&&$$("user_auth").hide(),$$("userprefs")&&$$("userprefs").isVisible()&&$$("userprefs").hide(),void 0!==t?o.forEach((function(t,i){t.includes("single")?e&&$$(e).hide():($$("webix__none-content").isVisible()&&$$("webix__none-content").hide(),$$("webix__null-content")||$$("container").addView({id:"webix__null-content",template:"Блок в процессе разработки",margin:10},2),"tables"!=t&&"dashboards"!=t&&"forms"!=t&&"user_auth"!=t||$$(t).hide())})):o.forEach((function(t,n){t.includes("single")?e&&$$(e).show():t==i?$$(t).show():"tables"!=t&&"dashboards"!=t&&"forms"!=t&&"user_auth"!=t&&"treeTempl"!=t||$$(t).hide()}))}catch(e){console.log(e),r("009-000",e)}}try{"tables"==i||"dbtable"==l?a("tables"):"dashboards"==i||"dashboard"==l?a("dashboards"):"forms"==i||"tform"==l?($$("propTableView")&&$$("propTableView").isVisible()&&$$("propTableView").hide(),a("forms")):"user_auth"==i?a():0!=i||"tables"===t||"user_auth"===t||"dashboards"===t||"forms"===t||l?"treeTempl"==i&&a():a(!1,e[0]),"tables"==i||"dbtable"==l?(_(),0!==Object.keys($$("table-editForm").elements).length&&$$("inputsTable").hide(),"dbtable"==l?b("table",0,e[0],"table-findElements",!0):b("table",0,e[0],"table-findElements")):"dashboards"==i?$():"dashboard"==l?$(e[0],!0):"forms"==i?b("table-view",0,e[0],"table-view-findElements"):"tform"==l?b("table-view",0,e[0],"table-view-findElements",!0):"treeTempl"==i&&($$("treeEdit").clearAll(),webix.ajax().get("/init/default/api/trees",{success:function(e,t,i){try{(t=t.json().content)[0].pid=0;let e={},i=[],n=[];t.forEach((function(e,t){0==e.pid?n.push({id:e.id,open:!0,value:e.name,pid:e.pid,data:[]}):n.push({id:e.id,value:e.name,pid:e.pid,data:[]})})),n.forEach((function(t,o){e[t.id]=o,0!==t.pid&&t.pid!==t.id&&null!==t.pid?n[e[t.pid]].data.push(t):i.push(t)})),$$("treeEdit").parse(i)}catch(e){console.log(e),r("009-004",e)}},error:function(e,t,i){s("009-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("009-000",e.status,e.statusText,e.responseURL)})))}catch(e){console.log(e),r("009-000",e)}},onItemClick:function(e,t,i){if($$("table-editForm").isDirty())return E().then((function(t){if(1==t)x(),$$("tree").select(e);else if(2==t){if(!$$("table-editForm").validate())return k("error","Заполните пустые поля",!0),!1;$$("table-editForm").getValues().id?w():v(),$$("tree").select(e)}})),!1},onBeforeSelect:function(e){if("tables"==$$("tree").getParentId(e)&&$$("filterTableForm")&&$$("filterTableForm").isVisible){$$("filterTableForm").hide(),$$("inputsFilter")&&$$("filterTableForm").removeView($$("inputsFilter"));let e=document.querySelector(".webix_btn-filter");e&&!e.classList.contains("webix_secondary")&&(e.classList.add("webix_secondary"),e.classList.remove("webix_primary")),$$("table-editTableBtnId").hide(),$$("table-editForm").show()}},onBeforeRender:function(){window.innerWidth<=550?$$("sideMenuResizer").hide():$$("sideMenuResizer").show()}}},{id:"sideMenuResizer",view:"resizer",css:"webix_resizer-hide"},{id:"webix__none-content"}]}]}]},{view:"resizer",id:"log-resizer"},o]}]}}),function(){let e=webix.storage.local.get("LogVisible");try{e&&("hide"==e?($$("logLayout").config.height=5,$$("logLayout").resize(),$$("webix_log-btn").config.icon="wxi-eye",$$("webix_log-btn").refresh()):"show"==e&&($$("logLayout").config.height=90,$$("logLayout").resize(),$$("webix_log-btn").config.icon="wxi-eye-slash",$$("webix_log-btn").refresh()))}catch(e){console.log(e),r("010-000",e)}}(),window.addEventListener("resize",(function(e){$$("tree").isVisible()||window.innerWidth<=600&&$$("sideMenuResizer")&&$$("sideMenuResizer").hide()}),!0),window.location.host.includes("localhost:3000")?Backbone.history.start({pushState:!0,root:"/index.html/"}):Backbone.history.start({pushState:!0,root:"/init/default/spaw/"}),function(){let e=null;webix.event(document.body,"mousedown",(t=>{const i=$$(t);i&&i.getInputNode&&(e=i)})),webix.event(document,"click",(t=>{const i=$$(t);e&&i&&i.config.id!==e.config.id&&(t.cancelBubble=!0,webix.html.preventEvent(t)),e=null}),{capture:!0})}(),function(){let e;function t(){webix.ajax().post("/init/default/logout/",{success:function(e,t,i){try{$$("popupFilterEdit")&&$$("popupFilterEdit").isVisible()&&$$("popupFilterEdit").hide(),$$("popupPrevHref")&&$$("popupPrevHref").isVisible()&&$$("popupPrevHref").hide(),history.back(),H(),$$("webix__none-content").show(),$$("tree").clearAll(),k("debug","Превышено время бездействия",!1)}catch(e){console.log(e),r("008-000",e)}},error:function(e,t,i){k("error","Не удалось выполнить выход",!0),s("008-006",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("008-006",e.status,e.statusText,e.responseURL)}))}function i(){try{clearTimeout(e),e=setTimeout(t,6e5)}catch(e){console.log(e),r("008-000",e)}}window.onload=i,window.onmousemove=i,window.onmousedown=i,window.ontouchstart=i,window.onclick=i,window.onkeypress=i,window.addEventListener("scroll",i,!0)}(),webix.message.position="bottom",webix.i18n.setLocale("ru-RU"),webix.i18n.parseFormat="%d.%m.%Y %H:%i:%s",webix.i18n.setLocale(),window.addEventListener("popstate",(function(e){window.location.replace(window.location.href),window.location.reload()}))}))}catch(e){console.log(e),alert("Ошибка при выполнении "+e),r("007-005",e)}})();