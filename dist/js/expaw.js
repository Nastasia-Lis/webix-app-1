(()=>{"use strict";const e={id:"dashboardTool",css:"webix_dashTool",rows:[]};function t(e,t){"undefined"!=typeof Storage&&localStorage.setItem(e,t)}function i(e,i){const n=new Date;let o=`${n.getDate()}.${String(n.getMonth()+1).padStart(2,"0")}.${n.getFullYear()} ${n.getHours()}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`;try{let n,r=null;if(void 0!==$$("tree").getSelectedItem()&&(r=$$("tree").getSelectedItem().id,r.includes("single"))){let e=r.search("-single");r=r.slice(0,e)}if(r){let e;N.forEach((function(t,i){t.id==r&&(e=t.name)})),$$("logBlock-list").add({date:o,value:i,src:e})}else $$("logBlock-list").add({date:o,value:i,src:"Expa v1.0.26"});let s=document.querySelector(".webix_log-block");s&&s.querySelectorAll(".webix_list_item").forEach((function(e,t){n=t}));let a=document.querySelectorAll(".webix_list_item")[n];"error"==e&&(void 0!==a&&a.style.setProperty("color","red","important"),"wxi-eye"==$$("webix_log-btn").config.icon&&($$("logLayout").config.height=90,$$("logLayout").resize(),$$("webix_log-btn").setValue(2),$$("webix_log-btn").config.icon="wxi-eye-slash",$$("webix_log-btn").refresh(),t("LogVisible",JSON.stringify("show"))))}catch(e){console.log(e),r("006-000",e)}}let n=0;const o={id:"logLayout",height:80,rows:[{template:"<div class='webix_log-headline'>Системные сообщения</div>",height:30},{id:"logBlock-list",css:"webix_log-block",view:"list",template:"#date# — #value#  (Источник: #src#)",data:[],on:{onAfterLoad:function(){try{i("success","Интерфейс загружен")}catch(e){console.log(e),r("006-000",e)}},onAfterAdd:function(e,t){try{"wxi-eye"==$$("webix_log-btn").config.icon?(""==$$("webix_log-btn").config.badge&&(n=0),n++,$$("webix_log-btn").config.badge=n,$$("webix_log-btn").setValue(1),$$("webix_log-btn").refresh()):"wxi-eye-slash"==$$("webix_log-btn").config.icon&&(n=0,$$("webix_log-btn").config.badge="",$$("webix_log-btn").setValue(2),$$("webix_log-btn").refresh())}catch(e){console.log(e),r("006-000",e)}}}}]};function r(e,t,o=!1){return $$("webix_log-btn").setValue(2),n=0,i("error",o?"ОШИБКА "+e+": "+t:"ОШИБКА "+e+": "+t.stack)}function s(e,t,o,r){return $$("webix_log-btn").setValue(2),n=0,i("error","ОШИБКА "+e+": СТАТУС: "+t+" "+o+". ПОДРОБНОСТИ: "+r)}let a,l,c=!1;function u(e,t,n,o){let l=[];if("get"==n)if("refresh"==o)try{e.forEach(((e,t)=>{e.id.includes("customCombo")?l.push(e.name+"="+$$(e.id).getText()):(e.id.includes("customInputs")||e.id.includes("customDatepicker"))&&l.push(e.name+"="+$$(e.id).getValue())})),webix.ajax(t+"?"+l.join("&"),{success:function(e,t,i){try{$$("table-view").clearAll(),0!==(t=t.json().content).length?($$("table-view").hideOverlay("Ничего не найдено"),$$("table-view").parse(t)):$$("table-view").showOverlay("Ничего не найдено"),a=$$("table-view").count(),$$("table-view-findElements").setValues(a.toString())}catch(e){console.log(e),r("018-000",e)}},error:function(e,t,i){s("018-000",i.status,i.statusText,i.responseURL),$$("table-newAddBtnId")&&!$$("table-newAddBtnId").isEnabled()&&$$("table-newAddBtnId").enable()}}).catch((e=>{console.log(e),s("018-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),r("018-000",e)}else"download"==o&&webix.ajax().response("blob").get(t,(function(e,t,i){try{webix.html.download(t,"table.docx")}catch(e){console.log(e),r("018-000",e)}})).catch((e=>{console.log(e),s("018-000",e.status,e.statusText,e.responseURL)}));else if("post"==n)try{e.forEach(((e,t)=>{e.id.includes("customUploader")&&$$(e.id).send((function(t){"e"==t.err_type?($$("table-view").parse($$(e.id).getValue()),i("error",t.err)):"i"==t.err_type?(i("success",t.err),$$("table-view").refresh()):"x"==t.err_type&&i("debug",t.err)}))}))}catch(e){console.log(e),r("018-000",e)}}function d(e){return new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get("/init/default/api/"+e).then((function(e){try{e=e.json().content;let t,i=[];return e.forEach(((e,n)=>{let o=0;for(;o<=Object.values(e).length;){if("string"==typeof Object.values(e)[o]){t=Object.keys(e)[o];break}o++}if(null==e[t])for(;o<=Object.values(e).length;){if("number"==typeof Object.values(e)[1]){t=Object.keys(e)[1];break}o++}i.push({id:e.id,value:e[t]})})),i}catch(e){console.log(e),r("018-000",e)}})).catch((e=>{console.log(e),s("018-000",e.status,e.statusText,e.responseURL)}))}}})}function h(e,t,n,o,l=!1){let h=n,p=$$("tree").getItem(n),f=$$("table-view-filterIdView").getParentView();try{if($$(e).clearAll(),null==p)i("error","Данные не найдены");else{let t;"table-view"==e&&($$("contextActionsPopup")&&$$("contextActionsPopup").destructor(),$$("contextActionsBtnAdaptive")&&f.removeView($$("contextActionsBtnAdaptive")),$$("customInputs")&&$$("customInputs").getParentView().removeView($$("customInputs")),$$("customInputsMain")&&$$("customInputsMain").getParentView().removeView($$("customInputsMain"))),webix.ajax().get("/init/default/api/fields.json").then((function(i){let p=i.json().content;if(i.treeTemplate={fields:{id:{type:"id",unique:!1,notnull:!1,length:512,label:"Id",comment:null,default:"None"},pid:{type:"reference trees",unique:!1,notnull:!1,length:512,label:"Родитель",comment:null,default:"None"},owner:{type:"reference auth_user",unique:!1,notnull:!1,length:512,label:"Владелец",comment:null,default:"None"},ttype:{type:"integer",unique:!1,notnull:!1,length:512,label:"Тип",comment:"Тип записи|1=системная;2=пользовательская|Перечисление",default:"1"},name:{type:"string",unique:!1,notnull:!1,length:100,label:"Наименование",comment:null,default:""},descr:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Описание",comment:null,default:""},value:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Значение",comment:null,default:""},cdt:{type:"datetime",unique:!1,notnull:!1,length:512,label:"Создано",comment:null,default:"now"}},singular:"Классификатор-пример",ref_name:"name",plural:"Классификаторы-пример",type:"treeConf"},l){let e=n.search("-single");n=n.slice(0,e)}let $,b,g=(i=p[n]).fields,w=Object.keys(i.fields),m=[];try{w.forEach((function(e){if(g[e].type.includes("reference")){let t=g[e].type.slice(10);g[e].editor="combo",g[e].collection=d(t),g[e].template=function(e,t,i,n){let o=n.collection.getItem(e[n.id]);return o?o.value:""}}else"datetime"==g[e].type?(g[e].format=webix.i18n.fullDateFormatStr,g[e].editor="date"):"string"==g[e].type||"text"==g[e].type?g[e].editor="text":"integer"==g[e].type?(g[e].editor="text",g[e].numberFormat="1 111"):"boolean"==g[e].type&&(g[e].editor="combo",g[e].collection=[{id:1,value:"Да"},{id:2,value:"Нет"}]);g[e].id=e,g[e].fillspace=!0,g[e].header=g[e].label,"id"==g[e].id&&(g[e].hidden=!0),m.push(g[e])})),$$(e).refreshColumns(m)}catch(e){console.log(e),r("018-000",e)}c=!1;try{m.forEach((function(e,t){"action"==e.type&&"detail"==i.actions[e.id].rtype&&(c=!0,$=t,b=e.id)})),void 0!==b&&c&&($$(e).config.columns.splice(0,0,{id:"action-first"+$,maxWidth:130,header:"Подробнее",template:"<span class='webix_icon wxi-angle-down'></span> "}),$$(e).refreshColumns())}catch(e){console.log(e),r("018-000",e)}try{if($$("contextActionsBtn")&&$$(f.config.id).removeView($$("contextActionsBtn")),i.inputs){let n=Object.keys(i.inputs),o=[],a=[],l=i.inputs;if(n.forEach(((t,n)=>{if("string"==l[t].type)o.push({view:"text",placeholder:l[t].label,id:"customInputs"+n,height:48,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",l[t].comment)}}});else if("apiselect"==l[t].type){let e=new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get("/init/default/api/"+l[t].apiname).then((function(e){let t=e.json().content,i=[];try{return void 0!==t[0].name?t.forEach((function(e,t){i.push({id:t+1,value:e.name})})):t.forEach((function(e,t){i.push({id:t+1,value:e})})),i}catch(e){console.log(e),r("018-000",e)}})).catch((e=>{console.log(e),s("018-000",e.status,e.statusText,e.responseURL)}))}}});o.push({view:"combo",height:48,id:"customCombo"+n,placeholder:l[t].label,labelPosition:"top",options:{data:e},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",l[t].comment)}}})}else if("submit"==l[t].type||"button"==l[t].type){let r=l[t].action,s=i.actions[r];if("DELETE"==s.verb&&"submit"!==r){let t=$$(e).getColumns().length;$$(e).config.columns.splice(t,0,{id:"action"+n,header:"Действие",maxWidth:100,template:"{common.trashIcon()}"}),$$(e).refreshColumns()}else"DELETE"==s.verb?o.push({view:"button",id:"customBtnDel"+n,css:"webix_danger",type:"icon",icon:"wxi-trash",inputHeight:48,height:48,value:l[t].label,click:function(e){u(a,s.url,"delete")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",l[t].comment)}}}):o.push({view:"button",css:"webix_primary",id:"customBtn"+n,inputHeight:46,height:46,value:l[t].label,click:function(e){"GET"==s.verb?"refresh"==s.rtype?u(a,s.url,"get","refresh"):"download"==s.rtype&&u(a,s.url,"get","download"):"POST"==s.verb?u(a,s.url,"post"):"download"==s.verb&&u(a,s.url,"get","download"),$$("contextActionsPopup")&&$$("contextActionsPopup").hide()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",l[t].comment)}}})}else"upload"==l[t].type?o.push({view:"uploader",value:"Upload file",id:"customUploader"+n,height:48,autosend:!1,upload:i.actions.submit.url,label:l[t].label,labelPosition:"top",click:function(){$$("contextActionsPopup")&&$$("contextActionsPopup").destructor()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",l[t].comment)}}}):"datetime"==l[t].type?o.push({view:"datepicker",format:"%d.%m.%Y %H:%i:%s",placeholder:l[t].label,id:"customDatepicker"+n,timepicker:!0,labelPosition:"top",height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",l[t].comment)}}}):"checkbox"==l[t].type&&o.push({view:"checkbox",id:"customСheckbox"+n,css:"webix_checkbox-style",labelRight:l[t].label,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",l[t].comment)}}})})),o.forEach(((e,t)=>{void 0!==e.id&&("text"==e.view?a.push({id:e.id,name:"substr"}):"combo"==e.view?a.push({id:e.id,name:"valtype"}):("uploader"==e.view||"datepicker"==e.view)&&a.push({id:e.id}))})),window.innerWidth>830){o.forEach((function(e,t){"text"==e.view&&(e.maxWidth=300,e.minWidth=150),"combo"==e.view&&(e.width=250),"button"==e.view&&"wxi-trash"==e.icon&&(e.width=100),"button"==e.view&&"webix_primary"==e.css&&(e.maxWidth=550,e.minWidth=100),"datepicker"==e.view&&(e.width=300,e.minWidth=100),"checkbox"==e.view&&(e.minWidth=220)})),t={id:"customInputs",css:"webix_custom-inp",cols:o};let e=$$("table-view-filterIdView").getParentView();$$(e.config.id).addView({id:"customInputsMain",cols:[t]},2)}else o.forEach((function(e,t){e.bottomPadding=10})),o.push({}),t={id:"customInputsAdaptive",rows:[{id:"customInputs",css:"webix_custom-inp",rows:o}]},$$(f.config.id).addView({view:"button",id:"contextActionsBtnAdaptive",maxWidth:100,value:"Действия",css:"webix_primary",popup:webix.ui({view:"popup",css:"webix_popup-actions-container webix_popup-config",modal:!0,id:"contextActionsPopup",escHide:!0,position:"center",body:{rows:[{cols:[{template:"Доступные действия",css:"webix_template-actions",borderless:!0,height:40},{view:"button",id:"buttonClosePopupActions",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("contextActionsPopup")&&$$("contextActionsPopup").hide()}}]},{view:"scrollview",borderless:!0,scroll:"y",body:{id:"contextActionsPopupContainer",css:"webix_context-actions-popup",rows:[t]}}]}}),click:function(){$$("contextActionsPopup").config.height!==$$("customInputs").$height+50&&($$("contextActionsPopup").config.height=$$("customInputs").$height+50,$$("contextActionsPopup").resize());let e=window.innerWidth-100;$$("contextActionsPopup").$width>200&&($$("contextActionsPopup").config.width=e,$$("contextActionsPopup").resize())}},2)}}catch(e){console.log(e),r("018-000",e)}function v(t){$$(t).load({$proxy:!0,load:function(t,i){return webix.ajax().get("/init/default/api/"+h,{success:function(t,i,n){try{let t;$$(e).clearAll(),$$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable(),$$("table-filterId").isEnabled()||$$("table-filterId").enable(),$$("table-exportBtn").isEnabled()||$$("table-exportBtn").enable(),(i=i.json().content).forEach((function(e,i){e.cdt&&(t=new Date(e.cdt),e.cdt=t),e.edt&&(t=new Date(e.edt),e.edt=t),e.sdt&&(t=new Date(e.sdt),e.sdt=t),e.time_stamp&&(t=new Date(e.time_stamp),e.time_stamp=t)})),0!==i.length?($$(e).hideOverlay("Ничего не найдено"),$$(e).parse(i)):($$(e).showOverlay("Ничего не найдено"),$$(e).clearAll()),a=$$(e).count(),$$(o).setValues(a.toString()),"table"==e&&$$("table-findElements").setValues(a.toString())}catch(e){console.log(e),r("018-000",e)}},error:function(e,t,i){s("018-000",i.status,i.statusText,i.responseURL),a="-";try{$$(o).setValues(a.toString()),$$("table-findElements").setValues(a.toString()),$$("table-newAddBtnId").isEnabled()&&$$("table-newAddBtnId").disable(),$$("table-filterId")&&$$("table-filterId").disable(),$$("table-exportBtn")&&$$("table-exportBtn").disable()}catch(e){console.log(e),r("018-000",e)}}}).catch((e=>{console.log(e),s("018-000",e.status,e.statusText,e.responseURL)}))}})}if(l&&(h=n),"dbtable"==i.type?v("table"):"tform"==i.type&&v("table-view"),i.autorefresh){let e=webix.storage.local.get("userprefsOtherForm");void 0!==e.autorefCounterOpt&&(e.autorefCounterOpt>=15e3?setInterval((function(){"dbtable"==i.type?v("table"):"tform"==i.type&&v("table-view")}),e.autorefCounterOpt):setInterval((function(){"dbtable"==i.type?v("table"):"tform"==i.type&&v("table-view")}),12e4))}})).catch((e=>{console.log(e),e.status?("401"==e.status&&webix.alert({title:"Пользователь не найден",text:"Войдите в систему перед тем как продолжить",ok:"Войти",modal:!0}).then((function(){Backbone.history.navigate("/",{trigger:!0})})),s("018-000",e.status,e.statusText,e.responseURL)):r("018-000",e),$$("btnFilterSubmit")&&$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").disable()}))}}catch(e){console.log(e),r("018-000",e)}}function p(e,t=!1){let n=$$("tree").getSelectedItem().id;function o(e,t,o=!1){webix.ajax().get(e,{success:function(s,a,l){let c=[{type:"wide",rows:[]}],u=a.json().charts,d={};try{if($$("dashBodyScroll")&&$$("dashBodyScroll").getParentView().removeView($$("dashBodyScroll")),o||($$("dashboardInfoContainerInner")&&$$("dashboardInfoContainerInner").getParentView().removeView($$("dashboardInfoContainerInner")),$$("dash-template")&&$$("dash-template").getParentView().removeView($$("dash-template")),$$("dashboard-tool-main")&&$$("dashboard-tool-main").getParentView().removeView($$("dashboard-tool-main")),$$("dashboard-tool-adaptive")&&$$("dashboard-tool-adaptive").getParentView().removeView($$("dashboard-tool-adaptive"))),null==u)$$("dashboardTool").addView({view:"scrollview",id:"dashboard-tool-main",borderless:!0,css:{margin:"20px!important",height:"50px!important"},body:{view:"flexlayout",rows:[]}},0),$$("dashboardTool").addView({rows:[{template:"",id:"dash-template",css:"webix_style-template-count webix_dash-title",borderless:!1,height:40}]},1),$$("dashboardInfoContainer").addView({view:"scrollview",scroll:"auto",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",borderless:!0,body:{view:"flexlayout",rows:[]}}]}}),i("error","Ошибка при загрузке данных");else{let e;u.forEach((function(e,t){d=e.title,delete e.title,e.borderless=!0,e.minWidth=250,c[0].rows.push({css:"webix_dash-chart-headline",rows:[{template:d,borderless:!0,css:{"font-weight":"400!important","font-size":"17px!important"},height:35},e]})})),n.includes("single")&&(n=n.slice(0,n.search("-single"))),N.forEach((function(t,i){t.id==n&&(e=t.name)})),o?$$("dashboardInfoContainerInner").addView({view:"scrollview",scroll:"y",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",rows:c}]}}):(window.innerWidth>830?$$("dashboardTool").addView({id:"dashboard-tool-main",padding:20,minWidth:250,rows:[{id:"dashboardToolHeadContainer",cols:[{template:"Фильтр",height:30,css:"webix_dash-filter-headline",borderless:!0},{view:"button",id:"buttonClosePopupDashFilter",css:"webix_close-btn",type:"icon",hotkey:"esc",hidden:!0,width:25,icon:"wxi-close",click:function(){$$("contextDashFilterPopup")&&$$("contextDashFilterPopup").hide()}}]},{rows:t}]}):$$("dashFilterBtn")||$$("dashboardInfoContainer").addView({id:"dashboard-tool-adaptive",cols:[{view:"button",id:"dashFilterBtn",value:"Фильтры",css:{margin:"10px 0px!important"},height:46,margin:10,popup:webix.ui({view:"popup",css:"webix_popup-dash-container webix_popup-config",modal:!0,id:"contextDashFilterPopup",escHide:!0,position:"center",body:{id:"contextDashFilterPopupContainer",rows:[{id:"dashToolInputsAdaptive",rows:[{id:"dashboardToolHeadContainer",cols:[{template:"Фильтр",height:30,css:"webix_dash-filter-headline",borderless:!0},{view:"button",id:"buttonClosePopupDashFilter",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("contextDashFilterPopup")&&$$("contextDashFilterPopup").hide()}}]},{rows:t}]}]}}),click:function(){let e=window.innerWidth-130;e>200&&($$("contextDashFilterPopupContainer").config.width=e,$$("contextDashFilterPopupContainer").resize())}}]},0),$$("dashboardInfoContainer").addView({id:"dashboardInfoContainerInner",rows:[{template:e,id:"dash-template",css:"webix_style-template-count webix_dash-title",borderless:!1,height:75},{view:"scrollview",scroll:"y",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",rows:c}]}}]}))}"wxi-eye"==$$("webix_log-btn").config.icon?($$("logLayout").config.height=90,$$("logLayout").resize(),$$("logLayout").config.height=5,$$("logLayout").resize()):($$("logLayout").config.height=5,$$("logLayout").resize(),$$("logLayout").config.height=90,$$("logLayout").resize()),(e.includes("?")||e.includes("sdt")&&e.includes("edt"))&&i("success","Данные обновлены")}catch(e){console.log(e),r("018-004",e)}},error:function(e,t,i){s("018-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("018-000",e.status,e.statusText,e.responseURL)}))}try{$$("dashBodyScroll")&&$$("dashBodyScroll").getParentView().removeView($$("dashBodyScroll")),$$("dashBodyScroll")||webix.ajax().get("/init/default/api/fields",{success:function(s,a,l){let c,u,d,h=[];a=a.json().content;try{if(t){let t=e.search("-single");e=e.slice(0,t)}if(Object.values(a).forEach((function(t,i){t.nameObj=Object.keys(a)[i],t.nameObj==e&&(d=t)})),t){let e=d.inputs;if(Object.keys(e),Object.values(e).forEach((function(t,n){"datetime"==t.type&&3==t.order?(Object.keys(e)[n],h.push({width:200,id:"datepicker-containersdt",rows:[{template:"Начиная с:",height:30,borderless:!0,css:"webix_template-datepicker"},{view:"datepicker",format:"%d.%m.%y",editable:!0,value:new Date,id:"dashDatepicker_sdt",placeholder:t.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",t.comment)}}},{height:10},{view:"datepicker",format:"%H:%i:%s",id:"dashDatepicker_sdt-time",placeholder:"Время",height:48,editable:!0,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}},{height:20},{template:"Заканчивая:",height:30,borderless:!0,css:"webix_template-datepicker"},{view:"datepicker",format:"%d.%m.%y",value:new Date,editable:!0,id:"dashDatepicker_edt",placeholder:t.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",t.comment)}}},{height:10},{view:"datepicker",format:"%H:%i:%s",id:"dashDatepicker_edt-time",placeholder:"Время",editable:!0,height:48,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",hotkey:"enter",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}}]})):"submit"==t.type&&(c=t.action,u=d.actions[c],h.push({rows:[{height:10},{view:"button",css:"webix_primary",id:"dashBtn"+n,inputHeight:48,height:48,minWidth:100,maxWidth:200,value:t.label,click:function(){let e,t=[],r=webix.Date.dateToStr("%d.%m.%y"),s=[],a=webix.Date.dateToStr("%H:%i:%s"),l="",c="",d=!0;if(h.forEach((function(e,t){e.id.includes("container")&&$$(e.id).getChildViews().forEach((function(e,t){e.config.id.includes("sdt")?e.config.id.includes("time")?null!==$$(e.config.id).getValue()?l=l.concat(" "+a($$(e.config.id).getValue())):d=!1:null!==$$(e.config.id).getValue()?l=r($$(e.config.id).getValue()):d=!1:e.config.id.includes("edt")&&(e.config.id.includes("time")?null!==$$(e.config.id).getValue()?c=c.concat(" "+a($$(e.config.id).getValue())):d=!1:null!==$$(e.config.id).getValue()?c=r($$(e.config.id).getValue()):d=!1)}))})),t.push("sdt="+l),t.push("edt="+c),s.push(l),s.push(c),d){let r=webix.Date.dateToStr("%Y/%m/%d %H:%i:%s");webix.filters.date.greater(r(s[0]),r(s[1]))&&s[0]!=s[1]?i("error","Начало периода больше, чем конец"):(e=u.url+"?"+t.join("&"),$$("dashboard-charts")&&$$("dashboardBody").removeView($$("dashboard-charts")),$$("dashboard-charts")||o(e,h,!0),$$("dashBtn"+n).disable(),setInterval((function(){$$("dashBtn"+n).enable()}),1e3))}else i("error","Не все поля заполнены")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",t.comment)}}},{}]}))})),o(d.actions.submit.url,h),d.autorefresh){let e=webix.storage.local.get("userprefsOtherForm");void 0!==e.autorefCounterOpt&&(e.autorefCounterOpt>=15e3?setInterval((function(){o(d.actions.submit.url,h)}),e.autorefCounterOpt):setInterval((function(){o(d.actions.submit.url,h)}),5e4))}}else{let e=a;Object.values(e).forEach((function(e,t){if("dashboard"==e.type&&e.nameObj==n){let t=e.inputs;if(Object.values(t).forEach((function(n,r){"datetime"==n.type&&3==n.order?(Object.keys(t)[r],h.push({width:200,id:"datepicker-containersdt",rows:[{template:"Начиная с:",height:30,borderless:!0,css:"webix_template-datepicker"},{view:"datepicker",format:"%d.%m.%y",editable:!0,value:new Date,id:"dashDatepicker_sdt",placeholder:n.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",n.comment)},onKeyPress:function(e,t){console.log(e,t)}}},{height:10},{view:"datepicker",format:"%H:%i:%s",id:"dashDatepicker_sdt-time",placeholder:"Время",height:48,editable:!0,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",hotkey:"enter",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}},{height:20},{template:"Заканчивая:",height:30,borderless:!0,css:"webix_template-datepicker"},{view:"datepicker",format:"%d.%m.%y",editable:!0,value:new Date,id:"dashDatepicker_edt",placeholder:n.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",n.comment)}}},{height:10},{view:"datepicker",format:"%H:%i:%s",id:"dashDatepicker_edt-time",placeholder:"Время",height:48,editable:!0,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",body:{button:!0,seconds:!0,twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}}]})):"submit"==n.type&&(c=n.action,u=e.actions[c],h.push({rows:[{height:10},{view:"button",css:"webix_primary",id:"dashBtn"+r,inputHeight:48,height:48,minWidth:100,maxWidth:200,value:n.label,click:function(){let e,t=[],n=webix.Date.dateToStr("%d.%m.%y"),s=[],a=webix.Date.dateToStr("%H:%i:%s"),l="",c="",d=!0;if(h.forEach((function(e,t){e.id.includes("container")&&$$(e.id).getChildViews().forEach((function(e,t){e.config.id.includes("sdt")?e.config.id.includes("time")?null!==$$(e.config.id).getValue()?l=l.concat(" "+a($$(e.config.id).getValue())):d=!1:null!==$$(e.config.id).getValue()?l=n($$(e.config.id).getValue()):d=!1:e.config.id.includes("edt")&&(e.config.id.includes("time")?null!==$$(e.config.id).getValue()?c=c.concat(" "+a($$(e.config.id).getValue())):d=!1:null!==$$(e.config.id).getValue()?c=n($$(e.config.id).getValue()):d=!1)}))})),t.push("sdt="+l),t.push("edt="+c),s.push(l),s.push(c),d){let n=webix.Date.dateToStr("%Y/%m/%d %H:%i:%s");webix.filters.date.greater(n(s[0]),n(s[1]))&&s[0]!=s[1]?i("error","Начало периода больше, чем конец"):(e=u.url+"?"+t.join("&"),$$("dashboard-charts")&&$$("dashboardBody").removeView($$("dashboard-charts")),o(e,h,!0),$$("dashBtn"+r).disable(),setInterval((function(){$$("dashBtn"+r).enable()}),1e3))}else i("error","Не все поля заполнены")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",n.comment)}}},{}]}))})),o(e.actions.submit.url,h),e.autorefresh){let e=webix.storage.local.get("userprefsOtherForm");void 0!==e.autorefCounterOpt&&(e.autorefCounterOpt>=15e3?setInterval((function(){o(d.actions.submit.url,h)}),e.autorefCounterOpt):setInterval((function(){o(d.actions.submit.url,h)}),5e4))}}}))}}catch(e){console.log(e),r("018-000",e)}},error:function(e,t,i){console.log(i),s("018-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("018-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),r("018-000",e)}}function f(){$$("treeEdit").clearAll(),webix.ajax().get("/init/default/api/trees",{success:function(e,t,i){try{(t=t.json().content)[0].pid=0;let e={},i=[],n=[];t.forEach((function(e,t){0==e.pid?n.push({id:e.id,open:!0,value:e.name,pid:e.pid,data:[]}):n.push({id:e.id,value:e.name,pid:e.pid,data:[]})})),n.forEach((function(t,o){e[t.id]=o,0!==t.pid&&t.pid!==t.id&&null!==t.pid?n[e[t.pid]].data.push(t):i.push(t)})),$$("treeEdit").parse(i)}catch(e){console.log(e),r("018-004",e)}},error:function(e,t,i){s("018-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("018-000",e.status,e.statusText,e.responseURL)}))}function $(e){return webix.confirm({width:300,ok:"Да",cancel:"Отмена",title:e,text:"Вы уверены, что хотите продолжить?"})}function b(){return webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"})}function g(){let e=$$("tree").getSelectedItem().id;if(0==e.length)l=void 0;else{if(e.includes("-single")){let t=e.search("-single");e=e.slice(0,t)}l=e}}function w(e=!1){try{g();let t=$$("table-editForm").getValues();$$("table-editForm").validate()?t.id&&webix.ajax().put("/init/default/api/"+l+"/"+t.id,t,{success:function(n,o,r){o=o.json(),$$("table").updateItem(t.id,t),_(),T(),$$("table").clearSelection(),e?($$("table").filter(!1),x("table-editForm"),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show()):($$("inputsTable")&&$$("inputsTable").hide(),$$("table-newAddBtnId").enable(),$$("EditEmptyTempalte")&&!$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").show()),"i"==o.err_type&&(window.innerWidth<1200&&$$("tableEditPopup")&&$$("tableEditPopup").hide(),i("success","Данные сохранены")),"e"==o.err_type&&i("error",o.error)},error:function(e,t,i){s("003-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("003-011",e.status,e.statusText,e.responseURL)})):i("error","Заполните пустые поля")}catch(e){r("003-000",e)}}function m(){try{$$("table-editForm").isDirty()?b().then((function(e){if(1==e)$$("table").filter(!1),x("table-editForm"),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show();else if(2==e){if(!$$("table-editForm").validate())return i("error","Заполните пустые поля"),!1;w(!0)}})):($$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide(),$$("table").clearSelection(),$$("table").filter(!1),$$("table").hideOverlay("Ничего не найдено"),x("table-editForm"),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show(),$$("table-newAddBtnId").disable())}catch(e){r("003-000",e)}}function v(){try{if(g(),$$("table-editForm").validate())if($$("table-editForm").isDirty()){let e=$$("table-editForm").getValues();e.id=webix.uid(),webix.ajax().post("/init/default/api/"+l,e,{success:function(t,n,o){n=n.json(),$$("table").add(e),_(),T(),$$("inputsTable")&&$$("inputsTable").hide(),$$("table-newAddBtnId").enable(),$$("EditEmptyTempalte")&&!$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").show(),"i"==n.err_type?(window.innerWidth<1200&&$$("tableEditPopup")&&$$("tableEditPopup").hide(),i("success","Данные успешно добавлены")):"e"==n.err_type&&i("error",n.error)},error:function(e,t,i){s("003-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("003-001",e.status,e.statusText,e.responseURL)}))}else webix.message({type:"debug",expire:1e3,text:"Форма пуста"});else i("error","Заполните пустые поля")}catch(e){r("003-000",e)}}function y(){try{g(),$("Запись будет удалена").then((function(){$$("table").remove($$("table-editForm").getValues().id);let e=$$("table-editForm").getValues();console.log("/init/default/api/"+l+"/"+e.id+".json",e),webix.ajax().del("/init/default/api/"+l+"/"+e.id+".json",e,{success:function(e,t,n){t=t.json(),_(),T(),$$("inputsTable").hide(),window.innerWidth<1200&&$$("tableEditPopup")&&$$("tableEditPopup").hide(),"i"==t.err_type&&(window.innerWidth<1200&&$$("tableEditPopup")&&$$("tableEditPopup").hide(),i("success","Данные успешно удалены")),"e"==t.err_type&&i("error",t.error)},error:function(e,t,i){s("003-002",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("003-002",e.status,e.statusText,e.responseURL)}))}))}catch(e){r("003-000",e)}}function x(e,t=1){try{let n=$$("table").getColumns();if(0==Object.keys($$(e).elements).length){let o=[];n.forEach(((t,n)=>{if("datetime"==t.type)o.push({view:"datepicker",format:"%d.%m.%Y %H:%i:%s",id:t.id,name:t.id,label:t.label,placeholder:"дд.мм.гг",timepicker:!0,labelPosition:"top",on:{onItemClick:function(){$$(e).clearValidation()}}});else if(t.type.includes("reference")){let n,r=t.type.slice(10);N.forEach((function(e,t){e.id==r&&(n=e.name)})),o.push({cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id,name:t.id,labelPosition:"top",options:{data:d(r)},on:{onItemClick:function(){$$(e).clearValidation()},onChange:function(){$$(t.id).setValue(this.getValue()),$$(t.id).refresh()},onBindRequest:function(e){}},ready:function(){}},{view:"button",css:{"vertical-align":"bottom!important",height:"38px!important"},type:"icon",icon:"wxi-angle-right",inputHeight:38,width:40,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Перейти в таблицу «"+n+"»")}},click:function(){try{$$("tree").select(r),$$("tableEditPopup")&&$$("tableEditPopup").isVisible()&&$$("tableEditPopup").hide()}catch(e){console.log(e),i("error","Таблица не найдена"),$$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide()}}}]})}else t.type.includes("boolean")?o.push({cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id,name:t.id,labelPosition:"top",options:[{id:1,value:"Да"},{id:2,value:"Нет"}],on:{onItemClick:function(){$$(e).clearValidation()}}}]}):t.type.includes("integer")?o.push({cols:[{view:"text",name:t.id,id:t.id,label:t.label,labelPosition:"top",invalidMessage:"Поле поддерживает только числовой формат",on:{onKeyPress:function(){$$(e).clearValidation()}},validate:function(e){return!isNaN(1*e)}}]}):o.push({view:"text",name:t.id,id:t.id,label:t.label,labelPosition:"top",on:{onKeyPress:function(){$$(e).clearValidation()}}})}));let r={margin:8,id:"inputsTable",rows:o};return"table-editForm"==e&&$$("table-delBtnId").enable(),$$(e).addView(r,t)}$$(e).clear(),$$(e).clearValidation(),"table-editForm"==e&&$$("table-delBtnId").enable(),$$("inputsTable").show()}catch(e){r("003-000",e)}}function _(){$$("table-editForm").clear(),$$("table-editForm").clearValidation(),T()}function T(){$$("table-saveNewBtn").isVisible()?$$("table-saveNewBtn").hide():$$("table-saveBtn").isVisible()&&$$("table-saveBtn").hide(),$$("table-delBtnId").disable()}function E(e,t,n,o,s,a,l,c=!1){function u(e,t,n){let o,s=e.type.slice(10);function a(i){try{if(o=$$(e.id+"_filter_rows").getChildViews().length,"text"==n)return{view:"text",placeholder:"Введите текст",name:e.id+"_filter-child-"+i+"-"+o,id:e.id+"_filter-child-"+i+"-"+o,on:{onKeyPress:function(){$$(t).clearValidation(),$$("btnFilterSubmit")&&!$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").enable()}}};if("combo"==n)return{view:"combo",name:e.id+"_filter-child-"+i+"-"+o,id:e.id+"_filter-child-"+i+"-"+o,placeholder:"Выберите вариант",options:{data:d(s)},on:{onItemClick:function(){$$(t).clearValidation(),$$("btnFilterSubmit").enable()}}};if("boolean"==n)return{view:"combo",name:e.id+"_filter-child-"+i+"-"+o,id:e.id+"_filter-child-"+i+"-"+o,placeholder:"Выберите вариант",options:[{id:1,value:"Да"},{id:2,value:"Нет"}],on:{onItemClick:function(){$$(t).clearValidation(),$$("btnFilterSubmit").enable()}}};if("datepicker"==n)return{view:"datepicker",name:e.id+"_filter-child-"+i+"-"+o,id:e.id+"_filter-child-"+i+"-"+o,format:"%d.%m.%Y %H:%i:%s",placeholder:"дд.мм.гг",timepicker:!0,on:{onItemClick:function(){$$(t).clearValidation(),$$("btnFilterSubmit").enable()}}};if("integer"==n)return{view:"text",name:e.id+"_filter-child-"+i+"-"+o,id:e.id+"_filter-child-"+i+"-"+o,invalidMessage:"Поле поддерживает только числовой формат",placeholder:"Введите число",on:{onItemClick:function(){$$(t).clearValidation(),$$("btnFilterSubmit").enable()}},validate:function(e){return!isNaN(1*e)}}}catch(e){console.log(e),r("012-000",e)}}function l(e,t){try{let i=$$(e);if(t.includes("eql"))return i.setValue("=");if(t.includes("notEqual"))return i.setValue("!=");if(t.includes("less"))return i.setValue("<");if(t.includes("more"))return i.setValue(">");if(t.includes("mrEqual"))return i.setValue(">=");if(t.includes("lsEqual"))i.setValue("<=");else if(t.includes("contains"))return i.setValue("⊆")}catch(e){console.log(e),r("012-000",e)}}function c(){return webix.once((function(){"combo"==n?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"})):"text"==n?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"содержит",id:"operations_contains"})):"datepicker"==n?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"<",id:"operations_less"}),this.add({value:">",id:"operations_more"}),this.add({value:">=",id:"operations_mrEqual"}),this.add({value:"<=",id:"operations_lsEqual"})):"integer"==n&&(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"<",id:"operations_less"}),this.add({value:">",id:"operations_more"}),this.add({value:">=",id:"operations_mrEqual"}),this.add({value:"<=",id:"operations_lsEqual"}),this.add({value:"содержит",id:"operations_contains"}))}))}return{id:e.id+"_filter_container-btns",css:{"margin-top":"27px!important"},hidden:!0,cols:[{view:"button",id:e.id+"_filter-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){l(e.id+"_filter-btnFilterOperations",t)},onAfterLoad:c()}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns",value:"+",id:e.id+"_filter_condition",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[{value:"и",id:"add_and"},{value:"или",id:"add_or"}],on:{onMenuItemClick(t){let n=$$(e.id+"_filter_rows").getChildViews().length;t.includes("and")?$$(e.id+"_filter_rows").addView({id:e.id+"_filter-container-child-"+n,padding:5,rows:[{template:"<div style='color:var(--primary)'>+ и</div>",height:30,borderless:!0},{cols:[a("operAnd"),{id:e.id+"_filter_container-btns"+n,cols:[{view:"button",id:e.id+"_filter-child-operAnd-"+n+"-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){l(e.id+"_filter-child-operAnd-"+n+"-btnFilterOperations",t)},onAfterLoad:c()}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns webix_danger",id:e.id+"_filter-"+n+"_remove",type:"icon",icon:"wxi-trash",inputHeight:38,width:40,click:function(){try{$("Поле фильтра будет удалено").then((function(){$$(e.id+"_filter_rows").removeView($$(e.id+"_filter-container-child-"+n)),$$(e.id+"_filter_rows").refresh(),i("success","Поле удалено")}))}catch(e){i("error","Ошибка удаления поля")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить поле фильтра")}}}]}]}]},n):t.includes("or")&&$$(e.id+"_filter_rows").addView({id:e.id+"_filter-container-child-operOr-"+n,padding:5,rows:[{template:"<div style='color:var(--primary)'>+ или</div>",height:30,borderless:!0},{cols:[a("operOr"),{id:e.id+"_filter_container-btns"+n,cols:[{view:"button",id:e.id+"_filter-child-operOr-"+n+"-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){l(e.id+"_filter-child-operOr-"+n+"-btnFilterOperations",t)},onAfterLoad:c()}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns webix_danger",id:e.id+"_filter-operOr-"+n+"_remove",type:"icon",icon:"wxi-trash",inputHeight:38,width:40,click:function(){try{$("Поле фильтра будет удалено").then((function(){$$(e.id+"_filter_rows").removeView($$(e.id+"_filter-container-child-operOr-"+n)),i("success","Поле удалено")}))}catch(e){i("error","Ошибка удаления поля")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить поле фильтра")}}}]}]}]},n)}}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить ещё вариант поля")}}}]}}function h(e,t=1){try{let i=$$("table").getColumns();if(0==Object.keys($$(e).elements).length){let n=[];i.forEach(((t,i)=>{if("datetime"==t.type)n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"datepicker",format:"%d.%m.%Y %H:%i:%s",id:t.id+"_filter",name:t.id+"_filter",hidden:!0,label:t.label,placeholder:"дд.мм.гг",timepicker:!0,labelPosition:"top",on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},u(t,e,"datepicker")]}]});else if(t.type.includes("reference")){let i=t.type.slice(10);n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id+"_filter",hidden:!0,name:t.id+"_filter",labelPosition:"top",options:{data:d(i)},on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},u(t,e,"combo")]}]})}else t.type.includes("boolean")?n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id+"_filter",hidden:!0,name:t.id+"_filter",labelPosition:"top",options:[{id:1,value:"Да"},{id:2,value:"Нет"}],on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},u(t,e,"combo")]}]}):t.type.includes("integer")?n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,css:"webix_inputs-show",cols:[{view:"text",name:t.id+"_filter",id:t.id+"_filter",css:{"padding-bottom":"5px!important"},placeholder:"Введите число",hidden:!0,label:t.label,labelPosition:"top",invalidMessage:"Поле поддерживает только числовой формат",on:{onKeyPress:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}},validate:function(e){return!isNaN(1*e)}},u(t,e,"integer")]}]}):n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,css:"webix_inputs-show",cols:[{view:"text",name:t.id+"_filter",id:t.id+"_filter",css:{"passing-bottom":"5px!important"},placeholder:"Введите текст",hidden:!0,label:t.label,labelPosition:"top",on:{onKeyPress:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},u(t,e,"text")]}]})}));let o={margin:8,id:"inputsFilter",css:"webix_inputs-table-filter",rows:n};return"table-editForm"==e&&$$("table-delBtnId").enable(),$$(e).addView(o,t)}$$(e).clear(),$$(e).clearValidation(),"table-editForm"==e&&$$("table-delBtnId").enable(),$$("inputsFilter").show()}catch(e){console.log(e),r("012-000",e)}}return{rows:[{css:"webix_filterBar",padding:17,height:80,margin:5,cols:[{view:"button",width:50,type:"icon",id:l,hidden:c,icon:"wxi-filter",css:"webix_btn-filter",title:"текст",height:50,click:function(){try{if(window.innerWidth>1200){"filterTableBarContainer"!==$$("editFilterBarAdaptive").getParentView().config.id&&$$("filterTableBarContainer").addView($$("editFilterBarAdaptive")),$$("editFilterBarHeadline")&&$$("editFilterBarHeadline").hide(),$$("editFilterBarAdaptive").config.width=350,$$("editFilterBarAdaptive").resize(),$$(a).clearSelection();let e=document.querySelector(".webix_btn-filter");e.classList.contains("webix_primary")?($$("filterTableForm").hide(),$$("table-editForm").show(),e.classList.add("webix_secondary"),e.classList.remove("webix_primary"),$$(n).hide(),$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").hide(),$$("editTableBarContainer")&&!$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").show()):($$("filterTableForm").show(),$$("table-editForm").hide(),0!==$$("filterTableForm").getChildViews()&&h("filterTableForm",3),e.classList.add("webix_primary"),e.classList.remove("webix_secondary"),$$(n).show(),$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide(),$$("filterTableBarContainer")&&!$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").show())}else{$$("tableFilterPopup")&&$$("tableFilterPopup").show(),$$("tableFilterPopupContainer")&&!$$("tableFilterPopupContainer").isVisible()&&$$("tableFilterPopupContainer").show(),$$("tableFilterPopupContainer")&&$$("tableFilterPopupContainer").addView($$("editFilterBarAdaptive")),$$("editFilterBarHeadline")&&!$$("editFilterBarHeadline").isVisible()&&$$("editFilterBarHeadline").show(),console.log($$("filterTableForm").getChildViews()),0!==$$("filterTableForm").getChildViews()&&h("filterTableForm",3),$$("filterTableForm").show();let e=window.innerWidth-200;$$("editFilterBarAdaptive").$width>200&&($$("editFilterBarAdaptive").config.width=e,$$("editFilterBarAdaptive").resize())}}catch(e){console.log(e),r("012-000",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть фильтры")}}},{view:"button",maxWidth:200,value:"<span class='webix_icon wxi-pencil'></span><span style='padding-left: 4px'>Редактор таблицы</span>",id:n,hidden:!0,css:"webix_btn-edit",title:"текст",height:50,click:function(){try{if(window.innerWidth>1200){let e=document.querySelector(".webix_btn-filter");$$("filterTableForm").hide(),$$("table-editForm").show(),e.classList.add("webix_secondary"),e.classList.remove("webix_primary"),$$(n).hide(),$$("editTableBarContainer")&&$$("editTableBarContainer").show()}else if($$("tableEditPopup")){$$("tableEditPopup").show(),$$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable();let e=window.innerWidth-200;$$("editTableBarAdaptive").$width>200&&($$("editTableBarAdaptive").config.width=e,$$("editTableBarAdaptive").resize())}else webix.ui({view:"popup",css:"webix_popup-table-container webix_popup-config",modal:!0,id:"tableEditPopup",escHide:!0,position:"center",body:{id:"tableEditPopupContainer",rows:[]}}).show(),$$("tableEditPopupContainer").addView($$("editTableBarAdaptive")),$$("editTableBarHeadline")&&!$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").show()}catch(e){console.log(e),r("012-000",e)}},on:{onAfterRender:function(){"table"!==a&&this.isVisible()&&this.hide(),this.getInputNode().setAttribute("title","Редактировать таблицу")}}},{},{view:"button",width:50,type:"icon",id:t,hidden:c,icon:"wxi-download",css:"webix_btn-download",title:"текст",height:50,click:function(){webix.toExcel(a,{filename:"Table",filterHTML:!0,styles:!0}),i("success","Таблица сохранена")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Экспорт таблицы")}}}]},{cols:[{view:"template",id:o,css:"webix_style-template-count",height:30,template:function(){return 0!==Object.keys($$(o).getValues()).length?"<div style='color:#999898;'> Общее количество записей: "+$$(o).getValues()+" </div>":""}},{view:"template",id:s,css:"webix_style-template-count",height:30,template:function(){return 0!==Object.keys($$(s).getValues()).length?"<div style='color:#999898;'>Видимое количество записей: "+$$(s).getValues()+" </div>":""}}]}]}}function A(e,t,n=!1){return{view:"datatable",id:e,css:"webix_table-style webix_header_border webix_data_border",resizeColumn:!0,autoConfig:!0,editable:n,editaction:"dblclick",minHeight:350,datafetch:5,datathrottle:5e3,loadahead:100,footer:!0,minWidth:500,select:!0,minColumnWidth:200,on:t,onClick:{"wxi-trash":function(){try{$("Запись будет удалена").then((function(){let t=$$(e).getItem(id),n=$$("tree").getSelectedItem().id;webix.ajax().del("/init/default/api/"+n+"/"+t.id+".json",t,{success:function(){$$(e).remove($$(e).getSelectedId()),i("success","Данные успешно удалены")},error:function(e,t,i){s("012-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("012-000",e.status,e.statusText,e.responseURL)}))}))}catch(e){console.log(e),r("012-000",e)}},"wxi-angle-down":function(e,t,i){try{if($$("propTableView").isVisible())$$("propTableView").hide(),$$("propResize").hide();else{let e=t.row,i=urlFieldAction.search("{"),n=urlFieldAction.slice(0,i);webix.ajax(n+e+".json",{success:function(e,t,i){try{t=t.json().content;let e=[];t.forEach((function(t,i){e.push({type:"text",id:i+1,label:t.name,value:t.value})})),$$("propTableView").define("elements",e),$$("propTableView").show(),$$("propResize").show()}catch(e){console.log(e),r("012-000",e)}},error:function(e,t,i){s("012-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("012-000",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),r("012-000",e)}}}}}let V={onBeforeLoad:function(){this.showOverlay("Загрузка...")},onAfterEditStop:function(e,t,i){try{e.value!=e.old&&($$(t.column).setValue(e.value),w())}catch(e){console.log(e),r("012-011",e)}},onAfterSelect(e){try{if($$("table-editTableBtnId").isVisible()&&window.innerWidth>1200&&$$("table-editTableBtnId").hide(),$$("table-newAddBtnId")&&$$("table-newAddBtnId").enable(),$$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide(),!$$("table-editForm").isVisible()){$$("table-editForm").show(),$$("filterTableForm").hide();let e=document.querySelector(".webix_btn-filter");e.classList.add("webix_secondary"),e.classList.remove("webix_primary")}window.innerWidth<1200&&($$("tableEditPopup")?$$("tableEditPopup").show():(webix.ui({view:"popup",css:"webix_popup-table-container webix_popup-config",modal:!0,id:"tableEditPopup",escHide:!0,position:"center",body:{id:"tableEditPopupContainer",rows:[]}}).show(),$$("tableEditPopupContainer").addView($$("editTableBarAdaptive")),$$("editTableBarHeadline")&&!$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").show()),$$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide())}catch(e){console.log(e),r("012-000",e)}let t=$$("table").getItem(e);function n(){try{$$("table-editForm").setValues(t),$$("table-saveNewBtn").hide(),$$("table-saveBtn").show(),$$("table-editForm").clearValidation()}catch(e){console.log(e),r("012-000",e)}}if($$("table-editForm").isDirty())try{b().then((function(e){if(1==e)$$("table-editForm").clear(),$$("table-delBtnId").enable(),n();else if(2==e){if(!$$("table-editForm").validate())return i("error","Заполните пустые поля"),!1;$$("table-editForm").getValues().id?w():v(),$$("table-editForm").clear(),$$("table-delBtnId").enable(),n()}}))}catch(e){console.log(e),r("012-000",e)}else x("table-editForm"),n()},onAfterLoad:function(){try{this.hideOverlay(),T()}catch(e){console.log(e),r("012-000",e)}},onAfterDelete:function(){try{$$("table-findElements").setValues($$("table").count().toString()),this.count()||this.showOverlay("Ничего не найдено"),this.count()&&this.hideOverlay()}catch(e){console.log(e),r("012-000",e)}},onAfterAdd:function(){try{$$("table-findElements").setValues($$("table").count().toString()),this.hideOverlay()}catch(e){console.log(e),r("012-000",e)}},onAfterRender:function(){window.innerWidth<1200&&$$("table-editTableBtnId")&&!$$("table-editTableBtnId").isVisible()&&$$("table-editTableBtnId").show()}};const B={id:"layout-cp",cols:[{view:"form",id:"cp-form",borderless:!0,margin:5,elements:[{template:"<div>Изменение пароля</div>",css:"webix_cp-form",height:35,borderless:!0},{view:"template",id:"authName",css:"webix_userprefs-info",template:function(){return 0!==Object.keys($$("authName").getValues()).length?"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600' >"+$$("authName").getValues()+"<div>":"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀ <div style='display:inline-block;font-size:13px!important;font-weight:600'>не указано</div>"},height:50,borderless:!0},{view:"text",width:300,labelPosition:"top",type:"password",label:"Старый пароль",name:"oldPass"},{view:"text",width:300,labelPosition:"top",type:"password",label:"Новый пароль",name:"newPass"},{view:"text",width:300,labelPosition:"top",type:"password",label:"Повтор нового пароля",name:"repeatPass"},{margin:5,cols:[{view:"button",height:48,width:300,value:"Сменить пароль",css:"webix_primary",click:function(){try{if($$("cp-form").validate()){let e={op:"",np:""},t=$$("cp-form").getValues();e.np=t.newPass,e.op=t.oldPass,webix.ajax().post("/init/default/api/cp",e,{success:function(e,t,n){"i"==(t=t.json()).err_type?i("success",t.err):"e"==t.err_type&&i("error",t.err),$$("cp-form").setDirty(!1)},error:function(e,t,i){s("011-000",i.status,i.statusText,i.responseURL)}})}}catch(e){console.log(e),r("011-000",e)}}}]}],rules:{$all:webix.rules.isNotEmpty,$obj:function(e){return e.newPass!=e.repeatPass?(i("error","Новый пароль не совпадает с повтором"),!1):e.newPass!=e.oldPass||!$$("cp-form").isDirty()||(i("error","Новый пароль должен отличаться от старого"),!1)}}},{}]};let k={userprefsOther:{},userprefsWorkspace:{}};function I(){const e=$$("userprefsTabbar").getValue()+"Form";if($$(e).isDirty())try{webix.ajax().get("/init/default/api/userprefs/",{success:function(n,o,a){"e"==(o=o.json().content).err_type&&i("error",o.error);let l=!1;const c=$$(e).getValues();let u={name:e,prefs:c};try{o.forEach((function(n,o){n.name==e&&(l=!0,webix.ajax().put("/init/default/api/userprefs/"+n.id,u,{success:function(n,o,r){"i"==(o=o.json()).err_type&&(t(e,JSON.stringify($$(e).getValues())),i("success","Настройки сохранены")),"e"==o.err_type&&i("error",o.error),k[$$("userprefsTabbar").getValue()]=c,$$(e).setDirty(!1)},error:function(e,t,i){s("015-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("015-011",e.status,e.statusText,e.responseURL)})))}))}catch(e){console.log(e),r("015-000",e)}try{if(!l){let n=webix.storage.local.get("user").id;n?u.owner=n:webix.ajax("/init/default/api/whoami",{success:function(e,i,n){u.owner=i.json().content.id;let o={};o.id=i.json().content.id,o.name=i.json().content.first_name,o.username=i.json().content.username,t("user",JSON.stringify(o))},error:function(e,t,i){s("005-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("005-000",e.status,e.statusText,e.responseURL)})),webix.ajax().post("/init/default/api/userprefs/",u,{success:function(t,n,o){"i"==(n=n.json()).err_type?i("success","Настройки сохранены"):"e"==n.err_type&&i("error",n.error),k[$$("userprefsTabbar").getValue()]=c,$$(e).setDirty(!1)},error:function(e,t,i){s("015-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("015-001",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),r("015-000",e)}},error:function(e,t,i){s("015-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("015-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),r("015-000",e)}else i("debug","Сохранять нечего")}const F={rows:[{padding:{top:15,bottom:0,left:20,right:0},rows:[{view:"template",template:"<div>Настройки</div>",css:"webix_headline-userprefs",height:35,borderless:!0},{view:"template",id:"userprefsName",css:"webix_userprefs-info",template:function(){return 0!==Object.keys($$("userprefsName").getValues()).length?"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600' >"+$$("userprefsName").getValues()+"<div>":"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div><div style='display:inline-block;font-size:13px!important;font-weight:600'>не указано</div>"},height:50,borderless:!0}]},{rows:[{view:"tabbar",type:"top",id:"userprefsTabbar",css:"webix_filter-popup-tabbar",multiview:!0,options:[{value:"<span class='webix_tabbar-filter-headline'>Рабочее пространство</span>",id:"userprefsWorkspace"},{value:"<span class=webix_tabbar-filter-headline'>Другое</span>",id:"userprefsOther"}],height:50,on:{onBeforeTabClick:function(e){const t=$$("userprefsTabbar").getValue()+"Form";try{if($$(t).isDirty())return webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"}).then((function(i){if(1==i){let i=webix.storage.local.get(t);$$(t).setValues(i),$$("userprefsTabbar").setValue(e),$$("userprefsSaveBtn").isEnabled()&&$$("userprefsSaveBtn").disable(),$$("userprefsResetBtn").isEnabled()&&$$("userprefsResetBtn").disable()}else 2==i&&(I(),$$("userprefsTabbar").setValue(e))})),!1}catch(e){console.log(e),r("005-000",e)}}}},{cells:[{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsWorkspace",scroll:"y",body:{view:"form",id:"userprefsWorkspaceForm",borderless:!0,elements:[{cols:[{rows:[{view:"radio",labelPosition:"top",name:"logBlockOpt",label:"Отображение блока системных сообщений",value:1,options:[{id:1,value:"Показать"},{id:2,value:"Скрыть"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть по умолчанию блок системных сообщений")},onChange:function(e,t,i){try{e!==t&&(1==e?$$("webix_log-btn").setValue(2):$$("webix_log-btn").setValue(1))}catch(e){console.log(e),r("015-000",e)}}}},{height:15},{view:"select",name:"LoginActionOpt",label:"Действие после входа в систему",labelPosition:"top",value:2,options:[{id:1,value:"Перейти на главную страницу"},{id:2,value:"Перейти на последнюю открытую страницу"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показывать/не показывать всплывающее окно при загрузке приложения")}}}]},{}]}],on:{onChange:function(){this.isDirty()&&!$$("userprefsSaveBtn").isEnabled()?$$("userprefsSaveBtn").enable():this.isDirty()||$$("userprefsSaveBtn").disable(),this.isDirty()&&!$$("userprefsResetBtn").isEnabled()?$$("userprefsResetBtn").enable():this.isDirty()||$$("userprefsResetBtn").disable()}}}},{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsOther",scroll:"y",body:{view:"form",id:"userprefsOtherForm",borderless:!0,elements:[{view:"radio",labelPosition:"top",label:"Автообновление специфичных страниц",value:1,name:"autorefOpt",options:[{id:1,value:"Включено"},{id:2,value:"Выключено"}],on:{onChange:function(e,t,i){try{1!=e||$$("userprefsAutorefCounter").isVisible()||$$("userprefsAutorefCounter").show(),2==e&&$$("userprefsAutorefCounter").isVisible()&&$$("userprefsAutorefCounter").hide()}catch(e){console.log(e),r("015-000",e)}}}},{height:5},{view:"counter",id:"userprefsAutorefCounter",labelPosition:"top",name:"autorefCounterOpt",label:"Интервал автообновления (в миллисекундах)",min:15e3,max:9e5,on:{onChange:function(e,t,i){try{const t=$$("userprefsAutorefCounter").config.min,i=$$("userprefsAutorefCounter").config.max;e==t?webix.message({type:"debug",expire:1e3,text:"Минимальное возможное значение"}):e==i&&webix.message({type:"debug",expire:1e3,text:"Максимальное возможное значение"})}catch(e){console.log(e),r("015-000",e)}}}},{}],on:{onChange:function(){this.isDirty()&&!$$("userprefsSaveBtn").isEnabled()?$$("userprefsSaveBtn").enable():this.isDirty()||$$("userprefsSaveBtn").disable(),this.isDirty()&&!$$("userprefsResetBtn").isEnabled()?$$("userprefsResetBtn").enable():this.isDirty()||$$("userprefsResetBtn").disable()}}}}]},{cols:[{width:20},{view:"button",height:48,value:"Сбросить",id:"userprefsResetBtn",disabled:!0},{width:10},{view:"button",value:"Сохранить настройки",height:48,id:"userprefsSaveBtn",css:"webix_primary",disabled:!0,click:I},{width:20}]}]}]};let j={};function P(){try{let e=$$("filterPopupTabbar").getValue();if("editFormPopupLib"==e)webix.message({type:"debug",expire:3e3,text:"Библиотека в разработке"});else if("editFormScroll"==e){$$("filterLibrarySaveBtn")&&!$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").enable();let e,t,n,o=$$("editFormPopup").getValues();Object.keys(o).forEach((function(i,r){if(n=i.lastIndexOf("_"),t=i.slice(0,n),e=document.querySelectorAll(".webix_filter-inputs"),o[i])$$(i).isVisible()||(e.forEach((function(e,i){e.classList.contains(t)?(e.classList.contains("webix_show-content")||e.classList.add("webix_show-content"),e.classList.contains("webix_hide-content")&&e.classList.remove("webix_hide-content")):e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content")})),$$(i).show(),$$(i+"_container-btns")&&!$$(i+"_container-btns").isVisible()&&$$(i+"_container-btns").show()),$$("resetFilterBtn").enable(),$$("filterEmptyTempalte").isVisible()&&($$("filterEmptyTempalte").hide(),$$("filterEmptyTempalte").refresh());else if($$(i).isVisible()&&(e.forEach((function(e,i){e.classList.contains(t)&&(e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content"),e.classList.contains("webix_show-content")&&e.classList.remove("webix_show-content"))})),$$(i).hide()),$$(i+"_container-btns")&&$$(i+"_container-btns").isVisible()&&$$(i+"_container-btns").hide(),$$(i+"_rows")){let e=$$(i+"_rows").getChildViews();Object.values(e).forEach((function(e,t){e.config.id.includes("child")&&$$(i+"_rows").removeView($$(e.config.id))}))}$$(i).refresh()}));let r=0;Object.values($$("filterTableForm").elements).forEach((function(e,t){e.config.hidden||r++})),r||$$("filterEmptyTempalte").isVisible()||($$("filterEmptyTempalte").show(),$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").disable(),$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").disable()),$$("popupFilterEdit").destructor(),i("success","Рабочая область фильтра обновлена")}}catch(e){$$("popupFilterEdit").destructor(),i("error","Ошибка при обновлении фильтров")}}function S(){webix.ui({view:"popup",id:"popupFilterEdit",css:"webix_popup-filter-container webix_popup-config",modal:!0,escHide:!0,position:"center",height:400,width:400,body:{scroll:"y",rows:[{css:"webix_filter-headline-wrapper",cols:[{template:"Редактор фильтров",css:"webix_template-recover",borderless:!0,height:40},{width:150},{view:"button",id:"buttonClosePopup",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("popupFilterEdit")&&$$("popupFilterEdit").destructor()}}]},{template:"Выберите нужные поля или шаблон из библиотеки",borderless:!0,height:47},{view:"form",id:"editFormPopup",css:"webix_edit-form-popup",borderless:!0,elements:[{rows:[{view:"tabbar",type:"top",id:"filterPopupTabbar",css:"webix_filter-popup-tabbar",multiview:!0,options:[{value:"<span class='webix_tabbar-filter-headline'>Поля</span>",id:"editFormScroll"},{value:"<span class=webix_tabbar-filter-headline'>Библиотека</span>",id:"editFormPopupLib"}],height:50,on:{onAfterTabClick:function(e){!function(e){function t(e){try{"enable"==e?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():"disable"==e&&$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable()}catch(e){console.log(e),r("004-000",e)}}try{if("editFormPopupLib"==e&&(""!==$$("filterEditLib").getValue()?t("enable"):t("disable")),"editFormScroll"==e){let e=$$("editFormPopup").getValues(),i=0;Object.values(e).forEach((function(e,t){e&&i++})),t(i>0?"enable":"disable")}}catch(e){console.log(e),r("004-000",e)}}(e)}}},{height:200,cells:[{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"editFormScroll",scroll:"y",body:{id:"editFormPopupScroll",rows:[]}},{view:"form",id:"editFormPopupLib",css:"webix_multivew-cell",borderless:!0,elements:[{view:"radio",id:"filterEditLib",vertical:!0,options:[{id:"radioNoneContent",disabled:!0,value:"Сохранённых шаблонов нет"}],on:{onChange:function(){try{this.getValue()&&$$("popupFilterSubmitBtn")&&($$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable())}catch(e){console.log(e),r("004-000",e)}},onAfterRender:function(){try{Object.keys(j).length>0&&($$("filterEditLib").addOption(j),$$("filterEditLib").removeOption("radioNoneContent"))}catch(e){console.log(e),r("004-000",e)}}}}]}]},{height:20},{view:"button",id:"popupFilterSubmitBtn",height:48,minWidth:140,disabled:!0,css:"webix_primary",hotkey:"Enter",value:"Применить",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбранные фильтры будут добавлены в рабочее поле, остальные скрыты")}},click:P}]},{}]}]}}).show();let e=window.innerWidth-200;$$("popupFilterEdit").$width>200&&($$("popupFilterEdit").config.width=e,$$("popupFilterEdit").resize());let t=[{cols:[{id:"editFormPopupScrollContent",css:"webix_edit-form-popup-scroll-content",rows:[{view:"checkbox",id:"selectAll",labelRight:"<div style='font-weight:600'>Выбрать всё</div>",labelWidth:0,name:"selectAll",on:{onChange:function(){try{this.getValue()?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable(),$$("editFormPopupScrollContent").getChildViews().forEach((function(e,t){e.config.id.includes("checkbox")&&($$("selectAll").getValue()?e.config.value=1:e.config.value=0,$$(e).refresh())}))}catch(e){console.log(e),r("004-000",e)}}}}]}]}],i=[],n=$$("filterTableForm").elements;try{Object.values(n).forEach((function(e,t){i.push({id:e.config.id,label:e.config.label})}))}catch(e){console.log(e),r("004-000",e)}function o(e){try{let t=$$(e.id+"_checkbox").getParentView().getChildViews(),i=0,n=0;t.forEach((function(e,t){e.config.id.includes("checkbox")&&(e.config.value&&""!=e.config.value||i++),e.config.value&&n++})),n>0?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable(),0==i?($$("selectAll").config.value=1,$$("selectAll").refresh()):0!==$$("selectAll").config.value&&($$("selectAll").config.value=0,$$("selectAll").refresh())}catch(e){console.log(e),r("004-000",e)}}try{i.forEach((function(e,i){e.id.includes("child")||($$(e.id)&&$$(e.id).isVisible()?t[0].cols[0].rows.push({view:"checkbox",id:e.id+"_checkbox",labelRight:e.label,labelWidth:0,name:e.id,value:1,on:{onChange:function(){o(e)}}}):t[0].cols[0].rows.push({view:"checkbox",id:e.id+"_checkbox",labelRight:e.label,labelWidth:0,name:e.id,on:{onChange:function(){o(e)}}}))})),$$("editFormPopupScroll").addView({rows:t},1)}catch(e){console.log(e),r("004-000",e)}let s=0,a=$$("editFormPopupScrollContent").getChildViews();try{a.forEach((function(e,t){e.config.id.includes("checkbox")&&(e.config.value&&""!=e.config.value||s++)})),0==s&&($$("selectAll").config.value=1,$$("selectAll").refresh())}catch(e){console.log(e),r("004-000",e)}}function C(){try{let e=$$("tree").getSelectedItem().id;webix.ajax("/init/default/api/smarts?query="+e+".id >= 0&sorts="+e+".id&offset=0",{success:function(e,t,n){0!==(t=t.json().content).length?($$("table").hideOverlay("Ничего не найдено"),$$("table").clearAll(),$$("table").parse(t)):($$("table").clearAll(),$$("table").showOverlay("Ничего не найдено"));let o=$$("table").count();$$("table-idFilterElements").setValues(o.toString()),i("success","Фильтры очищены"),$$("tableFilterPopup")&&$$("tableFilterPopup").isVisible()&&$$("tableFilterPopup").hide()},error:function(e,t,n){s("004-000",n.status,n.statusText,n.responseURL),i("error","Ошибка очистки фильтров")}}).catch((e=>{console.log(e),s("004-000",e.status,e.statusText,e.responseURL)}))}catch(e){i("error","Ошибка при очищении фильтров")}}function R(){let e=$$("filterTableForm").getValues(),t=[];function n(e,i,n,o,s,a=!1){let l=$$("tree").getSelectedItem().id,c=$$(n+"-btnFilterOperations").config.value;try{"parent"==s?a?"="==c?t.push("+and+"+l+"."+i+"+=+"+e):"!="==c?t.push("+and+"+l+"."+i+"+!=+"+e):"<"==c?t.push("+and+"+l+"."+i+"+<+"+e):">"==c?t.push("+and+"+l+"."+i+"+>+"+e):"<="==c?t.push("+and+"+l+"."+i+"+<=+"+e):">="==c?t.push("+and+"+l+"."+i+"+>=+"+e):"⊆"==c&&t.push("+and+"+l+"."+i+"+contains+"+e):"="==c?t.push(l+"."+i+"+=+"+e):"!="==c?t.push(l+"."+i+"+!=+"+e):"<"==c?t.push(l+"."+i+"+<+"+e):">"==c?t.push(l+"."+i+"+>+"+e):"<="==c?t.push(l+"."+i+"+<=+"+e):">="==c?t.push(l+"."+i+"+>=+"+e):"⊆"==c&&t.push(l+"."+i+"+contains+"+e):"child"==s&&("="==c?t.push("+"+o+"+"+i+"+=+"+e):"!="==c?t.push("+"+o+"+"+i+"+!=+"+e):"<"==c?t.push("+"+o+"+"+i+"+<+"+e):">"==c?t.push("+"+o+"+"+i+"+>+"+e):">="==c?t.push("+"+o+"+"+i+"+>=+"+e):"<="==c?t.push("+"+o+"+"+i+"+<=+"+e):"⊆"==c&&t.push("+"+o+"+"+i+"+contains+"+e))}catch(e){console.log(e),r("004-000",e)}}if($$("filterTableForm").validate()){let o,a,l=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s");try{Object.keys(e).sort().forEach((function(t,i){o=t,a=e[t],a&&("datepicker"==$$(t).config.view&&(a=l(e[t])),$$(t).config.text&&"Нет"==$$(t).config.text&&(a=0),t.includes("filter")&&!t.includes("condition")&&(o=t.lastIndexOf("_"),o=t.slice(0,o)),t.includes("condition")||""===e[t]||"selectAll"===t||t.includes("child")?t.includes("child")&&(t.includes("operAnd")?n(a,o,t,"and","child"):t.includes("operOr")&&n(a,o,t,"or","child")):i>0?n(a,o,t,"and","parent",!0):n(a,o,t,"and","parent"))}))}catch(e){console.log(e),r("004-000",e)}webix.ajax("/init/default/api/smarts?query="+t.join(""),{success:function(e,t,n){let o=t.json().err_type,r=t.json().err;0!==(t=t.json().content).length?($$("table").hideOverlay("Ничего не найдено"),$$("table").clearAll(),$$("table").parse(t)):($$("table").clearAll(),$$("table").showOverlay("Ничего не найдено"));let s=$$("table").count();$$("table-idFilterElements").setValues(s.toString()),"i"==o?(i("success","Фильтры успшено применены"),$$("tableFilterPopup")&&$$("tableFilterPopup").isVisible()&&$$("tableFilterPopup").hide()):"e"==o?i("error",r):"x"==o&&i("error","Ошибка фильтрации данных")},error:function(e,t,i){s("003-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("003-011",e.status,e.statusText,e.responseURL)}))}else i("error","Не все поля формы заполнены")}function L(){try{webix.prompt({title:"Название шаблона",ok:"Сохранить",cancel:"Отменить",css:"webix_prompt-filter-lib",input:{required:!0,placeholder:"Введите название шаблона..."},width:350}).then((function(e){let t=e,i=$$("filterTableForm").elements,n=[];Object.values(i).forEach((function(e,t){$$(e.config.id).isVisible()&&n.push(e)})),j={id:webix.uid(),value:t},webix.message({type:"success",expire:1e3,text:"Шаблон «"+t+"»  сохранён в библиотеку"})})).fail((function(){}))}catch(e){console.log(e),i("error","Не удалось сохранить шаблон"),r("004-001",e)}}webix.UIManager.addHotKey("Ctrl+Shift+E",(function(){Backbone.history.navigate("experimental/treeEdit",{trigger:!0})})),function(){!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("underscore",t):(e="undefined"!=typeof globalThis?globalThis:e||self,function(){var i=e._,n=e._=t();n.noConflict=function(){return e._=i,n}}())}(this,(function(){var e="1.13.4",t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},i=Array.prototype,n=Object.prototype,o="undefined"!=typeof Symbol?Symbol.prototype:null,r=i.push,s=i.slice,a=n.toString,l=n.hasOwnProperty,c="undefined"!=typeof ArrayBuffer,u="undefined"!=typeof DataView,d=Array.isArray,h=Object.keys,p=Object.create,f=c&&ArrayBuffer.isView,$=isNaN,b=isFinite,g=!{toString:null}.propertyIsEnumerable("toString"),w=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],m=Math.pow(2,53)-1;function v(e,t){return t=null==t?e.length-1:+t,function(){for(var i=Math.max(arguments.length-t,0),n=Array(i),o=0;o<i;o++)n[o]=arguments[o+t];switch(t){case 0:return e.call(this,n);case 1:return e.call(this,arguments[0],n);case 2:return e.call(this,arguments[0],arguments[1],n)}var r=Array(t+1);for(o=0;o<t;o++)r[o]=arguments[o];return r[t]=n,e.apply(this,r)}}function y(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function x(e){return void 0===e}function _(e){return!0===e||!1===e||"[object Boolean]"===a.call(e)}function T(e){var t="[object "+e+"]";return function(e){return a.call(e)===t}}var E=T("String"),A=T("Number"),V=T("Date"),B=T("RegExp"),k=T("Error"),I=T("Symbol"),F=T("ArrayBuffer"),j=T("Function"),P=t.document&&t.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof P&&(j=function(e){return"function"==typeof e||!1});var S=j,C=T("Object"),R=u&&C(new DataView(new ArrayBuffer(8))),L="undefined"!=typeof Map&&C(new Map),O=T("DataView"),N=R?function(e){return null!=e&&S(e.getInt8)&&F(e.buffer)}:O,U=d||T("Array");function H(e,t){return null!=e&&l.call(e,t)}var D=T("Arguments");!function(){D(arguments)||(D=function(e){return H(e,"callee")})}();var W=D;function z(e){return A(e)&&$(e)}function M(e){return function(){return e}}function q(e){return function(t){var i=e(t);return"number"==typeof i&&i>=0&&i<=m}}function J(e){return function(t){return null==t?void 0:t[e]}}var K=J("byteLength"),Y=q(K),G=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,Q=c?function(e){return f?f(e)&&!N(e):Y(e)&&G.test(a.call(e))}:M(!1),X=J("length");function Z(e,t){t=function(e){for(var t={},i=e.length,n=0;n<i;++n)t[e[n]]=!0;return{contains:function(e){return!0===t[e]},push:function(i){return t[i]=!0,e.push(i)}}}(t);var i=w.length,o=e.constructor,r=S(o)&&o.prototype||n,s="constructor";for(H(e,s)&&!t.contains(s)&&t.push(s);i--;)(s=w[i])in e&&e[s]!==r[s]&&!t.contains(s)&&t.push(s)}function ee(e){if(!y(e))return[];if(h)return h(e);var t=[];for(var i in e)H(e,i)&&t.push(i);return g&&Z(e,t),t}function te(e,t){var i=ee(t),n=i.length;if(null==e)return!n;for(var o=Object(e),r=0;r<n;r++){var s=i[r];if(t[s]!==o[s]||!(s in o))return!1}return!0}function ie(e){return e instanceof ie?e:this instanceof ie?void(this._wrapped=e):new ie(e)}function ne(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,K(e))}ie.VERSION=e,ie.prototype.value=function(){return this._wrapped},ie.prototype.valueOf=ie.prototype.toJSON=ie.prototype.value,ie.prototype.toString=function(){return String(this._wrapped)};var oe="[object DataView]";function re(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=typeof e;return("function"===o||"object"===o||"object"==typeof t)&&se(e,t,i,n)}function se(e,t,i,n){e instanceof ie&&(e=e._wrapped),t instanceof ie&&(t=t._wrapped);var r=a.call(e);if(r!==a.call(t))return!1;if(R&&"[object Object]"==r&&N(e)){if(!N(t))return!1;r=oe}switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return o.valueOf.call(e)===o.valueOf.call(t);case"[object ArrayBuffer]":case oe:return se(ne(e),ne(t),i,n)}var s="[object Array]"===r;if(!s&&Q(e)){if(K(e)!==K(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;s=!0}if(!s){if("object"!=typeof e||"object"!=typeof t)return!1;var l=e.constructor,c=t.constructor;if(l!==c&&!(S(l)&&l instanceof l&&S(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}n=n||[];for(var u=(i=i||[]).length;u--;)if(i[u]===e)return n[u]===t;if(i.push(e),n.push(t),s){if((u=e.length)!==t.length)return!1;for(;u--;)if(!re(e[u],t[u],i,n))return!1}else{var d,h=ee(e);if(u=h.length,ee(t).length!==u)return!1;for(;u--;)if(!H(t,d=h[u])||!re(e[d],t[d],i,n))return!1}return i.pop(),n.pop(),!0}function ae(e){if(!y(e))return[];var t=[];for(var i in e)t.push(i);return g&&Z(e,t),t}function le(e){var t=X(e);return function(i){if(null==i)return!1;var n=ae(i);if(X(n))return!1;for(var o=0;o<t;o++)if(!S(i[e[o]]))return!1;return e!==pe||!S(i[ce])}}var ce="forEach",ue=["clear","delete"],de=["get","has","set"],he=ue.concat(ce,de),pe=ue.concat(de),fe=["add"].concat(ue,ce,"has"),$e=L?le(he):T("Map"),be=L?le(pe):T("WeakMap"),ge=L?le(fe):T("Set"),we=T("WeakSet");function me(e){for(var t=ee(e),i=t.length,n=Array(i),o=0;o<i;o++)n[o]=e[t[o]];return n}function ve(e){for(var t={},i=ee(e),n=0,o=i.length;n<o;n++)t[e[i[n]]]=i[n];return t}function ye(e){var t=[];for(var i in e)S(e[i])&&t.push(i);return t.sort()}function xe(e,t){return function(i){var n=arguments.length;if(t&&(i=Object(i)),n<2||null==i)return i;for(var o=1;o<n;o++)for(var r=arguments[o],s=e(r),a=s.length,l=0;l<a;l++){var c=s[l];t&&void 0!==i[c]||(i[c]=r[c])}return i}}var _e=xe(ae),Te=xe(ee),Ee=xe(ae,!0);function Ae(e){if(!y(e))return{};if(p)return p(e);var t=function(){};t.prototype=e;var i=new t;return t.prototype=null,i}function Ve(e){return U(e)?e:[e]}function Be(e){return ie.toPath(e)}function ke(e,t){for(var i=t.length,n=0;n<i;n++){if(null==e)return;e=e[t[n]]}return i?e:void 0}function Ie(e,t,i){var n=ke(e,Be(t));return x(n)?i:n}function Fe(e){return e}function je(e){return e=Te({},e),function(t){return te(t,e)}}function Pe(e){return e=Be(e),function(t){return ke(t,e)}}function Se(e,t,i){if(void 0===t)return e;switch(null==i?3:i){case 1:return function(i){return e.call(t,i)};case 3:return function(i,n,o){return e.call(t,i,n,o)};case 4:return function(i,n,o,r){return e.call(t,i,n,o,r)}}return function(){return e.apply(t,arguments)}}function Ce(e,t,i){return null==e?Fe:S(e)?Se(e,t,i):y(e)&&!U(e)?je(e):Pe(e)}function Re(e,t){return Ce(e,t,1/0)}function Le(e,t,i){return ie.iteratee!==Re?ie.iteratee(e,t):Ce(e,t,i)}function Oe(){}function Ne(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}ie.toPath=Ve,ie.iteratee=Re;var Ue=Date.now||function(){return(new Date).getTime()};function He(e){var t=function(t){return e[t]},i="(?:"+ee(e).join("|")+")",n=RegExp(i),o=RegExp(i,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(o,t):e}}var De={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},We=He(De),ze=He(ve(De)),Me=ie.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},qe=/(.)^/,Je={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Ke=/\\|'|\r|\n|\u2028|\u2029/g;function Ye(e){return"\\"+Je[e]}var Ge=/^\s*(\w|\$)+\s*$/,Qe=0;function Xe(e,t,i,n,o){if(!(n instanceof t))return e.apply(i,o);var r=Ae(e.prototype),s=e.apply(r,o);return y(s)?s:r}var Ze=v((function(e,t){var i=Ze.placeholder,n=function(){for(var o=0,r=t.length,s=Array(r),a=0;a<r;a++)s[a]=t[a]===i?arguments[o++]:t[a];for(;o<arguments.length;)s.push(arguments[o++]);return Xe(e,n,this,this,s)};return n}));Ze.placeholder=ie;var et=v((function(e,t,i){if(!S(e))throw new TypeError("Bind must be called on a function");var n=v((function(o){return Xe(e,n,t,this,i.concat(o))}));return n})),tt=q(X);function it(e,t,i,n){if(n=n||[],t||0===t){if(t<=0)return n.concat(e)}else t=1/0;for(var o=n.length,r=0,s=X(e);r<s;r++){var a=e[r];if(tt(a)&&(U(a)||W(a)))if(t>1)it(a,t-1,i,n),o=n.length;else for(var l=0,c=a.length;l<c;)n[o++]=a[l++];else i||(n[o++]=a)}return n}var nt=v((function(e,t){var i=(t=it(t,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var n=t[i];e[n]=et(e[n],e)}return e})),ot=v((function(e,t,i){return setTimeout((function(){return e.apply(null,i)}),t)})),rt=Ze(ot,ie,1);function st(e){return function(){return!e.apply(this,arguments)}}function at(e,t){var i;return function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=null),i}}var lt=Ze(at,2);function ct(e,t,i){t=Le(t,i);for(var n,o=ee(e),r=0,s=o.length;r<s;r++)if(t(e[n=o[r]],n,e))return n}function ut(e){return function(t,i,n){i=Le(i,n);for(var o=X(t),r=e>0?0:o-1;r>=0&&r<o;r+=e)if(i(t[r],r,t))return r;return-1}}var dt=ut(1),ht=ut(-1);function pt(e,t,i,n){for(var o=(i=Le(i,n,1))(t),r=0,s=X(e);r<s;){var a=Math.floor((r+s)/2);i(e[a])<o?r=a+1:s=a}return r}function ft(e,t,i){return function(n,o,r){var a=0,l=X(n);if("number"==typeof r)e>0?a=r>=0?r:Math.max(r+l,a):l=r>=0?Math.min(r+1,l):r+l+1;else if(i&&r&&l)return n[r=i(n,o)]===o?r:-1;if(o!=o)return(r=t(s.call(n,a,l),z))>=0?r+a:-1;for(r=e>0?a:l-1;r>=0&&r<l;r+=e)if(n[r]===o)return r;return-1}}var $t=ft(1,dt,pt),bt=ft(-1,ht);function gt(e,t,i){var n=(tt(e)?dt:ct)(e,t,i);if(void 0!==n&&-1!==n)return e[n]}function wt(e,t,i){var n,o;if(t=Se(t,i),tt(e))for(n=0,o=e.length;n<o;n++)t(e[n],n,e);else{var r=ee(e);for(n=0,o=r.length;n<o;n++)t(e[r[n]],r[n],e)}return e}function mt(e,t,i){t=Le(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=Array(o),s=0;s<o;s++){var a=n?n[s]:s;r[s]=t(e[a],a,e)}return r}function vt(e){var t=function(t,i,n,o){var r=!tt(t)&&ee(t),s=(r||t).length,a=e>0?0:s-1;for(o||(n=t[r?r[a]:a],a+=e);a>=0&&a<s;a+=e){var l=r?r[a]:a;n=i(n,t[l],l,t)}return n};return function(e,i,n,o){var r=arguments.length>=3;return t(e,Se(i,o,4),n,r)}}var yt=vt(1),xt=vt(-1);function _t(e,t,i){var n=[];return t=Le(t,i),wt(e,(function(e,i,o){t(e,i,o)&&n.push(e)})),n}function Tt(e,t,i){t=Le(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=0;r<o;r++){var s=n?n[r]:r;if(!t(e[s],s,e))return!1}return!0}function Et(e,t,i){t=Le(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=0;r<o;r++){var s=n?n[r]:r;if(t(e[s],s,e))return!0}return!1}function At(e,t,i,n){return tt(e)||(e=me(e)),("number"!=typeof i||n)&&(i=0),$t(e,t,i)>=0}var Vt=v((function(e,t,i){var n,o;return S(t)?o=t:(t=Be(t),n=t.slice(0,-1),t=t[t.length-1]),mt(e,(function(e){var r=o;if(!r){if(n&&n.length&&(e=ke(e,n)),null==e)return;r=e[t]}return null==r?r:r.apply(e,i)}))}));function Bt(e,t){return mt(e,Pe(t))}function kt(e,t,i){var n,o,r=-1/0,s=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,l=(e=tt(e)?e:me(e)).length;a<l;a++)null!=(n=e[a])&&n>r&&(r=n);else t=Le(t,i),wt(e,(function(e,i,n){((o=t(e,i,n))>s||o===-1/0&&r===-1/0)&&(r=e,s=o)}));return r}var It=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Ft(e){return e?U(e)?s.call(e):E(e)?e.match(It):tt(e)?mt(e,Fe):me(e):[]}function jt(e,t,i){if(null==t||i)return tt(e)||(e=me(e)),e[Ne(e.length-1)];var n=Ft(e),o=X(n);t=Math.max(Math.min(t,o),0);for(var r=o-1,s=0;s<t;s++){var a=Ne(s,r),l=n[s];n[s]=n[a],n[a]=l}return n.slice(0,t)}function Pt(e,t){return function(i,n,o){var r=t?[[],[]]:{};return n=Le(n,o),wt(i,(function(t,o){var s=n(t,o,i);e(r,t,s)})),r}}var St=Pt((function(e,t,i){H(e,i)?e[i].push(t):e[i]=[t]})),Ct=Pt((function(e,t,i){e[i]=t})),Rt=Pt((function(e,t,i){H(e,i)?e[i]++:e[i]=1})),Lt=Pt((function(e,t,i){e[i?0:1].push(t)}),!0);function Ot(e,t,i){return t in i}var Nt=v((function(e,t){var i={},n=t[0];if(null==e)return i;S(n)?(t.length>1&&(n=Se(n,t[1])),t=ae(e)):(n=Ot,t=it(t,!1,!1),e=Object(e));for(var o=0,r=t.length;o<r;o++){var s=t[o],a=e[s];n(a,s,e)&&(i[s]=a)}return i})),Ut=v((function(e,t){var i,n=t[0];return S(n)?(n=st(n),t.length>1&&(i=t[1])):(t=mt(it(t,!1,!1),String),n=function(e,i){return!At(t,i)}),Nt(e,n,i)}));function Ht(e,t,i){return s.call(e,0,Math.max(0,e.length-(null==t||i?1:t)))}function Dt(e,t,i){return null==e||e.length<1?null==t||i?void 0:[]:null==t||i?e[0]:Ht(e,e.length-t)}function Wt(e,t,i){return s.call(e,null==t||i?1:t)}var zt=v((function(e,t){return t=it(t,!0,!0),_t(e,(function(e){return!At(t,e)}))})),Mt=v((function(e,t){return zt(e,t)}));function qt(e,t,i,n){_(t)||(n=i,i=t,t=!1),null!=i&&(i=Le(i,n));for(var o=[],r=[],s=0,a=X(e);s<a;s++){var l=e[s],c=i?i(l,s,e):l;t&&!i?(s&&r===c||o.push(l),r=c):i?At(r,c)||(r.push(c),o.push(l)):At(o,l)||o.push(l)}return o}var Jt=v((function(e){return qt(it(e,!0,!0))}));function Kt(e){for(var t=e&&kt(e,X).length||0,i=Array(t),n=0;n<t;n++)i[n]=Bt(e,n);return i}var Yt=v(Kt);function Gt(e,t){return e._chain?ie(t).chain():t}function Qt(e){return wt(ye(e),(function(t){var i=ie[t]=e[t];ie.prototype[t]=function(){var e=[this._wrapped];return r.apply(e,arguments),Gt(this,i.apply(ie,e))}})),ie}wt(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=i[e];ie.prototype[e]=function(){var i=this._wrapped;return null!=i&&(t.apply(i,arguments),"shift"!==e&&"splice"!==e||0!==i.length||delete i[0]),Gt(this,i)}})),wt(["concat","join","slice"],(function(e){var t=i[e];ie.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),Gt(this,e)}}));var Xt={__proto__:null,VERSION:e,restArguments:v,isObject:y,isNull:function(e){return null===e},isUndefined:x,isBoolean:_,isElement:function(e){return!(!e||1!==e.nodeType)},isString:E,isNumber:A,isDate:V,isRegExp:B,isError:k,isSymbol:I,isArrayBuffer:F,isDataView:N,isArray:U,isFunction:S,isArguments:W,isFinite:function(e){return!I(e)&&b(e)&&!isNaN(parseFloat(e))},isNaN:z,isTypedArray:Q,isEmpty:function(e){if(null==e)return!0;var t=X(e);return"number"==typeof t&&(U(e)||E(e)||W(e))?0===t:0===X(ee(e))},isMatch:te,isEqual:function(e,t){return re(e,t)},isMap:$e,isWeakMap:be,isSet:ge,isWeakSet:we,keys:ee,allKeys:ae,values:me,pairs:function(e){for(var t=ee(e),i=t.length,n=Array(i),o=0;o<i;o++)n[o]=[t[o],e[t[o]]];return n},invert:ve,functions:ye,methods:ye,extend:_e,extendOwn:Te,assign:Te,defaults:Ee,create:function(e,t){var i=Ae(e);return t&&Te(i,t),i},clone:function(e){return y(e)?U(e)?e.slice():_e({},e):e},tap:function(e,t){return t(e),e},get:Ie,has:function(e,t){for(var i=(t=Be(t)).length,n=0;n<i;n++){var o=t[n];if(!H(e,o))return!1;e=e[o]}return!!i},mapObject:function(e,t,i){t=Le(t,i);for(var n=ee(e),o=n.length,r={},s=0;s<o;s++){var a=n[s];r[a]=t(e[a],a,e)}return r},identity:Fe,constant:M,noop:Oe,toPath:Ve,property:Pe,propertyOf:function(e){return null==e?Oe:function(t){return Ie(e,t)}},matcher:je,matches:je,times:function(e,t,i){var n=Array(Math.max(0,e));t=Se(t,i,1);for(var o=0;o<e;o++)n[o]=t(o);return n},random:Ne,now:Ue,escape:We,unescape:ze,templateSettings:Me,template:function(e,t,i){!t&&i&&(t=i),t=Ee({},t,ie.templateSettings);var n=RegExp([(t.escape||qe).source,(t.interpolate||qe).source,(t.evaluate||qe).source].join("|")+"|$","g"),o=0,r="__p+='";e.replace(n,(function(t,i,n,s,a){return r+=e.slice(o,a).replace(Ke,Ye),o=a+t.length,i?r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?r+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(r+="';\n"+s+"\n__p+='"),t})),r+="';\n";var s,a=t.variable;if(a){if(!Ge.test(a))throw new Error("variable is not a bare identifier: "+a)}else r="with(obj||{}){\n"+r+"}\n",a="obj";r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{s=new Function(a,"_",r)}catch(e){throw e.source=r,e}var l=function(e){return s.call(this,e,ie)};return l.source="function("+a+"){\n"+r+"}",l},result:function(e,t,i){var n=(t=Be(t)).length;if(!n)return S(i)?i.call(e):i;for(var o=0;o<n;o++){var r=null==e?void 0:e[t[o]];void 0===r&&(r=i,o=n),e=S(r)?r.call(e):r}return e},uniqueId:function(e){var t=++Qe+"";return e?e+t:t},chain:function(e){var t=ie(e);return t._chain=!0,t},iteratee:Re,partial:Ze,bind:et,bindAll:nt,memoize:function(e,t){var i=function(n){var o=i.cache,r=""+(t?t.apply(this,arguments):n);return H(o,r)||(o[r]=e.apply(this,arguments)),o[r]};return i.cache={},i},delay:ot,defer:rt,throttle:function(e,t,i){var n,o,r,s,a=0;i||(i={});var l=function(){a=!1===i.leading?0:Ue(),n=null,s=e.apply(o,r),n||(o=r=null)},c=function(){var c=Ue();a||!1!==i.leading||(a=c);var u=t-(c-a);return o=this,r=arguments,u<=0||u>t?(n&&(clearTimeout(n),n=null),a=c,s=e.apply(o,r),n||(o=r=null)):n||!1===i.trailing||(n=setTimeout(l,u)),s};return c.cancel=function(){clearTimeout(n),a=0,n=o=r=null},c},debounce:function(e,t,i){var n,o,r,s,a,l=function(){var c=Ue()-o;t>c?n=setTimeout(l,t-c):(n=null,i||(s=e.apply(a,r)),n||(r=a=null))},c=v((function(c){return a=this,r=c,o=Ue(),n||(n=setTimeout(l,t),i&&(s=e.apply(a,r))),s}));return c.cancel=function(){clearTimeout(n),n=r=a=null},c},wrap:function(e,t){return Ze(t,e)},negate:st,compose:function(){var e=arguments,t=e.length-1;return function(){for(var i=t,n=e[t].apply(this,arguments);i--;)n=e[i].call(this,n);return n}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:at,once:lt,findKey:ct,findIndex:dt,findLastIndex:ht,sortedIndex:pt,indexOf:$t,lastIndexOf:bt,find:gt,detect:gt,findWhere:function(e,t){return gt(e,je(t))},each:wt,forEach:wt,map:mt,collect:mt,reduce:yt,foldl:yt,inject:yt,reduceRight:xt,foldr:xt,filter:_t,select:_t,reject:function(e,t,i){return _t(e,st(Le(t)),i)},every:Tt,all:Tt,some:Et,any:Et,contains:At,includes:At,include:At,invoke:Vt,pluck:Bt,where:function(e,t){return _t(e,je(t))},max:kt,min:function(e,t,i){var n,o,r=1/0,s=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,l=(e=tt(e)?e:me(e)).length;a<l;a++)null!=(n=e[a])&&n<r&&(r=n);else t=Le(t,i),wt(e,(function(e,i,n){((o=t(e,i,n))<s||o===1/0&&r===1/0)&&(r=e,s=o)}));return r},shuffle:function(e){return jt(e,1/0)},sample:jt,sortBy:function(e,t,i){var n=0;return t=Le(t,i),Bt(mt(e,(function(e,i,o){return{value:e,index:n++,criteria:t(e,i,o)}})).sort((function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index-t.index})),"value")},groupBy:St,indexBy:Ct,countBy:Rt,partition:Lt,toArray:Ft,size:function(e){return null==e?0:tt(e)?e.length:ee(e).length},pick:Nt,omit:Ut,first:Dt,head:Dt,take:Dt,initial:Ht,last:function(e,t,i){return null==e||e.length<1?null==t||i?void 0:[]:null==t||i?e[e.length-1]:Wt(e,Math.max(0,e.length-t))},rest:Wt,tail:Wt,drop:Wt,compact:function(e){return _t(e,Boolean)},flatten:function(e,t){return it(e,t,!1)},without:Mt,uniq:qt,unique:qt,union:Jt,intersection:function(e){for(var t=[],i=arguments.length,n=0,o=X(e);n<o;n++){var r=e[n];if(!At(t,r)){var s;for(s=1;s<i&&At(arguments[s],r);s++);s===i&&t.push(r)}}return t},difference:zt,unzip:Kt,transpose:Kt,zip:Yt,object:function(e,t){for(var i={},n=0,o=X(e);n<o;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},range:function(e,t,i){null==t&&(t=e||0,e=0),i||(i=t<e?-1:1);for(var n=Math.max(Math.ceil((t-e)/i),0),o=Array(n),r=0;r<n;r++,e+=i)o[r]=e;return o},chunk:function(e,t){if(null==t||t<1)return[];for(var i=[],n=0,o=e.length;n<o;)i.push(s.call(e,n,n+=t));return i},mixin:Qt,default:ie},Zt=Qt(Xt);return Zt._=Zt,Zt})),function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],(function(i,n,o){t.Backbone=e(t,o,i,n)}));else if("undefined"!=typeof exports){var i,n=require("underscore");try{i=require("jquery")}catch(e){}e(t,exports,n,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}((function(e,t,i,n){var o=e.Backbone,r=Array.prototype.slice;t.VERSION="1.4.1",t.$=n,t.noConflict=function(){return e.Backbone=o,this},t.emulateHTTP=!1,t.emulateJSON=!1;var s,a=t.Events={},l=/\s+/,c=function(e,t,n,o,r){var s,a=0;if(n&&"object"==typeof n){void 0!==o&&"context"in r&&void 0===r.context&&(r.context=o);for(s=i.keys(n);a<s.length;a++)t=c(e,t,s[a],n[s[a]],r)}else if(n&&l.test(n))for(s=n.split(l);a<s.length;a++)t=e(t,s[a],o,r);else t=e(t,n,o,r);return t};a.on=function(e,t,i){return this._events=c(u,this._events||{},e,t,{context:i,ctx:this,listening:s}),s&&((this._listeners||(this._listeners={}))[s.id]=s,s.interop=!1),this},a.listenTo=function(e,t,n){if(!e)return this;var o=e._listenId||(e._listenId=i.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),a=s=r[o];a||(this._listenId||(this._listenId=i.uniqueId("l")),a=s=r[o]=new b(this,e));var l=d(e,t,n,this);if(s=void 0,l)throw l;return a.interop&&a.on(t,n),this};var u=function(e,t,i,n){if(i){var o=e[t]||(e[t]=[]),r=n.context,s=n.ctx,a=n.listening;a&&a.count++,o.push({callback:i,context:r,ctx:r||s,listening:a})}return e},d=function(e,t,i,n){try{e.on(t,i,n)}catch(e){return e}};a.off=function(e,t,i){return this._events?(this._events=c(h,this._events,e,t,{context:i,listeners:this._listeners}),this):this},a.stopListening=function(e,t,n){var o=this._listeningTo;if(!o)return this;for(var r=e?[e._listenId]:i.keys(o),s=0;s<r.length;s++){var a=o[r[s]];if(!a)break;a.obj.off(t,n,this),a.interop&&a.off(t,n)}return i.isEmpty(o)&&(this._listeningTo=void 0),this};var h=function(e,t,n,o){if(e){var r,s=o.context,a=o.listeners,l=0;if(t||s||n){for(r=t?[t]:i.keys(e);l<r.length;l++){var c=e[t=r[l]];if(!c)break;for(var u=[],d=0;d<c.length;d++){var h=c[d];if(n&&n!==h.callback&&n!==h.callback._callback||s&&s!==h.context)u.push(h);else{var p=h.listening;p&&p.off(t,n)}}u.length?e[t]=u:delete e[t]}return e}for(r=i.keys(a);l<r.length;l++)a[r[l]].cleanup()}};a.once=function(e,t,i){var n=c(p,{},e,t,this.off.bind(this));return"string"==typeof e&&null==i&&(t=void 0),this.on(n,t,i)},a.listenToOnce=function(e,t,i){var n=c(p,{},t,i,this.stopListening.bind(this,e));return this.listenTo(e,n)};var p=function(e,t,n,o){if(n){var r=e[t]=i.once((function(){o(t,r),n.apply(this,arguments)}));r._callback=n}return e};a.trigger=function(e){if(!this._events)return this;for(var t=Math.max(0,arguments.length-1),i=Array(t),n=0;n<t;n++)i[n]=arguments[n+1];return c(f,this._events,e,void 0,i),this};var f=function(e,t,i,n){if(e){var o=e[t],r=e.all;o&&r&&(r=r.slice()),o&&$(o,n),r&&$(r,[t].concat(n))}return e},$=function(e,t){var i,n=-1,o=e.length,r=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++n<o;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r);return;case 2:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r,s);return;case 3:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r,s,a);return;default:for(;++n<o;)(i=e[n]).callback.apply(i.ctx,t);return}},b=function(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0};b.prototype.on=a.on,b.prototype.off=function(e,t){var i;this.interop?(this._events=c(h,this._events,e,t,{context:void 0,listeners:void 0}),i=!this._events):(this.count--,i=0===this.count),i&&this.cleanup()},b.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},a.bind=a.on,a.unbind=a.off,i.extend(t,a);var g=t.Model=function(e,t){var n=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});var o=i.result(this,"defaults");n=i.defaults(i.extend({},o,n),o),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(g.prototype,a,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!i.iteratee(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;var o;if("object"==typeof e?(o=e,n=t):(o={})[e]=t,n||(n={}),!this._validate(o,n))return!1;var r=n.unset,s=n.silent,a=[],l=this._changing;this._changing=!0,l||(this._previousAttributes=i.clone(this.attributes),this.changed={});var c=this.attributes,u=this.changed,d=this._previousAttributes;for(var h in o)t=o[h],i.isEqual(c[h],t)||a.push(h),i.isEqual(d[h],t)?delete u[h]:u[h]=t,r?delete c[h]:c[h]=t;if(this.idAttribute in o){var p=this.id;this.id=this.get(this.idAttribute),this.trigger("changeId",this,p,n)}if(!s){a.length&&(this._pending=n);for(var f=0;f<a.length;f++)this.trigger("change:"+a[f],this,c[a[f]],n)}if(l)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&i.clone(this.changed);var t,n=this._changing?this._previousAttributes:this.attributes,o={};for(var r in e){var s=e[r];i.isEqual(n[r],s)||(o[r]=s,t=!0)}return!!t&&o},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=i.extend({parse:!0},e);var t=this,n=e.success;return e.success=function(i){var o=e.parse?t.parse(i,e):i;if(!t.set(o,e))return!1;n&&n.call(e.context,t,i,e),t.trigger("sync",t,i,e)},z(this,e),this.sync("read",this,e)},save:function(e,t,n){var o;null==e||"object"==typeof e?(o=e,n=t):(o={})[e]=t;var r=(n=i.extend({validate:!0,parse:!0},n)).wait;if(o&&!r){if(!this.set(o,n))return!1}else if(!this._validate(o,n))return!1;var s=this,a=n.success,l=this.attributes;n.success=function(e){s.attributes=l;var t=n.parse?s.parse(e,n):e;if(r&&(t=i.extend({},o,t)),t&&!s.set(t,n))return!1;a&&a.call(n.context,s,e,n),s.trigger("sync",s,e,n)},z(this,n),o&&r&&(this.attributes=i.extend({},l,o));var c=this.isNew()?"create":n.patch?"patch":"update";"patch"!==c||n.attrs||(n.attrs=o);var u=this.sync(c,this,n);return this.attributes=l,u},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,o=e.wait,r=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(i){o&&r(),n&&n.call(e.context,t,i,e),t.isNew()||t.trigger("sync",t,i,e)};var s=!1;return this.isNew()?i.defer(e.success):(z(this,e),s=this.sync("delete",this,e)),o||r(),s},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||W();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1)}});var w=t.Collection=function(e,t){t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},m={add:!0,remove:!0,merge:!0},v={add:!0,remove:!1},y=function(e,t,i){i=Math.min(Math.max(i,0),e.length);var n,o=Array(e.length-i),r=t.length;for(n=0;n<o.length;n++)o[n]=e[n+i];for(n=0;n<r;n++)e[n+i]=t[n];for(n=0;n<o.length;n++)e[n+r+i]=o[n]};i.extend(w.prototype,a,{model:g,preinitialize:function(){},initialize:function(){},toJSON:function(e){return this.map((function(t){return t.toJSON(e)}))},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,v))},remove:function(e,t){t=i.extend({},t);var n=!i.isArray(e);e=n?[e]:e.slice();var o=this._removeModels(e,t);return!t.silent&&o.length&&(t.changes={added:[],merged:[],removed:o},this.trigger("update",this,t)),n?o[0]:o},set:function(e,t){if(null!=e){(t=i.extend({},m,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var n=!i.isArray(e);e=n?[e]:e.slice();var o=t.at;null!=o&&(o=+o),o>this.length&&(o=this.length),o<0&&(o+=this.length+1);var r,s,a=[],l=[],c=[],u=[],d={},h=t.add,p=t.merge,f=t.remove,$=!1,b=this.comparator&&null==o&&!1!==t.sort,g=i.isString(this.comparator)?this.comparator:null;for(s=0;s<e.length;s++){r=e[s];var w=this.get(r);if(w){if(p&&r!==w){var v=this._isModel(r)?r.attributes:r;t.parse&&(v=w.parse(v,t)),w.set(v,t),c.push(w),b&&!$&&($=w.hasChanged(g))}d[w.cid]||(d[w.cid]=!0,a.push(w)),e[s]=w}else h&&(r=e[s]=this._prepareModel(r,t))&&(l.push(r),this._addReference(r,t),d[r.cid]=!0,a.push(r))}if(f){for(s=0;s<this.length;s++)d[(r=this.models[s]).cid]||u.push(r);u.length&&this._removeModels(u,t)}var x=!1,_=!b&&h&&f;if(a.length&&_?(x=this.length!==a.length||i.some(this.models,(function(e,t){return e!==a[t]})),this.models.length=0,y(this.models,a,0),this.length=this.models.length):l.length&&(b&&($=!0),y(this.models,l,null==o?this.length:o),this.length=this.models.length),$&&this.sort({silent:!0}),!t.silent){for(s=0;s<l.length;s++)null!=o&&(t.index=o+s),(r=l[s]).trigger("add",r,this,t);($||x)&&this.trigger("sort",this,t),(l.length||u.length||c.length)&&(t.changes={added:l,removed:u,merged:c},this.trigger("update",this,t))}return n?e[0]:e}},reset:function(e,t){t=t?i.clone(t):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return r.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e,e.idAttribute)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var n=t.length;return i.isFunction(t)&&(t=t.bind(this)),1===n||i.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){var t=(e=i.extend({parse:!0},e)).success,n=this;return e.success=function(i){var o=e.reset?"reset":"set";n[o](i,e),t&&t.call(e.context,n,i,e),n.trigger("sync",n,i,e)},z(this,e),this.sync("read",this,e)},create:function(e,t){var n=(t=t?i.clone(t):{}).wait;if(!(e=this._prepareModel(e,t)))return!1;n||this.add(e,t);var o=this,r=t.success;return t.success=function(e,t,i){n&&o.add(e,i),r&&r.call(i.context,e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e,t){return e[t||this.model.prototype.idAttribute||"id"]},values:function(){return new _(this,T)},keys:function(){return new _(this,E)},entries:function(){return new _(this,A)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){return this._isModel(e)?(e.collection||(e.collection=this),e):((t=t?i.clone(t):{}).collection=this,(n=this.model.prototype?new this.model(e,t):this.model(e,t)).validationError?(this.trigger("invalid",this,n.validationError,t),!1):n);var n},_removeModels:function(e,t){for(var i=[],n=0;n<e.length;n++){var o=this.get(e[n]);if(o){var r=this.indexOf(o);this.models.splice(r,1),this.length--,delete this._byId[o.cid];var s=this.modelId(o.attributes,o.idAttribute);null!=s&&delete this._byId[s],t.silent||(t.index=r,o.trigger("remove",o,this,t)),i.push(o),this._removeReference(o,t)}}return i},_isModel:function(e){return e instanceof g},_addReference:function(e,t){this._byId[e.cid]=e;var i=this.modelId(e.attributes,e.idAttribute);null!=i&&(this._byId[i]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var i=this.modelId(e.attributes,e.idAttribute);null!=i&&delete this._byId[i],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){if(t){if(("add"===e||"remove"===e)&&i!==this)return;if("destroy"===e&&this.remove(t,n),"changeId"===e){var o=this.modelId(t.previousAttributes(),t.idAttribute),r=this.modelId(t.attributes,t.idAttribute);null!=o&&delete this._byId[o],null!=r&&(this._byId[r]=t)}}this.trigger.apply(this,arguments)}});var x="function"==typeof Symbol&&Symbol.iterator;x&&(w.prototype[x]=w.prototype.values);var _=function(e,t){this._collection=e,this._kind=t,this._index=0},T=1,E=2,A=3;x&&(_.prototype[x]=function(){return this}),_.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var e,t=this._collection.at(this._index);if(this._index++,this._kind===T)e=t;else{var i=this._collection.modelId(t.attributes,t.idAttribute);e=this._kind===E?i:[i,t]}return{value:e,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var V=t.View=function(e){this.cid=i.uniqueId("view"),this.preinitialize.apply(this,arguments),i.extend(this,i.pick(e,k)),this._ensureElement(),this.initialize.apply(this,arguments)},B=/^(\S+)\s*(.*)$/,k=["model","collection","el","id","attributes","className","tagName","events"];i.extend(V.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=i.result(this,"events")),!e)return this;for(var t in this.undelegateEvents(),e){var n=e[t];if(i.isFunction(n)||(n=this[n]),n){var o=t.match(B);this.delegate(o[1],o[2],n.bind(this))}}return this},delegate:function(e,t,i){return this.$el.on(e+".delegateEvents"+this.cid,t,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,i){return this.$el.off(e+".delegateEvents"+this.cid,t,i),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e.class=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}});var I=function(e,t,n,o){i.each(n,(function(i,n){t[n]&&(e.prototype[n]=function(e,t,i,n){switch(t){case 1:return function(){return e[i](this[n])};case 2:return function(t){return e[i](this[n],t)};case 3:return function(t,o){return e[i](this[n],F(t,this),o)};case 4:return function(t,o,r){return e[i](this[n],F(t,this),o,r)};default:return function(){var t=r.call(arguments);return t.unshift(this[n]),e[i].apply(e,t)}}}(t,i,n,o))}))},F=function(e,t){return i.isFunction(e)?e:i.isObject(e)&&!t._isModel(e)?j(e):i.isString(e)?function(t){return t.get(e)}:e},j=function(e){var t=i.matches(e);return function(e){return t(e.attributes)}};i.each([[w,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"],[g,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],(function(e){var t=e[0],n=e[1],o=e[2];t.mixin=function(e){var n=i.reduce(i.functions(e),(function(e,t){return e[t]=0,e}),{});I(t,e,n,o)},I(t,i,n,o)})),t.sync=function(e,n,o){var r=P[e];i.defaults(o||(o={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var s={type:r,dataType:"json"};if(o.url||(s.url=i.result(n,"url")||W()),null!=o.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(o.attrs||n.toJSON(o))),o.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),o.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){s.type="POST",o.emulateJSON&&(s.data._method=r);var a=o.beforeSend;o.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",r),a)return a.apply(this,arguments)}}"GET"===s.type||o.emulateJSON||(s.processData=!1);var l=o.error;o.error=function(e,t,i){o.textStatus=t,o.errorThrown=i,l&&l.call(o.context,e,t,i)};var c=o.xhr=t.ajax(i.extend(s,o));return n.trigger("request",n,c,o),c};var P={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var S=t.Router=function(e){e||(e={}),this.preinitialize.apply(this,arguments),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,R=/(\(\?)?:\w+/g,L=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(S.prototype,a,{preinitialize:function(){},initialize:function(){},route:function(e,n,o){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(o=n,n=""),o||(o=this[n]);var r=this;return t.history.route(e,(function(i){var s=r._extractParameters(e,i);!1!==r.execute(o,s,n)&&(r.trigger.apply(r,["route:"+n].concat(s)),r.trigger("route",n,s),t.history.trigger("route",r,n,s))})),this},execute:function(e,t,i){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(C,"(?:$1)?").replace(R,(function(e,t){return t?e:"([^/?]+)"})).replace(L,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,(function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null}))}});var N=t.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},U=/^[#\/]|\s+$/g,H=/^\/+|\/+$/g,D=/#.*$/;N.started=!1,i.extend(N.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(U,"")},start:function(e){if(N.started)throw new Error("Backbone.history has already been started");if(N.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(H,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,o=n.insertBefore(this.iframe,n.firstChild).contentWindow;o.document.open(),o.document.close(),o.location.hash="#"+this.fragment}var r=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),N.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),i.some(this.handlers,(function(t){if(t.route.test(e))return t.callback(e),!0})))},navigate:function(e,t){if(!N.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");var i=this.root;""!==e&&"?"!==e.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+e;e=e.replace(D,"");var o=this.decodeFragment(e);if(this.fragment!==o){if(this.fragment=o,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;t.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new N,g.extend=w.extend=S.extend=V.extend=N.extend=function(e,t){var n,o=this;return n=e&&i.has(e,"constructor")?e.constructor:function(){return o.apply(this,arguments)},i.extend(n,o,t),n.prototype=i.create(o.prototype,e),n.prototype.constructor=n,n.__super__=o.prototype,n};var W=function(){throw new Error('A "url" property or function must be specified')},z=function(e,t){var i=t.error;t.error=function(n){i&&i.call(t.context,e,n,t),e.trigger("error",e,n,t)}};return t}))}();let O=[],N=[];function U(t){try{t||($$("dashboards")||$$("container").addView({view:"layout",id:"dashboards",hidden:!0,scroll:"auto",rows:[{view:"scrollview",id:"dashScroll",body:{view:"flexlayout",id:"dashboardContainer",cols:[{id:"dashboardInfoContainer",minWidth:250,rows:[]},{view:"resizer"},e]}}]},3),$$("tables")||$$("container").addView({id:"tables",hidden:!0,view:"scrollview",body:{view:"flexlayout",cols:[{id:"tableContainer",rows:[E(0,"table-exportBtn","table-editTableBtnId","table-findElements","table-idFilterElements","table","table-filterId"),{view:"resizer",class:"webix_resizers"},A("table",V,!0)]},{view:"resizer",class:"webix_resizers"},{id:"editTableBarContainer",rows:[{id:"editTableBarAdaptive",rows:[{id:"editTableBarHeadline",hidden:!0,cols:[{template:"Редактор записей",height:30,css:"table-edit-headline",borderless:!0},{view:"button",id:"buttonClosePopupTableEdit",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("table-editForm")&&($$("table-editForm").isDirty()?b().then((function(e){if(1==e)$$("tableEditPopup")&&$$("tableEditPopup").hide();else if(2==e){if(!$$("table-editForm").validate())return i("error","Заполните пустые поля"),!1;$$("table-editForm").getValues().id?w():v(),$$("table-editForm").clear(),$$("table-delBtnId").enable(),$$("tableEditPopup")&&$$("tableEditPopup").hide()}})):($$("inputsTable")&&$$("inputsTable").getParentView().removeView($$("inputsTable")),$$("table").filter(!1),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").hide(),$$("tableEditPopup")&&$$("tableEditPopup").hide()))}}]},{view:"form",id:"table-editForm",css:"webix_form-edit",minHeight:350,minWidth:210,width:320,scroll:!0,borderless:!0,elements:[{minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{margin:5,rows:[{margin:5,cols:[{view:"button",id:"table-newAddBtnId",height:48,minWidth:90,hotkey:"shift",value:"Новая запись",click:m},{view:"button",id:"table-delBtnId",disabled:!0,height:48,minWidth:90,width:100,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"wxi-trash",click:y,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить запись из таблицы")}}}]}]},{margin:10,rows:[{view:"button",id:"table-saveBtn",hidden:!0,value:"Сохранить",height:48,css:"webix_primary",click:function(){w()},hotkey:"enter"},{view:"button",id:"table-saveNewBtn",value:"Сохранить новую запись",hidden:!0,height:48,hotkey:"enter",css:"webix_primary",click:v},{id:"EditEmptyTempalte",template:"<div style='color:#858585;font-size:13px!important'>Добавьте новую запись или выберите существующую из таблицы</div>",borderless:!0}]}]}],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}}]}]},{id:"filterTableBarContainer",hidden:!0,rows:[{id:"editFilterBarAdaptive",rows:[{id:"editFilterBarHeadline",hidden:!0,cols:[{template:"Редактор записей",height:30,css:"table-filter-headline",borderless:!0},{view:"button",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("table-editForm")&&$$("tableFilterPopup")&&$$("tableFilterPopup").hide()}}]},{view:"form",hidden:!0,id:"filterTableForm",minHeight:350,minWidth:210,width:320,scroll:!0,borderless:!0,elements:[{id:"form-adaptive",minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{margin:5,rows:[{responsive:"form-adaptive",margin:5,cols:[{view:"button",value:"Редактор фильтров",height:48,minWidth:140,click:S,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить/удалить фильтры")}}},{view:"button",id:"resetFilterBtn",disabled:!0,height:48,minWidth:50,width:65,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"wxi-trash",click:C,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Сбросить фильтры")}}}]}]},{id:"btns-adaptive",css:{"margin-top":"5px!important"},rows:[{responsive:"btns-adaptive",margin:5,cols:[{view:"button",id:"btnFilterSubmit",height:48,minWidth:70,css:"webix_primary",hotkey:"Enter",disabled:!0,value:"Применить фильтры",click:R},{view:"button",id:"filterLibrarySaveBtn",disabled:!0,height:48,minWidth:50,width:65,hotkey:"shift+esc",type:"icon",icon:"wxi-file",click:L,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Сохранить шаблон с полями в библиотеку")}}}]},{height:10},{id:"filterEmptyTempalte",template:"<div style='color:#858585;font-size:13px!important'>Добавьте фильтры из редактора</div>",borderless:!0}]}]}],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}}]}]}]}},5),$$("forms")||$$("container").addView({view:"layout",id:"forms",css:"webix_tableView",hidden:!0,rows:[E(0,"table-view-exportBtn","table-view-editTableBtnId","table-view-findElements","table-view-idFilterElements","table-view","table-view-filterIdView",!0),{view:"resizer",class:"webix_resizers"},{view:"scrollview",body:{view:"flexlayout",cols:[A("table-view"),{view:"resizer",class:"webix_resizers",id:"propResize",hidden:!0},("propTableView",{view:"property",id:"propTableView",tooltip:"Имя: #label#<br> Значение: #value#",width:350,nameWidth:150,editable:!0,scroll:!0,hidden:!0})]}}]},6)),"treeTempl"==t&&($$("treeTempl")||($$("container").addView({view:"layout",id:"treeTempl",hidden:!0,scroll:"auto",rows:[{id:"treeEditContainer",cols:[{rows:[{view:"edittree",id:"treeEdit",editable:!0,editor:"text",editValue:"value",css:"webix_tree-edit",editaction:"dblclick",data:[],on:{onAfterEditStop:function(e,t,n){try{let n="/init/default/api/trees/";if(e.value!=e.old){let o=$$("treeEdit").getParentId(t.id),a={name:e.value,pid:o,id:t.id,owner:null,descr:"",ttype:1,value:"",cdt:null};webix.ajax().put(n+t.id,a).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?i("success","Данные изменены"):r("013-011",e.json().err,!0)})).fail((function(e){console.log(e),s("013-011",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),r("012-011",e)}}}}]},{}]}]},4),webix.ui({view:"contextmenu",id:"contextMenuEditTree",data:["Добавить","Переименовать",{$template:"Separator"},"Свернуть всё","Развернуть всё",{$template:"Separator"},"Удалить"],master:$$("treeEdit"),on:{onMenuItemClick:function(e){let t=this.getContext(),n=$$("treeEdit"),o=n.getItem(t.id),a=this.getMenu(e).getItem(e).value,l="/init/default/api/trees/",c={name:"",pid:"",owner:null,descr:"",ttype:1,value:"",cdt:null};try{switch(a){case"Добавить":{let e=prompt("Имя нового подэлемента '"+o.value+"'","");null!=e&&(console.log(o.id),c.name=e,c.pid=o.id,webix.ajax().post(l,c).then((function(t){if("e"!==t.json().err_type&&"x"!==t.json().err_type){let r=t.json().content.id;n.data.add({id:r,value:e,pid:o.id},0,o.id),n.open(o.id),i("success","Данные сохранены")}else r("013-001",t.json().err,!0)})).fail((function(e){console.log(e),s("013-001",e.status,e.statusText,e.responseURL)})));break}case"Переименовать":var u=prompt("Новое имя",o.value);null!=u&&(c.name=u,c.id=o.id,c.pid=o.pid,webix.ajax().put(l+o.id,c).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?(o.value=u,n.updateItem(o.id,o),i("success","Данные изменены")):r("013-011",e.json().err,!0)})).fail((function(e){console.log(e),s("013-011",e.status,e.statusText,e.responseURL)})));break;case"Удалить":console.log(l+o.id+".json"),console.log(o),webix.ajax().del(l+o.id,o).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?(n.remove(o.id),i("success","Данные удалены")):r("013-002",e.json().err,!0)})).fail((function(e){console.log(e),s("013-002",e.status,e.statusText,e.responseURL)}));break;case"Развернуть всё":try{n.open(o.id),n.data.eachSubItem(o.id,(function(e){n.open(e.id)}))}catch(e){console.log(e),r("013-000",e)}break;case"Свернуть всё":try{n.close(o.id),n.data.eachSubItem(o.id,(function(e){n.close(e.id)}))}catch(e){console.log(e),r("013-000",e)}}}catch(e){console.log(e),r("013-000",e)}}}}))),"cp"==t&&$$("container").addView({view:"layout",id:"user_auth",css:"webix_auth",hidden:!0,rows:[B,{}]},7),"userprefs"==t&&$$("container").addView({view:"layout",id:"userprefs",css:"webix_auth",hidden:!0,rows:[F]},8)}catch(e){console.log(e),r("015-004",e)}}function H(e,i){return webix.ajax("/init/default/api/whoami",{success:function(n,o,a){$$("userAuth").hide(),$$("mainLayout").show(),O.push(o.json().content.first_name,o.json().content.username);let l={};l.id=o.json().content.id,l.name=o.json().content.first_name,l.username=o.json().content.username,t("user",JSON.stringify(l)),U(),webix.ajax().get("/init/default/api/fields.json",!1).then((function(t){let n=t.json().content,o=Object.keys(n),l={tables:[],forms:[],dashboards:[],treeConf:[]};try{$$("tree").unselectAll(),o.forEach((function(e){"treeConf"==n[e].type&&(l.treeConf.push({id:e,value:n[e].plural,type:n[e].type}),N.push({name:n[e].plural,id:e})),"dbtable"==n[e].type&&(n[e].plural?(l.tables.push({id:e,value:n[e].plural,type:n[e].type}),N.push({name:n[e].plural,id:e})):n[e].singular&&(l.tables.push({id:e,value:n[e].singular,type:n[e].type}),N.push({name:n[e].singular,id:e}))),"tform"==n[e].type&&(n[e].plural?(l.forms.push({id:e,value:n[e].plural,type:n[e].type}),N.push({name:n[e].plural,id:e})):n[e].singular&&(l.forms.push({id:e,value:n[e].singular,type:n[e].type}),N.push({name:n[e].singular,id:e}))),"dashboard"==n[e].type&&(n[e].plural?(l.dashboards.push({id:e,value:n[e].plural,type:n[e].type}),N.push({name:n[e].plural,id:e})):n[e].singular&&(l.dashboards.push({id:e,value:n[e].singular,type:n[e].type}),N.push({name:n[e].singular,id:e})))}))}catch(e){console.log(e),r("015-000",e)}webix.ajax().get("/init/default/api/mmenu.json").then((function(e){let t,i=e.json().mmenu,s=[],a=[],c=[];t=window.location.host.includes("localhost:3000")?"/index.html/":"/init/default/spaw/";try{i.forEach((function(e,i){if("user_auth"!=e.name&&"userprefs"!=e.name||(e.childs.length>0&&(e.childs.forEach((function(e,i){"login"==e.name?c.push({id:e.name,value:e.title,href:t+e.name}):"logout"!==e.name&&a.push({id:e.name,value:e.title,href:t+e.name}),N.push({name:e.title,id:e.name})})),e.childs.forEach((function(e,t){"logout"==e.name&&a.push({id:e.name,value:e.title,css:"webix_logout"}),N.push({name:e.title,id:e.name})}))),e.childs.length<=0&&a.push({id:e.name,value:e.title,href:t+e.name})),e.childs.length>0&&(l[e.name]=[],e.childs.forEach((function(t,i){l[e.name].push({id:t.name,value:t.title}),N.push({name:t.title,id:t.name})}))),e.name.includes("delim"));else{let t;o.forEach((function(i){i==e.name&&(t=e.title,s.push({id:e.name+"-single",value:e.title,typeof:n[i].type}))})),t||(e.title?e.typeof?s.push({id:e.name,value:e.title,typeof:e.typeof,data:l[e.name]}):s.push({id:e.name,value:e.title,data:l[e.name]}):s.push({id:e.name,value:"Без названия",data:l[e.name]}))}})),$$("tree").clearAll(),$$("tree").parse(s),$$("button-context-menu").config.popup.data=a,$$("button-context-menu").enable()}catch(e){console.log(e),r("015-000",e)}})).catch((e=>{console.log(e),s("015-000",a.status,a.statusText,a.responseURL)})),$$("tree").attachEvent("onAfterSelect",(function(t){e.navigate("tree/"+t,{trigger:!0})})),"userprefs"==i&&$$("userprefsName").setValues(O[0].toString()),"cp"==i&&$$("authName").setValues(O[0].toString())})).catch((e=>{console.log(e),s("015-000",e.status,e.statusText,e.responseURL)}))},error:function(t,i,n){e.navigate("",{trigger:!0}),s("015-006",n.status,n.statusText,n.responseURL)}})}function D(){try{$$("container").getChildViews().forEach((function(e,t){"scrollview"!=e.config.view&&"layout"!=e.config.view||$$(e.config.id).isVisible()&&$$(e.config.id).hide()}))}catch(e){console.log(e),r("015-000",e)}}function W(){let e=new(Backbone.Router.extend({routes:{"":"index",content:"content",userprefs:"userprefs",cp:"cp",logout:"logout","tree/:id":"tree","experimental/:id":"experimental"},content:function(){try{H(e).then((function(e){}))}catch(e){console.log(e),r("015-005",e)}},index:function(){webix.ajax("/init/default/api/whoami",{success:function(e,t,i){try{Backbone.history.navigate("content",{trigger:!0})}catch(e){console.log(e),r("015-005",e)}},error:function(e,t,i){$$("mainLayout").hide(),$$("userAuth").show(),s("015-015",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("015-000",e.status,e.statusText,e.responseURL)}))},tree:function(t){try{if(0==$$("tree").data.order.length){H(e);let i=t;$$("tree").attachEvent("onAfterLoad",(function(e){let t;e=i,$$("tree").getItem(e)?(t=$$("tree").getParentId(e),$$("tree").open(t),$$("tree").select(e)):setTimeout((function(){webix.ui({view:"popup",id:"popupNotFound",css:"webix_popup-prev-href",width:340,height:125,position:"center",body:{rows:[{rows:[{cols:[{template:"Что-то пошло не так...",width:250,css:"webix_template-not-found",borderless:!0,height:20},{},{view:"button",id:"buttonClosePopup",css:"webix_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){$$("popupNotFound").hide()}}]},{template:"Страница не найдена",css:"webix_template-not-found-descr",borderless:!0,height:35},{view:"button",css:"webix_btn-not-found-back",height:46,value:"Вернуться на главную",click:function(){$$("popupNotFound")&&$$("popupNotFound").destructor(),Backbone.history.navigate("content",{trigger:!0}),window.location.reload()}},{height:20}]}]}}).show()}),1500)}))}}catch(e){console.log(e),r("015-005",e)}},cp:function(){try{$$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),D(),$$("webix__none-content").hide(),0==$$("tree").data.order.length&&H(e,"cp"),$$("user_auth")?$$("user_auth").show():(U("cp"),$$("user_auth").show(),O.length>0&&$$("authName").setValues(O[0].toString())),$$("tree").closeAll()}catch(e){console.log(e),r("015-005",e)}},userprefs:function(){try{$$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),D(),$$("webix__none-content").hide(),0==$$("tree").data.order.length&&H(e,"userprefs"),$$("userprefs")?$$("userprefs").show():(U("userprefs"),webix.ajax().get("/init/default/api/userprefs/",{success:function(e,t,n){"e"==(t=t.json().content).err_type&&i("error",t.error),t.forEach((function(e,t){e.name.includes("userprefs")&&$$(e.name).setValues(JSON.parse(e.prefs))}))},error:function(e,t,i){s("016-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("016-000",e.status,e.statusText,e.responseURL)})),$$("userprefs").show(),O.length>0&&$$("userprefsName").setValues(O[0].toString())),$$("tree").closeAll()}catch(e){console.log(e),r("016-005",e)}},experimental:function(){console.log("exp");try{$$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),D(),$$("webix__none-content").hide(),0==$$("tree").data.order.length&&H(e),$$("treeTempl")?($$("treeTempl").show(),f()):(U("treeTempl"),f(),$$("treeTempl").show(),console.log($$("treeTempl")),console.log($$("treeTempl").isVisible())),$$("tree").closeAll()}catch(e){console.log(e),r("015-005",e)}},logout:function(){webix.ajax().post("/init/default/logout/",{success:function(e,t,n){try{history.back(),function(){try{$$("tables")&&$$("container").removeView($$("tables")),$$("dashboards")&&$$("container").removeView($$("dashboards")),$$("forms")&&$$("container").removeView($$("forms")),$$("user_auth")&&$$("container").removeView($$("user_auth"))}catch(e){console.log(e),r("015-004",e)}}(),$$("webix__none-content").show(),$$("tree").clearAll(),webix.storage.local.clear()}catch(e){console.log(e),i("error","Не удалось выполнить выход"),webix.message({type:"error",expire:3e3,text:"Не удалось выполнить выход"}),r("015-000",e)}},error:function(e,t,n){i("error","Не удалось выполнить выход"),webix.message({type:"error",expire:3e3,text:"Не удалось выполнить выход"}),s("015-006",n.status,n.statusText,n.responseURL)}}).catch((e=>{console.log(e),s("015-006",e.status,e.statusText,e.responseURL)}))}}));return e}"/index.html"!==window.location.pathname&&"/"!==window.location.pathname&&"/init/default/spaw/"!==window.location.pathname&&function(e,i,n=!1){try{let o,r,s=(i=window.location.href).slice(i.lastIndexOf("/")+1);e&&e.forEach((function(e,t){e.id==s&&(o=e.name)})),r={tableName:o,tableId:s,href:i,autoLogout:n},t("userLocation",JSON.stringify(r))}catch(e){console.log(e),r("010-000",e)}}("",window.location.href);let z="";console.log("expa 1.0.26");try{webix.ready((function(){webix.protoUI({name:"edittree"},webix.EditAbility,webix.ui.tree),webix.ui({view:"scrollview",type:"clean",id:"layout",css:"layoutContainer",scroll:"y",body:{cells:[{},{hidden:!0,id:"userAuth",cols:[{},{rows:[{},(W(),{view:"form",id:"formAuth",maxWidth:300,borderless:!0,elements:[{view:"text",label:"Логин",name:"username",invalidMessage:"Поле должно быть заполнено"},{view:"text",label:"Пароль",name:"password",invalidMessage:"Поле должно быть заполнено",type:"password"},{view:"button",value:"Войти",css:"webix_primary",hotkey:"enter",align:"center",click:function(){let e=$$("formAuth").getValues(),i=[];try{$$("formAuth").validate(),i.push("un="+e.username),i.push("np="+e.password),webix.ajax("/init/default/login?"+i.join("&"),{success:function(e,i,n){webix.ajax("/init/default/api/whoami",{success:function(e,i,n){try{let e={};e.id=i.json().content.id,e.name=i.json().content.first_name,e.username=i.json().content.username,t("user",JSON.stringify(e)),$$("formAuth")&&$$("formAuth").clear(),Backbone.history.navigate("content",{trigger:!0}),window.location.reload()}catch(e){console.log(e),r("007-005",e)}},error:function(e,t,i){$$("formAuth")&&$$("formAuth").isDirty()&&webix.message({type:"error",expire:3e3,text:"Неверный логин или пароль"}),s("007-006",i.status,i.statusText,i.responseURL)}}).then((function(e){webix.ajax().get("/init/default/api/userprefs/",{success:function(e,t,i){console.log("oeoe")},error:function(e,t,i){s("007-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("007-000",e.status,e.statusText,e.responseURL)}))}))},error:function(e,t,i){webix.message({type:"error",expire:3e3,text:"Не удалось выполнить выход"}),s("007-006",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("007-006",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),r("007-000",e)}}}],rules:{username:webix.rules.isNotEmpty,password:webix.rules.isNotEmpty},elementsConfig:{labelPosition:"top"}}),{}]},{}]},{hidden:!0,id:"mainLayout",rows:[{id:"mainContent",css:"webix_mainContent",cols:[{rows:[{view:"toolbar",id:"header",padding:10,css:"webix_header-style",elements:[{cols:[{view:"button",type:"icon",id:"collapseBtn",icon:"wxi-angle-double-left",css:"webix_collapse",title:"текст",height:45,width:40,click:function(){try{window.innerWidth>850?$$("tree").isVisible()?(this.config.icon="wxi-angle-double-right",this.refresh(),$$("tree").hide(),$$("sideMenuResizer")&&$$("sideMenuResizer").hide()):($$("tree").show(),this.config.icon="wxi-angle-double-left",this.refresh(),window.innerWidth>=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").show()):$$("tree").isVisible()?(this.config.icon="wxi-angle-double-right",this.refresh(),$$("tree").hide(),$$("sideMenuResizer")&&$$("sideMenuResizer").hide()):($$("tree").show(),console.log(window.innerHeight),$$("tree").config.width=window.innerWidth,$$("tree").resize(),this.config.icon="wxi-angle-double-left",this.refresh(),window.innerWidth>=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").show())}catch(e){console.log(e),r("009-000",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Видимость бокового меню")}}},{view:"label",label:"<img src='/init/static/images/expalogo.png' style='height:30px; margin: 10px;'>",height:30}]},{},{view:"search",placeholder:"Поиск",css:"searchTable",maxWidth:250,minWidth:40},{view:"button",id:"webix_log-btn",type:"icon",icon:"wxi-eye-slash",height:48,badge:0,width:60,css:"webix_log-btn",click:function(){1==this.getValue()?this.setValue(2):this.setValue(1)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть системные сообщения")},onChange:function(e,t,i){let n=$$("logBlock-list").getLastId();2==e?(this.config.badge="",$$("logBlock-list").showItem(n),$$("logLayout").config.height=90,$$("logLayout").resize(),this.config.icon="wxi-eye-slash",this.refresh()):($$("logLayout").config.height=5,$$("logLayout").resize(),this.config.icon="wxi-eye",this.refresh(),$$("webix_log-btn").config.badge="",$$("webix_log-btn").refresh())}}},{view:"button",id:"button-context-menu",type:"icon",disabled:!0,icon:"wxi-user",height:48,width:60,popup:{view:"contextmenu",id:"contextmenu",css:"webix_contextmenu",data:[],on:{onItemClick:function(e,t,n){try{if("logout"==e){if($$("table-editForm")&&$$("table-editForm").isDirty()||$$("cp-form")&&$$("cp-form").isDirty()){try{b().then((function(e){if(1==e)Backbone.history.navigate("logout",{trigger:!0});else if(2==e&&($$("cp-form")||$$("table-editForm")))if($$("cp-form")&&$$("cp-form").isDirty()&&$$("cp-form").validate()){let e={op:"",np:""},t=$$("cp-form").getValues();e.np=t.newPass,e.op=t.oldPass,webix.ajax().post("/init/default/api/cp",e,{success:function(e,t,n){"i"==(t=t.json()).err_type?i("success",t.err):"e"==t.err_type&&i("error",t.err)},error:function(e,t,i){s("011-000",i.status,i.statusText,i.responseURL)}}),Backbone.history.navigate("logout",{trigger:!0})}else{if(!($$("table-editForm")&&$$("table-editForm").isDirty()&&$$("table-editForm").validate()))return i("error","Заполните пустые поля"),!1;$$("table-editForm").getValues().id?w():v(),Backbone.history.navigate("logout",{trigger:!0})}}))}catch(e){console.log(e),r("005-000",e)}return!1}Backbone.history.navigate("logout",{trigger:!0})}}catch(e){console.log(e),r("005-000",e)}}}},on:{onItemClick:function(){try{webix.ajax().get("/init/default/api/userprefs/",{success:function(e,n,o){if("e"==(n=n.json().content).err_type&&i("error",n.error),"/index.html/content"!==window.location.pathname&&"/init/default/spaw/content"!==window.location.pathname){let e=!1,o={};o.href=window.location.href;let a={name:"userLocationHref",prefs:o};try{n.forEach((function(t,n){"userLocationHref"==t.name&&(e=!0,webix.ajax().put("/init/default/api/userprefs/"+t.id,a,{success:function(e,t,n){"e"==(t=t.json()).err_type&&i("error",t.error)},error:function(e,t,i){s("005-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("005-011",e.status,e.statusText,e.responseURL)})))}))}catch(e){console.log(e),r("005-000",e)}try{if(!e){let e=webix.storage.local.get("user").id;e?a.owner=e:webix.ajax("/init/default/api/whoami",{success:function(e,i,n){a.owner=i.json().content.id;let o={};o.id=i.json().content.id,o.name=i.json().content.first_name,o.username=i.json().content.username,t("user",JSON.stringify(o))},error:function(e,t,i){s("005-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("005-000",e.status,e.statusText,e.responseURL)})),webix.ajax().post("/init/default/api/userprefs/",a,{success:function(e,t,n){"e"==(t=t.json()).err_type&&i("error",t.error)},error:function(e,t,i){s("005-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("005-001",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),r("005-000",e)}}},error:function(e,t,i){s("005-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("005-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),r("005-000",e)}}}}]},{id:"adaptive",rows:[]},{cols:[{view:"edittree",id:"tree",css:"webix_tree-main",minWidth:100,width:250,editable:!1,select:!0,editor:"text",editValue:"value",activeTitle:!0,clipboard:!0,data:[],on:{onSelectChange:function(e){z=e[0];let t=$$("tree").getSelectedItem().id,i=$$("tree").getParentId(t),n=$$("tree").data.order,o=[],s="";try{$$("inputsTable")&&($$("table-editForm").removeView($$("inputsTable")),$$("EditEmptyTempalte").show()),$$("treeTempl")&&!$$(e)&&$$("treeTempl").hide(),n.forEach((function(e,t){0==$$("tree").getParentId(e)&&o.push(e)})),t.includes("single")&&(s=$$("tree").getSelectedItem().typeof),(e[0]&&0!==i||s)&&$$("webix__none-content").hide()}catch(e){console.log(e),r("009-000",e)}function a(e,t){try{return $$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),$$("user_auth")&&$$("user_auth").isVisible()&&$$("user_auth").hide(),$$("userprefs")&&$$("userprefs").isVisible()&&$$("userprefs").hide(),void 0!==t?o.forEach((function(i,n){i.includes("single")?e&&$$(e).hide():("treeTempl"!==t?($$("webix__none-content").isVisible()&&$$("webix__none-content").hide(),$$("webix__null-content")||$$("container").addView({view:"align",align:"middle,center",id:"webix__null-content",body:{borderless:!0,template:"Блок в процессе разработки",height:50,width:220,css:{color:"#858585","font-size":"14px!important"}}},2)):$$("webix__none-content").isVisible()||($$("webix__none-content").show(),$$("container").getChildViews().forEach((function(e,t){"webix__none-content"!==e.config.id&&0==e.config.hidden&&$$(e.config.id).hide()}))),i!==t&&$$(i)&&$$(i).hide())})):o.forEach((function(t,n){t.includes("single")?e&&$$(e).show():t==i?$$(t)?$$(t).show():$$("webix__null-content")||$$("container").addView({view:"align",align:"middle,center",id:"webix__null-content",body:{borderless:!0,template:"Блок в процессе разработки",height:50,width:220,css:{color:"#858585","font-size":"14px!important"}}},2):($$(t)||"treeTempl"==t)&&$$(t)&&$$(t).hide()}))}catch(e){console.log(e),r("009-000",e)}}try{"tables"==i||"dbtable"==s?a("tables"):"dashboards"==i||"dashboard"==s?a("dashboards"):"forms"==i||"tform"==s?($$("propTableView")&&$$("propTableView").isVisible()&&$$("propTableView").hide(),a("forms")):"user_auth"==i?a():0!=i||"tables"===t||"user_auth"===t||"dashboards"===t||"forms"===t||s?"treeTempl"==i&&a():a(!1,e[0]),"tables"==i||"dbtable"==s?(T(),0!==Object.keys($$("table-editForm").elements).length&&$$("inputsTable").hide(),"dbtable"==s?h("table",0,e[0],"table-findElements",!0):h("table",0,e[0],"table-findElements")):"dashboards"==i?p():"dashboard"==s?p(e[0],!0):"forms"==i?h("table-view",0,e[0],"table-view-findElements"):"tform"==s?h("table-view",0,e[0],"table-view-findElements",!0):"treeTempl"==i&&f()}catch(e){console.log(e),r("009-000",e)}},onItemClick:function(e,t,n){if($$("table-editForm").isDirty()){try{b().then((function(t){if(1==t)_(),$$("tree").select(e);else if(2==t){if(!$$("table-editForm").validate())return i("error","Заполните пустые поля"),!1;$$("table-editForm").getValues().id?w():v(),$$("tree").select(e)}}))}catch(e){console.log(e),r("009-000",e)}return!1}},onBeforeSelect:function(e){if("tables"==$$("tree").getParentId(e)&&$$("filterTableForm")&&$$("filterTableForm").isVisible)try{$$("filterTableForm").hide(),$$("inputsFilter")&&$$("filterTableForm").removeView($$("inputsFilter"));let e=document.querySelector(".webix_btn-filter");e&&!e.classList.contains("webix_secondary")&&(e.classList.add("webix_secondary"),e.classList.remove("webix_primary")),$$("table-editTableBtnId").hide(),$$("table-editForm").show()}catch(e){console.log(e),r("009-000",e)}},onAfterSelect:function(){window.innerWidth<850&&this.hide()}}},{id:"sideMenuResizer",view:"resizer",css:"webix_resizer-hide"},{id:"container",cols:[{view:"align",align:"middle,center",id:"webix__none-content",body:{borderless:!0,template:"Выберите элемент дерева",height:50,width:210,css:{color:"#858585","font-size":"14px!important"}}}]}]}]}]},{view:"resizer",id:"log-resizer"},o]}]}}),function(){function e(e,t=1.3){if($$(e)&&window.innerWidth/$$(e).$width<t&&$$(e).$width>100){let t=$$(e).$width-20;$$(e).config.width=t,$$(e).resize()}if($$(e)&&window.innerWidth/$$(e).$width>t){let t=$$(e).$width+20;$$(e).config.width=t,$$(e).resize()}}window.addEventListener("resize",(function(t){try{window.innerWidth<850&&$$("tree")&&$$("tree").isVisible()&&$$("tree").hide(),$$("tree").isVisible()||window.innerWidth<=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").hide(),window.innerWidth>850&&$$("tree")&&($$("tree").config.width=250,$$("tree").resize())}catch(e){console.log(e),r("017-007",e)}try{if(window.innerWidth<830&&!$$("contextActionsBtn")){if($$("customInputsMain")){const e=$$("table-view-filterIdView").getParentView();let t;t=Object.values($$("customInputs")._collection),t.forEach((function(e,t){e.bottomPadding=10,e.width&&delete e.width,e.minWidth&&delete e.minWidth,e.maxWidth&&delete e.maxWidth})),$$("customInputsMain").getParentView().removeView($$("customInputsMain")),t={id:"customInputsAdaptive",rows:[{id:"customInputs",rows:t}]},$$(e.config.id).addView({view:"button",id:"contextActionsBtnAdaptive",maxWidth:100,value:"Действия",css:"webix_primary",popup:webix.ui({view:"popup",css:"webix_popup-actions-container webix_popup-config",modal:!0,id:"contextActionsPopup",escHide:!0,position:"center",width:400,body:{rows:[{cols:[{template:"Доступные действия",css:"webix_template-actions",borderless:!0,height:40},{view:"button",id:"buttonClosePopupActions",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("contextActionsPopup")&&$$("contextActionsPopup").hide()}}]},{view:"scrollview",borderless:!0,scroll:"y",body:{id:"contextActionsPopupContainer",css:"webix_context-actions-popup",rows:[t]}}]}}),click:function(){$$("contextActionsPopup").config.height!==$$("customInputsAdaptive").$height+60&&($$("contextActionsPopup").config.height=$$("customInputsAdaptive").$height+60,$$("contextActionsPopup").resize())}},2)}}else if((window.innerWidth>830&&$$("contextActionsBtnAdaptive")||window.innerWidth>830&&$$("contextActionsBtn"))&&$$("customInputsAdaptive")){const e=$$("table-view-filterIdView").getParentView(),t={id:"customInputs",cols:$$("customInputsAdaptive")._collection[0].rows};$$("contextActionsBtnAdaptive")&&$$("contextActionsBtnAdaptive").getParentView().removeView($$("contextActionsBtnAdaptive")),$$("contextActionsPopup").destructor(),$$("customInputs")||$$(e.config.id).addView({id:"customInputsMain",cols:[t]},2)}e("contextActionsPopup")}catch(e){console.log(e),r("017-007",e)}try{if(window.innerWidth<850&&$$("dashboard-tool-main")&&$$("dashboard-tool-main").isVisible()){let e;$$("dashboard-tool-main").hide(),$$("dashboard-tool-main")&&(e=$$("dashboard-tool-main")._collection),$$("dashFilterBtn")||$$("dashboardInfoContainer").addView({id:"dashboard-tool-adaptive",cols:[{view:"button",id:"dashFilterBtn",value:"Фильтры",css:{margin:"10px 0px!important"},height:46,margin:10,popup:webix.ui({view:"popup",css:"webix_popup-dash-container webix_popup-config",modal:!0,id:"contextDashFilterPopup",escHide:!0,position:"center",body:{id:"contextDashFilterPopupContainer",rows:[]}}),click:function(){$$("contextDashFilterPopup").show(),$$("buttonClosePopupDashFilter")&&!$$("buttonClosePopupDashFilter").isVisible()&&$$("buttonClosePopupDashFilter").show()}}]},0),$$("dashboard-tool-main")&&$$("dashboard-tool-main").getParentView().removeView($$("dashboard-tool-main")),$$("dashToolInputsAdaptive")||($$("contextDashFilterPopupContainer").addView({id:"dashToolInputsAdaptive",rows:e}),$$("dashboard-tool-main")&&$$("dashboard-tool-main").getParentView().removeView($$("dashboard-tool-main")))}if(window.innerWidth>850&&$$("dashboard-tool-adaptive")){let e=$$("dashToolInputsAdaptive")._collection;$$("dashboard-tool-adaptive")&&$$("dashboard-tool-adaptive").getParentView().removeView($$("dashboard-tool-adaptive")),$$("contextDashFilterPopup")&&$$("contextDashFilterPopup").destructor(),$$("dashFilterBtn")&&$$("dashFilterBtn").getParentView().removeView($$("dashFilterBtn")),$$("dashboardTool").addView({id:"dashboard-tool-main",padding:20,minWidth:250,rows:e}),$$("buttonClosePopupDashFilter")&&$$("buttonClosePopupDashFilter").isVisible()&&$$("buttonClosePopupDashFilter").hide()}e("contextDashFilterPopupContainer")}catch(e){console.log(e),r("017-007",e)}try{window.innerWidth<1200&&($$("table-editForm").clear(),$$("table-editForm").clearValidation(),$$("table-saveNewBtn").isVisible()?$$("table-saveNewBtn").hide():$$("table-saveBtn").isVisible()&&$$("table-saveBtn").hide(),$$("table-delBtnId").disable(),$$("table-newAddBtnId").enable(),$$("inputsTable")&&$$("inputsTable").getParentView().removeView($$("inputsTable")),$$("table-editTableBtnId")&&!$$("table-editTableBtnId").isVisible()&&$$("table-editTableBtnId").show(),$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide()),window.innerWidth>1200&&($$("table-editTableBtnId")&&$$("table-editTableBtnId").isVisible()&&$$("table-editTableBtnId").hide(),$$("editTableBarContainer")&&!$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").show(),$$("editTableBarAdaptive").config.width=350,$$("editTableBarAdaptive").resize(),$$("editTableBarContainer").addView($$("editTableBarAdaptive")),$$("tableEditPopup")&&$$("tableEditPopup").destructor(),$$("editTableBarHeadline")&&$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").hide()),e("editTableBarAdaptive",1.5)}catch(e){console.log(e),r("017-007",e)}try{window.innerWidth<1200&&($$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide(),$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").hide()),window.innerWidth,e("editFilterBarAdaptive",1.5),e("popupFilterEdit",1.5)}catch(e){console.log(e),r("017-007",e)}}),!0)}(),window.location.host.includes("localhost:3000")?Backbone.history.start({pushState:!0,root:"/index.html/"}):Backbone.history.start({pushState:!0,root:"/init/default/spaw/"}),function(){try{window.innerWidth<850&&$$("tree")&&$$("tree").isVisible()&&$$("tree").hide(),$$("tableFilterPopup")||webix.ui({view:"popup",css:"webix_popup-table-container webix_popup-config",modal:!0,id:"tableFilterPopup",escHide:!0,position:"center",body:{id:"tableFilterPopupContainer",rows:[]}})}catch(e){console.log(e),r("017-007",e)}}(),function(){let e=null;webix.event(document.body,"mousedown",(t=>{const i=$$(t);i&&i.getInputNode&&(e=i)})),webix.event(document,"click",(t=>{const i=$$(t);e&&i&&i.config.id!==e.config.id&&(t.cancelBubble=!0,webix.html.preventEvent(t)),e=null}),{capture:!0})}(),function(){webix.ajax("/init/default/api/userprefs/",{success:function(e,i,n){try{let e=webix.storage.local.get("user");if(i=i.json().content,e&&(i.forEach((function(i,n){i.owner==e.id&&t(i.name,i.prefs)})),"/index.html/content"==window.location.pathname||"/init/default/spaw/content"==window.location.pathname)){let e=webix.storage.local.get("userprefsWorkspaceForm"),t=webix.storage.local.get("userLocationHref");const i=new URL(t.href);e&&e.LoginActionOpt&&i.origin==window.location.origin&&2==e.LoginActionOpt&&t&&t.href&&t.href!==window.location.href&&window.location.replace(t.href)}}catch(e){console.log(e),r("010-000",e)}},error:function(e,t,i){s("010-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("010-000",e.status,e.statusText,e.responseURL)}));let e=webix.storage.local.get("userprefsWorkspaceForm");try{e&&void 0!==e.logBlockOpt&&("2"==e.logBlockOpt?($$("logLayout").config.height=5,$$("logLayout").resize(),$$("webix_log-btn").config.icon="wxi-eye",$$("webix_log-btn").refresh()):"1"==e.logBlockOpt&&($$("logLayout").config.height=90,$$("logLayout").resize(),$$("webix_log-btn").config.icon="wxi-eye-slash",$$("webix_log-btn").refresh()))}catch(e){console.log(e),r("010-000",e)}}(),window.addEventListener("popstate",(function(e){window.location.replace(window.location.href),window.location.reload()})),function(){let e;function t(){webix.ajax().get("/init/default/api/userprefs/",{success:function(e,t,n){if("e"==(t=t.json().content).err_type&&i("error",t.error),"/index.html/content"!==window.location.pathname){let e=!1,n={};n.href=window.location.href;let o={name:"userLocationHref",prefs:n};try{t.forEach((function(t,n){"userLocationHref"==t.name&&(e=!0,webix.ajax().put("/init/default/api/userprefs/"+t.id,o,{success:function(e,t,n){"e"==(t=t.json()).err_type&&i("error",t.error)},error:function(e,t,i){s("008-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("008-011",e.status,e.statusText,e.responseURL)})))}))}catch(e){console.log(e),r("008-000",e)}try{if(!e){let e=webix.storage.local.get("user").id;e?o.owner=e:webix.ajax("/init/default/api/whoami",{success:function(e,t,i){o.owner=t.json().content.id;let n={};n.id=t.json().content.id,n.name=t.json().content.first_name,n.username=t.json().content.username},error:function(e,t,i){s("008-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("008-000",e.status,e.statusText,e.responseURL)})),webix.ajax().post("/init/default/api/userprefs/",o,{success:function(e,t,n){"e"==(t=t.json()).err_type&&i("error",t.error)},error:function(e,t,i){s("008-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("008-001",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),r("008-000",e)}}},error:function(e,t,i){s("008-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),s("008-000",e.status,e.statusText,e.responseURL)})).then((function(e){Backbone.history.navigate("logout",{trigger:!0})}))}function n(){try{"/index.html"!==window.location.pathname&&"/"!==window.location.pathname&&"/init/default/spaw"!==window.location.pathname&&(clearTimeout(e),e=setTimeout(t,6e5))}catch(e){console.log(e),r("008-000",e)}}window.onload=n,window.onmousemove=n,window.onmousedown=n,window.ontouchstart=n,window.onclick=n,window.onkeypress=n,window.addEventListener("scroll",n,!0)}(),webix.message.position="bottom",webix.i18n.setLocale("ru-RU"),webix.i18n.parseFormat="%d.%m.%Y %H:%i:%s",webix.i18n.setLocale()}))}catch(e){console.log(e),alert("Ошибка при выполнении "+e),r("007-005",e)}})();