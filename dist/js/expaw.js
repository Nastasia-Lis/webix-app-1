(()=>{"use strict";const e={id:"dashboardTool",css:"webix_dashTool",rows:[]};function t(e,t){"undefined"!=typeof Storage&&localStorage.setItem(e,t)}const i={};function n(e){if("/index.html"!==window.location.pathname&&"/init/default/spaw"!==window.location.pathname)return webix.ajax().get(`/init/default/api/${e}.json`).then((function(t){return i[e]=t.json(),"fields"==e&&i[e]&&(i.tableNames=function(e){let t=[];return Object.values(e).forEach((function(i,n){t.push({id:Object.keys(e)[n],name:i.plural?i.plural:i.singular})})),t}(i[e].content)),i[e]})).catch((e=>{console.log(e),o("error","Загрузка данных: "+e.statusText+" "+e.status+" "+e.responseURL+" ( Подробности: "+e.responseText+") "),function(e){401===e.status&&"/index.html"!==window.location.pathname&&Backbone.history.navigate("/",{trigger:!0})}(e)}))}function o(e,o){const r=new Date;let a=`${r.getDate()}.${String(r.getMonth()+1).padStart(2,"0")}.${r.getFullYear()} ${r.getHours()}:${String(r.getMinutes()).padStart(2,"0")}:${String(r.getSeconds()).padStart(2,"0")}`;try{let r,s=null;if($$("tree").getSelectedItem())s=$$("tree").getSelectedItem().id;else{let e=window.location.pathname,t=e.lastIndexOf("/");s=e.slice(t+1)}if(s){let e;!async function(e,t){var r;i.tableNames||await n("fields"),i.tableNames&&i.tableNames.forEach((function(i,n){i.id==t&&(e=i.name)})),(r=e)||(r="expa"),$$("logBlock-list").add({date:a,value:o,src:r})}(e,s)}else $$("logBlock-list").add({date:a,value:o,src:"Expa v1.0.32"});let l=document.querySelector(".webix_log-block");l&&l.querySelectorAll(".webix_list_item").forEach((function(e,t){r=t}));let c=document.querySelectorAll(".webix_list_item")[r];"error"==e&&(void 0!==c&&c.style.setProperty("color","red","important"),"wxi-eye"==$$("webix_log-btn").config.icon&&($$("logLayout").config.height=90,$$("logLayout").resize(),$$("webix_log-btn").setValue(2),$$("webix_log-btn").config.icon="wxi-eye-slash",$$("webix_log-btn").refresh(),t("LogVisible",JSON.stringify("show"))))}catch(e){console.log(e),s("006-000",e)}}let r=0;const a={id:"logLayout",height:80,rows:[{template:"<div class='webix_log-headline'>Системные сообщения</div>",height:30},{id:"logBlock-list",css:"webix_log-block",view:"list",template:"#date# — #value#  (Источник: #src#)",data:[],on:{onAfterLoad:function(){try{o("success","Интерфейс загружен")}catch(e){console.log(e),s("006-000",e)}},onAfterAdd:function(e,t){try{"wxi-eye"==$$("webix_log-btn").config.icon?(""==$$("webix_log-btn").config.badge&&(r=0),r++,$$("webix_log-btn").config.badge=r,$$("webix_log-btn").setValue(1),$$("webix_log-btn").refresh()):"wxi-eye-slash"==$$("webix_log-btn").config.icon&&(r=0,$$("webix_log-btn").config.badge="",$$("webix_log-btn").setValue(2),$$("webix_log-btn").refresh())}catch(e){console.log(e),s("006-000",e)}}}}]};function s(e,t,i=!1){try{return $$("webix_log-btn").setValue(2),r=0,o("error",i?"ОШИБКА "+e+": "+t:"ОШИБКА "+e+": "+t.stack)}catch(t){console.log(t),alert("Ошибка при выполнении "+t),window.stop()}}function l(e,t,i,n){return $$("webix_log-btn").setValue(2),r=0,o("error","ОШИБКА "+e+": СТАТУС: "+t+" "+i+". ПОДРОБНОСТИ: "+n)}let c,d;function u(e,t,i,n){let r=[];if("get"==i)if("refresh"==n)try{e.forEach(((e,t)=>{e.id.includes("customCombo")?r.push(e.name+"="+$$(e.id).getText()):(e.id.includes("customInputs")||e.id.includes("customDatepicker"))&&r.push(e.name+"="+$$(e.id).getValue())})),webix.ajax(t+"?"+r.join("&"),{success:function(e,t,i){try{$$("table-view").clearAll(),0!==(t=t.json().content).length?($$("table-view").hideOverlay("Ничего не найдено"),$$("table-view").parse(t)):$$("table-view").showOverlay("Ничего не найдено"),c=$$("table-view").count(),$$("table-view-findElements").setValues(c.toString())}catch(e){console.log(e),s("018-000",e)}},error:function(e,t,i){l("018-000",i.status,i.statusText,i.responseURL),$$("table-newAddBtnId")&&!$$("table-newAddBtnId").isEnabled()&&$$("table-newAddBtnId").enable()}}).catch((e=>{console.log(e),l("018-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),s("018-000",e)}else"download"==n&&webix.ajax().response("blob").get(t,(function(e,t,i){try{webix.html.download(t,"table.docx")}catch(e){console.log(e),s("018-000",e)}})).catch((e=>{console.log(e),l("018-000",e.status,e.statusText,e.responseURL)}));else if("post"==i)try{e.forEach(((e,t)=>{e.id.includes("customUploader")&&$$(e.id).send((function(t){"e"==t.err_type?($$("table-view").parse($$(e.id).getValue()),o("error",t.err)):"i"==t.err_type?(o("success",t.err),$$("table-view").refresh()):"x"==t.err_type&&o("debug",t.err)}))}))}catch(e){console.log(e),s("018-000",e)}}function h(e){return new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get("/init/default/api/"+e).then((function(e){try{e=e.json().content;let t,i=[];return e.forEach(((e,n)=>{let o=0;for(;o<=Object.values(e).length;){if("string"==typeof Object.values(e)[o]){t=Object.keys(e)[o];break}o++}if(null==e[t])for(;o<=Object.values(e).length;){if("number"==typeof Object.values(e)[1]){t=Object.keys(e)[1];break}o++}i.push({id:e.id,value:e[t]})})),i}catch(e){console.log(e),s("018-000",e)}})).catch((e=>{console.log(e),l("018-000",e.status,e.statusText,e.responseURL)}))}}})}function $(e,t){let r,a,d,$,p;function f(){let n=i.fields.content[t],o=n.inputs;!function(){if($$("contextActionsBtn")&&$$(d.config.id).removeView($$("contextActionsBtn")),n.inputs){let t;t=function(){let t=[];function i(e,t){return new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get("/init/default/api/"+e[t].apiname).then((function(e){let t=e.json().content,i=[];try{return void 0!==t[0].name?t.forEach((function(e,t){i.push({id:t+1,value:e.name})})):t.forEach((function(e,t){i.push({id:t+1,value:e})})),i}catch(e){console.log(e),s("018-000",e)}})).catch((e=>{console.log(e),l("018-000",e.status,e.statusText,e.responseURL)}))}}})}function r(e){let t=e.getParentView().getChildViews(),i=[];return t.forEach(((e,t)=>{void 0!==e.config.id&&("text"==e.config.view?i.push({id:e.config.id,name:"substr"}):"combo"==e.config.view?i.push({id:e.config.id,name:"valtype"}):("uploader"==e.config.view||"datepicker"==e.config.view)&&i.push({id:e.config.id}))})),i}return Object.keys(n.inputs).forEach(((a,s)=>{if("string"==o[a].type)t.push(function(e,t){return{view:"text",placeholder:o[e].label,id:"customInputs"+t,height:48,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",o[e].comment)},onChange:function(){$$("customInputs").getChildViews().forEach((function(e,t){"button"!=e.config.view||$$(e.config.id).isEnabled()||$$(e.config.id).enable()}))}}}}(a,s));else if("apiselect"==o[a].type)t.push(function(e,t){return{view:"combo",height:48,id:"customCombo"+t,placeholder:o[e].label,labelPosition:"top",options:{data:i(o,e)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",o[e].comment)}}}}(a,s));else if("submit"==o[a].type||"button"==o[a].type){let i=o[a].action,l=n.actions[i];"DELETE"==l.verb&&"submit"!==i?function(t){let i=$$(e).getColumns().length;$$(e).config.columns.splice(i,0,{id:"action"+t,header:"Действие",maxWidth:100,template:"{common.trashIcon()}"}),$$(e).refreshColumns()}(s):"DELETE"==l.verb?t.push(function(e,t,i){return{view:"button",id:"customBtnDel"+i,css:"webix_danger",type:"icon",disabled:!0,icon:"wxi-trash",inputHeight:48,height:48,value:o[e].label,click:function(e){u(r(this),t.url,"delete")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",o[e].comment)}}}}(a,l,s)):t.push(function(e,t,i){return{view:"button",css:"webix_primary",id:"customBtn"+i,inputHeight:46,height:46,value:o[e].label,click:function(e){let i=r(this);"GET"==t.verb?"refresh"==t.rtype?u(i,t.url,"get","refresh"):"download"==t.rtype&&u(i,t.url,"get","download"):"POST"==t.verb?u(i,t.url,"post"):"download"==t.verb&&u(i,t.url,"get","download"),$$("contextActionsPopup")&&$$("contextActionsPopup").hide()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",o[e].comment)}}}}(a,l,s))}else"upload"==o[a].type?t.push(function(e,t){return{view:"uploader",value:"Upload file",id:"customUploader"+t,height:48,autosend:!1,upload:n.actions.submit.url,label:o[e].label,labelPosition:"top",click:function(){$$("contextActionsPopup")&&$$("contextActionsPopup").destructor()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",o[e].comment)}}}}(a,s)):"datetime"==o[a].type?t.push(function(e,t){return{view:"datepicker",format:"%d.%m.%Y %H:%i:%s",placeholder:o[e].label,id:"customDatepicker"+t,timepicker:!0,labelPosition:"top",height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",o[e].comment)},onChange:function(){$$("customInputs").getChildViews().forEach((function(e,t){"button"!=e.config.view||$$(e.config.id).isEnabled()||$$(e.config.id).enable()}))}}}}(a,s)):"checkbox"==o[a].type&&t.push(function(e,t){return{view:"checkbox",id:"customСheckbox"+t,css:"webix_checkbox-style",labelRight:o[e].label,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",o[e].comment)},onChange:function(){$$("customInputs").getChildViews().forEach((function(e,t){"button"!=e.config.view||$$(e.config.id).isEnabled()||$$(e.config.id).enable()}))}}}}(a,s))})),t}(),window.innerWidth>830?function(e){e.forEach((function(e,t){"text"==e.view&&(e.maxWidth=300,e.minWidth=150),"combo"==e.view&&(e.width=250),"button"==e.view&&"wxi-trash"==e.icon&&(e.width=100),"button"==e.view&&"webix_primary"==e.css&&(e.maxWidth=550,e.minWidth=100),"datepicker"==e.view&&(e.width=300,e.minWidth=100),"checkbox"==e.view&&(e.minWidth=220)}));let t={id:"customInputs",css:"webix_custom-inp",cols:e},i=$$("table-view-filterIdView").getParentView();$$(i.config.id).addView({id:"customInputsMain",cols:[t]},2)}(t):function(e){e.forEach((function(e,t){e.bottomPadding=10})),e.push({});let t={id:"customInputsAdaptive",rows:[{id:"customInputs",css:"webix_custom-inp",rows:e}]};$$(d.config.id).addView({view:"button",id:"contextActionsBtnAdaptive",maxWidth:100,value:"Действия",css:"webix_primary",popup:webix.ui({view:"popup",css:"webix_popup-actions-container webix_popup-config",modal:!0,id:"contextActionsPopup",escHide:!0,position:"center",body:{rows:[{cols:[{template:"Доступные действия",css:"webix_template-actions",borderless:!0,height:40},{view:"button",id:"buttonClosePopupActions",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("contextActionsPopup")&&$$("contextActionsPopup").hide()}}]},{view:"scrollview",borderless:!0,scroll:"y",body:{id:"contextActionsPopupContainer",css:"webix_context-actions-popup",rows:[t]}}]}}),click:function(){$$("contextActionsPopup").config.height!==$$("customInputs").$height+50&&($$("contextActionsPopup").config.height=$$("customInputs").$height+50,$$("contextActionsPopup").resize());let e=window.innerWidth-100;$$("contextActionsPopup").$width>200&&($$("contextActionsPopup").config.width=e,$$("contextActionsPopup").resize())}},2)}(t)}}()}try{$=t,p=$$("tree").getItem(t),p||(p=t),e.includes("view")?(r="table-view-search",a="table-view-findElements",d=$$("table-view-filterIdView").getParentView()):(r="table-search",a="table-findElements",d=$$("table-filterId").getParentView()),null==p?o("error","Данные не найдены"):($$(e).clearAll(),"table-view"==e&&($$("contextActionsPopup")&&$$("contextActionsPopup").destructor(),$$("contextActionsBtnAdaptive")&&d.removeView($$("contextActionsBtnAdaptive")),$$("customInputs")&&$$("customInputs").getParentView().removeView($$("customInputs")),$$("customInputsMain")&&$$("customInputsMain").getParentView().removeView($$("customInputsMain"))),async function(){i.fields||await n("fields"),i.fields&&(i.fields.content.treeTemplate={fields:{id:{type:"id",unique:!1,notnull:!1,length:512,label:"Id",comment:null,default:"None"},pid:{type:"reference trees",unique:!1,notnull:!1,length:512,label:"Родитель",comment:null,default:"None"},owner:{type:"reference auth_user",unique:!1,notnull:!1,length:512,label:"Владелец",comment:null,default:"None"},ttype:{type:"integer",unique:!1,notnull:!1,length:512,label:"Тип",comment:"Тип записи|1=системная;2=пользовательская|Перечисление",default:"1"},name:{type:"string",unique:!1,notnull:!1,length:100,label:"Наименование",comment:null,default:""},descr:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Описание",comment:null,default:""},value:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Значение",comment:null,default:""},cdt:{type:"datetime",unique:!1,notnull:!1,length:512,label:"Создано",comment:null,default:"now"}},singular:"Классификатор-пример",ref_name:"name",plural:"Классификаторы-пример",type:"treeConf"},function(n){let o,r,a=!1,s=i.fields.content[t];if(n.forEach((function(e,t){"action"==e.type&&"detail"==s.actions[e.id].rtype&&(a=!0,o=t,r=e.id)})),void 0!==r){let t=s.actions[r].url;a&&($$(e).config.columns.splice(0,0,{id:"action-first"+o,maxWidth:130,src:t,header:"Подробнее",template:"<span class='webix_icon wxi-angle-down'></span> "}),$$(e).refreshColumns())}}(function(){let n,o=i.fields.content[t],r=o.fields,a=Object.keys(o.fields),s=[];return a.forEach((function(e){if(n=r[e].type,n.includes("reference")){let t=n.slice(10);r[e].editor="combo",r[e].collection=h(t),r[e].template=function(e,t,i,n){let o=n.collection.getItem(e[n.id]);return o?o.value:""}}else"datetime"==n?(r[e].format=webix.i18n.fullDateFormatStr,r[e].editor="date"):"string"==n||"text"==n?r[e].editor="text":"integer"==n?(r[e].editor="text",r[e].numberFormat="1 111"):"boolean"==n&&(r[e].editor="combo",r[e].collection=[{id:1,value:"Да"},{id:2,value:"Нет"}]);r[e].id=e,r[e].fillspace=!0,r[e].header=r[e].label,"id"==r[e].id&&(r[e].hidden=!0),s.push(r[e])})),$$(e).refreshColumns(s),s}()),f(),function(){let n=i.fields.content[t];function o(t){$$(t).load({$proxy:!0,load:function(i,n){return webix.ajax().get("/init/default/api/"+$,{success:function(i,n,o){n=n.json().content;try{$$(t).clearAll(),"table"==t&&($$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable(),$$("table-filterId").isEnabled()||$$("table-filterId").enable(),$$("table-exportBtn").isEnabled()||$$("table-exportBtn").enable()),function(){let e;n.forEach((function(t,i){function n(i){t[i]&&(e=new Date(t[i]),t[i]=e)}n("cdt"),n("edt"),n("sdt"),n("time_stamp")}))}(),0!==n.length?($$(e).hideOverlay("Ничего не найдено"),$$(e).parse(n)):($$(e).showOverlay("Ничего не найдено"),$$(e).clearAll()),c=$$(e).count(),$$(a).setValues(c.toString()),"table"==e&&$$("table-findElements").setValues(c.toString())}catch(e){console.log(e)}},error:function(e,t,i){!function(){c="-";try{$$(a).setValues(c.toString()),$$("table-findElements").setValues(c.toString()),$$("table-newAddBtnId").isEnabled()&&$$("table-newAddBtnId").disable(),$$("table-filterId")&&$$("table-filterId").disable(),$$("table-exportBtn")&&$$("table-exportBtn").disable()}catch(e){console.log(e)}}()}}).catch((e=>{console.log(e),l("018-000",e.status,e.statusText,e.responseURL)}))}})}"dbtable"==n.type?o("table"):"tform"==n.type&&o("table-view"),function(){if(n.autorefresh){let e=webix.storage.local.get("userprefsOtherForm");void 0!==e.autorefCounterOpt&&(e.autorefCounterOpt>=15e3?setInterval((function(){"dbtable"==n.type?o("table"):"tform"==n.type&&o("table-view")}),e.autorefCounterOpt):setInterval((function(){"dbtable"==n.type?o("table"):"tform"==n.type&&o("table-view")}),12e4))}}()}())}())}catch(e){console.log(e),s("018-000",e)}}function p(e,t=!1){let r;function a(e,t,a=!1){webix.ajax().get(e,{success:function(l,c,d){let u=[{type:"wide",rows:[]}],h=c.json().charts,$={};try{if($$("dashBodyScroll")&&$$("dashBodyScroll").getParentView().removeView($$("dashBodyScroll")),a||($$("dashboardInfoContainerInner")&&$$("dashboardInfoContainerInner").getParentView().removeView($$("dashboardInfoContainerInner")),$$("dash-template")&&$$("dash-template").getParentView().removeView($$("dash-template")),$$("dashboard-tool-main")&&$$("dashboard-tool-main").getParentView().removeView($$("dashboard-tool-main")),$$("dashboard-tool-adaptive")&&$$("dashboard-tool-adaptive").getParentView().removeView($$("dashboard-tool-adaptive"))),null==h)$$("dashboardTool").addView({view:"scrollview",id:"dashboard-tool-main",borderless:!0,css:{margin:"20px!important",height:"50px!important"},body:{view:"flexlayout",rows:[]}},0),$$("dashboardTool").addView({rows:[{template:"",id:"dash-template",css:"webix_style-template-count webix-block-title",borderless:!1,height:40}]},1),$$("dashboardInfoContainer").addView({view:"scrollview",scroll:"auto",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",borderless:!0,body:{view:"flexlayout",rows:[]}}]}}),o("error","Ошибка при загрузке данных");else{let e;async function o(){i.tableNames||await n("fields"),i.tableNames&&i.tableNames.forEach((function(t,i){t.id==r&&(e=t.name)}))}h.forEach((function(e,t){$=e.title,delete e.title,e.borderless=!0,e.minWidth=250,u[0].rows.push({css:"webix_dash-chart-headline",rows:[{template:$,borderless:!0,css:{"font-weight":"400!important","font-size":"17px!important"},height:35},e]})})),r.includes("single")&&(r=r.slice(0,r.search("-single"))),o(),a?$$("dashboardInfoContainerInner").addView({view:"scrollview",scroll:"y",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",rows:u}]}}):(window.innerWidth>830?$$("dashboardTool").addView({id:"dashboard-tool-main",padding:20,minWidth:250,rows:[{id:"dashboardToolHeadContainer",cols:[{template:"Фильтр",height:30,css:"webix_dash-filter-headline",borderless:!0},{view:"button",id:"buttonClosePopupDashFilter",css:"webix_close-btn",type:"icon",hotkey:"esc",hidden:!0,width:25,icon:"wxi-close",click:function(){$$("contextDashFilterPopup")&&$$("contextDashFilterPopup").hide()}}]},{rows:t}]}):$$("dashFilterBtn")||$$("dashboardInfoContainer").addView({id:"dashboard-tool-adaptive",cols:[{view:"button",id:"dashFilterBtn",value:"Фильтры",css:{margin:"10px 0px!important"},height:46,margin:10,popup:webix.ui({view:"popup",css:"webix_popup-dash-container webix_popup-config",modal:!0,id:"contextDashFilterPopup",escHide:!0,position:"center",body:{id:"contextDashFilterPopupContainer",rows:[{id:"dashToolInputsAdaptive",rows:[{id:"dashboardToolHeadContainer",cols:[{template:"Фильтр",height:30,css:"webix_dash-filter-headline",borderless:!0},{view:"button",id:"buttonClosePopupDashFilter",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("contextDashFilterPopup")&&$$("contextDashFilterPopup").hide()}}]},{rows:t}]}]}}),click:function(){let e=window.innerWidth-130;e>200&&($$("contextDashFilterPopupContainer").config.width=e,$$("contextDashFilterPopupContainer").resize())}}]},0),$$("dashboardInfoContainer").addView({id:"dashboardInfoContainerInner",rows:[{template:e,id:"dash-template",css:"webix_style-template-count webix_block-title",borderless:!1,height:75},{view:"scrollview",scroll:"y",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",rows:u}]}}]}))}"wxi-eye"==$$("webix_log-btn").config.icon?($$("logLayout").config.height=90,$$("logLayout").resize(),$$("logLayout").config.height=5,$$("logLayout").resize()):($$("logLayout").config.height=5,$$("logLayout").resize(),$$("logLayout").config.height=90,$$("logLayout").resize()),(e.includes("?")||e.includes("sdt")&&e.includes("edt"))&&o("success","Данные обновлены")}catch(e){console.log(e),s("018-004",e)}},error:function(e,t,i){l("018-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("018-000",e.status,e.statusText,e.responseURL)}))}$$("tree").getSelectedItem()?r=$$("tree").getSelectedItem().id:e&&(r=e);try{$$("dashBodyScroll")&&$$("dashBodyScroll").getParentView().removeView($$("dashBodyScroll")),$$("dashBodyScroll")||async function(){i.fields||await n("fields"),i.fields&&function(){let e,t,n,s=i.fields.content,l=[];Object.values(s).forEach((function(i,c){if("dashboard"==i.type&&Object.keys(s)[c]==r){let r=i.inputs;a(i.actions.submit.url,function(i,n){function r(e,t){let i={view:"datepicker",format:"%d.%m.%y",editable:!0,value:new Date,placeholder:t.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",t.comment)}}};if("first"==e){let e=i;return e.id="dashDatepicker_sdt",e}if("last"==e){let e=i;return e.id="dashDatepicker_edt",e}}function s(e){let t={view:"datepicker",format:"%H:%i:%s",placeholder:"Время",height:48,editable:!0,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",hotkey:"enter",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}};if("first"==e){let e=t;return e.id="dashDatepicker_sdt-time",e}if("last"==e){let e=t;return e.id="dashDatepicker_edt-time",e}}return function(n){Object.values(i).forEach((function(c,d){"datetime"==c.type&&3==c.order?(Object.keys(i)[d],l.push({width:200,id:"datepicker-containersdt",rows:[{template:"Начиная с:",height:30,borderless:!0,css:"webix_template-datepicker"},r("first",c),{height:10},s("first"),{height:20},{template:"Заканчивая:",height:30,borderless:!0,css:"webix_template-datepicker"},r("last",c),{height:10},s("last")]})):"submit"==c.type&&(e=c.action,t=n.actions[e],l.push(function(e,i){return{rows:[{height:10},{view:"button",css:"webix_primary",id:"dashBtn"+i,inputHeight:48,height:48,minWidth:100,maxWidth:200,value:e.label,click:function(){let e,n=[],r=[],s=webix.Date.dateToStr("%d.%m.%y"),c=webix.Date.dateToStr("%H:%i:%s"),d="",u="",h=!0;l.forEach((function(e,t){e.id.includes("container")&&$$(e.id).getChildViews().forEach((function(e,t){e.config.id.includes("sdt")?e.config.id.includes("time")?null!==$$(e.config.id).getValue()?d=d.concat(" "+c($$(e.config.id).getValue())):h=!1:null!==$$(e.config.id).getValue()?d=s($$(e.config.id).getValue()):h=!1:e.config.id.includes("edt")&&(e.config.id.includes("time")?null!==$$(e.config.id).getValue()?u=u.concat(" "+c($$(e.config.id).getValue())):h=!1:null!==$$(e.config.id).getValue()?u=s($$(e.config.id).getValue()):h=!1)}))})),n.push("sdt="+d),n.push("edt="+u),r.push(d),r.push(u),function(){if(h){let s=webix.Date.dateToStr("%Y/%m/%d %H:%i:%s");webix.filters.date.greater(s(r[0]),s(r[1]))&&r[0]!=r[1]?o("error","Начало периода больше, чем конец"):(e=t.url+"?"+n.join("&"),$$("dashboard-charts")&&$$("dashboardBody").removeView($$("dashboard-charts")),a(e,l,!0),$$("dashBtn"+i).disable(),setInterval((function(){$$("dashBtn"+i).enable()}),1e3))}else o("error","Не все поля заполнены")}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",e.comment)}}},{}]}}(c,d)))}))}(n),l}(r,i)),function(e){if(e.autorefresh){let e=webix.storage.local.get("userprefsOtherForm");void 0!==e.autorefCounterOpt&&(e.autorefCounterOpt>=15e3?setInterval((function(){a(n.actions.submit.url,l)}),e.autorefCounterOpt):setInterval((function(){a(n.actions.submit.url,l)}),5e4))}}(i)}}))}()}()}catch(e){console.log(e),s("018-000",e)}}function f(){$$("treeEdit").clearAll(),webix.ajax().get("/init/default/api/trees",{success:function(e,t,i){try{(t=t.json().content)[0].pid=0;let e={},i=[],n=[];t.forEach((function(e,t){0==e.pid?n.push({id:e.id,open:!0,value:e.name,pid:e.pid,data:[]}):n.push({id:e.id,value:e.name,pid:e.pid,data:[]})})),n.forEach((function(t,o){e[t.id]=o,0!==t.pid&&t.pid!==t.id&&null!==t.pid?n[e[t.pid]].data.push(t):i.push(t)})),$$("treeEdit").parse(i)}catch(e){console.log(e),s("018-004",e)}},error:function(e,t,i){l("018-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("018-000",e.status,e.statusText,e.responseURL)}))}function b(e){return webix.confirm({width:300,ok:"Да",cancel:"Отмена",title:e,text:"Вы уверены, что хотите продолжить?"})}function w(e,t,i){return e||t||i?webix.modalbox({title:e,css:"webix_modal-custom-save",buttons:i,width:500,text:t}):webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"})}function m(){if(void 0!==$$("tree").getSelectedItem()){let e=$$("tree").getSelectedItem().id;d=0==e.length?void 0:e}else{let e=window.location.pathname,t=e.lastIndexOf("/");d=e.slice(t+1)}}function g(){let e={};Object.keys($$("editTableFormProperty").getValues()).forEach((function(t,i){let n=$$("editTableFormProperty").getItem(t),o=$$("editTableFormProperty").getValues();e[t]={},o[t].length>n.length?e[t].length="Длина строки не должна превышать "+n.length+" симв.":e[t].length=null,1==n.notnull&&0==o[t].length?e[t].notnull="Поле не может быть пустым":e[t].notnull=null,e[t].unique=null,1==n.unique&&Object.values($$("table").data.pull).forEach((function(i,n){0==o[t].localeCompare(i[t])&&i.id!==$$("table").getSelectedId().id&&(e[t].unique="Поле должно быть уникальным")}))}));let t=[];return Object.values(e).forEach((function(i,n){Object.values(i).forEach((function(o,r){if(null!==o){let a=Object.keys(e)[n],s=o,l=Object.keys(i)[r];t.push({nameCol:a,typeError:l,textError:s})}}))})),t}function v(e=!1,t=!1,i=!1){try{m();let n=$$("editTableFormProperty").getValues();g().length?g().forEach((function(e,t){let i;$$("table").getColumns().forEach((function(t,n){t.id==e.nameCol&&(i=t.label)})),o("error",e.textError+" (Поле: "+i+")")})):n.id&&webix.ajax().put("/init/default/api/"+d+"/"+n.id,function(e){let t={};return Object.values(e).forEach((function(i,n){0!==i.length&&(t[Object.keys(e)[n]]=i)})),t}(n),{success:function(r,a,s){a=a.json(),t||($$("table").updateItem(n.id,n),i||($$("table").clearSelection(),$$("editTableFormProperty").clear(),F(),e?($$("editTableFormProperty").isVisible()||$$("editTableFormProperty").show(),$$("table").filter(!1),T("table-editForm"),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show()):($$("table-newAddBtnId").enable(),$$("EditEmptyTempalte")&&!$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").show(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh()))),"i"==a.err_type&&(window.innerWidth<1200&&$$("tableEditPopup")&&$$("tableEditPopup").hide(),o("success","Данные сохранены")),"e"==a.err_type&&o("error",a.error)},error:function(e,t,i){l("003-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("003-011",e.status,e.statusText,e.responseURL)}))}catch(e){s("003-000",e)}}function y(){try{1==$$("editTableFormProperty").config.dirty?w().then((function(e){1==e?($$("table").filter(!1),T("table-editForm"),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh()):2==e&&(v(!0),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh())})):($$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide(),$$("editTableFormProperty")&&!$$("editTableFormProperty").isVisible()&&$$("editTableFormProperty").show(),$$("editTableFormProperty").clear(),$$("table").clearSelection(),$$("table").filter(!1),$$("table").hideOverlay("Ничего не найдено"),T("table-editForm"),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show(),$$("table-newAddBtnId").disable())}catch(e){s("003-000",e)}}function x(e=!1){try{if(m(),g().length)g().forEach((function(e,t){let i;$$("table").getColumns().forEach((function(t,n){t.id==e.nameCol&&(i=t.label)})),o("error",e.textError+" (Поле: "+i+")")}));else{let t=$$("editTableFormProperty").getValues();webix.ajax().post("/init/default/api/"+d,t,{success:function(i,n,r){if(null!==(n=n.json()).content.id)t.id=n.content.id,$$("table").add(t),e||($$("editTableFormProperty").clear(),F(),$$("table-newAddBtnId").enable(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh()),"i"==n.err_type?(window.innerWidth<1200&&$$("tableEditPopup")&&$$("tableEditPopup").hide(),o("success","Данные успешно добавлены")):"e"==n.err_type&&o("error",n.error);else{let e=n.content.errors,t="";Object.values(e).forEach((function(i,n){t+=i+" (Поле: "+Object.keys(e)[n]+"); "})),o("error",t)}},error:function(e,t,i){l("003-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("003-001",e.status,e.statusText,e.responseURL)}))}}catch(e){s("003-000",e)}}function _(){try{m(),b("Запись будет удалена").then((function(){$$("table").remove($$("table").getSelectedId().id);let e=$$("editTableFormProperty").getValues();webix.ajax().del("/init/default/api/"+d+"/"+e.id+".json",e,{success:function(e,t,i){t=t.json(),F(),window.innerWidth<1200&&$$("tableEditPopup")&&$$("tableEditPopup").hide(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),"i"==t.err_type&&(window.innerWidth<1200&&$$("tableEditPopup")&&$$("tableEditPopup").hide(),o("success","Данные успешно удалены")),"e"==t.err_type&&o("error",t.error)},error:function(e,t,i){l("Ошибка удаления записи: ",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("Ошибка удаления записи: ",e.status,e.statusText,e.responseURL)}))}))}catch(e){s("Ошибка удаления записи: ",e)}}function T(e){try{let t=$$("table").getColumns();if(0==Object.keys($$(e).elements).length){let r=[];t.forEach(((t,i)=>{function n(){let e,i=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s");return"now"===t.default?e=new Date:Date.parse(new Date(t.default))&&t.default.length>10?e=i(new Date(t.default)):t.default.includes("make_guid")?e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})):"False"==t.default?e=2:"True"==t.default?e=1:"None"!==t.default&&(e=t.default),e}if("datetime"==t.type)r.push({id:t.id,format:webix.Date.dateToStr("%d.%m.%Y %H:%i:%s"),label:t.label,type:"date",unique:t.unique,notnull:t.notnull,length:t.length,value:n()});else if(t.type.includes("reference")){let e=t.type.slice(10);r.push({type:"combo",label:t.label,css:t.id+"_container",id:t.id,unique:t.unique,notnull:t.notnull,length:t.length,value:n(),options:h(e),template:function(e,t,i,n){let o=n.collection.getItem(e.value);return o?o.value:""}})}else t.type.includes("boolean")?r.push({type:"select",label:t.label,id:t.id,unique:t.unique,notnull:t.notnull,length:t.length,value:n(),options:[{id:1,value:"Да"},{id:2,value:"Нет"}]}):t.type.includes("integer")?r.push({type:"text",id:t.id,label:t.label,unique:t.unique,notnull:t.notnull,length:t.length,customType:"integer",value:n(),on:{onKeyPress:function(){$$(e).clearValidation()}},validate:function(e){return!isNaN(1*e)}}):r.push({id:t.id,label:t.label,type:"text",unique:t.unique,notnull:t.notnull,length:t.length,value:n()})})),"table-editForm"==e&&$$("table-delBtnId").enable(),$$("editTableFormProperty").define("elements",r);let a=$$("editTableFormProperty").config.elements;$$("propertyRefbtns")._cells.length||($$("propertyRefbtnsContainer")||$$("propertyRefbtns").addView({id:"propertyRefbtnsContainer",rows:[]}),a.forEach((function(e,t){"combo"==e.type?$$("propertyRefbtnsContainer").addView({view:"button",type:"icon",width:30,height:28,icon:"wxi-angle-right",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Перейти в родительскую таблицу")}},click:function(){function t(){$$("table").getColumns().forEach((function(t,r){if(t.id==e.id){let e=t.type.slice(10);try{$$("tree").getItem(e)?$$("tree").select(e):e&&async function(e){i.fields||await n("fields"),i.fields&&e&&(Backbone.history.navigate("tree/"+e,{trigger:!0}),window.location.reload())}(e),$$("tableEditPopup")&&$$("tableEditPopup").isVisible()&&$$("tableEditPopup").hide()}catch(e){console.log(e),o("error","Таблица не найдена"),$$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide()}}}))}$$("editTableFormProperty").config.dirty?w().then((function(e){0!==e&&(1==e||2==e&&$$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty&&($$("editTableFormProperty").getValues().id?v(!1,!0):x()),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),t())})):t()}}):$$("propertyRefbtnsContainer").addView({height:28,width:1})})))}else $$(e).clear(),$$(e).clearValidation(),"table-editForm"==e&&$$("table-delBtnId").enable()}catch(e){s("003-000",e)}}function F(){$$("table-saveNewBtn").isVisible()?$$("table-saveNewBtn").hide():$$("table-saveBtn").isVisible()&&$$("table-saveBtn").hide(),$$("table-delBtnId").disable(),$$("editTableFormProperty")&&$$("editTableFormProperty").isVisible()&&$$("editTableFormProperty").hide(),$$("EditEmptyTempalte")&&!$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").show(),$$("propertyRefbtnsContainer")&&$$("propertyRefbtns").removeView($$("propertyRefbtnsContainer"))}function B(e,t,i,n){let o,r;if(n.editor&&"combo"==n.editor?o=n.type.slice(10):n.view,n.id.includes("_filter")){let e=n.id.indexOf("_filter");r=n.id.slice(0,e)}else r=n.id;try{if(t=$$(r+"_filter_rows").getChildViews().length,"text"==i)return{view:"text",placeholder:"Введите текст",name:r+"_filter-child-"+e+"-"+t,id:r+"_filter-child-"+e+"-"+t,on:{onKeyPress:function(){$$("filterTableForm").clearValidation(),$$("btnFilterSubmit")&&!$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").enable()}}};if("combo"==i)return{view:"combo",name:r+"_filter-child-"+e+"-"+t,id:r+"_filter-child-"+e+"-"+t,placeholder:"Выберите вариант",options:{data:h(o)},on:{onItemClick:function(){$$("filterTableForm").clearValidation(),$$("btnFilterSubmit").enable()}}};if("boolean"==i)return{view:"combo",name:r+"_filter-child-"+e+"-"+t,id:r+"_filter-child-"+e+"-"+t,placeholder:"Выберите вариант",options:[{id:1,value:"Да"},{id:2,value:"Нет"}],on:{onItemClick:function(){$$("filterTableForm").clearValidation(),$$("btnFilterSubmit").enable()}}};if("datepicker"==i)return{view:"datepicker",name:r+"_filter-child-"+e+"-"+t,id:r+"_filter-child-"+e+"-"+t,format:"%d.%m.%Y %H:%i:%s",placeholder:"дд.мм.гг",timepicker:!0,on:{onItemClick:function(){$$("filterTableForm").clearValidation(),$$("btnFilterSubmit").enable()}}};if("integer"==i)return{view:"text",name:r+"_filter-child-"+e+"-"+t,id:r+"_filter-child-"+e+"-"+t,invalidMessage:"Поле поддерживает только числовой формат",placeholder:"Введите число",on:{onItemClick:function(){$$("filterTableForm").clearValidation(),$$("btnFilterSubmit").enable()}},validate:function(e){return!isNaN(1*e)}}}catch(e){console.log(e),s("012-000",e)}}function E(e,t){try{let i=$$(e);if(t.includes("eql"))return i.setValue("=");if(t.includes("notEqual"))return i.setValue("!=");if(t.includes("less"))return i.setValue("<");if(t.includes("more"))return i.setValue(">");if(t.includes("mrEqual"))return i.setValue(">=");if(t.includes("lsEqual"))i.setValue("<=");else if(t.includes("contains"))return i.setValue("⊆")}catch(e){console.log(e),s("012-000",e)}}function V(e){return webix.once((function(){"combo"==e?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"})):"text"==e?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"содержит",id:"operations_contains"})):"datepicker"==e?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"<",id:"operations_less"}),this.add({value:">",id:"operations_more"}),this.add({value:">=",id:"operations_mrEqual"}),this.add({value:"<=",id:"operations_lsEqual"})):"integer"==e&&(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"<",id:"operations_less"}),this.add({value:">",id:"operations_more"}),this.add({value:">=",id:"operations_mrEqual"}),this.add({value:"<=",id:"operations_lsEqual"}),this.add({value:"содержит",id:"operations_contains"}))}))}function P(e,t){return{id:e.id+"_filter_container-btns",css:{"margin-top":"27px!important"},hidden:!0,cols:[{view:"button",id:e.id+"_filter-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){E(e.id+"_filter-btnFilterOperations",t)},onAfterLoad:V(t)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns",value:"+",id:e.id+"_filter_condition",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[{value:"и",id:"add_and"},{value:"или",id:"add_or"}],on:{onMenuItemClick(t){A(t,e)}}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить ещё вариант поля")}}}]}}function A(e,t){let i=t.id,n=t.editor,r=$$(i+"_filter_rows").getChildViews().length;e.includes("and")?$$(i+"_filter_rows").addView({id:i+"_filter-container-child-"+r,padding:5,rows:[{id:"and_"+webix.uid(),template:"<div style='color:var(--primary)'>+ и</div>",height:30,borderless:!0},{id:webix.uid(),cols:[B("operAnd",r,n,t),{id:i+"_filter_container-btns"+r,cols:[{view:"button",id:i+"_filter-child-operAnd-"+r+"-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(e){E(i+"_filter-child-operAnd-"+r+"-btnFilterOperations",e)},onAfterLoad:V(n)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns webix_danger",id:i+"_filter-child-operAnd-"+r+"_remove",type:"icon",icon:"wxi-trash",inputHeight:38,width:40,click:function(){try{b("Поле фильтра будет удалено").then((function(){let e=$$(i+"_filter-child-operAnd-"+r+"_remove").getParentView().getParentView().getParentView();$$(i+"_filter_rows").removeView($$(e.config.id)),$$(i+"_filter_rows").refresh(),o("success","Поле удалено")}))}catch(e){o("error","Ошибка удаления поля")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить поле фильтра")}}}]}]}]},r):e.includes("or")&&$$(i+"_filter_rows").addView({id:i+"_filter-container-child-operOr-"+r,padding:5,rows:[{id:"or_"+webix.uid(),template:"<div style='color:var(--primary)'>+ или</div>",height:30,borderless:!0},{id:webix.uid(),cols:[B("operOr",r,n,t),{id:i+"_filter_container-btns"+r,cols:[{view:"button",id:i+"_filter-child-operOr-"+r+"-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(e){E(i+"_filter-child-operOr-"+r+"-btnFilterOperations",e)},onAfterLoad:V(n)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns webix_danger",id:i+"_filter-child-operOr-"+r+"_remove",type:"icon",icon:"wxi-trash",inputHeight:38,width:40,click:function(){try{b("Поле фильтра будет удалено").then((function(){let e=$$(i+"_filter-child-operOr-"+r+"_remove").getParentView().getParentView().getParentView();console.log(e),$$(i+"_filter_rows").removeView($$(e.config.id)),o("success","Поле удалено")}))}catch(e){o("error","Ошибка удаления поля")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить поле фильтра")}}}]}]}]},r)}function I(e,t=1){try{let i=$$("table").getColumns();if(0==Object.keys($$(e).elements).length){let n=[];i.forEach(((t,i)=>{if("datetime"==t.type)n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"datepicker",format:"%d.%m.%Y %H:%i:%s",id:t.id+"_filter",name:t.id+"_filter",hidden:!0,label:t.label,placeholder:"дд.мм.гг",timepicker:!0,labelPosition:"top",on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},P(t,"datepicker")]}]});else if(t.type.includes("reference")){let i=t.type.slice(10);n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id+"_filter",hidden:!0,name:t.id+"_filter",labelPosition:"top",options:{data:h(i)},on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},P(t,"combo")]}]})}else t.type.includes("boolean")?n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id+"_filter",hidden:!0,name:t.id+"_filter",labelPosition:"top",options:[{id:1,value:"Да"},{id:2,value:"Нет"}],on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},P(t,"combo")]}]}):t.type.includes("integer")?n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,css:"webix_inputs-show",cols:[{view:"text",name:t.id+"_filter",id:t.id+"_filter",css:{"padding-bottom":"5px!important"},placeholder:"Введите число",hidden:!0,label:t.label,labelPosition:"top",invalidMessage:"Поле поддерживает только числовой формат",on:{onKeyPress:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}},validate:function(e){return!isNaN(1*e)}},P(t,"integer")]}]}):n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,css:"webix_inputs-show",cols:[{view:"text",name:t.id+"_filter",id:t.id+"_filter",css:{"passing-bottom":"5px!important"},placeholder:"Введите текст",hidden:!0,label:t.label,labelPosition:"top",on:{onKeyPress:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},P(t,"text")]}]})}));let o={margin:8,id:"inputsFilter",css:"webix_inputs-table-filter",rows:n};return"table-editForm"==e&&$$("table-delBtnId").enable(),$$(e).addView(o,t)}$$(e).clear(),$$(e).clearValidation(),"table-editForm"==e&&$$("table-delBtnId").enable(),$$("inputsFilter").show()}catch(e){console.log(e),s("012-000",e)}}function C(e,t,i,n,r,a,l,c,d=!1){return{rows:[{view:"template",id:c,css:"webix_style-template-count webix_block-title",height:34,template:function(){return 0!==Object.keys($$(c).getValues()).length?"<div style='display:inline-block;font-size:15px!important;font-weight:600'>"+$$(c).getValues()+"</div>":"<div style='display:inline-block;font-size:13px!important;font-weight:600'>Имя не указано</div>"}},{css:"webix_filterBar",padding:17,height:80,margin:5,cols:[{view:"button",width:50,type:"icon",id:l,hidden:d,icon:"wxi-filter",css:"webix_btn-filter",disabled:!0,title:"текст",height:50,click:function(){!function(e,t){try{if(window.innerWidth>1200){let i;$$("filterTableForm").getValues()&&(i=$$("filterTableForm").getValues()),"filterTableBarContainer"!==$$("editFilterBarAdaptive").getParentView().config.id&&$$("filterTableBarContainer").addView($$("editFilterBarAdaptive")),$$("editFilterBarHeadline")&&$$("editFilterBarHeadline").hide(),$$("editFilterBarAdaptive").config.width=350,$$("editFilterBarAdaptive").resize(),$$(e).clearSelection();let n=document.querySelector(".webix_btn-filter");n.classList.contains("webix_primary")?($$("filterTableForm").hide(),$$("table-editForm").show(),n.classList.add("webix_secondary"),n.classList.remove("webix_primary"),$$(t).hide(),$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").hide(),$$("editTableBarContainer")&&!$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").show()):($$("filterTableForm").show(),$$("table-editForm").hide(),0!==$$("filterTableForm").getChildViews()&&I("filterTableForm",3),i&&($$("filterTableForm").setValues(i),i=null),n.classList.add("webix_primary"),n.classList.remove("webix_secondary"),$$(t).show(),$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide(),$$("filterTableBarContainer")&&!$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").show())}else{let e;$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide(),$$("tableFilterPopup")&&$$("tableFilterPopup").show(),$$("tableFilterPopupContainer")&&!$$("tableFilterPopupContainer").isVisible()&&$$("tableFilterPopupContainer").show(),$$("filterTableForm").getValues()&&(e=$$("filterTableForm").getValues()),$$("tableFilterPopupContainer")&&$$("tableFilterPopupContainer").addView($$("editFilterBarAdaptive")),$$("editFilterBarHeadline")&&!$$("editFilterBarHeadline").isVisible()&&$$("editFilterBarHeadline").show(),0!==$$("filterTableForm").getChildViews()&&I("filterTableForm",3),$$("filterTableForm").show(),e&&($$("filterTableForm").setValues(e),$$("filterTableForm").setDirty(),e=null);let t=window.innerWidth-200;$$("editFilterBarAdaptive").$width>200&&($$("editFilterBarAdaptive").config.width=t,$$("editFilterBarAdaptive").resize())}}catch(e){console.log(e),s("012-000",e)}}(a,i)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть фильтры")}}},{view:"button",maxWidth:200,value:"<span class='webix_icon wxi-pencil'></span><span style='padding-left: 4px'>Редактор таблицы</span>",id:i,hidden:!0,css:"webix_btn-edit",title:"текст",height:50,click:function(){!function(e){try{if(window.innerWidth>1200){let t=document.querySelector(".webix_btn-filter");$$("filterTableForm").hide(),$$("table-editForm").show(),t.classList.add("webix_secondary"),t.classList.remove("webix_primary"),$$(e).hide(),$$("editTableBarContainer")&&$$("editTableBarContainer").show(),$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").hide()}else{if($$("tableEditPopup")){$$("tableEditPopup").show();let e=.7*window.innerWidth;$$("editTableBarAdaptive").$width>200&&($$("editTableBarAdaptive").config.width=e,$$("editTableBarAdaptive").resize()),$$("tableEditPopupContainer").getChildViews().length?($$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable(),$$("editTableBarContainer")&&$$("editTableBarContainer").show()):($$("tableEditPopupContainer").addView($$("editTableBarAdaptive")),$$("editTableBarHeadline")&&!$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").show())}else{webix.ui({view:"popup",css:"webix_popup-table-container webix_popup-config",modal:!0,id:"tableEditPopup",escHide:!0,position:"center",body:{id:"tableEditPopupContainer",rows:[]}}).show(),$$("tableEditPopupContainer").addView($$("editTableBarAdaptive")),$$("editTableBarHeadline")&&!$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").show();let e=.7*window.innerWidth;$$("editTableBarAdaptive").$width>200&&($$("editTableBarAdaptive").config.width=e,$$("editTableBarAdaptive").resize())}$$("table-newAddBtnId")&&($$("table-saveNewBtn").isVisible()&&$$("table-newAddBtnId").isEnabled()?$$("table-newAddBtnId").disable():$$("table-newAddBtnId").enable())}}catch(e){console.log(e),s("012-000",e)}}(i)},on:{onAfterRender:function(){"table"!==a&&this.isVisible()&&this.hide(),this.getInputNode().setAttribute("title","Редактировать таблицу")}}},{},{view:"button",width:50,type:"icon",id:t,hidden:d,icon:"wxi-download",css:"webix_btn-download",title:"текст",height:50,click:function(){!function(e){webix.toExcel(e,{filename:"Table",filterHTML:!0,styles:!0}),o("success","Таблица сохранена")}(a)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Экспорт таблицы")}}}]},{cols:[{view:"template",id:n,css:"webix_style-template-count",height:30,template:function(){return 0!==Object.keys($$(n).getValues()).length?"<div style='color:#999898;'> Общее количество записей: "+$$(n).getValues()+" </div>":""}},{view:"template",id:r,css:"webix_style-template-count",height:30,template:function(){return 0!==Object.keys($$(r).getValues()).length?"<div style='color:#999898;'>Видимое количество записей: "+$$(r).getValues()+" </div>":""}}]}]}}function k(){let e;if($$("tree").getSelectedItem())e=$$("tree").getSelectedItem().id;else{let t=window.location.pathname,i=t.lastIndexOf("/");e=t.slice(i+1)}return e}function j(e,t,i=!1){return{view:"datatable",id:e,css:"webix_table-style webix_header_border webix_data_border",resizeColumn:!0,autoConfig:!0,editable:i,editaction:"dblclick",minHeight:350,datafetch:5,datathrottle:5e3,loadahead:100,footer:!0,minWidth:500,select:!0,minColumnWidth:200,on:t,onClick:{"wxi-trash":function(){try{b("Запись будет удалена").then((function(){let t=$$(e).getItem(id),i=k();webix.ajax().del("/init/default/api/"+i+"/"+t.id+".json",t,{success:function(){$$(e).remove($$(e).getSelectedId()),o("success","Данные успешно удалены")},error:function(e,t,i){l("012-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("012-000",e.status,e.statusText,e.responseURL)}))}))}catch(e){console.log(e),s("012-000",e)}},"wxi-angle-down":function(e,t,i){try{if($$("propTableView").isVisible())$$("propTableView").hide(),$$("propResize").hide();else{let e,i=t.row;$$("table-view").getColumns().forEach((function(n,o){if(n.id==t.column){e=n.src;let t=e.search("{");e=e.slice(0,t)+i+".json"}})),webix.ajax(e,{success:function(e,t,i){try{t=t.json().content;let e=[];t.forEach((function(t,i){e.push({type:"text",id:i+1,label:t.name,value:t.value})})),$$("propTableView").define("elements",e),$$("propTableView").show(),$$("propTableView").config.width<200&&($$("propTableView").config.width=200,$$("propTableView").resize()),$$("propResize").show()}catch(e){console.log(e),s("012-000",e)}},error:function(e,t,i){l("012-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("012-000",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),s("012-000",e)}}}}}function S(){$$("table-findElements").setValues($$("table").count().toString())}let L,R={onBeforeLoad:function(){this.showOverlay("Загрузка...")},onBeforeEditStop:function(e,t,i){try{if(e.value!=e.old){let i=t.row,n=t.column,o=e.value;$$("table").updateItem(i,{[n]:o}),$$("editTableFormProperty").setValues($$("table").getSelectedItem()),v()}}catch(e){console.log(e),s("012-011",e)}},onAfterSelect(e){function t(){$$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide()}function i(){try{$$("tableEditPopupContainer").addView($$("editTableBarAdaptive")),$$("editTableBarHeadline")&&!$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").show()}catch(e){o("error","table initPopup: "+e)}}try{$$("table-editTableBtnId").isVisible()&&window.innerWidth>1200&&$$("table-editTableBtnId").hide(),function(){try{$$("editTableBarContainer")&&!$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").show(),$$("table-newAddBtnId")&&$$("table-newAddBtnId").enable(),t(),$$("table-editForm").isVisible()||($$("table-editForm").show(),function(){try{$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").hide(),$$("filterTableForm")&&$$("filterTableForm").isVisible()&&$$("filterTableForm").hide();let e=document.querySelector(".webix_btn-filter");e.classList.add("webix_secondary"),e.classList.remove("webix_primary")}catch(e){o("error","table filterTableHide: "+e)}}())}catch(e){o("error","table statePutEditForm: "+e)}}(),function(){try{window.innerWidth<1200&&($$("tableEditPopup")?($$("tableEditPopup").show(),$$("tableEditPopupContainer").getChildViews().length||i()):(webix.ui({view:"popup",css:"webix_popup-table-container webix_popup-config",modal:!0,id:"tableEditPopup",escHide:!0,position:"center",body:{id:"tableEditPopupContainer",rows:[]}}).show(),i()),t())}catch(e){o("error","table adaptiveEditFormPopup: "+e)}}()}catch(e){console.log(e),o("error","table onAfterSelect: "+e)}},onBeforeSelect:function(e,t){let i=$$("editTableFormProperty").getValues(),n=k();function r(){let t=$$("table").getItem(e.id);try{$$("editTableFormProperty")&&!$$("editTableFormProperty").isVisible()&&$$("editTableFormProperty").show(),$$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),$$("editTableFormProperty").setValues(t),$$("table-saveNewBtn").hide(),$$("table-saveBtn").show(),$$("table-delBtnId").enable()}catch(e){console.log(e),o("error","toEditForm: "+e)}}function a(){$$("propertyRefbtnsContainer")&&$$("propertyRefbtns").removeView($$("propertyRefbtnsContainer"))}function s(){g().forEach((function(e,t){let i;$$("table").getColumns().forEach((function(t,n){t.id==e.nameCol&&(i=t.label)})),o("error",e.textError+" (Поле: "+i+")")}))}!function(){if($$("editTableFormProperty").config.dirty)return w().then((function(t){1==t?(r(),$$("table").select(e.id),a()):2==t&&($$("editTableFormProperty").getValues().id?g().length?s():i.id&&webix.ajax().put("/init/default/api/"+n+"/"+i.id,function(e){let t={};return Object.values(e).forEach((function(i,n){0!==i.length&&(t[Object.keys(e)[n]]=i)})),t}(i),{success:function(t,n,s){n=n.json(),$$("table").updateItem(i.id,i),r(),$$("table").select(e.id),a(),"i"==n.err_type&&o("success","Данные сохранены"),"e"==n.err_type&&o("error",n.error)},error:function(e,t,i){o("error","table function putData: "+i.status+" "+i.statusText+" "+i.responseURL)}}).catch((e=>{console.log(e),o("error","table function putData ajax: "+e.status+" "+e.statusText+" "+e.responseURL)})):g().length?s():webix.ajax().post("/init/default/api/"+n,i,{success:function(t,n,s){if(null!==(n=n.json()).content.id)i.id=n.content.id,$$("table").add(i),r(),$$("table").select(e.id),a(),o("success","Данные успешно добавлены");else{let e=n.content.errors,t="";Object.values(e).forEach((function(i,n){t+=i+" (Поле: "+Object.keys(e)[n]+"); "})),o("error",t)}},error:function(e,t,i){o("error","table modalBox (post new data): "+i.status+" "+i.statusText+" "+i.responseURL)}}))})),!1;T("table-editForm"),r()}()},onAfterLoad:function(){try{this.hideOverlay(),this.count()||this.showOverlay("Ничего не найдено"),F()}catch(e){console.log(e),s("012-000",e)}},onAfterDelete:function(){try{S(),function(){let e;$$("table").isVisible()?e="table":$$("table-view").isVisible()&&(e="table-view"),$$(e).count()||$$(e).showOverlay("Ничего не найдено"),$$(e).count()&&$$(e).hideOverlay()}()}catch(e){console.log(e),o("error","table onAfterDelete: "+e)}},onAfterAdd:function(){try{S(),this.hideOverlay()}catch(e){console.log(e),o("error","table onAfterAdd: "+e)}},onAfterRender:function(){!function(){try{window.innerWidth<1200&&$$("table-editTableBtnId")&&!$$("table-editTableBtnId").isVisible()&&$$("table-editTableBtnId").show()}catch(e){o("error","table adaptiveBtnEditTable: "+e)}}()}};try{L={view:"form",id:"cp-form",borderless:!0,margin:5,elements:[{template:"<div>Изменение пароля</div>",css:"webix_cp-form",height:35,borderless:!0},{view:"template",id:"authName",css:"webix_userprefs-info",template:function(){return 0!==Object.keys($$("authName").getValues()).length?"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600' >"+$$("authName").getValues()+"<div>":"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀ <div style='display:inline-block;font-size:13px!important;font-weight:600'>не указано</div>"},height:50,borderless:!0},{view:"text",width:300,labelPosition:"top",type:"password",label:"Старый пароль",name:"oldPass"},{view:"text",width:300,labelPosition:"top",type:"password",label:"Новый пароль",name:"newPass"},{view:"text",width:300,labelPosition:"top",type:"password",label:"Повтор нового пароля",name:"repeatPass"},{margin:5,cols:[{view:"button",height:48,width:300,value:"Сменить пароль",css:"webix_primary",click:function(){try{if($$("cp-form").validate()){let e={op:"",np:""},t=$$("cp-form").getValues();e.np=t.newPass,e.op=t.oldPass,webix.ajax().post("/init/default/api/cp",e,{success:function(e,t,i){"i"==(t=t.json()).err_type?o("success",t.err):"e"==t.err_type&&o("error",t.err),$$("cp-form").setDirty(!1)},error:function(e,t,i){l("011-000",i.status,i.statusText,i.responseURL)}})}}catch(e){console.log(e),s("011-000",e)}}}]}],rules:{$all:webix.rules.isNotEmpty,$obj:function(e){return e.newPass!=e.repeatPass?(o("error","Новый пароль не совпадает с повтором"),!1):e.newPass!=e.oldPass||!$$("cp-form").isDirty()||(o("error","Новый пароль должен отличаться от старого"),!1)}}}}catch(e){console.log(e),s("011-000",e)}const O={id:"layout-cp",cols:[L,{}]};let N={userprefsOther:{},userprefsWorkspace:{}};function H(){const e=$$("userprefsTabbar").getValue()+"Form";if($$(e).isDirty())try{webix.ajax().get("/init/default/api/userprefs/",{success:function(i,n,r){"e"==(n=n.json().content).err_type&&o("error",n.error);let a=!1;const c=$$(e).getValues();let d={name:e,prefs:c};try{n.forEach((function(i,n){i.name==e&&(a=!0,webix.ajax().put("/init/default/api/userprefs/"+i.id,d,{success:function(i,n,r){"i"==(n=n.json()).err_type&&(t(e,JSON.stringify($$(e).getValues())),o("success","Настройки сохранены")),"e"==n.err_type&&o("error",n.error),N[$$("userprefsTabbar").getValue()]=c,$$(e).setDirty(!1)},error:function(e,t,i){l("015-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("015-011",e.status,e.statusText,e.responseURL)})))}))}catch(e){console.log(e),s("015-000",e)}try{if(!a){let i=webix.storage.local.get("user").id;i?d.owner=i:webix.ajax("/init/default/api/whoami",{success:function(e,i,n){d.owner=i.json().content.id;let o={};o.id=i.json().content.id,o.name=i.json().content.first_name,o.username=i.json().content.username,t("user",JSON.stringify(o))},error:function(e,t,i){l("005-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("005-000",e.status,e.statusText,e.responseURL)})),webix.ajax().post("/init/default/api/userprefs/",d,{success:function(t,i,n){"i"==(i=i.json()).err_type?o("success","Настройки сохранены"):"e"==i.err_type&&o("error",i.error),N[$$("userprefsTabbar").getValue()]=c,$$(e).setDirty(!1)},error:function(e,t,i){l("015-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("015-001",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),s("015-000",e)}},error:function(e,t,i){l("015-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("015-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),s("015-000",e)}else o("debug","Сохранять нечего")}const U={rows:[{padding:{top:15,bottom:0,left:20,right:0},rows:[{view:"template",template:"<div>Настройки</div>",css:"webix_headline-userprefs",height:35,borderless:!0},{view:"template",id:"userprefsName",css:"webix_userprefs-info",template:function(){return 0!==Object.keys($$("userprefsName").getValues()).length?"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600' >"+$$("userprefsName").getValues()+"<div>":"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div><div style='display:inline-block;font-size:13px!important;font-weight:600'>не указано</div>"},height:50,borderless:!0}]},{rows:[{view:"tabbar",type:"top",id:"userprefsTabbar",css:"webix_filter-popup-tabbar",multiview:!0,options:[{value:"<span class='webix_tabbar-filter-headline'>Рабочее пространство</span>",id:"userprefsWorkspace"},{value:"<span class=webix_tabbar-filter-headline'>Другое</span>",id:"userprefsOther"}],height:50,on:{onBeforeTabClick:function(e){const t=$$("userprefsTabbar").getValue()+"Form";try{if($$(t).isDirty())return webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"}).then((function(i){if(1==i){let i=webix.storage.local.get(t);$$(t).setValues(i),$$("userprefsTabbar").setValue(e),$$("userprefsSaveBtn").isEnabled()&&$$("userprefsSaveBtn").disable(),$$("userprefsResetBtn").isEnabled()&&$$("userprefsResetBtn").disable()}else 2==i&&(H(),$$("userprefsTabbar").setValue(e))})),!1}catch(e){console.log(e),s("005-000",e)}}}},{cells:[{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsWorkspace",scroll:"y",body:{view:"form",id:"userprefsWorkspaceForm",borderless:!0,elements:[{cols:[{rows:[{view:"radio",labelPosition:"top",name:"logBlockOpt",label:"Отображение блока системных сообщений",value:1,options:[{id:1,value:"Показать"},{id:2,value:"Скрыть"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть по умолчанию блок системных сообщений")},onChange:function(e,t,i){try{e!==t&&(1==e?$$("webix_log-btn").setValue(2):$$("webix_log-btn").setValue(1))}catch(e){console.log(e),s("015-000",e)}}}},{height:15},{cols:[{view:"select",name:"LoginActionOpt",label:"Действие после входа в систему",labelPosition:"top",value:2,options:[{id:1,value:"Перейти на главную страницу"},{id:2,value:"Перейти на последнюю открытую страницу"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показывать/не показывать всплывающее окно при загрузке приложения")}}},{}]}]}]}],on:{onChange:function(){this.isDirty()&&!$$("userprefsSaveBtn").isEnabled()?$$("userprefsSaveBtn").enable():this.isDirty()||$$("userprefsSaveBtn").disable(),this.isDirty()&&!$$("userprefsResetBtn").isEnabled()?$$("userprefsResetBtn").enable():this.isDirty()||$$("userprefsResetBtn").disable()}}}},{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsOther",scroll:"y",body:{view:"form",id:"userprefsOtherForm",borderless:!0,elements:[{view:"radio",labelPosition:"top",label:"Автообновление специфичных страниц",value:1,name:"autorefOpt",options:[{id:1,value:"Включено"},{id:2,value:"Выключено"}],on:{onChange:function(e,t,i){try{1!=e||$$("userprefsAutorefCounter").isVisible()||$$("userprefsAutorefCounter").show(),2==e&&$$("userprefsAutorefCounter").isVisible()&&$$("userprefsAutorefCounter").hide()}catch(e){console.log(e),s("015-000",e)}}}},{height:5},{view:"counter",id:"userprefsAutorefCounter",labelPosition:"top",name:"autorefCounterOpt",label:"Интервал автообновления (в миллисекундах)",min:15e3,max:9e5,on:{onChange:function(e,t,i){try{const t=$$("userprefsAutorefCounter").config.min,i=$$("userprefsAutorefCounter").config.max;e==t?webix.message({type:"debug",expire:1e3,text:"Минимальное возможное значение"}):e==i&&webix.message({type:"debug",expire:1e3,text:"Максимальное возможное значение"})}catch(e){console.log(e),s("015-000",e)}}}},{}],on:{onChange:function(){this.isDirty()&&!$$("userprefsSaveBtn").isEnabled()?$$("userprefsSaveBtn").enable():this.isDirty()||$$("userprefsSaveBtn").disable(),this.isDirty()&&!$$("userprefsResetBtn").isEnabled()?$$("userprefsResetBtn").enable():this.isDirty()||$$("userprefsResetBtn").disable()}}}}]},{id:"a1",rows:[{responsive:"a1",cols:[{view:"button",height:48,minWidth:200,value:"Сбросить",id:"userprefsResetBtn",disabled:!0},{view:"button",value:"Сохранить настройки",height:48,minWidth:200,id:"userprefsSaveBtn",css:"webix_primary",disabled:!0,click:H}]}]}]}]};function W(){function e(e,t,i){let n=document.querySelectorAll(".webix_filter-inputs");if(e)n.forEach((function(e,i){e.classList.contains(t)?(e.classList.contains("webix_show-content")||e.classList.add("webix_show-content"),e.classList.contains("webix_hide-content")&&e.classList.remove("webix_hide-content")):e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content")})),$$(i).show(),$$(i+"_container-btns")&&!$$(i+"_container-btns").isVisible()&&$$(i+"_container-btns").show(),$$("resetFilterBtn").enable(),$$("filterLibrarySaveBtn").isEnabled()||$$("filterLibrarySaveBtn").enable(),$$("filterEmptyTempalte").isVisible()&&($$("filterEmptyTempalte").hide(),$$("filterEmptyTempalte").refresh());else if($$(i).isVisible()&&(n.forEach((function(e,i){e.classList.contains(t)&&(e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content"),e.classList.contains("webix_show-content")&&e.classList.remove("webix_show-content"))})),$$(i).hide()),$$(i+"_container-btns")&&$$(i+"_container-btns").isVisible()&&$$(i+"_container-btns").hide(),$$(i+"_rows")){let e=$$(i+"_rows").getChildViews();Object.values(e).forEach((function(e,t){e.config.id.includes("child")&&$$(i+"_rows").removeView($$(e.config.id))}))}}try{let t=$$("filterPopupTabbar").getValue();if("editFormPopupLib"==t){let t=$$("filterEditLib").getOption($$("filterEditLib").getValue());webix.ajax().get("/init/default/api/userprefs/",{success:function(i,n,r){(n=n.json().content).forEach((function(i,n){if(i.name==$$("tree").getSelectedId()+"_filter-template_"+t.value){let t=JSON.parse(i.prefs);t.collection.content.forEach((function(t,i){if("parent"==t.condition){let i=t.parentField.id.indexOf("_filter"),n=t.parentField.id.slice(0,i),o=t.parentField.id.indexOf("_rows"),r=t.parentField.id.slice(0,o);e($$(t.parentField.id),n,r),$$(t.parentValue.id).setValue(t.parentValue.value),$$(t.parentField.id)._cells.forEach((function(e,i){e.config.id.includes("child")&&$$(t.parentField.id).removeView($$(e.config.id))}))}$$("table").getColumns().forEach((function(e,i){t.parentField.id.includes(e.id)&&("and"==t.condition?(A("and",e),$$(t.childValue.id).setValue(t.childValue.value)):"or"==t.condition&&(A("or",e),$$(t.childValue.id).setValue(t.childValue.value)))}))})),$$("filterTableForm").setValues(t.values)}$$("popupFilterEdit")&&$$("popupFilterEdit").destructor(),$$("btnFilterSubmit").isEnabled()||$$("btnFilterSubmit").enable()})),"e"==n.err_type?o("error",n.error):o("success","Рабочая область фильтра обновлена")},error:function(e,t,i){l("004-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("004-001",e.status,e.statusText,e.responseURL)}))}else if("editFormScroll"==t){$$("filterLibrarySaveBtn")&&!$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").enable();let t,i,n=$$("editFormPopup").getValues();Object.keys(n).forEach((function(o,r){i=o.lastIndexOf("_"),t=o.slice(0,i),e(n[o],t,o)}));let r=0;Object.values($$("filterTableForm").elements).forEach((function(e,t){e.config.hidden||r++})),r||$$("filterEmptyTempalte").isVisible()||($$("filterEmptyTempalte").show(),$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").disable(),$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").disable()),$$("popupFilterEdit").destructor(),o("success","Рабочая область фильтра обновлена")}}catch(e){$$("popupFilterEdit").destructor(),o("error","Ошибка при обновлении фильтров")}}let z;function D(){if(webix.ajax().get("/init/default/api/userprefs/").then((function(e){let i=e.json().content;try{let e=webix.storage.local.get("user");if(e||webix.ajax("/init/default/api/whoami",{success:function(i,n,o){let r={};r.id=n.json().content.id,r.name=n.json().content.first_name,r.username=n.json().content.username,t("user",JSON.stringify(r)),e=webix.storage.local.get("user")},error:function(e,t,i){l("008-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("008-000",e.status,e.statusText,e.responseURL)})),e){i.forEach((function(t,i){if(t.name.includes("filter-template_")&&t.owner==e.id){let e=JSON.parse(t.prefs);e.table==$$("tree").getSelectedId()&&$$("filterEditLib").addOption({id:i+1,value:e.name})}})),$$("filterEditLib")&&0==$$("filterEditLib").data.options.length&&$$("filterEditLib").addOption({id:"radioNoneContent",disabled:!0,value:"Сохранённых шаблонов нет"});let t=0;Object.values($$("filterTableForm").elements).forEach((function(e,i){e.config.hidden||t++})),t?$$("popupFilterClearBtn").isEnabled()||$$("popupFilterClearBtn").enable():$$("filterEmptyTempalte").isVisible()||$$("popupFilterClearBtn").isEnabled()&&$$("popupFilterClearBtn").disable()}}catch(e){console.log(e),s("004-000",e)}})),webix.ui({view:"popup",id:"popupFilterEdit",css:"webix_popup-filter-container webix_popup-config",modal:!0,escHide:!0,position:"center",height:400,width:400,body:{scroll:"y",rows:[{css:"webix_filter-headline-wrapper",cols:[{template:"Редактор фильтров",css:"webix_template-recover",borderless:!0,height:40},{width:150},{view:"button",id:"buttonClosePopup",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("popupFilterEdit")&&$$("popupFilterEdit").destructor()}}]},{template:"Выберите нужные поля или шаблон из библиотеки",borderless:!0,height:47},{view:"form",id:"editFormPopup",css:"webix_edit-form-popup",borderless:!0,elements:[{rows:[{view:"tabbar",type:"top",id:"filterPopupTabbar",css:"webix_filter-popup-tabbar",multiview:!0,options:[{value:"<span class='webix_tabbar-filter-headline'>Поля</span>",id:"editFormScroll"},{value:"<span class=webix_tabbar-filter-headline'>Библиотека</span>",id:"editFormPopupLib"}],height:50,on:{onAfterTabClick:function(e){!function(e){function t(e){try{"enable"==e?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():"disable"==e&&$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable()}catch(e){console.log(e),s("004-000",e)}}try{if("editFormPopupLib"==e&&($$("popupFilterClearBtn").isVisible()&&$$("popupFilterClearBtn").hide(),""!==$$("filterEditLib").getValue()?t("enable"):t("disable"),$$("editFormPopupLibRemoveBtn").isVisible()||$$("editFormPopupLibRemoveBtn").show()),"editFormScroll"==e){$$("popupFilterClearBtn").isVisible()||$$("popupFilterClearBtn").show();let e=$$("editFormPopup").getValues(),i=0;Object.values(e).forEach((function(e,t){e&&i++})),t(i>0?"enable":"disable"),$$("editFormPopupLibRemoveBtn").isVisible()&&$$("editFormPopupLibRemoveBtn").hide()}}catch(e){console.log(e),s("004-000",e)}}(e)}}},{height:200,cells:[{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"editFormScroll",scroll:"y",body:{id:"editFormPopupScroll",rows:[]}},{view:"form",scroll:!0,id:"editFormPopupLib",css:"webix_multivew-cell",borderless:!0,elements:[{view:"radio",id:"filterEditLib",vertical:!0,options:[],on:{onChange:function(){this.getValue()?(z=this.getValue(),$$("editFormPopupLibRemoveBtn").isEnabled()||$$("editFormPopupLibRemoveBtn").enable(),$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable()):$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable()}}}]}]},{height:20},{cols:[{view:"button",id:"popupFilterSubmitBtn",height:48,minWidth:140,disabled:!0,css:"webix_primary",hotkey:"Enter",value:"Применить",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбранные фильтры будут добавлены в рабочее поле, остальные скрыты")}},click:W},{width:5},{view:"button",id:"popupFilterClearBtn",width:110,height:48,css:"webix_secondary",disabled:!0,value:"Сбросить",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Все фильтры будут очищены и удалены")}},click:Y},{view:"button",css:"webix_danger",id:"editFormPopupLibRemoveBtn",type:"icon",icon:"wxi-trash",hidden:!0,disabled:!0,width:50,click:function(){w("Шаблон будет удалён","Вы уверены, что хотите продолжить?",["Отмена","Удалить"]).then((function(e){if(0==e);else if(1==e){let e=$$("filterEditLib").getOption($$("filterEditLib").getValue());webix.ajax().get("/init/default/api/userprefs/",{success:function(t,i,n){(i=i.json().content).forEach((function(t,i){t.name==$$("tree").getSelectedId()+"_filter-template_"+e.value&&webix.ajax().del("/init/default/api/userprefs/"+t.id,t).then((function(t){"e"!==t.json().err_type&&"x"!==t.json().err_type?(o("success","Шаблон « "+e.value+" » удален"),$$("filterEditLib").config.options.forEach((function(t,i){t.id==e.id&&(t.value=e.value+" (шаблон удалён)",$$("filterEditLib").refresh(),$$("filterEditLib").disableOption($$("filterEditLib").getValue()),$$("filterEditLib").setValue(""))}))):s("004-002",t.json().err,!0)})).fail((function(e){console.log(e),l("004-002",e.status,e.statusText,e.responseURL)}))}))},error:function(e,t,i){s("004-000",t.json().err,!0)}})}}))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбранный шаблон будет удален")}}}]}]},{}]}]}}).show(),$$("filterEditLib")&&$$("filterEditLib").setValue(z),window.innerWidth<1200){let e=window.innerWidth-500;$$("popupFilterEdit").$width>200&&($$("popupFilterEdit").config.width=e,$$("popupFilterEdit").resize())}let e=[{cols:[{id:"editFormPopupScrollContent",css:"webix_edit-form-popup-scroll-content",rows:[{view:"checkbox",id:"selectAll",labelRight:"<div style='font-weight:600'>Выбрать всё</div>",labelWidth:0,name:"selectAll",on:{onChange:function(){try{this.getValue()?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable(),$$("editFormPopupScrollContent").getChildViews().forEach((function(e,t){e.config.id.includes("checkbox")&&($$("selectAll").getValue()?e.config.value=1:e.config.value=0,$$(e).refresh())}))}catch(e){console.log(e),s("004-000",e)}}}}]}]}],i=[],n=$$("filterTableForm").elements;try{Object.values(n).forEach((function(e,t){i.push({id:e.config.id,label:e.config.label})}))}catch(e){console.log(e),s("004-000",e)}function r(e){try{let t=$$(e.id+"_checkbox").getParentView().getChildViews(),i=0,n=0;t.forEach((function(e,t){e.config.id.includes("checkbox")&&(e.config.value&&""!=e.config.value||i++),e.config.value&&n++})),n>0?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable(),0==i?($$("selectAll").config.value=1,$$("selectAll").refresh()):0!==$$("selectAll").config.value&&($$("selectAll").config.value=0,$$("selectAll").refresh())}catch(e){console.log(e),s("004-000",e)}}try{i.forEach((function(t,i){t.id.includes("child")||($$(t.id)&&$$(t.id).isVisible()?e[0].cols[0].rows.push({view:"checkbox",id:t.id+"_checkbox",labelRight:t.label,labelWidth:0,name:t.id,value:1,on:{onChange:function(){r(t)}}}):e[0].cols[0].rows.push({view:"checkbox",id:t.id+"_checkbox",labelRight:t.label,labelWidth:0,name:t.id,on:{onChange:function(){r(t)}}}))})),$$("editFormPopupScroll").addView({rows:e},1)}catch(e){console.log(e),s("004-000",e)}let a=0,c=$$("editFormPopupScrollContent").getChildViews();try{c.forEach((function(e,t){e.config.id.includes("checkbox")&&(e.config.value&&""!=e.config.value||a++)})),0==a&&($$("selectAll").config.value=1,$$("selectAll").refresh())}catch(e){console.log(e),s("004-000",e)}}function M(){try{let e;if($$("tree").getSelectedItem())e=$$("tree").getSelectedItem().id;else{let t=window.location.pathname,i=t.lastIndexOf("/");e=t.slice(i+1)}webix.ajax("/init/default/api/smarts?query="+e+".id >= 0&sorts="+e+".id&offset=0",{success:function(e,t,i){0!==(t=t.json().content).length?($$("table").hideOverlay("Ничего не найдено"),$$("table").clearAll(),$$("table").parse(t)):($$("table").clearAll(),$$("table").showOverlay("Ничего не найдено"));let n=$$("table").count();$$("table-idFilterElements").setValues(n.toString()),$$("tableFilterPopup")&&$$("tableFilterPopup").isVisible()&&$$("tableFilterPopup").hide(),document.querySelectorAll(".webix_filter-inputs").forEach((function(e,t){e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content")}));let r=[];$$("inputsFilter").getChildViews().forEach((function(e,t){let i=e._collection[0].cols[0].id;$$(i).hide(),$$(e.config.id).getChildViews().forEach((function(e,t){e.config.id.includes("child")&&r.push(e.config.id)})),$$(i+"_container-btns")&&$$(i+"_container-btns").isVisible()&&$$(i+"_container-btns").hide()})),r.forEach((function(e,t){$$(e).getParentView().removeView($$(e))})),$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").disable(),$$("filterEmptyTempalte").isVisible()||($$("filterEmptyTempalte").show(),$$("filterEmptyTempalte").refresh()),$$("resetFilterBtn").disable(),o("success","Фильтры очищены")},error:function(e,t,i){l("004-000",i.status,i.statusText,i.responseURL),o("error","Ошибка очистки фильтров")}}).catch((e=>{console.log(e),l("004-000",e.status,e.statusText,e.responseURL)}))}catch(e){o("error","Ошибка при очищении фильтров")}}function q(){let e=$$("filterTableForm").getValues(),t=[];function i(e,i,n,o,r,a=!1){let l;if($$("tree").getSelectedItem())l=$$("tree").getSelectedItem().id;else{let e=window.location.pathname,t=e.lastIndexOf("/");l=e.slice(t+1)}let c=$$(n+"-btnFilterOperations").config.value;try{"parent"==r?a?"="==c?t.push("+and+"+l+"."+i+"+=+"+e):"!="==c?t.push("+and+"+l+"."+i+"+!=+"+e):"<"==c?t.push("+and+"+l+"."+i+"+<+"+e):">"==c?t.push("+and+"+l+"."+i+"+>+"+e):"<="==c?t.push("+and+"+l+"."+i+"+<=+"+e):">="==c?t.push("+and+"+l+"."+i+"+>=+"+e):"⊆"==c&&t.push("+and+"+l+"."+i+"+contains+"+e):"="==c?t.push(l+"."+i+"+=+"+e):"!="==c?t.push(l+"."+i+"+!=+"+e):"<"==c?t.push(l+"."+i+"+<+"+e):">"==c?t.push(l+"."+i+"+>+"+e):"<="==c?t.push(l+"."+i+"+<=+"+e):">="==c?t.push(l+"."+i+"+>=+"+e):"⊆"==c&&t.push(l+"."+i+"+contains+"+e):"child"==r&&("="==c?t.push("+"+o+"+"+i+"+=+"+e):"!="==c?t.push("+"+o+"+"+i+"+!=+"+e):"<"==c?t.push("+"+o+"+"+i+"+<+"+e):">"==c?t.push("+"+o+"+"+i+"+>+"+e):">="==c?t.push("+"+o+"+"+i+"+>=+"+e):"<="==c?t.push("+"+o+"+"+i+"+<=+"+e):"⊆"==c&&t.push("+"+o+"+"+i+"+contains+"+e))}catch(e){console.log(e),s("004-000",e)}}if($$("filterTableForm").validate()){let n,r,a=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s"),c=0;try{Object.keys(e).sort().forEach((function(t,o){n=t,r=e[t],r&&("datepicker"==$$(t).config.view&&(r=a(e[t])),$$(t).config.text&&"Нет"==$$(t).config.text&&(r=0),t.includes("filter")&&!t.includes("condition")&&(n=t.lastIndexOf("_"),n=t.slice(0,n)),t.includes("condition")||t.includes("child")||""===e[t]||"selectAll"===t||!$$(t).isVisible()?t.includes("child")&&(t.includes("operAnd")?i(r,n,t,"and","child"):t.includes("operOr")&&i(r,n,t,"or","child")):(c>0?i(r,n,t,"and","parent",!0):i(r,n,t,"and","parent"),c++))}))}catch(e){console.log(e),s("004-000",e)}webix.ajax("/init/default/api/smarts?query="+t.join(""),{success:function(e,t,i){let n=t.json().err_type,r=t.json().err;0!==(t=t.json().content).length?($$("table").hideOverlay("Ничего не найдено"),$$("table").clearAll(),$$("table").parse(t)):($$("table").clearAll(),$$("table").showOverlay("Ничего не найдено"));let a=$$("table").count();$$("table-idFilterElements").setValues(a.toString()),"i"==n?(o("success","Фильтры успшено применены"),$$("tableFilterPopup")&&$$("tableFilterPopup").isVisible()&&$$("tableFilterPopup").hide()):"e"==n?o("error",r):"x"==n&&o("error","Ошибка фильтрации данных")},error:function(e,t,i){l("003-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("003-011",e.status,e.statusText,e.responseURL)}))}else o("error","Не все поля формы заполнены")}function J(){try{webix.prompt({title:"Название шаблона",ok:"Сохранить",cancel:"Отменить",css:"webix_prompt-filter-lib",input:{required:!0,placeholder:"Введите название шаблона..."},width:350}).then((function(e){webix.ajax().get("/init/default/api/userprefs/",{success:function(i,n,r){"e"==(n=n.json().content).err_type&&o("error",n.error);let a=e,c={content:[]};$$("inputsFilter")._collection.forEach((function(e,t){let i=e.id.lastIndexOf("_rows"),n=e.id.slice(0,i);$$(n).isVisible()&&$$(e.id).getChildViews().forEach((function(t,i){if(t.config.id.includes("child")){let i=$$(t.config.id)._collection[0].id,n=e.id.lastIndexOf("_rows"),o=e.id.slice(0,n),r=$$(t.config.id).getChildViews()[1]._collection[0].id;i.includes("and")?c.content.push({condition:"and",parentField:$$(o).config,childValue:{id:r+"-btnFilterOperations",value:$$(r+"-btnFilterOperations").getValue()}}):i.includes("or")&&c.content.push({condition:"or",parentField:$$(o).config,childValue:{id:r+"-btnFilterOperations",value:$$(r+"-btnFilterOperations").getValue()}})}else c.content.push({condition:"parent",parentField:$$(e.id).config,parentValue:{id:n+"-btnFilterOperations",value:$$(n+"-btnFilterOperations").getValue()}})}))}));let d={name:a,collection:c,values:$$("filterTableForm").getValues(),table:$$("tree").getSelectedId()},u=!1,h={name:$$("tree").getSelectedId()+"_filter-template_"+a,prefs:d};try{n.forEach((function(e,t){e.name==$$("tree").getSelectedId()+"_filter-template_"+a&&(u=!0,w("Шаблон с таким именем существует","После сохранения предыдущие данные будут стёрты",["Отмена","Сохранить изменения"]).then((function(t){0==t||1==t&&webix.ajax().put("/init/default/api/userprefs/"+e.id,h,{success:function(e,t,i){"i"==(t=t.json()).err_type&&o("success","Шаблон «"+a+"»  сохранён в библиотеку"),"e"==t.err_type&&o("error",t.error)},error:function(e,t,i){l("004-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("004-011",e.status,e.statusText,e.responseURL)}))})))}))}catch(e){console.log(e),s("004-000",e)}try{if(!u){let e=webix.storage.local.get("user").id;e?h.owner=e:webix.ajax("/init/default/api/whoami",{success:function(e,i,n){h.owner=i.json().content.id;let o={};o.id=i.json().content.id,o.name=i.json().content.first_name,o.username=i.json().content.username,t("user",JSON.stringify(o))},error:function(e,t,i){l("005-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("005-000",e.status,e.statusText,e.responseURL)})),webix.ajax().post("/init/default/api/userprefs/",h,{success:function(e,t,i){"i"==(t=t.json()).err_type?o("success","Шаблон «"+a+"»  сохранён в библиотеку"):"e"==t.err_type&&o("error",t.error)},error:function(e,t,i){l("004-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("004-001",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),s("004-000",e)}},error:function(e,t,i){l("004-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("004-000",e.status,e.statusText,e.responseURL)})),webix.message({type:"success",expire:1e3,text:"Шаблон «"+nameTemplate+"»  сохранён в библиотеку"})})).fail((function(){}))}catch(e){console.log(e),o("error","Не удалось сохранить шаблон"),s("004-001",e)}}function Y(){$$("popupFilterEdit").destructor(),M()}function K(t){try{t||($$("dashboards")||$$("container").addView({view:"layout",id:"dashboards",hidden:!0,scroll:"auto",rows:[{view:"scrollview",id:"dashScroll",body:{view:"flexlayout",id:"dashboardContainer",cols:[{id:"dashboardInfoContainer",minWidth:250,rows:[]},{view:"resizer"},e]}}]},3),$$("tables")||$$("container").addView({id:"tables",hidden:!0,view:"scrollview",body:{view:"flexlayout",cols:[{id:"tableContainer",rows:[C(0,"table-exportBtn","table-editTableBtnId","table-findElements","table-idFilterElements","table","table-filterId","table-templateHeadline"),{view:"resizer",class:"webix_resizers"},j("table",R,!0)]},{view:"resizer",class:"webix_resizers"},{id:"editTableBarContainer",rows:[{id:"editTableBarAdaptive",rows:[{id:"editTableBarHeadline",hidden:!0,cols:[{template:"Редактор записей",height:30,css:"table-edit-headline",borderless:!0},{view:"button",id:"buttonClosePopupTableEdit",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){function e(){$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh()}function t(){$$("table-saveNewBtn").hide(),$$("table-newAddBtnId").enable(),$$("editTableFormProperty").hide(),$$("EditEmptyTempalte").show(),$$("table-delBtnId").disable(),$$("table-saveBtn").hide()}function i(){$$("editTableFormProperty").clear(),$$("tableEditPopup")&&$$("tableEditPopup").hide()}$$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty?w().then((function(n){0==n?e():1==n?(i(),t()):2==n&&($$("editTableFormProperty").getValues().id?v():x(),i(),t())})):($$("table").filter(!1),e(),i(),t())}}]},{view:"form",id:"table-editForm",css:"webix_form-edit",minHeight:350,minWidth:210,width:320,borderless:!0,scroll:!0,elements:[{minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{margin:5,rows:[{margin:5,cols:[{view:"button",id:"table-newAddBtnId",height:48,minWidth:90,disabled:!0,hotkey:"shift",value:"Новая запись",click:y},{view:"button",id:"table-delBtnId",disabled:!0,height:48,minWidth:90,width:100,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"wxi-trash",click:_,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить запись из таблицы")}}}]}]},{margin:10,rows:[{view:"button",id:"table-saveBtn",hidden:!0,value:"Сохранить",height:48,css:"webix_primary",click:function(){v()},hotkey:"enter"},{view:"button",id:"table-saveNewBtn",value:"Сохранить новую запись",hidden:!0,height:48,hotkey:"enter",css:"webix_primary",click:function(){x()}},{id:"EditEmptyTempalte",template:"<div style='color:#858585;font-size:13px!important'>Добавьте новую запись или выберите существующую из таблицы</div>",borderless:!0}]}]},{scroll:"y",cols:[{view:"property",id:"editTableFormProperty",css:"webix_edit-table-form-property",dirty:!1,tooltip:"Имя: #label#<br> Значение: #value#",hidden:!0,elements:[],on:{onEditorChange:function(e,t){$$("editTableFormProperty").getItem(e).value=t,$$("editTableFormProperty").updateItem(e),$$("editTableFormProperty").config.dirty=!0,$$("editTableFormProperty").refresh()},onBeforeRender:function(){let e=28*this.config.elements.length;e&&this.$height<e&&(this.define("height",e),this.resize())},onAfterEditStop:function(e,t,i){e.value!==e.old&&($$("editTableFormProperty").getItem(t.id).value=e.value,$$("editTableFormProperty").updateItem(t.id),$$("editTableFormProperty").config.dirty=!0,$$("editTableFormProperty").refresh())}}},{width:8},{id:"propertyRefbtns",rows:[]}]}],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}}]}]},{id:"filterTableBarContainer",hidden:!0,rows:[{id:"editFilterBarAdaptive",rows:[{id:"editFilterBarHeadline",hidden:!0,cols:[{template:"Редактор записей",height:30,css:"table-filter-headline",borderless:!0},{view:"button",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("table-editForm")&&$$("tableFilterPopup")&&$$("tableFilterPopup").hide()}}]},{view:"form",hidden:!0,id:"filterTableForm",minHeight:350,minWidth:210,width:320,scroll:!0,borderless:!0,elements:[{id:"form-adaptive",minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{margin:5,rows:[{responsive:"form-adaptive",margin:5,cols:[{view:"button",value:"Редактор фильтров",height:48,minWidth:140,click:D,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить/удалить фильтры")}}},{view:"button",id:"resetFilterBtn",disabled:!0,height:48,minWidth:50,width:65,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"wxi-trash",click:M,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Сбросить фильтры")}}}]}]},{id:"btns-adaptive",css:{"margin-top":"5px!important"},rows:[{responsive:"btns-adaptive",margin:5,cols:[{view:"button",id:"btnFilterSubmit",height:48,minWidth:70,css:"webix_primary",hotkey:"Enter",disabled:!0,value:"Применить фильтры",click:q},{view:"button",id:"filterLibrarySaveBtn",disabled:!0,height:48,minWidth:50,width:65,hotkey:"shift+esc",type:"icon",icon:"wxi-file",click:J,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Сохранить шаблон с полями в библиотеку")}}}]},{height:10},{id:"filterEmptyTempalte",template:"<div style='color:#858585;font-size:13px!important'>Добавьте фильтры из редактора</div>",borderless:!0}]}]}],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}}]}]}]}},5),$$("forms")||$$("container").addView({view:"layout",id:"forms",css:"webix_tableView",hidden:!0,rows:[C(0,"table-view-exportBtn","table-view-editTableBtnId","table-view-findElements","table-view-idFilterElements","table-view","table-view-filterIdView","table-view-templateHeadline",!0),{view:"resizer",class:"webix_resizers"},{view:"scrollview",body:{view:"flexlayout",cols:[j("table-view"),{view:"resizer",class:"webix_resizers",id:"propResize",hidden:!0},("propTableView",{view:"property",id:"propTableView",tooltip:"Имя: #label#<br> Значение: #value#",width:350,nameWidth:150,editable:!0,scroll:!0,hidden:!0})]}}]},6)),"treeTempl"==t&&($$("treeTempl")||($$("container").addView({view:"layout",id:"treeTempl",hidden:!0,scroll:"auto",rows:[{id:"treeEditContainer",cols:[{rows:[{view:"edittree",id:"treeEdit",editable:!0,editor:"text",editValue:"value",css:"webix_tree-edit",editaction:"dblclick",data:[],on:{onAfterEditStop:function(e,t,i){try{let i="/init/default/api/trees/";if(e.value!=e.old){let n=$$("treeEdit").getParentId(t.id),r={name:e.value,pid:n,id:t.id,owner:null,descr:"",ttype:1,value:"",cdt:null};webix.ajax().put(i+t.id,r).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?o("success","Данные изменены"):s("013-011",e.json().err,!0)})).fail((function(e){console.log(e),l("013-011",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),s("012-011",e)}}}}]},{}]}]},4),webix.ui({view:"contextmenu",id:"contextMenuEditTree",data:["Добавить","Переименовать",{$template:"Separator"},"Свернуть всё","Развернуть всё",{$template:"Separator"},"Удалить"],master:$$("treeEdit"),on:{onMenuItemClick:function(e){let t=this.getContext(),i=$$("treeEdit"),n=i.getItem(t.id),r=this.getMenu(e).getItem(e).value,a="/init/default/api/trees/",c={name:"",pid:"",owner:null,descr:"",ttype:1,value:"",cdt:null};try{switch(r){case"Добавить":{let e=prompt("Имя нового подэлемента '"+n.value+"'","");null!=e&&(console.log(n.id),c.name=e,c.pid=n.id,webix.ajax().post(a,c).then((function(t){if("e"!==t.json().err_type&&"x"!==t.json().err_type){let r=t.json().content.id;i.data.add({id:r,value:e,pid:n.id},0,n.id),i.open(n.id),o("success","Данные сохранены")}else s("013-001",t.json().err,!0)})).fail((function(e){console.log(e),l("013-001",e.status,e.statusText,e.responseURL)})));break}case"Переименовать":var d=prompt("Новое имя",n.value);null!=d&&(c.name=d,c.id=n.id,c.pid=n.pid,webix.ajax().put(a+n.id,c).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?(n.value=d,i.updateItem(n.id,n),o("success","Данные изменены")):s("013-011",e.json().err,!0)})).fail((function(e){console.log(e),l("013-011",e.status,e.statusText,e.responseURL)})));break;case"Удалить":console.log(a+n.id+".json"),console.log(n),webix.ajax().del(a+n.id,n).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?(i.remove(n.id),o("success","Данные удалены")):s("013-002",e.json().err,!0)})).fail((function(e){console.log(e),l("013-002",e.status,e.statusText,e.responseURL)}));break;case"Развернуть всё":try{i.open(n.id),i.data.eachSubItem(n.id,(function(e){i.open(e.id)}))}catch(e){console.log(e),s("013-000",e)}break;case"Свернуть всё":try{i.close(n.id),i.data.eachSubItem(n.id,(function(e){i.close(e.id)}))}catch(e){console.log(e),s("013-000",e)}}}catch(e){console.log(e),s("013-000",e)}}}}))),"cp"==t&&$$("container").addView({view:"layout",id:"user_auth",css:"webix_auth",hidden:!0,rows:[O,{}]},7),"userprefs"==t&&$$("container").addView({view:"layout",id:"userprefs",css:"webix_auth",hidden:!0,rows:[U]},8)}catch(e){console.log(e),s("015-004",e)}}function G(){async function e(){i.mmenu||await n("mmenu"),function(){let e,t=[],n=[];try{e=i.mmenu.mmenu,e.forEach((function(e,i){t.push(function(e){let t;try{t={id:e.name,value:e.title,action:e.action},e.title||(t.value="Без названия"),"dbtable"!==e.action&&"tform"!==e.action&&"dashboard"!==e.action&&"none"!==e.action&&(0==e.childs.length?t.webix_kids=!0:t.data=function(e){let t=[];try{e.childs.forEach((function(e,i){t.push({id:e.name,value:e.title,action:e.action})}))}catch(e){console.log(e),o("error","generateChildsTree: "+e)}return t}(e))}catch(e){console.log(e),o("error","generateParentTree: "+e)}return t}(e)),0!==e.childs.length&&(n=function(e){let t=[];try{t.push({id:"userprefs",value:"Настройки"}),e.childs.forEach((function(e,i){let n={id:e.name,value:e.title};"logout"!==e.name&&t.push(n)})),t.push({id:"logout",value:"Выйти",css:"webix_logout"})}catch(e){console.log(e),o("error","generateHeaderMenu: "+e)}return t}(e))})),$$("tree").clearAll(),$$("tree").parse(t),void 0!==$$("button-context-menu").config.popup.data&&($$("button-context-menu").config.popup.data=n,$$("button-context-menu").enable())}catch(e){console.log(e),o("error","generateMenuTree: "+e)}}()}!async function(){i.whoami||await n("whoami"),i.whoami&&(function(){try{$$("userAuth").hide(),$$("mainLayout").show()}catch(e){console.log(e),window.alert("showMainContent: "+e+" (Подробности: ошибка в отрисовке контента)"),o("error","showMainContent: "+e)}}(),function(){let e={};e.id=i.whoami.content.id,e.name=i.whoami.content.first_name,e.username=i.whoami.content.username,t("user",JSON.stringify(e))}(),K(),e())}()}function Q(){try{$$("container").getChildViews().forEach((function(e,t){"scrollview"!=e.config.view&&"layout"!=e.config.view||$$(e.config.id).isVisible()&&$$(e.config.id).hide()}))}catch(e){console.log(e),o("error","hideAllElements: "+e)}}function X(){let e=new(Backbone.Router.extend({routes:{"":"index",content:"content",userprefs:"userprefs",cp:"cp",logout:"logout","tree/:id":"tree","experimental/:id":"experimental"},content:function(){try{G()}catch(e){console.log(e),o("error","router/content: "+e+" (Подробности: ошибка роутера)")}},index:function(){!async function(){if(i.whoami||await n("whoami"),i.whoami)try{Backbone.history.navigate("content",{trigger:!0})}catch(e){console.log(e),o("error","router/index: "+e+" (Подробности: ошибка роутера)")}else try{$$("mainLayout").hide(),$$("userAuth").show()}catch(e){console.log(e),window.alert("getAuth: "+e+" (Подробности: ошибка в отрисовке контента)"),o("error","getAuth: "+e)}}()},tree:function(e){function t(){let t,n=!1;t=i.fields.content,Object.values(t).forEach((function(i,o){Object.keys(t)[o]==e&&(n=!0,"dbtable"!=i.type&&"tform"!=i.type&&"dashboard"!=i.type||($$("webix__none-content").isVisible()&&$$("webix__none-content").hide(),"dbtable"==i.type?($$("tables")&&$$("tables").show(),$("table",e)):"tform"==i.type?($$("forms")&&$$("forms").show(),$("table-view",e)):"dashboard"==i.type&&($$("dashboards")&&$$("dashboards").show(),p(e))))})),n||setTimeout((function(){webix.ui({view:"popup",id:"popupNotFound",css:"webix_popup-prev-href",width:340,height:125,position:"center",body:{rows:[{rows:[{cols:[{template:"Что-то пошло не так...",width:250,css:"webix_template-not-found",borderless:!0,height:20},{},{view:"button",id:"buttonClosePopup",css:"webix_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){$$("popupNotFound").hide()}}]},{template:"Страница не найдена",css:"webix_template-not-found-descr",borderless:!0,height:35},{view:"button",css:"webix_btn-not-found-back",height:46,value:"Вернуться на главную",click:function(){$$("popupNotFound")&&$$("popupNotFound").destructor(),Backbone.history.navigate("content",{trigger:!0}),window.location.reload()}},{height:20}]}]}}).show()}),1500)}function o(){$$("table-templateHeadline")&&i.tableNames.forEach((function(t,i){t.id==e&&$$("table-templateHeadline").setValues(t.name)})),$$("table-view-templateHeadline")&&i.tableNames.forEach((function(t,i){t.id==e&&$$("table-view-templateHeadline").setValues(t.name)}))}try{0==$$("tree").data.order.length&&async function(){await G(),$$("tree").attachEvent("onAfterLoad",(function(){let r;$$("tree").getItem(e)?(r=$$("tree").getParentId(e),$$("tree").open(r),$$("tree").select(e)):i.fields?i.fields&&(t(),o()):async function(){i.fields||await n("fields"),i.fields&&(t(),o())}()}))}()}catch(e){console.log(e),s("015-005",e)}},cp:function(){try{$$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),Q(),$$("webix__none-content").hide(),0==$$("tree").data.order.length&&G(),$$("user_auth")||K("cp"),$$("user_auth").show(),$$("tree").closeAll();let e=webix.storage.local.get("user");e&&$$("authName").setValues(e.name.toString())}catch(e){console.log(e),s("015-005",e)}},userprefs:function(){try{$$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),Q(),$$("webix__none-content").hide(),0==$$("tree").data.order.length&&G(),$$("userprefs")||(K("userprefs"),webix.ajax().get("/init/default/api/userprefs/",{success:function(e,t,i){"e"==(t=t.json().content).err_type&&o("error",t.error),t.forEach((function(e,t){e.name.includes("userprefs")&&$$(e.name).setValues(JSON.parse(e.prefs))}))},error:function(e,t,i){l("016-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("016-000",e.status,e.statusText,e.responseURL)}))),$$("userprefs").show();let e=webix.storage.local.get("user");e&&$$("userprefsName").setValues(e.name.toString()),$$("tree").closeAll()}catch(e){console.log(e),s("016-005",e)}},experimental:function(){try{$$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),Q(),$$("webix__none-content").hide(),0==$$("tree").data.order.length&&G(),$$("treeTempl")?($$("treeTempl").show(),f()):(K("treeTempl"),f(),$$("treeTempl").show()),$$("tree").closeAll()}catch(e){console.log(e),s("015-005",e)}},logout:function(){webix.ajax().post("/init/default/logout/",{success:function(e,t,i){try{history.back(),function(){try{$$("tables")&&$$("container").removeView($$("tables")),$$("dashboards")&&$$("container").removeView($$("dashboards")),$$("forms")&&$$("container").removeView($$("forms")),$$("user_auth")&&$$("container").removeView($$("user_auth"))}catch(e){console.log(e),s("015-004",e)}}(),$$("webix__none-content").show(),$$("tree").clearAll(),webix.storage.local.clear()}catch(e){console.log(e),o("error","Не удалось выполнить выход"),webix.message({type:"error",expire:3e3,text:"Не удалось выполнить выход"}),s("015-000",e)}},error:function(e,t,i){o("error","Не удалось выполнить выход"),webix.message({type:"error",expire:3e3,text:"Не удалось выполнить выход"}),l("015-006",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("015-006",e.status,e.statusText,e.responseURL)}))}}));return e}webix.UIManager.addHotKey("Ctrl+Shift+E",(function(){Backbone.history.navigate("experimental/treeEdit",{trigger:!0})})),function(){!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("underscore",t):(e="undefined"!=typeof globalThis?globalThis:e||self,function(){var i=e._,n=e._=t();n.noConflict=function(){return e._=i,n}}())}(this,(function(){var e="1.13.4",t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},i=Array.prototype,n=Object.prototype,o="undefined"!=typeof Symbol?Symbol.prototype:null,r=i.push,a=i.slice,s=n.toString,l=n.hasOwnProperty,c="undefined"!=typeof ArrayBuffer,d="undefined"!=typeof DataView,u=Array.isArray,h=Object.keys,$=Object.create,p=c&&ArrayBuffer.isView,f=isNaN,b=isFinite,w=!{toString:null}.propertyIsEnumerable("toString"),m=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],g=Math.pow(2,53)-1;function v(e,t){return t=null==t?e.length-1:+t,function(){for(var i=Math.max(arguments.length-t,0),n=Array(i),o=0;o<i;o++)n[o]=arguments[o+t];switch(t){case 0:return e.call(this,n);case 1:return e.call(this,arguments[0],n);case 2:return e.call(this,arguments[0],arguments[1],n)}var r=Array(t+1);for(o=0;o<t;o++)r[o]=arguments[o];return r[t]=n,e.apply(this,r)}}function y(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function x(e){return void 0===e}function _(e){return!0===e||!1===e||"[object Boolean]"===s.call(e)}function T(e){var t="[object "+e+"]";return function(e){return s.call(e)===t}}var F=T("String"),B=T("Number"),E=T("Date"),V=T("RegExp"),P=T("Error"),A=T("Symbol"),I=T("ArrayBuffer"),C=T("Function"),k=t.document&&t.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof k&&(C=function(e){return"function"==typeof e||!1});var j=C,S=T("Object"),L=d&&S(new DataView(new ArrayBuffer(8))),R="undefined"!=typeof Map&&S(new Map),O=T("DataView"),N=L?function(e){return null!=e&&j(e.getInt8)&&I(e.buffer)}:O,H=u||T("Array");function U(e,t){return null!=e&&l.call(e,t)}var W=T("Arguments");!function(){W(arguments)||(W=function(e){return U(e,"callee")})}();var z=W;function D(e){return B(e)&&f(e)}function M(e){return function(){return e}}function q(e){return function(t){var i=e(t);return"number"==typeof i&&i>=0&&i<=g}}function J(e){return function(t){return null==t?void 0:t[e]}}var Y=J("byteLength"),K=q(Y),G=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,Q=c?function(e){return p?p(e)&&!N(e):K(e)&&G.test(s.call(e))}:M(!1),X=J("length");function Z(e,t){t=function(e){for(var t={},i=e.length,n=0;n<i;++n)t[e[n]]=!0;return{contains:function(e){return!0===t[e]},push:function(i){return t[i]=!0,e.push(i)}}}(t);var i=m.length,o=e.constructor,r=j(o)&&o.prototype||n,a="constructor";for(U(e,a)&&!t.contains(a)&&t.push(a);i--;)(a=m[i])in e&&e[a]!==r[a]&&!t.contains(a)&&t.push(a)}function ee(e){if(!y(e))return[];if(h)return h(e);var t=[];for(var i in e)U(e,i)&&t.push(i);return w&&Z(e,t),t}function te(e,t){var i=ee(t),n=i.length;if(null==e)return!n;for(var o=Object(e),r=0;r<n;r++){var a=i[r];if(t[a]!==o[a]||!(a in o))return!1}return!0}function ie(e){return e instanceof ie?e:this instanceof ie?void(this._wrapped=e):new ie(e)}function ne(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,Y(e))}ie.VERSION=e,ie.prototype.value=function(){return this._wrapped},ie.prototype.valueOf=ie.prototype.toJSON=ie.prototype.value,ie.prototype.toString=function(){return String(this._wrapped)};var oe="[object DataView]";function re(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=typeof e;return("function"===o||"object"===o||"object"==typeof t)&&ae(e,t,i,n)}function ae(e,t,i,n){e instanceof ie&&(e=e._wrapped),t instanceof ie&&(t=t._wrapped);var r=s.call(e);if(r!==s.call(t))return!1;if(L&&"[object Object]"==r&&N(e)){if(!N(t))return!1;r=oe}switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return o.valueOf.call(e)===o.valueOf.call(t);case"[object ArrayBuffer]":case oe:return ae(ne(e),ne(t),i,n)}var a="[object Array]"===r;if(!a&&Q(e)){if(Y(e)!==Y(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;a=!0}if(!a){if("object"!=typeof e||"object"!=typeof t)return!1;var l=e.constructor,c=t.constructor;if(l!==c&&!(j(l)&&l instanceof l&&j(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}n=n||[];for(var d=(i=i||[]).length;d--;)if(i[d]===e)return n[d]===t;if(i.push(e),n.push(t),a){if((d=e.length)!==t.length)return!1;for(;d--;)if(!re(e[d],t[d],i,n))return!1}else{var u,h=ee(e);if(d=h.length,ee(t).length!==d)return!1;for(;d--;)if(!U(t,u=h[d])||!re(e[u],t[u],i,n))return!1}return i.pop(),n.pop(),!0}function se(e){if(!y(e))return[];var t=[];for(var i in e)t.push(i);return w&&Z(e,t),t}function le(e){var t=X(e);return function(i){if(null==i)return!1;var n=se(i);if(X(n))return!1;for(var o=0;o<t;o++)if(!j(i[e[o]]))return!1;return e!==$e||!j(i[ce])}}var ce="forEach",de=["clear","delete"],ue=["get","has","set"],he=de.concat(ce,ue),$e=de.concat(ue),pe=["add"].concat(de,ce,"has"),fe=R?le(he):T("Map"),be=R?le($e):T("WeakMap"),we=R?le(pe):T("Set"),me=T("WeakSet");function ge(e){for(var t=ee(e),i=t.length,n=Array(i),o=0;o<i;o++)n[o]=e[t[o]];return n}function ve(e){for(var t={},i=ee(e),n=0,o=i.length;n<o;n++)t[e[i[n]]]=i[n];return t}function ye(e){var t=[];for(var i in e)j(e[i])&&t.push(i);return t.sort()}function xe(e,t){return function(i){var n=arguments.length;if(t&&(i=Object(i)),n<2||null==i)return i;for(var o=1;o<n;o++)for(var r=arguments[o],a=e(r),s=a.length,l=0;l<s;l++){var c=a[l];t&&void 0!==i[c]||(i[c]=r[c])}return i}}var _e=xe(se),Te=xe(ee),Fe=xe(se,!0);function Be(e){if(!y(e))return{};if($)return $(e);var t=function(){};t.prototype=e;var i=new t;return t.prototype=null,i}function Ee(e){return H(e)?e:[e]}function Ve(e){return ie.toPath(e)}function Pe(e,t){for(var i=t.length,n=0;n<i;n++){if(null==e)return;e=e[t[n]]}return i?e:void 0}function Ae(e,t,i){var n=Pe(e,Ve(t));return x(n)?i:n}function Ie(e){return e}function Ce(e){return e=Te({},e),function(t){return te(t,e)}}function ke(e){return e=Ve(e),function(t){return Pe(t,e)}}function je(e,t,i){if(void 0===t)return e;switch(null==i?3:i){case 1:return function(i){return e.call(t,i)};case 3:return function(i,n,o){return e.call(t,i,n,o)};case 4:return function(i,n,o,r){return e.call(t,i,n,o,r)}}return function(){return e.apply(t,arguments)}}function Se(e,t,i){return null==e?Ie:j(e)?je(e,t,i):y(e)&&!H(e)?Ce(e):ke(e)}function Le(e,t){return Se(e,t,1/0)}function Re(e,t,i){return ie.iteratee!==Le?ie.iteratee(e,t):Se(e,t,i)}function Oe(){}function Ne(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}ie.toPath=Ee,ie.iteratee=Le;var He=Date.now||function(){return(new Date).getTime()};function Ue(e){var t=function(t){return e[t]},i="(?:"+ee(e).join("|")+")",n=RegExp(i),o=RegExp(i,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(o,t):e}}var We={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},ze=Ue(We),De=Ue(ve(We)),Me=ie.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},qe=/(.)^/,Je={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Ye=/\\|'|\r|\n|\u2028|\u2029/g;function Ke(e){return"\\"+Je[e]}var Ge=/^\s*(\w|\$)+\s*$/,Qe=0;function Xe(e,t,i,n,o){if(!(n instanceof t))return e.apply(i,o);var r=Be(e.prototype),a=e.apply(r,o);return y(a)?a:r}var Ze=v((function(e,t){var i=Ze.placeholder,n=function(){for(var o=0,r=t.length,a=Array(r),s=0;s<r;s++)a[s]=t[s]===i?arguments[o++]:t[s];for(;o<arguments.length;)a.push(arguments[o++]);return Xe(e,n,this,this,a)};return n}));Ze.placeholder=ie;var et=v((function(e,t,i){if(!j(e))throw new TypeError("Bind must be called on a function");var n=v((function(o){return Xe(e,n,t,this,i.concat(o))}));return n})),tt=q(X);function it(e,t,i,n){if(n=n||[],t||0===t){if(t<=0)return n.concat(e)}else t=1/0;for(var o=n.length,r=0,a=X(e);r<a;r++){var s=e[r];if(tt(s)&&(H(s)||z(s)))if(t>1)it(s,t-1,i,n),o=n.length;else for(var l=0,c=s.length;l<c;)n[o++]=s[l++];else i||(n[o++]=s)}return n}var nt=v((function(e,t){var i=(t=it(t,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var n=t[i];e[n]=et(e[n],e)}return e})),ot=v((function(e,t,i){return setTimeout((function(){return e.apply(null,i)}),t)})),rt=Ze(ot,ie,1);function at(e){return function(){return!e.apply(this,arguments)}}function st(e,t){var i;return function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=null),i}}var lt=Ze(st,2);function ct(e,t,i){t=Re(t,i);for(var n,o=ee(e),r=0,a=o.length;r<a;r++)if(t(e[n=o[r]],n,e))return n}function dt(e){return function(t,i,n){i=Re(i,n);for(var o=X(t),r=e>0?0:o-1;r>=0&&r<o;r+=e)if(i(t[r],r,t))return r;return-1}}var ut=dt(1),ht=dt(-1);function $t(e,t,i,n){for(var o=(i=Re(i,n,1))(t),r=0,a=X(e);r<a;){var s=Math.floor((r+a)/2);i(e[s])<o?r=s+1:a=s}return r}function pt(e,t,i){return function(n,o,r){var s=0,l=X(n);if("number"==typeof r)e>0?s=r>=0?r:Math.max(r+l,s):l=r>=0?Math.min(r+1,l):r+l+1;else if(i&&r&&l)return n[r=i(n,o)]===o?r:-1;if(o!=o)return(r=t(a.call(n,s,l),D))>=0?r+s:-1;for(r=e>0?s:l-1;r>=0&&r<l;r+=e)if(n[r]===o)return r;return-1}}var ft=pt(1,ut,$t),bt=pt(-1,ht);function wt(e,t,i){var n=(tt(e)?ut:ct)(e,t,i);if(void 0!==n&&-1!==n)return e[n]}function mt(e,t,i){var n,o;if(t=je(t,i),tt(e))for(n=0,o=e.length;n<o;n++)t(e[n],n,e);else{var r=ee(e);for(n=0,o=r.length;n<o;n++)t(e[r[n]],r[n],e)}return e}function gt(e,t,i){t=Re(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=Array(o),a=0;a<o;a++){var s=n?n[a]:a;r[a]=t(e[s],s,e)}return r}function vt(e){var t=function(t,i,n,o){var r=!tt(t)&&ee(t),a=(r||t).length,s=e>0?0:a-1;for(o||(n=t[r?r[s]:s],s+=e);s>=0&&s<a;s+=e){var l=r?r[s]:s;n=i(n,t[l],l,t)}return n};return function(e,i,n,o){var r=arguments.length>=3;return t(e,je(i,o,4),n,r)}}var yt=vt(1),xt=vt(-1);function _t(e,t,i){var n=[];return t=Re(t,i),mt(e,(function(e,i,o){t(e,i,o)&&n.push(e)})),n}function Tt(e,t,i){t=Re(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=0;r<o;r++){var a=n?n[r]:r;if(!t(e[a],a,e))return!1}return!0}function Ft(e,t,i){t=Re(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=0;r<o;r++){var a=n?n[r]:r;if(t(e[a],a,e))return!0}return!1}function Bt(e,t,i,n){return tt(e)||(e=ge(e)),("number"!=typeof i||n)&&(i=0),ft(e,t,i)>=0}var Et=v((function(e,t,i){var n,o;return j(t)?o=t:(t=Ve(t),n=t.slice(0,-1),t=t[t.length-1]),gt(e,(function(e){var r=o;if(!r){if(n&&n.length&&(e=Pe(e,n)),null==e)return;r=e[t]}return null==r?r:r.apply(e,i)}))}));function Vt(e,t){return gt(e,ke(t))}function Pt(e,t,i){var n,o,r=-1/0,a=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,l=(e=tt(e)?e:ge(e)).length;s<l;s++)null!=(n=e[s])&&n>r&&(r=n);else t=Re(t,i),mt(e,(function(e,i,n){((o=t(e,i,n))>a||o===-1/0&&r===-1/0)&&(r=e,a=o)}));return r}var At=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function It(e){return e?H(e)?a.call(e):F(e)?e.match(At):tt(e)?gt(e,Ie):ge(e):[]}function Ct(e,t,i){if(null==t||i)return tt(e)||(e=ge(e)),e[Ne(e.length-1)];var n=It(e),o=X(n);t=Math.max(Math.min(t,o),0);for(var r=o-1,a=0;a<t;a++){var s=Ne(a,r),l=n[a];n[a]=n[s],n[s]=l}return n.slice(0,t)}function kt(e,t){return function(i,n,o){var r=t?[[],[]]:{};return n=Re(n,o),mt(i,(function(t,o){var a=n(t,o,i);e(r,t,a)})),r}}var jt=kt((function(e,t,i){U(e,i)?e[i].push(t):e[i]=[t]})),St=kt((function(e,t,i){e[i]=t})),Lt=kt((function(e,t,i){U(e,i)?e[i]++:e[i]=1})),Rt=kt((function(e,t,i){e[i?0:1].push(t)}),!0);function Ot(e,t,i){return t in i}var Nt=v((function(e,t){var i={},n=t[0];if(null==e)return i;j(n)?(t.length>1&&(n=je(n,t[1])),t=se(e)):(n=Ot,t=it(t,!1,!1),e=Object(e));for(var o=0,r=t.length;o<r;o++){var a=t[o],s=e[a];n(s,a,e)&&(i[a]=s)}return i})),Ht=v((function(e,t){var i,n=t[0];return j(n)?(n=at(n),t.length>1&&(i=t[1])):(t=gt(it(t,!1,!1),String),n=function(e,i){return!Bt(t,i)}),Nt(e,n,i)}));function Ut(e,t,i){return a.call(e,0,Math.max(0,e.length-(null==t||i?1:t)))}function Wt(e,t,i){return null==e||e.length<1?null==t||i?void 0:[]:null==t||i?e[0]:Ut(e,e.length-t)}function zt(e,t,i){return a.call(e,null==t||i?1:t)}var Dt=v((function(e,t){return t=it(t,!0,!0),_t(e,(function(e){return!Bt(t,e)}))})),Mt=v((function(e,t){return Dt(e,t)}));function qt(e,t,i,n){_(t)||(n=i,i=t,t=!1),null!=i&&(i=Re(i,n));for(var o=[],r=[],a=0,s=X(e);a<s;a++){var l=e[a],c=i?i(l,a,e):l;t&&!i?(a&&r===c||o.push(l),r=c):i?Bt(r,c)||(r.push(c),o.push(l)):Bt(o,l)||o.push(l)}return o}var Jt=v((function(e){return qt(it(e,!0,!0))}));function Yt(e){for(var t=e&&Pt(e,X).length||0,i=Array(t),n=0;n<t;n++)i[n]=Vt(e,n);return i}var Kt=v(Yt);function Gt(e,t){return e._chain?ie(t).chain():t}function Qt(e){return mt(ye(e),(function(t){var i=ie[t]=e[t];ie.prototype[t]=function(){var e=[this._wrapped];return r.apply(e,arguments),Gt(this,i.apply(ie,e))}})),ie}mt(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=i[e];ie.prototype[e]=function(){var i=this._wrapped;return null!=i&&(t.apply(i,arguments),"shift"!==e&&"splice"!==e||0!==i.length||delete i[0]),Gt(this,i)}})),mt(["concat","join","slice"],(function(e){var t=i[e];ie.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),Gt(this,e)}}));var Xt={__proto__:null,VERSION:e,restArguments:v,isObject:y,isNull:function(e){return null===e},isUndefined:x,isBoolean:_,isElement:function(e){return!(!e||1!==e.nodeType)},isString:F,isNumber:B,isDate:E,isRegExp:V,isError:P,isSymbol:A,isArrayBuffer:I,isDataView:N,isArray:H,isFunction:j,isArguments:z,isFinite:function(e){return!A(e)&&b(e)&&!isNaN(parseFloat(e))},isNaN:D,isTypedArray:Q,isEmpty:function(e){if(null==e)return!0;var t=X(e);return"number"==typeof t&&(H(e)||F(e)||z(e))?0===t:0===X(ee(e))},isMatch:te,isEqual:function(e,t){return re(e,t)},isMap:fe,isWeakMap:be,isSet:we,isWeakSet:me,keys:ee,allKeys:se,values:ge,pairs:function(e){for(var t=ee(e),i=t.length,n=Array(i),o=0;o<i;o++)n[o]=[t[o],e[t[o]]];return n},invert:ve,functions:ye,methods:ye,extend:_e,extendOwn:Te,assign:Te,defaults:Fe,create:function(e,t){var i=Be(e);return t&&Te(i,t),i},clone:function(e){return y(e)?H(e)?e.slice():_e({},e):e},tap:function(e,t){return t(e),e},get:Ae,has:function(e,t){for(var i=(t=Ve(t)).length,n=0;n<i;n++){var o=t[n];if(!U(e,o))return!1;e=e[o]}return!!i},mapObject:function(e,t,i){t=Re(t,i);for(var n=ee(e),o=n.length,r={},a=0;a<o;a++){var s=n[a];r[s]=t(e[s],s,e)}return r},identity:Ie,constant:M,noop:Oe,toPath:Ee,property:ke,propertyOf:function(e){return null==e?Oe:function(t){return Ae(e,t)}},matcher:Ce,matches:Ce,times:function(e,t,i){var n=Array(Math.max(0,e));t=je(t,i,1);for(var o=0;o<e;o++)n[o]=t(o);return n},random:Ne,now:He,escape:ze,unescape:De,templateSettings:Me,template:function(e,t,i){!t&&i&&(t=i),t=Fe({},t,ie.templateSettings);var n=RegExp([(t.escape||qe).source,(t.interpolate||qe).source,(t.evaluate||qe).source].join("|")+"|$","g"),o=0,r="__p+='";e.replace(n,(function(t,i,n,a,s){return r+=e.slice(o,s).replace(Ye,Ke),o=s+t.length,i?r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?r+="'+\n((__t=("+n+"))==null?'':__t)+\n'":a&&(r+="';\n"+a+"\n__p+='"),t})),r+="';\n";var a,s=t.variable;if(s){if(!Ge.test(s))throw new Error("variable is not a bare identifier: "+s)}else r="with(obj||{}){\n"+r+"}\n",s="obj";r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{a=new Function(s,"_",r)}catch(e){throw e.source=r,e}var l=function(e){return a.call(this,e,ie)};return l.source="function("+s+"){\n"+r+"}",l},result:function(e,t,i){var n=(t=Ve(t)).length;if(!n)return j(i)?i.call(e):i;for(var o=0;o<n;o++){var r=null==e?void 0:e[t[o]];void 0===r&&(r=i,o=n),e=j(r)?r.call(e):r}return e},uniqueId:function(e){var t=++Qe+"";return e?e+t:t},chain:function(e){var t=ie(e);return t._chain=!0,t},iteratee:Le,partial:Ze,bind:et,bindAll:nt,memoize:function(e,t){var i=function(n){var o=i.cache,r=""+(t?t.apply(this,arguments):n);return U(o,r)||(o[r]=e.apply(this,arguments)),o[r]};return i.cache={},i},delay:ot,defer:rt,throttle:function(e,t,i){var n,o,r,a,s=0;i||(i={});var l=function(){s=!1===i.leading?0:He(),n=null,a=e.apply(o,r),n||(o=r=null)},c=function(){var c=He();s||!1!==i.leading||(s=c);var d=t-(c-s);return o=this,r=arguments,d<=0||d>t?(n&&(clearTimeout(n),n=null),s=c,a=e.apply(o,r),n||(o=r=null)):n||!1===i.trailing||(n=setTimeout(l,d)),a};return c.cancel=function(){clearTimeout(n),s=0,n=o=r=null},c},debounce:function(e,t,i){var n,o,r,a,s,l=function(){var c=He()-o;t>c?n=setTimeout(l,t-c):(n=null,i||(a=e.apply(s,r)),n||(r=s=null))},c=v((function(c){return s=this,r=c,o=He(),n||(n=setTimeout(l,t),i&&(a=e.apply(s,r))),a}));return c.cancel=function(){clearTimeout(n),n=r=s=null},c},wrap:function(e,t){return Ze(t,e)},negate:at,compose:function(){var e=arguments,t=e.length-1;return function(){for(var i=t,n=e[t].apply(this,arguments);i--;)n=e[i].call(this,n);return n}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:st,once:lt,findKey:ct,findIndex:ut,findLastIndex:ht,sortedIndex:$t,indexOf:ft,lastIndexOf:bt,find:wt,detect:wt,findWhere:function(e,t){return wt(e,Ce(t))},each:mt,forEach:mt,map:gt,collect:gt,reduce:yt,foldl:yt,inject:yt,reduceRight:xt,foldr:xt,filter:_t,select:_t,reject:function(e,t,i){return _t(e,at(Re(t)),i)},every:Tt,all:Tt,some:Ft,any:Ft,contains:Bt,includes:Bt,include:Bt,invoke:Et,pluck:Vt,where:function(e,t){return _t(e,Ce(t))},max:Pt,min:function(e,t,i){var n,o,r=1/0,a=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,l=(e=tt(e)?e:ge(e)).length;s<l;s++)null!=(n=e[s])&&n<r&&(r=n);else t=Re(t,i),mt(e,(function(e,i,n){((o=t(e,i,n))<a||o===1/0&&r===1/0)&&(r=e,a=o)}));return r},shuffle:function(e){return Ct(e,1/0)},sample:Ct,sortBy:function(e,t,i){var n=0;return t=Re(t,i),Vt(gt(e,(function(e,i,o){return{value:e,index:n++,criteria:t(e,i,o)}})).sort((function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index-t.index})),"value")},groupBy:jt,indexBy:St,countBy:Lt,partition:Rt,toArray:It,size:function(e){return null==e?0:tt(e)?e.length:ee(e).length},pick:Nt,omit:Ht,first:Wt,head:Wt,take:Wt,initial:Ut,last:function(e,t,i){return null==e||e.length<1?null==t||i?void 0:[]:null==t||i?e[e.length-1]:zt(e,Math.max(0,e.length-t))},rest:zt,tail:zt,drop:zt,compact:function(e){return _t(e,Boolean)},flatten:function(e,t){return it(e,t,!1)},without:Mt,uniq:qt,unique:qt,union:Jt,intersection:function(e){for(var t=[],i=arguments.length,n=0,o=X(e);n<o;n++){var r=e[n];if(!Bt(t,r)){var a;for(a=1;a<i&&Bt(arguments[a],r);a++);a===i&&t.push(r)}}return t},difference:Dt,unzip:Yt,transpose:Yt,zip:Kt,object:function(e,t){for(var i={},n=0,o=X(e);n<o;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},range:function(e,t,i){null==t&&(t=e||0,e=0),i||(i=t<e?-1:1);for(var n=Math.max(Math.ceil((t-e)/i),0),o=Array(n),r=0;r<n;r++,e+=i)o[r]=e;return o},chunk:function(e,t){if(null==t||t<1)return[];for(var i=[],n=0,o=e.length;n<o;)i.push(a.call(e,n,n+=t));return i},mixin:Qt,default:ie},Zt=Qt(Xt);return Zt._=Zt,Zt})),function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],(function(i,n,o){t.Backbone=e(t,o,i,n)}));else if("undefined"!=typeof exports){var i,n=require("underscore");try{i=require("jquery")}catch(e){}e(t,exports,n,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}((function(e,t,i,n){var o=e.Backbone,r=Array.prototype.slice;t.VERSION="1.4.1",t.$=n,t.noConflict=function(){return e.Backbone=o,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a,s=t.Events={},l=/\s+/,c=function(e,t,n,o,r){var a,s=0;if(n&&"object"==typeof n){void 0!==o&&"context"in r&&void 0===r.context&&(r.context=o);for(a=i.keys(n);s<a.length;s++)t=c(e,t,a[s],n[a[s]],r)}else if(n&&l.test(n))for(a=n.split(l);s<a.length;s++)t=e(t,a[s],o,r);else t=e(t,n,o,r);return t};s.on=function(e,t,i){return this._events=c(d,this._events||{},e,t,{context:i,ctx:this,listening:a}),a&&((this._listeners||(this._listeners={}))[a.id]=a,a.interop=!1),this},s.listenTo=function(e,t,n){if(!e)return this;var o=e._listenId||(e._listenId=i.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),s=a=r[o];s||(this._listenId||(this._listenId=i.uniqueId("l")),s=a=r[o]=new b(this,e));var l=u(e,t,n,this);if(a=void 0,l)throw l;return s.interop&&s.on(t,n),this};var d=function(e,t,i,n){if(i){var o=e[t]||(e[t]=[]),r=n.context,a=n.ctx,s=n.listening;s&&s.count++,o.push({callback:i,context:r,ctx:r||a,listening:s})}return e},u=function(e,t,i,n){try{e.on(t,i,n)}catch(e){return e}};s.off=function(e,t,i){return this._events?(this._events=c(h,this._events,e,t,{context:i,listeners:this._listeners}),this):this},s.stopListening=function(e,t,n){var o=this._listeningTo;if(!o)return this;for(var r=e?[e._listenId]:i.keys(o),a=0;a<r.length;a++){var s=o[r[a]];if(!s)break;s.obj.off(t,n,this),s.interop&&s.off(t,n)}return i.isEmpty(o)&&(this._listeningTo=void 0),this};var h=function(e,t,n,o){if(e){var r,a=o.context,s=o.listeners,l=0;if(t||a||n){for(r=t?[t]:i.keys(e);l<r.length;l++){var c=e[t=r[l]];if(!c)break;for(var d=[],u=0;u<c.length;u++){var h=c[u];if(n&&n!==h.callback&&n!==h.callback._callback||a&&a!==h.context)d.push(h);else{var $=h.listening;$&&$.off(t,n)}}d.length?e[t]=d:delete e[t]}return e}for(r=i.keys(s);l<r.length;l++)s[r[l]].cleanup()}};s.once=function(e,t,i){var n=c($,{},e,t,this.off.bind(this));return"string"==typeof e&&null==i&&(t=void 0),this.on(n,t,i)},s.listenToOnce=function(e,t,i){var n=c($,{},t,i,this.stopListening.bind(this,e));return this.listenTo(e,n)};var $=function(e,t,n,o){if(n){var r=e[t]=i.once((function(){o(t,r),n.apply(this,arguments)}));r._callback=n}return e};s.trigger=function(e){if(!this._events)return this;for(var t=Math.max(0,arguments.length-1),i=Array(t),n=0;n<t;n++)i[n]=arguments[n+1];return c(p,this._events,e,void 0,i),this};var p=function(e,t,i,n){if(e){var o=e[t],r=e.all;o&&r&&(r=r.slice()),o&&f(o,n),r&&f(r,[t].concat(n))}return e},f=function(e,t){var i,n=-1,o=e.length,r=t[0],a=t[1],s=t[2];switch(t.length){case 0:for(;++n<o;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r);return;case 2:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r,a);return;case 3:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r,a,s);return;default:for(;++n<o;)(i=e[n]).callback.apply(i.ctx,t);return}},b=function(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0};b.prototype.on=s.on,b.prototype.off=function(e,t){var i;this.interop?(this._events=c(h,this._events,e,t,{context:void 0,listeners:void 0}),i=!this._events):(this.count--,i=0===this.count),i&&this.cleanup()},b.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},s.bind=s.on,s.unbind=s.off,i.extend(t,s);var w=t.Model=function(e,t){var n=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});var o=i.result(this,"defaults");n=i.defaults(i.extend({},o,n),o),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(w.prototype,s,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!i.iteratee(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;var o;if("object"==typeof e?(o=e,n=t):(o={})[e]=t,n||(n={}),!this._validate(o,n))return!1;var r=n.unset,a=n.silent,s=[],l=this._changing;this._changing=!0,l||(this._previousAttributes=i.clone(this.attributes),this.changed={});var c=this.attributes,d=this.changed,u=this._previousAttributes;for(var h in o)t=o[h],i.isEqual(c[h],t)||s.push(h),i.isEqual(u[h],t)?delete d[h]:d[h]=t,r?delete c[h]:c[h]=t;if(this.idAttribute in o){var $=this.id;this.id=this.get(this.idAttribute),this.trigger("changeId",this,$,n)}if(!a){s.length&&(this._pending=n);for(var p=0;p<s.length;p++)this.trigger("change:"+s[p],this,c[s[p]],n)}if(l)return this;if(!a)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&i.clone(this.changed);var t,n=this._changing?this._previousAttributes:this.attributes,o={};for(var r in e){var a=e[r];i.isEqual(n[r],a)||(o[r]=a,t=!0)}return!!t&&o},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=i.extend({parse:!0},e);var t=this,n=e.success;return e.success=function(i){var o=e.parse?t.parse(i,e):i;if(!t.set(o,e))return!1;n&&n.call(e.context,t,i,e),t.trigger("sync",t,i,e)},D(this,e),this.sync("read",this,e)},save:function(e,t,n){var o;null==e||"object"==typeof e?(o=e,n=t):(o={})[e]=t;var r=(n=i.extend({validate:!0,parse:!0},n)).wait;if(o&&!r){if(!this.set(o,n))return!1}else if(!this._validate(o,n))return!1;var a=this,s=n.success,l=this.attributes;n.success=function(e){a.attributes=l;var t=n.parse?a.parse(e,n):e;if(r&&(t=i.extend({},o,t)),t&&!a.set(t,n))return!1;s&&s.call(n.context,a,e,n),a.trigger("sync",a,e,n)},D(this,n),o&&r&&(this.attributes=i.extend({},l,o));var c=this.isNew()?"create":n.patch?"patch":"update";"patch"!==c||n.attrs||(n.attrs=o);var d=this.sync(c,this,n);return this.attributes=l,d},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,o=e.wait,r=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(i){o&&r(),n&&n.call(e.context,t,i,e),t.isNew()||t.trigger("sync",t,i,e)};var a=!1;return this.isNew()?i.defer(e.success):(D(this,e),a=this.sync("delete",this,e)),o||r(),a},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||z();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1)}});var m=t.Collection=function(e,t){t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},v={add:!0,remove:!1},y=function(e,t,i){i=Math.min(Math.max(i,0),e.length);var n,o=Array(e.length-i),r=t.length;for(n=0;n<o.length;n++)o[n]=e[n+i];for(n=0;n<r;n++)e[n+i]=t[n];for(n=0;n<o.length;n++)e[n+r+i]=o[n]};i.extend(m.prototype,s,{model:w,preinitialize:function(){},initialize:function(){},toJSON:function(e){return this.map((function(t){return t.toJSON(e)}))},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,v))},remove:function(e,t){t=i.extend({},t);var n=!i.isArray(e);e=n?[e]:e.slice();var o=this._removeModels(e,t);return!t.silent&&o.length&&(t.changes={added:[],merged:[],removed:o},this.trigger("update",this,t)),n?o[0]:o},set:function(e,t){if(null!=e){(t=i.extend({},g,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var n=!i.isArray(e);e=n?[e]:e.slice();var o=t.at;null!=o&&(o=+o),o>this.length&&(o=this.length),o<0&&(o+=this.length+1);var r,a,s=[],l=[],c=[],d=[],u={},h=t.add,$=t.merge,p=t.remove,f=!1,b=this.comparator&&null==o&&!1!==t.sort,w=i.isString(this.comparator)?this.comparator:null;for(a=0;a<e.length;a++){r=e[a];var m=this.get(r);if(m){if($&&r!==m){var v=this._isModel(r)?r.attributes:r;t.parse&&(v=m.parse(v,t)),m.set(v,t),c.push(m),b&&!f&&(f=m.hasChanged(w))}u[m.cid]||(u[m.cid]=!0,s.push(m)),e[a]=m}else h&&(r=e[a]=this._prepareModel(r,t))&&(l.push(r),this._addReference(r,t),u[r.cid]=!0,s.push(r))}if(p){for(a=0;a<this.length;a++)u[(r=this.models[a]).cid]||d.push(r);d.length&&this._removeModels(d,t)}var x=!1,_=!b&&h&&p;if(s.length&&_?(x=this.length!==s.length||i.some(this.models,(function(e,t){return e!==s[t]})),this.models.length=0,y(this.models,s,0),this.length=this.models.length):l.length&&(b&&(f=!0),y(this.models,l,null==o?this.length:o),this.length=this.models.length),f&&this.sort({silent:!0}),!t.silent){for(a=0;a<l.length;a++)null!=o&&(t.index=o+a),(r=l[a]).trigger("add",r,this,t);(f||x)&&this.trigger("sort",this,t),(l.length||d.length||c.length)&&(t.changes={added:l,removed:d,merged:c},this.trigger("update",this,t))}return n?e[0]:e}},reset:function(e,t){t=t?i.clone(t):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return r.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e,e.idAttribute)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var n=t.length;return i.isFunction(t)&&(t=t.bind(this)),1===n||i.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){var t=(e=i.extend({parse:!0},e)).success,n=this;return e.success=function(i){var o=e.reset?"reset":"set";n[o](i,e),t&&t.call(e.context,n,i,e),n.trigger("sync",n,i,e)},D(this,e),this.sync("read",this,e)},create:function(e,t){var n=(t=t?i.clone(t):{}).wait;if(!(e=this._prepareModel(e,t)))return!1;n||this.add(e,t);var o=this,r=t.success;return t.success=function(e,t,i){n&&o.add(e,i),r&&r.call(i.context,e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e,t){return e[t||this.model.prototype.idAttribute||"id"]},values:function(){return new _(this,T)},keys:function(){return new _(this,F)},entries:function(){return new _(this,B)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){return this._isModel(e)?(e.collection||(e.collection=this),e):((t=t?i.clone(t):{}).collection=this,(n=this.model.prototype?new this.model(e,t):this.model(e,t)).validationError?(this.trigger("invalid",this,n.validationError,t),!1):n);var n},_removeModels:function(e,t){for(var i=[],n=0;n<e.length;n++){var o=this.get(e[n]);if(o){var r=this.indexOf(o);this.models.splice(r,1),this.length--,delete this._byId[o.cid];var a=this.modelId(o.attributes,o.idAttribute);null!=a&&delete this._byId[a],t.silent||(t.index=r,o.trigger("remove",o,this,t)),i.push(o),this._removeReference(o,t)}}return i},_isModel:function(e){return e instanceof w},_addReference:function(e,t){this._byId[e.cid]=e;var i=this.modelId(e.attributes,e.idAttribute);null!=i&&(this._byId[i]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var i=this.modelId(e.attributes,e.idAttribute);null!=i&&delete this._byId[i],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){if(t){if(("add"===e||"remove"===e)&&i!==this)return;if("destroy"===e&&this.remove(t,n),"changeId"===e){var o=this.modelId(t.previousAttributes(),t.idAttribute),r=this.modelId(t.attributes,t.idAttribute);null!=o&&delete this._byId[o],null!=r&&(this._byId[r]=t)}}this.trigger.apply(this,arguments)}});var x="function"==typeof Symbol&&Symbol.iterator;x&&(m.prototype[x]=m.prototype.values);var _=function(e,t){this._collection=e,this._kind=t,this._index=0},T=1,F=2,B=3;x&&(_.prototype[x]=function(){return this}),_.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var e,t=this._collection.at(this._index);if(this._index++,this._kind===T)e=t;else{var i=this._collection.modelId(t.attributes,t.idAttribute);e=this._kind===F?i:[i,t]}return{value:e,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var E=t.View=function(e){this.cid=i.uniqueId("view"),this.preinitialize.apply(this,arguments),i.extend(this,i.pick(e,P)),this._ensureElement(),this.initialize.apply(this,arguments)},V=/^(\S+)\s*(.*)$/,P=["model","collection","el","id","attributes","className","tagName","events"];i.extend(E.prototype,s,{tagName:"div",$:function(e){return this.$el.find(e)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=i.result(this,"events")),!e)return this;for(var t in this.undelegateEvents(),e){var n=e[t];if(i.isFunction(n)||(n=this[n]),n){var o=t.match(V);this.delegate(o[1],o[2],n.bind(this))}}return this},delegate:function(e,t,i){return this.$el.on(e+".delegateEvents"+this.cid,t,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,i){return this.$el.off(e+".delegateEvents"+this.cid,t,i),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e.class=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}});var A=function(e,t,n,o){i.each(n,(function(i,n){t[n]&&(e.prototype[n]=function(e,t,i,n){switch(t){case 1:return function(){return e[i](this[n])};case 2:return function(t){return e[i](this[n],t)};case 3:return function(t,o){return e[i](this[n],I(t,this),o)};case 4:return function(t,o,r){return e[i](this[n],I(t,this),o,r)};default:return function(){var t=r.call(arguments);return t.unshift(this[n]),e[i].apply(e,t)}}}(t,i,n,o))}))},I=function(e,t){return i.isFunction(e)?e:i.isObject(e)&&!t._isModel(e)?C(e):i.isString(e)?function(t){return t.get(e)}:e},C=function(e){var t=i.matches(e);return function(e){return t(e.attributes)}};i.each([[m,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"],[w,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],(function(e){var t=e[0],n=e[1],o=e[2];t.mixin=function(e){var n=i.reduce(i.functions(e),(function(e,t){return e[t]=0,e}),{});A(t,e,n,o)},A(t,i,n,o)})),t.sync=function(e,n,o){var r=k[e];i.defaults(o||(o={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var a={type:r,dataType:"json"};if(o.url||(a.url=i.result(n,"url")||z()),null!=o.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(o.attrs||n.toJSON(o))),o.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),o.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){a.type="POST",o.emulateJSON&&(a.data._method=r);var s=o.beforeSend;o.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",r),s)return s.apply(this,arguments)}}"GET"===a.type||o.emulateJSON||(a.processData=!1);var l=o.error;o.error=function(e,t,i){o.textStatus=t,o.errorThrown=i,l&&l.call(o.context,e,t,i)};var c=o.xhr=t.ajax(i.extend(a,o));return n.trigger("request",n,c,o),c};var k={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var j=t.Router=function(e){e||(e={}),this.preinitialize.apply(this,arguments),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},S=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,R=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(j.prototype,s,{preinitialize:function(){},initialize:function(){},route:function(e,n,o){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(o=n,n=""),o||(o=this[n]);var r=this;return t.history.route(e,(function(i){var a=r._extractParameters(e,i);!1!==r.execute(o,a,n)&&(r.trigger.apply(r,["route:"+n].concat(a)),r.trigger("route",n,a),t.history.trigger("route",r,n,a))})),this},execute:function(e,t,i){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(S,"(?:$1)?").replace(L,(function(e,t){return t?e:"([^/?]+)"})).replace(R,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,(function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null}))}});var N=t.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},H=/^[#\/]|\s+$/g,U=/^\/+|\/+$/g,W=/#.*$/;N.started=!1,i.extend(N.prototype,s,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(H,"")},start:function(e){if(N.started)throw new Error("Backbone.history has already been started");if(N.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(U,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,o=n.insertBefore(this.iframe,n.firstChild).contentWindow;o.document.open(),o.document.close(),o.location.hash="#"+this.fragment}var r=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),N.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),i.some(this.handlers,(function(t){if(t.route.test(e))return t.callback(e),!0})))},navigate:function(e,t){if(!N.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");var i=this.root;""!==e&&"?"!==e.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+e;e=e.replace(W,"");var o=this.decodeFragment(e);if(this.fragment!==o){if(this.fragment=o,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;t.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new N,w.extend=m.extend=j.extend=E.extend=N.extend=function(e,t){var n,o=this;return n=e&&i.has(e,"constructor")?e.constructor:function(){return o.apply(this,arguments)},i.extend(n,o,t),n.prototype=i.create(o.prototype,e),n.prototype.constructor=n,n.__super__=o.prototype,n};var z=function(){throw new Error('A "url" property or function must be specified')},D=function(e,t){var i=t.error;t.error=function(n){i&&i.call(t.context,e,n,t),e.trigger("error",e,n,t)}};return t}))}(),"/index.html"!==window.location.pathname&&"/"!==window.location.pathname&&"/init/default/spaw/"!==window.location.pathname&&function(e,i,n=!1){try{let o,r,a=(i=window.location.href).slice(i.lastIndexOf("/")+1);e&&e.forEach((function(e,t){e.id==a&&(o=e.name)})),r={tableName:o,tableId:a,href:i,autoLogout:n},t("userLocation",JSON.stringify(r))}catch(e){console.log(e),s("010-000",e)}}("",window.location.href);let Z="";function ee(){return{view:"edittree",id:"tree",css:"webix_tree-main",minWidth:100,width:250,editable:!1,select:!0,editor:"text",editValue:"value",activeTitle:!0,clipboard:!0,data:[],on:{onSelectChange:function(e){Z=e[0];let t=$$("tree").getSelectedItem().id,o=$$("tree").getParentId(t),r=$$("tree").data.order,a=[],l="";try{$$("inputsTable")&&$$("EditEmptyTempalte").show(),$$("filterEmptyTempalte")&&$$("filterEmptyTempalte").show(),$$("table-editTableBtnId").isVisible()&&$$("table-editTableBtnId").hide(),$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").hide(),$$("editTableBarContainer")&&!$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").show(),$$("table-editForm")&&!$$("table-editForm").isVisible()&&$$("table-editForm").show(),$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").disable(),$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").disable(),$$("resetFilterBtn").isEnabled()&&$$("resetFilterBtn").disable(),$$("table-editForm")&&$$("table-editForm").config.width<320&&($$("table-editForm").config.width=320,$$("table-editForm").refresh());let i=document.querySelector(".webix_btn-filter");i&&i.classList.contains("webix_primary")&&(i.classList.add("webix_secondary"),i.classList.remove("webix_primary")),$$("treeTempl")&&!$$(e)&&$$("treeTempl").hide(),r.forEach((function(e,t){0==$$("tree").getParentId(e)&&a.push(e)})),t.includes("single")&&(l=$$("tree").getSelectedItem().typeof),(e[0]&&0!==o||l)&&$$("webix__none-content").hide()}catch(e){console.log(e),s("009-000",e)}function c(e,t){try{return $$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),$$("user_auth")&&$$("user_auth").isVisible()&&$$("user_auth").hide(),$$("userprefs")&&$$("userprefs").isVisible()&&$$("userprefs").hide(),void 0!==t?a.forEach((function(o,r){o.includes("single")?e&&$$(e).hide():("treeTempl"!==t?async function(){let e;if(i.fields||await n("fields"),i.fields){let n=i.fields.content;e=!1,n[t]&&(e=!0,"dbtable"==n[t].type?$$("tables")&&$$("tables").show():"tform"==n[t].type?$$("forms")&&$$("forms").show():"dashboard"==n[t].type&&$$("dashboards")&&$$("dashboards").show(),function(e){$$("table-templateHeadline")&&i.tableNames.forEach((function(t,i){t.id==e&&$$("table-templateHeadline").setValues(t.name)})),$$("table-view-templateHeadline")&&i.tableNames.forEach((function(t,i){t.id==e&&$$("table-view-templateHeadline").setValues(t.name)}))}(t))}return e}().then((function(e){e||($$("webix__none-content").isVisible()&&$$("webix__none-content").hide(),$$("webix__null-content")||$$("container").addView({view:"align",align:"middle,center",id:"webix__null-content",body:{borderless:!0,template:"Блок в процессе разработки",height:50,width:220,css:{color:"#858585","font-size":"14px!important"}}},2))})):$$("webix__none-content").isVisible()||($$("webix__none-content").show(),$$("container").getChildViews().forEach((function(e,t){"webix__none-content"!==e.config.id&&0==e.config.hidden&&$$(e.config.id).hide()}))),o!==t&&$$(o)&&$$(o).hide())})):a.forEach((function(t,i){t.includes("single")?e&&$$(e).show():t==o?$$(t)?$$(t).show():$$("webix__null-content")||$$("container").addView({view:"align",align:"middle,center",id:"webix__null-content",body:{borderless:!0,template:"Блок в процессе разработки",height:50,width:220,css:{color:"#858585","font-size":"14px!important"}}},2):($$(t)||"treeTempl"==t)&&$$(t)&&$$(t).hide()}))}catch(e){console.log(e),s("009-000",e)}}try{"tables"==o||"dbtable"==l?c("tables"):"dashboards"==o||"dashboard"==l?c("dashboards"):"forms"==o||"tform"==l?($$("propTableView")&&$$("propTableView").isVisible()&&$$("propTableView").hide(),c("forms")):"user_auth"==o?c():0!=o||"tables"===t||"user_auth"===t||"dashboards"===t||"forms"===t||l?"treeTempl"==o&&c():c(!1,e[0]),"tables"==o||"dbtable"==l?(F(),0!==Object.keys($$("table-editForm").elements).length&&$$("inputsTable").hide(),$("table",e[0])):"dashboards"==o?p():"dashboard"==l?p(e[0],!0):"forms"==o||"tform"==l?$("table-view",e[0]):"treeTempl"==o&&f()}catch(e){console.log(e),s("009-000",e)}$$("table-templateHeadline")&&$$("table-templateHeadline").isVisible()?i.tableNames.forEach((function(e,t){e.id==$$("tree").getSelectedId()&&$$("table-templateHeadline").setValues(e.name)})):$$("table-view-templateHeadline")&&$$("table-view-templateHeadline").isVisible()&&i.tableNames.forEach((function(e,t){e.id==$$("tree").getSelectedId()&&$$("table-view-templateHeadline").setValues(e.name)}))},onItemClick:function(e,t,i){if($$("editTableFormProperty").config.dirty){try{w().then((function(t){1==t?($$("table-saveNewBtn").isVisible()?$$("table-saveNewBtn").hide():$$("table-saveBtn").isVisible()&&$$("table-saveBtn").hide(),$$("table-delBtnId").disable(),$$("editTableFormProperty")&&$$("editTableFormProperty").isVisible()&&($$("editTableFormProperty").clear(),$$("editTableFormProperty").hide()),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),$$("tree").select(e)):2==t&&($$("editTableFormProperty").getValues().id?(v(!1,!0),$$("tree").select(e)):(x(),$$("tree").select(e)),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),$$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable()),0!==t&&$$("propertyRefbtnsContainer")&&$$("propertyRefbtns").removeView($$("propertyRefbtnsContainer"))}))}catch(e){console.log(e),s("009-000",e)}return!1}},onBeforeSelect:function(e){if("tables"==$$("tree").getParentId(e)){if($$("filterTableForm")&&$$("filterTableForm").isVisible)try{$$("filterTableForm").hide(),$$("inputsFilter")&&$$("filterTableForm").removeView($$("inputsFilter"));let e=document.querySelector(".webix_btn-filter");e&&!e.classList.contains("webix_secondary")&&(e.classList.add("webix_secondary"),e.classList.remove("webix_primary")),$$("table-editTableBtnId").hide(),$$("table-editForm").show()}catch(e){console.log(e),s("009-000",e)}$$("propertyRefbtnsContainer")&&$$("propertyRefbtns").removeView($$("propertyRefbtnsContainer")),$$("editTableFormProperty")&&$$("editTableFormProperty").isVisible()&&$$("editTableFormProperty").hide()}!async function(){i.fields||await n("fields");let t=i.fields.content;Object.keys(t).forEach((function(i){i==e&&($$("webix__none-content").isVisible()&&$$("webix__none-content").hide(),$$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),"dbtable"==t[i].type?($$("tables")&&$$("tables").show(),$("table",e)):"tform"==t[i].type?($$("forms")&&$$("forms").show(),$("table-view",e)):"dashboard"==t[i].type&&($$("dashboards")&&$$("dashboards").show(),p(e)))}))}()},onBeforeOpen:function(e){const t=$$("tree").getItem(e);if(-1===$$("tree").getItem(e).$count){async function o(){i.fields||await n("fields");let o=i.fields.content,r=Object.keys(o);if(t.action.includes("all_")){let n=t.action.indexOf("_"),s=t.action.slice(n+1);a=s,r.forEach((function(t){o[t].type!=a||function(e){let t=!1;return i.mmenu.mmenu.forEach((function(i,n){i.name==e&&(t=!0)})),t}(t)||$$("tree").data.add({id:t,value:o[t].plural?o[t].plural:o[t].singular,type:o[t].type},0,e)}))}var a}o()}},onAfterSelect:function(e){!async function(){i.mmenu||await n("fields"),i.fields&&Backbone.history.navigate("tree/"+e,{trigger:!0})}(),window.innerWidth<850&&this.hide()}}}}console.log("expa 1.0.32");try{webix.ready((function(){webix.protoUI({name:"edittree"},webix.EditAbility,webix.ui.tree),webix.ui({view:"scrollview",type:"clean",id:"layout",css:"layoutContainer",scroll:"y",body:{cells:[{},{hidden:!0,id:"userAuth",cols:[{view:"align",align:"middle,center",body:(X(),{view:"form",id:"formAuth",width:250,borderless:!0,elements:[{view:"text",label:"Логин",name:"username",invalidMessage:"Поле должно быть заполнено",on:{onItemClick:function(){$$("formAuth").clearValidation()}}},{view:"text",label:"Пароль",name:"password",invalidMessage:"Поле должно быть заполнено",type:"password",on:{onItemClick:function(){$$("formAuth").clearValidation()}}},{view:"button",value:"Войти",css:"webix_primary",hotkey:"enter",align:"center",click:function(){let e=$$("formAuth").getValues(),i={};try{$$("formAuth").validate(),i.un=e.username,i.np=e.password,webix.ajax().post("/init/default/login",i,{success:function(e,i,n){webix.ajax("/init/default/api/whoami",{success:function(e,i,n){try{let e={};e.id=i.json().content.id,e.name=i.json().content.first_name,e.username=i.json().content.username,t("user",JSON.stringify(e)),$$("formAuth")&&$$("formAuth").clear(),Backbone.history.navigate("content",{trigger:!0}),window.location.reload()}catch(e){console.log(e),s("007-005",e)}},error:function(e,t,i){$$("formAuth")&&$$("formAuth").isDirty()&&($$("formAuth").markInvalid("username",""),$$("formAuth").markInvalid("password","Неверный логин или пароль")),l("007-006",i.status,i.statusText,i.responseURL)}}).then((function(e){webix.ajax().get("/init/default/api/userprefs/",{success:function(e,t,i){console.log("oeoe")},error:function(e,t,i){l("007-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("007-000",e.status,e.statusText,e.responseURL)}))}))},error:function(e,t,i){webix.message({type:"error",expire:3e3,text:"Не удалось выполнить выход"}),l("007-006",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("007-006",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),s("007-000",e)}}}],rules:{username:webix.rules.isNotEmpty,password:webix.rules.isNotEmpty},elementsConfig:{labelPosition:"top"}})}]},{hidden:!0,id:"mainLayout",rows:[{id:"mainContent",css:"webix_mainContent",cols:[{rows:[{view:"toolbar",id:"header",padding:10,css:"webix_header-style",elements:[{cols:[{view:"button",type:"icon",id:"collapseBtn",icon:"wxi-angle-double-left",css:"webix_collapse",title:"текст",height:45,width:40,click:function(){try{window.innerWidth>850?$$("tree").isVisible()?(this.config.icon="wxi-angle-double-right",this.refresh(),$$("tree").hide(),$$("sideMenuResizer")&&$$("sideMenuResizer").hide()):($$("tree").show(),this.config.icon="wxi-angle-double-left",this.refresh(),window.innerWidth>=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").show()):$$("tree").isVisible()?(this.config.icon="wxi-angle-double-right",this.refresh(),$$("tree").hide(),$$("sideMenuResizer")&&$$("sideMenuResizer").hide()):($$("tree").show(),console.log(window.innerHeight),$$("tree").config.width=window.innerWidth,$$("tree").resize(),this.config.icon="wxi-angle-double-left",this.refresh(),window.innerWidth>=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").show())}catch(e){console.log(e),s("009-000",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Видимость бокового меню")}}},{view:"label",label:"<img src='/init/static/images/expalogo.png' style='height:30px; margin: 10px;'>",height:30}]},{},{view:"search",placeholder:"Поиск",css:"searchTable",maxWidth:250,minWidth:40},{view:"button",id:"webix_log-btn",type:"icon",icon:"wxi-eye-slash",height:48,badge:0,width:60,css:"webix_log-btn",click:function(){1==this.getValue()?this.setValue(2):this.setValue(1)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть системные сообщения")},onChange:function(e,t,i){let n=$$("logBlock-list").getLastId();2==e?(this.config.badge="",$$("logBlock-list").showItem(n),$$("logLayout").config.height=90,$$("logLayout").resize(),this.config.icon="wxi-eye-slash",this.refresh()):($$("logLayout").config.height=5,$$("logLayout").resize(),this.config.icon="wxi-eye",this.refresh(),$$("webix_log-btn").config.badge="",$$("webix_log-btn").refresh())}}},{view:"button",id:"button-context-menu",type:"icon",disabled:!0,icon:"wxi-user",height:48,width:60,popup:{view:"contextmenu",id:"contextmenu",css:"webix_contextmenu",data:[],on:{onItemClick:function(e,t,i){function n(e){try{w().then((function(t){1==t?(Backbone.history.navigate(e,{trigger:!0}),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh()):2==t&&$$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty&&($$("editTableFormProperty").getValues().id?v(!1,!1,!0):x(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),Backbone.history.navigate(e,{trigger:!0}))}))}catch(e){console.log(e),s("005-000",e)}}try{if("logout"==e){if($$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty||$$("cp-form")&&$$("cp-form").isDirty()){try{w().then((function(e){if(1==e)Backbone.history.navigate("logout",{trigger:!0}),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh();else if(2==e&&($$("cp-form")||$$("editTableFormProperty")))if($$("cp-form")&&$$("cp-form").isDirty()&&$$("cp-form").validate()){let e={op:"",np:""},t=$$("cp-form").getValues();e.np=t.newPass,e.op=t.oldPass,webix.ajax().post("/init/default/api/cp",e,{success:function(e,t,i){"i"==(t=t.json()).err_type?o("success",t.err):"e"==t.err_type&&o("error",t.err)},error:function(e,t,i){l("011-000",i.status,i.statusText,i.responseURL)}}),Backbone.history.navigate("logout",{trigger:!0})}else{if(!$$("editTableFormProperty")||!$$("editTableFormProperty").config.dirty)return o("error","Заполните пустые поля"),!1;$$("editTableFormProperty").getValues().id?v(!1,!1,!0):x(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),Backbone.history.navigate("logout",{trigger:!0})}}))}catch(e){console.log(e),s("005-000",e)}return!1}Backbone.history.navigate("logout",{trigger:!0})}else"cp"==e?$$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty?n("cp"):Backbone.history.navigate("cp",{trigger:!0}):"userprefs"==e&&($$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty?n("userprefs"):Backbone.history.navigate("userprefs",{trigger:!0}))}catch(e){console.log(e),s("005-000",e)}}}},on:{onItemClick:function(){try{webix.ajax().get("/init/default/api/userprefs/",{success:function(e,i,n){if("e"==(i=i.json().content).err_type&&o("error",i.error),"/index.html/content"!==window.location.pathname&&"/init/default/spaw/content"!==window.location.pathname){let e=!1,n={};n.href=window.location.href;let r={name:"userLocationHref",prefs:n};try{i.forEach((function(t,i){"userLocationHref"==t.name&&(e=!0,webix.ajax().put("/init/default/api/userprefs/"+t.id,r,{success:function(e,t,i){"e"==(t=t.json()).err_type&&o("error",t.error)},error:function(e,t,i){l("005-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("005-011",e.status,e.statusText,e.responseURL)})))}))}catch(e){console.log(e),s("005-000",e)}try{if(!e){let e=webix.storage.local.get("user").id;e?r.owner=e:webix.ajax("/init/default/api/whoami",{success:function(e,i,n){r.owner=i.json().content.id;let o={};o.id=i.json().content.id,o.name=i.json().content.first_name,o.username=i.json().content.username,t("user",JSON.stringify(o))},error:function(e,t,i){l("005-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("005-000",e.status,e.statusText,e.responseURL)})),webix.ajax().post("/init/default/api/userprefs/",r,{success:function(e,t,i){"e"==(t=t.json()).err_type&&o("error",t.error)},error:function(e,t,i){l("005-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("005-001",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),s("005-000",e)}}},error:function(e,t,i){l("005-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("005-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),s("005-000",e)}}}}]},{id:"adaptive",rows:[]},{cols:[ee(),{id:"sideMenuResizer",view:"resizer",css:"webix_resizer-hide"},{id:"container",cols:[{view:"align",align:"middle,center",id:"webix__none-content",body:{borderless:!0,template:"Выберите элемент дерева",height:50,width:210,css:{color:"#858585","font-size":"14px!important"}}}]}]}]}]},{view:"resizer",id:"log-resizer"},a]}]}}),function(){function e(e,t=1.3){if($$(e)&&window.innerWidth/$$(e).$width<t&&$$(e).$width>100){let t=$$(e).$width-20;$$(e).config.width=t,$$(e).resize()}if($$(e)&&window.innerWidth/$$(e).$width>t){let t=$$(e).$width+20;$$(e).config.width=t,$$(e).resize()}}window.addEventListener("resize",(function(t){try{window.innerWidth<850&&$$("tree")&&$$("tree").isVisible()&&$$("tree").hide(),$$("tree").isVisible()||window.innerWidth<=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").hide(),window.innerWidth>850&&$$("tree")&&($$("tree").config.width=250,$$("tree").resize())}catch(e){console.log(e),s("017-007",e)}try{if(window.innerWidth<830&&!$$("contextActionsBtn")){if($$("customInputsMain")){const e=$$("table-view-filterIdView").getParentView();let t;t=Object.values($$("customInputs")._collection),t.forEach((function(e,t){e.bottomPadding=10,e.width&&delete e.width,e.minWidth&&delete e.minWidth,e.maxWidth&&delete e.maxWidth})),$$("customInputsMain").getParentView().removeView($$("customInputsMain")),t={id:"customInputsAdaptive",rows:[{id:"customInputs",rows:t}]},$$(e.config.id).addView({view:"button",id:"contextActionsBtnAdaptive",maxWidth:100,value:"Действия",css:"webix_primary",popup:webix.ui({view:"popup",css:"webix_popup-actions-container webix_popup-config",modal:!0,id:"contextActionsPopup",escHide:!0,position:"center",width:400,body:{rows:[{cols:[{template:"Доступные действия",css:"webix_template-actions",borderless:!0,height:40},{view:"button",id:"buttonClosePopupActions",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("contextActionsPopup")&&$$("contextActionsPopup").hide()}}]},{view:"scrollview",borderless:!0,scroll:"y",body:{id:"contextActionsPopupContainer",css:"webix_context-actions-popup",rows:[t]}}]}}),click:function(){$$("contextActionsPopup").config.height!==$$("customInputsAdaptive").$height+60&&($$("contextActionsPopup").config.height=$$("customInputsAdaptive").$height+60,$$("contextActionsPopup").resize())}},2)}}else if((window.innerWidth>830&&$$("contextActionsBtnAdaptive")||window.innerWidth>830&&$$("contextActionsBtn"))&&$$("customInputsAdaptive")){const e=$$("table-view-filterIdView").getParentView(),t={id:"customInputs",cols:$$("customInputsAdaptive")._collection[0].rows};$$("contextActionsBtnAdaptive")&&$$("contextActionsBtnAdaptive").getParentView().removeView($$("contextActionsBtnAdaptive")),$$("contextActionsPopup").destructor(),$$("customInputs")||$$(e.config.id).addView({id:"customInputsMain",cols:[t]},2)}e("contextActionsPopup")}catch(e){console.log(e),s("017-007",e)}try{if(window.innerWidth<850&&$$("dashboard-tool-main")&&$$("dashboard-tool-main").isVisible()){let e;$$("dashboard-tool-main").hide(),$$("dashboard-tool-main")&&(e=$$("dashboard-tool-main")._collection),$$("dashFilterBtn")||$$("dashboardInfoContainer").addView({id:"dashboard-tool-adaptive",cols:[{view:"button",id:"dashFilterBtn",value:"Фильтры",css:{margin:"10px 0px!important"},height:46,margin:10,popup:webix.ui({view:"popup",css:"webix_popup-dash-container webix_popup-config",modal:!0,id:"contextDashFilterPopup",escHide:!0,position:"center",body:{id:"contextDashFilterPopupContainer",rows:[]}}),click:function(){$$("contextDashFilterPopup").show(),$$("buttonClosePopupDashFilter")&&!$$("buttonClosePopupDashFilter").isVisible()&&$$("buttonClosePopupDashFilter").show()}}]},0),$$("dashboard-tool-main")&&$$("dashboard-tool-main").getParentView().removeView($$("dashboard-tool-main")),$$("dashToolInputsAdaptive")||($$("contextDashFilterPopupContainer").addView({id:"dashToolInputsAdaptive",rows:e}),$$("dashboard-tool-main")&&$$("dashboard-tool-main").getParentView().removeView($$("dashboard-tool-main")))}if(window.innerWidth>850&&$$("dashboard-tool-adaptive")){let e=$$("dashToolInputsAdaptive")._collection;$$("dashboard-tool-adaptive")&&$$("dashboard-tool-adaptive").getParentView().removeView($$("dashboard-tool-adaptive")),$$("contextDashFilterPopup")&&$$("contextDashFilterPopup").destructor(),$$("dashFilterBtn")&&$$("dashFilterBtn").getParentView().removeView($$("dashFilterBtn")),$$("dashboardTool").addView({id:"dashboard-tool-main",padding:20,minWidth:250,rows:e}),$$("buttonClosePopupDashFilter")&&$$("buttonClosePopupDashFilter").isVisible()&&$$("buttonClosePopupDashFilter").hide()}e("contextDashFilterPopupContainer")}catch(e){console.log(e),s("017-007",e)}try{window.innerWidth<1200&&($$("table-editTableBtnId")&&!$$("table-editTableBtnId").isVisible()&&$$("table-editTableBtnId").show(),$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide(),$$("table-editForm")&&$$("table-editForm").isDirty()&&($$("tableEditPopup")?($$("tableEditPopup").show(),$$("tableEditPopupContainer").getChildViews().length?($$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable(),$$("editTableBarContainer")&&$$("editTableBarContainer").show()):($$("tableEditPopupContainer").addView($$("editTableBarAdaptive")),$$("editTableBarHeadline")&&!$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").show())):(webix.ui({view:"popup",css:"webix_popup-table-container webix_popup-config",modal:!0,id:"tableEditPopup",escHide:!0,position:"center",body:{id:"tableEditPopupContainer",rows:[]}}).show(),$$("tableEditPopupContainer").addView($$("editTableBarAdaptive")),$$("editTableBarHeadline")&&!$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").show()),$$("table-saveNewBtn").isEnabled()&&$$("table-newAddBtnId").isEnabled()?$$("table-newAddBtnId").disable():$$("table-newAddBtnId").enable()),e("editFilterBarAdaptive",1.5)),window.innerWidth>1200&&($$("tableEditPopup")&&$$("tableEditPopup").hide(),$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()||$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()||($$("editTableBarContainer")&&!$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").show(),$$("filterTableForm")&&$$("filterTableForm").hide(),$$("table-editForm")&&$$("table-editForm").show()),$$("editTableBarContainer")&&$$("editTableBarContainer").addView($$("editTableBarAdaptive")),$$("editTableBarAdaptive")&&!$$("editTableBarAdaptive").isVisible()&&$$("editTableBarAdaptive").show(),$$("table-editTableBtnId")&&$$("table-editTableBtnId").isVisible()&&$$("table-editTableBtnId").hide(),$$("editTableBarAdaptive")&&($$("editTableBarAdaptive").config.width=350,$$("editTableBarAdaptive").resize()),$$("editTableBarHeadline")&&$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").hide()),e("editTableBarAdaptive",1.5)}catch(e){console.log(e),s("017-007",e)}try{if(window.innerWidth<1200){let t=document.querySelector(".webix_btn-filter");if(t&&t.classList.contains("webix_primary")&&(t.classList.add("webix_secondary"),t.classList.remove("webix_primary")),$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").hide(),$$("filterTableForm")&&$$("filterTableForm").isDirty()){let e;$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide(),$$("tableFilterPopup")&&$$("tableFilterPopup").show(),$$("tableFilterPopupContainer")&&!$$("tableFilterPopupContainer").isVisible()&&$$("tableFilterPopupContainer").show(),$$("filterTableForm").getValues()&&(e=$$("filterTableForm").getValues()),$$("tableFilterPopupContainer")&&$$("tableFilterPopupContainer").addView($$("editFilterBarAdaptive")),$$("editFilterBarHeadline")&&!$$("editFilterBarHeadline").isVisible()&&$$("editFilterBarHeadline").show(),$$("filterTableForm").show(),e&&($$("filterTableForm").setValues(e),$$("filterTableForm").setDirty(),e=null)}e("popupFilterEdit",1.5)}if(window.innerWidth>1200&&$$("tableFilterPopup").isVisible()){let e;$$("tableFilterPopup").hide(),$$("filterTableForm").getValues()&&(e=$$("filterTableForm").getValues()),"filterTableBarContainer"!==$$("editFilterBarAdaptive").getParentView().config.id&&$$("filterTableBarContainer").addView($$("editFilterBarAdaptive")),$$("editFilterBarHeadline")&&$$("editFilterBarHeadline").hide(),$$("editFilterBarAdaptive").config.width=350,$$("editFilterBarAdaptive").resize();let t=document.querySelector(".webix_btn-filter");$$("filterTableBarContainer")&&!$$("filterTableBarContainer").isVisible()&&($$("filterTableForm").show(),$$("table-editForm").hide(),e&&($$("filterTableForm").setValues(e),e=null),t.classList.add("webix_primary"),t.classList.remove("webix_secondary"),$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide(),$$("filterTableBarContainer")&&!$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").show())}}catch(e){console.log(e),s("017-007",e)}}),!0)}(),window.location.host.includes("localhost:3000")?Backbone.history.start({pushState:!0,root:"/index.html/"}):Backbone.history.start({pushState:!0,root:"/init/default/spaw/"}),function(){try{window.innerWidth<850&&$$("tree")&&$$("tree").isVisible()&&$$("tree").hide(),window.innerWidth<1200&&($$("tree").attachEvent("onAfterLoad",(function(){$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide()})),$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide()),$$("tableFilterPopup")||webix.ui({view:"popup",css:"webix_popup-table-container webix_popup-config",modal:!0,id:"tableFilterPopup",escHide:!0,position:"center",body:{id:"tableFilterPopupContainer",rows:[]}})}catch(e){console.log(e),s("017-007",e)}}(),function(){let e=null;webix.event(document.body,"mousedown",(t=>{const i=$$(t);i&&i.getInputNode&&(e=i)})),webix.event(document,"click",(t=>{const i=$$(t);e&&i&&i.config.id!==e.config.id&&(t.cancelBubble=!0,webix.html.preventEvent(t)),e=null}),{capture:!0})}(),function(){webix.ajax("/init/default/api/userprefs/",{success:function(e,i,n){try{let e=webix.storage.local.get("user");if(i=i.json().content,e&&(i.forEach((function(i,n){i.owner==e.id&&t(i.name,i.prefs)})),"/index.html/content"==window.location.pathname||"/init/default/spaw/content"==window.location.pathname)){let e=webix.storage.local.get("userprefsWorkspaceForm"),t=webix.storage.local.get("userLocationHref");const i=new URL(t.href);e&&e.LoginActionOpt&&i.origin==window.location.origin&&2==e.LoginActionOpt&&t&&t.href&&t.href!==window.location.href&&window.location.replace(t.href)}}catch(e){console.log(e),s("010-000",e)}},error:function(e,t,i){l("010-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("010-000",e.status,e.statusText,e.responseURL)}));let e=webix.storage.local.get("userprefsWorkspaceForm");try{e&&void 0!==e.logBlockOpt&&("2"==e.logBlockOpt?($$("logLayout").config.height=5,$$("logLayout").resize(),$$("webix_log-btn").config.icon="wxi-eye",$$("webix_log-btn").refresh()):"1"==e.logBlockOpt&&($$("logLayout").config.height=90,$$("logLayout").resize(),$$("webix_log-btn").config.icon="wxi-eye-slash",$$("webix_log-btn").refresh()))}catch(e){console.log(e),s("010-000",e)}}(),window.addEventListener("popstate",(function(e){window.location.replace(window.location.href),window.location.reload()})),function(){let e;function t(){webix.ajax().get("/init/default/api/userprefs/",{success:function(e,t,i){if("e"==(t=t.json().content).err_type&&o("error",t.error),"/index.html/content"!==window.location.pathname){let e=!1,i={};i.href=window.location.href;let n={name:"userLocationHref",prefs:i};try{t.forEach((function(t,i){"userLocationHref"==t.name&&(e=!0,webix.ajax().put("/init/default/api/userprefs/"+t.id,n,{success:function(e,t,i){"e"==(t=t.json()).err_type&&o("error",t.error)},error:function(e,t,i){l("008-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("008-011",e.status,e.statusText,e.responseURL)})))}))}catch(e){console.log(e),s("008-000",e)}try{if(!e){let e=webix.storage.local.get("user").id;e?n.owner=e:webix.ajax("/init/default/api/whoami",{success:function(e,t,i){n.owner=t.json().content.id;let o={};o.id=t.json().content.id,o.name=t.json().content.first_name,o.username=t.json().content.username},error:function(e,t,i){l("008-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("008-000",e.status,e.statusText,e.responseURL)})),webix.ajax().post("/init/default/api/userprefs/",n,{success:function(e,t,i){"e"==(t=t.json()).err_type&&o("error",t.error)},error:function(e,t,i){l("008-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("008-001",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),s("008-000",e)}}},error:function(e,t,i){l("008-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("008-000",e.status,e.statusText,e.responseURL)})).then((function(e){Backbone.history.navigate("logout",{trigger:!0})}))}function i(){try{"/index.html"!==window.location.pathname&&"/"!==window.location.pathname&&"/init/default/spaw"!==window.location.pathname&&(clearTimeout(e),e=setTimeout(t,6e5))}catch(e){console.log(e),s("008-000",e)}}window.onload=i,window.onmousemove=i,window.onmousedown=i,window.ontouchstart=i,window.onclick=i,window.onkeypress=i,window.addEventListener("scroll",i,!0)}(),webix.message.position="bottom",webix.i18n.setLocale("ru-RU"),webix.i18n.parseFormat="%d.%m.%Y %H:%i:%s",webix.i18n.setLocale()}))}catch(e){console.log(e),alert("Ошибка при выполнении "+e),s("007-005",e)}})();