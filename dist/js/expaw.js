(()=>{"use strict";function t(t,e){"undefined"!=typeof Storage&&localStorage.setItem(t,e)}function e(t,e){function n(){t&&t.href&&t.href!==window.location.href&&window.location.replace(t.href)}try{e?2==e.LoginActionOpt&&n():n()}catch(t){w(t,"storageSettings","setLoginActionPref")}}function n(){if("/index.html/content"==window.location.pathname||"/init/default/spaw/content"==window.location.pathname){const t=webix.storage.local.get("userprefsWorkspaceForm"),n=webix.storage.local.get("userLocationHref"),i=webix.storage.local.get("outsideHref");if(i){const n=new URL(i.href);n.origin!=window.location.origin||n.pathname.includes("logout")||e(i,t)}else{const i=new URL(n.href);(t&&t.LoginActionOpt||!t)&&(i.origin!=window.location.origin||i.pathname.includes("logout")||e(n,t))}}}function i(){const t=webix.storage.local.get("userprefsWorkspaceForm"),e=$$("logLayout"),n=$$("webix_log-btn");try{t&&void 0!==t.logBlockOpt&&("2"==t.logBlockOpt?(e.config.height=5,n.config.icon="icon-eye",n.setValue(1)):"1"==t.logBlockOpt&&(e.config.height=90,n.config.icon="icon-eye-slash",n.setValue(2)),e.resize(),n.refresh())}catch(t){w(t,"storageSettings","userprefsWorkspace")}}function o(){const t=webix.ajax().get("/init/default/api/userprefs/");t.then((function(t){"i"!==(t=t.json()).err_type&&w(t.err,"autoLogout","putUserPrefs");const e={};t=t.content,e.href=window.location.href;const n={name:"userLocationHref",prefs:e};"/index.html/content"!==window.location.pathname&&(function(t,e){let n=!1;try{t.forEach((function(t,i){"userLocationHref"==t.name&&(n=!0,function(t,e){const n="/init/default/api/userprefs/"+t,i=webix.ajax().put(n,e);i.then((function(t){"i"!==(t=t.json()).err_type&&p("error",t.err)})),i.fail((function(t){g(t,"autoLogout","putUserPrefs")}))}(t.id,e))}))}catch(t){w(t,"autoLogout","putUserPrefs")}return n}(t,n)||(n.owner=function(){const t=webix.storage.local.get("user").id;let e;try{if(t)e=t;else{const t=webix.ajax("/init/default/api/whoami");t.then((function(t){t=t.json().content,e=t.id;const n={};n.id=t.id,n.name=t.first_name,n.username=t.username})),t.fail((function(t){g(t,"autoLogout","getWhoamiData")}))}}catch(t){w(t,"autoLogout","getWhoamiData")}return e}(),function(){const t=webix.ajax().post("/init/default/api/userprefs/",n);t.then((function(t){"i"!==(t=t.json()).err_type&&w(t.err,"autoLogout","putUserPrefs")})),t.fail((function(t){g(t,"autoLogout","postUserPrefs")}))}()))})),t.then((function(t){Backbone.history.navigate("logout",{trigger:!0}),Backbone.history.navigate("/",{trigger:!0})})),t.fail((function(t){g(t,"autoLogout","logout")}))}const r={};function s(e){if("/index.html"!==window.location.pathname&&"/init/default/spaw"!==window.location.pathname||"whoami"==e)return webix.ajax().get(`/init/default/api/${e}.json`).then((function(t){r[e]=t.json();try{"fields"==e&&r[e]&&(r.tableNames=function(t){let e=[];try{Object.values(t).forEach((function(n,i){e.push({id:Object.keys(t)[i],name:n.plural?n.plural:n.singular})}))}catch(t){w(t,"globalStorage","getTableNames")}return e}(r[e].content))}catch(t){w(t,"globalStorage","getData")}return r[e]})).catch((e=>{console.log(e),console.log("globalStorage function getData"),function(e){if(401===e.status&&"/index.html"!==window.location.pathname&&"/init/default/spaw/"!==window.location.pathname){const e={href:window.location.href};t("outsideHref",JSON.stringify(e)),Backbone.history.navigate("/",{trigger:!0})}}(e)}))}class c{static async content(t){const e=this;if(!e[t]){const n=`/init/default/api/${t}.json`;return webix.ajax().get(n).then((function(n){e[t]=n.json()})).fail((function(t){}))}}}class a extends c{constructor(){super()}static get content(){if(this.mmenu)return this.mmenu.mmenu}}class l extends c{constructor(){super()}static attribute(t,e){if(this.fields&&this.fields.content[t])return this.fields.content[t][e]}static item(t){if(this.fields)return this.fields.content[t]}static get keys(){if(this.fields)return Object.keys(this.fields.content)}static get values(){if(this.fields)return Object.values(this.fields.content)}static get names(){const t=this.values,e=this.keys;if(this.fields){const n=[];try{t.forEach((function(t,i){n.push({id:e[i],name:t.plural?t.plural:t.singular})}))}catch(t){w(t,"globalStorage","getTableNames")}return n}}}let u,f,d;async function h(t){let e;"version"==t?e="Expa v1.0.55":"cp"==t?e="Смена пароля":(await c.content("fields"),l.keys&&function(){const n=l.names;try{n.forEach((function(n,i){n.id==t&&(e=n.name)}))}catch(t){w(t,"logBlock","findTableName")}}()),function(t){const e=$$("logBlock-list"),n=function(){const t=new Date;return`${t.getDate()}.${String(t.getMonth()+1).padStart(2,"0")}.${t.getFullYear()} ${t.getHours()}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`}();t||(t="expa"),e.add({date:n,value:d,src:t});const i=e.getLastId();e.showItem(i)}(e)}function p(t,e,n){u=t,f=n,d=e,function(){try{let t=null;const e=$$("tree");if(e&&e.getSelectedItem())t=e.getSelectedItem().id;else{const e=window.location.pathname,n=e.lastIndexOf("/");t=e.slice(n+1)}f?h(f):t&&h(t)}catch(t){w(t,"logBlock","initLogMsg")}}()}let m=0;const b={id:"logLayout",height:80,rows:[{template:"<div class='webix_log-headline'>Системные сообщения</div>",height:30},{id:"logBlock-list",css:"webix_log-block",view:"list",template:"#date# — #value#  (Источник: #src#)",data:[],on:{onAfterLoad:function(){p("success","Интерфейс загружен","version")},onAfterAdd:function(e){const n=$$("webix_log-btn");"icon-eye"==n.config.icon?function(t){try{""==t.config.badge&&(m=0),m++,t.config.badge=m,t.setValue(1),t.refresh()}catch(t){w(t,"logBlock","onAfterAdd addNotify")}}(n):"icon-eye-slash"==n.config.icon&&function(t){try{m=0,t.config.badge="",t.setValue(2),t.refresh()}catch(t){w(t,"logBlock","onAfterAdd clearNotify")}}(n),function(e){if("error"==u){try{$$("logBlock-list").getItemNode(e).style.setProperty("color","red","important")}catch(t){w(t,"logBlock","addErrorStyle")}!function(){try{const e=$$("logLayout"),n=$$("webix_log-btn");"icon-eye"==n.config.icon&&(e.config.height=90,e.resize(),n.setValue(2),n.config.icon="icon-eye-slash",n.refresh(),t("LogVisible",JSON.stringify("show")))}catch(t){w(t,"logBlock","openLog")}}()}}(e)}}}]};function g(t,e,n){400===t.status||401===t.status||404===t.status?p("error",e+" function "+n+": "+t.status+" "+t.statusText+" "+t.responseURL+" ("+t.responseText+") "):(p("error",e+" function "+n+": "+t.status+" "+t.statusText+" "+t.responseURL+" ("+t.responseText+") ","version"),window.alert("Ошибка. Статус: "+t.status+". Отсутствует соединение с сервером."))}function w(t,e,n){console.log(t),p("error",e+" function "+n+": "+t)}let $;function v(){let t;try{const e=$$("table"),n=$$("table-view");$$("tables").isVisible()?(t=e.config.idTable,$=e):$$("forms").isVisible()&&(t=n.config.idTable,$=n)}catch(t){w(t,"commonFunctions","getItemId")}return t}function y(){return v(),$}class x{static hideItem(t){t&&t.hide()}static showItem(t){t&&t.show()}static removeItem(t){t&&t.getParentView().removeView(t)}static disableItem(t){t&&t.isEnabled()&&t.disable()}static enableItem(t){t&&!t.isEnabled()&&t.enable()}}function I(t){const e="/init/default/api/"+t;return new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get(e).then((function(t){t=t.json().content;const e=[];let n;return function(){try{t.forEach(((t,i)=>{!function(t,e){try{for(;t<=Object.values(e).length;){if("string"==typeof Object.values(e)[t]){n=Object.keys(e)[t];break}t++}}catch(t){w(t,"commonFunctions","getComboOptions => stringOption")}}(0,t),function(t,i){try{if(null==i[n])for(;t<=Object.values(i).length;){if("number"==typeof Object.values(i)[1]){n=Object.keys(i)[1];break}t++}e.push({id:i.id,value:i[n]})}catch(t){w(t,"commonFunctions","getComboOptions => numOption")}}(0,t)}))}catch(t){w(t,"commonFunctions","getComboOptions => createComboValues")}}(),e})).catch((t=>{g(t,"commonFunctions","getComboOptions")}))}}})}function C(){const e=webix.ajax("/init/default/api/whoami");e.then((function(e){const n=e.json();e=e.json().content;const i={};i.id=e.id,i.name=e.first_name,i.username=e.username,t("user",JSON.stringify(i)),"i"!==n.err_type&&w(n,"commonFunctions","function getUserData")})),e.fail((function(t){g(t,"favsLink","btnSaveLpostContentinkClick => getUserData")}))}const k={id:"dashboardTool",css:"webix_dashTool",minWidth:200,width:350,hidden:!0,rows:[]};function E(t){return webix.confirm({width:300,ok:"Да",cancel:"Отмена",title:t,text:"Вы уверены, что хотите продолжить?"})}function S(t,e,n){return t||e||n?webix.modalbox({title:t,css:"webix_modal-custom-save",buttons:n,width:500,text:e}):webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"})}const V="table => btnsIntable";function T(t,e,n=!1){return{view:"datatable",id:t,css:"webix_table-style webix_header_border webix_data_border",autoConfig:!0,editable:n,editaction:"dblclick",minHeight:350,footer:!0,select:!0,resizeColumn:!0,sort:[],offsetAttr:80,on:e,onClick:{"wxi-trash":function(e,n,i){!function(t,e){E("Запись будет удалена").then((function(n){n&&function(){const n=$$(e),i=n.getItem(t.row),o="/init/default/api/"+v()+"/"+i.name+".json",r=webix.ajax().del(o,i);r.then((function(t){if("i"==(t=t.json()).err_type){try{const t=n.getSelectedId();n.remove(t)}catch(t){w(t,V,"wxi-trash => delData")}p("success","Данные успешно удалены")}else p("error",t.err)})),r.fail((function(t){g(t,V,"wxi-trash => delElem")}))}()}))}(n,t)},"wxi-angle-down":function(t,e,n){!function(t){const e=$$("propTableView");e.isVisible()?x.hideItem(e):function(){const n=function(){let e;try{const n=t.row;$$("table-view").getColumns().forEach((function(i,o){if(i.id==t.column){e=i.src;let t=e.search("{");e=e.slice(0,t)+n+".json"}}))}catch(t){w(t,V,"wxi-angle-down => createUrl")}return e}(),i=webix.ajax(n);i.then((function(t){t=t.json().content,function(){const n=[];try{t.forEach((function(t,e){n.push({type:"text",id:e+1,label:t.name,value:t.value})})),e.define("elements",n)}catch(t){w(t,V,"wxi-angle-down => setProps")}}(),function(){const t=document.querySelector(".webix_btn-filter"),e="webix-transparent-btn--primary";x.hideItem($$("formsTools")),t.classList.contains(e)&&(t.classList.add("webix-transparent-btn"),t.classList.remove(e))}(),x.showItem(e),function(){try{e.config.width<200&&(e.config.width=200,e.resize())}catch(t){w(t,V,"wxi-angle-down => resizeProp")}}()})),i.fail((function(t){g(t,V,"wxi-angle-down => getProp")}))}()}(e)}},ready:function(){const t=this.getColumns()[0];this.markSorting(t.id,"asc")}}}const B="tableEditForm => property";function j(t=!1){try{const e=$$("editTableFormProperty");e&&(e.config.dirty=t,e.refresh())}catch(t){w(t,B,"setDirtyProperty")}}function A(t,e){try{const n=$$("editTableFormProperty");n.getItem(t).value=e,n.updateItem(t),j(!0)}catch(t){w(t,B,"editingEnd")}}const F={view:"property",id:"editTableFormProperty",css:"webix_edit-table-form-property",dirty:!1,editable:!0,tooltip:function(t){const e="Название: "+t.label+" <br>",n=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s");let i,o;return o="date"==t.type?"Выберите дату":"combo"==t.type?"Выберите значение":"integer"==t.customType?"Введите число":"Введите текст",i="date"==t.type?n(t.value):t.value,t.value?e+"Значение: "+i:e+o},hidden:!0,elements:[],on:{onEditorChange:function(t,e){A(t,e),function(){const t=$$("table-saveBtn");t&&t.isVisible()&&!t.isEnabled()&&t.enable()}(),document.getElementById("custom-date-editor")&&document.getElementById("custom-date-editor").addEventListener("input",(function(t){const e=t.target.value.replace(/\D/g,"").match(/(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})/);function n(t){return e[t]?e[t]:" __ "}"deleteContentBackward"!==t.inputType&&(t.target.value=n(1)+"."+n(2)+"."+n(3)+"  "+n(4)+":"+n(5)+":"+n(6))}))},onBeforeRender:function(){const t=28*this.config.elements.length;t&&this.$height!==t&&(this.define("height",t),this.resize())},onAfterEditStop:function(t,e){t.value!==t.old&&A(e.id,t.value)},onItemClick:function(t){const e=$$("editTableFormProperty");e.getItem(t).css="",e.refresh()}}},O={scroll:"y",cols:[{cols:[{id:"propertyRefbtns",rows:[]},{width:5}]},{width:4},F,{width:4}]},P="tableEditForm => validation";function L(){const t={},e=[],n=$$("editTableFormProperty");try{Object.keys(n.getValues()).forEach((function(e,i){const o=n.getItem(e),r=n.getValues();t[e]={},function(){if(o.type&&"customDate"==o.type){let n=!1,i=0;const o=r[e].replace(/\D/g,"").match(/(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})/);for(let t=1;t<7;t++)0==o[t].length&&i++,2!==o[t].length&&(n||(n=!0));6==i?t[e].date=null:((o[1]>31||o[1]<1||o[2]>12||o[2]<1||o[4]>23||o[5]>59||o[6]>59)&&(n=!0),t[e].date=n?"Неверный формат даты. Введите дату в формате xx.xx.xx xx:xx:xx":null)}}(),function(){if(o.customType&&"integer"==o.customType){const i=(n=r[e],/\D/.test(n));t[e].isNum=i?"Данное поле должно содержать только числа":null}var n}(),function(){try{r[e]&&(r[e].length>o.length&&0!==o.length?t[e].length="Длина строки не должна превышать "+o.length+" симв.":t[e].length=null)}catch(t){w(t,P,"valLength")}}(),function(){try{1==o.notnull&&0==r[e].length?t[e].notnull="Поле не может быть пустым":t[e].notnull=null}catch(t){w(t,P,"valNotNull")}}(),function(){try{if(t[e].unique=null,1==o.unique){const n=Object.values($$("table").data.pull),i=$$("editTableFormProperty").getValues().id;n.forEach((function(n,o){function s(t){return t&&"number"==typeof t?t.toString():t}n[e]=s(n[e]),r[e]=s(r[e]),n[e]&&"number"==typeof n[e]&&(n[e]=n[e].toString()),r[e]&&n[e]&&(0!=r[e].localeCompare(n[e])&&n.id!=i.toString()||(t[e].unique="Поле должно быть уникальным"))}))}}catch(t){w(t,P,"valUnique")}}()})),Object.values(t).forEach((function(n,i){Object.values(n).forEach((function(o,r){if(null!==o){let s=Object.keys(t)[i],c=o,a=Object.keys(n)[r];e.push({nameCol:s,typeError:a,textError:c})}}))}))}catch(t){w(t,P,"validateProfForm")}return e.length&&e.forEach((function(t){n.getItem(t.nameCol).css="propery-error",n.refresh()})),e}function N(){try{const t=$$("table");L().forEach((function(e){let n;t.getColumns(!0).forEach((function(t){t.id==e.nameCol&&(n=t.label)})),p("error",e.textError+" (Поле: "+n+")")}))}catch(t){w(t,P,"setLogError")}}class D{constructor(t){this.buttonView={view:"button",height:42,on:{}},this.options=t.config,this.values=Object.values(this.options),this.keys=Object.keys(this.options),this.adaptValue=t.adaptValue,this.title=t.titleAttribute,this.onFunc=t.onFunc,this.css=t.css}modifyTitle(t){this.title=this.title+" ("+this.values[t]+")"}setAdaptiveValue(t,e,n){const i=t.$width;i<120&&t.config.value!==e?(t.config.value=e,t.refresh()):i>120&&t.config.value!==n&&(t.config.value=n,t.refresh())}addOnFunctions(t){const e=this;if(this.onFunc){const e=Object.keys(this.onFunc),n=Object.values(this.onFunc);e.forEach((function(e,i){t.on[e]=n[i]}))}t.on.onAfterRender=function(){this.getInputNode().setAttribute("title",e.title),e.adaptValue&&e.setAdaptiveValue(this,e.adaptValue,e.options.value)}}addCss(t){const e=this.buttonView,n=this.css||"";"primary"==t?e.css="webix_primary ":"delete"==t?e.css="webix_danger ":(e.css=t||"",e.css=e.css+" "+n||"")}addConfig(){const t=this.buttonView,e=this.values,n=this;return this.keys.forEach((function(i,o){t[i]=e[o],"hotkey"===i&&n.modifyTitle(o)})),this.addOnFunctions(t),t}maxView(t){return this.addCss(t),this.addConfig()}minView(t){this.addCss(t);const e=this.buttonView;return e.width=50,e.type="icon",this.addConfig()}transparentView(){this.addCss("webix-transparent-btn");const t=this.buttonView;return t.width=50,t.type="icon",this.addConfig()}}function R(t,e){const n={css:"webix_empty-template",template:t,borderless:!0,height:47};return e&&(n.id=e),n}webix.uid();const W="tableEditForm => buttons";function z(t){const e=Object.values(t),n=Object.keys(t),i=t;return n.forEach((function(t,n){const o=$$("editTableFormProperty").getItem(t),r=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s");"customDate"==o.type&&(i[t]=r(e[n]))})),i}function H(t){return $$("table").getColumns().forEach((function(e,n){t[e.id]&&"boolean"==e.type&&(2==t[e.id]?t[e.id]=!1:t[e.id]=!0)})),t}function M(t=!1,e=!1){try{const n=$$("editTableFormProperty").getValues(),i=v();if(L().length)L().forEach((function(t,e){N()}));else if(n.id){const o="/init/default/api/"+i+"/"+n.id,r=$$("table-editForm"),s=$$("editTableFormProperty"),c=$$("table-newAddBtnId"),a=$$("EditEmptyTempalte"),l=$$("tableContainer"),u=function(t){const e={};try{const n=$$("table");Object.values(t).forEach((function(i,o){const r=n.getItem(t.id),s=Object.keys(r);!function(){const n=Object.keys(t)[o];s.forEach((function(i){i==n&&r[i]!==Object.values(t)[o]&&(e[n]=Object.values(t)[o])}))}()}))}catch(t){w(t,P,"uniqueData")}return e}(n),f=H(z(u)),d=webix.ajax().put(o,f);d.then((function(o){"i"==(o=o.json()).err_type?(e||(function(t){try{const e=$$("table");e.updateItem(t.id,t),e.clearSelection(),ct()}catch(t){w(t,W,"saveItem => updateWorkspace")}}(n),x.hideItem(r)),t?(x.showItem(s),function(){const t=$$("table"),e=$$("table-delBtnId"),n=$$("table-saveBtn"),i=$$("table-saveNewBtn");try{t.filter(!1),st("table-editForm"),e.disable(),n.hide(),i.show()}catch(t){w(t,W,"saveItem => addNewStateSpace")}}(),x.hideItem(a)):(c.enable(),function(t){try{t.config.dirty=!1,t.refresh()}catch(t){w(t,W,"saveItem => setDirtyProp")}}(s)),x.showItem(l),window.innerWidth<850&&r.hide(),p("success","Данные сохранены",i)):p("error",W+" function saveItem: "+o.err)})),d.fail((function(t){g(t,W,"saveItem")}))}}catch(t){w(t,W,"saveItem")}}function U(){const t=v();if(L().length)N();else{const e=$$("table-editForm"),n=$$("editTableFormProperty"),i=n.getValues(),o=function(t){const e=Object.values(t),n=Object.keys(t),i={};return e.forEach((function(e,o){e&&(i[n[o]]=e),z(t)})),i}(i),r=H(z(o)),s=webix.ajax().post("/init/default/api/"+t,r);s.then((function(o){if(null!==(o=o.json()).content.id)if("i"==o.err_type){try{i.id=o.content.id,i.id<=$$("table").config.offsetAttr&&$$("table").add(i),function(){try{const t=$$("table-findElements"),e=+t.getValues()+1;t.setValues(e.toString())}catch(t){w(t,W,"setCounterVal")}}(),ct(),function(){try{n.config.dirty=!1,n.refresh()}catch(t){w(t,W,"saveNewItem => setDirtyProp")}}(),$$("table-newAddBtnId").enable(),x.hideItem(e),x.showItem($$("tableContainer")),window.innerWidth<850&&e.hide()}catch(t){w(t,W,"saveNewItem")}p("success","Данные успешно добавлены",t)}else console.log(o),p("error",W+" function saveNewItem: "+o.err);else{let t=o.content.errors,e="";Object.values(t).forEach((function(n,i){e+=n+" (Поле: "+Object.keys(t)[i]+"); "})),p("error","editTableForm function saveNewItem: "+e)}})),s.fail((function(t){g(t,"tableEditForm => btns","saveNewItem")}))}}const q=new D({config:{id:"table-newAddBtnId",hotkey:"Alt+A",disabled:!0,value:"Новая запись",click:function(){const t=$$("EditEmptyTempalte"),e=$$("editTableFormProperty"),n=$$("table");function i(){try{n.filter(!1),n.clearSelection(),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show(),$$("table-newAddBtnId").disable(),st("table-editForm"),x.hideItem(t)}catch(t){w(t,W,"addItem => setWorkspaceState")}}function o(){try{e.config.dirty=!1,e.refresh()}catch(t){w(t,W,"addItem => setDirtyProp")}}try{1==e.config.dirty?S().then((function(e){1==e?(i(),o()):2==e&&(M(!0),o(),x.hideItem(t))})):(x.showItem(e),e.clear(),i(),n.hideOverlay("Ничего не найдено"))}catch(t){w(t,W,"addItem")}}},titleAttribute:"Добавить новую запись",adaptValue:"+"}).maxView(),J=new D({config:{id:"table-delBtnId",hotkey:"Ctrl+Enter",disabled:!0,icon:"icon-trash",click:function(){try{const t=v();E("Запись будет удалена").then((function(){const e=$$("editTableFormProperty").getValues(),n=$$("table"),i=n.getSelectedId().id;n&&n.remove(i);const o="/init/default/api/"+t+"/"+e.id+".json",r=webix.ajax().del(o,e);r.then((function(t){"i"==(t=t.json()).err_type?(ct(),j(),x.showItem($$("tableContainer")),window.innerWidth<850&&$$("table-editForm").hide(),p("success","Данные успешно удалены")):p("error","editTableForm function removeItem: "+t.err)})),r.fail((function(t){g(t,W,"removeItem")}))}))}catch(t){w(t,W,"removeItem")}}},titleAttribute:"Удалить запись из таблицы"}).minView("delete"),Y=new D({config:{id:"table-saveBtn",hotkey:"Shift+Space",hidden:!0,value:"Сохранить",click:function(){M()}},titleAttribute:"Сохранить запись в таблицу"}).maxView("primary"),K=new D({config:{id:"table-saveNewBtn",hotkey:"Ctrl+Shift+Space",hidden:!0,value:"Сохранить",click:function(){U()}},titleAttribute:"Сохранить новую запись в таблицу"}).maxView("primary"),G=new D({config:{id:"table-backTableBtn",hotkey:"Shift+Q",hidden:!0,icon:"icon-arrow-left",click:function(){const t=$$("table-editForm"),e=$$("tableContainer"),n=$$("editTableFormProperty"),i=$$("table");function o(){x.hideItem(t),x.showItem(e),i&&i.clearSelection()}n.config.dirty?S().then((function(t){1!=t&&2!=t||(1==t?o():2==t&&(n.getValues().id?(M(),o()):U()),j())})):o()}},titleAttribute:"Вернуться к таблице"}).minView(),Q={minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{cols:[{id:"tablePropBtnsSpace",width:35,hidden:!0},{rows:[{margin:5,rows:[{margin:2,cols:[G,q,J]}]},{margin:10,rows:[Y,K,{id:"EditEmptyTempalte",rows:[{height:20},R("Добавьте новую запись или выберите существующую из таблицы")]}]}]}]}]};class X{constructor(t){this.elements=t.elements,this.headline={template:"<div class='no-wrap-headline'>"+t.headline+"</div>",css:"webix_popup-headline",borderless:!0,height:40},this.closeBtn={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){if(t.closeClick)t.closeClick();else{const e=$$(t.config.id);e&&e.destructor()}}},this.popupView={view:"popup",css:"webix_popup-config",modal:!0,escHide:!0,position:"center",body:{scroll:"y",rows:[{css:"webix_popup-headline-wrapper",cols:[this.headline,this.closeBtn,{width:12}]},this.elements]}},this.options=t.config,this.id=t.config.id,this.values=Object.values(this.options),this.keys=Object.keys(this.options)}addConfig(){const t=this.popupView,e=this.values;return this.keys.forEach((function(n,i){t[n]=e[i]})),t}createView(){const t=this.popupView,e=this.values;return this.keys.forEach((function(n,i){t[n]=e[i]})),webix.ui(this.addConfig())}showPopup(){$$(this.id).show()}}const Z="tableEditForm => states";function tt(t){try{const e=t;e&&e.destructor()}catch(t){w(t,Z,"destructPopup")}}function et(t){try{const e=t;e&&!e.isEnabled()&&e.enable()}catch(t){w(t,Z,"enableBtn")}}function nt(t){const e=$$("table").getColumns(),n=$$("tree");try{e.forEach((function(e,i){if(e.id==t){const t=e.type.slice(10);n.getItem(t)?n.select(t):t&&async function(t){await c.content("fields"),l.keys&&t&&(Backbone.history.navigate("tree/"+t,{trigger:!0}),window.location.reload())}(t)}}))}catch(t){w(t,Z,"setRefTable"),x.hideItem($$("EditEmptyTempalte"))}}function it(t){const e=$$("editTableFormProperty");!function(){try{$$("propertyRefbtnsContainer").addView({view:"button",type:"icon",width:30,height:29,icon:"icon-window-restore",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Открыть большой редактор текста")}},click:function(){!function(){const n=function(){const n=$$("editPropTextarea");if(n){const i=n.getValue();n.dirtyValue?S().then((function(n){1!=n&&2!=n||(2==n&&e.setValues({[t.id]:[i]},!0),tt($$("editTablePopupText")))})):tt($$("editTablePopupText"))}};!function(){const i={view:"textarea",id:"editPropTextarea",height:150,dirtyValue:!1,placeholder:"Введите текст",on:{onKeyPress:function(){et($$("editPropSubmitBtn")),$$("editPropTextarea").dirtyValue=!0}}},o=new D({config:{id:"editPropSubmitBtn",hotkey:"Ctrl+Space",value:"Добавить значение",click:function(){!function(){try{const n=$$("editPropTextarea").getValue();e.setValues({[t.id]:[n]},!0)}catch(t){w(t,Z,"editPropSubmitClick")}tt($$("editTablePopupText"))}()}},titleAttribute:"Добавить значение в запись таблицы"}).maxView("primary"),r=new X({headline:"Редактор поля  «"+t.label+"»",config:{id:"editTablePopupText",width:400,minHeight:300},closeClick:n,elements:{padding:{left:9,right:9},rows:[i,{height:15},o]}});r.createView(),r.showPopup(),function(){try{const e=$$("editPropTextarea");t.value&&e.setValue(t.value)}catch(t){w(t,Z,"setTextareaVal")}}()}()}()}})}catch(t){w(t,Z,"createBtnTextEditor")}}(),x.showItem($$("tablePropBtnsSpace"))}function ot(t){const e=$$("editTableFormProperty");!function(){try{$$("propertyRefbtnsContainer").addView({view:"button",type:"icon",width:30,height:29,icon:"icon-calendar",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Открыть календарь")}},click:function(n){!function(){const n=webix.Date.dateToStr("%d.%m.%y");function i(){const i=e.getValues().id,o=$$("editCalendarDate"),r=$$("hourInp").getValue(),s=$$("minInp").getValue(),c=$$("secInp").getValue(),a=r+":"+s+":"+c,l=n(o.getValue())+" "+a,u=[];function f(t,e,n){function i(){$$("timeForm").markInvalid(n),u.push(n)}try{t>e&&i(),/^\d+$/.test(t)||i(),t.length<2&&i()}catch(t){w(t,Z,"validTime element: "+n)}}return f(r,23,"hourInp"),f(s,59,"minInp"),f(c,59,"secInp"),function(){try{u.length||(e.setValues({[t.id]:l},!0),i&&e.setValues({id:i},!0),tt($$("editTablePopupCalendar")))}catch(t){w(t,Z,"setValToProperty")}}(),u.length}!function(){function n(t){return{view:"text",name:t,id:t,placeholder:"00",attributes:{maxlength:2},dirtyProp:!1,on:{onKeyPress:function(){$$("timeForm").markInvalid(t,!1),et($$("editPropCalendarSubmitBtn"))},onChange:function(){this.config.dirtyProp=!0,et($$("editPropCalendarSubmitBtn"))}}}}function o(t){return{template:":",id:t,borderless:!0,width:9,height:5,css:"popup_time-spacer"}}const r={rows:[{view:"calendar",format:"%d.%m.%y",borderless:!0,id:"editCalendarDate",width:300,height:250,dirtyProp:!1,on:{onChange:function(){this.config.dirtyProp=!0,et($$("editPropCalendarSubmitBtn"))}}},{height:10},{view:"form",id:"timeForm",height:85,type:"space",elements:[{template:"<div style='font-size:13px!important'>Введите время в формате xx : xx : xx</div>",borderless:!0,css:"popup_time-timeFormHead"},{cols:[n("hourInp"),o(1),n("minInp"),o(2),n("secInp")]}]},{height:10}]},s=new D({config:{id:"editPropCalendarSubmitBtn",hotkey:"Ctrl+Space",value:"Добавить значение",click:function(){i()}},titleAttribute:"Добавить значение в запись таблицы"}).maxView("primary"),c=new X({headline:"Редактор поля  «"+t.label+"»",config:{id:"editTablePopupCalendar",width:400,minHeight:300},closeClick:function(){const t=$$("editTablePopupCalendar");let e=!1;function n(t){t.config.dirtyProp&&!e&&(e=!0)}n($$("editCalendarDate")),n($$("hourInp")),n($$("minInp")),n($$("secInp")),e?S().then((function(e){1==e&&tt(t),2==e&&2==e&&(i()||tt(t))})):tt(t)},elements:{rows:[r,{height:15},s]}});c.createView(),c.showPopup(),function(){const n=e.getValues()[t.id],i=webix.Date.dateToStr("%H"),o=webix.Date.dateToStr("%i"),r=webix.Date.dateToStr("%s"),s=$$("editCalendarDate"),c=$$("editPropCalendarSubmitBtn");function a(t){t.config.dirtyProp=!1}!function(){try{n&&!isNaN(i(n))?(s.setValue(n),$$("hourInp").setValue(i(n)),$$("minInp").setValue(o(n)),$$("secInp").setValue(r(n))):(s.setValue(new Date),c&&c.disable()),a(s),a($$("hourInp")),a($$("minInp")),a($$("secInp"))}catch(t){w(t,Z,"setValuesDate")}}()}()}()}()}})}catch(t){w(t,Z,"createDateBtn")}}(),x.showItem($$("tablePropBtnsSpace"))}function rt(){const t=$$("editTableFormProperty"),e=$$("propertyRefbtns"),n=t.config.elements;e._cells.length||($$("propertyRefbtnsContainer")||function(){try{e.addView({id:"propertyRefbtnsContainer",rows:[]})}catch(t){w(t,Z,"createBtnsContainer")}}(),n.forEach((function(t,e){"combo"==t.type?function(t){const e=$$("editTableFormProperty");!function(){try{$$("propertyRefbtnsContainer").addView({view:"button",type:"icon",srcTable:t,width:30,height:29,icon:"icon-share-square-o",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Перейти в родительскую таблицу")}},click:function(t){!function(t){const n=$$(t).config.srcTable;e.config.dirty?function(){try{S().then((function(t){1!=t&&2!=t||(1==t||2==t&&(e.getValues().id?M(!1,!0):U()),j(),nt(n))}))}catch(t){w(t,Z,"createModalBox")}}():nt(n)}(t)}})}catch(t){w(t,Z,"btnLayout")}}(),x.showItem($$("tablePropBtnsSpace"))}(t.id):"popup"==t.customType?it(t):"customDate"==t.type?ot(t):$$("propertyRefbtnsContainer").addView({height:29,width:1})})))}function st(t){const e=$$("editTableFormProperty");try{const i=$$("table").getColumns(!0);if(0==Object.keys($$(t).elements).length){const t=[];i.forEach(((e,n)=>{const i={id:e.id,label:e.label,unique:e.unique,notnull:e.notnull,length:e.length,value:function(){const t=webix.Date.dateToStr("%d.%m.%y %H:%i:%s");let n;return"now"===e.default&&"datetime"==e.type?n=t(new Date):Date.parse(new Date(e.default))&&"datetime"==e.type?n=t(new Date(e.default)):e.default.includes("make_guid")?n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})):"False"==e.default?n=2:"True"==e.default?n=1:"None"!==e.default&&"null"!==e.default?n=e.default:"None"==e.default?n="":"null"==e.default&&(n=null),n}()};function o(){(0==e.length||e.length>512)&&(i.customType="popup"),i.type="text"}"datetime"==e.type?i.type="customDate":e.type.includes("reference")?function(){let t=e.type.slice(10);i.type="combo",i.css=e.id+"_container",i.options=I(t),i.template=function(t,e,n,i){let o=i.collection.getItem(t.value);return o?o.value:""}}():e.type.includes("boolean")?(i.type="select",i.options=[{id:1,value:"Да"},{id:2,value:"Нет"}]):e.type.includes("integer")?(o(),i.customType="integer"):o(),t.push(i)})),webix.editors.$popup={date:{view:"popup",body:{weekHeader:!0,view:"calendar",events:webix.Date.isHoliday,timepicker:!0,icons:!0}}},n=t,e.define("elements",n),e.refresh(),rt()}else $$(t).clear(),$$(t).clearValidation(),"table-editForm"==t&&$$("table-delBtnId").enable()}catch(t){w(t,Z,"createEditFields")}var n}function ct(){const t=$$("editTableFormProperty");try{!function(){const t=$$("table-saveBtn"),e=$$("table-saveNewBtn"),n=$$("table-delBtnId");e.isVisible()?e.hide():t.isVisible()&&t.hide(),n.disable()}(),t&&(t.clear(),t.hide()),x.showItem($$("EditEmptyTempalte")),function(){const t=$$("propertyRefbtnsContainer"),e=$$("propertyRefbtns");t&&e.removeView(t)}()}catch(t){w(t,Z,"defaultStateForm")}}const at="table => common";function lt(t){const e=$$("table").getItem(t);!function(){try{const t=$$("editTableFormProperty"),n=$$("table-editForm"),i=$$("table-newAddBtnId");t&&!t.isVisible()&&(t.show(),window.innerWidth>850&&(n.config.width=350,n.resize())),i.isEnabled()||i.enable(),function(){const t=$$("editTableFormProperty");t.config.dirty=!1,t.refresh()}(),function(){const t=webix.Date.dateToStr("%d.%m.%y %H:%i:%s");try{Object.values(e).forEach((function(n,i){if(n instanceof Date){const o=Object.keys(e)[i],r=t(n);e[o]=r}}))}catch(t){w(t,at,"setViewDate")}}(),t.setValues(e),$$("table-saveNewBtn").hide(),$$("table-saveBtn").show(),$$("table-delBtnId").enable()}catch(t){w(t,at,"toEditForm => setPropState")}}()}function ut(){L().forEach((function(t,e){let n;try{$$("table").getColumns().forEach((function(e,i){e.id==t.nameCol&&(n=e.label)}))}catch(t){w(t,at,"validateError")}p("error",t.textError+" (Поле: "+n+")")}))}function ft(t,e,n,i=!1){if(L().length)ut();else if(e.id){let o;o=i?function(t){let e={};try{Object.values(t).forEach((function(n,i){const o=$$("table").getItem(t.id),r=Object.keys(o);!function(){let n=Object.keys(t)[i];r.forEach((function(r){r==n&&o[r]!==Object.values(t)[i]&&(e[Object.keys(t)[i]]=Object.values(t)[i])}))}()}))}catch(t){w(t,at,"uniqueData")}return e}(e):e;const r=$$("table"),s="/init/default/api/"+n+"/"+e.id,c=webix.ajax().put(s,o);c.then((function(n){"i"==(n=n.json()).err_type&&(p("success","Данные сохранены"),r.updateItem(e.id,e),x.removeItem($$("propertyRefbtnsContainer")),i&&(lt(t),r.select(t))),"e"==n.err_type&&p("error",n.error)})),c.fail((function(t){g(t,at,"putData")}))}}const dt="table => onFuncs",ht={onBeforeLoad:function(){this.showOverlay("Загрузка...")},onBeforeEditStop:function(t,e,n){const i=$$("table"),o=i.getSelectedItem(),r=v(),s=i.getSelectedItem();try{if(t.value!=t.old){const n=e.row,c=e.column,a=t.value;i.updateItem(n,{[c]:a}),$$("editTableFormProperty").setValues(s),ft("",o,r)}}catch(t){w(t,dt,"onBeforeEditStop")}},onAfterSelect(t){!function(){try{const t=$$("table-newAddBtnId"),e=$$("table-editForm");x.showItem($$("editTableBarContainer")),t&&t.enable(),x.hideItem($$("EditEmptyTempalte")),e.isVisible()||(e.show(),function(){try{const t=$$("filterTableBarContainer"),e=$$("filterTableForm"),n=document.querySelector(".webix_btn-filter");x.hideItem(t),x.hideItem(e),n.classList.add("webix-transparent-btn"),n.classList.remove("webix-transparent-btn--primary")}catch(t){w(t,dt,"onAfterSelect => filterTableHide")}}())}catch(t){w(t,dt,"onAfterSelect => statePutEditForm")}}(),function(){try{const t=$$("table-editForm"),e=$$("container");e.$width<850&&(x.hideItem($$("tree")),e.$width<850&&(x.hideItem($$("tableContainer")),t.config.width=window.innerWidth,t.resize(),x.showItem($$("table-backTableBtn"))),x.showItem(t),x.hideItem($$("EditEmptyTempalte")))}catch(t){w(t,dt,"onAfterSelect => adaptiveEditForm")}}()},onBeforeSelect:function(t,e){const n=$$("table"),i=$$("editTableFormProperty"),o=i.getValues(),r=v(),s=t.id;if(function(){try{if(i.config.dirty)return S().then((function(e){const i=$$("table-saveBtn");1==e?(lt(s),n.select(t.id),x.removeItem($$("propertyRefbtnsContainer"))):2==e&&(i.isVisible()?ft(s,o,r,!0):function(t,e,i){if(L().length)ut();else{const o="/init/default/api/"+e,r=webix.ajax().post(o,i);r.then((function(e){if(null!==(e=e.json()).content.id)i.id=e.content.id,n.add(i),lt(t),x.removeItem($$("propertyRefbtnsContainer")),n.select(t),p("success","Данные успешно добавлены");else{const t=e.content.errors;let n="";Object.values(t).forEach((function(e,i){n+=e+" (Поле: "+Object.keys(t)[i]+"); "})),p("error",n)}})),r.fail((function(t){g(t,dt,"onBeforeSelect => postNewData")}))}}(s,r,o))})),!1;st("table-editForm"),lt(s)}catch(t){w(t,dt,"onBeforeSelect => modalBoxTable")}}(),i.config.dirty)return!1},onAfterLoad:function(){try{this.hideOverlay(),ct()}catch(t){w(t,dt,"onAfterLoad")}},onAfterDelete:function(){!function(){const t=$$("table").isVisible()?"table":$$("table-view").isVisible()?"table-view":void 0,e=$$(t);e.count()||e.showOverlay("Ничего не найдено"),e.count()&&e.hideOverlay()}()},onAfterAdd:function(){this.hideOverlay()}};function pt(t,e){return{view:"text",width:300,labelPosition:"top",type:"password",name:e,label:t}}const mt={view:"button",height:48,width:300,value:"Сменить пароль",css:"webix_primary",click:function(){try{const t=$$("cp-form");if(t&&t.validate()){let e=t.getValues();const n={op:e.oldPass,np:e.newPass},i="/init/default/api/cp",o=webix.ajax().post(i,n);o.then((function(e){"i"==(e=e.json()).err_type?p("success",e.err):p("error","authSettings function doAuthCp: "+e.err,"cp"),t.setDirty(!1)})),o.fail((function(t){g(t,"authSettings","doAuthCp post")}))}}catch(t){w(t,"authSettings","doAuthCp")}}},bt={view:"form",id:"cp-form",borderless:!0,margin:5,elements:[{template:"<div>Изменение пароля</div>",css:"webix_cp-form",height:35,borderless:!0},{view:"template",id:"authName",css:"webix_userprefs-info",height:50,borderless:!0,template:function(){const t=$$("authName").getValues();function e(t){const e="display:inline-block; font-size:13px!important; font-weight:600;";return"<div style='"+e+"color:var(--primary);'>Имя пользователя:</div>⠀<div style=' "+e+" '>"+t+"<div>"}return 0!==Object.keys(t).length?e(t):e("не указано")}},pt("Старый пароль","oldPass"),pt("Новый пароль","newPass"),pt("Повтор нового пароля","repeatPass"),{margin:5,cols:[mt]}],rules:{$all:webix.rules.isNotEmpty,$obj:function(t){const e=$$("cp-form").isDirty();return t.newPass!=t.repeatPass?(p("error","Новый пароль не совпадает с повтором"),!1):t.newPass!=t.oldPass||!e||(p("error","Новый пароль должен отличаться от старого"),!1)}}},gt={id:"layout-cp",cols:[bt,{}]},wt=[{view:"template",template:"<div>Настройки</div>",css:"webix_headline-userprefs",height:35,borderless:!0},{view:"template",id:"settingsName",css:"webix_userprefs-info",height:50,borderless:!0,template:function(){const t=$$("settingsName").getValues();return`\n            <div style = '\n                display:inline-block;\n                color:var(--primary);\n                font-size:13px!important;\n                font-weight:600\n            '>Имя пользователя:</div>\n\n            <div style = '\n                display:inline-block;\n                font-size:13px!important;\n                font-weight:600\n            '>${0!==Object.keys(t).length?t:"не указано"}</div>`}}],$t="settings => tabbar => otherForm",vt={view:"counter",id:"userprefsAutorefCounter",labelPosition:"top",name:"autorefCounterOpt",label:"Интервал автообновления (в миллисекундах)",min:15e3,max:9e5,on:{onChange:function(t,e,n){function i(t){return webix.message({type:"debug",expire:1e3,text:t})}try{const e=$$("userprefsAutorefCounter"),n=e.config.min,o=e.config.max;t==n?i("Минимально возможное значение"):t==o&&i("Максимально возможное значение")}catch(t){w(t,$t,"onChange")}}}},yt={view:"form",id:"userprefsOtherForm",borderless:!0,elements:[{view:"radio",labelPosition:"top",label:"Автообновление специфичных страниц",value:1,name:"autorefOpt",options:[{id:1,value:"Включено"},{id:2,value:"Выключено"}],on:{onChange:function(t){try{const e=$$("userprefsAutorefCounter");1==t&&e.show(),2==t&&e.hide()}catch(t){w(t,$t,"onChange")}}}},{height:5},vt,{height:5},{view:"radio",labelPosition:"top",label:"ID в таблицах",value:1,name:"visibleIdOpt",options:[{id:1,value:"Показывать"},{id:2,value:"Не показывать"}]},{}],on:{onChange:function(){const t=$$("userprefsSaveBtn"),e=$$("userprefsResetBtn"),n=$$("userprefsOtherForm");!function(){try{n.isDirty()&&!t.isEnabled()?t.enable():n.isDirty()||t.disable()}catch(t){w(t,$t,"onChange setSaveBtnState")}}(),function(){try{n.isDirty()&&!e.isEnabled()?e.enable():n.isDirty()||e.disable()}catch(t){w(t,$t,"onChange setResetBtnState")}}()}}},xt={view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsOther",scroll:"y",body:yt},It="settings => tabbar => workspaceForm",_t={view:"form",id:"userprefsWorkspaceForm",borderless:!0,elements:[{cols:[{rows:[{view:"radio",labelPosition:"top",name:"logBlockOpt",label:"Отображение блока системных сообщений",value:1,options:[{id:1,value:"Показать"},{id:2,value:"Скрыть"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть по умолчанию блок системных сообщений")},onChange:function(t,e){try{const n=$$("webix_log-btn");t!==e&&(1==t?n.setValue(2):n.setValue(1))}catch(t){w(t,It,"onChange")}}}},{height:15},{cols:[{view:"select",name:"LoginActionOpt",label:"Действие после входа в систему",labelPosition:"top",value:2,options:[{id:1,value:"Перейти на главную страницу"},{id:2,value:"Перейти на последнюю открытую страницу"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показывать/не показывать всплывающее окно при загрузке приложения")}}},{}]}]}]}],on:{onChange:function(){const t=$$("userprefsWorkspaceForm"),e=$$("userprefsSaveBtn"),n=$$("userprefsResetBtn");!function(){try{t.isDirty()&&!e.isEnabled()?e.enable():t.isDirty()||e.disable()}catch(t){w(t,It,"setSaveBtnState")}}(),function(){try{t.isDirty()&&!n.isEnabled()?n.enable():t.isDirty()||n.disable()}catch(t){w(t,It,"setResetBtnState")}}()}}},Ct={view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsWorkspace",scroll:"y",body:_t},kt={userprefsOther:{},userprefsWorkspace:{}},Et="settings => tabbar => buttons";function St(){const e=$$("userprefsTabbar"),n=e.getValue()+"Form",i=$$(n);i.isDirty()?function(){const o=webix.ajax().get("/init/default/api/userprefs/");o.then((function(o){o=o.json().content;let r=!1;const s=i.getValues(),c={name:n,prefs:s};if(function(){try{o.forEach((function(o,a){o.name==n&&(r=!0,function(o){const r="/init/default/api/userprefs/"+o.id,a=webix.ajax().put(r,c);a.then((function(o){if("i"==(o=o.json()).err_type){const e=JSON.stringify(i.getValues());t(n,e),p("success","Настройки сохранены")}"i"!==o.err_type&&p("error",o.error);const r=e.getValue();kt[r]=s,i.setDirty(!1)})),a.fail((function(t){g(t,Et,"putPrefs")}))}(o))}))}catch(t){w(t,Et,"findExistsData")}}(),!r){const n=webix.storage.local.get("user").id;n?c.owner=n:function(){const e=webix.ajax("/init/default/api/whoami");e.then((function(e){e=e.json().content,c.owner=e.id;const n={};n.id=e.id,n.name=e.first_name,n.username=e.username,t("user",JSON.stringify(n))})),e.fail((function(t){g(t,Et,"getOwnerData")}))}(),function(){const t=webix.ajax().post("/init/default/api/userprefs/",c);t.then((function(t){"i"==(t=t.json()).err_type?p("success","Настройки сохранены"):p("error",t.error);const n=e.getValue();kt[n]=s,i.setDirty(!1)})),t.fail((function(t){g(t,Et,"postPrefs")}))}()}})),o.fail((function(t){g(t,Et,"getUserprefsData")}))}():p("debug","Сохранять нечего")}const Vt={id:"adaptiveUp",rows:[{responsive:"adaptiveUserprefs",cols:[new D({config:{id:"userprefsResetBtn",hotkey:"Shift+X",disabled:!0,value:"Сбросить",click:function(){const t=$$("userprefsTabbar").getValue()+"Form",e=$$(t);"userprefsWorkspaceForm"===t?e.setValues({logBlockOpt:"1",LoginActionOpt:"1"}):"userprefsOtherForm"===t&&e.setValues({autorefOpt:"1",autorefCounterOpt:15e3,visibleIdOpt:"1"}),e.setDirty(!0),St()}},titleAttribute:"Вернуть начальные настройки"}).maxView(),new D({config:{id:"userprefsSaveBtn",hotkey:"Shift+Space",disabled:!0,value:"Сохранить настройки",click:St},titleAttribute:"Применить настройки"}).maxView("primary")]}]},Tt="settings => tabbar => tabbar";function Bt(t){return`<span class='webix_tabbar-filter-headline'>\n            ${t}\n            </span>`}const jt={view:"tabbar",type:"top",id:"userprefsTabbar",css:"webix_filter-popup-tabbar",multiview:!0,height:50,options:[{value:Bt("Рабочее пространство"),id:"userprefsWorkspace"},{value:Bt("Другое"),id:"userprefsOther"}],on:{onBeforeTabClick:function(t){const e=$$("userprefsTabbar"),n=e.getValue()+"Form",i=$$(n);function o(t){try{t.isEnabled()&&t.disable()}catch(t){w(t,Tt,"onBeforeTabClick")}}if(i.isDirty())return function(){try{webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"}).then((function(r){if(1==r){const r=webix.storage.local.get(n),s=$$("userprefsSaveBtn"),c=$$("userprefsResetBtn");i.setValues(r),e.setValue(t),o(s),o(c)}else 2==r&&(St(),e.setValue(t))}))}catch(t){w(t,Tt,"createModalBox")}}(),!1}}},At={rows:[{padding:{top:15,bottom:0,left:20,right:0},rows:wt},{rows:[jt,{cells:[Ct,xt]},Vt]}]};function Ft(){const t=$$("treeEdit");function e(e,n){const i=t.data.pull,o=Object.values(i),r="tree_disabled-item";o.forEach((function(i,o){"remove"==e?t.removeCss(i.id,r):"add"==e&&n&&(n.find((t=>t==i.id))||t.addCss(i.id,r))}))}e("remove");const n=$$("editTreeCombo").getValue(),i=[];t.exists(n)&&(!function e(n){const o=t.getParentId(n);o&&t.getParentId(o)?(t.open(o),i.push(o),e(o)):t.open(n)}(n),t.showItem(n),t.open(n),e("add",function(){const e=[n];return t.data.eachSubItem(n,(function(t){e.push(t.id)})),e}()))}function Ot(){const t={view:"edittree",id:"treeEdit",editable:!0,editor:"text",editValue:"value",css:"webix_tree-edit",editaction:"dblclick",data:[],on:{onAfterEditStop:function(t,e){try{const n="/init/default/api/trees/";if(t.value!=t.old){const i=$$("treeEdit").getParentId(e.id),o={name:t.value,pid:i,id:e.id,owner:null,descr:"",ttype:1,value:"",cdt:null},r=webix.ajax().put(n+e.id,o);r.then((function(t){"i"==(t=t.json()).err_type?p("success","Данные изменены"):w(t.err,"editTree","tree onAfterEditStop postData msg")})),r.fail((function(t){g(t,"editTree","tree onAfterEditStop postData")}))}}catch(t){g(t,"editTree","tree onAfterEditStop")}}}};return[{id:"treeEditContainer",cols:[{rows:[t]},{rows:[{view:"combo",id:"editTreeCombo",labelPosition:"top",label:"Выберите элемент для редактирования",options:[]},{view:"button",value:"Применить",css:"webix_primary",click:Ft},{}]}]}]}webix.UIManager.addHotKey("Ctrl+Shift+E",(function(){Backbone.history.navigate("experimental/treeEdit",{trigger:!0})}));const Pt="table => createSpace => userContext";let Lt,Nt;function Dt(t,e){return JSON.parse(t.prefs)[e]}async function Rt(t,e){if(await async function(t){const e=webix.ajax().get("/init/default/api/userprefs/");await e.then((function(e){e=e.json().content;const n=Object.values(e);Lt=function(t,e){const n="dashboards_context-prefs_"+e;let i;return t.forEach((function(t,e){t.name==n&&(i=Dt(t,"params"),Nt=Dt(t,"field"),function(t){const e="/init/default/api/userprefs/"+t.id,n=webix.ajax().del(e,t);n.then((function(t){"i"!==(t=t.json()).err_type&&w(t.err,Pt,"removePref")})),n.fail((function(t){g(t,Pt,"userprefsDel")}))}(t))})),i}(n,t)})),e.fail((function(t){g(t,Pt,"userprefsGet")}))}(t),Lt)return Lt[e]}const Wt="table => createSpace => popupNotAuth",zt={template:"Войдите в систему, чтобы продолжить.",css:"webix_template-not-found-descr",borderless:!0,height:35};const Ht=new D({config:{id:"webix_btn-go-login",hotkey:"Shift+Space",value:"Войти",click:function(){!function(){try{const t=$$("popupNotAuth");t&&t.destructor()}catch(t){w(t,Wt,"notAuthPopup btnClosePopup click")}}(),function(){try{Backbone.history.navigate("/",{trigger:!0}),window.location.reload()}catch(t){w(t,Wt,"notAuthPopup navigate")}}()}},titleAttribute:"Перейти на страницу авторизации"}).maxView("primary");let Mt;const Ut="table => createSpace => loadData";let qt,Jt,Yt,Kt,Gt,Qt,Xt,Zt,te;function ee(t){Gt=$$(qt),Jt||Gt.clearAll(),function(t,e){Mt=t,e.forEach((function(t,e){!function(t){const e=function(){const t=[],e=Mt.getColumns(!0);return e.forEach((function(n){(function(t,e){const n=function(t){const e=[];return t.forEach((function(t,n){"boolean"==t.type&&e.push(t.id)})),e}(t);let i=!1;return n.forEach((function(t,n){t==e&&(i=!0)})),i})(e,n.id)&&t.push(n.id)})),t}();e.forEach((function(e,n){0==t[e]?t[e]=2:t[e]=1}))}(t)}))}(Gt,t),Jt?function(t){t.forEach((function(t,e){!function(t){const e=Gt.data.pull;Object.values(e).forEach((function(e){e.id==t&&Gt.remove(e.id)}))}(t.id),Gt.add(t)}))}(t):function(t){0!==t.length?(Gt.hideOverlay("Ничего не найдено"),Gt.parse(t)):(Gt.showOverlay("Ничего не найдено"),Gt.clearAll()),setTimeout((()=>{!function(){const t=$$("table-view-visibleCols"),e=$$("table-visibleCols");t.isVisible()?x.enableItem(t):e.isVisible()&&x.enableItem(e)}()}),1e3)}(t)}function ne(t){try{const e=t;$$(Kt).setValues(e)}catch(t){w(t,Ut,"setCounterVal")}}async function ie(t,e,n,i){const o=$$(t);qt=e,Jt=i,Yt=n,Kt=qt+"-findElements";const r=await async function(t){const e=t.config.filter,n=new URLSearchParams(window.location.search).get("prefs");let i;return n&&(i=await Rt(n,"filter")),i||(i=e&&e.table===Yt?e.query:Yt+".id+%3E%3D+0"),i}(o),s=function(t){let e;const n=t.getColumns()[0].id,i=t.config.sort.idCol,o=t.config.sort.type;return e=i?"desc"==o?"~"+Yt+"."+i:Yt+"."+i:Yt+"."+n,e}(o),c=["query="+r,"sorts="+s,"limit=80","offset="+Jt];o.load({$proxy:!0,load:function(){const e=function(t,e){let n;return n="table"==t.config.id?"/init/default/api/smarts?"+e.join("&"):"/init/default/api/"+Yt,n}(o,c),n=webix.ajax().get(e);n.then((function(e){e=e.json(),function(t,e,n){const i=t.config.id;Jt||"table"!=i||(t.config.reccount=e.reccount,t.config.idTable=Yt,t.config.limitLoad=80,ne(e.reccount.toString())),"table-view"==i&&(t.config.idTable=Yt,ne(e.content.length.toString()))}(o,e),e=e.content,function(t){"table"==t&&(x.enableItem($$("table-newAddBtnId")),x.enableItem($$("table-filterId")),x.enableItem($$("table-exportBtn")))}(t),function(t,e){(function(t){const e=[];try{t.forEach((function(t,n){"datetime"==t.type&&e.push(t.id)}))}catch(t){w(t,"table => createSpace => formattingData","findDateCols")}return e})($$(t).getColumns()).forEach((function(t,n){!function(t,e){t.forEach((function(t){if(t[e]){const n=new Date(t[e]);t[e]=n}}))}(e,t)}))}(t,e),ee(e)})),n.fail((function(t){!function(){const t="-".toString();try{$$(Kt).setValues(t),x.disableItem($$("table-newAddBtnId")),x.disableItem($$("table-filterId")),x.disableItem($$("table-exportBtn"))}catch(t){w(t,Ut,"tableErrorState")}}(),401!=t.status||$$("popupNotAuth")||function(){const t=new X({headline:"Вы не авторизованы",config:{id:"popupNotAuth",width:340,height:125},elements:{padding:{left:5,right:5},rows:[zt,{padding:{left:5,right:5},rows:[Ht]}]}});t.createView(),t.showPopup()}(),g(t,"getInfoTable","getData")}))}})}function oe(t){const e=$$(t).config.reccount;e?e-Xt>0&&ie(t,Qt,Zt,Xt):ie(t,Qt,Zt,Xt)}function re(t,e,n=0){const i=l.item(e);var o;Qt=t,Xt=n,Zt=e,te=Qt+"-findElements","dbtable"==(o=i.type)?oe("table"):"tform"==o&&oe("table-view"),function(t){if(t.autorefresh){const e=webix.storage.local.get("userprefsOtherForm");let n;e&&(n=e.autorefCounterOpt),e&&void 0!==n&&function(t,e){setInterval((function(){"dbtable"==t?oe("table"):"tform"==t&&oe("table-view")}),e)}(t.type,n>=15e3?n:12e4)}}(i)}function se(t){const e=t.config.idTable,n=t.config.offsetAttr,i=n+80;t.config.offsetAttr=i,t.refresh(),re("table",e,n)}function ce(t){t.attachEvent("onAfterSort",(function(e,n){const i={idCol:e,type:n};t.config.sort=i,t.config.offsetAttr=0,t.clearAll(),se(t)}))}function ae(t){t.attachEvent("onResize",(function(e){const n=t.getColumns();e-=17;let i=0;if(n.forEach((function(t,e){i+=t.width})),i<e){const o=e-i,r=n.length-1;n.forEach((function(e,n){if(n==r){const n=e.width+o;t.setColumnWidth(e.id,n)}}))}}))}function le(t){t.attachEvent("onColumnResize",(function(e,n,i,o){const r=t.getColumns(),s=r.length;function c(t){return r[s-t]}if(o){const n=s-2,i=c(2),o=c(1);if(n>-1&&i.id==e){const e=t.$width-17;let n=0;if(r.forEach((function(t,e){n+=t.width})),n<e){const i=e-n,r=o.width+i;t.setColumnWidth(o.id,r)}}}}))}function ue(){try{const t=$$("popupVisibleCols");t&&t.destructor()}catch(t){w(t,"visibleColumns","destructPopup")}}function fe(t){const e=de(),n=e.getColumns(!0);!function(){try{n.forEach((function(n,i){if(function(e){let n=!1;return t.values.forEach((function(t){t.column==e&&(n=!0)})),n}(n.id))e.isColumnVisible(n.id)||e.showColumn(n.id);else{const t=e.getColumnIndex(n.id);e.isColumnVisible(n.id)&&-1!==t&&e.hideColumn(n.id)}}))}catch(t){w(t,"visibleColumns","setUpdateCols => setVisibleState")}}(),t.values.forEach((function(t){e.moveColumn(t.column,t.position)}))}function de(){const t=$$("table"),e=$$("table-view");let n;return t.isVisible()?n=t:e.isVisible()&&(n=e),n}function he(e,n=!1){const i=v(),o={values:e,tableIdPrefs:i},r={name:"visibleColsPrefs_"+i,prefs:o};!function(){const e=webix.ajax().get("/init/default/api/userprefs");let s,c=!1;e.then((function(t){t=t.json().content;try{t.forEach((function(t){t.name!="visibleColsPrefs_"+i||c||(s=t.id,c=!0)}))}catch(t){w(t,"visibleColumns","getUserprefsData getData")}})),e.then((function(){c?function(e,r){const s="/init/default/api/userprefs/"+r,c=webix.ajax().put(s,e);c.then((function(r){"i"!==(r=r.json()).err_type?p("error","toolbarTable function saveExistsTemplate putData: "+r.err):(p("success","Рабочая область таблицы обновлена"),t("visibleColsPrefs_"+i,JSON.stringify(e.prefs)),fe(o),n&&function(t){const e=de();t.values.forEach((function(t,n){!function(t){e.eachColumn((function(n){t.column==n&&e.setColumnWidth(n,t.width)}),!0)}(t)}))}(o))})),c.fail((function(t){g(t,"visibleColumns","saveExistsTemplate => putUserprefsData")})),ue()}(r,s):function(){const e=webix.storage.local.get("user").id;e&&(r.owner=e);const n=webix.ajax().post("/init/default/api/userprefs/",r);n.then((function(e){"i"!==(e=e.json()).err_type?w(e.err,"visibleColumns","saveNewTemplate"):(p("success","Рабочая область таблицы обновлена"),t("visibleColsPrefs_"+i,JSON.stringify(r.prefs)),fe(o))})),n.fail((function(t){g(t,"visibleColumns","saveTemplate")})),ue()}()})),e.fail((function(t){g(t,"toolbarTable","getUserprefsData")}))}()}function pe(t){t.attachEvent("onColumnResize",(function(e,n,i,o){if(o){const e=t.getColumns(),n=[];e.forEach((function(e,i){n.push({column:e.id,position:t.getColumnIndex(e.id),width:e.width.toFixed(2)})})),he(n)}}))}function me(t,e){let n;try{n=e||function(){const e=$$(t).getValues();return 0!==Object.keys(e).length?"<div class='no-wrap-headline'>"+e+"</div>":"<div class='no-wrap-headline'> Имя не указано </div>"}}catch(t){w(t,"blockHeadline","setHeadlineBlock")}return{view:"template",id:t,borderless:!0,css:"webix_block-headline",height:34,template:n,on:{}}}function be(){function t(){const t=$$("popupFavsLinkSave");try{t&&t.destructor()}catch(t){w(t,"favsLink","destrucPopupSave")}}function e(t,e,n){return{id:t,css:"popup_subtitle",borderless:!0,height:20,template:function(){return 0!==Object.keys($$(t).getValues()).length?"<div style='font-weight:600'>"+e+": </div>"+$$(t).getValues():"<div style='font-weight:600'>"+e+": </div>"+e+" "+n}}}const n=new D({config:{value:"Сохранить ссылку",click:function(){!function(){let e,n;const i=v();!function(){try{e=$$("favNameLink").getValues(),n=$$("favLink").getValues()}catch(t){w(t,"favsLink","btnSaveLinkClick => getData")}}(),function(){const o=webix.ajax().get("/init/default/api/userprefs/");o.then((function(o){o=o.json().content;const r=[];!function(){try{o.forEach((function(t){t.name.includes("fav-link")&&r.push(t.name)}))}catch(t){w(t,"favsLink","getUserprefs => getFavPrefs")}}(),function(){try{let o=!0;r.length&&r.forEach((function(t){if(t.includes(i)){const e=t.indexOf("_")+1;t.slice(e)==i&&o&&(o=!1,p("success","Такая ссылка уже есть в избранном"))}})),!r.length||o?function(){let o,r=webix.storage.local.get("user");if(r||(C(),r=webix.storage.local.get("user")),r){o=r.id;const s={name:"fav-link_"+i,owner:o,prefs:{name:e,link:n,id:i}},c=webix.ajax().post("/init/default/api/userprefs/",s);c.then((function(n){"i"==(n=n.json()).err_type?p("success","Ссылка «"+e+"»  сохранёна в избранное"):w(n.err,"favsLink","btnSaveLinkClick => postContent msg"),t()})),c.fail((function(t){g(t,"favsLink","btnSaveLinkClick => postContent")}))}}():o||t()}catch(t){w(t,"favsLink","getUserprefs => getNotUniquePrefs")}}()})),o.fail((function(t){g(t,"favsLink","getUserprefs getData")}))}()}()}},titleAttribute:"Сохранить ссылку в избранное"}).maxView("primary"),i=new X({headline:"Сохранить ссылку",config:{id:"popupFavsLinkSave",width:500},elements:{rows:[e("favNameLink","Имя","не указано"),{height:5},e("favLink","Ссылка","не указана"),{height:10},{padding:{left:8,right:8},rows:[n]},{}]}});i.createView(),i.showPopup(),async function(){r.fields||await s("fields"),r.tableNames&&function(t){try{const e=$$("favNameLink");r.tableNames.forEach((function(n,i){n.id==t&&e&&e.setValues(n.name)}))}catch(t){w(t,"favsLink","findName")}}(v())}(),function(){try{const t=window.location.href,e=$$("favLink");e&&e.setValues(t)}catch(t){w(t,"favsLink","getLink")}}()}function ge(t,e=null){return{css:"webix_block-headline",cols:[me(t,e),{},{css:"btn-history",cols:[new D({config:{id:webix.uid(),hotkey:"Ctrl+Shift+P",icon:"icon-arrow-left",click:function(){history.back()}},titleAttribute:"Вернуться назад"}).transparentView(),new D({config:{id:webix.uid(),hotkey:"Ctrl+Shift+B",icon:"icon-arrow-right",click:function(){history.forward()}},titleAttribute:"Перейти вперёд "}).transparentView()]},new D({config:{id:webix.uid(),hotkey:"Ctrl+Shift+L",icon:"icon-star",click:function(){be()}},titleAttribute:"Добавить ссылку в избранное"}).transparentView()]}}function we(t){const e=$$("visibleColsSubmit"),n=e.isEnabled();"enable"!=t||n?"disable"==t&&n&&e.disable():e.enable()}function $e(){const t=de(),e=t.getColumns(!0),n=[];S("Будут установлены стандартные настройки","Вы уверены?",["Отмена","Сохранить изменения"]).then((function(i){1==i&&(function(){try{e.forEach((function(i,o){const r=((window.innerWidth-$$("tree").$width-77)/t.getColumns(!0).length).toFixed(2),s=function(e){let n;const i=t.data.pull[1];return i&&Object.keys(i).forEach((function(t,i){t==e&&(n=i)})),n}(i.id);!function(t,e){const n=de(),i=e.length,o=($$("tableContainer").$width-17)/i;n.setColumnWidth(t,o)}(i.id,e),t.isColumnVisible(i.id)||t.showColumn(i.id),t.setColumnWidth(i.id,r),n.push({column:i.id,position:s,width:r})}))}catch(t){w(t,"visibleColumns","clearBtnColsClick => showCols")}}(),he(n),ue(),p("success","Рабочая область таблицы обновлена"))}))}function ve(){$$("visibleColsMsg")||webix.message({id:"visibleColsMsg",type:"debug",text:"Элемент не выбран"})}function ye(t){const e=$$("visibleListSelected"),n=e.getSelectedId();n?"up"==t?(e.moveUp(n,1),we("enable")):"down"==t&&(e.moveDown(n,1),we("enable")):ve()}function xe(t){const e=$$("visibleList"),n=$$("visibleListSelected"),i=$$("visibleColsEmptyTempalteSelected"),o=$$("visibleColsEmptyTempalte");function r(t,e,n){Object.values(t.data.pull).length||(x.showItem(e),n&&n.isEnabled()&&n.disable(),we("disable"))}function s(t){"available"==t?Object.values(e.data.pull).length&&(x.hideItem(i),we("enable")):"selected"==t&&Object.values(n.data.pull).length&&(x.hideItem(o),we("enable"))}if("add"==t){const t=e.getSelectedItem(),i=e.getSelectedId();t?(s("available"),n.add(t),e.remove(i),r(e,o,$$("addColsBtn")),we("enable")):ve()}else if("remove"==t){const t=n.getSelectedItem(),o=n.getSelectedId();t?(s("selected"),e.add(t),n.remove(o),r(n,i,$$("removeColsBtn"))):ve()}}function Ie(t){const e=$$(t);let n=$$(t).getColumns(!0);!function(){function t(t,e){return{css:"list-filter-empty",rows:[R(e,t)]}}function i(t,e){return{view:"scrollview",css:"webix_multivew-cell",borderless:!0,scroll:!1,body:{id:t,rows:e}}}const o=new D({config:{id:"visibleColsSubmit",hotkey:"Shift+S",disabled:!0,value:"Сохранить состояние",click:function(){!function(){const t=$$("visibleListSelected"),e=t.data.pull,n=Object.values(e),i=[],o=de(),r=window.innerWidth-$$("tree").$width-77;function s(){const t=o.getColumns(!0).length;return(r/t).toFixed(2)}try{const e=[],c={};n.forEach((function(n,a){const l=t.getIndexById(n.id),u=t.getLastId();let f;n.id!==u?(f=o.getColumnConfig(n.column).width,f>=r&&(f=s()),e.push(f),i.push({column:n.column,position:l,width:Number(f)})):(c.column=n.column,c.position=l)})),function(t,e){const n=e.reduce(((t,e)=>t+e),0);let o=r-n;o<50&&(o=s()),t.width=Number(o),i.push(t)}(c,e)}catch(t){w(t,"visibleColumns","visibleColsSubmitClick")}he(i,!0)}()}},titleAttribute:"Изменить отображение колонок в таблице"}).maxView("primary"),r=[{template:"Доступные колонки",css:"list-filter-headline",height:25,borderless:!0},t("visibleColsEmptyTempalte","Нет доступных колонок"),{view:"list",id:"visibleList",template:"#label#",select:!0,css:"list-filter-borders",borderless:!0,data:[],on:{onAfterAdd:function(){const t=$$("addColsBtn");t&&!t.isEnabled()&&t.enable()},onAfterDelete:function(t){const e=this.getNextId(t);e&&this.select(e)}}}],s=[{template:"Выбранные колонки",css:"list-filter-headline",height:25,borderless:!0},t("visibleColsEmptyTempalteSelected","Выберите колонки из доступных"),{view:"list",id:"visibleListSelected",template:"#label#",css:"list-filter-borders",select:!0,borderless:!0,data:[],on:{onAfterAdd:function(){const t=$$("removeColsBtn");t&&!t.isEnabled()&&t.enable()},onAfterDelete:function(t){const e=this.getNextId(t);e&&this.select(e)}}}],c={rows:[{view:"button",width:50,type:"icon",id:"addColsBtn",css:"list-filter-move-btns",disabled:!0,icon:"icon-arrow-right",hotkey:"shift+a",height:30,click:function(){xe("add")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить выбранные колонки (Shift+A)")}}},{view:"button",width:50,type:"icon",id:"removeColsBtn",css:"list-filter-move-btns",disabled:!0,icon:"icon-arrow-left",hotkey:"shift+d",height:30,click:function(){xe("remove")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Убрать выбранные колонки (Shift+D)")}}}]},a={cols:[new D({config:{id:"moveSelctedUp",hotkey:"Shift+U",icon:"icon-arrow-up",click:function(){ye("up")}},titleAttribute:"Поднять выбраную колонку вверх"}).transparentView(),new D({config:{id:"moveSelctedDown",hotkey:"Shift+W",icon:"icon-arrow-down",click:function(){ye("down")}},titleAttribute:"Опустить выбраную колонку вниз"}).transparentView(),{}]},l=new D({config:{id:"clearBtnCols",hotkey:"Shift+R",icon:"icon-trash",click:function(){$e()}},css:"webix-trash-btn-color",titleAttribute:"Установить стандартные настройки"}).transparentView();new X({headline:"Видимость колонок",config:{id:"popupVisibleCols",width:600,maxHeight:400},elements:{rows:[{cols:[{rows:[{view:"search",id:"searchColsList",placeholder:"Поиск (Shift+F)",css:"searchTable",height:42,hotkey:"shift+f",on:{onTimedKeyPress:function(){!function(){const t=$$("visibleList"),e=$$("searchColsList").getValue().toLowerCase();let n=0;try{t.filter((function(t){const i=-1!==t.label.toLowerCase().indexOf(e);return i&&n++,i})),0==n?x.showItem($$("visibleColsEmptyTempalte")):x.hideItem($$("visibleColsEmptyTempalte"))}catch(t){w(t,"visibleColumns","searchColsListPress")}}()}}},i("listContent",r)]},{width:10},{rows:[{height:45},{},c,{}]},{width:10},{rows:[{cols:[a,l]},i("listSelectedContent",s)]}]},{height:20},o]}}).createView(),function(){try{n=e.getColumns(!0),_.sortBy(n,"label").forEach((function(t){"action-column"===t.css||t.hiddenCustomAttr||$$("visibleList").add({column:t.id,label:t.label})}))}catch(t){w(t,"visibleColumns","getCheckboxArray")}}(),x.hideItem($$("visibleColsEmptyTempalte")),x.showItem($$("popupVisibleCols")),function(){const t=de(),e=$$("visibleList"),n=Object.values(e.data.pull),i=t.getColumns();n.length!==i.length&&(function(){try{n.forEach((function(t,n){(function(t){let e=!1;return i.forEach((function(n,i){t==n.id&&(e=!0)})),e})(t.column)&&e.remove(t.id)}))}catch(t){w(t,"visibleColumns","createSpace => removeListItem")}}(),function(){const t=$$("visibleListSelected"),e=$$("visibleColsEmptyTempalteSelected");i.length&&x.hideItem(e);try{i.forEach((function(e,n){t.add({column:e.id,label:e.label})}))}catch(t){w(t,"visibleColumns","createSpace => addListSelectedItem")}}())}()}()}function _e(t){return new D({config:{id:t+"-visibleCols",hotkey:"Ctrl+Shift+A",disabled:!0,icon:"icon-columns",click:function(){Ie(t)}},titleAttribute:"Показать/скрыть колонки"}).transparentView()}const Ce={},ke={},Ee="tableFilter => common";function Se(t,e){t.classList.contains(e)||t.classList.add(e)}function Ve(t,e){t.classList.contains(e)&&t.classList.remove(e)}function Te(t,e=null,n=null){const i="webix_show-content",o="webix_hide-content",r=$$(n+"_segmentBtn");!function(){if(t&&"selectAll"!==n){Ce[e]||(Ce[e]=[]);const t=function(t){let e=!0;return Ce[t].length&&(e=!1),e}(e);t&&(Ce[e].push(n),x.showItem(r))}else"selectAll"!==n&&(Ce[e]=[])}();const s=document.querySelectorAll(".webix_filter-inputs");function c(t,e){t&&t.setValue(e)}function a(){const t=$$(n+"-btnFilterOperations"),e=$$(n+"_segmentBtn"),i=$$(n+"_container-btns");$$(n).setValue(""),$$(n).hide(),c(t,"="),c(e,1),x.hideItem(i)}function l(){try{s.forEach((function(t,n){t.classList.contains(e)&&(Se(t,o),Ve(t,i))}))}catch(t){w(t,Ee,"function visibleField => hideHtmlEl")}}function u(){const t=$$(n+"_rows").getChildViews(),e=[];try{Object.values(t).forEach((function(t,n){t.config.id.includes("child")&&e.push($$(t.config.id))})),e.forEach((function(t,e){t.getParentView().removeView($$(t.config.id))}))}catch(t){w(t,Ee,"function visibleField => removeChids")}}let f=!1;if("selectAll"!==n&&$$(n+"_rows").getChildViews().length>1&&(f=!0),f)t||($$(n).isVisible()&&l(),$$(n+"_rows")&&u(),a());else if(t)!function(){try{s.forEach((function(t,n){t.classList.contains(e)?(Se(t,i),Ve(t,o)):Se(t,o)}))}catch(t){w(t,Ee,"function visibleField => showHtmlEl")}}(),x.showItem($$(n)),x.showItem($$(n+"_container-btns")),x.enableItem($$("resetFilterBtn")),x.enableItem($$("filterLibrarySaveBtn")),x.hideItem($$("filterEmptyTempalte"));else try{$$(n).isVisible()&&l(),$$(n+"_rows")&&u(),a()}catch(t){w(t,Ee,"function visibleField => hideElements")}}function Be(){Object.values(Ce).forEach((function(t,e){t.length&&t.forEach((function(t,e){if(!t.includes("_filter-child-")){const e=$$(t).config.columnName,n=$$(t+"_segmentBtn");Te(0,e,t),n.setValue(1),x.hideItem(n)}}))}))}let je,Ae,Fe,Oe,Pe,Le,Ne,De;function Re(){const t=je.id,e=t+"_filter-child-"+Ae;return{id:e,name:e,label:je.label,columnName:t,labelPosition:"top",on:{onKeyPress:function(){$$("filterTableForm").clearValidation();const t=$$("btnFilterSubmit");x.enableItem(t)}}}}function We(t){const e=Re();return e.view="text","text"==t?e.placeholder="Введите текст":"int"==t&&(e.placeholder="Введите число",e.invalidMessage="Поле поддерживает только числовой формат",e.validate=function(t){return!isNaN(1*t)}),e}function ze(t){const e=Re(),n=function(){if(je.editor&&"combo"==je.editor)return je.type.slice(10)}();return e.view="combo",e.placeholder="Выберите вариант","default"==t?e.options={data:I(n)}:"bool"==t&&(e.options=[{id:1,value:"Да"},{id:2,value:"Нет"}]),e}function He(t,e,n){let i,o=!1;return e?i=t.id+"_filter-child-"+n:(i=t.id+"_filter",o=!0),{view:"segmented",id:i+"_segmentBtn",hidden:o,value:1,options:[{id:"1",value:"и"},{id:"2",value:"или"}]}}function Me(){const t=$$(Pe+"_filter_rows"),e=Pe+"_filter-child-"+Le+"-container",n=(Ae=Le,je=Oe,Fe=De,"text"==Fe?We("text"):"combo"==Fe?ze("default"):"boolean"==Fe?ze("bool"):"date"==Fe?function(){const t=Re();return t.view="datepicker",t.placeholder="дд.мм.гг",t.format="%d.%m.%Y %H:%i:%s",t.timepicker=!0,t}():"integer"==Fe?We("int"):void 0);let i=Ne;$$(Pe+"_filter").isVisible()||(i=Ne-1),Ce[Pe]||(Ce[Pe]=[]),Ce[Pe].splice(i,0,n.id),t.addView({id:e,padding:5,positionElem:Ne,rows:[{id:webix.uid(),height:105,rows:[{cols:[n,rn(Oe,De,!0,Le)]},He(Oe,!0,Le)]}]},Ne)}function Ue(t,e){return Oe=t,Pe=t.id,Le=webix.uid(),function(t){Ne=null==t?1:t}(e),function(t){De="boolean"!==t.type?t.editor:"boolean"}(t),Me(),Pe+"_filter-child-"+Le}function qe(t=!1){const e=Object.values(Ce),n=[];let i=0;return e.forEach((function(t,e){t.length&&(i++,n.push(e))})),t?n.pop():i}function Je(){qe()||x.showItem($$("filterEmptyTempalte"))}function Ye(t,e){Ce[t.id].forEach((function(n,i){n==e&&Ce[t.id].splice(i,1)}))}function Ke(t,e){let n=!1;return t===e&&(n=!0),n}function Ge(t,e){const n={};let i=Ce[t];return n.prevIndex=i.length-2,n.lastIndex=i.length-1,n.lastInput=i[n.lastIndex],n.prevIndex<0&&(e.forEach((function(n,o){n==t&&o-1>=0&&(i=Ce[e[o-1]])})),n.prevIndex=i.length-1),n.prevInput=i[n.prevIndex],n}function Qe(t){const e=$$(t+"_segmentBtn");x.hideItem(e)}function Xe(t,e,n){const i=Object.keys(Ce),o=function(t,e){const n={check:!1};return e.forEach((function(e,i){i===qe(!0)&&e==t&&(n.check=!0,n.index=i)})),n}(e,i);if("add"===t&&o.check){const t=Ge(e);Ke(t.lastInput,n)&&Qe(t.lastInput)}else if("remove"===t&&o.check){const t=Ge(e,i);Ke(t.lastInput,n)&&Qe(t.prevInput)}}function Ze(t,e){const n=e.id+"_filter",i=$$(n+"_segmentBtn");"add"===t?function(){const t=Ue(e);Xe("add",e.id,t),x.showItem(i)}():"remove"===t&&E("Поле фильтра будет удалено").then((function(){(function(){const t=$$(n).getParentView().getChildViews();!function(t,e){const n=$$(t+"-btnFilterOperations");try{e.forEach((function(t){x.hideItem(t)})),n.setValue(" = ")}catch(t){w(t,"createElement => contextBtn","contextBtn remove => hideMainInput")}}(n,t),function(t){const e=$$(t+"_filter_rows");if(1==e.getChildViews().length){const t=e.getNode();Ve(t,"webix_show-content"),Se(t,"webix_hide-content")}}(e.id),Xe("remove",e.id,n),Ye(e,n),Je(),p("success","Поле удалено")})(),x.hideItem(i)}))}function tn(t,e,n){const i=function(t){const e=t.config.master,n=e.indexOf("_contextMenuFilter");return e.slice(0,n)}(n),o=i+"-container",r=$$(i+"_segmentBtn");"add"==t?function(){const t=function(t,e){const n=$$(t+"_filter");let i=0;return Ce[t].forEach((function(t,n){t+"-container"===e&&(i=n+1)})),n.isVisible()||i++,i}(e.id,o),n=Ue(e,t);Xe("add",e.id,n),x.showItem(r)}():"remove"===t&&E("Поле фильтра будет удалено").then((function(t){t&&(Xe("remove",e.id,i),Ye(e,i),$$(o).getParentView().removeView($$(o)),Je(),p("success","Поле удалено"))}))}function en(t,e,n){const i={view:"button",id:e+"_contextMenuFilter",type:"icon",css:"webix_filterBtns",icon:"wxi-dots",inputHeight:38,width:40,popup:{view:"contextmenu",css:"webix_contextmenu",data:[{id:"add",value:"Добавить поле",icon:"icon-plus"},{id:"remove",value:"Удалить поле",icon:"icon-trash"}],on:{onMenuItemClick:function(e){n?tn(e,t,this):Ze(e,t)}}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить/удалить поле")}}};return i}function nn(t){function e(t,e,n){t.add({value:e,id:n})}function n(t){e(t,"=","eql"),e(t,"!=","notEqual")}function i(t){e(t,"< ","less"),e(t,"> ","more"),e(t,">=","mrEqual"),e(t,"<=","lsEqual")}return webix.once((function(){"combo"==t||"boolean"==t?n(this):"text"==t?(n(this),e(this,"содержит","contains")):"date"==t?(n(this),i(this)):"integer"==t&&(n(this),i(this),e(this,"содержит","contains"))}))}function on(t,e){const n=e+"-btnFilterOperations";return{view:"button",id:n,css:"webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){!function(t,e){try{let n=$$(t);"eql"===e?n.setValue("="):"notEqual"===e?n.setValue("!="):e.includes("less")?n.setValue("<"):"more"===e?n.setValue(">"):"mrEqual"===e?n.setValue(">="):"lsEqual"===e?n.setValue("<="):"contains"===e&&n.setValue("⊆")}catch(t){w(t,"tableFilter => createElement => buttons => operationBtn","filterOperationsBtnLogic")}}(n,t)},onAfterLoad:nn(t)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}}}function rn(t,e,n,i=null){let o,r=!1;return n?o=t.id+"_filter-child-"+i:(o=t.id+"_filter",r=!0),{id:o+"_container-btns",hidden:r,css:{"margin-top":"22px!important"},cols:[on(e,o),en(t,o,n)]}}const sn="tableFilter => createElements => parentFilter";let cn,an,ln;function un(){const t=ln;return t.view="datepicker",t.format="%d.%m.%Y %H:%i:%s",t.placeholder="дд.мм.гг",t.timepicker=!0,t}function fn(t){const e=ln;return e.view="combo",e.placeholder="Выберите вариант",e.options={data:I(t)},e}function dn(){const t=ln;return t.view="combo",t.placeholder="Выберите вариант",t.options=[{id:1,value:"Да"},{id:2,value:"Нет"}],t}function hn(t){const e=ln;return e.view="text",e.css={"passing-bottom":"5px!important"},"text"==t?e.placeholder="Введите текст":"int"==t&&(e.placeholder="Введите число",e.invalidMessage="Поле поддерживает только числовой формат",e.validate=function(t){return!isNaN(1*t)}),e}function pn(t){return"datetime"==t.type?[un(),rn(t,"date")]:t.type.includes("reference")?[fn(t.type.slice(10)),rn(t,"combo")]:t.type.includes("boolean")?[dn(),rn(t,"combo")]:t.type.includes("integer")?[hn("int"),rn(t,"integer")]:[hn("text"),rn(t,"text")]}function mn(t,e=1){cn=t,an=e;const n=$$(cn).elements;0==Object.keys(n).length?(x.removeItem($$("inputsFilter")),function(t){const e=$$(cn);try{e&&e.addView({margin:8,id:"inputsFilter",css:"webix_inputs-table-filter",rows:t},an)}catch(t){w(t,sn,"addInputs")}}(function(){const t=[],e=$$("table").getColumns(!0);try{return e.forEach(((e,n)=>{const i=e.id;!function(t){ln={id:t.id+"_filter",name:t.id+"_filter",hidden:!0,label:t.label,labelPosition:"top",columnName:t.id,on:{onItemClick:function(){$$(cn).clearValidation(),$$("btnFilterSubmit").enable()}}}}(e);const o={id:i+"_filter_rows",css:i+" webix_filter-inputs",rows:[{id:i+"_filter-container",padding:5,rows:[{cols:pn(e)},He(e,!1)]}]};t.push(o)})),t}catch(t){w(t,sn,"generateElements")}}())):(!function(){const t=$$(cn);try{t&&(t.clear(),t.clearValidation())}catch(t){w(t,sn,"clearFormValidation")}}(),x.showItem($$("inputsFilter"))),function(){const t=$$("table-delBtnId");try{"table-editForm"==cn&&t&&t.enable()}catch(t){w(t,sn,"enableDelBtn")}}()}const bn="tableFilter => toolbarBtnClick",gn="webix-transparent-btn--primary",wn="webix-transparent-btn";function $n(t){const e=$$("filterTableBarContainer");e.config.width=t,e.resize()}function vn(t){const e=$$("filterTableForm"),n=$$("container");(function(t,e){$$(e).clearSelection(),function(){const e=document.querySelector(".webix_btn-filter");e.classList.contains(gn)?(function(t){try{t.classList.add(wn),t.classList.remove(gn)}catch(t){w(t,bn,"filterMaxAdaptive => setSecondaryBtnState")}}(e),x.hideItem($$("filterTableForm")),x.hideItem($$("filterTableBarContainer"))):(x.hideItem($$("table-editForm")),x.showItem(t),0!==t.getChildViews()&&mn("filterTableForm",3),function(t){try{t.classList.add(gn),t.classList.remove(wn)}catch(t){w(t,bn,"filterMaxAdaptive => setPrimaryBtnState")}}(e),x.showItem($$("filterTableBarContainer")))}(),$n(350)})(e,t),n.$width<850?(x.hideItem($$("tree")),n.$width<850&&(x.hideItem($$("tableContainer")),x.hideItem($$("tree")),x.showItem($$("table-backTableBtnFilter")),$n(window.innerWidth-45))):(x.hideItem($$("table-backTableBtnFilter")),e.config.width=350,e.resize())}function yn(t,e){return new D({config:{id:t+"-filterId",hotkey:"Ctrl+Shift+F",disabled:!0,hidden:e,icon:"icon-filter",click:function(){vn(t)}},css:"webix_btn-filter",titleAttribute:"Показать/скрыть фильтры"}).transparentView()}function xn(t,e){function n(t=!0){const e="<span class='webix_icon  icon-pencil' style='font-size:13px!important;'></span>";return t?e:e+"<span style='padding-left: 5px; font-size:13px!important; margin-right: 11px;' >Редактор записи</span>"}return new D({config:{id:t+"-editTableBtnId",hotkey:"Ctrl+Shift+X",value:n(!1),hidden:e,minWidth:40,maxWidth:200,onlyIcon:!1,click:function(){!function(){const t=$$("table-editForm"),e=$$("table-backTableBtn"),n=$$("tree"),i=$$("container");!function(){const e=$$("editTableBarContainer"),n=$$("filterTableBarContainer"),i=$$("filterTableForm");x.hideItem(n),x.hideItem(i),function(){const t=document.querySelector(".webix_btn-filter");try{t.classList.add("webix-transparent-btn"),t.classList.remove("webix-transparent-btn--primary")}catch(t){w(t,"tableEditForm => toolbarBtn","setSecondaryState")}}(),t&&t.isVisible()?(x.hideItem(t),x.hideItem(e)):t&&!t.isVisible()&&(x.showItem(t),x.showItem(e),x.hideItem($$("tablePropBtnsSpace")))}(),i.$width<850?(x.hideItem(n),i.$width<850&&function(){const i=$$("tableContainer");x.hideItem(i),x.hideItem(n),x.showItem(e),t.config.width=window.innerWidth-45,t.resize()}()):(x.hideItem(e),t.config.width=350,t.resize())}()}},css:"edit-btn-icon",titleAttribute:"Показать/скрыть фильтры",adaptValue:n()}).maxView()}function In(t,e){const n=new D({config:{id:t+"-exportBtn",hotkey:"Ctrl+Shift+Y",hidden:e,icon:"icon-arrow-circle-down",click:function(){!function(t){try{webix.toExcel(t,{filename:"Table",filterHTML:!0,styles:!0}),p("success","Таблица сохранена")}catch(t){w(t,"toolbarTable","exportToExcel")}}(t)}},titleAttribute:"Экспорт таблицы"}).transparentView();return n}function _n(t,e){return{view:"template",id:t,css:"webix_style-template-count",height:30,template:function(){const n=$$(t).getValues();return 0!==Object.keys(n).length?"<div style='color:#999898;'>"+e+": "+n+" </div>":""}}}function Cn(t,e=!1){const n=t+"-findElements",i=t+"-idFilterElements";return{rows:[ge(t+"-templateHeadline"),{css:"webix_filterBar",padding:{bottom:4},height:40,cols:[yn(t,e),xn(t,e),{},_e(t),In(t,e)]},{cols:[_n(n,"Общее количество записей"),_n(i,"Видимое количество записей")]}]}}const kn={view:"form",id:"table-editForm",hidden:!0,css:"webix_form-edit",minHeight:350,minWidth:230,borderless:!0,scroll:!0,elements:[Q,O],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}},En="tableFilter => buttons => libSaveBtn",Sn=new D({config:{id:"filterLibrarySaveBtn",hotkey:"Shift+Esc",icon:"icon-file",disabled:!0,click:function(){try{webix.prompt({title:"Название шаблона",ok:"Сохранить",cancel:"Отменить",css:"webix_prompt-filter-lib",input:{required:!0,placeholder:"Введите название шаблона..."},width:350}).then((function(e){!async function(){const n=ke.userprefs.content,i=e;let o=!1;const r=v(),s={name:i,table:r,values:[]},c={name:r+"_filter-template_"+i,prefs:s};ke.userprefs&&(function(){const t=Object.keys(Ce),e=t.length;for(let n=0;n<e;n++){const e=t[n];Ce[e].forEach((function(t,e){try{const e=$$(t).getValue(),n=$$(t+"-btnFilterOperations").getValue(),i=$$(t+"_segmentBtn");let o=null;i.isVisible()&&(o=i.getValue());const r=function(t){let e=null;return t.config.columnName+"_filter"!==t.config.id&&(e=t.config.columnName),e}($$(t));!function(t,e,n,i,o){s.values.push({id:t,value:e,operation:n,logic:i,parent:o})}(t,e,n,o,r)}catch(t){w(t,En,"function libraryBtnClick => setOperation")}}))}}(),function(t){n.forEach((function(e,n){const s=r+"_filter-template_"+i;e.name==s&&(o=!0,S("Шаблон с таким именем существует","После сохранения предыдущие данные будут стёрты",["Отмена","Сохранить изменения"]).then((function(n){1==n&&function(){const n="/init/default/api/userprefs/"+e.id,o=webix.ajax().put(n,t);o.then((function(t){"i"==(t=t.json()).err_type?p("success","Шаблон «"+i+"»  сохранён в библиотеку"):p("error","tableFilter => buttons function modalBoxExists: "+t.err)})),o.fail((function(t){g(t,En,"saveExistsTemplate => putUserprefsData")}))}()})))}))}(c),o||function(){const e=webix.storage.local.get("user").id;e?c.owner=e:function(){const e=webix.ajax("/init/default/api/whoami");e.then((function(e){e=e.json().content,c.owner=e.id;const n={};n.id=e.id,n.name=e.first_name,n.username=e.username,t("user",JSON.stringify(n))})),e.fail((function(t){g(t,En,"saveTemplate => setDataStorage")}))}();const n=webix.ajax().post("/init/default/api/userprefs/",c);n.then((function(t){"i"==(t=t.json()).err_type?p("success","Шаблон «"+i+"»  сохранён в библиотеку"):p("error",t.error)})),n.fail((function(t){g(t,En,"saveTemplate => saveNewTemplate")}))}())}()}))}catch(t){w(t,En,"function filterSubmitBtn")}}},titleAttribute:"Сохранить шаблон с полями в библиотеку"}).minView(),Vn=new D({config:{id:"table-backTableBtnFilter",hotkey:"Shift+Q",hidden:!0,icon:"icon-arrow-left",click:function(){!function(){const t=$$("filterTableBarContainer"),e=$$("tableContainer");!function(){x.hideItem(t),x.showItem(e);const n=$$("table");n&&n.clearSelection()}(),function(){const t=document.querySelector(".webix_btn-filter"),e="webix-transparent-btn--primary";t.classList.contains(e)&&(t.classList.add("webix-transparent-btn"),t.classList.remove(e))}()}()}},titleAttribute:"Вернуться к таблице"}).minView(),Tn="tableFilter => userTemplate",Bn={};function jn(t,e){e&&t.setValue(e)}function An(t){const e=t.id,n=$$(e+"_segmentBtn"),i=$$(e+"-btnFilterOperations");jn(n,t.logic),jn(i,t.operation)}function Fn(t){const e=v();t=t.json().content;const n=$$("filterEditLib"),i=n.getValue(),o=n.getOption(i);try{t.forEach((function(t,n){t.name==e+"_filter-template_"+o.value&&function(t){Be(),t.values.forEach((function(t,e){t.parent?function(t){const e=Ue(y().getColumnConfig(t.parent)),n=t;n.id=e,An(n),jn($$(e),t.value)}(t):function(t){const e=t.id,n=$$(e);Te(1,n.config.columnName,e),An(t),jn(n,t.value)}(t)})),function(){function t(t,e){return t[t.length-e]}const e=t(Object.keys(Ce),1),n=t(Ce[e],1),i=$$(n+"_segmentBtn");x.hideItem(i)}()}(JSON.parse(t.prefs)),function(){const t=$$("popupFilterEdit");t&&t.destructor()}(),x.enableItem($$("btnFilterSubmit")),Bn.id=o.id,Bn.value=o.value}))}catch(t){w(t,Tn,"createFiltersByTemplate")}}const On="tableFilter => popup => buttons";const Pn=new D({config:{id:"popupFilterSubmitBtn",hotkey:"Shift+Space",disabled:!0,value:"Применить",click:function(){try{const t=$$("filterPopupTabbar").getValue();"editFormPopupLib"==t?function(){const t=webix.ajax("/init/default/api/userprefs/");t.then((function(t){Fn(t),Object.keys(Ce).forEach((function(t,e){const n=document.querySelector("."+t);Se(n,"webix_show-content"),Ve(n,"webix_hide-content")})),p("success","Рабочая область фильтра обновлена")})),t.fail((function(t){g(t,Tn,"getLibraryData")}))}():"editFormScroll"==t&&function(){x.enableItem($$("filterLibrarySaveBtn")),function(){const t=$$("editFormPopup").getValues(),e=[];try{const n=Object.keys(t);let i=!1;n.forEach((function(n,o){t[n]&&"selectAll"!==n?e.push(n):"selectAll"==n&&(i=!0);const r=$$(n).config.columnName;Te(t[n],r,n)})),function(t){const n=e.length;e.forEach((function(e,i){const o=$$(e).config.columnName,r=Ce[o],s=(c=r[r.length-1],$$(c+"_segmentBtn"));var c;i===n-1?x.hideItem(s):(i===n-2||t)&&x.showItem(s)}))}(i)}catch(t){w(t,On,"function createWorkspaceCheckbox")}}();const t=function(){const t=$$("filterTableForm").elements,e=Object.values(t);let n=0;try{e.forEach((function(t,e){t.config.hidden||n++}))}catch(t){w(t,On,"function getCheckboxData => visibleCounter")}return n}();t||(x.showItem($$("filterEmptyTempalte")),x.disableItem($$("btnFilterSubmit")),x.disableItem($$("filterLibrarySaveBtn"))),function(){const t=$$("popupFilterEdit");t&&t.destructor()}(),Bn&&(delete Bn.id,delete Bn.value),p("success","Рабочая область фильтра обновлена")}()}catch(t){w(t,On,"function popupSubmitBtn"),$$("popupFilterEdit").destructor()}Object.keys(Ce).length||x.showItem($$("filterEmptyTempalte"))}},titleAttribute:"Выбранные фильтры будутдобавлены в рабочее поле, остальные скрыты"}).maxView("primary"),Ln={cols:[Pn,{width:5},new D({config:{id:"editFormPopupLibRemoveBtn",hotkey:"Shift+Q",hidden:!0,disabled:!0,icon:"icon-trash",click:function(){S("Шаблон будет удалён","Вы уверены, что хотите продолжить?",["Отмена","Удалить"]).then((function(t){1==t&&async function(){const t=v(),e=$$("filterEditLib"),n=e.getValue(),i=e.getOption(n);if(ke.userprefs||await webix.ajax().get("/init/default/api/userprefs/").then((function(t){return ke.userprefs=t.json(),ke.userprefs})).fail((t=>{g(t,Ee,"getUserprefsData")})),ke.userprefs){const n=ke.userprefs.content,o=i.id,r=i.value,s=t+"_filter-template_"+r;n.forEach((function(t,n){t.name==s&&function(t,e,n,i){const o="/init/default/api/userprefs/"+t.id,r=webix.ajax().del(o,t);r.then((function(t){"e"!==(t=t.json()).err_type&&"x"!==t.err_type?(p("success","Шаблон « "+n+" » удален"),function(){try{i.config.options.forEach((function(t,o){t.id==e&&(t.value=n+" (шаблон удалён)",i.refresh(),i.disableOption(i.getValue()),i.setValue(""))}))}catch(t){w(t,On,"function deleteElement => removeOptionState")}}()):p("error",On+"function userprefsData: "+t.err)})),r.fail((function(t){g(t,On,"getLibraryData")}))}(t,o,r,e)}))}}()}))}},titleAttribute:"Выбранный шаблон будет удален"}).minView("delete")]},Nn="tableFilter => popup => tabbar => tabbar";function Dn(t){const e=$$("popupFilterSubmitBtn");"enable"==t?x.enableItem(e):"disable"==t&&x.disableItem(e)}function Rn(t){const e=$$("editFormPopupLibRemoveBtn");t?x.showItem(e):x.hideItem(e)}function Wn(t){"editFormPopupLib"==t&&function(){try{""!==$$("filterEditLib").getValue()?Dn("enable"):Dn("disable"),Rn(!0),function(){const t=$$("filterEditLib");Bn&&(t.setValue(Bn.id),x.enableItem($$("editFormPopupLibRemoveBtn")),Dn("disable"))}()}catch(t){w(t,Nn,"filterLibrary")}}(),"editFormScroll"==t&&function(){const t=$$("editFormPopup").getValues(),e=Object.values(t);let n=0;!function(){try{e.forEach((function(t,e){t&&n++}))}catch(t){w(t,Nn,"countChecked")}}(),Rn(!1),Dn(n>0?"enable":"disable")}()}function zn(t){return"<spanclass='webix_tabbar-filter-headline'>"+t+"</span>"}const Hn={view:"radio",id:"filterEditLib",vertical:!0,options:[],on:{onChange:function(){!function(){const t=$$("popupFilterSubmitBtn"),e=Bn.id,n=$$("filterEditLib"),i=n.getValue(),o=n.getOption(i);o&&o.id!==e?(x.enableItem($$("editFormPopupLibRemoveBtn")),x.enableItem(t)):x.disableItem(t)}()}}},Mn={view:"form",id:"editFormPopup",css:"webix_edit-form-popup",borderless:!0,elements:[{rows:[{rows:[{view:"tabbar",type:"top",id:"filterPopupTabbar",css:"webix_filter-popup-tabbar",multiview:!0,height:50,options:[{value:zn("Поля"),id:"editFormScroll"},{value:zn("Библиотека"),id:"editFormPopupLib"}],on:{onAfterTabClick:function(t){Wn(t)}}},{height:200,cells:[{view:"scrollview",id:"editFormScroll",borderless:!0,css:"webix_multivew-cell",scroll:"y",body:{id:"editFormPopupScroll",rows:[]}},{view:"form",scroll:!0,id:"editFormPopupLib",css:"webix_multivew-cell",borderless:!0,elements:[Hn]}]}]},{height:20},Ln]},{}]},Un="tableFilter => buttons => editBtn",qn=new D({config:{hotkey:"Alt+A",value:"Открыть редактор",click:function(){const t=v();function e(t){const e=$$("popupFilterSubmitBtn");t?e.enable():e.disable()}!function(){const t=new X({headline:"Редактор фильтров",config:{id:"popupFilterEdit",height:400,width:400},elements:{rows:[R("Выберите нужные поля или шаблон из библиотеки"),Mn]}});t.createView(),t.showPopup()}(),function(){const e=webix.ajax("/init/default/api/userprefs/");e.then((function(e){let n=webix.storage.local.get("user");try{if(n||(C(),n=webix.storage.local.get("user")),n){!function(n){const i=$$("filterEditLib");!function(){const t=[];i&&0!==i.config.options.length&&(i.config.options.forEach((function(e){t.push(e.id)})),t.forEach((function(t){i.removeOption(t)})))}();const o=e.json().content;try{o.forEach((function(e,o){if(e.name.includes("filter-template_")&&e.owner==n.id){const n=JSON.parse(e.prefs);n.table==t&&i.addOption({id:o+1,value:n.name})}}))}catch(t){w(t,Un,"function setTemplates")}}(n);const i=$$("filterEditLib");i&&0==i.data.options.length&&$$("filterEditLib").addOption({id:"radioNoneContent",disabled:!0,value:"Сохранённых шаблонов нет"})}}catch(t){w(t,Un,"function userprefsData")}})),e.fail((function(t){g(t,Un,"saveTemplate")}))}(),window.innerWidth<1200&&function(){const t=.89*window.innerWidth,e=$$("popupFilterEdit");try{e.config.width=t,e.resize()}catch(t){w(t,Un,"function userprefsData => popupSizeAdaptive")}}();const n={view:"checkbox",id:"selectAll",labelRight:"<div style='font-weight:600'>Выбрать всё</div>",labelWidth:0,name:"selectAll",on:{onChange:function(){e(!0),function(){const t=$$("editFormPopupScrollContent").getChildViews();try{t.forEach((function(t,e){t.config.id.includes("checkbox")&&($$("selectAll").getValue()?t.config.value=1:t.config.value=0,$$(t).refresh())}))}catch(t){w(t,Un,"function checkbox:onchange => setValueCheckbox")}}()}}};!function(){const t=[{cols:[{id:"editFormPopupScrollContent",css:"webix_edit-form-popup-scroll-content",rows:[n]}]}];try{const n=function(){const t=[],e=$$("filterTableForm").elements;try{Object.values(e).forEach((function(e,n){t.push({id:e.config.id,label:e.config.label})}))}catch(t){w(t,Un,"function editFiltersBtn => getAllCheckboxes")}return t}();n.forEach((function(n,i){if(!n.id.includes("child")){const i={view:"checkbox",id:n.id+"_checkbox",labelRight:n.label,labelWidth:0,name:n.id,on:{onChange:function(){!function(t){const n=$$(t.id+"_checkbox").getParentView().getChildViews();let i=0;try{!function(){try{n.forEach((function(t,e){if(t.config.id.includes("checkbox")){const e=t.config.value;e&&""!=e||i++}t.config.value}))}catch(t){w(t,Un,"function checkboxOnChange => getStatusCheckboxes")}}(),e(!0),function(){try{const t=$$("selectAll");0==i?(t.config.value=1,t.refresh()):0!==t.config.value&&(t.config.value=0,t.refresh())}catch(t){w(t,Un,"function checkboxOnChange => setSelectAllState")}}()}catch(t){w(t,Un,"function checkboxOnChange")}}(n)}}},o=$$(n.id),r=$$(n.id+"_rows").getChildViews();o&&o.isVisible()||r.length>1?(i.value=1,t[0].cols[0].rows.push(i)):t[0].cols[0].rows.push(i)}}));const i=$$("editFormPopupScroll");i&&i.addView({rows:t},1)}catch(t){w(t,Un,"function createCheckboxes")}}();let i=0;const o=$$("editFormPopupScrollContent").getChildViews();!function(){try{o.forEach((function(t,e){if(t.config.id.includes("checkbox")){const e=t.config.value;e&&""!=e||i++}}))}catch(t){w(t,Un,"function countSelectCheckboxes")}}(),function(){try{const t=$$("selectAll");0==i&&(t.config.value=1,t.refresh())}catch(t){w(t,Un,"function stateSelectAll")}}()}},titleAttribute:"Добавить/удалить фильтры"}).maxView(),Jn="tableFilter => buttons => submitBtn",Yn=new D({config:{id:"btnFilterSubmit",hotkey:"Ctrl+Shift+Space",disabled:!0,value:"Применить фильтры",click:function(){let t=[];function e(t){const e=function(t){return v()+"."+t}(t.name),n=function(t,e){let n="'"+e+"'";return 1!=e&&2!=e||function(t){const e=y().getColumnConfig(t);let n=!1;return e.type&&"boolean"===e.type&&(n=!0),n}(t)&&(n=function(t){return 1==t||2!=t&&void 0}(e)),n}(t.name,t.value),i=function(t){let e=null;return"1"==t?e="+and+":"2"==t&&(e="+or+"),e}(t.logic),o=function(t){let e;return"="!==t&&t?"!="===t?e="+!=+":"<"===t?e="+<+":">"===t?e="+>+":"<="===t?e="+<=+":">="===t?e="+>=+":"⊆"===t&&(e="+contains+"):e="+=+",e}(t.operation);let r=e+o+n;return i&&(r+=i),r}if($$("filterTableForm").validate()){!function(){const n=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s");(function(){const t=Object.keys(Ce),e=t.length,n=[];let i=[];for(let n=0;n<e;n++){const e=t[n];i=i.concat(Ce[e])}return i.forEach((function(t,e){const i=$$(t).config.columnName,o=$$(t).getValue(),r=$$(t+"-btnFilterOperations").getValue(),s=function(t){const e=$$(t+"_segmentBtn");let n=null;return e.isVisible()&&(n=e.getValue()),n}(t);n.push({id:t,name:i,value:o,operation:r,logic:s})})),n})().forEach((function(i,o){let r=i.id,s=i.value;$$(r)&&("datepicker"==$$(r).config.view&&(s=n(s)),function(){const t=$$(r).config.text;t&&"Нет"==t&&(s=0)}(),t.push(e(i)))}))}();const n=y(),i=t.join("");n.config.filter={table:n.config.idTable,query:i};const o=webix.ajax("/init/default/api/smarts?query="+i);o.then((function(t){const e=(t=t.json()).reccount,i=t.err_type,o=t.err;t=t.content,"i"==i?(function(){try{n.clearAll(),0!==t.length?(n.hideOverlay("Ничего не найдено"),n.parse(t)):n.showOverlay("Ничего не найдено")}catch(t){w(t,Jn,"function filterSubmitBtn => setData")}}(),function(){try{$$("table-idFilterElements").setValues(e.toString())}catch(t){w(t,Jn,"setCounterVal")}}(),x.hideItem($$("tableFilterPopup")),p("success","Фильтры успшено применены")):p("error",o)})),o.fail((function(t){g(t,Jn,"createGetData")}))}else p("error","Не все поля формы заполнены")}},titleAttribute:"Применить фильтры"}).maxView("primary"),Kn="tableFilter => buttons => resetBtn";function Gn(){const t=v(),e=y(),n="/init/default/api/smarts?"+[`query=${t}.id+%3E%3D+0&sorts=\n        ${t}.id&limit=80&offset=0`],i=webix.ajax(n);i.then((function(t){const n=t.json();if(t=t.json().content,"i"==n.err_type){try{!function(t,e){try{0!==t.length?(e.hideOverlay("Ничего не найдено"),e.clearAll(),e.parse(t)):(e.clearAll(),e.showOverlay("Ничего не найдено"))}catch(t){w(t,Kn,"setDataTable")}}(t,e),function(t){try{const e=$$("table-idFilterElements"),n=t.count().toString();e.setValues(n)}catch(t){w(t,Kn,"setFilterCounterVal")}}(e),Object.keys(Ce).forEach((function(t,e){var n;(n=Ce[t])&&n.forEach((function(t,e){if(t.includes("_filter-child-")){const e=$$(t+"-container");x.removeItem(e)}}))})),function(){const t=$$("filterTableForm");t&&t.clear()}(),function(){const t=document.querySelectorAll(".webix_filter-inputs"),e="webix_hide-content";try{t.forEach((function(t,n){t.classList.contains(e)||t.classList.add(e)}))}catch(t){w(t,Kn,"hideInputsContainer")}}(),Be(),x.hideItem($$("tableFilterPopup")),x.disableItem($$("filterLibrarySaveBtn")),x.disableItem($$("resetFilterBtn")),x.showItem($$("filterEmptyTempalte"))}catch(t){w(t,Kn,"resetFilterBtn")}p("success","Фильтры очищены")}else p("error","tableFilter => buttons function resetFilterBtn ajax: "+n.err)})),i.fail((function(t){g(t,Kn,"resetFilterBtn")}))}const Qn=new D({config:{id:"resetFilterBtn",hotkey:"Shift+Esc",disabled:!0,icon:"icon-trash",click:function(){const t=y();try{Gn(),t.config.filter=null}catch(t){w(t,"Ошибка при очищении фильтров; tableFilter => buttons","function resetFilterBtn")}}},titleAttribute:"Сбросить фильтры"}).minView("delete");function Xn(t){return"formResetBtn"==t?Qn:"formBtnSubmit"==t?Yn:"formEditBtn"==t?qn:"filterBackTableBtn"==t?Vn:"formLibrarySaveBtn"==t?Sn:void 0}const Zn={view:"form",hidden:!0,id:"filterTableForm",minHeight:350,scroll:!0,elements:[{css:"webix_form-adaptive",rows:[{rows:[{margin:2,cols:[Xn("filterBackTableBtn"),Xn("formEditBtn"),Xn("formResetBtn")]}]},{id:"btns-adaptive",rows:[{margin:2,cols:[Xn("formBtnSubmit"),Xn("formLibrarySaveBtn")]}]}]},{id:"filterEmptyTempalte",rows:[R("Добавьте фильтры из редактора")]}],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}},ti={view:"button",id:"table-backFormsBtnFilter",type:"icon",icon:"icon-arrow-right",value:"Вернуться к таблице",height:28,minWidth:50,width:55,click:function(){!function(){const t=$$("formsTools"),e=$$("formsContainer"),n=$$("formsTools-resizer");t&&t.isVisible()&&(t.hide(),n.hide()),e&&!e.isVisible()&&e.show(),function(){const t=document.querySelector(".webix_btn-filter"),e="webix-transparent-btn--primary";t.classList.contains(e)&&(t.classList.add("webix-transparent-btn"),t.classList.remove(e))}()}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Вернуться к таблице")}}},ei={id:"viewTools",padding:10,rows:[{cols:[{template:"Действия",height:30,css:"popup_headline",borderless:!0},{},ti]},{id:"viewToolsContainer",rows:[{}]}]},ni="router => common";function ii(t){t||(function(){try{$$("dashboards")||$$("container").addView({view:"layout",id:"dashboards",hidden:!0,scroll:"auto",rows:[{view:"scrollview",id:"dashScroll",body:{view:"flexlayout",id:"dashboardContainer",cols:[{id:"dashboardInfoContainer",minWidth:250,rows:[]},{view:"resizer"},k]}}]},3)}catch(t){w(t,ni,"createDashboards")}}(),function(){try{if(!$$("tables")){$$("container").addView({id:"tables",hidden:!0,view:"scrollview",body:{view:"flexlayout",id:"flexlayoutTable",cols:[{id:"tableContainer",rows:[Cn("table"),{view:"resizer",class:"webix_resizers"},T("table",ht,!0)]},{view:"resizer",class:"webix_resizers",id:"tableBarResizer"},kn,{id:"filterTableBarContainer",minWidth:250,width:350,hidden:!0,rows:[{id:"editFilterBarAdaptive",rows:[Zn]}]}]}},5);const t=$$("table");ce(t),ae(t),function(t){t.attachEvent("onScrollY",(function(){const t=this,e=t.getScrollState(),n=t._dtable_height,i=t._dtable_offset_height;n-e.y==i&&se(t)}))}(t),pe(t),le(t)}}catch(t){w(t,ni,"createTables")}}(),function(){try{if(!$$("forms")){$$("container").addView({view:"layout",id:"forms",css:"webix_tableView",hidden:!0,rows:[{cols:[{id:"formsContainer",rows:[Cn("table-view",!0),{view:"resizer",class:"webix_resizers"},{view:"scrollview",body:{view:"flexlayout",cols:[T("table-view")]}}]},{view:"resizer",id:"formsTools-resizer",hidden:!0,class:"webix_resizers"},("propTableView",{view:"property",id:"propTableView",tooltip:"Имя: #label#<br> Значение: #value#",width:348,nameWidth:150,editable:!0,scroll:!0,hidden:!0}),{id:"formsTools",hidden:!0,minWidth:190,rows:[ei]}]}]},6);const t=$$("table-view");ce(t),ae(t),pe(t),le(t)}}catch(t){w(t,ni,"createForms")}}()),function(){try{"treeTempl"==t&&($$("treeTempl")||($$("container").addView({view:"layout",id:"treeTempl",hidden:!0,scroll:"auto",rows:Ot()},4),webix.ui(function(){const t=$$("editTreeCombo"),e=t.getPopup().getList();function n(){const e=t.getPopup().getList();return Object.values(e.data.pull)}return{view:"contextmenu",id:"contextMenuEditTree",data:["Добавить","Переименовать",{$template:"Separator"},"Свернуть всё","Развернуть всё",{$template:"Separator"},"Удалить"],master:$$("treeEdit"),on:{onMenuItemClick:function(i){const o=this.getContext(),r=$$("treeEdit"),s=r.getItem(o.id),c="/init/default/api/trees/";let a={name:"",pid:"",owner:null,descr:"",ttype:1,value:"",cdt:null};switch(this.getMenu(i).getItem(i).value){case"Добавить":{const t=prompt("Имя нового подэлемента '"+s.value+"'","");if(null!=t){a.name=t,a.pid=s.id;const i=webix.ajax().post(c,a);i.then((function(i){try{if("i"==(i=i.json()).err_type){let c=i.content.id;r.data.add({id:c,value:t,pid:s.id},0,s.id),r.open(s.id);const a={id:s.id,value:s.value};o=a,n().forEach((function(t,n){t.id!==o.id&&e.parse(o)})),p("success","Данные сохранены")}else w(i.err,"editTree","case add post msg")}catch(t){w(t,"editTree","case add")}var o})),i.fail((function(t){g(t,"editTree","case add")}))}break}case"Переименовать":var l=prompt("Новое имя",s.value);if(null!=l){a.name=l,a.id=s.id,a.pid=s.pid;const t=webix.ajax().put(c+s.id,a);t.then((function(t){try{"i"==(t=t.json()).err_type?(s.value=l,r.updateItem(s.id,s),i={id:s.id,value:s.value},n().forEach((function(t,n){t.id==i.id&&e.parse(i)})),p("success","Данные изменены")):w(t.err,"editTree","case rename put msg")}catch(t){w(t,"editTree","case rename")}var i})),t.fail((function(t){g(t,"editTree","case rename")}))}break;case"Удалить":{const e=webix.ajax().del(c+s.id,s);e.then((function(e){try{"i"==(e=e.json()).err_type?(r.remove(s.id),i={id:s.id,value:s.value},n().forEach((function(e,n){e.id==i.id&&t.getList().remove(i.id)})),p("success","Данные удалены")):w(e.err,"editTree","case delete del msg")}catch(t){w(t,"editTree","case delete")}var i})),e.fail((function(t){g(t,"editTree","case delete")}));break}case"Развернуть всё":try{r.open(s.id),r.data.eachSubItem(s.id,(function(t){r.open(t.id)}))}catch(t){w(t,"editTree","case open all")}break;case"Свернуть всё":try{r.close(s.id),r.data.eachSubItem(s.id,(function(t){r.close(t.id)}))}catch(t){w(t,"editTree","case close all")}}}}}}())))}catch(t){w(t,ni,"createTreeTempl")}}(),function(){try{"cp"==t&&$$("container").addView({view:"layout",id:"user_auth",css:"webix_auth",hidden:!0,rows:[gt,{}]},7)}catch(t){w(t,ni,"createCp")}}(),function(){try{"settings"==t&&$$("container").addView({view:"layout",id:"settings",css:"webix_auth",hidden:!0,rows:[At]},8)}catch(t){w(t,ni,"createUserprefs")}}()}function oi(){function e(){c.content("mmenu").then((function(){!function(t){const e=[],n=[],i=$$("tree"),o=$$("button-context-menu");let r=[];t.forEach((function(t,i){3!==t.mtype?(e.push(function(t){let e;try{e={id:t.name,value:t.title,action:t.action},t.title||(e.value="Без названия"),2==t.mtype&&(0==t.childs.length?e.webix_kids=!0:e.data=function(t){let e=[];try{t.childs.forEach((function(t,n){e.push({id:t.name,value:t.title,action:t.action})}))}catch(t){w(t,ni,"generateChildsTree")}return e}(t))}catch(t){w(t,ni,"generateParentTree")}return e}(t)),0!==t.childs.length&&(r=function(t){const e=[];function n(t,n,i){const o={id:t,value:n,icon:i};return"logout"==t&&(o.css="webix_logout"),e.push(o),e}return n("favs","Избранное","icon-star"),n("settings","Настройки","icon-cog"),n("cp","Смена пароля","icon-lock"),n("logout","Выйти","icon-sign-out"),e}())):(n.push(t.name),e.push({id:t.name,disabled:!0,value:""}))})),i.clearAll(),i.parse(e),void 0!==o.config.popup.data&&(o.config.popup.data=r,o.enable()),n.forEach((function(t){i.addCss(t,"tree_delim-items")}))}(a.content)}))}!async function(){r.whoami||await s("whoami"),r.whoami&&(function(){try{$$("userAuth").hide(),$$("mainLayout").show()}catch(t){window.alert("showMainContent: "+t+" (Подробности: ошибка в отрисовке контента)"),w(t,ni,"showMainContent")}}(),function(){const e={};e.id=r.whoami.content.id,e.name=r.whoami.content.first_name,e.username=r.whoami.content.username,t("user",JSON.stringify(e))}(),ii(),e())}()}function ri(){try{0==$$("tree").data.order.length&&oi()}catch(t){w(t,ni,"checkTreeOrder")}}function si(){try{$$("tree")&&$$("tree").closeAll()}catch(t){w(t,ni,"closeTree")}}function ci(){try{$$("container").getChildViews().forEach((function(t,e){if("scrollview"==t.config.view||"layout"==t.config.view){const e=$$(t.config.id);e.isVisible()&&e.hide()}}))}catch(t){w(t,ni,"hideAllElements")}}let ai,li,ui;function fi(){const t=function(){let t;return ui&&ui.values.length&&(t=function(){const t=[];return ui.values.forEach((function(e){t.push(e.width),ai.setColumnWidth(e.column,e.width)})),t}()),t}().reduce(((t,e)=>+t+ +e),0),e=function(){const t=$$("tree").$width;return window.innerWidth-t}();if(t<e){const n=function(){const t=ai.getColumns();return t[t.length-1]}(),i=e-t,o=n.width+i;ai.setColumnWidth(n.id,o)}}function di(t,e){ai=t,li=e;const n="visibleColsPrefs_"+li;ui=webix.storage.local.get(n);const i=ai.getColumns(!0);ui&&ui.values.length?(function(t){t.forEach((function(t,e){if(function(t){let e=!1;return ui.values.forEach((function(n){n.column==t&&(e=!0)})),e}(t.id))ai.isColumnVisible(t.id)||ai.showColumn(t.id);else{const e=ai.getColumnIndex(t.id);ai.isColumnVisible(t.id)&&-1!==e&&ai.hideColumn(t.id)}}))}(i),ui.values.forEach((function(t){ai.moveColumn(t.column,t.position)})),fi()):i.forEach((function(t,e){!function(t){const e=function(){let t;return t=ui&&ui.values.length?length:ai.getColumns(!0).length,t}(),n=(function(){let t;return t=window.innerWidth-$$("tree").$width-25,t}()-17)/e;ai.setColumnWidth(t,n)}(t.id)}))}const hi="table => createSpace => cols => createCols";let pi,mi;function bi(t,e){const n=l.item(t),i=n.fields,o=Object.keys(n.fields),r=[];pi=$$(e);try{o.forEach((function(t){var e;mi=i[t],(e=mi.type).includes("reference")?function(){try{const t=mi.type.slice(10);mi.editor="combo",mi.collection=I(t),mi.template=function(t,e,n,i){const o=t[i.id],r=i.collection.getItem(o);return r?r.value:""}}catch(t){w(t,hi,"createReferenceCol")}}():"datetime"==e?function(){try{mi.format=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s"),mi.editor="date",mi.css={"text-align":"right"}}catch(t){w(t,hi,"createTableCols => createDatetimeCol")}}():"boolean"==e?function(){try{mi.editor="combo",mi.sort="text",mi.collection=[{id:1,value:"Да"},{id:2,value:"Нет"}]}catch(t){w(t,hi,"createTableCols => createBoolCol")}}():"integer"==e||"id"==e?function(){try{mi.editor="text",mi.sort="int",mi.numberFormat="1 111",mi.css={"text-align":"right"}}catch(t){w(t,hi,"createTableCols => createIntegerCol")}}():function(){try{mi.editor="text",mi.sort="string"}catch(t){w(t,hi,"createTableCols => createTextCol")}}(),function(t){mi.id=t}(t),function(t){const e=Object.values(t).length,n=($$("tableContainer").$width-17)/e;mi.width=n}(i),mi.header=mi.label,"id"==mi.id&&function(){const t=webix.storage.local.get("userprefsOtherForm");t&&"2"==t.visibleIdOpt&&(mi.hidden=!0)}(),mi.label&&r.push(mi)})),function(t){pi&&pi.refreshColumns(t)}(r),di(pi,t)}catch(t){w(t,hi,"createTableCols")}return r}const gi="table => createSpace => dynamicElements => buttonLogic";let wi,$i,vi,yi;const xi=[];function Ii(t,e,n,i){wi=t,$i=e,vi=n,yi=i,xi.length=0,"get"==vi?"refresh"==yi?function(){!function(){try{wi.forEach(((t,e)=>{const n=$$(t.id).getValue();if(t.id.includes("customCombo")){const e=$$(t.id).getText();xi.push(t.name+"="+e)}else(t.id.includes("customInputs")||t.id.includes("customDatepicker"))&&xi.push(t.name+"="+n)}))}catch(t){w(t,gi,"createQueryRefresh")}}();const t=$i+"?"+xi.join("&"),e=webix.ajax(t);e.then((function(t){const e=$$("table-view");"i"==(t=t.json().content).json().err_type?(function(t,e){try{t.clearAll(),0!==e.length?(t.hideOverlay("Ничего не найдено"),t.parse(e),p("success","Данные обновлены")):t.showOverlay("Ничего не найдено")}catch(t){w(t,gi,"refreshButton => setTableState")}}(e,t),function(t){try{const e=$$("table-view-findElements"),n=t.count().toString();e.setValues(n)}catch(t){w(t,gi,"setTableCounter")}}(e)):w(t.err,gi,"refreshButton")})),e.fail((function(t){g(t,gi,"refreshButton")}))}():"download"==yi&&webix.ajax().response("blob").get($i,(function(t,e,n){try{webix.html.download(e,"table.docx")}catch(t){w(t,gi,"downloadButton")}})).catch((t=>{g(t,gi,"downloadButton")})):"post"==vi&&function(){try{wi.forEach(((t,e)=>{if(t.id.includes("customUploader")){const e=$$(t.id).files.data.pull,n=Object.values(e)[0],i=$$(t.id).config.upload;let o=new FormData;!function(t){t.addView({id:"templateLoad",template:function(){const t=$$("templateLoad").getValues();return 0!==Object.keys(t).length?t:"Загрузка ..."},borderless:!0})}($$(t.id).getParentView()),o.append("file",n.file),async function(t,e){fetch(e,{method:"POST",body:t}).then((t=>t.json())).then((function(t){const e=$$("templateLoad");"i"==t.err_type?(e.setValues("Файл загружен"),p("success","Файл успешно загружен")):(e.setValues("Ошибка"),p("error",t.err))})).catch((function(t){w(t,gi,"uploadData")}))}(o,i)}}))}catch(t){w(t,gi,"postButton")}}()}const _i="table => createSpace => dynamicElements => createInputs";let Ci,ki,Ei,Si;function Vi(t){t.getNode().firstElementChild.style.width=t.$width+"px",t.getInputNode().style.width=t.$width-5+"px"}function Ti(){const t="/init/default/api/"+Ei.apiname;return new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get(t).then((function(t){const e=t.json().content,n=[];let i;function o(t,e){return{id:t+1,value:e}}return function(){try{void 0!==e[0].name?e.forEach((function(t,e){i=o(e,t.name),n.push(i)})):e.forEach((function(t,e){i=o(e,t),n.push(i)}))}catch(t){w(t,_i,"generateCustomInputs => getOptionData")}}(),n})).catch((t=>{console.log(t),g(t,_i,"generateCustomInputs => getOptionData")}))}}})}function Bi(t){const e=t.getParentView().getChildViews(),n=[];try{e.forEach(((t,e)=>{const i=t.config.view,o=t.config.id;void 0!==o&&("text"==i?n.push({id:o,name:"substr"}):"combo"==i?n.push({id:o,name:"valtype"}):"uploader"!=i&&"datepicker"!=i||n.push({id:o}))}))}catch(t){w(t,_i,"generateCustomInputs => getInputsId")}return n}function ji(t,e){ki=e,Ci=t,Si=Ci.inputs;const n=[];return Object.keys(Ci.inputs).forEach(((t,e)=>{if(Ei=Si[t],"string"==Ei.type)n.push(function(t){return{view:"text",placeholder:Ei.label,id:"customInputs"+t,height:48,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",Ei.comment),Vi(this)},onChange:function(){$$("customInputs").getChildViews().forEach((function(t,e){const n=t.config.view,i=$$(t.config.id);"button"!=n||i.isEnabled()||i.enable()}))}}}}(e));else if("apiselect"==Ei.type)n.push(function(t,e){return{view:"combo",height:48,id:"customCombo"+e,placeholder:Ei.label,labelPosition:"top",options:{data:Ti()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",Ei.comment),Vi(this)}}}}(0,e));else if("submit"==Ei.type||"button"==Ei.type){const t=Ei.action,i=Ci.actions[t];"DELETE"==i.verb&&"submit"!==t?function(t){const e=$$(ki),n=e.getColumns().length,i=e.config.columns;try{i.splice(n,0,{id:"action"+t,header:"Действие",label:"Действие",css:"action-column",maxWidth:100,template:"{common.trashIcon()}"}),e.refreshColumns()}catch(t){w(t,_i,"generateCustomInputs => createDeleteAction")}}(e):"DELETE"==i.verb?n.push(function(t,e){return new D({config:{id:"customBtnDel"+e,hotkey:"Shift+Q",icon:"icon-trash",value:Ei.label,click:function(e){Ii(Bi(this),t.url,"delete")}},titleAttribute:Ei.comment}).minView("delete")}(i,e)):n.push(function(t,e){const n=new D({config:{id:"customBtn"+e,value:Ei.label,click:function(n){!function(t,e,n,i){const o=Bi(i),r=$$("contextActionsPopup");"GET"==t.verb?"refresh"==t.rtype?Ii(o,t.url,"get","refresh"):"download"==t.rtype&&Ii(o,t.url,"get","download"):"POST"==t.verb?(Ii(o,t.url,"post"),$$("customBtn"+e).disable()):"download"==t.verb&&Ii(o,t.url,"get","download"),x.hideItem(r)}(t,e,0,this)}},titleAttribute:Ei.comment,onFunc:{onViewResize:function(){Vi(this)}}}).maxView("primary");return n}(i,e))}else"upload"==Ei.type?n.push(function(t){return{view:"uploader",value:"Upload file",id:"customUploader"+t,height:42,autosend:!1,upload:Ci.actions.submit.url,label:Ei.label,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",Ei.comment),Vi(this),this.getParentView().getChildViews().forEach((function(t,e){t.config.id.includes("customBtn")&&t.disable()}))},onBeforeFileAdd:function(){const t=$$("templateLoad");t&&t.getParentView().removeView(t)},onAfterFileAdd:function(t){this.getParentView().getChildViews().forEach((function(t,e){t.config.id.includes("customBtn")&&t.enable()}))}}}}(e)):"datetime"==Ei.type?n.push(function(t){return{view:"datepicker",format:"%d.%m.%Y %H:%i:%s",placeholder:Ei.label,id:"customDatepicker"+t,timepicker:!0,labelPosition:"top",height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",Ei.comment),Vi(this)},onChange:function(){try{$$("customInputs").getChildViews().forEach((function(t,e){const n=$$(t.config.id);"button"!=t.config.view||n.isEnabled()||n.enable()}))}catch(t){w(t,_i,"generateCustomInputs => createDatepicker onChange")}}}}}(e)):"checkbox"==Ei.type&&n.push(function(t){return{view:"checkbox",id:"customСheckbox"+t,css:"webix_checkbox-style",labelRight:Ei.label,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",Ei.comment)},onChange:function(){try{$$("customInputs").getChildViews().forEach((function(t,e){const n=t.config.view,i=$$(t.config.id);"button"!=n||i.isEnabled()||i.enable()}))}catch(t){w(t,_i,"generateCustomInputs => createCheckbox onChange")}}}}}(e))})),n}let Ai,Fi,Oi,Pi,Li,Ni,Di="webix-transparent-btn",Ri="webix-transparent-btn--primary";function Wi(){x.hideItem($$("propTableView")),function(){const t=$$("viewTools");Pi=document.querySelector(".webix_btn-filter"),Pi.classList.contains(Ri)?(Pi.classList.add(Di),Pi.classList.remove(Ri),x.hideItem(Ni),x.hideItem(Li)):Pi.classList.contains(Di)&&(Pi.classList.add(Ri),Pi.classList.remove(Di),x.showItem(Ni),x.showItem(Li),x.showItem(t))}(),function(){Li=$$("formsTools-resizer");const t=$$("container").$width;Pi.classList.contains(Di)?(x.hideItem(Ni),x.hideItem(Li),x.hideItem($$("table-backFormsBtnFilter")),x.showItem($$("formsContainer"))):(t<850?(x.hideItem($$("tree")),t<850&&(x.hideItem($$("formsContainer")),x.hideItem($$("tree")),x.showItem($$("table-backFormsBtnFilter")),x.hideItem(Li),Ni.config.width=window.innerWidth-45,Ni.resize())):(x.hideItem($$("table-backFormsBtnFilter")),Ni.config.width=350,Ni.resize()),x.showItem(Li))}()}const zi="getContent => getInfoTable";let Hi,Mi,Ui,qi;async function Ji(){await c.content("fields"),l.keys&&(function(t,e,n){let i,o,r=!1;const s=l.item(e),c=$$(n);if(t.forEach((function(t,e){"action"==t.type&&"detail"==s.actions[t.id].rtype&&(r=!0,i=e,o=t.id)})),void 0!==o){const t=s.actions[o].url;r&&(c.config.columns.splice(0,0,{id:"action-first"+i,maxWidth:130,src:t,css:"action-column",label:"Подробнее",header:"Подробнее",template:"<span class='webix_icon wxi-angle-down'></span> "}),c.refreshColumns())}}(bi(Ui,qi),Ui,qi),Fi=qi,Oi=Ui,Ai=l.item(Oi),function(){x.removeItem($$("contextActionsBtn"));const t=$$("viewToolsBtn");if(Ni=$$("formsTools"),Ai.inputs){const e=ji(Ai,Fi),n=$$("table-view-filterId").getParentView(),i=new D({config:{id:"viewToolsBtn",hotkey:"Ctrl+Shift+G",icon:"icon-filter",click:function(){Wi()}},css:"webix_btn-filter",titleAttribute:"Показать/скрыть фильтры доступные дейсвтия"}).transparentView();t?x.showItem(t):n.addView(i,2),function(t){const e={id:"customInputs",css:"webix_custom-inp",rows:[{height:20},{rows:t}]};try{$$("viewToolsContainer").addView(e,0)}catch(t){w(t,"table => createSpace => dynamicElements => createElements","maxInputsSize")}}(e)}else x.hideItem(Ni),x.hideItem(t)}(),re(qi,Ui),function(t,e){try{const n=l.names;n&&n.forEach((function(n,i){if(n.id==e){const e=$$(t+"-templateHeadline"),i=n.name.toString();e.setValues(i)}}))}catch(t){w(t,zi,"setTableName")}}(qi,Ui))}function Yi(t,e){qi=t,Ui=e,Mi=$$("tree").getItem(Ui),Hi=$$(qi+"-filterId").getParentView(),Mi||(Mi=Ui),null==Mi?p("error","Данные не найдены"):(function(){try{if($$(qi).clearAll(),"table-view"==qi){const t=$$("contextActionsPopup");t&&t.destructor(),x.removeItem($$("contextActionsBtnAdaptive")),x.removeItem($$("customInputs")),x.removeItem($$("customInputsMain"))}}catch(t){w(t,zi,"preparationTable")}}(),Ji())}const Ki=webix.uid(),Gi={navigate:!0,field:"auth_group",params:{filter:"auth_group.id > 3"}};function Qi(t){const e=function(t){const e={name:"dashboards_context-prefs_"+Ki,prefs:t},n=webix.storage.local.get("user").id;return n&&(e.owner=n),e}(t),n=webix.ajax().post("/init/default/api/userprefs/",e);n.then((function(e){"i"==(e=e.json()).err_type?function(t){const e=function(t){if(t)return"tree/"+t+"?prefs="+Ki}(t);Backbone.history.navigate(e,{trigger:!0}),window.location.reload()}(t.field):p("error",e.error)})),n.fail((function(t){g(t,"table => createSpace => click => itemClickLogic","postPrefs")}))}function Xi(t,e,n){t.forEach((function(t,i){t.tagName&&(t.getAttribute("webix_area_id")==n||e)&&(t.style.cursor="pointer")}))}function Zi(t){return"chart"==t.view?(t.borderless=!0,t.minWidth=250,t.on={onAfterRender:function(){const e=this.getNode().getElementsByTagName("map").item(0);if(e){const n=e.childNodes;t.action?Xi(n,!0):t.data&&t.data.forEach((function(t,e){t.action&&Xi(n,!1,t.id)}))}},onItemClick:function(e){async function n(t){await c.content("fields");const e=l.keys;let n=t;t&&t.field&&(n=t.field),e.forEach((function(e,i){e==n&&(t.navigate?Qi(t):console.log("В процессе разработки"))}))}if(console.log("пример: ",Gi),console.log("navigate: true - переход на другую страницу, false - обновление таблицы в дашборде"),t.action)n(t.action);else{let i;t.data.forEach((function(t,n){t.id==e&&(i=t)}));const o=i.action;o&&n(o)}}}):t.view,t}const to="dashboards => createSpace => dynamicElements => chartsLayout";function eo(t){return{template:t,borderless:!0,height:35,css:{"font-weight":"400!important","font-size":"17px!important"}}}function no(t){const e=function(t){const e=[];try{t.forEach((function(t,n){t.cols||t.rows?function(t){let e;(t.rows||t.cols).forEach((function(t,n){const i=t.rows||t.cols;e=function(t){let e;const n=[];return function t(e){e.forEach((function(e,i){const o=e.rows||e.cols;e.rows||e.cols?t(o):(e.view&&"chart"==e.view&&(e=Zi(e)),n.push(e))}))}(t),n.length&&(e=n),e}(i)}))}(t):t=Zi(t);const i=t.title;delete t.title,e.push({css:"webix_dash-chart",rows:[eo(i),t]})}))}catch(t){w(t,to,"createChart")}return e}(t);return{id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",rows:[{type:"wide",rows:e}]}}function io(t){return{view:"scrollview",scroll:"y",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[no(t)]}}}function oo(t,e){const n=ge("dash-template"),i=$$("dashboardInfoContainer"),o={id:"dashboardInfoContainerInner",rows:[n,io(e)]};try{i.addView(o)}catch(t){w(t,to,"createFilterLayout")}!async function(t){const e=function(t){const e=$$("tree");let n;return t?n=t:e.getSelectedItem()&&(n=e.getSelectedItem().id),n}(t);try{await c.content("fields");const t=l.names;t&&t.forEach((function(t,n){if(t.id==e){const e=$$("dash-template"),n=t.name.toString();e.setValues(n)}}))}catch(t){w(t,to,"setTableName")}}(t)}const ro="dashboards => createSpace => dynamicElems";let so,co,ao,lo;function uo(t){try{const e=$$("logLayout");e.config.height=t,e.resize()}catch(t){w(t,ro,"setScrollHeight")}}function fo(t){ao?(x.removeItem($$("dashboardInfoContainerInner")),x.removeItem($$("dash-template")),oo(co,t)):(oo(co,t),function(t){(function(t){const e={id:"dashboard-tool-main",padding:20,hidden:!0,minWidth:250,rows:[{id:"dashboardToolHeadContainer",cols:[{template:"Фильтр",height:30,css:"webix_dash-filter-headline",borderless:!0},{view:"button",id:"dash-backDashBtn",type:"icon",icon:"icon-arrow-right",value:"Вернуться к дашбордам",hidden:!0,height:15,hotkey:"esc",minWidth:50,width:55,click:function(){x.hideItem($$("dashboardTool")),x.showItem($$("dashboardInfoContainer"))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Вернуться к дашбордам")}}}]},{rows:t}]};try{$$("dashboardTool").addView(e)}catch(t){w(t,"dashboard => createSpace => dynamicElements => filterLayout","createMainView")}})(t),function(){const t={view:"button",id:"dashFilterBtn",css:"webix-transparent-btn",type:"icon",icon:"icon-filter",width:50,click:function(){!function(){const t=$$("dashboard-tool-main"),e=$$("dashboardContainer"),n=$$("tree"),i=$$("dash-backDashBtn"),o=$$("dashboardTool"),r=$$("dashboardInfoContainer");if(t.isVisible()?x.hideItem(o):(x.showItem(o),x.showItem(t)),e.$width<850)x.hideItem(n),e.$width<850&&(x.hideItem(n),x.hideItem(r),x.showItem(o),x.showItem(i),o.config.width=window.innerWidth-45,o.resize());else{x.hideItem(i);const t=$$("dashboardTool");350!==t.config.width&&(t.config.width=350,t.resize())}}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть фильтры")}}};!function(t){const e=$$("dash-template").getParentView(),n=$$(e.config.id);$$("dashFilterBtn")||n.addView({id:"dashboard-tool-btn",cols:[t]},2)}(t)}()}(so))}function ho(t,e,n,i=!1){so=e,co=n,ao=i,lo=t,function(){const t=webix.ajax().get(lo);t.then((function(t){const e=t.json().charts;x.removeItem($$("dashBodyScroll")),ao||(x.removeItem($$("dashboard-tool-main")),x.removeItem($$("dashboard-tool-adaptive"))),x.removeItem($$("dashboardInfoContainerInner")),x.removeItem($$("dash-template")),function(t){null==t?p("error","Ошибка при загрузке данных"):fo(t)}(e),(lo.includes("?")||lo.includes("sdt")&&lo.includes("edt"))&&p("success","Данные обновлены"),"icon-eye"==$$("webix_log-btn").config.icon?(uo(90),uo(5)):(uo(5),uo(90))})),t.fail((function(t){g(t,ro,"getAjax")}))}()}const po="dashboard => createSpace => filter",mo=[];let bo,go,wo,$o;function vo(t){t.getNode().firstElementChild.style.width=t.$width+"px",t.getInputNode().style.width=t.$width-5+"px"}function yo(t,e){const n={view:"datepicker",format:"%d.%m.%y",editable:!0,value:new Date,placeholder:e.label,height:42,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",e.comment),vo(this)}}};if("first"==t){const t=n;return t.id="dashDatepicker_sdt",t}if("last"==t){const t=n;return t.id="dashDatepicker_edt",t}}function xo(t){const e={view:"datepicker",format:"%H:%i:%s",placeholder:"Время",height:42,editable:!0,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",css:"dash-timeboard",hotkey:"enter",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды"),vo(this)}}};if("first"==t){const t=e;return t.id="dashDatepicker_sdt-time",t}if("last"==t){const t=e;return t.id="dashDatepicker_edt-time",t}}function Io(t){return{template:t,height:30,borderless:!0,css:"webix_template-datepicker"}}function _o(t,e,n){return go=n,mo.length=0,Object.values(t).forEach((function(t,n){if("datetime"==t.type&&3==t.order)!function(t){const e={width:200,id:"datepicker-containersdt",rows:[Io("Начиная с:"),yo("first",t),{height:10},xo("first"),{height:20},Io("Заканчивая:"),yo("last",t),{height:10},xo("last")]};try{mo.push(e)}catch(t){w(t,po,"createInputs")}}(t);else if("submit"==t.type){const i=t.action;bo=e.actions[i],mo.push({height:15}),mo.push(function(t,e){return new D({config:{id:"dashBtn"+e,hotkey:"Ctrl+Shift+Space",value:t.label,click:function(){!function(t){const e=[],n=[];let i="",o="",r=!0;(function(){try{mo.forEach((function(t,e){t.id.includes("container")&&function(t){const e=$$(t.id).getChildViews(),n=webix.Date.dateToStr("%H:%i:%s");e.forEach((function(t,e){function s(e){const s=$$(t.config.id).getValue();try{null!==s?"sdt"==e?i=i.concat(" "+n(s)):"edt"==e&&(o=o.concat(" "+n(s))):r=!1}catch(t){w(t,po,"createTime")}}function c(e){try{if(null!==$$(t.config.id).getValue()){const n=$$(t.config.id).getValue(),r=webix.Date.dateToStr("%d.%m.%y");"sdt"==e?i=r(n):"edt"==e&&(o=r(n))}else r=!1}catch(t){w(t,po,"createDate")}}t.config.id.includes("sdt")?t.config.id.includes("time")?s("sdt"):c("sdt"):t.config.id.includes("edt")&&(t.config.id.includes("time")?s("edt"):c("edt"))}))}(t)}))}catch(t){w(t,po,"setInputs")}})(),e.push("sdt="+i),e.push("edt="+o),n.push(i),n.push(o),function(){if(r){const i=webix.Date.dateToStr("%Y/%m/%d %H:%i:%s"),o=i(n[0]),r=i(n[1]);if(webix.filters.date.greater(o,r)&&n[0]!=n[1])p("error","Начало периода больше, чем конец");else{const n=bo.url+"?"+e.join("&");!function(){try{const t=$$("dashboard-charts"),e=$$("dashboardBody");t&&e.removeView(t)}catch(t){w(t,po,"removeCharts")}}(),ho(n,mo,go,!0),function(){try{const e=$$("dashBtn"+t);e.disable(),setTimeout((function(){e.getNode()&&e.enable()}),1e3)}catch(t){w(t,po,"setStateBtn")}}()}}else p("error","Не все поля заполнены")}()}(e)}},titleAttribute:t.comment,onFunc:{onViewResize:function(){vo(this)}}}).maxView("primary")}(t,n))}})),mo}function Co(){const t=l.keys,e=l.values,n=function(t){const e=$$("tree");let n;return t?n=t:e.getSelectedItem()&&(n=e.getSelectedItem().id),n}($o);e.forEach((function(e,i){const o=t[i];"dashboard"==e.type&&o==n&&(ho(e.actions.submit.url,_o(e.inputs,e,$o),$o),function(t,e){if(t.autorefresh){const t=webix.storage.local.get("userprefsOtherForm").autorefCounterOpt;wo=e,function(t){setInterval((function(){ko(wo)}),t)}(void 0!==t&&t>=15e3?t:5e4)}}(e,$o))}))}function ko(t){$o=t;const e=$$("dashBodyScroll");x.removeItem(e),async function(){await c.content("fields"),Co()}()}const Eo="router => tree";function So(t){async function e(){await c.content("fields"),l.keys&&(function(){let e=!1;function n(t){try{const e=$$(t);e&&e.show()}catch(e){w(e,Eo,"showTableData (element: "+t+")")}}!function(){try{const i=l.keys;l.values.forEach((function(o,r){i[r]==t&&(e=!0,"dbtable"!=o.type&&"tform"!=o.type&&"dashboard"!=o.type||(x.hideItem($$("webix__none-content")),"dbtable"==o.type?(n("tables"),Yi("table",t)):"tform"==o.type?(n("forms"),Yi("table-view",t)):"dashboard"==o.type&&(n("dashboards"),ko(t))))}))}catch(t){w(t,Eo,"createElem")}}(),e||function(){try{setTimeout((function(){!function(){const t={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){try{const t=$$("popupNotFound");t&&t.hide()}catch(t){w(t,Eo,"btnClosePopup click")}}},e={view:"button",css:"webix_btn-not-found-back",height:46,value:"Вернуться на главную",click:function(){!function(){try{$$("popupNotFound")&&$$("popupNotFound").destructor()}catch(t){w(t,Eo,"mainBtnPopup click destructPopup")}}(),function(){try{Backbone.history.navigate("content",{trigger:!0}),window.location.reload()}catch(t){w(t,Eo,"mainBtnPopup click navigate")}}()}};webix.ui({view:"popup",id:"popupNotFound",css:"webix_popup-prev-href",width:340,height:125,position:"center",body:{rows:[{rows:[{cols:[{template:"Что-то пошло не так...",width:250,css:"popup-headline",borderless:!0,height:20},{},t]},{template:"Страница не найдена",css:"webix_template-not-found-descr",borderless:!0,height:35},e,{height:20}]}]}}).show()}()}),1500)}catch(t){w(t,Eo,"showNotFoundPopup")}}()}(),function(){const e=l.names;function n(n){if(n){const i=n;try{e.forEach((function(e,n){e.id==t&&i&&i.setValues(e.name)}))}catch(t){w(t,Eo,"setTableName")}}}n($$("table-templateHeadline")),n($$("table-view-templateHeadline"))}(),function(){const e=$$("tree"),n=e.data.pull;let i;Object.values(n).forEach((function(n,o){if(n.webix_kids&&!e.exists(t)){const t=[n.id];e.callEvent("onBeforeOpen",t),i=n.id}})),e.exists(t)&&i&&(e.open(i,!0),e.select(t),e.showItem(t),function(){const t=e.getScrollState();e.scrollTo(0,t.y)}())}())}!function(){try{0==$$("tree").data.order.length&&async function(){await oi();const t=l.keys;try{$$("tree").attachEvent("onAfterLoad",webix.once((function(n){t||e()})))}catch(t){w(t,Eo,"createTable")}}()}catch(t){w(t,Eo,"checkTable")}}()}const Vo="router => cp";function To(){ri(),ci(),$$("user_auth")||ii("cp"),function(){try{const t=$$("user_auth");t&&t.show()}catch(t){w(t,Vo,"showUserAuth")}}(),si(),function(){const t=webix.storage.local.get("user"),e=$$("authName");try{t&&e.setValues(t.name.toString())}catch(t){w(t,Vo,"setUserValues")}}(),function(){try{const t=$$("webix__none-content");t&&t.hide()}catch(t){w(t,Vo,"hideNoneContent")}}(),function(){try{const t=$$("webix__null-content");t&&t.getParentView().removeView(t)}catch(t){w(t,Vo,"removeNoneContent")}}()}const Bo="router => settings";function jo(){ci(),ri(),$$("settings")||(ii("settings"),function(){const t=webix.ajax().get("/init/default/api/userprefs/");t.then((function(t){t=t.json().content,function(){try{t.forEach((function(t,e){t.name.includes("userprefs")&&0==t.name.lastIndexOf("userprefs")&&$$(t.name).setValues(JSON.parse(t.prefs))}))}catch(t){w(t,Bo,"getDataUserprefs")}}()})),t.fail((function(t){g(t,Bo,"getDataUserprefs")}))}()),function(){try{$$("settings").show()}catch(t){w(t,Bo,"showUserprefs")}}(),function(){const t=webix.storage.local.get("user");try{t&&$$("settingsName").setValues(t.name.toString())}catch(t){w(t,Bo,"setUserprefsNameValue")}}(),si(),function(){try{const t=$$("webix__none-content");t&&t.hide()}catch(t){w(t,Bo,"hideNoneContent")}}(),function(){try{const t=$$("webix__null-content");t&&t.getParentView().removeView(t)}catch(t){w(t,Bo,"removeNullContent")}}()}const Ao="getContent => getInfoEditTree";function Fo(){const t=$$("treeEdit"),e=webix.ajax().get("/init/default/api/trees");t.clearAll(),e.then((function(e){(e=e.json().content)[0].pid=0;const n={},i=[],o=[];function r(t){return{id:t.id,value:t.name,pid:t.pid,data:[]}}!function(){try{e.forEach((function(t,e){if(0==t.pid){const e=r(t);e.open=!0,o.push(e)}else{const e=r(t);o.push(e)}}))}catch(t){w(t,Ao,"pushTreeData")}}(),function(){try{o.forEach((function(t,e){n[t.id]=e,0!==t.pid&&t.pid!==t.id&&null!==t.pid?o[n[t.pid]].data.push(t):i.push(t)}))}catch(t){w(t,Ao,"createStruct")}}(),t.parse(i),function(){const e=function(){const e=[];return o.forEach((function(n,i){(function(e){let n=!1;return t.getFirstChildId(e)&&(n=!0),n})(n.id)&&e.push(n)})),e}(),n=[],i=$$("editTreeCombo");e.forEach((function(t,e){n.push({id:t.id,value:t.value})})),i.getPopup().getList().parse(n);const r=n[0].id;i.setValue(r)}()})),e.fail((function(t){g(t,"content","getInfoEditTree")}))}const Oo="router => experimental";function Po(){try{$$("treeTempl").show()}catch(t){w(t,Oo,"showTreeTempl")}}const Lo="router => logout";function No(){return new(Backbone.Router.extend({routes:{"":"index",content:"content",settings:"settings",cp:"cp",logout:"logout","tree/:id":"tree","experimental/:id":"experimental"},content:function(){oi()},index:function(){!async function(){r.whoami||await s("whoami"),r.whoami?function(){try{Backbone.history.navigate("content",{trigger:!0})}catch(t){console.log(t+" router => index goToContentPage")}}():function(){try{const t=$$("mainLayout"),e=$$("userAuth");t&&t.hide(),e&&e.show()}catch(t){window.alert("getAuth: "+t+" (Подробности: ошибка в отрисовке контента, router:index function showWorkspace)"),console.log(t+" router => index function showWorkspace")}}()}()},tree:function(t){So(t)},cp:function(){To()},settings:function(){jo()},experimental:function(){!function(){try{const t=$$("webix__null-content");t&&t.getParentView().removeView(t)}catch(t){w(t,Oo,"removeNullContent")}}(),ci(),x.hideItem($$("webix__none-content")),ri(),$$("treeTempl")?(Po(),Fo()):(ii("treeTempl"),Fo(),Po()),si()},logout:function(){!function(){const t=webix.ajax().post("/init/default/logout/");t.then((function(){!function(){try{history.back()}catch(t){w(t,Lo,"backPage")}}(),function(){try{const t=$$("tree");t&&t.clearAll()}catch(t){w(t,Lo,"clearTree")}}(),function(){try{webix.storage.local.clear()}catch(t){w(t,Lo,"clearStorage")}}()})),t.fail((function(t){g(t,Lo,"logoutData")}))}()}}))}function Do(){$$("formAuth").validate(),function(){const t=function(){const t={},e=$$("formAuth");try{const n=e.getValues();t.un=n.username,t.np=n.password}catch(t){console.log(t+" login function createSentObj")}return t}(),e=$$("formAuth"),n=webix.ajax().post("/init/default/login",t);n.then((function(t){if("i"==t.json().err_type){t=t.json().content;const n={};n.id=t.id,n.name=t.first_name,n.username=t.username,e&&e.clear(),Backbone.history.navigate("content",{trigger:!0}),window.location.reload()}else e&&e.isDirty()&&(e.markInvalid("username",""),e.markInvalid("password","Неверный логин или пароль"))})),n.fail((function(t){console.log(t+" login function postLoginData")}))}()}!function(){!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("underscore",e):(t="undefined"!=typeof globalThis?globalThis:t||self,function(){var n=t._,i=t._=e();i.noConflict=function(){return t._=n,i}}())}(this,(function(){var t="1.13.4",e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},n=Array.prototype,i=Object.prototype,o="undefined"!=typeof Symbol?Symbol.prototype:null,r=n.push,s=n.slice,c=i.toString,a=i.hasOwnProperty,l="undefined"!=typeof ArrayBuffer,u="undefined"!=typeof DataView,f=Array.isArray,d=Object.keys,h=Object.create,p=l&&ArrayBuffer.isView,m=isNaN,b=isFinite,g=!{toString:null}.propertyIsEnumerable("toString"),w=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],$=Math.pow(2,53)-1;function v(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),i=Array(n),o=0;o<n;o++)i[o]=arguments[o+e];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,arguments[0],i);case 2:return t.call(this,arguments[0],arguments[1],i)}var r=Array(e+1);for(o=0;o<e;o++)r[o]=arguments[o];return r[e]=i,t.apply(this,r)}}function y(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function x(t){return void 0===t}function I(t){return!0===t||!1===t||"[object Boolean]"===c.call(t)}function _(t){var e="[object "+t+"]";return function(t){return c.call(t)===e}}var C=_("String"),k=_("Number"),E=_("Date"),S=_("RegExp"),V=_("Error"),T=_("Symbol"),B=_("ArrayBuffer"),j=_("Function"),A=e.document&&e.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof A&&(j=function(t){return"function"==typeof t||!1});var F=j,O=_("Object"),P=u&&O(new DataView(new ArrayBuffer(8))),L="undefined"!=typeof Map&&O(new Map),N=_("DataView"),D=P?function(t){return null!=t&&F(t.getInt8)&&B(t.buffer)}:N,R=f||_("Array");function W(t,e){return null!=t&&a.call(t,e)}var z=_("Arguments");!function(){z(arguments)||(z=function(t){return W(t,"callee")})}();var H=z;function M(t){return k(t)&&m(t)}function U(t){return function(){return t}}function q(t){return function(e){var n=t(e);return"number"==typeof n&&n>=0&&n<=$}}function J(t){return function(e){return null==e?void 0:e[t]}}var Y=J("byteLength"),K=q(Y),G=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,Q=l?function(t){return p?p(t)&&!D(t):K(t)&&G.test(c.call(t))}:U(!1),X=J("length");function Z(t,e){e=function(t){for(var e={},n=t.length,i=0;i<n;++i)e[t[i]]=!0;return{contains:function(t){return!0===e[t]},push:function(n){return e[n]=!0,t.push(n)}}}(e);var n=w.length,o=t.constructor,r=F(o)&&o.prototype||i,s="constructor";for(W(t,s)&&!e.contains(s)&&e.push(s);n--;)(s=w[n])in t&&t[s]!==r[s]&&!e.contains(s)&&e.push(s)}function tt(t){if(!y(t))return[];if(d)return d(t);var e=[];for(var n in t)W(t,n)&&e.push(n);return g&&Z(t,e),e}function et(t,e){var n=tt(e),i=n.length;if(null==t)return!i;for(var o=Object(t),r=0;r<i;r++){var s=n[r];if(e[s]!==o[s]||!(s in o))return!1}return!0}function nt(t){return t instanceof nt?t:this instanceof nt?void(this._wrapped=t):new nt(t)}function it(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,Y(t))}nt.VERSION=t,nt.prototype.value=function(){return this._wrapped},nt.prototype.valueOf=nt.prototype.toJSON=nt.prototype.value,nt.prototype.toString=function(){return String(this._wrapped)};var ot="[object DataView]";function rt(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var o=typeof t;return("function"===o||"object"===o||"object"==typeof e)&&st(t,e,n,i)}function st(t,e,n,i){t instanceof nt&&(t=t._wrapped),e instanceof nt&&(e=e._wrapped);var r=c.call(t);if(r!==c.call(e))return!1;if(P&&"[object Object]"==r&&D(t)){if(!D(e))return!1;r=ot}switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return o.valueOf.call(t)===o.valueOf.call(e);case"[object ArrayBuffer]":case ot:return st(it(t),it(e),n,i)}var s="[object Array]"===r;if(!s&&Q(t)){if(Y(t)!==Y(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;s=!0}if(!s){if("object"!=typeof t||"object"!=typeof e)return!1;var a=t.constructor,l=e.constructor;if(a!==l&&!(F(a)&&a instanceof a&&F(l)&&l instanceof l)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];for(var u=(n=n||[]).length;u--;)if(n[u]===t)return i[u]===e;if(n.push(t),i.push(e),s){if((u=t.length)!==e.length)return!1;for(;u--;)if(!rt(t[u],e[u],n,i))return!1}else{var f,d=tt(t);if(u=d.length,tt(e).length!==u)return!1;for(;u--;)if(!W(e,f=d[u])||!rt(t[f],e[f],n,i))return!1}return n.pop(),i.pop(),!0}function ct(t){if(!y(t))return[];var e=[];for(var n in t)e.push(n);return g&&Z(t,e),e}function at(t){var e=X(t);return function(n){if(null==n)return!1;var i=ct(n);if(X(i))return!1;for(var o=0;o<e;o++)if(!F(n[t[o]]))return!1;return t!==ht||!F(n[lt])}}var lt="forEach",ut=["clear","delete"],ft=["get","has","set"],dt=ut.concat(lt,ft),ht=ut.concat(ft),pt=["add"].concat(ut,lt,"has"),mt=L?at(dt):_("Map"),bt=L?at(ht):_("WeakMap"),gt=L?at(pt):_("Set"),wt=_("WeakSet");function $t(t){for(var e=tt(t),n=e.length,i=Array(n),o=0;o<n;o++)i[o]=t[e[o]];return i}function vt(t){for(var e={},n=tt(t),i=0,o=n.length;i<o;i++)e[t[n[i]]]=n[i];return e}function yt(t){var e=[];for(var n in t)F(t[n])&&e.push(n);return e.sort()}function xt(t,e){return function(n){var i=arguments.length;if(e&&(n=Object(n)),i<2||null==n)return n;for(var o=1;o<i;o++)for(var r=arguments[o],s=t(r),c=s.length,a=0;a<c;a++){var l=s[a];e&&void 0!==n[l]||(n[l]=r[l])}return n}}var It=xt(ct),_t=xt(tt),Ct=xt(ct,!0);function kt(t){if(!y(t))return{};if(h)return h(t);var e=function(){};e.prototype=t;var n=new e;return e.prototype=null,n}function Et(t){return R(t)?t:[t]}function St(t){return nt.toPath(t)}function Vt(t,e){for(var n=e.length,i=0;i<n;i++){if(null==t)return;t=t[e[i]]}return n?t:void 0}function Tt(t,e,n){var i=Vt(t,St(e));return x(i)?n:i}function Bt(t){return t}function jt(t){return t=_t({},t),function(e){return et(e,t)}}function At(t){return t=St(t),function(e){return Vt(e,t)}}function Ft(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,o){return t.call(e,n,i,o)};case 4:return function(n,i,o,r){return t.call(e,n,i,o,r)}}return function(){return t.apply(e,arguments)}}function Ot(t,e,n){return null==t?Bt:F(t)?Ft(t,e,n):y(t)&&!R(t)?jt(t):At(t)}function Pt(t,e){return Ot(t,e,1/0)}function Lt(t,e,n){return nt.iteratee!==Pt?nt.iteratee(t,e):Ot(t,e,n)}function Nt(){}function Dt(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}nt.toPath=Et,nt.iteratee=Pt;var Rt=Date.now||function(){return(new Date).getTime()};function Wt(t){var e=function(e){return t[e]},n="(?:"+tt(t).join("|")+")",i=RegExp(n),o=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(o,e):t}}var zt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Ht=Wt(zt),Mt=Wt(vt(zt)),Ut=nt.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},qt=/(.)^/,Jt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Yt=/\\|'|\r|\n|\u2028|\u2029/g;function Kt(t){return"\\"+Jt[t]}var Gt=/^\s*(\w|\$)+\s*$/,Qt=0;function Xt(t,e,n,i,o){if(!(i instanceof e))return t.apply(n,o);var r=kt(t.prototype),s=t.apply(r,o);return y(s)?s:r}var Zt=v((function(t,e){var n=Zt.placeholder,i=function(){for(var o=0,r=e.length,s=Array(r),c=0;c<r;c++)s[c]=e[c]===n?arguments[o++]:e[c];for(;o<arguments.length;)s.push(arguments[o++]);return Xt(t,i,this,this,s)};return i}));Zt.placeholder=nt;var te=v((function(t,e,n){if(!F(t))throw new TypeError("Bind must be called on a function");var i=v((function(o){return Xt(t,i,e,this,n.concat(o))}));return i})),ee=q(X);function ne(t,e,n,i){if(i=i||[],e||0===e){if(e<=0)return i.concat(t)}else e=1/0;for(var o=i.length,r=0,s=X(t);r<s;r++){var c=t[r];if(ee(c)&&(R(c)||H(c)))if(e>1)ne(c,e-1,n,i),o=i.length;else for(var a=0,l=c.length;a<l;)i[o++]=c[a++];else n||(i[o++]=c)}return i}var ie=v((function(t,e){var n=(e=ne(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var i=e[n];t[i]=te(t[i],t)}return t})),oe=v((function(t,e,n){return setTimeout((function(){return t.apply(null,n)}),e)})),re=Zt(oe,nt,1);function se(t){return function(){return!t.apply(this,arguments)}}function ce(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}var ae=Zt(ce,2);function le(t,e,n){e=Lt(e,n);for(var i,o=tt(t),r=0,s=o.length;r<s;r++)if(e(t[i=o[r]],i,t))return i}function ue(t){return function(e,n,i){n=Lt(n,i);for(var o=X(e),r=t>0?0:o-1;r>=0&&r<o;r+=t)if(n(e[r],r,e))return r;return-1}}var fe=ue(1),de=ue(-1);function he(t,e,n,i){for(var o=(n=Lt(n,i,1))(e),r=0,s=X(t);r<s;){var c=Math.floor((r+s)/2);n(t[c])<o?r=c+1:s=c}return r}function pe(t,e,n){return function(i,o,r){var c=0,a=X(i);if("number"==typeof r)t>0?c=r>=0?r:Math.max(r+a,c):a=r>=0?Math.min(r+1,a):r+a+1;else if(n&&r&&a)return i[r=n(i,o)]===o?r:-1;if(o!=o)return(r=e(s.call(i,c,a),M))>=0?r+c:-1;for(r=t>0?c:a-1;r>=0&&r<a;r+=t)if(i[r]===o)return r;return-1}}var me=pe(1,fe,he),be=pe(-1,de);function ge(t,e,n){var i=(ee(t)?fe:le)(t,e,n);if(void 0!==i&&-1!==i)return t[i]}function we(t,e,n){var i,o;if(e=Ft(e,n),ee(t))for(i=0,o=t.length;i<o;i++)e(t[i],i,t);else{var r=tt(t);for(i=0,o=r.length;i<o;i++)e(t[r[i]],r[i],t)}return t}function $e(t,e,n){e=Lt(e,n);for(var i=!ee(t)&&tt(t),o=(i||t).length,r=Array(o),s=0;s<o;s++){var c=i?i[s]:s;r[s]=e(t[c],c,t)}return r}function ve(t){var e=function(e,n,i,o){var r=!ee(e)&&tt(e),s=(r||e).length,c=t>0?0:s-1;for(o||(i=e[r?r[c]:c],c+=t);c>=0&&c<s;c+=t){var a=r?r[c]:c;i=n(i,e[a],a,e)}return i};return function(t,n,i,o){var r=arguments.length>=3;return e(t,Ft(n,o,4),i,r)}}var ye=ve(1),xe=ve(-1);function Ie(t,e,n){var i=[];return e=Lt(e,n),we(t,(function(t,n,o){e(t,n,o)&&i.push(t)})),i}function _e(t,e,n){e=Lt(e,n);for(var i=!ee(t)&&tt(t),o=(i||t).length,r=0;r<o;r++){var s=i?i[r]:r;if(!e(t[s],s,t))return!1}return!0}function Ce(t,e,n){e=Lt(e,n);for(var i=!ee(t)&&tt(t),o=(i||t).length,r=0;r<o;r++){var s=i?i[r]:r;if(e(t[s],s,t))return!0}return!1}function ke(t,e,n,i){return ee(t)||(t=$t(t)),("number"!=typeof n||i)&&(n=0),me(t,e,n)>=0}var Ee=v((function(t,e,n){var i,o;return F(e)?o=e:(e=St(e),i=e.slice(0,-1),e=e[e.length-1]),$e(t,(function(t){var r=o;if(!r){if(i&&i.length&&(t=Vt(t,i)),null==t)return;r=t[e]}return null==r?r:r.apply(t,n)}))}));function Se(t,e){return $e(t,At(e))}function Ve(t,e,n){var i,o,r=-1/0,s=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var c=0,a=(t=ee(t)?t:$t(t)).length;c<a;c++)null!=(i=t[c])&&i>r&&(r=i);else e=Lt(e,n),we(t,(function(t,n,i){((o=e(t,n,i))>s||o===-1/0&&r===-1/0)&&(r=t,s=o)}));return r}var Te=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Be(t){return t?R(t)?s.call(t):C(t)?t.match(Te):ee(t)?$e(t,Bt):$t(t):[]}function je(t,e,n){if(null==e||n)return ee(t)||(t=$t(t)),t[Dt(t.length-1)];var i=Be(t),o=X(i);e=Math.max(Math.min(e,o),0);for(var r=o-1,s=0;s<e;s++){var c=Dt(s,r),a=i[s];i[s]=i[c],i[c]=a}return i.slice(0,e)}function Ae(t,e){return function(n,i,o){var r=e?[[],[]]:{};return i=Lt(i,o),we(n,(function(e,o){var s=i(e,o,n);t(r,e,s)})),r}}var Fe=Ae((function(t,e,n){W(t,n)?t[n].push(e):t[n]=[e]})),Oe=Ae((function(t,e,n){t[n]=e})),Pe=Ae((function(t,e,n){W(t,n)?t[n]++:t[n]=1})),Le=Ae((function(t,e,n){t[n?0:1].push(e)}),!0);function Ne(t,e,n){return e in n}var De=v((function(t,e){var n={},i=e[0];if(null==t)return n;F(i)?(e.length>1&&(i=Ft(i,e[1])),e=ct(t)):(i=Ne,e=ne(e,!1,!1),t=Object(t));for(var o=0,r=e.length;o<r;o++){var s=e[o],c=t[s];i(c,s,t)&&(n[s]=c)}return n})),Re=v((function(t,e){var n,i=e[0];return F(i)?(i=se(i),e.length>1&&(n=e[1])):(e=$e(ne(e,!1,!1),String),i=function(t,n){return!ke(e,n)}),De(t,i,n)}));function We(t,e,n){return s.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))}function ze(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[0]:We(t,t.length-e)}function He(t,e,n){return s.call(t,null==e||n?1:e)}var Me=v((function(t,e){return e=ne(e,!0,!0),Ie(t,(function(t){return!ke(e,t)}))})),Ue=v((function(t,e){return Me(t,e)}));function qe(t,e,n,i){I(e)||(i=n,n=e,e=!1),null!=n&&(n=Lt(n,i));for(var o=[],r=[],s=0,c=X(t);s<c;s++){var a=t[s],l=n?n(a,s,t):a;e&&!n?(s&&r===l||o.push(a),r=l):n?ke(r,l)||(r.push(l),o.push(a)):ke(o,a)||o.push(a)}return o}var Je=v((function(t){return qe(ne(t,!0,!0))}));function Ye(t){for(var e=t&&Ve(t,X).length||0,n=Array(e),i=0;i<e;i++)n[i]=Se(t,i);return n}var Ke=v(Ye);function Ge(t,e){return t._chain?nt(e).chain():e}function Qe(t){return we(yt(t),(function(e){var n=nt[e]=t[e];nt.prototype[e]=function(){var t=[this._wrapped];return r.apply(t,arguments),Ge(this,n.apply(nt,t))}})),nt}we(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=n[t];nt.prototype[t]=function(){var n=this._wrapped;return null!=n&&(e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0]),Ge(this,n)}})),we(["concat","join","slice"],(function(t){var e=n[t];nt.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=e.apply(t,arguments)),Ge(this,t)}}));var Xe={__proto__:null,VERSION:t,restArguments:v,isObject:y,isNull:function(t){return null===t},isUndefined:x,isBoolean:I,isElement:function(t){return!(!t||1!==t.nodeType)},isString:C,isNumber:k,isDate:E,isRegExp:S,isError:V,isSymbol:T,isArrayBuffer:B,isDataView:D,isArray:R,isFunction:F,isArguments:H,isFinite:function(t){return!T(t)&&b(t)&&!isNaN(parseFloat(t))},isNaN:M,isTypedArray:Q,isEmpty:function(t){if(null==t)return!0;var e=X(t);return"number"==typeof e&&(R(t)||C(t)||H(t))?0===e:0===X(tt(t))},isMatch:et,isEqual:function(t,e){return rt(t,e)},isMap:mt,isWeakMap:bt,isSet:gt,isWeakSet:wt,keys:tt,allKeys:ct,values:$t,pairs:function(t){for(var e=tt(t),n=e.length,i=Array(n),o=0;o<n;o++)i[o]=[e[o],t[e[o]]];return i},invert:vt,functions:yt,methods:yt,extend:It,extendOwn:_t,assign:_t,defaults:Ct,create:function(t,e){var n=kt(t);return e&&_t(n,e),n},clone:function(t){return y(t)?R(t)?t.slice():It({},t):t},tap:function(t,e){return e(t),t},get:Tt,has:function(t,e){for(var n=(e=St(e)).length,i=0;i<n;i++){var o=e[i];if(!W(t,o))return!1;t=t[o]}return!!n},mapObject:function(t,e,n){e=Lt(e,n);for(var i=tt(t),o=i.length,r={},s=0;s<o;s++){var c=i[s];r[c]=e(t[c],c,t)}return r},identity:Bt,constant:U,noop:Nt,toPath:Et,property:At,propertyOf:function(t){return null==t?Nt:function(e){return Tt(t,e)}},matcher:jt,matches:jt,times:function(t,e,n){var i=Array(Math.max(0,t));e=Ft(e,n,1);for(var o=0;o<t;o++)i[o]=e(o);return i},random:Dt,now:Rt,escape:Ht,unescape:Mt,templateSettings:Ut,template:function(t,e,n){!e&&n&&(e=n),e=Ct({},e,nt.templateSettings);var i=RegExp([(e.escape||qt).source,(e.interpolate||qt).source,(e.evaluate||qt).source].join("|")+"|$","g"),o=0,r="__p+='";t.replace(i,(function(e,n,i,s,c){return r+=t.slice(o,c).replace(Yt,Kt),o=c+e.length,n?r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?r+="'+\n((__t=("+i+"))==null?'':__t)+\n'":s&&(r+="';\n"+s+"\n__p+='"),e})),r+="';\n";var s,c=e.variable;if(c){if(!Gt.test(c))throw new Error("variable is not a bare identifier: "+c)}else r="with(obj||{}){\n"+r+"}\n",c="obj";r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{s=new Function(c,"_",r)}catch(t){throw t.source=r,t}var a=function(t){return s.call(this,t,nt)};return a.source="function("+c+"){\n"+r+"}",a},result:function(t,e,n){var i=(e=St(e)).length;if(!i)return F(n)?n.call(t):n;for(var o=0;o<i;o++){var r=null==t?void 0:t[e[o]];void 0===r&&(r=n,o=i),t=F(r)?r.call(t):r}return t},uniqueId:function(t){var e=++Qt+"";return t?t+e:e},chain:function(t){var e=nt(t);return e._chain=!0,e},iteratee:Pt,partial:Zt,bind:te,bindAll:ie,memoize:function(t,e){var n=function(i){var o=n.cache,r=""+(e?e.apply(this,arguments):i);return W(o,r)||(o[r]=t.apply(this,arguments)),o[r]};return n.cache={},n},delay:oe,defer:re,throttle:function(t,e,n){var i,o,r,s,c=0;n||(n={});var a=function(){c=!1===n.leading?0:Rt(),i=null,s=t.apply(o,r),i||(o=r=null)},l=function(){var l=Rt();c||!1!==n.leading||(c=l);var u=e-(l-c);return o=this,r=arguments,u<=0||u>e?(i&&(clearTimeout(i),i=null),c=l,s=t.apply(o,r),i||(o=r=null)):i||!1===n.trailing||(i=setTimeout(a,u)),s};return l.cancel=function(){clearTimeout(i),c=0,i=o=r=null},l},debounce:function(t,e,n){var i,o,r,s,c,a=function(){var l=Rt()-o;e>l?i=setTimeout(a,e-l):(i=null,n||(s=t.apply(c,r)),i||(r=c=null))},l=v((function(l){return c=this,r=l,o=Rt(),i||(i=setTimeout(a,e),n&&(s=t.apply(c,r))),s}));return l.cancel=function(){clearTimeout(i),i=r=c=null},l},wrap:function(t,e){return Zt(e,t)},negate:se,compose:function(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}},after:function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},before:ce,once:ae,findKey:le,findIndex:fe,findLastIndex:de,sortedIndex:he,indexOf:me,lastIndexOf:be,find:ge,detect:ge,findWhere:function(t,e){return ge(t,jt(e))},each:we,forEach:we,map:$e,collect:$e,reduce:ye,foldl:ye,inject:ye,reduceRight:xe,foldr:xe,filter:Ie,select:Ie,reject:function(t,e,n){return Ie(t,se(Lt(e)),n)},every:_e,all:_e,some:Ce,any:Ce,contains:ke,includes:ke,include:ke,invoke:Ee,pluck:Se,where:function(t,e){return Ie(t,jt(e))},max:Ve,min:function(t,e,n){var i,o,r=1/0,s=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var c=0,a=(t=ee(t)?t:$t(t)).length;c<a;c++)null!=(i=t[c])&&i<r&&(r=i);else e=Lt(e,n),we(t,(function(t,n,i){((o=e(t,n,i))<s||o===1/0&&r===1/0)&&(r=t,s=o)}));return r},shuffle:function(t){return je(t,1/0)},sample:je,sortBy:function(t,e,n){var i=0;return e=Lt(e,n),Se($e(t,(function(t,n,o){return{value:t,index:i++,criteria:e(t,n,o)}})).sort((function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index})),"value")},groupBy:Fe,indexBy:Oe,countBy:Pe,partition:Le,toArray:Be,size:function(t){return null==t?0:ee(t)?t.length:tt(t).length},pick:De,omit:Re,first:ze,head:ze,take:ze,initial:We,last:function(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[t.length-1]:He(t,Math.max(0,t.length-e))},rest:He,tail:He,drop:He,compact:function(t){return Ie(t,Boolean)},flatten:function(t,e){return ne(t,e,!1)},without:Ue,uniq:qe,unique:qe,union:Je,intersection:function(t){for(var e=[],n=arguments.length,i=0,o=X(t);i<o;i++){var r=t[i];if(!ke(e,r)){var s;for(s=1;s<n&&ke(arguments[s],r);s++);s===n&&e.push(r)}}return e},difference:Me,unzip:Ye,transpose:Ye,zip:Ke,object:function(t,e){for(var n={},i=0,o=X(t);i<o;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},range:function(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var i=Math.max(Math.ceil((e-t)/n),0),o=Array(i),r=0;r<i;r++,t+=n)o[r]=t;return o},chunk:function(t,e){if(null==e||e<1)return[];for(var n=[],i=0,o=t.length;i<o;)n.push(s.call(t,i,i+=e));return n},mixin:Qe,default:nt},Ze=Qe(Xe);return Ze._=Ze,Ze})),function(t){var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],(function(n,i,o){e.Backbone=t(e,o,n,i)}));else if("undefined"!=typeof exports){var n,i=require("underscore");try{n=require("jquery")}catch(t){}t(e,exports,i,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}((function(t,e,n,i){var o=t.Backbone,r=Array.prototype.slice;e.VERSION="1.4.1",e.$=i,e.noConflict=function(){return t.Backbone=o,this},e.emulateHTTP=!1,e.emulateJSON=!1;var s,c=e.Events={},a=/\s+/,l=function(t,e,i,o,r){var s,c=0;if(i&&"object"==typeof i){void 0!==o&&"context"in r&&void 0===r.context&&(r.context=o);for(s=n.keys(i);c<s.length;c++)e=l(t,e,s[c],i[s[c]],r)}else if(i&&a.test(i))for(s=i.split(a);c<s.length;c++)e=t(e,s[c],o,r);else e=t(e,i,o,r);return e};c.on=function(t,e,n){return this._events=l(u,this._events||{},t,e,{context:n,ctx:this,listening:s}),s&&((this._listeners||(this._listeners={}))[s.id]=s,s.interop=!1),this},c.listenTo=function(t,e,i){if(!t)return this;var o=t._listenId||(t._listenId=n.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),c=s=r[o];c||(this._listenId||(this._listenId=n.uniqueId("l")),c=s=r[o]=new b(this,t));var a=f(t,e,i,this);if(s=void 0,a)throw a;return c.interop&&c.on(e,i),this};var u=function(t,e,n,i){if(n){var o=t[e]||(t[e]=[]),r=i.context,s=i.ctx,c=i.listening;c&&c.count++,o.push({callback:n,context:r,ctx:r||s,listening:c})}return t},f=function(t,e,n,i){try{t.on(e,n,i)}catch(t){return t}};c.off=function(t,e,n){return this._events?(this._events=l(d,this._events,t,e,{context:n,listeners:this._listeners}),this):this},c.stopListening=function(t,e,i){var o=this._listeningTo;if(!o)return this;for(var r=t?[t._listenId]:n.keys(o),s=0;s<r.length;s++){var c=o[r[s]];if(!c)break;c.obj.off(e,i,this),c.interop&&c.off(e,i)}return n.isEmpty(o)&&(this._listeningTo=void 0),this};var d=function(t,e,i,o){if(t){var r,s=o.context,c=o.listeners,a=0;if(e||s||i){for(r=e?[e]:n.keys(t);a<r.length;a++){var l=t[e=r[a]];if(!l)break;for(var u=[],f=0;f<l.length;f++){var d=l[f];if(i&&i!==d.callback&&i!==d.callback._callback||s&&s!==d.context)u.push(d);else{var h=d.listening;h&&h.off(e,i)}}u.length?t[e]=u:delete t[e]}return t}for(r=n.keys(c);a<r.length;a++)c[r[a]].cleanup()}};c.once=function(t,e,n){var i=l(h,{},t,e,this.off.bind(this));return"string"==typeof t&&null==n&&(e=void 0),this.on(i,e,n)},c.listenToOnce=function(t,e,n){var i=l(h,{},e,n,this.stopListening.bind(this,t));return this.listenTo(t,i)};var h=function(t,e,i,o){if(i){var r=t[e]=n.once((function(){o(e,r),i.apply(this,arguments)}));r._callback=i}return t};c.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),n=Array(e),i=0;i<e;i++)n[i]=arguments[i+1];return l(p,this._events,t,void 0,n),this};var p=function(t,e,n,i){if(t){var o=t[e],r=t.all;o&&r&&(r=r.slice()),o&&m(o,i),r&&m(r,[e].concat(i))}return t},m=function(t,e){var n,i=-1,o=t.length,r=e[0],s=e[1],c=e[2];switch(e.length){case 0:for(;++i<o;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r);return;case 2:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r,s);return;case 3:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r,s,c);return;default:for(;++i<o;)(n=t[i]).callback.apply(n.ctx,e);return}},b=function(t,e){this.id=t._listenId,this.listener=t,this.obj=e,this.interop=!0,this.count=0,this._events=void 0};b.prototype.on=c.on,b.prototype.off=function(t,e){var n;this.interop?(this._events=l(d,this._events,t,e,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()},b.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},c.bind=c.on,c.unbind=c.off,n.extend(e,c);var g=e.Model=function(t,e){var i=t||{};e||(e={}),this.preinitialize.apply(this,arguments),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{});var o=n.result(this,"defaults");i=n.defaults(n.extend({},o,i),o),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};n.extend(g.prototype,c,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(t){return n.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return n.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!n.iteratee(t,this)(this.attributes)},set:function(t,e,i){if(null==t)return this;var o;if("object"==typeof t?(o=t,i=e):(o={})[t]=e,i||(i={}),!this._validate(o,i))return!1;var r=i.unset,s=i.silent,c=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=n.clone(this.attributes),this.changed={});var l=this.attributes,u=this.changed,f=this._previousAttributes;for(var d in o)e=o[d],n.isEqual(l[d],e)||c.push(d),n.isEqual(f[d],e)?delete u[d]:u[d]=e,r?delete l[d]:l[d]=e;if(this.idAttribute in o){var h=this.id;this.id=this.get(this.idAttribute),this.trigger("changeId",this,h,i)}if(!s){c.length&&(this._pending=i);for(var p=0;p<c.length;p++)this.trigger("change:"+c[p],this,l[c[p]],i)}if(a)return this;if(!s)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,n.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,n.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!n.isEmpty(this.changed):n.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&n.clone(this.changed);var e,i=this._changing?this._previousAttributes:this.attributes,o={};for(var r in t){var s=t[r];n.isEqual(i[r],s)||(o[r]=s,e=!0)}return!!e&&o},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(t){t=n.extend({parse:!0},t);var e=this,i=t.success;return t.success=function(n){var o=t.parse?e.parse(n,t):n;if(!e.set(o,t))return!1;i&&i.call(t.context,e,n,t),e.trigger("sync",e,n,t)},M(this,t),this.sync("read",this,t)},save:function(t,e,i){var o;null==t||"object"==typeof t?(o=t,i=e):(o={})[t]=e;var r=(i=n.extend({validate:!0,parse:!0},i)).wait;if(o&&!r){if(!this.set(o,i))return!1}else if(!this._validate(o,i))return!1;var s=this,c=i.success,a=this.attributes;i.success=function(t){s.attributes=a;var e=i.parse?s.parse(t,i):t;if(r&&(e=n.extend({},o,e)),e&&!s.set(e,i))return!1;c&&c.call(i.context,s,t,i),s.trigger("sync",s,t,i)},M(this,i),o&&r&&(this.attributes=n.extend({},a,o));var l=this.isNew()?"create":i.patch?"patch":"update";"patch"!==l||i.attrs||(i.attrs=o);var u=this.sync(l,this,i);return this.attributes=a,u},destroy:function(t){t=t?n.clone(t):{};var e=this,i=t.success,o=t.wait,r=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(n){o&&r(),i&&i.call(t.context,e,n,t),e.isNew()||e.trigger("sync",e,n,t)};var s=!1;return this.isNew()?n.defer(t.success):(M(this,t),s=this.sync("delete",this,t)),o||r(),s},url:function(){var t=n.result(this,"urlRoot")||n.result(this.collection,"url")||H();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},n.extend({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=n.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;return!i||(this.trigger("invalid",this,i,n.extend(e,{validationError:i})),!1)}});var w=e.Collection=function(t,e){e||(e={}),this.preinitialize.apply(this,arguments),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,n.extend({silent:!0},e))},$={add:!0,remove:!0,merge:!0},v={add:!0,remove:!1},y=function(t,e,n){n=Math.min(Math.max(n,0),t.length);var i,o=Array(t.length-n),r=e.length;for(i=0;i<o.length;i++)o[i]=t[i+n];for(i=0;i<r;i++)t[i+n]=e[i];for(i=0;i<o.length;i++)t[i+r+n]=o[i]};n.extend(w.prototype,c,{model:g,preinitialize:function(){},initialize:function(){},toJSON:function(t){return this.map((function(e){return e.toJSON(t)}))},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,n.extend({merge:!1},e,v))},remove:function(t,e){e=n.extend({},e);var i=!n.isArray(t);t=i?[t]:t.slice();var o=this._removeModels(t,e);return!e.silent&&o.length&&(e.changes={added:[],merged:[],removed:o},this.trigger("update",this,e)),i?o[0]:o},set:function(t,e){if(null!=t){(e=n.extend({},$,e)).parse&&!this._isModel(t)&&(t=this.parse(t,e)||[]);var i=!n.isArray(t);t=i?[t]:t.slice();var o=e.at;null!=o&&(o=+o),o>this.length&&(o=this.length),o<0&&(o+=this.length+1);var r,s,c=[],a=[],l=[],u=[],f={},d=e.add,h=e.merge,p=e.remove,m=!1,b=this.comparator&&null==o&&!1!==e.sort,g=n.isString(this.comparator)?this.comparator:null;for(s=0;s<t.length;s++){r=t[s];var w=this.get(r);if(w){if(h&&r!==w){var v=this._isModel(r)?r.attributes:r;e.parse&&(v=w.parse(v,e)),w.set(v,e),l.push(w),b&&!m&&(m=w.hasChanged(g))}f[w.cid]||(f[w.cid]=!0,c.push(w)),t[s]=w}else d&&(r=t[s]=this._prepareModel(r,e))&&(a.push(r),this._addReference(r,e),f[r.cid]=!0,c.push(r))}if(p){for(s=0;s<this.length;s++)f[(r=this.models[s]).cid]||u.push(r);u.length&&this._removeModels(u,e)}var x=!1,I=!b&&d&&p;if(c.length&&I?(x=this.length!==c.length||n.some(this.models,(function(t,e){return t!==c[e]})),this.models.length=0,y(this.models,c,0),this.length=this.models.length):a.length&&(b&&(m=!0),y(this.models,a,null==o?this.length:o),this.length=this.models.length),m&&this.sort({silent:!0}),!e.silent){for(s=0;s<a.length;s++)null!=o&&(e.index=o+s),(r=a[s]).trigger("add",r,this,e);(m||x)&&this.trigger("sort",this,e),(a.length||u.length||l.length)&&(e.changes={added:a,removed:u,merged:l},this.trigger("update",this,e))}return i?t[0]:t}},reset:function(t,e){e=e?n.clone(e):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],e);return e.previousModels=this.models,this._reset(),t=this.add(t,n.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,n.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,n.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return r.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.modelId(this._isModel(t)?t.attributes:t,t.idAttribute)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var i=e.length;return n.isFunction(e)&&(e=e.bind(this)),1===i||n.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(t){var e=(t=n.extend({parse:!0},t)).success,i=this;return t.success=function(n){var o=t.reset?"reset":"set";i[o](n,t),e&&e.call(t.context,i,n,t),i.trigger("sync",i,n,t)},M(this,t),this.sync("read",this,t)},create:function(t,e){var i=(e=e?n.clone(e):{}).wait;if(!(t=this._prepareModel(t,e)))return!1;i||this.add(t,e);var o=this,r=e.success;return e.success=function(t,e,n){i&&o.add(t,n),r&&r.call(n.context,t,e,n)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t,e){return t[e||this.model.prototype.idAttribute||"id"]},values:function(){return new I(this,_)},keys:function(){return new I(this,C)},entries:function(){return new I(this,k)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){return this._isModel(t)?(t.collection||(t.collection=this),t):((e=e?n.clone(e):{}).collection=this,(i=this.model.prototype?new this.model(t,e):this.model(t,e)).validationError?(this.trigger("invalid",this,i.validationError,e),!1):i);var i},_removeModels:function(t,e){for(var n=[],i=0;i<t.length;i++){var o=this.get(t[i]);if(o){var r=this.indexOf(o);this.models.splice(r,1),this.length--,delete this._byId[o.cid];var s=this.modelId(o.attributes,o.idAttribute);null!=s&&delete this._byId[s],e.silent||(e.index=r,o.trigger("remove",o,this,e)),n.push(o),this._removeReference(o,e)}}return n},_isModel:function(t){return t instanceof g},_addReference:function(t,e){this._byId[t.cid]=t;var n=this.modelId(t.attributes,t.idAttribute);null!=n&&(this._byId[n]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var n=this.modelId(t.attributes,t.idAttribute);null!=n&&delete this._byId[n],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){if(e){if(("add"===t||"remove"===t)&&n!==this)return;if("destroy"===t&&this.remove(e,i),"changeId"===t){var o=this.modelId(e.previousAttributes(),e.idAttribute),r=this.modelId(e.attributes,e.idAttribute);null!=o&&delete this._byId[o],null!=r&&(this._byId[r]=e)}}this.trigger.apply(this,arguments)}});var x="function"==typeof Symbol&&Symbol.iterator;x&&(w.prototype[x]=w.prototype.values);var I=function(t,e){this._collection=t,this._kind=e,this._index=0},_=1,C=2,k=3;x&&(I.prototype[x]=function(){return this}),I.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var t,e=this._collection.at(this._index);if(this._index++,this._kind===_)t=e;else{var n=this._collection.modelId(e.attributes,e.idAttribute);t=this._kind===C?n:[n,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var E=e.View=function(t){this.cid=n.uniqueId("view"),this.preinitialize.apply(this,arguments),n.extend(this,n.pick(t,V)),this._ensureElement(),this.initialize.apply(this,arguments)},S=/^(\S+)\s*(.*)$/,V=["model","collection","el","id","attributes","className","tagName","events"];n.extend(E.prototype,c,{tagName:"div",$:function(t){return this.$el.find(t)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=n.result(this,"events")),!t)return this;for(var e in this.undelegateEvents(),t){var i=t[e];if(n.isFunction(i)||(i=this[i]),i){var o=e.match(S);this.delegate(o[1],o[2],i.bind(this))}}return this},delegate:function(t,e,n){return this.$el.on(t+".delegateEvents"+this.cid,e,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,n){return this.$el.off(t+".delegateEvents"+this.cid,e,n),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"));else{var t=n.extend({},n.result(this,"attributes"));this.id&&(t.id=n.result(this,"id")),this.className&&(t.class=n.result(this,"className")),this.setElement(this._createElement(n.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}});var T=function(t,e,i,o){n.each(i,(function(n,i){e[i]&&(t.prototype[i]=function(t,e,n,i){switch(e){case 1:return function(){return t[n](this[i])};case 2:return function(e){return t[n](this[i],e)};case 3:return function(e,o){return t[n](this[i],B(e,this),o)};case 4:return function(e,o,r){return t[n](this[i],B(e,this),o,r)};default:return function(){var e=r.call(arguments);return e.unshift(this[i]),t[n].apply(t,e)}}}(e,n,i,o))}))},B=function(t,e){return n.isFunction(t)?t:n.isObject(t)&&!e._isModel(t)?j(t):n.isString(t)?function(e){return e.get(t)}:t},j=function(t){var e=n.matches(t);return function(t){return e(t.attributes)}};n.each([[w,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"],[g,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],(function(t){var e=t[0],i=t[1],o=t[2];e.mixin=function(t){var i=n.reduce(n.functions(t),(function(t,e){return t[e]=0,t}),{});T(e,t,i,o)},T(e,n,i,o)})),e.sync=function(t,i,o){var r=A[t];n.defaults(o||(o={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var s={type:r,dataType:"json"};if(o.url||(s.url=n.result(i,"url")||H()),null!=o.data||!i||"create"!==t&&"update"!==t&&"patch"!==t||(s.contentType="application/json",s.data=JSON.stringify(o.attrs||i.toJSON(o))),o.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),o.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){s.type="POST",o.emulateJSON&&(s.data._method=r);var c=o.beforeSend;o.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",r),c)return c.apply(this,arguments)}}"GET"===s.type||o.emulateJSON||(s.processData=!1);var a=o.error;o.error=function(t,e,n){o.textStatus=e,o.errorThrown=n,a&&a.call(o.context,t,e,n)};var l=o.xhr=e.ajax(n.extend(s,o));return i.trigger("request",i,l,o),l};var A={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var F=e.Router=function(t){t||(t={}),this.preinitialize.apply(this,arguments),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},O=/\((.*?)\)/g,P=/(\(\?)?:\w+/g,L=/\*\w+/g,N=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(F.prototype,c,{preinitialize:function(){},initialize:function(){},route:function(t,i,o){n.isRegExp(t)||(t=this._routeToRegExp(t)),n.isFunction(i)&&(o=i,i=""),o||(o=this[i]);var r=this;return e.history.route(t,(function(n){var s=r._extractParameters(t,n);!1!==r.execute(o,s,i)&&(r.trigger.apply(r,["route:"+i].concat(s)),r.trigger("route",i,s),e.history.trigger("route",r,i,s))})),this},execute:function(t,e,n){t&&t.apply(this,e)},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var t,e=n.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(N,"\\$&").replace(O,"(?:$1)?").replace(P,(function(t,e){return e?t:"([^/?]+)"})).replace(L,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return n.map(i,(function(t,e){return e===i.length-1?t||null:t?decodeURIComponent(t):null}))}});var D=e.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},R=/^[#\/]|\s+$/g,W=/^\/+|\/+$/g,z=/#.*$/;D.started=!1,n.extend(D.prototype,c,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(R,"")},start:function(t){if(D.started)throw new Error("Backbone.history has already been started");if(D.started=!0,this.options=n.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(W,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,o=i.insertBefore(this.iframe,i.firstChild).contentWindow;o.document.open(),o.document.close(),o.location.hash="#"+this.fragment}var r=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),D.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(t){return!!this.matchRoot()&&(t=this.fragment=this.getFragment(t),n.some(this.handlers,(function(e){if(e.route.test(t))return e.callback(t),!0})))},navigate:function(t,e){if(!D.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var n=this.root;""!==t&&"?"!==t.charAt(0)||(n=n.slice(0,-1)||"/");var i=n+t;t=t.replace(z,"");var o=this.decodeFragment(t);if(this.fragment!==o){if(this.fragment=o,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;e.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),e.history=new D,g.extend=w.extend=F.extend=E.extend=D.extend=function(t,e){var i,o=this;return i=t&&n.has(t,"constructor")?t.constructor:function(){return o.apply(this,arguments)},n.extend(i,o,e),i.prototype=n.create(o.prototype,t),i.prototype.constructor=i,i.__super__=o.prototype,i};var H=function(){throw new Error('A "url" property or function must be specified')},M=function(t,e){var n=e.error;e.error=function(i){n&&n.call(e.context,t,i,e),t.trigger("error",t,i,e)}};return e}))}();const Ro={hidden:!0,id:"userAuth",cols:[{view:"align",align:"middle,center",body:function(){No();const t="Поле должно быть заполнено";return{view:"form",id:"formAuth",width:250,borderless:!0,elements:[{view:"text",label:"Логин",name:"username",invalidMessage:t,on:{onItemClick:function(){$$("formAuth").clearValidation()}}},{view:"text",label:"Пароль",name:"password",invalidMessage:t,type:"password",icon:"password-icon wxi-eye",on:{onItemClick:function(t,e){const n=e.target.className,i=this.getInputNode();function o(t){webix.html.removeCss(e.target,t)}function r(t,n){webix.html.addCss(e.target,n),i.type=t}n.includes("password-icon")&&(o("wxi-eye-slash"),o("wxi-eye"),"text"==i.type?r("password","wxi-eye"):r("text","wxi-eye-slash")),$$("formAuth").clearValidation()}}},{view:"button",value:"Войти",css:"webix_primary",hotkey:"enter",align:"center",click:Do}],rules:{username:webix.rules.isNotEmpty,password:webix.rules.isNotEmpty},elementsConfig:{labelPosition:"top"}}}()}]};function Wo(t=!1){$$("header").getChildViews().forEach((function(e){(e.config.id.includes("search")||e.config.id.includes("log-btn")||e.config.id.includes("context-menu"))&&(t?e.show():e.hide())}))}const zo={view:"button",type:"icon",id:"collapseBtn",icon:"icon-bars",css:"webix_collapse",title:"текст",height:42,width:40,click:function(){const t=$$("tree"),e=$$("sideMenuResizer");function n(){try{t.show(),window.innerWidth>=800&&x.showItem(e)}catch(t){w(t,"header","showTree")}}try{window.innerWidth>850?t.isVisible()?(t.hide(),x.hideItem(e)):n():t.isVisible()?(t.hide(),x.hideItem(e),Wo(!0)):(n(),t.config.width=window.innerWidth,t.resize(),Wo()),this.refresh()}catch(t){w(t,"header","collapseClick")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Видимость бокового меню"),document.fonts.onloadingdone=function(t){const e=t.fontfaces;let n=!1;e.forEach((function(t){t.family.includes("icomoon")&&(n=!0)})),n||p("success","Не удалось загрузить шрифт иконок","expa")}}}},Ho=new D({config:{id:"webix_log-btn",hotkey:"Ctrl+M",icon:"icon-eye",badge:0,click:function(t){!function(t){const e=$$(t);1==e.getValue()?e.setValue(2):e.setValue(1)}(t)}},onFunc:{onChange:function(t){!function(t){const e=$$("logBlock-list"),n=$$("logLayout"),i=$$("webix_log-btn"),o=e.getLastId();function r(t,e){i.config.badge="",n.config.height=t,n.resize(),i.config.icon=e,i.refresh()}2==t?(r(90,"icon-eye-slash"),e.showItem(o)):r(5,"icon-eye")}(t)}},titleAttribute:"Показать/скрыть системные сообщения"}).minView();function Mo(){const e={view:"scrollview",scroll:"y",maxHeight:300,borderless:!0,body:{rows:[{view:"radio",id:"favCollectionLinks",vertical:!0,options:[{id:"radioNoneContent",disabled:!0,value:"Здесь будут сохранены Ваши ссылки"}],on:{onChange:function(t,e){try{const n=$$("favLinkSubmit");t!==e&&n&&!n.isEnabled()&&n.enable()}catch(t){w(t,"favsLink","favsPopup => radioLinks")}}}}]}},n=new D({config:{id:"favLinkSubmit",hotkey:"Ctrl+Shift+Space",value:"Открыть ссылку",disabled:!0,click:function(){!function(){try{const t=$$("favCollectionLinks"),e=t.getValue(),n=t.getOption(e);window.location.replace(n.favLink)}catch(t){w(t,"favsLink","favsPopupSubmitClick")}}()}},titleAttribute:"Открыть ссылку"}).maxView("primary");new X({headline:"Избранное",config:{id:"popupFavsLink",width:400,minHeight:300},elements:{padding:{left:5,right:5},rows:[e,{height:15},n]}}).createView(),function(){const e=webix.ajax().get("/init/default/api/userprefs/");e.then((function(e){e=e.json().content;const n=[];let i=webix.storage.local.get("user");i||(function(){const e=webix.ajax("/init/default/api/whoami");e.then((function(e){e=e.json().content;let n={};n.id=e.id,n.name=e.first_name,n.username=e.username,t("user",JSON.stringify(n))})),e.fail((function(t){g(t,"favsLink","btnSaveLpostContentinkClick => getUserData")}))}(),i=webix.storage.local.get("user")),i&&(function(){try{e.forEach((function(t){t.name.includes("fav-link")&&i.id==t.owner&&n.push(JSON.parse(t.prefs))}))}catch(t){w(t,"favsLink","favsPopupCollectionClick => getFavsCollection")}}(),function(){const t=$$("favCollectionLinks");try{n.length&&n.forEach((function(e){t.addOption({id:e.id,value:e.name,favLink:e.link}),t.removeOption("radioNoneContent")})),$$("popupFavsLink").show()}catch(t){w(t,"favsLink","favsPopupCollectionClick => createOptions")}}())})),e.fail((function(t){g(t,"favsLink","favsPopupCollectionClick getData")}))}(),function(t){if(window.innerWidth<1200){const e=.89*window.innerWidth;try{t.config.width=e,t.resize()}catch(t){w(t,"favsLink","function setAdaptiveSize")}}}($$("popupFavsLink"))}const Uo="header => userContextBtn";function qo(){$$("tree").clearAll()}function Jo(t){$$("container").getChildViews().forEach((function(e){e.config.id!==t&&x.hideItem($$(e.config.id))}))}function Yo(t){return Backbone.history.navigate(t,{trigger:!0})}const Ko={view:"toolbar",id:"header",padding:10,css:"webix_header-style",elements:[{cols:[zo,{view:"label",label:"<img src='/init/static/images/expalogo.png'  style='height:30px; margin: 10px;'>",height:25}]},{},{view:"search",placeholder:"Поиск (Shift+F)",css:"searchTable",height:42,hotkey:"shift+f",maxWidth:250,minWidth:40},Ho,new D({config:{id:"button-context-menu",hotkey:"Ctrl+L",icon:"icon-user",disabled:!0,popup:{view:"contextmenu",id:"contextmenu",css:"webix_contextmenu",data:[],on:{onItemClick:function(t,e,n){!function(t){const e=$$("editTableFormProperty"),n=$$("cp-form");function i(t){Yo(t),e.config.dirty=!1,e.refresh()}function o(t){S().then((function(n){const o=$$("table-saveBtn");1==n?(i(t),qo()):2==n&&e&&e.config.dirty&&(o.isVisible()?M(!1,!0):U(),i(t),qo())}))}"logout"==t?function(){const t=e&&e.config.dirty,o=n&&n.isDirty();if(t||o)return S().then((function(r){if(1==r)i("logout");else if(2==r&&(n||e))if(o&&n.validate())!function(){const t=n.getValues(),e={op:t.oldPass,np:t.newPass},i=webix.ajax().post("/init/default/api/cp",e);i.then((function(t){"i"==(t=t.json()).err_type?(p("success",t.err),Yo("logout")):w(t.err,Uo,"save new pass")})),i.fail((function(t){g(t,Uo,"save new pass")}))}();else{if(!t)return p("error","Заполните пустые поля"),!1;e.getValues().id?(M(!1,!1),i("logout")):(U(),i("logout"))}})),!1;Yo("logout")}():"cp"==t?(e&&e.config.dirty?o("cp"):(qo(),Yo("/cp")),Jo("user_auth")):"settings"==t?(e&&e.config.dirty?o("settings"):(qo(),Yo("/settings")),Jo("settings")):"favs"==t&&Mo()}(t)}}}},onFunc:{onItemClick:function(){!function(){const e=webix.ajax().get("/init/default/api/userprefs/");e.then((function(e){"e"==(e=e.json().content).err_type&&w(e.error,Uo,"onItemClickBtn getData");const n=window.location.pathname;let i=!1;function o(t){const e="onItemClickBtn "+t;t.then((function(t){"i"!==(t=t.json()).err_type&&w(t.error,Uo,e)})),t.fail((function(t){g(t,Uo,e)}))}if("/index.html/content"!==n&&"/init/default/spaw/content"!==n){const n={name:"userLocationHref",prefs:{href:window.location.href}};if(e.forEach((function(t,e){"userLocationHref"==t.name&&(function(t,e){const n="/init/default/api/userprefs/"+t;o(webix.ajax().put(n,e))}(t.id,n),i=!0)})),!i){const e=webix.storage.local.get("user").id;e?n.owner=e:function(e){const n=webix.ajax("/init/default/api/whoami");n.then((function(n){n=n.json().content,e.owner=n.id;const i={};i.id=n.id,i.name=n.first_name,i.username=n.username,t("user",JSON.stringify(i))})),n.fail((function(t){g(t,Uo,"onItemClickBtn getWho")}))}(n),function(t){o(webix.ajax().post("/init/default/api/userprefs/",t))}(n)}}})),e.fail((function(t){g(t,Uo,"onItemClickBtn getData")}))}()}},titleAttribute:"Пользователь"}).minView()]};function Go(){const t="webix-transparent-btn--primary";try{const e=document.querySelector(".webix_btn-filter");e&&e.classList.contains(t)&&(e.classList.add("webix-transparent-btn"),e.classList.remove(t))}catch(t){w(t,"sidebar","setStateFilterBtn")}}const Qo="treeSidebar => onSelectChange";function Xo(t){const e=$$("tree"),n=e.getSelectedItem().id,i=e.getParentId(n),o=e.data.order;let r=[];function s(t){function n(){$$("container").addView({view:"align",align:"middle,center",id:"webix__null-content",body:{borderless:!0,template:"Блок в процессе разработки",height:50,width:220,css:{color:"#858585","font-size":"14px!important"}}},2)}!function(){try{let t=$$("webix__null-content");t&&x.removeItem(t)}catch(t){w(t,Qo,"removeNullContent")}}(),x.hideItem($$("user_auth")),x.hideItem($$("settings")),r=function(){let t=[];try{o.forEach((function(n,i){0==e.getParentId(n)&&t.push(n)}))}catch(t){w(t,Qo,"getTreeParents")}return t}(),void 0!==t?r.forEach((function(e,o){let r=$$("tree").getItem(t).action,s=$$("tree").getItem(e).action;t&&async function(){await c.content("fields");let e=!1;if(l.keys.find((function(e){return e===t}))){const n=l.attribute(t,"type");e=!0,"dbtable"==n?x.showItem($$("tables")):"tform"==n?x.showItem($$("forms")):"dashboard"==n&&x.showItem($$("dashboards"))}return e}().then((function(t){t||(x.hideItem($$("webix__none-content")),$$("webix__null-content")||n())})),r!==s&&s&&("dbtable"==s||"all_dbtable"==s?x.hideItem($$("tables")):"tform"==s||"all_tform"==s?x.hideItem($$("forms")):"dashboard"!=s&&"dashboards"===i||x.hideItem($$("dashboards")))})):function(){try{r.forEach((function(t,e){if(t==i)$$(t)?$$(t).show():$$("webix__null-content")||n();else if($$(t)||"treeTempl"==t)$$(t)&&$$(t).hide();else{const e=$$("tree").getItem(t).action;"dbtable"==e&&"tables"!==i?x.hideItem($$("tables")):"tform"==e&&"forms"!==i?x.hideItem($$("forms")):"dashboard"==e&&"dashboards"!==i&&x.hideItem($$("dashboards"))}}))}catch(t){w(t,Qo,"viewDefaultElements")}}()}x.removeItem($$("propertyRefbtnsContainer")),x.hideItem($$("tablePropBtnsSpace")),x.hideItem($$("editTableFormProperty")),$$("header").getChildViews().forEach((function(t){t.config.id.includes("search")&&t.show()})),x.hideItem($$("filterTableBarContainer")),x.showItem($$("filterEmptyTempalte")),x.showItem($$("EditEmptyTempalte")),x.disableItem($$("btnFilterSubmit")),x.disableItem($$("filterLibrarySaveBtn")),x.disableItem($$("resetFilterBtn")),function(){try{const t=$$("table-editForm");t&&t.config.width<320&&(t.config.width=320,t.refresh())}catch(t){w(t,Qo,"setWidthEditForm")}}(),Go(),function(){try{let e=$$("treeTempl");e&&!$$(t)&&e.hide()}catch(t){w(t,Qo,"hideTreeTempl")}}(),function(){try{t[0]&&0!==i&&x.hideItem($$("webix__none-content"))}catch(t){w(t,Qo,"hideNoneContent")}}(),"tables"==i||"dashboards"==i?s():"forms"==i?(x.hideItem($$("propTableView")),s()):(0==i&&"tables"!==n&&"user_auth"!==n&&"dashboards"!==n&&"forms"!==n||0!==i)&&s(t[0])}const Zo="treeSidebar => onItemClick";function tr(t){const e=$$("editTableFormProperty"),n=e.getValues(),i=function(){let t;return $$("tables").isVisible()?t=$$("table").config.idTable:$$("forms").isVisible()&&(t=$$("table-view").config.idTable),t}();function o(){try{e.config.dirty=!1,e.refresh()}catch(t){w(t,Zo,"setDirtyProperty")}}function r(){try{const t=$$("table-saveNewBtn"),e=$$("table-saveBtn"),n=$$("table-delBtnId");t.isVisible()?t.hide():e.isVisible()&&e.hide(),n.disable()}catch(t){w(t,Zo,"setDefaultStateBtns")}}function s(){try{L().forEach((function(t,e){let n;$$("table").getColumns().forEach((function(e,i){e.id==t.nameCol&&(n=e.label)})),p("error",t.textError+" (Поле: "+n+")")}))}catch(t){w(t,Zo,"validateError")}}function c(t){const e=$$("tree");e&&e.select(t)}if(e.config.dirty)return function(){const a=$$("table-saveBtn");S().then((function(l){1==l?(r(),function(){try{e&&e.isVisible()&&(e.clear(),e.hide())}catch(t){w(t,Zo,"setDirtyProperty")}}(),o(),$$("tree").select(t)):2==l&&(a.isVisible()?function(){if(L().length)s();else if(n.id){const e="/init/default/api/"+i+"/"+n.id,r=function(t){let e={};return Object.values(t).forEach((function(n,i){!function(n){try{let i=$$("table").getItem(t.id),o=Object.keys(i),r=Object.keys(t)[n],s=Object.values(t)[n];o.forEach((function(t){t==r&&i[t]!==s&&(e[r]=s)}))}catch(t){w(t,Zo,"compareVals")}}(i)})),e}(n),s=webix.ajax().put(e,r);s.then((function(e){"i"==(e=e.json()).err_type?(o(),x.removeItem($$("propertyRefbtnsContainer")),c(t),p("success","Данные успешно добавлены",i)):w(e.err,"sidebar","onItemClick => putData")})),s.fail((function(t){g(t,"sidebar","onItemClick => putData")}))}}():function(){if(L().length)s();else{const e="/init/default/api/"+i,r=webix.ajax().post(e,n);r.then((function(e){if(null!==(e=e.json()).content.id)o(),x.removeItem($$("propertyRefbtnsContainer")),c(t),p("success","Данные успешно добавлены",i);else{const t=e.content.errors;let n="";Object.values(t).forEach((function(e,i){n+=e+" (Поле: "+Object.keys(t)[i]+"); "})),p("error",n)}"i"!==e.err_type&&w(e.err,"sidebar","onItemClick => postNewData")})),r.fail((function(t){g(t,"sidebar","onItemClick => postNewData")}))}}(),o()),1!=l&&2!=l||x.removeItem($$("propertyRefbtnsContainer"))}))}(),!1;r()}const er="treeSidebar => onBeforeSelect",nr="treeSidebar => onBeforeOpen";function ir(){window.addEventListener("resize",(function(t){!async function(){["forms","dashboards","tables","userprefs","user_auth"].forEach((function(t,e){const n=$$(t);var i;n&&n.isVisible()&&("forms"==(i=t)?function(){const t=$$("formsTools"),e=$$("formsContainer"),n=$$("formsTools-resizer"),i=$$("table-backFormsBtnFilter");window.innerWidth<850&&t.isVisible()&&(t.config.width=window.innerWidth-45,t.resize(),x.hideItem(e),x.hideItem(n),x.hideItem($$("tree")),x.showItem(i)),window.innerWidth>850&&t.isVisible()&&350!==t.config.width&&(t.config.width=350,t.resize(),x.showItem(n),x.showItem(e),x.hideItem(i))}():"dashboards"==i?function(){const t=$$("dashboardTool"),e=$$("dashboardInfoContainer"),n=$$("tree"),i=$$("dash-backDashBtn");window.innerWidth<850&&t.isVisible()&&(t.config.width=window.innerWidth-45,t.resize(),x.hideItem(e),x.showItem(n),x.showItem(i)),window.innerWidth>850&&function(){if(t.isVisible()&&350!==t.config.width){t.config.width=350,t.resize();const n=$$("dashboardTool");n.config.width=350,n.resize(),x.showItem(e),x.hideItem(i)}}()}():"tables"==i&&(function(){const t=$$("tableContainer"),e=$$("table-editForm"),n=$$("table-backTableBtn"),i=$$("tree");$$("container").$width<850&&e.isVisible()&&x.hideItem(i),window.innerWidth<850&&e.isVisible()&&(e.config.width=window.innerWidth-45,e.resize(),x.hideItem(t),x.hideItem(i),x.showItem(n)),window.innerWidth>850&&e.isVisible()&&350!==e.config.width&&(e.config.width=350,e.resize(),x.showItem(t),x.hideItem(n))}(),function(){const t=$$("filterTableBarContainer"),e=$$("tableContainer"),n=$$("table-backTableBtnFilter"),i=$$("tree");window.innerWidth<850&&t.isVisible()&&(t.config.width=window.innerWidth-45,t.resize(),x.hideItem(e),x.hideItem(i),x.showItem(n)),$$("container").$width<850&&t.isVisible()&&x.hideItem(i),window.innerWidth>850&&t.isVisible()&&350!==t.config.width&&(t.config.width=350,t.resize(),x.showItem(e),x.hideItem(n))}()))}))}(),function(){const t=$$("tree");window.innerWidth<850&&x.hideItem(t),!t.isVisible()&&window.innerWidth<=800&&x.hideItem($$("sideMenuResizer")),window.innerWidth>850&&$$("tree")&&function(){try{t&&(t.config.width=250,t.resize())}catch(t){w(t,"adaptive","resizeSidebar => resizeTree")}}()}(),window.innerWidth>850&&$$("header").getChildViews().forEach((function(t){t.config.id.includes("search")&&t.show()}))}),!0)}console.log("expa 1.0.55");const or={hidden:!0,id:"mainLayout",rows:[{id:"mainContent",css:"webix_mainContent",cols:[{rows:[Ko,{id:"adaptive",rows:[]},{cols:[function(){const t={view:"edittree",id:"tree",css:"webix_tree-main",minWidth:100,width:300,editable:!1,select:!0,editor:"text",editValue:"value",activeTitle:!0,clipboard:!0,data:[],on:{onSelectChange:function(t){Xo(t)},onItemClick:function(t){return tr(t)},onBeforeSelect:function(t){!function(t){const e=$$("tree").getItem(t),n=$$("filterTableForm"),i=$$("inputsFilter");if(t.includes("q-none_data-tree_")||t.includes("q-load_data-tree_")||e.webix_kids)return!1;!function(){const t=document.querySelector(".webix_btn-filter"),e="webix-transparent-btn--primary";t&&t.classList.contains(e)&&(t.classList.add("webix-transparent-btn"),t.classList.remove(e))}(),function(){try{n&&n.isVisible()&&(n.hide(),Go(),x.showItem($$("table-editForm"))),i&&x.removeItem(i)}catch(t){w(t,er,"setFilterDefaultState")}}(),x.hideItem($$("editTableFormProperty")),function(){const t=$$("formsTools"),e=$$("formsContainer");x.hideItem(t),x.showItem(e)}(),function(){const t=$$("dashboardTool"),e=$$("dashboardInfoContainer");x.hideItem(t),x.showItem(e)}(),function(){const t=$$("tableContainer"),e=$$("tables");x.hideItem($$("editTableBarContainer")),x.hideItem($$("table-backTableBtn")),x.hideItem($$("table-editForm")),x.showItem($$("tableContainer")),e.$width-t.$width>9&&$$("tableContainer").resize()}(),function(){const t=$$("table-view-visibleCols"),e=$$("table-visibleCols");function n(t){t&&t.disable()}t.isVisible()?n(t):e.isVisible()&&n(e)}(),async function(){await c.content("fields");const e=l.keys;!function(){try{e.forEach((function(e){if(e==t){const n=l.attribute(e,"type");$$("tree").getParentId(e),x.hideItem($$("webix__none-content")),x.removeItem($$("webix__null-content")),"dbtable"==n?(x.showItem($$("tables")),Yi("table",t)):"tform"==n?(x.showItem($$("forms")),Yi("table-view",t)):"dashboard"==n&&(x.showItem($$("dashboards")),ko(t))}}))}catch(t){w(t,er,"generateItem")}}()}()}(t)},onLoadError:function(t){g(t,"sidebar","onLoadError")},onBeforeOpen:function(t){!function(t){const e=$$("tree"),n=e.getItem(t),i="q-load_data-tree_"+webix.uid(),o="q-none_data-tree_"+webix.uid();-1===e.getItem(t).$count&&(e.data.add({id:i,disabled:!0,value:"Загрузка ..."},0,t),e.addCss(i,"tree_load-items"),async function(){function r(t=!1){try{e.exists(i)&&e.remove(i),e.exists(o)&&t&&e.remove(o)}catch(t){w(t,nr,"removeTreeEls")}}if(n.action.includes("all_")){const i=n.action.indexOf("_");!async function(n){await c.content("fields"),await c.content("mmenu");const i=a.content,s=l.keys,u=l.values;let f=!1;try{s.forEach((function(o,s){u[s].type==n&&function(t,e){let n=!0;try{t.forEach((function(t,i){t.name==e&&(n=!1)}))}catch(t){w(t,nr,"isUniqueItem")}return n}(i,o)&&(e.data.add({id:o,value:u[s].plural?u[s].plural:u[s].singular,type:u[s].type},0,t),f||(f=!0),r(!0))})),f||(r(),e.exists(o)||(e.data.add({id:o,disabled:!0,value:"Раздел пуст"},0,t),e.addCss(o,"tree_none-items")))}catch(t){w(t,nr,"generateMenuData")}}(n.action.slice(i+1))}}())}(t)},onAfterSelect:function(t){!function(t){!async function(){if(a.content)try{Backbone.history.navigate("tree/"+t,{trigger:!0})}catch(t){w(t,"treeSidebar => onAfterSelect","getFields")}}(),function(){try{window.innerWidth<850&&$$("tree").hide()}catch(t){w(t,"treeSidebar => onAfterSelect","setAdaptiveState")}}()}(t)}}};return t}(),{id:"sideMenuResizer",view:"resizer",css:"webix_resizer-hide"},{id:"container",cols:[{view:"align",align:"middle,center",id:"webix__none-content",body:{borderless:!0,template:"Выберите элемент дерева",height:50,width:210,css:{color:"#858585","font-size":"14px!important"}}}]}]}]}]},{view:"resizer",id:"log-resizer"},b]};try{webix.ready((function(){webix.protoUI({name:"edittree"},webix.EditAbility,webix.ui.tree),webix.ui({view:"scrollview",type:"clean",id:"layout",css:"layoutContainer",scroll:"y",body:{cells:[{},Ro,or]}}),function(e){const o=webix.ajax("/init/default/api/userprefs/");o.then((function(e){let o=webix.storage.local.get("user");function r(){try{e.forEach((function(e,n){e.owner!=o.id||e.name.includes("fav-link_")||t(e.name,e.prefs)}))}catch(t){w(t,"storageSettings","setDataToStorage")}}e=e.json().content,function(){if(o)r(),n();else{const e=webix.ajax("/init/default/api/whoami");e.then((function(e){e=e.json().content;let n={};n.id=e.id,n.name=e.first_name,n.username=e.username,t("user",JSON.stringify(n))})),e.then((function(t){o=webix.storage.local.get("user"),r(),n(),i()})),e.fail((function(t){g(t,"favsLink","btnSaveLpostContentinkClick => getUserData")}))}}()})).then((function(){i()})),o.fail((function(t){console.log(t),console.log("storageSettings function setUserPrefs")}))}(),ir(),window.location.host.includes("localhost:3000")?Backbone.history.start({pushState:!0,root:"/index.html/"}):Backbone.history.start({pushState:!0,root:"/init/default/spaw/"}),function(){const t=$$("tree");window.innerWidth<850&&t&&t.hide(),function(){if(window.innerWidth<1200){const e=$$("editTableBarContainer");t.attachEvent("onAfterLoad",(function(){x.hideItem(e)})),x.hideItem(e)}}()}(),function(){let t=null;webix.event(document.body,"mousedown",(e=>{const n=$$(e);n&&n.getInputNode&&(t=n)})),webix.event(document,"click",(e=>{const n=$$(e);t&&n&&n.config.id!==t.config.id&&(e.cancelBubble=!0,webix.html.preventEvent(e)),t=null}),{capture:!0})}(),window.addEventListener("popstate",(function(t){window.location.replace(window.location.href),window.location.reload()})),function(){let t;function e(){try{"/index.html"!==window.location.pathname&&"/"!==window.location.pathname&&"/init/default/spaw"!==window.location.pathname&&(clearTimeout(t),t=setTimeout(o,6e5))}catch(t){w(t,"autoLogout","resetTimer")}}window.onload=e,window.onmousemove=e,window.onmousedown=e,window.ontouchstart=e,window.onclick=e,window.onkeypress=e,window.addEventListener("scroll",e,!0)}(),webix.editors.customDate=webix.extend({render:function(){return webix.html.create("div",{class:"webix_dt_editor"},"<input class='webix_custom-date-editor' id='custom-date-editor' type='text'>")}},webix.editors.text),webix.i18n.setLocale("ru-RU"),webix.i18n.parseFormat="%d.%m.%Y %H:%i:%s",webix.i18n.setLocale(),webix.Date.startOnMonday=!0,webix.message.position="bottom"}))}catch(t){alert("Ошибка при выполнении "+t),w(t,"app","layout")}})();