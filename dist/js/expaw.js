(()=>{"use strict";function t(t,e){"undefined"!=typeof Storage&&localStorage.setItem(t,e)}const e={};function n(t){if("/index.html"!==window.location.pathname&&"/init/default/spaw"!==window.location.pathname||"whoami"==t)return webix.ajax().get(`/init/default/api/${t}.json`).then((function(n){e[t]=n.json();try{"fields"==t&&e[t]&&(e.tableNames=function(t){let e=[];try{Object.values(t).forEach((function(n,i){e.push({id:Object.keys(t)[i],name:n.plural?n.plural:n.singular})}))}catch(t){l(t,"globalStorage","getTableNames")}return e}(e[t].content))}catch(t){l(t,"globalStorage","getData")}return e[t]})).catch((t=>{c(t,"globalStorage","getData"),function(t){401===t.status&&"/index.html"!==window.location.pathname&&"/init/default/spaw/"!==window.location.pathname&&Backbone.history.navigate("/",{trigger:!0})}(t)}))}function i(i,o,r){const a=function(){const t=new Date;return`${t.getDate()}.${String(t.getMonth()+1).padStart(2,"0")}.${t.getFullYear()} ${t.getHours()}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`}();async function s(t){let i;var r;"version"==t?i="Expa v1.0.42":"cp"==t?i="Смена пароля":(e.tableNames||await n("fields"),e.tableNames&&function(){try{e.tableNames.forEach((function(e,n){e.id==t&&(i=e.name)}))}catch(t){l(t,"logBlock","findTableName")}}()),(r=i)||(r="expa"),$$("logBlock-list").add({date:a,value:o,src:r})}!function(){try{let t=null;const e=$$("tree");if(e.getSelectedItem())t=e.getSelectedItem().id;else{const e=window.location.pathname,n=e.lastIndexOf("/");t=e.slice(n+1)}r?s(r):t&&s(t)}catch(t){l(t,"logBlock","initLogMsg")}}(),function(){const e=function(){const t=document.querySelector(".webix_log-block");let e;try{if(t){const n=".webix_list_item";t.querySelectorAll(n).forEach((function(t,n){e=n}))}}catch(t){l(t,"logBlock","getItemIndex")}return e}(),n=document.querySelectorAll(".webix_list_item")[e];"error"==i&&(function(){try{void 0!==n&&n.style.setProperty("color","red","important")}catch(t){l(t,"logBlock","setStyle")}}(),function(){try{const e=$$("logLayout"),n=$$("webix_log-btn");"icon-eye"==n.config.icon&&(e.config.height=90,e.resize(),n.setValue(2),n.config.icon="icon-eye-slash",n.refresh(),t("LogVisible",JSON.stringify("show")))}catch(t){l(t,"logBlock","openLog")}}())}()}let o=0;const r={id:"logLayout",height:80,rows:[{template:"<div class='webix_log-headline'>Системные сообщения</div>",height:30},{id:"logBlock-list",css:"webix_log-block",view:"list",template:"#date# — #value#  (Источник: #src#)",data:[],on:{onAfterLoad:function(){try{i("success","Интерфейс загружен","version")}catch(t){l(t,"logBlock","logBlock onAfterLoad")}},onAfterAdd:function(){const t=$$("webix_log-btn");"icon-eye"==t.config.icon?function(){try{""==t.config.badge&&(o=0),o++,t.config.badge=o,t.setValue(1),t.refresh()}catch(t){l(t,"logBlock","logBlock onAfterAdd function addNotify")}}():"icon-eye-slash"==t.config.icon&&function(){try{o=0,t.config.badge="",t.setValue(2),t.refresh()}catch(t){l(t,"logBlock","logBlock onAfterAdd function clearNotify")}}()}}}]};function a(t,e,n=!1){try{return $$("webix_log-btn").setValue(2),o=0,i("error",n?"ОШИБКА "+t+": "+e:"ОШИБКА "+t+": "+e.stack)}catch(t){console.log(t),alert("Ошибка при выполнении "+t),window.stop()}}function s(t,e,n,r){return $$("webix_log-btn").setValue(2),o=0,i("error","ОШИБКА "+t+": СТАТУС: "+e+" "+n+". ПОДРОБНОСТИ: "+r)}function c(t,e,n){400===t.status||401===t.status||404===t.status?i("error",e+" function "+n+": "+t.status+" "+t.statusText+" "+t.responseURL+" ("+t.responseText+") "):(i("error",e+" function "+n+": "+t.status+" "+t.statusText+" "+t.responseURL+" ("+t.responseText+") ","version"),window.alert("Ошибка. Статус: "+t.status+". Отсутствует соединение с сервером."))}function l(t,e,n){console.log(t),i("error",e+" function "+n+": "+t)}function u(){let t;try{const e=$$("table"),n=$$("tables-view");$$("tables").isVisible()?t=e.config.idTable:$$("forms").isVisible()&&(t=n.config.idTable)}catch(t){l(t,"commonFunctions","getItemId")}return t}function d(t){try{t&&t.hide()}catch(e){l(e,"commonFunctions","hideElem, element: "+t)}}function f(t){try{t&&!t.isVisible()&&t.show()}catch(e){l(e,"commonFunctions","showElem element: "+t)}}function h(t){try{t&&t.getParentView().removeView(t)}catch(e){l(e,"commonFunctions","removeElem element: "+t)}}function p(t){try{t&&t.isEnabled()&&t.disable()}catch(t){l(t,"sidebar","disableElements")}}const b={id:"dashboardTool",css:"webix_dashTool",rows:[]};function $(t){return webix.confirm({width:300,ok:"Да",cancel:"Отмена",title:t,text:"Вы уверены, что хотите продолжить?"})}function m(t,e,n){return t||e||n?webix.modalbox({title:t,css:"webix_modal-custom-save",buttons:n,width:500,text:e}):webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"})}function g(){const e=webix.ajax("/init/default/api/whoami");e.then((function(e){e=e.json().content;let n={};n.id=e.id,n.name=e.first_name,n.username=e.username,t("user",JSON.stringify(n))})),e.fail((function(t){c(t,"favsLink","btnSaveLpostContentinkClick => getUserData")}))}function w(){let t;try{const e=$$("tree");if(e&&e.getSelectedId())t=e.getSelectedId();else{const e=window.location.pathname,n=window.location.pathname.lastIndexOf("/")+1;t=e.slice(n)}}catch(t){l(t,"favsLink","getCurrId")}return t}function v(){function t(){try{$$("popupFavsLinkSave")&&$$("popupFavsLinkSave").destructor()}catch(t){l(t,"favsLink","destrucPopupSave")}}function o(t,e,n){return{id:t,css:"popup_subtitle",borderless:!0,height:20,template:function(){return 0!==Object.keys($$(t).getValues()).length?"<div style='font-weight:600'>"+e+": </div>"+$$(t).getValues():"<div style='font-weight:600'>"+e+": </div>"+e+" "+n}}}const r={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){t()}},a={view:"button",value:"Сохранить ссылку",css:"webix_primary",click:function(){!function(){let e,n;const o=w();!function(){try{e=$$("favNameLink").getValues(),n=$$("favLink").getValues()}catch(t){l(t,"favsLink","btnSaveLinkClick => getData")}}(),function(){const r=webix.ajax().get("/init/default/api/userprefs/");r.then((function(r){r=r.json().content;const a=[];!function(){try{r.forEach((function(t){t.name.includes("fav-link")&&a.push(t.name)}))}catch(t){l(t,"favsLink","getUserprefs => getFavPrefs")}}(),function(){try{let r=!0;a.length&&a.forEach((function(t){if(t.includes(o)){const e=t.indexOf("_")+1;t.slice(e)==o&&r&&(r=!1,i("success","Такая ссылка уже есть в избранном"))}})),!a.length||r?function(){let r,a=webix.storage.local.get("user");if(a||(g(),a=webix.storage.local.get("user")),a){r=a.id;const s={name:"fav-link_"+o,owner:r,prefs:{name:e,link:n,id:o}},u=webix.ajax().post("/init/default/api/userprefs/",s);u.then((function(n){"i"==(n=n.json()).err_type?i("success","Ссылка «"+e+"»  сохранёна в избранное"):l(n.err,"favsLink","btnSaveLinkClick => postContent msg"),t()})),u.fail((function(t){c(t,"favsLink","btnSaveLinkClick => postContent")}))}}():r||t()}catch(t){l(t,"favsLink","getUserprefs => getNotUniquePrefs")}}()})),r.fail((function(t){c(t,"favsLink","getUserprefs getData")}))}()}()}};webix.ui({view:"popup",id:"popupFavsLinkSave",css:"popup_padding-container",escHide:!0,width:500,modal:!0,position:"center",body:{rows:[{rows:[{cols:[{template:"Сохранить ссылку",width:250,css:"popup_headline",borderless:!0,height:20},{},r]},o("favNameLink","Имя","не указано"),{height:5},o("favLink","Ссылка","не указана"),{height:10},a,{}]}]}}).show(),async function(){e.fields||await n("fields"),e.tableNames&&function(t){try{const n=$$("favNameLink");e.tableNames.forEach((function(e,i){e.id==t&&n&&n.setValues(e.name)}))}catch(t){l(t,"favsLink","findName")}}(w())}(),function(){try{const t=window.location.href,e=$$("favLink");e&&e.setValues(t)}catch(t){l(t,"favsLink","getLink")}}()}function y(t,e=null){let n;try{n=e||function(){return 0!==Object.keys($$(t).getValues()).length?$$(t).getValues():"Имя не указано"}}catch(t){l(t,"blockHeadline","setHeadlineBlock")}return{css:"webix_block-headline",cols:[{view:"template",id:t,borderless:!0,css:"webix_block-headline",height:34,template:n},{},{view:"button",css:"webix-transparent-btn",type:"icon",icon:"icon-star",width:50,click:function(){v()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить ссылку в избранное")}}}]}}function x(t){try{t&&t.isVisible()&&t.hide()}catch(t){l(t,"content","hideElem")}}function _(t){try{t&&!t.isVisible()&&t.show()}catch(t){l(t,"content","showElem")}}function E(t,e,n,o){let r=[];"get"==n?"refresh"==o?function(){!function(){try{t.forEach(((t,e)=>{t.id.includes("customCombo")?r.push(t.name+"="+$$(t.id).getText()):(t.id.includes("customInputs")||t.id.includes("customDatepicker"))&&r.push(t.name+"="+$$(t.id).getValue())}))}catch(t){l(t,"content","refreshButton => createQuery")}}();const n=webix.ajax(e+"?"+r.join("&"));n.then((function(t){"i"==t.json().err_type?(function(){t=t.json().content;try{$$("table-view").clearAll(),0!==t.length?($$("table-view").hideOverlay("Ничего не найдено"),$$("table-view").parse(t),i("success","Данные обновлены")):$$("table-view").showOverlay("Ничего не найдено")}catch(t){l(t,"content","refreshButton => setTableState")}}(),function(){let t,e=$$("table-view-findElements");try{t=$$("table-view").count(),e.setValues(t.toString())}catch(t){l(t,"content","refreshButton => setTableCounter")}}()):l(t.err,"content","refreshButton")})),n.fail((function(t){c(t,"content","refreshButton")}))}():"download"==o&&webix.ajax().response("blob").get(e,(function(t,e,n){try{webix.html.download(e,"table.docx")}catch(t){l(t,"content","downloadButton")}})).catch((t=>{c(t,"content","downloadButton")})):"post"==n&&function(){try{t.forEach(((t,e)=>{if(t.id.includes("customUploader")){let e=Object.values($$(t.id).files.data.pull)[0],n=$$(t.id).config.upload,o=new FormData;$$(t.id).getParentView().addView({id:"templateLoad",template:function(){return 0!==Object.keys($$("templateLoad").getValues()).length?$$("templateLoad").getValues():"Загрузка ..."},borderless:!0}),o.append("file",e.file),async function(t,e){fetch(e,{method:"POST",body:t}).then((t=>t.json())).then((function(t){const e=$$("templateLoad");"i"==t.err_type?(e.setValues("Файл загружен"),i("success","Файл успешно загружен")):(e.setValues("Ошибка"),i("error",t.err))}))}(o,n)}}))}catch(t){l(t,"content","postButton")}}()}function k(t){const e="/init/default/api/"+t;return new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get(e).then((function(t){t=t.json().content;let e,n=[];return function(){try{t.forEach(((t,i)=>{!function(t,n){try{for(;t<=Object.values(n).length;){if("string"==typeof Object.values(n)[t]){e=Object.keys(n)[t];break}t++}}catch(t){l(t,"content","getComboOptions => stringOption")}}(0,t),function(t,i){try{if(null==i[e])for(;t<=Object.values(i).length;){if("number"==typeof Object.values(i)[1]){e=Object.keys(i)[1];break}t++}n.push({id:i.id,value:i[e]})}catch(t){l(t,"content","getComboOptions => numOption")}}(0,t)}))}catch(t){l(t,"content","getComboOptions => createComboValues")}}(),n})).catch((t=>{c(t,"content","getComboOptions")}))}}})}function T(t,o){let r,a,s,u,d;function f(){let n=e.fields.content[o],i=n.inputs;!function(){!function(){try{$$("contextActionsBtn")&&$$(s.config.id).removeView($$("contextActionsBtn"))}catch(t){l(t,"content","adaptiveCustomInputs => removeContextBtn")}}();const e=$$("formsTools");if(n.inputs){let o;o=function(){let e=[];function o(t,e){const n="/init/default/api/"+t[e].apiname;return new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get(n).then((function(t){let e,n=t.json().content,i=[];function o(t,e){return{id:t+1,value:e}}return function(){try{void 0!==n[0].name?n.forEach((function(t,n){e=o(n,t.name),i.push(e)})):n.forEach((function(t,n){e=o(n,t),i.push(e)}))}catch(t){l(t,"content","generateCustomInputs => getOptionData")}}(),i})).catch((t=>{console.log(t),c(t,"content","generateCustomInputs => getOptionData")}))}}})}function r(t){let e=t.getParentView().getChildViews(),n=[];try{e.forEach(((t,e)=>{void 0!==t.config.id&&("text"==t.config.view?n.push({id:t.config.id,name:"substr"}):"combo"==t.config.view?n.push({id:t.config.id,name:"valtype"}):("uploader"==t.config.view||"datepicker"==t.config.view)&&n.push({id:t.config.id}))}))}catch(t){l(t,"content","generateCustomInputs => getInputsId")}return n}return Object.keys(n.inputs).forEach(((a,s)=>{if("string"==i[a].type)e.push(function(t,e){return{view:"text",placeholder:i[t].label,id:"customInputs"+e,height:48,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i[t].comment)},onChange:function(){$$("customInputs").getChildViews().forEach((function(t,e){"button"!=t.config.view||$$(t.config.id).isEnabled()||$$(t.config.id).enable()}))}}}}(a,s));else if("apiselect"==i[a].type)e.push(function(t,e){return{view:"combo",height:48,id:"customCombo"+e,placeholder:i[t].label,labelPosition:"top",options:{data:o(i,t)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i[t].comment)}}}}(a,s));else if("submit"==i[a].type||"button"==i[a].type){let o=i[a].action,c=n.actions[o];"DELETE"==c.verb&&"submit"!==o?function(e){let n=$$(t).getColumns().length,i=$$(t).config.columns;try{i.splice(n,0,{id:"action"+e,header:"Действие",label:"Действие",maxWidth:100,template:"{common.trashIcon()}"}),$$(t).refreshColumns()}catch(t){l(t,"content","generateCustomInputs => createDeleteAction")}}(s):"DELETE"==c.verb?e.push(function(t,e,n){return{view:"button",id:"customBtnDel"+n,css:"webix_danger",type:"icon",disabled:!0,icon:"icon-trash",inputWidth:55,inputHeight:35,value:i[t].label,click:function(t){E(r(this),e.url,"delete")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i[t].comment)}}}}(a,c,s)):e.push(function(t,e,n){return{view:"button",css:"webix_primary",id:"customBtn"+n,inputHeight:35,value:i[t].label,click:function(t){let i=r(this);"GET"==e.verb?"refresh"==e.rtype?E(i,e.url,"get","refresh"):"download"==e.rtype&&E(i,e.url,"get","download"):"POST"==e.verb?(E(i,e.url,"post"),$$("customBtn"+n).disable()):"download"==e.verb&&E(i,e.url,"get","download"),$$("contextActionsPopup")&&$$("contextActionsPopup").hide()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i[t].comment)}}}}(a,c,s))}else"upload"==i[a].type?e.push(function(t,e){return{view:"uploader",value:"Upload file",id:"customUploader"+e,height:48,autosend:!1,upload:n.actions.submit.url,label:i[t].label,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i[t].comment),this.getParentView().getChildViews().forEach((function(t,e){t.config.id.includes("customBtn")&&t.disable()}))},onBeforeFileAdd:function(){const t=$$("templateLoad");t&&t.getParentView().removeView(t)},onAfterFileAdd:function(t){this.getParentView().getChildViews().forEach((function(t,e){t.config.id.includes("customBtn")&&t.enable()}))}}}}(a,s)):"datetime"==i[a].type?e.push(function(t,e){return{view:"datepicker",format:"%d.%m.%Y %H:%i:%s",placeholder:i[t].label,id:"customDatepicker"+e,timepicker:!0,labelPosition:"top",height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i[t].comment)},onChange:function(){try{$$("customInputs").getChildViews().forEach((function(t,e){"button"!=t.config.view||$$(t.config.id).isEnabled()||$$(t.config.id).enable()}))}catch(t){l(t,"content","generateCustomInputs => createDatepicker onChange")}}}}}(a,s)):"checkbox"==i[a].type&&e.push(function(t,e){return{view:"checkbox",id:"customСheckbox"+e,css:"webix_checkbox-style",labelRight:i[t].label,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i[t].comment)},onChange:function(){try{$$("customInputs").getChildViews().forEach((function(t,e){"button"!=t.config.view||$$(t.config.id).isEnabled()||$$(t.config.id).enable()}))}catch(t){l(t,"content","generateCustomInputs => createCheckbox onChange")}}}}}(a,s))})),e}();const r=$$("table-view-filterId").getParentView(),a={view:"button",width:50,type:"icon",id:"viewToolsBtn",icon:"icon-filter",css:"webix_btn-filter webix-transparent-btn",title:"текст",height:42,click:function(){!function(){const t=document.querySelector(".webix_btn-filter"),n="webix-transparent-btn--primary",i="webix-transparent-btn",o=$$("formsTools-resizer"),r=$$("viewTools"),a=$$("formsContainer").$width;t.classList.contains(n)?(t.classList.add(i),t.classList.remove(n),x(e),x(o)):t.classList.contains(i)&&(t.classList.add(n),t.classList.remove(i),_(e),_(o),_(r)),t.classList.contains(i)?(x(e),x(o),x($$("table-backFormsBtnFilter")),_($$("formsContainer"))):(a<850?(x($$("tree")),a<850&&(x($$("formsContainer")),x($$("tree")),_($$("table-backFormsBtnFilter")),x(o),e.config.width=window.innerWidth-45,e.resize())):(x($$("table-backFormsBtnFilter")),e.config.width=350,e.resize()),_(o))}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть доступные дейсвтия")}}};$$("viewToolsBtn")?_($$("viewToolsBtn")):r.addView(a,2),function(t){let e={id:"customInputs",css:"webix_custom-inp",rows:[{height:20},{rows:t}],width:350};!function(){try{$$("viewToolsContainer").addView(e,0)}catch(t){l(t,"content","adaptiveCustomInputs => addInputs")}}()}(o)}else x(e),x($$("viewToolsBtn"))}()}!function(){if(u=o,d=$$("tree").getItem(o),d||(d=o),t.includes("view"))try{r="table-view-search",a="table-view-findElements",s=$$("table-view-filterId").getParentView()}catch(t){l(t,"content","getValsTable")}else try{r="table-search",a="table-findElements",s=$$("table-filterId").getParentView()}catch(t){l(t,"content","getValsTable")}}(),null==d?i("error","Данные не найдены"):(function(){try{$$(t).clearAll(),"table-view"==t&&($$("contextActionsPopup")&&$$("contextActionsPopup").destructor(),$$("contextActionsBtnAdaptive")&&s.removeView($$("contextActionsBtnAdaptive")),$$("customInputs")&&$$("customInputs").getParentView().removeView($$("customInputs")),$$("customInputsMain")&&$$("customInputsMain").getParentView().removeView($$("customInputsMain")))}catch(t){l(t,"content","preparationTable")}}(),async function(){e.fields||await n("fields"),e.fields&&(e.fields.content.treeTemplate={fields:{id:{type:"id",unique:!1,notnull:!1,length:512,label:"Id",comment:null,default:"None"},pid:{type:"reference trees",unique:!1,notnull:!1,length:512,label:"Родитель",comment:null,default:"None"},owner:{type:"reference auth_user",unique:!1,notnull:!1,length:512,label:"Владелец",comment:null,default:"None"},ttype:{type:"integer",unique:!1,notnull:!1,length:512,label:"Тип",comment:"Тип записи|1=системная;2=пользовательская|Перечисление",default:"1"},name:{type:"string",unique:!1,notnull:!1,length:100,label:"Наименование",comment:null,default:""},descr:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Описание",comment:null,default:""},value:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Значение",comment:null,default:""},cdt:{type:"datetime",unique:!1,notnull:!1,length:512,label:"Создано",comment:null,default:"now"}},singular:"Классификатор-пример",ref_name:"name",plural:"Классификаторы-пример",type:"treeConf"},function(n){let i,r,a=!1,s=e.fields.content[o];if(n.forEach((function(t,e){"action"==t.type&&"detail"==s.actions[t.id].rtype&&(a=!0,i=e,r=t.id)})),void 0!==r){let e=s.actions[r].url;a&&($$(t).config.columns.splice(0,0,{id:"action-first"+i,maxWidth:130,src:e,label:"Подробнее",header:"Подробнее",template:"<span class='webix_icon wxi-angle-down'></span> "}),$$(t).refreshColumns())}}(function(){let n,i=e.fields.content[o],r=i.fields,a=Object.keys(i.fields),s=[];try{a.forEach((function(t){n=r[t].type,n.includes("reference")?function(){try{let e=n.slice(10);r[t].editor="combo",r[t].collection=k(e),r[t].template=function(t,e,n,i){let o=i.collection.getItem(t[i.id]);return o?o.value:""}}catch(t){l(t,"content","createTableCols => createReferenceCol")}}():"datetime"==n?function(){try{r[t].format=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s"),r[t].editor="date"}catch(t){l(t,"content","createTableCols => createDatetimeCol")}}():"boolean"==n?function(){try{r[t].editor="combo",r[t].sort="text",r[t].collection=[{id:1,value:"Да"},{id:2,value:"Нет"}]}catch(t){l(t,"content","createTableCols => createBoolCol")}}():"integer"==n?function(){try{r[t].editor="text",r[t].sort="int",r[t].numberFormat="1 111"}catch(t){l(t,"content","createTableCols => createIntegerCol")}}():function(){try{r[t].editor="text",r[t].sort="string"}catch(t){l(t,"content","createTableCols => createTextCol")}}(),r[t].id=t,r[t].fillspace=!0,r[t].header=r[t].label,"id"==r[t].id&&function(){let e=webix.storage.local.get("userprefsOtherForm");e&&"2"==e.visibleIdOpt&&(r[t].hidden=!0)}(),function(){try{s.push(r[t])}catch(t){l(t,"content","createTableCols => pushColsData")}}()})),function(e){$$(t)&&$$(t).refreshColumns(e)}(s)}catch(t){l(t,"content","createTableCols")}return s}()),f(),function(){let n=e.fields.content[o];function i(e){$$(e).load({$proxy:!0,load:function(n,i){return webix.ajax().get("/init/default/api/"+u,{success:function(n,i,o){i=i.json().content,$$(e).config.idTable=u;try{$$(e).clearAll(),function(){try{"table"==e&&($$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable(),$$("table-filterId").isEnabled()||$$("table-filterId").enable(),$$("table-exportBtn").isEnabled()||$$("table-exportBtn").enable())}catch(t){l(t,"content","createTableRows => setTableState")}}(),function(t){let n;const i=$$(e).getColumns();let o=[];!function(){try{i.forEach((function(t,e){"datetime"==t.type&&o.push(t.id)}))}catch(t){l(t,"content","createTableRows => searchDateCols")}}(),t.forEach((function(t,e){function i(e){t[e]&&(n=new Date(t[e]),t[e]=n)}o.forEach((function(t,e){i(t)}))}))}(i),function(e){const n=$$(t);try{0!==e.length?(n.hideOverlay("Ничего не найдено"),n.parse(e)):(n.showOverlay("Ничего не найдено"),n.clearAll()),function(){const e=$$(t);try{const t=e.config.idTable,n=webix.storage.local.get("visibleColsPrefs_"+t);n&&n.forEach((function(t){t.value?e.isColumnVisible(t.id)||e.showColumn(t.id):e.isColumnVisible(t.id)&&e.hideColumn(t.id)}))}catch(t){l(t,"table","onAfterLoad => getUserPrefs")}}()}catch(t){l(t,"content","createTableRows => parseRowData")}}(i),function(){let e;try{e=$$(t).count(),$$(a).setValues(e.toString()),"table"==t&&$$("table-findElements").setValues(e.toString())}catch(t){l(t,"content","createTableRows => setCounterVal")}}()}catch(t){l(t,"content","getItemData => table load")}},error:function(t,e,n){!function(){try{$$(a).setValues("-".toString()),$$("table-findElements").setValues("-".toString()),$$("table-newAddBtnId").isEnabled()&&$$("table-newAddBtnId").disable(),$$("table-filterId")&&$$("table-filterId").disable(),$$("table-exportBtn")&&$$("table-exportBtn").disable()}catch(t){l(t,"content","tableErrorState")}}(),401==n.status&&($$("popupNotAuth")||function(){const t={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){try{$$("popupNotAuth")&&$$("popupNotAuth").destructor()}catch(t){l(t,"content","notAuthPopup btnClosePopup click")}}},e={view:"button",css:"webix_btn-go-login",height:46,value:"Войти",click:function(){!function(){try{$$("popupNotAuth")&&$$("popupNotAuth").destructor()}catch(t){l(t,"content","notAuthPopup destructPopup")}}(),function(){try{Backbone.history.navigate("/",{trigger:!0}),window.location.reload()}catch(t){l(t,"content","notAuthPopup navigate")}}()}};webix.ui({view:"popup",id:"popupNotAuth",css:"webix_popup-prev-href",width:340,height:125,modal:!0,position:"center",body:{rows:[{rows:[{cols:[{template:"Вы не авторизованы",width:250,css:"webix_template-not-found",borderless:!0,height:20},{},t]},{template:"Войдите в систему, чтобы продолжить.",css:"webix_template-not-found-descr",borderless:!0,height:35},e,{height:20}]}]}}).show()}())}})}}).finally((function(){}))}"dbtable"==n.type?i("table"):"tform"==n.type&&i("table-view"),function(){if(n.autorefresh){let t=webix.storage.local.get("userprefsOtherForm");t&&void 0!==t.autorefCounterOpt&&(t.autorefCounterOpt>=15e3?setInterval((function(){"dbtable"==n.type?i("table"):"tform"==n.type&&i("table-view")}),t.autorefCounterOpt):setInterval((function(){"dbtable"==n.type?i("table"):"tform"==n.type&&i("table-view")}),12e4))}}()}())}())}function V(t,o=!1){let r;function a(){try{let t,e=$$("dashBodyScroll");e&&(t=e.getParentView(),e&&t.removeView(e))}catch(t){l(t,"content","getInfoDashboard => removeScroll")}}function s(t,n,o=!1){const s=webix.ajax().get(t);s.then((function(c){let u=[{type:"wide",rows:[]}],d=c.json().charts,f={};a(),o||function(){let t,e;function n(n){try{if(n){t=n,e=t.getParentView();try{t&&e.removeView(t)}catch(t){l(t,"content","getAjax => setVars")}}}catch(t){l(t,"content","getInfoDashboard => setVars")}}n($$("dashboardInfoContainerInner")),n($$("dash-template")),n($$("dashboard-tool-main")),n($$("dashboard-tool-adaptive"))}(),null==d?(function(){try{$$("dashboardTool").addView({view:"scrollview",id:"dashboard-tool-main",borderless:!0,css:{margin:"20px!important",height:"50px!important"},body:{view:"flexlayout",padding:20,rows:[]}},0),$$("dashboardTool").addView({rows:[{template:"",id:"dash-template",css:"webix_style-template-count webix-block-title",borderless:!1,height:40}]},1);const t={id:"dashboard-charts",borderless:!0,body:{view:"flexlayout",rows:[]}};$$("dashboardInfoContainer").addView({view:"scrollview",scroll:"auto",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[t]}})}catch(t){l(t,"content","getInfoDashboard => addErrorView")}}(),i("error","Ошибка при загрузке данных")):(function(){try{d.forEach((function(t,e){f=t.title,delete t.title,t.borderless=!0,t.minWidth=250,u[0].rows.push({css:"webix_dash-chart-headline",rows:[{template:f,borderless:!0,css:{"font-weight":"400!important","font-size":"17px!important"},height:35},t]})}))}catch(t){l(t,"content","getInfoDashboard => createCharts")}}(),o?function(){const t={id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",rows:u};try{$$("dashboardInfoContainerInner").addView({view:"scrollview",scroll:"y",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[t]}})}catch(t){l(t,"content","getInfoDashboard => updateDash")}}():(function(){const t={id:"dashboard-tool-main",padding:20,hidden:!0,minWidth:250,rows:[{id:"dashboardToolHeadContainer",cols:[{template:"Фильтр",height:30,css:"webix_dash-filter-headline",borderless:!0},{view:"button",id:"dash-backDashBtn",type:"icon",icon:"icon-arrow-right",value:"Вернуться к дашбордам",hidden:!0,height:15,hotkey:"esc",minWidth:50,width:55,click:function(){x($$("dashboard-tool-main")),_($$("dashboardInfoContainer"))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Вернуться к дашбордам")}}}]},{rows:n}]};try{$$("dashboardTool").addView(t)}catch(t){l(t,"content","getInfoDashboard => createMainView")}}(),function(){const t=y("dash-template"),n={view:"scrollview",scroll:"y",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",rows:u}]}};try{$$("dashboardInfoContainer").addView({id:"dashboardInfoContainerInner",rows:[t,n]})}catch(t){l(t,"content","getInfoDashboard => createDashInfo")}!async function(){try{e.tableNames||await s("fields"),e.tableNames&&e.tableNames.forEach((function(t,e){t.id==r&&$$("dash-template").setValues(t.name.toString())}))}catch(t){l(t,"content","getInfoDashboard => setTableName")}}()}(),function(){const t={view:"button",id:"dashFilterBtn",css:"webix-transparent-btn",type:"icon",icon:"icon-filter",width:50,click:function(){!function(){const t=$$("dashboard-tool-main");t.isVisible()?x(t):_(t),$$("dashboardContainer").$width<850?(x($$("tree")),$$("dashboardContainer").$width<850&&(x($$("tree")),x($$("dashboardInfoContainer")),_(t),_($$("dash-backDashBtn")),t.config.width=window.innerWidth-45,t.resize())):(x($$("dash-backDashBtn")),350!==t.config.width&&(t.config.width=350,t.resize()))}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть фильтры")}}},e=$$("dash-template").getParentView(),n=$$(e.config.id);$$("dashFilterBtn")||n.addView({id:"dashboard-tool-btn",cols:[t]},2)}())),function(){try{"icon-eye"==$$("webix_log-btn").config.icon?($$("logLayout").config.height=90,$$("logLayout").resize(),$$("logLayout").config.height=5,$$("logLayout").resize()):($$("logLayout").config.height=5,$$("logLayout").resize(),$$("logLayout").config.height=90,$$("logLayout").resize())}catch(t){l(t,"content","getInfoDashboard => setScrollHeight")}}(),(t.includes("?")||t.includes("sdt")&&t.includes("edt"))&&i("success","Данные обновлены")})),s.fail((function(t){c(t,"content","getInfoDashboard => getAjax")}))}t?r=t:$$("tree").getSelectedItem()&&(r=$$("tree").getSelectedItem().id),a(),$$("dashBodyScroll")||async function(){e.fields||await n("fields"),e.fields&&function(){let t,n,o,a=e.fields.content,c=[];function u(e,o){function r(t,e){let n={view:"datepicker",format:"%d.%m.%y",editable:!0,value:new Date,placeholder:e.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",e.comment)}}};if("first"==t){let t=n;return t.id="dashDatepicker_sdt",t}if("last"==t){let t=n;return t.id="dashDatepicker_edt",t}}function a(t){let e={view:"datepicker",format:"%H:%i:%s",placeholder:"Время",height:48,editable:!0,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",hotkey:"enter",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}};if("first"==t){let t=e;return t.id="dashDatepicker_sdt-time",t}if("last"==t){let t=e;return t.id="dashDatepicker_edt-time",t}}function u(t,e){return{rows:[{height:10},{view:"button",css:"webix_primary",id:"dashBtn"+e,inputHeight:48,height:48,minWidth:100,maxWidth:200,value:t.label,click:function(){!function(){let t,o=[],r=[],a=webix.Date.dateToStr("%d.%m.%y"),u=webix.Date.dateToStr("%H:%i:%s"),d="",f="",h=!0;!function(){try{c.forEach((function(t,e){t.id.includes("container")&&function(t){try{$$(t.id).getChildViews().forEach((function(t,e){function n(e){if(null!==$$(t.config.id).getValue()){let n=$$(t.config.id).getValue();"sdt"==e?d=d.concat(" "+u(n)):"edt"==e&&(f=f.concat(" "+u(n)))}else h=!1}function i(e){if(null!==$$(t.config.id).getValue()){let n=$$(t.config.id).getValue();"sdt"==e?d=a(n):"edt"==e&&(f=a(n))}else h=!1}t.config.id.includes("sdt")?t.config.id.includes("time")?n("sdt"):i("sdt"):t.config.id.includes("edt")&&(t.config.id.includes("time")?n("edt"):i("edt"))}))}catch(t){l(t,"content","getInfoDashboard => enumerationElements")}}(t)}))}catch(t){l(t,"content","getInfoDashboard => setInputs")}}(),o.push("sdt="+d),o.push("edt="+f),r.push(d),r.push(f),function(){if(h){let a=webix.Date.dateToStr("%Y/%m/%d %H:%i:%s"),u=a(r[0]),d=a(r[1]);webix.filters.date.greater(u,d)&&r[0]!=r[1]?i("error","Начало периода больше, чем конец"):(t=n.url+"?"+o.join("&"),function(){try{let t=$$("dashboard-charts");t&&$$("dashboardBody").removeView(t)}catch(t){l(t,"content","getInfoDashboard => removeCharts")}}(),s(t,c,!0),function(){try{$$("dashBtn"+e).disable(),setInterval((function(){$$("dashBtn"+e).enable()}),1e3)}catch(t){l(t,"content","getInfoDashboard => setStateBtn")}}())}else i("error","Не все поля заполнены")}()}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",t.comment)}}},{}]}}return function(i){Object.values(e).forEach((function(o,s){"datetime"==o.type&&3==o.order?(Object.keys(e)[s],function(){try{c.push({width:200,id:"datepicker-containersdt",rows:[{template:"Начиная с:",height:30,borderless:!0,css:"webix_template-datepicker"},r("first",o),{height:10},a("first"),{height:20},{template:"Заканчивая:",height:30,borderless:!0,css:"webix_template-datepicker"},r("last",o),{height:10},a("last")]})}catch(t){l(t,"content","getInfoDashboard => createInputs")}}()):"submit"==o.type&&(t=o.action,n=i.actions[t],c.push(u(o,s)))}))}(o),c}Object.values(a).forEach((function(t,e){if("dashboard"==t.type&&Object.keys(a)[e]==r){let e=t.inputs;s(t.actions.submit.url,u(e,t)),function(t){if(t.autorefresh){let t=webix.storage.local.get("userprefsOtherForm");try{void 0!==t.autorefCounterOpt&&(t.autorefCounterOpt>=15e3?setInterval((function(){s(o.actions.submit.url,c)}),t.autorefCounterOpt):setInterval((function(){s(o.actions.submit.url,c)}),5e4))}catch(t){l(t,"content","getInfoDashboard => autorefresh")}}}(t)}}))}()}()}function C(){const t=$$("treeEdit");t.clearAll();const e=webix.ajax().get("/init/default/api/trees");e.then((function(e){(e=e.json().content)[0].pid=0;let n={},i=[],o=[];!function(){try{e.forEach((function(t,e){0==t.pid?o.push({id:t.id,open:!0,value:t.name,pid:t.pid,data:[]}):o.push({id:t.id,value:t.name,pid:t.pid,data:[]})}))}catch(t){l(t,"content","pushTreeData")}}(),function(){try{o.forEach((function(t,e){n[t.id]=e,0!==t.pid&&t.pid!==t.id&&null!==t.pid?o[n[t.pid]].data.push(t):i.push(t)}))}catch(t){l(t,"content","createStruct")}}(),t.parse(i)})),e.fail((function(t){c(t,"content","getInfoEditTree")}))}const S="tableEditForm => property";function B(t=!1){try{const e=$$("editTableFormProperty");e&&(e.config.dirty=t,e.refresh())}catch(t){l(t,S,"setDirtyProperty")}}function I(t,e){try{const n=$$("editTableFormProperty");n.getItem(t).value=e,n.updateItem(t),B(!0)}catch(t){l(t,S,"editingEnd")}}const F={scroll:"y",cols:[{cols:[{id:"propertyRefbtns",rows:[]},{width:5}]},{width:4},{view:"property",id:"editTableFormProperty",css:"webix_edit-table-form-property",dirty:!1,nameWidth:150,editable:!0,tooltip:function(t){const e="Название: "+t.label+" <br>",n=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s:%S");let i,o;return o="date"==t.type?"Выберите дату":"combo"==t.type?"Выберите значение":"integer"==t.customType?"Введите число":"Введите текст",i="date"==t.type?n(t.value):t.value,t.value?e+"Значение: "+i:e+o},hidden:!0,elements:[],on:{onEditorChange:function(t,e){I(t,e),function(){const t=$$("table-saveBtn");t&&t.isVisible()&&!t.isEnabled()&&t.enable()}(),document.getElementById("custom-date-editor")&&document.getElementById("custom-date-editor").addEventListener("input",(function(t){const e=t.target.value.replace(/\D/g,"").match(/(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})/);function n(t){return e[t]?e[t]:" __ "}"deleteContentBackward"!==t.inputType&&(t.target.value=n(1)+"."+n(2)+"."+n(3)+"  "+n(4)+":"+n(5)+":"+n(6))}))},onBeforeRender:function(){const t=28*this.config.elements.length;t&&this.$height!==t&&(this.define("height",t),this.resize())},onAfterEditStop:function(t,e){t.value!==t.old&&I(e.id,t.value)}}},{width:4}]},A="tableEditForm => validation";function j(){const t={},e=[];try{!function(){const e=$$("editTableFormProperty");Object.keys(e.getValues()).forEach((function(n,i){const o=e.getItem(n),r=e.getValues();t[n]={},function(){if(o.type&&"customDate"==o.type){let e=!1;const i=r[n].replace(/\D/g,"").match(/(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})/);for(let t=1;t<7;t++)2===i[t].length||e||e||(e=!0);t[n].date=e?"Неверный формат даты. Введите дату в формате xx.xx.xx xx:xx:xx":null}}(),function(){if(o.customType&&"integer"==o.customType){const i=(e=r[n],/\D/.test(e));t[n].isNum=i?"Данное поле должно содержать только числа":null}var e}(),function(){try{r[n]&&(r[n].length>o.length&&0!==o.length?t[n].length="Длина строки не должна превышать "+o.length+" симв.":t[n].length=null)}catch(t){l(t,A,"valLength")}}(),function(){try{1==o.notnull&&0==r[n].length?t[n].notnull="Поле не может быть пустым":t[n].notnull=null}catch(t){l(t,A,"valNotNull")}}(),function(){try{if(t[n].unique=null,1==o.unique){const e=Object.values($$("table").data.pull),i=$$("table").getSelectedId().id;e.forEach((function(e,o){0==r[n].localeCompare(e[n])&&e.id!==i&&(t[n].unique="Поле должно быть уникальным")}))}}catch(t){l(t,A,"valUnique")}}()}))}(),Object.values(t).forEach((function(n,i){Object.values(n).forEach((function(o,r){if(null!==o){let a=Object.keys(t)[i],s=o,c=Object.keys(n)[r];e.push({nameCol:a,typeError:c,textError:s})}}))}))}catch(t){l(t,A,"validateProfForm")}return e}function P(){try{const t=$$("table");j().forEach((function(e,n){let o;t.getColumns().forEach((function(t,n){t.id==e.nameCol&&(o=t.label)})),i("error",e.textError+" (Поле: "+o+")")}))}catch(t){l(t,A,"setLogError")}}const L="tableEditForm => buttons";function O(t=!1,e=!1){try{const n=$$("editTableFormProperty").getValues(),o=u();if(j().length)j().forEach((function(t,e){P()}));else if(n.id){const r="/init/default/api/"+o+"/"+n.id,a=$$("table-editForm"),s=$$("editTableFormProperty"),u=$$("table-newAddBtnId"),h=$$("EditEmptyTempalte"),p=$$("tableContainer"),b=webix.ajax().put(r,function(t){const e={};try{const n=$$("table");Object.values(t).forEach((function(i,o){const r=n.getItem(t.id),a=Object.keys(r);!function(){const n=Object.keys(t)[o];a.forEach((function(i){i==n&&r[i]!==Object.values(t)[o]&&(e[n]=Object.values(t)[o])}))}()}))}catch(t){l(t,A,"uniqueData")}return console.log(e,"validateData"),e}(n));b.then((function(r){"i"==(r=r.json()).err_type?(e||(function(t){try{const e=$$("table");e.updateItem(t.id,t),e.clearSelection(),Q()}catch(t){l(t,L,"saveItem => updateWorkspace")}}(n),d(a)),t?(f(s),function(){const t=$$("table"),e=$$("table-delBtnId"),n=$$("table-saveBtn"),i=$$("table-saveNewBtn");try{t.filter(!1),G("table-editForm"),e.disable(),n.hide(),i.show()}catch(t){l(t,L,"saveItem => addNewStateSpace")}}(),d(h)):(u.enable(),function(t){try{t.config.dirty=!1,t.refresh()}catch(t){l(t,L,"saveItem => setDirtyProp")}}(s)),f(p),window.innerWidth<850&&a.hide(),i("success","Данные сохранены",o)):i("error",L+" function saveItem: "+r.err)})),b.fail((function(t){c(t,L,"saveItem")}))}}catch(t){l(t,L,"saveItem")}}function N(){const t=u();if(j().length)P();else{const e=$$("table-editForm"),n=$$("editTableFormProperty"),o=n.getValues(),r=function(t){const e=Object.values(t),n=Object.keys(t),i={};return e.forEach((function(t,e){t&&(i[n[e]]=t)})),i}(o),a=webix.ajax().post("/init/default/api/"+t,r);a.then((function(r){if(null!==(r=r.json()).content.id)if("i"==r.err_type){try{o.id=r.content.id,$$("table").add(o),Q(),function(){try{n.config.dirty=!1,n.refresh()}catch(t){l(t,L,"saveNewItem => setDirtyProp")}}(),$$("table-newAddBtnId").enable(),d(e),f($$("tableContainer")),window.innerWidth<850&&e.hide()}catch(t){l(t,L,"saveNewItem")}i("success","Данные успешно добавлены",t)}else console.log(r),i("error",L+" function saveNewItem: "+r.err);else{let t=r.content.errors,e="";Object.values(t).forEach((function(n,i){e+=n+" (Поле: "+Object.keys(t)[i]+"); "})),i("error","editTableForm function saveNewItem: "+e)}})),a.fail((function(t){c(t,"tableEditForm => btns","saveNewItem")}))}}const D={view:"button",id:"table-newAddBtnId",height:48,minWidth:90,disabled:!0,hotkey:"shift",value:"Новая запись",click:function(){const t=$$("EditEmptyTempalte"),e=$$("editTableFormProperty"),n=$$("table");function i(){try{n.filter(!1),n.clearSelection(),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show(),$$("table-newAddBtnId").disable(),G("table-editForm"),d(t)}catch(t){l(t,L,"addItem => setWorkspaceState")}}function o(){try{e.config.dirty=!1,e.refresh()}catch(t){l(t,L,"addItem => setDirtyProp")}}try{1==e.config.dirty?m().then((function(e){1==e?(i(),o()):2==e&&(O(!0),o(),d(t))})):(f(e),e.clear(),i(),n.hideOverlay("Ничего не найдено"))}catch(t){l(t,L,"addItem")}}},R={view:"button",id:"table-delBtnId",disabled:!0,height:48,minWidth:90,width:100,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"icon-trash",click:function(){try{const t=u();$("Запись будет удалена").then((function(){const e=$$("editTableFormProperty").getValues(),n=$$("table"),o=n.getSelectedId().id;n&&n.remove(o);const r="/init/default/api/"+t+"/"+e.id+".json",a=webix.ajax().del(r,e);a.then((function(t){"i"==(t=t.json()).err_type?(Q(),B(),f($$("tableContainer")),window.innerWidth<850&&$$("table-editForm").hide(),i("success","Данные успешно удалены")):i("error","editTableForm function removeItem: "+t.err)})),a.fail((function(t){c(t,L,"removeItem")}))}))}catch(t){l(t,L,"removeItem")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить запись из таблицы")}}},z={view:"button",id:"table-backTableBtn",type:"icon",icon:"icon-arrow-left",value:"Вернуться к таблице",hidden:!0,height:48,minWidth:60,width:90,click:function(){!function(){const t=$$("table-editForm"),e=$$("tableContainer"),n=$$("editTableFormProperty"),i=$$("table");function o(){d(t),f(e),i&&i.clearSelection()}n.config.dirty?m().then((function(t){1!=t&&2!=t||(1==t?o():2==t&&(n.getValues().id?(O(),o()):N()),B())})):o()}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Вернуться к таблице")}}},W={minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{cols:[{id:"tablePropBtnsSpace",width:35,hidden:!0},{rows:[{margin:5,rows:[{margin:5,cols:[z,D,R]}]},{margin:10,rows:[{view:"button",id:"table-saveBtn",hidden:!0,value:"Сохранить",height:48,css:"webix_primary",click:function(){O()}},{view:"button",id:"table-saveNewBtn",value:"Сохранить новую запись",hidden:!0,height:48,css:"webix_primary",click:function(){N()}},{id:"EditEmptyTempalte",css:"webix_empty-template",template:"Добавьте новую запись или выберите существующую из таблицы",borderless:!0}]}]}]}]},H="tableEditForm => states";function M(t){try{const e=t;e&&e.destructor()}catch(t){l(t,H,"destructPopup")}}function U(t){try{const e=t;e&&!e.isEnabled()&&e.enable()}catch(t){l(t,H,"enableBtn")}}function q(t){const i=$$("table"),o=$$("tree");try{i.getColumns().forEach((function(i,r){if(i.id==t){const t=i.type.slice(10);o.getItem(t)?o.select(t):t&&async function(t){e.fields||await n("fields"),e.fields&&t&&(Backbone.history.navigate("tree/"+t,{trigger:!0}),window.location.reload())}(t)}}))}catch(t){l(t,H,"setRefTable"),d($$("EditEmptyTempalte"))}}function J(t){const e=$$("editTableFormProperty");!function(){try{$$("propertyRefbtnsContainer").addView({view:"button",type:"icon",width:30,height:29,icon:"icon-window-restore",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Открыть большой редактор текста")}},click:function(){!function(){const n={template:"Редактор поля  «"+t.label+"»",width:250,css:"popup_headline",borderless:!0,height:20},i={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){!function(){const n=$$("editPropTextarea"),i=n.getValue();n.dirtyValue?m().then((function(n){1!=n&&2!=n||(2==n&&e.setValues({[t.id]:[i]},!0),M($$("editTablePopupText")))})):M($$("editTablePopupText"))}()}},o={view:"textarea",id:"editPropTextarea",height:150,dirtyValue:!1,placeholder:"Введите текст",on:{onKeyPress:function(){U($$("editPropSubmitBtn")),$$("editPropTextarea").dirtyValue=!0}}},r={view:"button",id:"editPropSubmitBtn",value:"Добавить значение",css:"webix_primary",disabled:!0,click:function(){!function(){try{const n=$$("editPropTextarea").getValue();e.setValues({[t.id]:[n]},!0)}catch(t){l(t,H,"editPropSubmitClick")}M($$("editTablePopupText"))}()}};webix.ui({view:"popup",id:"editTablePopupText",css:"webix_popup-prev-href",width:400,minHeight:300,modal:!0,escHide:!0,position:"center",body:{rows:[{rows:[{cols:[n,{},i]},o,{height:15},r]}]}}).show(),function(){try{const e=$$("editPropTextarea");t.value&&e.setValue(t.value)}catch(t){l(t,H,"setTextareaVal")}}()}()}})}catch(t){l(t,H,"createBtnTextEditor")}}(),f($$("tablePropBtnsSpace"))}function Y(t){const e=$$("editTableFormProperty");!function(){try{$$("propertyRefbtnsContainer").addView({view:"button",type:"icon",width:30,height:29,icon:"icon-calendar",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Открыть календарь")}},click:function(n){!function(){const n=webix.Date.dateToStr("%d.%m.%y");function i(){const i=e.getValues().id,o=$$("editCalendarDate"),r=$$("hourInp").getValue(),a=$$("minInp").getValue(),s=$$("secInp").getValue(),c=r+":"+a+":"+s,u=n(o.getValue())+" "+c,d=[];function f(t,e,n){try{t>e&&($$("timeForm").markInvalid(n),d.push(n)),/^\d+$/.test(t)||($$("timeForm").markInvalid(n),d.push(n)),t.length<2&&($$("timeForm").markInvalid(n),d.push(n))}catch(t){l(t,H,"validTime element: "+n)}}f(r,23,"hourInp"),f(a,59,"minInp"),f(s,59,"secInp"),function(){try{d.length||(e.setValues({[t.id]:u},!0),i&&e.setValues({id:i},!0),M($$("editTablePopupCalendar")))}catch(t){l(t,H,"setValToProperty")}}()}!function(){const n={template:"Редактор поля  «"+t.label+"»",width:250,css:"popup_headline",borderless:!0,height:20},o={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){!function(){let t=!1;function e(e){e.config.dirtyProp&&!t&&(t=!0)}e($$("editCalendarDate")),e($$("hourInp")),e($$("minInp")),e($$("secInp")),t?m().then((function(t){1!=t&&2!=t||(2==t&&i(),M($$("editTablePopupCalendar")))})):M($$("editTablePopupCalendar"))}()}};function r(t){return{view:"text",name:t,id:t,placeholder:"00",attributes:{maxlength:2},dirtyProp:!1,on:{onKeyPress:function(){$$("timeForm").markInvalid(t,!1),U($$("editPropCalendarSubmitBtn"))},onChange:function(){this.config.dirtyProp=!0,U($$("editPropCalendarSubmitBtn"))}}}}function a(t){return{template:":",id:t,borderless:!0,width:9,height:5,css:"popup_time-spacer"}}const s={rows:[{view:"calendar",format:"%d.%m.%y",borderless:!0,id:"editCalendarDate",width:300,height:250,dirtyProp:!1,on:{onChange:function(){this.config.dirtyProp=!0,U($$("editPropCalendarSubmitBtn"))}}},{height:10},{view:"form",id:"timeForm",height:85,type:"space",elements:[{template:"<div style='font-size:13px!important'>Введите время в формате xx : xx : xx</div>",borderless:!0,css:"popup_time-timeFormHead"},{cols:[r("hourInp"),a(1),r("minInp"),a(2),r("secInp")]}]},{height:10}]},c={view:"button",id:"editPropCalendarSubmitBtn",value:"Добавить значение",css:"webix_primary",click:function(){i()}};webix.ui({view:"popup",id:"editTablePopupCalendar",css:"webix_popup-prev-href",width:400,minHeight:300,modal:!0,escHide:!0,position:"center",body:{rows:[{rows:[{cols:[n,{},o]},s,{height:15},c]}]}}).show(),function(){const n=e.getValues()[t.id],i=webix.Date.dateToStr("%H"),o=webix.Date.dateToStr("%i"),r=webix.Date.dateToStr("%s"),a=$$("editCalendarDate"),s=$$("editPropCalendarSubmitBtn");function c(t){t.config.dirtyProp=!1}!function(){try{n&&!isNaN(i(n))?(a.setValue(n),$$("hourInp").setValue(i(n)),$$("minInp").setValue(o(n)),$$("secInp").setValue(r(n))):(a.setValue(new Date),s&&s.disable()),c(a),c($$("hourInp")),c($$("minInp")),c($$("secInp"))}catch(t){l(t,H,"setValuesDate")}}()}()}()}()}})}catch(t){l(t,H,"createDateBtn")}}(),f($$("tablePropBtnsSpace"))}function K(){const t=$$("editTableFormProperty"),e=$$("propertyRefbtns");let n=t.config.elements;e._cells.length||($$("propertyRefbtnsContainer")||function(){try{e.addView({id:"propertyRefbtnsContainer",rows:[]})}catch(t){l(t,H,"createBtnsContainer")}}(),n.forEach((function(t,e){"combo"==t.type?function(t){const e=$$("editTableFormProperty");!function(){try{$$("propertyRefbtnsContainer").addView({view:"button",type:"icon",srcTable:t,width:30,height:29,icon:"icon-share-square-o",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Перейти в родительскую таблицу")}},click:function(t){!function(t){const n=$$(t).config.srcTable;e.config.dirty?function(){try{m().then((function(t){1!=t&&2!=t||(1==t||2==t&&(e.getValues().id?O(!1,!0):N()),B(),q(n))}))}catch(t){l(t,H,"createModalBox")}}():q(n)}(t)}})}catch(t){l(t,H,"btnLayout")}}(),f($$("tablePropBtnsSpace"))}(t.id):"popup"==t.customType?J(t):"customDate"==t.type?Y(t):$$("propertyRefbtnsContainer").addView({height:29,width:1})})))}function G(t){const e=$$("editTableFormProperty");try{const i=$$("table").getColumns();if(0==Object.keys($$(t).elements).length){const t=[];i.forEach(((e,n)=>{let i={id:e.id,label:e.label,unique:e.unique,notnull:e.notnull,length:e.length,value:function(){const t=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s");let n;return"now"===e.default&&"datetime"==e.type?n=t(new Date):Date.parse(new Date(e.default))&&"datetime"==e.type?n=t(new Date(e.default)):e.default.includes("make_guid")?n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})):"False"==e.default?n=2:"True"==e.default?n=1:"None"!==e.default&&"null"!==e.default?n=e.default:"None"==e.default?n="":"null"==e.default&&(n=null),n}()};function o(){(0==e.length||e.length>512)&&(i.customType="popup"),i.type="text"}"datetime"==e.type?i.type="customDate":e.type.includes("reference")?function(){let t=e.type.slice(10);i.type="combo",i.css=e.id+"_container",i.options=k(t),i.template=function(t,e,n,i){let o=i.collection.getItem(t.value);return o?o.value:""}}():e.type.includes("boolean")?(i.type="select",i.options=[{id:1,value:"Да"},{id:2,value:"Нет"}]):e.type.includes("integer")?(o(),i.customType="integer"):o(),t.push(i)})),webix.editors.$popup={date:{view:"popup",body:{weekHeader:!0,view:"calendar",events:webix.Date.isHoliday,timepicker:!0,icons:!0}}},n=t,e.define("elements",n),e.refresh(),K()}else $$(t).clear(),$$(t).clearValidation(),"table-editForm"==t&&$$("table-delBtnId").enable()}catch(t){l(t,H,"createEditFields")}var n}function Q(){const t=$$("editTableFormProperty");try{!function(){const t=$$("table-saveBtn"),e=$$("table-saveNewBtn"),n=$$("table-delBtnId");e.isVisible()?e.hide():t.isVisible()&&t.hide(),n.disable()}(),t&&(t.clear(),t.hide()),f($$("EditEmptyTempalte")),function(){const t=$$("propertyRefbtnsContainer"),e=$$("propertyRefbtns");t&&e.removeView(t)}()}catch(t){l(t,H,"defaultStateForm")}}function X(t,e,n=!1){return{view:"datatable",id:t,css:"webix_table-style webix_header_border webix_data_border",autoConfig:!0,editable:n,editaction:"dblclick",minHeight:350,datafetch:5,datathrottle:5e3,loadahead:100,footer:!0,select:!0,resizeColumn:!0,on:e,onClick:{"wxi-trash":function(){try{$("Запись будет удалена").then((function(){let e=$$(t).getItem(id),n=u();webix.ajax().del("/init/default/api/"+n+"/"+e.id+".json",e,{success:function(){$$(t).remove($$(t).getSelectedId()),i("success","Данные успешно удалены")},error:function(t,e,n){s("012-000",n.status,n.statusText,n.responseURL)}}).catch((t=>{console.log(t),s("012-000",t.status,t.statusText,t.responseURL)}))}))}catch(t){console.log(t),a("012-000",t)}},"wxi-angle-down":function(t,e,n){try{if($$("propTableView").isVisible())$$("propTableView").hide(),$$("propResize").hide();else{let t,n=e.row;$$("table-view").getColumns().forEach((function(i,o){if(i.id==e.column){t=i.src;let e=t.search("{");t=t.slice(0,e)+n+".json"}})),webix.ajax(t,{success:function(t,e,n){try{e=e.json().content;let t=[];e.forEach((function(e,n){t.push({type:"text",id:n+1,label:e.name,value:e.value})})),$$("propTableView").define("elements",t),$$("propTableView").show(),$$("propTableView").config.width<200&&($$("propTableView").config.width=200,$$("propTableView").resize()),$$("propResize").show()}catch(t){console.log(t),a("012-000",t)}},error:function(t,e,n){s("012-000",n.status,n.statusText,n.responseURL)}}).catch((t=>{console.log(t),s("012-000",t.status,t.statusText,t.responseURL)}))}}catch(t){console.log(t),a("012-000",t)}}}}}function Z(){const t=$$("table").count().toString();$$("table-findElements").setValues(t)}function tt(t){const e=$$("table").getItem(t);!function(){try{const t=$$("editTableFormProperty"),n=$$("table-editForm"),i=$$("table-newAddBtnId");t&&!t.isVisible()&&(t.show(),window.innerWidth>850&&(n.config.width=350,n.resize())),i.isEnabled()||i.enable(),function(){const t=$$("editTableFormProperty");t.config.dirty=!1,t.refresh()}(),function(){const t=webix.Date.dateToStr("%d.%m.%y %H:%i:%s");try{Object.values(e).forEach((function(n,i){if(n instanceof Date){const o=Object.keys(e)[i],r=t(n);e[o]=r}}))}catch(t){l(t,"table","setViewDate")}}(),t.setValues(e),$$("table-saveNewBtn").hide(),$$("table-saveBtn").show(),$$("table-delBtnId").enable()}catch(t){l(t,"table","toEditForm => setPropState")}}()}function et(){j().forEach((function(t,e){let n;try{$$("table").getColumns().forEach((function(e,i){e.id==t.nameCol&&(n=e.label)}))}catch(t){l(t,"table","validateError")}i("error",t.textError+" (Поле: "+n+")")}))}function nt(t,e,n,o=!1){if(j().length)et();else if(e.id){let r;r=o?function(t){let e={};try{Object.values(t).forEach((function(n,i){const o=$$("table").getItem(t.id),r=Object.keys(o);!function(){let n=Object.keys(t)[i];r.forEach((function(r){r==n&&o[r]!==Object.values(t)[i]&&(e[Object.keys(t)[i]]=Object.values(t)[i])}))}()}))}catch(t){l(t,"table","uniqueData")}return e}(e):e;const a=$$("table"),s="/init/default/api/"+n+"/"+e.id,u=webix.ajax().put(s,r);u.then((function(n){"i"==(n=n.json()).err_type&&(i("success","Данные сохранены"),a.updateItem(e.id,e),h($$("propertyRefbtnsContainer")),o&&(tt(t),a.select(t))),"e"==n.err_type&&i("error",n.error)})),u.fail((function(t){c(t,"table","putData")}))}}const it={onBeforeLoad:function(){this.showOverlay("Загрузка...")},onBeforeEditStop:function(t,e,n){const i=$$("table"),o=i.getSelectedItem(),r=u(),a=i.getSelectedItem();try{if(t.value!=t.old){const n=e.row,s=e.column,c=t.value;i.updateItem(n,{[s]:c}),$$("editTableFormProperty").setValues(a),nt("",o,r)}}catch(t){l(t,"table","onBeforeEditStop")}},onAfterSelect(t){!function(){try{const t=$$("table-newAddBtnId"),e=$$("table-editForm");f($$("editTableBarContainer")),t&&t.enable(),d($$("EditEmptyTempalte")),e.isVisible()||(e.show(),function(){try{const t=$$("filterTableBarContainer"),e=$$("filterTableForm"),n=document.querySelector(".webix_btn-filter");d(t),d(e),n.classList.add("webix-transparent-btn"),n.classList.remove("webix-transparent-btn--primary")}catch(t){l(t,"table","onAfterSelect => filterTableHide")}}())}catch(t){l(t,"table","onAfterSelect => statePutEditForm")}}(),function(){try{const t=$$("table-editForm"),e=$$("container");e.$width<850&&(d($$("tree")),e.$width<850&&(d($$("tableContainer")),t.config.width=window.innerWidth,t.resize(),f($$("table-backTableBtn"))),f(t),d($$("EditEmptyTempalte")))}catch(t){l(t,"table","onAfterSelect => adaptiveEditForm")}}()},onBeforeSelect:function(t,e){const n=$$("table"),o=$$("editTableFormProperty"),r=o.getValues(),a=u(),s=t.id;if(function(){try{if(o.config.dirty)return m().then((function(e){const o=$$("table-saveBtn");1==e?(tt(s),n.select(t.id),h($$("propertyRefbtnsContainer"))):2==e&&(o.isVisible()?nt(s,r,a,!0):function(t,e,o){if(j().length)et();else{const r="/init/default/api/"+e,a=webix.ajax().post(r,o);a.then((function(e){if(null!==(e=e.json()).content.id)o.id=e.content.id,n.add(o),tt(t),h($$("propertyRefbtnsContainer")),n.select(t),i("success","Данные успешно добавлены");else{const t=e.content.errors;let n="";Object.values(t).forEach((function(e,i){n+=e+" (Поле: "+Object.keys(t)[i]+"); "})),i("error",n)}})),a.fail((function(t){c(t,"table","onBeforeSelect => postNewData")}))}}(s,a,r))})),!1;G("table-editForm"),tt(s)}catch(t){l(t,"table","onBeforeSelect => modalBoxTable")}}(),o.config.dirty)return!1},onAfterLoad:function(){try{this.hideOverlay(),Q()}catch(t){l(t,"table","onAfterLoad")}},onAfterDelete:function(){Z(),function(){const t=$$("table").isVisible()?"table":$$("table-view").isVisible()?"table-view":void 0,e=$$(t);e.count()||e.showOverlay("Ничего не найдено"),e.count()&&e.hideOverlay()}()},onAfterAdd:function(){Z(),this.hideOverlay()}};function ot(t,e){return{view:"text",width:300,labelPosition:"top",type:"password",name:e,label:t}}const rt={view:"button",height:48,width:300,value:"Сменить пароль",css:"webix_primary",click:function(){try{const t=$$("cp-form");if(t&&t.validate()){let e={op:"",np:""},n=t.getValues();e.np=n.newPass,e.op=n.oldPass;const o=webix.ajax().post("/init/default/api/cp",e);o.then((function(e){"i"==(e=e.json()).err_type?i("success",e.err):i("error","authSettings function doAuthCp: "+e.err,"cp"),t.setDirty(!1)})),o.fail((function(t){c(t,"authSettings","doAuthCp post")}))}}catch(t){l(t,"authSettings","doAuthCp")}}},at={id:"layout-cp",cols:[{view:"form",id:"cp-form",borderless:!0,margin:5,elements:[{template:"<div>Изменение пароля</div>",css:"webix_cp-form",height:35,borderless:!0},{view:"template",id:"authName",css:"webix_userprefs-info",height:50,borderless:!0,template:function(){return 0!==Object.keys($$("authName").getValues()).length?"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600'>"+$$("authName").getValues()+"<div>":"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600'>не указано</div>"}},ot("Старый пароль","oldPass"),ot("Новый пароль","newPass"),ot("Повтор нового пароля","repeatPass"),{margin:5,cols:[rt]}],rules:{$all:webix.rules.isNotEmpty,$obj:function(t){return t.newPass!=t.repeatPass?(i("error","Новый пароль не совпадает с повтором"),!1):t.newPass!=t.oldPass||!$$("cp-form").isDirty()||(i("error","Новый пароль должен отличаться от старого"),!1)}}},{}]};let st={userprefsOther:{},userprefsWorkspace:{}};function ct(){const e=$$("userprefsTabbar").getValue(),n=$$(e+"Form");n.isDirty()?function(){const e=webix.ajax().get("/init/default/api/userprefs/");e.then((function(e){"e"==(e=e.json().content).err_type&&i("error",e.error);let o=!1;const r=n.getValues(),a={name:n,prefs:r};if(function(){try{e.forEach((function(e,s){e.name==n&&(o=!0,function(e){const o="/init/default/api/userprefs/"+e.id,s=webix.ajax().put(o,a);s.then((function(e){"i"==(e=e.json()).err_type&&(t(n,JSON.stringify(n.getValues())),i("success","Настройки сохранены")),"e"==e.err_type&&i("error",e.error);const o=$$("userprefsTabbar").getValue();st[o]=r,n.setDirty(!1)})),s.fail((function(t){c(t,"userprefs","putPrefs")}))}(e))}))}catch(t){l(t,"userprefs","findExistsData")}}(),!o){const e=webix.storage.local.get("user").id;e?a.owner=e:function(){const e=webix.ajax("/init/default/api/whoami");e.then((function(e){e=e.json().content,a.owner=e.id;const n={};n.id=e.id,n.name=e.first_name,n.username=e.username,t("user",JSON.stringify(n))})),e.fail((function(t){c(t,"userprefs","getOwnerData")}))}(),function(){const t=webix.ajax().post("/init/default/api/userprefs/",a);t.then((function(t){"i"==(t=t.json()).err_type?i("success","Настройки сохранены"):"e"==t.err_type&&i("error",t.error);const e=$$("userprefsTabbar").getValue();st[e]=r,n.setDirty(!1)})),t.fail((function(t){c(t,"userprefs","postPrefs")}))}()}})),e.fail((function(t){c(t,"userprefs","getUserprefsData")}))}():i("debug","Сохранять нечего")}const lt={view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsOther",scroll:"y",body:{view:"form",id:"userprefsOtherForm",borderless:!0,elements:[{view:"radio",labelPosition:"top",label:"Автообновление специфичных страниц",value:1,name:"autorefOpt",options:[{id:1,value:"Включено"},{id:2,value:"Выключено"}],on:{onChange:function(t,e,n){try{const e=$$("userprefsAutorefCounter");1!=t||e.isVisible()||e.show(),2==t&&e.isVisible()&&e.hide()}catch(t){l(t,"userprefs","autorefRadio => onChange")}}}},{height:5},{view:"counter",id:"userprefsAutorefCounter",labelPosition:"top",name:"autorefCounterOpt",label:"Интервал автообновления (в миллисекундах)",min:15e3,max:9e5,on:{onChange:function(t,e,n){function i(t){return webix.message({type:"debug",expire:1e3,text:t})}try{const e=$$("userprefsAutorefCounter"),n=e.config.min,o=e.config.max;t==n?i("Минимально возможное значение"):t==o&&i("Максимально возможное значение")}catch(t){l(t,"userprefs","autorefCounter => onChange")}}}},{height:5},{view:"radio",labelPosition:"top",label:"ID в таблицах",value:1,name:"visibleIdOpt",options:[{id:1,value:"Показывать"},{id:2,value:"Не показывать"}]},{}],on:{onChange:function(){const t=$$("userprefsSaveBtn"),e=$$("userprefsResetBtn"),n=$$("userprefsOtherForm");!function(){try{n.isDirty()&&!t.isEnabled()?t.enable():n.isDirty()||t.disable()}catch(t){l(t,"userprefs","otherForm => onChange setSaveBtnState")}}(),function(){try{n.isDirty()&&!e.isEnabled()?e.enable():n.isDirty()||e.disable()}catch(t){l(t,"userprefs","otherForm => onChange setResetBtnState")}}()}}}},ut={view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsWorkspace",scroll:"y",body:{view:"form",id:"userprefsWorkspaceForm",borderless:!0,elements:[{cols:[{rows:[{view:"radio",labelPosition:"top",name:"logBlockOpt",label:"Отображение блока системных сообщений",value:1,options:[{id:1,value:"Показать"},{id:2,value:"Скрыть"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть по умолчанию блок системных сообщений")},onChange:function(t,e){try{const n=$$("webix_log-btn");t!==e&&(1==t?n.setValue(2):n.setValue(1))}catch(t){l(t,"userprefs","logBlockRadio => onChange")}}}},{height:15},{cols:[{view:"select",name:"LoginActionOpt",label:"Действие после входа в систему",labelPosition:"top",value:2,options:[{id:1,value:"Перейти на главную страницу"},{id:2,value:"Перейти на последнюю открытую страницу"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показывать/не показывать всплывающее окно при загрузке приложения")}}},{}]}]}]}],on:{onChange:function(){const t=$$("userprefsWorkspaceForm"),e=$$("userprefsSaveBtn"),n=$$("userprefsResetBtn");!function(){try{t.isDirty()&&!e.isEnabled()?e.enable():t.isDirty()||e.disable()}catch(t){l(t,"userprefs","workspaceForm => setSaveBtnState")}}(),function(){try{t.isDirty()&&!n.isEnabled()?n.enable():t.isDirty()||n.disable()}catch(t){l(t,"userprefs","workspaceForm => setResetBtnState")}}()}}}},dt={id:"a1",rows:[{responsive:"a1",cols:[{view:"button",height:48,minWidth:200,value:"Сбросить",id:"userprefsResetBtn",disabled:!0},{view:"button",value:"Сохранить настройки",height:48,minWidth:200,id:"userprefsSaveBtn",css:"webix_primary",disabled:!0,click:ct}]}]};function ft(t){return`<span class='webix_tabbar-filter-headline'>${t}</span>`}const ht={view:"tabbar",type:"top",id:"userprefsTabbar",css:"webix_filter-popup-tabbar",multiview:!0,height:50,options:[{value:ft("Рабочее пространство"),id:"userprefsWorkspace"},{value:ft("Другое"),id:"userprefsOther"}],on:{onBeforeTabClick:function(t){const e=$$("userprefsTabbar").getValue()+"Form",n=$$(e);function i(t){try{t.isEnabled()&&t.disable()}catch(t){l(t,"userprefs","tabbar => onBeforeTabClick")}}if(n.isDirty())return function(){try{webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"}).then((function(o){if(1==o){const o=webix.storage.local.get(e),r=$$("userprefsSaveBtn"),a=$$("userprefsResetBtn"),s=$$("userprefsTabbar");n.setValues(o),s.setValue(t),i(r),i(a)}else 2==o&&(ct(),ht.setValue(t))}))}catch(t){l(t,"userprefs","tabbar => createModalBox")}}(),!1}}},pt={rows:[{padding:{top:15,bottom:0,left:20,right:0},rows:[{view:"template",template:"<div>Настройки</div>",css:"webix_headline-userprefs",height:35,borderless:!0},{view:"template",id:"userprefsName",css:"webix_userprefs-info",height:50,borderless:!0,template:function(){const t=$$("userprefsName").getValues();return`\n            <div style = '\n                display:inline-block;\n                color:var(--primary);\n                font-size:13px!important;\n                font-weight:600\n            '>Имя пользователя:</div>\n\n            <div style = '\n                display:inline-block;\n                font-size:13px!important;\n                font-weight:600\n            '>${0!==Object.keys(t).length?t:"не указано"}</div>`}}]},{rows:[ht,{cells:[ut,lt]},dt]}]};webix.UIManager.addHotKey("Ctrl+Shift+E",(function(){Backbone.history.navigate("experimental/treeEdit",{trigger:!0})}));const bt="tableFilter => toolbar";function $t(t,e,n,i){let o;return i.editor&&"combo"==i.editor&&(o=i.type.slice(10)),function(){const r=function(){let t;if(i.id.includes("_filter")){let e=i.id.indexOf("_filter");t=i.id.slice(0,e)}else t=i.id;return t}(),a=$$(r+"_filter_rows");e=a.getChildViews().length;const s=r+"_filter-child-"+t+"-"+e,c={id:s,name:s,on:{onKeyPress:function(){const t=$$("btnFilterSubmit");$$("filterTableForm").clearValidation(),t&&!t.isEnabled()&&t.enable()}}};function l(t){const e=c;return e.view="text","text"==t?e.placeholder="Введите текст":"int"==t&&(e.placeholder="Введите число",e.invalidMessage="Поле поддерживает только числовой формат",e.validate=function(t){return!isNaN(1*t)}),e}function u(t){const e=c;return e.view="combo",e.placeholder="Выберите вариант","default"==t?e.options={data:k(o)}:"bool"==t&&(e.options=[{id:1,value:"Да"},{id:2,value:"Нет"}]),e}return"text"==n?l("text"):"combo"==n?u("default"):"boolean"==n?u("bool"):"date"==n?function(){const t=c;return t.view="datepicker",t.placeholder="дд.мм.гг",t.format="%d.%m.%Y %H:%i:%s",t.timepicker=!0,t}():"integer"==n?l("int"):void 0}()}function mt(t,e){try{let n=$$(t);e.includes("eql")?n.setValue("="):e.includes("notEqual")?n.setValue("!="):e.includes("less")?n.setValue("<"):e.includes("more")?n.setValue(">"):e.includes("mrEqual")?n.setValue(">="):e.includes("lsEqual")?n.setValue("<="):e.includes("contains")&&n.setValue("⊆")}catch(t){l(t,bt,"filterOperationsBtnLogic")}}function gt(t){return webix.once((function(){"combo"==t||"boolean"==t?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"})):"text"==t?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"содержит",id:"operations_contains"})):"date"==t?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"<",id:"operations_less"}),this.add({value:">",id:"operations_more"}),this.add({value:">=",id:"operations_mrEqual"}),this.add({value:"<=",id:"operations_lsEqual"})):"integer"==t&&(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"<",id:"operations_less"}),this.add({value:">",id:"operations_more"}),this.add({value:">=",id:"operations_mrEqual"}),this.add({value:"<=",id:"operations_lsEqual"}),this.add({value:"содержит",id:"operations_contains"}))}))}function wt(t,e){const n=t.id+"_filter-btnFilterOperations",i={view:"button",id:n,css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){mt(n,t)},onAfterLoad:gt(e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},o={view:"button",css:"webix_filterBtns",value:"+",id:t.id+"_filter_condition",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[{value:"и",id:"add_and"},{value:"или",id:"add_or"}],on:{onMenuItemClick(e){vt(e,t)}}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить ещё вариант поля")}}};return{id:t.id+"_filter_container-btns",css:{"margin-top":"27px!important"},hidden:!0,cols:[i,o]}}function vt(t,e){const n=e.id,i=$$(n+"_filter_rows"),o=i.getChildViews().length;let r;r="boolean"!==e.type?e.editor:"boolean",t.includes("and")?function(){const t={id:"and_"+webix.uid(),template:"<div style='color:var(--primary)'>+ и</div>",height:30,borderless:!0},a=n+"_filter-child-operAnd-"+o,s=a+"-btnFilterOperations",c={view:"button",id:s,css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){mt(s,t)},onAfterLoad:gt(r)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},u=a+"_remove",d={id:n+"_filter_container-btns"+o,cols:[c,{view:"button",id:u,css:"webix_filterBtns webix_danger",type:"icon",icon:"wxi-trash",inputHeight:38,width:40,click:function(){$("Поле фильтра будет удалено").then((function(){!function(){try{const t=$$(u).getParentView().getParentView().getParentView();$$(n+"_filter_rows").removeView($$(t.config.id)),setLogValue("success","Поле удалено")}catch(t){l(t,bt,"createAndInput => popupSuccess")}}()}))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить поле фильтра")}}}]};!function(){try{i.addView({id:n+"_filter-container-child-"+o,padding:5,rows:[t,{id:webix.uid(),cols:[$t("operAnd",o,r,e),d]}]},o)}catch(t){l(t,bt,"createAndInput => addInput")}}()}():t.includes("or")&&function(){const t={id:"or_"+webix.uid(),template:"<div style='color:var(--primary)'>+ или</div>",height:30,borderless:!0},a=n+"_filter-child-operOr-"+o,s=a+"-btnFilterOperations",c={view:"button",id:s,css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){mt(s,t)},onAfterLoad:gt(r)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},u=a+"_remove",d={id:n+"_filter_container-btns"+o,cols:[c,{view:"button",css:"webix_filterBtns webix_danger",id:u,type:"icon",icon:"wxi-trash",inputHeight:38,width:40,click:function(){$("Поле фильтра будет удалено").then((function(){!function(){try{let t=$$(u).getParentView().getParentView().getParentView();i.removeView($$(t.config.id)),setLogValue("success","Поле удалено")}catch(t){l(t,bt,"createOrInput => popupSuccess")}}()}))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить поле фильтра")}}}]};i.addView({id:n+"_filter-container-child-operOr-"+o,padding:5,rows:[t,{id:webix.uid(),cols:[$t("operOr",o,r,e),d]}]},o)}()}function yt(t,e){return{view:"button",width:50,type:"icon",id:t+"-filterId",hidden:e,icon:"icon-filter",css:"webix_btn-filter webix-transparent-btn ",disabled:!0,title:"текст",height:42,click:function(){!function(t){const e=$$("filterTableForm");$$(t).clearSelection(),function(){const t=document.querySelector(".webix_btn-filter"),n="webix-transparent-btn--primary",i="webix-transparent-btn";t.classList.contains(n)?(function(){try{t.classList.add(i),t.classList.remove(n)}catch(t){l(t,bt,"filterMaxAdaptive => setSecondaryBtnState")}}(),d($$("filterTableForm")),d($$("filterTableBarContainer"))):(d($$("table-editForm")),f(e),0!==e.getChildViews()&&function(t,e=1){const n=$$(t).elements;function i(){const e=$$("table-delBtnId");try{"table-editForm"==t&&e&&e.enable()}catch(t){l(t,bt,"createFilterElements => enableDelBtn")}}0==Object.keys(n).length?function(){const n=$$("table").getColumns();let o=[];try{n.forEach(((e,n)=>{const i={id:e.id+"_filter",name:e.id+"_filter",hidden:!0,label:e.label,labelPosition:"top",on:{onItemClick:function(){$$(t).clearValidation(),$$("btnFilterSubmit").enable()}}},r=e.id+"_filter_rows",a=e.id+"_container",s=e.id+" webix_filter-inputs";function c(t,e){return{id:r,css:s,rows:[{id:a,padding:5,cols:[t,e]}]}}function l(t){const e=i;return e.view="text",e.css={"passing-bottom":"5px!important"},"text"==t?e.placeholder="Введите текст":"int"==t&&(e.placeholder="Введите число",e.invalidMessage="Поле поддерживает только числовой формат",e.validate=function(t){return!isNaN(1*t)}),e}if("datetime"==e.type)o.push(c(function(){const t=i;return t.view="datepicker",t.format="%d.%m.%Y %H:%i:%s",t.placeholder="дд.мм.гг",t.timepicker=!0,t}(),wt(e,"date")));else if(e.type.includes("reference")){let t=e.type.slice(10);o.push(c(function(t){const e=i;return e.view="combo",e.placeholder="Выберите вариант",e.options={data:k(t)},e}(t),wt(e,"combo")))}else e.type.includes("boolean")?o.push(c(function(){const t=i;return t.view="combo",t.placeholder="Выберите вариант",t.options=[{id:1,value:"Да"},{id:2,value:"Нет"}],t}(),wt(e,"combo"))):e.type.includes("integer")?o.push(c(l("int"),wt(e,"integer"))):o.push(c(l("text"),wt(e,"text")))}))}catch(t){l(t,bt,"createFilterElements => generateElements")}let r={margin:8,id:"inputsFilter",css:"webix_inputs-table-filter",rows:o};i(),function(){try{$$(t)&&$$(t).addView(r,e)}catch(t){l(t,bt,"createFilterElements => addInputs")}}()}():(function(){try{$$(t)&&($$(t).clear(),$$(t).clearValidation())}catch(t){l(t,bt,"createFilterElements => setFormState")}}(),i(),f($$("inputsFilter")))}("filterTableForm",3),function(){try{t.classList.add(n),t.classList.remove(i)}catch(t){l(t,bt,"filterMaxAdaptive => setPrimaryBtnState")}}(),f($$("filterTableBarContainer")))}(),$$("container").$width<850?(d($$("tree")),$$("container").$width<850&&(d($$("tableContainer")),d($$("tree")),f($$("table-backTableBtnFilter")),e.config.width=window.innerWidth-45,e.resize())):(d($$("table-backTableBtnFilter")),e.config.width=350,e.resize())}(t)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть фильтры")}}}}const xt="tableEditForm => toolbarBtn";function _t(t){return{view:"button",maxWidth:200,value:"<span class='webix_icon icon-pencil'></span><span style='padding-left: 5px'>Редактор таблицы</span>",id:t+"-editTableBtnId",css:"webix_btn-edit",title:"текст",height:42,click:function(){!function(){const t=$$("table-editForm"),e=$$("table-backTableBtn"),n=$$("tree"),i=$$("container");!function(){const e=$$("editTableBarContainer"),n=$$("filterTableBarContainer"),i=$$("filterTableForm");d(n),d(i),function(){const t=document.querySelector(".webix_btn-filter");try{t.classList.add("webix-transparent-btn"),t.classList.remove("webix-transparent-btn--primary")}catch(t){l(t,xt,"setSecondaryState")}}(),t&&t.isVisible()?(d(t),d(e)):t&&!t.isVisible()&&(f(t),f(e),d($$("tablePropBtnsSpace")))}(),i.$width<850?(d(n),i.$width<850&&(d($$("tableContainer")),d(n),f(e),t.config.width=window.innerWidth-45,t.resize())):(d(e),t.config.width=350,t.resize())}()},on:{onAfterRender:function(){try{"table"!==t&&this.isVisible()&&this.hide()}catch(t){l(t,xt,"btn edit onAfterRender")}this.getInputNode().setAttribute("title","Редактировать таблицу")}}}}function Et(t,e){return{view:"button",width:50,type:"icon",id:t+"-exportBtn",hidden:e,icon:"icon-arrow-circle-down",css:"webix_btn-download webix-transparent-btn",title:"текст",height:42,click:function(){!function(t){try{webix.toExcel(t,{filename:"Table",filterHTML:!0,styles:!0}),i("success","Таблица сохранена")}catch(t){l(t,"toolbarTable","exportToExcel")}}(t)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Экспорт таблицы")}}}}function kt(t,e){return{view:"template",id:t,css:"webix_style-template-count",height:30,template:function(){return 0!==Object.keys($$(t).getValues()).length?"<div style='color:#999898;'>"+e+": "+$$(t).getValues()+" </div>":""}}}function Tt(t,e=!1){const n=t+"-findElements",i=t+"-idFilterElements";return{rows:[y(t+"-templateHeadline"),{css:"webix_filterBar",padding:{bottom:4},height:40,cols:[yt(t,e),_t(t),{},Et(t,e)]},{cols:[kt(n,"Общее количество записей"),kt(i,"Видимое количество записей")]}]}}const Vt={view:"form",id:"table-editForm",hidden:!0,css:"webix_form-edit",minHeight:350,borderless:!0,scroll:!0,elements:[W,F],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}};let Ct;const St="tableFilter => popup",Bt={template:"Редактор фильтров",css:"webix_template-recover",borderless:!0,height:40},It={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("popupFilterEdit")&&$$("popupFilterEdit").destructor()}},Ft={css:"webix_empty-template",template:"Выберите нужные поля или шаблон из библиотеки",borderless:!0,height:47};function At(t){t?$$("popupFilterSubmitBtn").enable():$$("popupFilterSubmitBtn").disable()}const jt={view:"form",id:"editFormPopup",css:"webix_edit-form-popup",borderless:!0,elements:[{rows:[{view:"tabbar",type:"top",id:"filterPopupTabbar",css:"webix_filter-popup-tabbar",multiview:!0,options:[{value:"<span class='webix_tabbar-filter-headline'>Поля</span>",id:"editFormScroll"},{value:"<span class=webix_tabbar-filter-headline'>Библиотека</span>",id:"editFormPopupLib"}],height:50,on:{onAfterTabClick:function(t){!function(t){function e(t){try{"enable"==t?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():"disable"==t&&$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable()}catch(t){l(t,St,"btnSubmitState")}}function n(t){$$("popupFilterClearBtn")&&$$("popupFilterClearBtn").isVisible()&&(t?$$("popupFilterClearBtn").show():$$("popupFilterClearBtn").hide())}function i(t){$$("editFormPopupLibRemoveBtn")&&!$$("editFormPopupLibRemoveBtn").isVisible()&&(t?$$("editFormPopupLibRemoveBtn").show():$$("editFormPopupLibRemoveBtn").hide())}try{"editFormPopupLib"==t&&function(){try{n(!1),""!==$$("filterEditLib").getValue()?e("enable"):e("disable"),i(!0)}catch(t){l(t,St,"filterLibrary")}}(),"editFormScroll"==t&&function(){let t=$$("editFormPopup").getValues(),o=0;try{Object.values(t).forEach((function(t,e){t&&o++})),n(!0),i(!1),e(o>0?"enable":"disable")}catch(t){l(t,St,"editFilter")}}()}catch(t){l(t,St,"tabbarLogic")}}(t)}}},{height:200,cells:[{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"editFormScroll",scroll:"y",body:{id:"editFormPopupScroll",rows:[]}},{view:"form",scroll:!0,id:"editFormPopupLib",css:"webix_multivew-cell",borderless:!0,elements:[{view:"radio",id:"filterEditLib",vertical:!0,options:[],on:{onChange:function(){this.getValue()?(Ct=this.getValue(),$$("editFormPopupLibRemoveBtn").isEnabled()||$$("editFormPopupLibRemoveBtn").enable(),$$("popupFilterSubmitBtn").isEnabled()||At(!0)):$$("popupFilterSubmitBtn").isEnabled()&&At(!1)}}}]}]},{height:20},{cols:[{view:"button",id:"popupFilterSubmitBtn",height:48,minWidth:140,disabled:!0,css:"webix_primary",hotkey:"Enter",value:"Применить",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбранные фильтры будут добавлены в рабочее поле, остальные скрыты")}},click:function(){function t(t,e=null,n=null){let i=document.querySelectorAll(".webix_filter-inputs");if(t)try{!function(){try{i.forEach((function(t,n){t.classList.contains(e)?(t.classList.contains("webix_show-content")||t.classList.add("webix_show-content"),t.classList.contains("webix_hide-content")&&t.classList.remove("webix_hide-content")):t.classList.contains("webix_hide-content")||t.classList.add("webix_hide-content")}))}catch(t){l(t,St,"function visibleField => showHtmlEl")}}(),$$(n)&&$$(n).show(),$$(n+"_container-btns")&&!$$(n+"_container-btns").isVisible()&&$$(n+"_container-btns").show(),$$("resetFilterBtn").isEnabled()||$$("resetFilterBtn").enable(),$$("filterLibrarySaveBtn").isEnabled()||$$("filterLibrarySaveBtn").enable(),$$("filterEmptyTempalte").isVisible()&&$$("filterEmptyTempalte").hide()}catch(t){l(t,St,"function visibleField => showElements")}else try{$$(n).isVisible()&&function(){try{i.forEach((function(t,n){t.classList.contains(e)&&(t.classList.contains("webix_hide-content")||t.classList.add("webix_hide-content"),t.classList.contains("webix_show-content")&&t.classList.remove("webix_show-content"))}))}catch(t){l(t,St,"function visibleField => hideHtmlEl")}}(),function(){const t=$$(n+"-btnFilterOperations");t&&t.setValue("="),$$(n).setValue(""),$$(n).hide(),$$(n+"_container-btns")&&$$(n+"_container-btns").isVisible()&&$$(n+"_container-btns").hide()}(),$$(n+"_rows")&&function(){let t=$$(n+"_rows").getChildViews();try{Object.values(t).forEach((function(t,e){t.config.id.includes("child")&&$$(n+"_rows").removeView($$(t.config.id))}))}catch(t){l(t,St,"function visibleField => removeChids")}}()}catch(t){l(t,St,"function visibleField => hideElements")}}try{let e=$$("filterPopupTabbar").getValue();"editFormPopupLib"==e?function(){let e=$$("filterEditLib").getOption($$("filterEditLib").getValue()),n=webix.ajax("/init/default/api/userprefs/");n.then((function(n){n.json(),n=n.json().content;const o=u();function r(e){let n=[];try{e.collection.content.forEach((function(e,i){"parent"==e.condition&&(function(){let i=function(){let t=e.parentField.id.indexOf("_filter");return e.parentField.id.slice(0,t)}(),o=function(){let t=e.parentField.id.indexOf("_rows");return e.parentField.id.slice(0,t)}();t(1,i,o),n.push(o)}(),$$(e.parentValue.id)&&$$(e.parentValue.id).setValue(e.parentValue.value),function(){try{$$(e.parentField.id)&&$$(e.parentField.id)._cells.forEach((function(t,n){t.config.id.includes("child")&&$$(e.parentField.id).removeView($$(t.config.id))}))}catch(t){l(t,St,"function createWorkspace => removeLastChilds")}}()),function(e){const n=$$("inputsFilter").getChildViews();try{n.forEach((function(n,i){let o=function(t){let n;return e.forEach((function(e,i){t.includes(e)&&(n=e)})),n}(n.config.id),r=n.config.id;if(!o){let e=function(){let t=r.indexOf("_rows");return r.slice(0,t)}(),n=function(t){let e=t.indexOf("_filter");return r.slice(0,e)}(e);t(0,n,e)}}))}catch(t){l(t,St,"function hideFalseInputs")}}(n),function(){let t=$$("table").getColumns();try{t.forEach((function(t,n){e.parentField.id.includes(t.id)&&("and"==e.condition?(vt("and",t),$$(e.childValue.id).setValue(e.childValue.value)):"or"==e.condition&&(vt("or",t),$$(e.childValue.id).setValue(e.childValue.value)))}))}catch(t){l(t,St,"function createWorkspace => createChilds")}}()})),$$("filterTableForm").setValues(e.values)}catch(t){l(t,St,"function createWorkspace")}}!function(){try{n.forEach((function(t,n){t.name==o+"_filter-template_"+e.value&&r(JSON.parse(t.prefs)),$$("popupFilterEdit")&&$$("popupFilterEdit").destructor(),$$("btnFilterSubmit")&&!$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").enable()}))}catch(t){l(t,St,"function dataEnumeration")}}(),i("success","Рабочая область фильтра обновлена")})),n.fail((function(t){c(t,St,"getLibraryData")}))}():"editFormScroll"==e&&function(){try{$$("filterLibrarySaveBtn")&&!$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").enable(),function(){let e,n,i=$$("editFormPopup").getValues();try{Object.keys(i).forEach((function(o,r){n=o.lastIndexOf("_"),e=o.slice(0,n),t(i[o],e,o)}))}catch(t){l(t,St,"function createWorkspaceCheckbox")}}(),function(){let t=0;try{Object.values($$("filterTableForm").elements).forEach((function(e,n){e.config.hidden||t++}))}catch(t){l(t,St,"function getCheckboxData => visibleCounter")}return t}()||($$("filterEmptyTempalte").isVisible()||$$("filterEmptyTempalte").show(),$$("btnFilterSubmit")&&$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").disable(),$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").disable()),$$("popupFilterEdit")&&$$("popupFilterEdit").destructor()}catch(t){l(t,St,"function getCheckboxData")}i("success","Рабочая область фильтра обновлена")}()}catch(t){l(t,St,"function popupSubmitBtn"),$$("popupFilterEdit").destructor()}}},{width:5},{view:"button",id:"popupFilterClearBtn",width:110,height:48,css:"webix_secondary",disabled:!0,value:"Сбросить",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Все фильтры будут очищены и удалены")}},click:function(){$$("popupFilterEdit").destructor(),Wt()}},{view:"button",css:"webix_danger",id:"editFormPopupLibRemoveBtn",type:"icon",icon:"icon-trash",hidden:!0,disabled:!0,width:50,click:function(){const t=u();m("Шаблон будет удалён","Вы уверены, что хотите продолжить?",["Отмена","Удалить"]).then((function(e){1==e&&async function(){let e=$$("filterEditLib").getValue(),n=$$("filterEditLib").getOption(e);if(Pt.userprefs||await Ot(),Pt.userprefs){let e=Pt.userprefs.content,o=t+"_filter-template_"+n.value;e.forEach((function(t,e){t.name==o&&function(){let e=webix.ajax().del("/init/default/api/userprefs/"+t.id,t);e.then((function(t){"e"!==(t=t.json()).err_type&&"x"!==t.err_type?(i("success","Шаблон « "+n.value+" » удален"),function(){try{$$("filterEditLib").config.options.forEach((function(t,e){t.id==n.id&&(t.value=n.value+" (шаблон удалён)",$$("filterEditLib").refresh(),$$("filterEditLib").disableOption($$("filterEditLib").getValue()),$$("filterEditLib").setValue(""))}))}catch(t){l(t,St,"function deleteElement => removeOptionState")}}()):i("error",St+" function userprefsData: "+t.err)})),e.fail((function(t){c(t,St,"getLibraryData")}))}()}))}}()}))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбранный шаблон будет удален")}}}]}]},{}]},Pt={},Lt="tableFilter => buttons";function Ot(){return webix.ajax().get("/init/default/api/userprefs/").then((function(t){return Pt.userprefs=t.json(),Pt.userprefs})).fail((t=>{c(t,Lt,"getUserprefsData")}))}function Nt(){const e=u();function n(t){t?$$("popupFilterSubmitBtn").enable():$$("popupFilterSubmitBtn").disable()}webix.ui({view:"popup",id:"popupFilterEdit",css:"webix_popup-filter-container webix_popup-config",modal:!0,escHide:!0,position:"center",height:400,width:400,body:{scroll:"y",rows:[{css:"webix_filter-headline-wrapper",cols:[Bt,{width:150},It]},Ft,jt]}}).show(),function(){const n=webix.ajax("/init/default/api/userprefs/");n.then((function(n){let o=webix.storage.local.get("user");try{o||function(){let e=webix.ajax("/init/default/api/whoami");e.then((function(e){e=e.json().content;try{!function(){let n={};n.id=e.id,n.name=e.first_name,n.username=e.username,t("user",JSON.stringify(n))}(),o=webix.storage.local.get("user")}catch(t){l(t,Lt,"function getUserData")}"e"==e.err_type?i("error",e.error):i("success","Рабочая область фильтра обновлена")})),e.fail((function(t){c(t,Lt,"getUserData")}))}(),o&&(function(t){!function(){const t=$$("filterEditLib"),e=[];0!==t.config.options.length&&(t.config.options.forEach((function(t){e.push(t.id)})),e.forEach((function(e){t.removeOption(e)})))}();let i=n.json().content;try{i.forEach((function(n,i){if(n.name.includes("filter-template_")&&n.owner==t.id){let t=JSON.parse(n.prefs);t.table==e&&$$("filterEditLib").addOption({id:i+1,value:t.name})}}))}catch(t){l(t,Lt,"function setTemplates")}}(o),$$("filterEditLib")&&0==$$("filterEditLib").data.options.length&&$$("filterEditLib").addOption({id:"radioNoneContent",disabled:!0,value:"Сохранённых шаблонов нет"}),function(){try{!function(){let t=0,e=$$("filterTableForm").elements;try{Object.values(e).forEach((function(e,n){e.config.hidden||t++}))}catch(t){l(t,Lt,"function counterVisibleElements")}return t}()?$$("filterEmptyTempalte")&&!$$("filterEmptyTempalte").isVisible()&&$$("popupFilterClearBtn").isEnabled()&&$$("popupFilterClearBtn").disable():$$("popupFilterClearBtn")&&!$$("popupFilterClearBtn").isEnabled()&&$$("popupFilterClearBtn").enable()}catch(t){l(t,Lt,"function setBtnState")}}())}catch(t){l(t,Lt,"function userprefsData")}})),n.fail((function(t){console.log(t),i("error","tableFilter => buttons function userprefsData: "+t.status+" "+t.statusText+" "+t.responseURL)}))}(),$$("filterEditLib")&&$$("filterEditLib").setValue(Ct),window.innerWidth<1200&&function(){let t=window.innerWidth-500;try{$$("popupFilterEdit")&&$$("popupFilterEdit").$width>200&&($$("popupFilterEdit").config.width=t,$$("popupFilterEdit").resize())}catch(t){l(t,Lt,"function userprefsData => popupSizeAdaptive")}}();const o={view:"checkbox",id:"selectAll",labelRight:"<div style='font-weight:600'>Выбрать всё</div>",labelWidth:0,name:"selectAll",on:{onChange:function(){!function(){try{$$("selectAll").getValue()?$$("popupFilterSubmitBtn").isEnabled()||n(!0):$$("popupFilterSubmitBtn").isEnabled()&&n(!1)}catch(t){l(t,Lt,"function checkbox:onchange => setStateSubmitBtn")}}(),function(){let t=$$("editFormPopupScrollContent").getChildViews();try{t.forEach((function(t,e){t.config.id.includes("checkbox")&&($$("selectAll").getValue()?t.config.value=1:t.config.value=0,$$(t).refresh())}))}catch(t){l(t,Lt,"function checkbox:onchange => setValueCheckbox")}}()}}};let r=function(){let t=[],e=$$("filterTableForm").elements;try{Object.values(e).forEach((function(e,n){t.push({id:e.config.id,label:e.config.label})}))}catch(t){l(t,Lt,"function editFiltersBtn => getAllCheckboxes")}return t}();!function(){const t=[{cols:[{id:"editFormPopupScrollContent",css:"webix_edit-form-popup-scroll-content",rows:[o]}]}];try{r.forEach((function(e,i){if(!e.id.includes("child")){let i={view:"checkbox",id:e.id+"_checkbox",labelRight:e.label,labelWidth:0,name:e.id,on:{onChange:function(){!function(t){let e=$$(t.id+"_checkbox").getParentView().getChildViews(),i=0,o=0;try{!function(){try{e.forEach((function(t,e){t.config.id.includes("checkbox")&&(t.config.value&&""!=t.config.value||i++),t.config.value&&o++}))}catch(t){l(t,Lt,"function checkboxOnChange => getStatusCheckboxes")}}(),function(){try{o>0?$$("popupFilterSubmitBtn").isEnabled()||n(!0):$$("popupFilterSubmitBtn").isEnabled()&&n(!1)}catch(t){l(t,Lt,"function checkboxOnChange => setStateBtnSubmit")}}(),function(){try{0==i?($$("selectAll").config.value=1,$$("selectAll").refresh()):0!==$$("selectAll").config.value&&($$("selectAll").config.value=0,$$("selectAll").refresh())}catch(t){l(t,Lt,"function checkboxOnChange => setSelectAllState")}}()}catch(t){l(t,Lt,"function checkboxOnChange")}}(e)}}};$$(e.id)&&$$(e.id).isVisible()?(i.value=1,t[0].cols[0].rows.push(i)):t[0].cols[0].rows.push(i)}})),$$("editFormPopupScroll")&&$$("editFormPopupScroll").addView({rows:t},1)}catch(t){l(t,Lt,"function createCheckboxes")}}();let a=0,s=$$("editFormPopupScrollContent").getChildViews();!function(){try{s.forEach((function(t,e){t.config.id.includes("checkbox")&&(t.config.value&&""!=t.config.value||a++)}))}catch(t){l(t,Lt,"function countSelectCheckboxes")}}(),function(){try{0==a&&($$("selectAll").config.value=1,$$("selectAll").refresh())}catch(t){l(t,Lt,"function stateSelectAll")}}()}function Dt(){$$("tableFilterPopup")&&$$("tableFilterPopup").isVisible()&&$$("tableFilterPopup").hide()}function Rt(){let t=$$("filterTableForm").getValues(),e=[];function n(t,n,i,o,r,a=!1){const s=u();let c=$$(i+"-btnFilterOperations").config.value;function d(e){return"+and+"+s+"."+n+e+t}function f(e){return s+"."+n+e+t}function h(e){return"+"+o+"+"+n+e+t}try{"parent"==r?a?"="==c?e.push(d("+=+")):"!="==c?e.push(d("+!=+")):"<"==c?e.push(d("+<+")):">"==c?e.push(d("+>+")):"<="==c?e.push(d("+<=+")):">="==c?e.push(d("+>=+")):"⊆"==c&&e.push(d("+contains+")):"="==c?e.push(f("+=+")):"!="==c?e.push(f("+!=+")):"<"==c?e.push(f("+<+")):">"==c?e.push(f("+>+")):"<="==c?e.push(f("+<=+")):">="==c?e.push(f("+>=+")):"⊆"==c&&e.push(f("+contains+")):"child"==r&&("="==c?e.push(h("+=+")):"!="==c?e.push(h("+!=+")):"<"==c?e.push(h("+<+")):">"==c?e.push(h("+>+")):">="==c?e.push(h("+>=+")):"<="==c?e.push(h("+<=+")):"⊆"==c&&e.push(h("+contains+")))}catch(t){l(t,Lt,"function filterSubmitBtn => getOperationVal")}}if($$("filterTableForm").validate()){!function(){let e,i,o=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s"),r=0;Object.keys(t).sort().forEach((function(a,s){if(e=a,i=t[a],i&&$$(a))try{"datepicker"==$$(a).config.view&&(i=o(i)),$$(a).config.text&&"Нет"==$$(a).config.text&&(i=0),a.includes("filter")&&!a.includes("condition")&&(e=a.lastIndexOf("_"),e=a.slice(0,e)),function(){try{a.includes("condition")||a.includes("child")||""===t[a]||"selectAll"===a||!$$(a).isVisible()?a.includes("child")&&(a.includes("operAnd")?n(i,e,a,"and","child"):a.includes("operOr")&&n(i,e,a,"or","child")):(r>0?n(i,e,a,"and","parent",!0):n(i,e,a,"and","parent"),r++)}catch(t){l(t,Lt,"function createQuery")}}()}catch(t){l(t,Lt,"function createGetData")}}))}();const o=webix.ajax("/init/default/api/smarts?query="+e.join(""));o.then((function(t){let e=t.json().err_type,n=t.json().err;t=t.json().content,"i"==e?(function(){try{0!==t.length?($$("table").hideOverlay("Ничего не найдено"),$$("table").clearAll(),$$("table").parse(t)):($$("table").clearAll(),$$("table").showOverlay("Ничего не найдено"))}catch(t){l(t,Lt,"function filterSubmitBtn => setData")}}(),function(){const t=$$("table").count().toString();try{$$("table-idFilterElements").setValues(t)}catch(t){l(t,Lt,"function filterSubmitBtn => setCounterValue")}}(),Dt(),i("success","Фильтры успшено применены")):i("error",n)})),o.fail((function(t){c(t,Lt,"createGetData")}))}else i("error","Не все поля формы заполнены")}function zt(){try{webix.prompt({title:"Название шаблона",ok:"Сохранить",cancel:"Отменить",css:"webix_prompt-filter-lib",input:{required:!0,placeholder:"Введите название шаблона..."},width:350}).then((function(e){!async function(){Pt.userprefs||await Ot();let n=Pt.userprefs.content,o=e,r={content:[]},a=!1;const s=u(),d=$$("inputsFilter")._collection;let f={name:o,collection:r,values:$$("filterTableForm").getValues(),table:s},h={name:s+"_filter-template_"+o,prefs:f};Pt.userprefs&&(d.forEach((function(t,e){let n=t.id.lastIndexOf("_rows"),i=t.id.slice(0,n);$$(i).isVisible()&&function(t,e){try{$$(t.id).getChildViews().forEach((function(n,i){let o=$$(n.config.id)._collection[0].id,a=t.id.lastIndexOf("_rows"),s=t.id.slice(0,a);n.config.id.includes("child")?function(){let t=$$(n.config.id).getChildViews()[1]._collection[0].id,e={parentField:$$(s).config,childValue:{id:t+"-btnFilterOperations",value:$$(t+"-btnFilterOperations").getValue()}};o.includes("and")?(e.condition="and",r.content.push(e)):o.includes("or")&&(e.condition="or",r.content.push(e))}():r.content.push({condition:"parent",parentField:$$(t.id).config,parentValue:{id:e+"-btnFilterOperations",value:$$(e+"-btnFilterOperations").getValue()}})}))}catch(t){l(t,Lt,"function filterLibraryBtn => childs:")}}(t,i)})),function(t){n.forEach((function(e,n){let r=s+"_filter-template_"+o;e.name==r&&(a=!0,m("Шаблон с таким именем существует","После сохранения предыдущие данные будут стёрты",["Отмена","Сохранить изменения"]).then((function(n){1==n&&function(){const n=webix.ajax().put("/init/default/api/userprefs/"+e.id,t);n.then((function(t){"i"==(t=t.json()).err_type?i("success","Шаблон «"+o+"»  сохранён в библиотеку"):i("error","tableFilter => buttons function modalBoxExists: "+t.err)})),n.fail((function(t){c(t,Lt,"saveExistsTemplate => putUserprefsData")}))}()})))}))}(h),a||function(){let e=webix.storage.local.get("user").id;e?h.owner=e:function(){const e=webix.ajax("/init/default/api/whoami");e.then((function(e){h.owner=e.json().content.id;let n={};n.id=e.json().content.id,n.name=e.json().content.first_name,n.username=e.json().content.username,t("user",JSON.stringify(n))})),e.fail((function(t){c(t,Lt,"saveTemplate => setDataStorage")}))}();const n=webix.ajax().post("/init/default/api/userprefs/",h);n.then((function(t){"i"==(t=t.json()).err_type?i("success","Шаблон «"+o+"»  сохранён в библиотеку"):i("error",t.error)})),n.fail((function(t){c(t,Lt,"saveTemplate => saveNewTemplate")}))}())}()}))}catch(t){l(t,Lt,"function filterSubmitBtn")}}function Wt(){try{const t=u(),e=webix.ajax("/init/default/api/smarts?query="+t+".id >= 0");e.then((function(t){let e=t.json();if(t=t.json().content,"i"==e.err_type){try{!function(){try{0!==t.length?($$("table").hideOverlay("Ничего не найдено"),$$("table").clearAll(),$$("table").parse(t)):($$("table").clearAll(),$$("table").showOverlay("Ничего не найдено"))}catch(t){l(t,Lt,"function resetFilterBtn => setDataTable")}}(),function(){try{let t=$$("table").count().toString();$$("table-idFilterElements").setValues(t)}catch(t){l(t,Lt,"function setFilterCounterVal")}}(),Dt(),$$("filterTableForm")&&$$("filterTableForm").clear(),function(){let t=document.querySelectorAll(".webix_filter-inputs");try{t.forEach((function(t,e){t.classList.contains("webix_hide-content")||t.classList.add("webix_hide-content")}))}catch(t){l(t,Lt,"function resetFilterBtn => hideInputsContainer")}}(),function(){let t=[];$$("inputsFilter").getChildViews().forEach((function(e,n){let i=e._collection[0].cols[0].id;try{$$(i).hide(),function(){try{$$(e.config.id).getChildViews().forEach((function(e,n){e.config.id.includes("child")&&t.push(e.config.id)}))}catch(t){l(t,Lt,"function resetFilterBtn => getChildsId")}}(),$$(i+"_container-btns")&&$$(i+"_container-btns").isVisible()&&$$(i+"_container-btns").hide()}catch(t){l(t,Lt,"function resetFilterBtn => clearSpace")}})),function(){try{t.forEach((function(t,e){$$(t).getParentView().removeView($$(t))}))}catch(t){l(t,Lt,"function resetFilterBtn => removeChilds")}}()}(),$$("filterLibrarySaveBtn")&&$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").disable(),$$("filterEmptyTempalte")&&!$$("filterEmptyTempalte").isVisible()&&($$("filterEmptyTempalte").show(),$$("filterEmptyTempalte").refresh()),$$("resetFilterBtn").disable()}catch(t){l(t,Lt,"function resetFilterBtn")}i("success","Фильтры очищены")}else i("error","tableFilter => buttons function resetFilterBtn ajax: "+e.err)})),e.fail((function(t){c(t,Lt,"resetFilterBtn")}))}catch(t){l(t,"Ошибка при очищении фильтров; tableFilter => buttons","function resetFilterBtn")}}function Ht(t){return"formResetBtn"==t?{view:"button",id:"resetFilterBtn",disabled:!0,height:48,minWidth:50,width:65,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"icon-trash",click:Wt,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Сбросить фильтры")}}}:"formBtnSubmit"==t?{view:"button",id:"btnFilterSubmit",height:48,minWidth:70,css:"webix_primary",hotkey:"Enter",disabled:!0,value:"Применить фильтры",click:Rt}:"formEditBtn"==t?{view:"button",value:"Редактор фильтров",height:48,minWidth:140,click:Nt,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить/удалить фильтры")}}}:"filterBackTableBtn"==t?{view:"button",id:"table-backTableBtnFilter",type:"icon",icon:"icon-arrow-left",value:"Вернуться к таблице",hidden:!0,height:48,minWidth:50,width:55,click:function(){!function(){const t=$$("filterTableForm"),e=$$("tableContainer");t&&t.isVisible()&&t.hide(),e&&!e.isVisible()&&e.show(),$$("table")&&$$("table").clearSelection(),function(){const t=document.querySelector(".webix_btn-filter"),e="webix-transparent-btn--primary";t.classList.contains(e)&&(t.classList.add("webix-transparent-btn"),t.classList.remove(e))}()}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Вернуться к таблице")}}}:"formLibrarySaveBtn"==t?{view:"button",id:"filterLibrarySaveBtn",disabled:!0,height:48,minWidth:50,width:65,hotkey:"shift+esc",type:"icon",icon:"icon-file",click:zt,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Сохранить шаблон с полями в библиотеку")}}}:void 0}const Mt={view:"form",hidden:!0,id:"filterTableForm",minHeight:350,minWidth:210,width:320,scroll:!0,borderless:!0,elements:[{id:"form-adaptive",minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{margin:5,rows:[{responsive:"form-adaptive",margin:5,cols:[Ht("filterBackTableBtn"),Ht("formEditBtn"),Ht("formResetBtn")]}]},{id:"btns-adaptive",css:{"margin-top":"5px!important"},rows:[{responsive:"btns-adaptive",margin:5,cols:[Ht("formBtnSubmit"),Ht("formLibrarySaveBtn")]},{height:10},{id:"filterEmptyTempalte",css:"webix_empty-template",template:"Добавьте фильтры из редактора",borderless:!0}]}]}],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}},Ut={id:"viewTools",padding:10,rows:[{cols:[{template:"Действия",height:30,css:"popup_headline",borderless:!0},{},{view:"button",id:"table-backFormsBtnFilter",type:"icon",icon:"icon-arrow-right",value:"Вернуться к таблице",height:28,minWidth:50,width:55,click:function(){!function(){const t=$$("formsTools"),e=$$("formsContainer"),n=$$("formsTools-resizer");t&&t.isVisible()&&(t.hide(),n.hide()),e&&!e.isVisible()&&e.show(),function(){const t=document.querySelector(".webix_btn-filter"),e="webix-transparent-btn--primary";t.classList.contains(e)&&(t.classList.add("webix-transparent-btn"),t.classList.remove(e))}()}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Вернуться к таблице")}}}]},{id:"viewToolsContainer",rows:[{}]}]},qt="router => common";function Jt(t){t||(function(){try{$$("dashboards")||$$("container").addView({view:"layout",id:"dashboards",hidden:!0,scroll:"auto",rows:[{view:"scrollview",id:"dashScroll",body:{view:"flexlayout",id:"dashboardContainer",cols:[{id:"dashboardInfoContainer",minWidth:250,rows:[]},{view:"resizer"},b]}}]},3)}catch(t){l(t,qt,"createDashboards")}}(),function(){try{$$("tables")||$$("container").addView({id:"tables",hidden:!0,view:"scrollview",body:{view:"flexlayout",cols:[{id:"tableContainer",rows:[Tt("table"),{view:"resizer",class:"webix_resizers"},X("table",it,!0)]},{view:"resizer",class:"webix_resizers"},{id:"editTableBarContainer",rows:[Vt]},{id:"filterTableBarContainer",hidden:!0,rows:[{id:"editFilterBarAdaptive",rows:[Mt]}]}]}},5)}catch(t){l(t,qt,"createTables")}}(),function(){try{$$("forms")||$$("container").addView({view:"layout",id:"forms",css:"webix_tableView",hidden:!0,rows:[{cols:[{id:"formsContainer",rows:[Tt("table-view",!0),{view:"resizer",class:"webix_resizers"},{view:"scrollview",body:{view:"flexlayout",cols:[X("table-view"),{view:"resizer",class:"webix_resizers",id:"propResize",hidden:!0}]}}]},{view:"resizer",id:"formsTools-resizer",hidden:!0,class:"webix_resizers"},{id:"formsTools",hidden:!0,rows:[Ut,("propTableView",{view:"property",id:"propTableView",tooltip:"Имя: #label#<br> Значение: #value#",width:350,nameWidth:150,editable:!0,scroll:!0,hidden:!0})]}]}]},6)}catch(t){l(t,qt,"createForms")}}()),function(){try{"treeTempl"==t&&($$("treeTempl")||($$("container").addView({view:"layout",id:"treeTempl",hidden:!0,scroll:"auto",rows:[{id:"treeEditContainer",cols:[{rows:[{view:"edittree",id:"treeEdit",editable:!0,editor:"text",editValue:"value",css:"webix_tree-edit",editaction:"dblclick",data:[],on:{onAfterEditStop:function(t,e,n){try{let n="/init/default/api/trees/";if(t.value!=t.old){let o=$$("treeEdit").getParentId(e.id),r={name:t.value,pid:o,id:e.id,owner:null,descr:"",ttype:1,value:"",cdt:null};const a=webix.ajax().put(n+e.id,r);a.then((function(t){"i"==(t=t.json()).err_type?i("success","Данные изменены"):l(t.err,"editTree","tree onAfterEditStop postData msg")})),a.fail((function(t){c(t,"editTree","tree onAfterEditStop postData")}))}}catch(t){c(t,"editTree","tree onAfterEditStop")}}}}]},{}]}]},4),webix.ui({view:"contextmenu",id:"contextMenuEditTree",data:["Добавить","Переименовать",{$template:"Separator"},"Свернуть всё","Развернуть всё",{$template:"Separator"},"Удалить"],master:$$("treeEdit"),on:{onMenuItemClick:function(t){let e=this.getContext(),n=$$("treeEdit"),o=n.getItem(e.id),r="/init/default/api/trees/",a={name:"",pid:"",owner:null,descr:"",ttype:1,value:"",cdt:null};switch(this.getMenu(t).getItem(t).value){case"Добавить":{let t=prompt("Имя нового подэлемента '"+o.value+"'","");if(null!=t){a.name=t,a.pid=o.id;const e=webix.ajax().post(r,a);e.then((function(e){try{if("i"==(e=e.json()).err_type){let r=e.content.id;n.data.add({id:r,value:t,pid:o.id},0,o.id),n.open(o.id),i("success","Данные сохранены")}else l(e.err,"editTree","case add post msg")}catch(t){l(t,"editTree","case add")}})),e.fail((function(t){c(t,"editTree","case add")}))}break}case"Переименовать":var s=prompt("Новое имя",o.value);if(null!=s){a.name=s,a.id=o.id,a.pid=o.pid;const t=webix.ajax().put(r+o.id,a);t.then((function(t){try{"i"==(t=t.json()).err_type?(o.value=s,n.updateItem(o.id,o),i("success","Данные изменены")):l(t.err,"editTree","case rename put msg")}catch(t){l(t,"editTree","case rename")}})),t.fail((function(t){c(t,"editTree","case rename")}))}break;case"Удалить":{const t=webix.ajax().del(r+o.id,o);t.then((function(t){try{"i"==(t=t.json()).err_type?(n.remove(o.id),i("success","Данные удалены")):l(t.err,"editTree","case delete del msg")}catch(t){l(t,"editTree","case delete")}})),t.fail((function(t){c(t,"editTree","case delete")}));break}case"Развернуть всё":try{n.open(o.id),n.data.eachSubItem(o.id,(function(t){n.open(t.id)}))}catch(t){l(t,"editTree","case open all")}break;case"Свернуть всё":try{n.close(o.id),n.data.eachSubItem(o.id,(function(t){n.close(t.id)}))}catch(t){l(t,"editTree","case close all")}}}}})))}catch(t){l(t,qt,"createTreeTempl")}}(),function(){try{"cp"==t&&$$("container").addView({view:"layout",id:"user_auth",css:"webix_auth",hidden:!0,rows:[at,{}]},7)}catch(t){l(t,qt,"createCp")}}(),function(){try{"userprefs"==t&&$$("container").addView({view:"layout",id:"userprefs",css:"webix_auth",hidden:!0,rows:[pt]},8)}catch(t){l(t,qt,"createUserprefs")}}()}function Yt(){async function i(){e.mmenu||await n("mmenu"),function(){let t,n=[],i=[];const o=[],r=$$("tree"),a=$$("button-context-menu");try{t=e.mmenu.mmenu,t.forEach((function(t,e){3!==t.mtype?(n.push(function(t){let e;try{e={id:t.name,value:t.title,action:t.action},t.title||(e.value="Без названия"),2==t.mtype&&(0==t.childs.length?e.webix_kids=!0:e.data=function(t){let e=[];try{t.childs.forEach((function(t,n){e.push({id:t.name,value:t.title,action:t.action})}))}catch(t){l(t,qt,"generateChildsTree")}return e}(t))}catch(t){l(t,qt,"generateParentTree")}return e}(t)),0!==t.childs.length&&(i=function(t){let e=[];try{e.push({id:"favs",value:"Избранное",icon:"icon-star"}),e.push({id:"userprefs",value:"Настройки",icon:"icon-cog"}),e.push({id:"cp",value:"Смена пароля",icon:"icon-lock"}),e.push({id:"logout",value:"Выйти",css:"webix_logout",icon:"icon-sign-out"})}catch(t){l(t,qt,"generateHeaderMenu")}return e}())):(o.push(t.name),n.push({id:t.name,disabled:!0,value:"1"}))})),r.clearAll(),r.parse(n),void 0!==a.config.popup.data&&(a.config.popup.data=i,a.enable()),o.forEach((function(t){r.addCss(t,"tree_delim-items")}))}catch(t){l(t,qt,"generateMenuTree")}}()}!async function(){e.whoami||await n("whoami"),e.whoami&&(function(){try{$$("userAuth").hide(),$$("mainLayout").show()}catch(t){window.alert("showMainContent: "+t+" (Подробности: ошибка в отрисовке контента)"),l(t,qt,"showMainContent")}}(),function(){let n={};n.id=e.whoami.content.id,n.name=e.whoami.content.first_name,n.username=e.whoami.content.username,t("user",JSON.stringify(n))}(),Jt(),i())}()}function Kt(){try{0==$$("tree").data.order.length&&Yt()}catch(t){l(t,qt,"checkTreeOrder")}}function Gt(){try{$$("tree")&&$$("tree").closeAll()}catch(t){l(t,qt,"closeTree")}}function Qt(){try{$$("container").getChildViews().forEach((function(t,e){if("scrollview"==t.config.view||"layout"==t.config.view){const e=$$(t.config.id);e.isVisible()&&e.hide()}}))}catch(t){l(t,qt,"hideAllElements")}}const Xt="router => tree";function Zt(t){function i(){let n,i=!1;function o(t){try{const e=$$(t);e&&e.show()}catch(e){l(e,Xt,"showTableData (element: "+t+")")}}n=e.fields.content,function(){try{Object.values(n).forEach((function(e,r){Object.keys(n)[r]==t&&(i=!0,"dbtable"!=e.type&&"tform"!=e.type&&"dashboard"!=e.type||(d($$("webix__none-content")),"dbtable"==e.type?(o("tables"),T("table",t)):"tform"==e.type?(o("forms"),T("table-view",t)):"dashboard"==e.type&&(o("dashboards"),V(t))))}))}catch(t){l(t,Xt,"createElem")}}(),i||function(){try{setTimeout((function(){!function(){const t={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){try{const t=$$("popupNotFound");t&&t.hide()}catch(t){l(t,Xt,"btnClosePopup click")}}},e={view:"button",css:"webix_btn-not-found-back",height:46,value:"Вернуться на главную",click:function(){!function(){try{$$("popupNotFound")&&$$("popupNotFound").destructor()}catch(t){l(t,Xt,"mainBtnPopup click destructPopup")}}(),function(){try{Backbone.history.navigate("content",{trigger:!0}),window.location.reload()}catch(t){l(t,Xt,"mainBtnPopup click navigate")}}()}};webix.ui({view:"popup",id:"popupNotFound",css:"webix_popup-prev-href",width:340,height:125,position:"center",body:{rows:[{rows:[{cols:[{template:"Что-то пошло не так...",width:250,css:"popup-headline",borderless:!0,height:20},{},t]},{template:"Страница не найдена",css:"webix_template-not-found-descr",borderless:!0,height:35},e,{height:20}]}]}}).show()}()}),1500)}catch(t){l(t,Xt,"showNotFoundPopup")}}()}function o(){if($$("table-templateHeadline")){const n=$$("table-templateHeadline");try{e.tableNames.forEach((function(e,i){e.id==t&&n&&n.setValues(e.name)}))}catch(t){l(t,Xt,"setTableName")}}if($$("table-view-templateHeadline")){const n=$$("table-view-templateHeadline");try{e.tableNames.forEach((function(e,i){e.id==t&&n&&n.setValues(e.name)}))}catch(t){l(t,Xt,"setTableName element table-view-templateHeadline")}}}!function(){try{0==$$("tree").data.order.length&&async function(){await Yt();try{const r=$$("tree");r.attachEvent("onAfterLoad",(function(){r.getItem(t)?function(){const e=r.getParentId(t);r.open(e),r.select(t)}():e.fields?e.fields&&(i(),o()):async function(){e.fields||await n("fields"),e.fields&&(i(),o())}()}))}catch(t){l(t,Xt,"createTable")}}()}catch(t){l(t,Xt,"checkTable")}}()}const te="router => index";const ee="router => cp";function ne(){Kt(),Qt(),$$("user_auth")||Jt("cp"),function(){try{const t=$$("user_auth");t&&t.show()}catch(t){l(t,ee,"showUserAuth")}}(),Gt(),function(){const t=webix.storage.local.get("user"),e=$$("authName");try{t&&e.setValues(t.name.toString())}catch(t){l(t,ee,"setUserValues")}}(),function(){try{const t=$$("webix__none-content");t&&t.hide()}catch(t){l(t,ee,"hideNoneContent")}}(),function(){try{const t=$$("webix__null-content");t&&t.getParentView().removeView(t)}catch(t){l(t,ee,"removeNoneContent")}}()}const ie="router => userprefs";function oe(){Qt(),Kt(),$$("userprefs")||(Jt("userprefs"),function(){const t=webix.ajax().get("/init/default/api/userprefs/");t.then((function(t){t=t.json().content,function(){try{t.forEach((function(t,e){t.name.includes("userprefs")&&0==t.name.lastIndexOf("userprefs")&&$$(t.name).setValues(JSON.parse(t.prefs))}))}catch(t){l(t,ie,"getDataUserprefs")}}()})),t.fail((function(t){c(t,ie,"getDataUserprefs")}))}()),function(){try{$$("userprefs").show()}catch(t){l(t,ie,"showUserprefs")}}(),function(){let t=webix.storage.local.get("user");try{t&&$$("userprefsName").setValues(t.name.toString())}catch(t){l(t,ie,"setUserprefsNameValue")}}(),Gt(),function(){try{const t=$$("webix__none-content");t&&t.hide()}catch(t){l(t,ie,"hideNoneContent")}}(),function(){try{const t=$$("webix__null-content");t&&t.getParentView().removeView(t)}catch(t){l(t,ie,"removeNullContent")}}()}const re="router => experimental";function ae(){try{$$("treeTempl").show()}catch(t){l(t,re,"showTreeTempl")}}const se="router => logout";function ce(){return new(Backbone.Router.extend({routes:{"":"index",content:"content",userprefs:"userprefs",cp:"cp",logout:"logout","tree/:id":"tree","experimental/:id":"experimental"},content:function(){Yt()},index:function(){!async function(){e.whoami||await n("whoami"),e.whoami?function(){try{Backbone.history.navigate("content",{trigger:!0})}catch(t){l(t,te,"goToContentPage")}}():function(){try{const t=$$("mainLayout"),e=$$("userAuth");t&&t.hide(),e&&e.show()}catch(t){window.alert("getAuth: "+t+" (Подробности: ошибка в отрисовке контента, router:index function showWorkspace)"),l(t,te,"index => showWorkspace")}}()}()},tree:function(t){Zt(t)},cp:function(){ne()},userprefs:function(){oe()},experimental:function(){!function(){try{const t=$$("webix__null-content");t&&t.getParentView().removeView(t)}catch(t){l(t,re,"removeNullContent")}}(),Qt(),d($$("webix__none-content")),Kt(),$$("treeTempl")?(ae(),C()):(Jt("treeTempl"),C(),ae()),Gt()},logout:function(){!function(){const t=webix.ajax().post("/init/default/logout/");t.then((function(t){!function(){try{history.back()}catch(t){l(t,se,"backPage")}}(),function(){try{const t=$$("webix__none-content");t&&t.show()}catch(t){l(t,se,"showNoneContent")}}(),function(){try{const t=$$("tree");t&&t.clearAll()}catch(t){l(t,se,"clearTree")}}(),function(){try{webix.storage.local.clear()}catch(t){l(t,se,"clearStorage")}}()})),t.fail((function(t){c(t,se,"logoutData")}))}()}}))}function le(){const e={view:"toolbar",id:"header",padding:10,css:"webix_header-style",elements:[{cols:[{view:"button",type:"icon",id:"collapseBtn",icon:"icon-bars",css:"webix_collapse",title:"текст",height:42,width:40,click:function(){function t(t=!1){$$("header").getChildViews().forEach((function(e){(e.config.id.includes("search")||e.config.id.includes("log-btn")||e.config.id.includes("context-menu"))&&(t?e.show():e.hide())}))}try{window.innerWidth>850?$$("tree").isVisible()?(this.refresh(),$$("tree").hide(),$$("sideMenuResizer")&&$$("sideMenuResizer").hide()):($$("tree").show(),this.refresh(),window.innerWidth>=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").show()):$$("tree").isVisible()?(this.refresh(),$$("tree").hide(),$$("sideMenuResizer")&&$$("sideMenuResizer").hide(),t(!0)):($$("tree").show(),$$("tree").config.width=window.innerWidth,$$("tree").resize(),this.refresh(),window.innerWidth>=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").show(),t())}catch(t){console.log(t),a("009-000",t)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Видимость бокового меню"),document.fonts.onloadingdone=function(t){const e=t.fontfaces;let n=!1;e.forEach((function(t){t.family.includes("icomoon")&&(n=!0)})),n||i("success","Не удалось загрузить шрифт иконок","expa")}}}},{view:"label",label:"<img src='/init/static/images/expalogo.png' style='height:30px; margin: 10px;'>",height:25}]},{},{view:"search",placeholder:"Поиск",css:"searchTable",height:42,maxWidth:250,minWidth:40},{view:"button",id:"webix_log-btn",type:"icon",icon:"icon-eye",height:42,badge:0,width:50,css:"webix_log-btn",click:function(){1==this.getValue()?this.setValue(2):this.setValue(1)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть системные сообщения")},onChange:function(t,e,n){let i=$$("logBlock-list").getLastId();2==t?(this.config.badge="",$$("logBlock-list").showItem(i),$$("logLayout").config.height=90,$$("logLayout").resize(),this.config.icon="icon-eye-slash",this.refresh()):($$("logLayout").config.height=5,$$("logLayout").resize(),this.config.icon="icon-eye",this.refresh(),$$("webix_log-btn").config.badge="",$$("webix_log-btn").refresh())}}},{view:"button",id:"button-context-menu",type:"icon",disabled:!0,icon:"icon-user",height:38,width:50,popup:{view:"contextmenu",id:"contextmenu",css:"webix_contextmenu",data:[],on:{onItemClick:function(t,e,n){function o(){$$("tree")&&$$("tree").clearAll()}function r(t){try{m().then((function(e){const n=$$("table-saveBtn");1==e?(Backbone.history.navigate(t,{trigger:!0}),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),o()):2==e&&$$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty&&(n.isVisible()?O(!1,!1):N(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),Backbone.history.navigate(t,{trigger:!0}),o())}))}catch(t){console.log(t),a("005-000",t)}}function u(t){$$("container").getChildViews().forEach((function(e){e.config.id!==t&&$$(e.config.id).isVisible()&&$$(e.config.id).hide()}))}try{if("logout"==t){if($$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty||$$("cp-form")&&$$("cp-form").isDirty()){try{m().then((function(t){if(1==t)Backbone.history.navigate("logout",{trigger:!0}),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh();else if(2==t&&($$("cp-form")||$$("editTableFormProperty")))if($$("cp-form")&&$$("cp-form").isDirty()&&$$("cp-form").validate()){let t={op:"",np:""},e=$$("cp-form").getValues();t.np=e.newPass,t.op=e.oldPass,webix.ajax().post("/init/default/api/cp",t,{success:function(t,e,n){"i"==(e=e.json()).err_type?i("success",e.err):"e"==e.err_type&&i("error",e.err)},error:function(t,e,n){s("011-000",n.status,n.statusText,n.responseURL)}}),Backbone.history.navigate("logout",{trigger:!0})}else{if(!$$("editTableFormProperty")||!$$("editTableFormProperty").config.dirty)return i("error","Заполните пустые поля"),!1;$$("editTableFormProperty").getValues().id?O(!1,!1):N(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),Backbone.history.navigate("logout",{trigger:!0})}}))}catch(t){console.log(t),a("005-000",t)}return!1}Backbone.history.navigate("logout",{trigger:!0})}else"cp"==t?($$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty?r("cp"):(o(),Backbone.history.navigate("/cp",{trigger:!0})),u("user_auth")):"userprefs"==t?($$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty?r("userprefs"):(o(),Backbone.history.navigate("/userprefs",{trigger:!0})),u("userprefs")):"favs"==t&&function(){const t={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){try{$$("popupFavsLink")&&$$("popupFavsLink").destructor()}catch(t){l(t,"favsLink","favsPopup click")}}},e={view:"radio",id:"favCollectionLinks",vertical:!0,options:[{id:"radioNoneContent",disabled:!0,value:"Здесь будут сохранены Ваши ссылки"}],on:{onChange:function(t,e){try{const n=$$("favLinkSubmit");t!==e&&n&&!n.isEnabled()&&n.enable()}catch(t){l(t,"favsLink","favsPopup => radioLinks")}}}},n={view:"button",id:"favLinkSubmit",value:"Открыть ссылку",css:"webix_primary",disabled:!0,click:function(){!function(){try{const t=$$("favCollectionLinks"),e=t.getValue(),n=t.getOption(e);window.location.replace(n.favLink)}catch(t){l(t,"favsLink","favsPopupSubmitClick")}}()}};webix.ui({view:"popup",id:"popupFavsLink",css:"webix_popup-prev-href",width:400,minHeight:300,escHide:!0,modal:!0,position:"center",body:{rows:[{rows:[{cols:[{template:"Избранное",width:250,css:"popup_headline",borderless:!0,height:20},{},t]},e,{height:15},n]}]}}),function(){const t=webix.ajax().get("/init/default/api/userprefs/");t.then((function(t){t=t.json().content;const e=[];let n=webix.storage.local.get("user");n||(g(),n=webix.storage.local.get("user")),n&&(function(){try{t.forEach((function(t){t.name.includes("fav-link")&&n.id==t.owner&&e.push(JSON.parse(t.prefs))}))}catch(t){l(t,"favsLink","favsPopupCollectionClick => getFavsCollection")}}(),function(){const t=$$("favCollectionLinks");try{e.length&&e.forEach((function(e){t.addOption({id:e.id,value:e.name,favLink:e.link}),t.removeOption("radioNoneContent")})),$$("popupFavsLink").show()}catch(t){l(t,"favsLink","favsPopupCollectionClick => createOptions")}}())})),t.fail((function(t){c(t,"favsLink","favsPopupCollectionClick getData")}))}()}()}catch(t){console.log(t),a("005-000",t)}}}},on:{onItemClick:function(){try{webix.ajax().get("/init/default/api/userprefs/",{success:function(e,n,o){if("e"==(n=n.json().content).err_type&&i("error",n.error),"/index.html/content"!==window.location.pathname&&"/init/default/spaw/content"!==window.location.pathname){let e=!1,o={};o.href=window.location.href;let r={name:"userLocationHref",prefs:o};try{n.forEach((function(t,n){"userLocationHref"==t.name&&(e=!0,webix.ajax().put("/init/default/api/userprefs/"+t.id,r,{success:function(t,e,n){"e"==(e=e.json()).err_type&&i("error",e.error)},error:function(t,e,n){s("005-011",n.status,n.statusText,n.responseURL)}}).catch((t=>{console.log(t),s("005-011",t.status,t.statusText,t.responseURL)})))}))}catch(t){console.log(t),a("005-000",t)}try{if(!e){let e=webix.storage.local.get("user").id;e?r.owner=e:webix.ajax("/init/default/api/whoami",{success:function(e,n,i){r.owner=n.json().content.id;let o={};o.id=n.json().content.id,o.name=n.json().content.first_name,o.username=n.json().content.username,t("user",JSON.stringify(o))},error:function(t,e,n){s("005-011",n.status,n.statusText,n.responseURL)}}).catch((t=>{console.log(t),s("005-000",t.status,t.statusText,t.responseURL)})),webix.ajax().post("/init/default/api/userprefs/",r,{success:function(t,e,n){"e"==(e=e.json()).err_type&&i("error",e.error)},error:function(t,e,n){s("005-001",n.status,n.statusText,n.responseURL)}}).catch((t=>{console.log(t),s("005-001",t.status,t.statusText,t.responseURL)}))}}catch(t){console.log(t),a("005-000",t)}}},error:function(t,e,n){s("005-000",n.status,n.statusText,n.responseURL)}}).catch((t=>{console.log(t),s("005-000",t.status,t.statusText,t.responseURL)}))}catch(t){console.log(t),a("005-000",t)}}}}]};return e}function ue(){try{const t=document.querySelector(".webix_btn-filter");t&&t.classList.contains("webix-transparent-btn--primary")&&(t.classList.add("webix-transparent-btn"),t.classList.remove("webix-transparent-btn--primary"))}catch(t){l(t,"sidebar","setStateFilterBtn")}}!function(){!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("underscore",e):(t="undefined"!=typeof globalThis?globalThis:t||self,function(){var n=t._,i=t._=e();i.noConflict=function(){return t._=n,i}}())}(this,(function(){var t="1.13.4",e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},n=Array.prototype,i=Object.prototype,o="undefined"!=typeof Symbol?Symbol.prototype:null,r=n.push,a=n.slice,s=i.toString,c=i.hasOwnProperty,l="undefined"!=typeof ArrayBuffer,u="undefined"!=typeof DataView,d=Array.isArray,f=Object.keys,h=Object.create,p=l&&ArrayBuffer.isView,b=isNaN,$=isFinite,m=!{toString:null}.propertyIsEnumerable("toString"),g=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],w=Math.pow(2,53)-1;function v(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),i=Array(n),o=0;o<n;o++)i[o]=arguments[o+e];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,arguments[0],i);case 2:return t.call(this,arguments[0],arguments[1],i)}var r=Array(e+1);for(o=0;o<e;o++)r[o]=arguments[o];return r[e]=i,t.apply(this,r)}}function y(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function x(t){return void 0===t}function _(t){return!0===t||!1===t||"[object Boolean]"===s.call(t)}function E(t){var e="[object "+t+"]";return function(t){return s.call(t)===e}}var k=E("String"),T=E("Number"),V=E("Date"),C=E("RegExp"),S=E("Error"),B=E("Symbol"),I=E("ArrayBuffer"),F=E("Function"),A=e.document&&e.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof A&&(F=function(t){return"function"==typeof t||!1});var j=F,P=E("Object"),L=u&&P(new DataView(new ArrayBuffer(8))),O="undefined"!=typeof Map&&P(new Map),N=E("DataView"),D=L?function(t){return null!=t&&j(t.getInt8)&&I(t.buffer)}:N,R=d||E("Array");function z(t,e){return null!=t&&c.call(t,e)}var W=E("Arguments");!function(){W(arguments)||(W=function(t){return z(t,"callee")})}();var H=W;function M(t){return T(t)&&b(t)}function U(t){return function(){return t}}function q(t){return function(e){var n=t(e);return"number"==typeof n&&n>=0&&n<=w}}function J(t){return function(e){return null==e?void 0:e[t]}}var Y=J("byteLength"),K=q(Y),G=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,Q=l?function(t){return p?p(t)&&!D(t):K(t)&&G.test(s.call(t))}:U(!1),X=J("length");function Z(t,e){e=function(t){for(var e={},n=t.length,i=0;i<n;++i)e[t[i]]=!0;return{contains:function(t){return!0===e[t]},push:function(n){return e[n]=!0,t.push(n)}}}(e);var n=g.length,o=t.constructor,r=j(o)&&o.prototype||i,a="constructor";for(z(t,a)&&!e.contains(a)&&e.push(a);n--;)(a=g[n])in t&&t[a]!==r[a]&&!e.contains(a)&&e.push(a)}function tt(t){if(!y(t))return[];if(f)return f(t);var e=[];for(var n in t)z(t,n)&&e.push(n);return m&&Z(t,e),e}function et(t,e){var n=tt(e),i=n.length;if(null==t)return!i;for(var o=Object(t),r=0;r<i;r++){var a=n[r];if(e[a]!==o[a]||!(a in o))return!1}return!0}function nt(t){return t instanceof nt?t:this instanceof nt?void(this._wrapped=t):new nt(t)}function it(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,Y(t))}nt.VERSION=t,nt.prototype.value=function(){return this._wrapped},nt.prototype.valueOf=nt.prototype.toJSON=nt.prototype.value,nt.prototype.toString=function(){return String(this._wrapped)};var ot="[object DataView]";function rt(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var o=typeof t;return("function"===o||"object"===o||"object"==typeof e)&&at(t,e,n,i)}function at(t,e,n,i){t instanceof nt&&(t=t._wrapped),e instanceof nt&&(e=e._wrapped);var r=s.call(t);if(r!==s.call(e))return!1;if(L&&"[object Object]"==r&&D(t)){if(!D(e))return!1;r=ot}switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return o.valueOf.call(t)===o.valueOf.call(e);case"[object ArrayBuffer]":case ot:return at(it(t),it(e),n,i)}var a="[object Array]"===r;if(!a&&Q(t)){if(Y(t)!==Y(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;a=!0}if(!a){if("object"!=typeof t||"object"!=typeof e)return!1;var c=t.constructor,l=e.constructor;if(c!==l&&!(j(c)&&c instanceof c&&j(l)&&l instanceof l)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];for(var u=(n=n||[]).length;u--;)if(n[u]===t)return i[u]===e;if(n.push(t),i.push(e),a){if((u=t.length)!==e.length)return!1;for(;u--;)if(!rt(t[u],e[u],n,i))return!1}else{var d,f=tt(t);if(u=f.length,tt(e).length!==u)return!1;for(;u--;)if(!z(e,d=f[u])||!rt(t[d],e[d],n,i))return!1}return n.pop(),i.pop(),!0}function st(t){if(!y(t))return[];var e=[];for(var n in t)e.push(n);return m&&Z(t,e),e}function ct(t){var e=X(t);return function(n){if(null==n)return!1;var i=st(n);if(X(i))return!1;for(var o=0;o<e;o++)if(!j(n[t[o]]))return!1;return t!==ht||!j(n[lt])}}var lt="forEach",ut=["clear","delete"],dt=["get","has","set"],ft=ut.concat(lt,dt),ht=ut.concat(dt),pt=["add"].concat(ut,lt,"has"),bt=O?ct(ft):E("Map"),$t=O?ct(ht):E("WeakMap"),mt=O?ct(pt):E("Set"),gt=E("WeakSet");function wt(t){for(var e=tt(t),n=e.length,i=Array(n),o=0;o<n;o++)i[o]=t[e[o]];return i}function vt(t){for(var e={},n=tt(t),i=0,o=n.length;i<o;i++)e[t[n[i]]]=n[i];return e}function yt(t){var e=[];for(var n in t)j(t[n])&&e.push(n);return e.sort()}function xt(t,e){return function(n){var i=arguments.length;if(e&&(n=Object(n)),i<2||null==n)return n;for(var o=1;o<i;o++)for(var r=arguments[o],a=t(r),s=a.length,c=0;c<s;c++){var l=a[c];e&&void 0!==n[l]||(n[l]=r[l])}return n}}var _t=xt(st),Et=xt(tt),kt=xt(st,!0);function Tt(t){if(!y(t))return{};if(h)return h(t);var e=function(){};e.prototype=t;var n=new e;return e.prototype=null,n}function Vt(t){return R(t)?t:[t]}function Ct(t){return nt.toPath(t)}function St(t,e){for(var n=e.length,i=0;i<n;i++){if(null==t)return;t=t[e[i]]}return n?t:void 0}function Bt(t,e,n){var i=St(t,Ct(e));return x(i)?n:i}function It(t){return t}function Ft(t){return t=Et({},t),function(e){return et(e,t)}}function At(t){return t=Ct(t),function(e){return St(e,t)}}function jt(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,o){return t.call(e,n,i,o)};case 4:return function(n,i,o,r){return t.call(e,n,i,o,r)}}return function(){return t.apply(e,arguments)}}function Pt(t,e,n){return null==t?It:j(t)?jt(t,e,n):y(t)&&!R(t)?Ft(t):At(t)}function Lt(t,e){return Pt(t,e,1/0)}function Ot(t,e,n){return nt.iteratee!==Lt?nt.iteratee(t,e):Pt(t,e,n)}function Nt(){}function Dt(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}nt.toPath=Vt,nt.iteratee=Lt;var Rt=Date.now||function(){return(new Date).getTime()};function zt(t){var e=function(e){return t[e]},n="(?:"+tt(t).join("|")+")",i=RegExp(n),o=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(o,e):t}}var Wt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Ht=zt(Wt),Mt=zt(vt(Wt)),Ut=nt.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},qt=/(.)^/,Jt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Yt=/\\|'|\r|\n|\u2028|\u2029/g;function Kt(t){return"\\"+Jt[t]}var Gt=/^\s*(\w|\$)+\s*$/,Qt=0;function Xt(t,e,n,i,o){if(!(i instanceof e))return t.apply(n,o);var r=Tt(t.prototype),a=t.apply(r,o);return y(a)?a:r}var Zt=v((function(t,e){var n=Zt.placeholder,i=function(){for(var o=0,r=e.length,a=Array(r),s=0;s<r;s++)a[s]=e[s]===n?arguments[o++]:e[s];for(;o<arguments.length;)a.push(arguments[o++]);return Xt(t,i,this,this,a)};return i}));Zt.placeholder=nt;var te=v((function(t,e,n){if(!j(t))throw new TypeError("Bind must be called on a function");var i=v((function(o){return Xt(t,i,e,this,n.concat(o))}));return i})),ee=q(X);function ne(t,e,n,i){if(i=i||[],e||0===e){if(e<=0)return i.concat(t)}else e=1/0;for(var o=i.length,r=0,a=X(t);r<a;r++){var s=t[r];if(ee(s)&&(R(s)||H(s)))if(e>1)ne(s,e-1,n,i),o=i.length;else for(var c=0,l=s.length;c<l;)i[o++]=s[c++];else n||(i[o++]=s)}return i}var ie=v((function(t,e){var n=(e=ne(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var i=e[n];t[i]=te(t[i],t)}return t})),oe=v((function(t,e,n){return setTimeout((function(){return t.apply(null,n)}),e)})),re=Zt(oe,nt,1);function ae(t){return function(){return!t.apply(this,arguments)}}function se(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}var ce=Zt(se,2);function le(t,e,n){e=Ot(e,n);for(var i,o=tt(t),r=0,a=o.length;r<a;r++)if(e(t[i=o[r]],i,t))return i}function ue(t){return function(e,n,i){n=Ot(n,i);for(var o=X(e),r=t>0?0:o-1;r>=0&&r<o;r+=t)if(n(e[r],r,e))return r;return-1}}var de=ue(1),fe=ue(-1);function he(t,e,n,i){for(var o=(n=Ot(n,i,1))(e),r=0,a=X(t);r<a;){var s=Math.floor((r+a)/2);n(t[s])<o?r=s+1:a=s}return r}function pe(t,e,n){return function(i,o,r){var s=0,c=X(i);if("number"==typeof r)t>0?s=r>=0?r:Math.max(r+c,s):c=r>=0?Math.min(r+1,c):r+c+1;else if(n&&r&&c)return i[r=n(i,o)]===o?r:-1;if(o!=o)return(r=e(a.call(i,s,c),M))>=0?r+s:-1;for(r=t>0?s:c-1;r>=0&&r<c;r+=t)if(i[r]===o)return r;return-1}}var be=pe(1,de,he),$e=pe(-1,fe);function me(t,e,n){var i=(ee(t)?de:le)(t,e,n);if(void 0!==i&&-1!==i)return t[i]}function ge(t,e,n){var i,o;if(e=jt(e,n),ee(t))for(i=0,o=t.length;i<o;i++)e(t[i],i,t);else{var r=tt(t);for(i=0,o=r.length;i<o;i++)e(t[r[i]],r[i],t)}return t}function we(t,e,n){e=Ot(e,n);for(var i=!ee(t)&&tt(t),o=(i||t).length,r=Array(o),a=0;a<o;a++){var s=i?i[a]:a;r[a]=e(t[s],s,t)}return r}function ve(t){var e=function(e,n,i,o){var r=!ee(e)&&tt(e),a=(r||e).length,s=t>0?0:a-1;for(o||(i=e[r?r[s]:s],s+=t);s>=0&&s<a;s+=t){var c=r?r[s]:s;i=n(i,e[c],c,e)}return i};return function(t,n,i,o){var r=arguments.length>=3;return e(t,jt(n,o,4),i,r)}}var ye=ve(1),xe=ve(-1);function _e(t,e,n){var i=[];return e=Ot(e,n),ge(t,(function(t,n,o){e(t,n,o)&&i.push(t)})),i}function Ee(t,e,n){e=Ot(e,n);for(var i=!ee(t)&&tt(t),o=(i||t).length,r=0;r<o;r++){var a=i?i[r]:r;if(!e(t[a],a,t))return!1}return!0}function ke(t,e,n){e=Ot(e,n);for(var i=!ee(t)&&tt(t),o=(i||t).length,r=0;r<o;r++){var a=i?i[r]:r;if(e(t[a],a,t))return!0}return!1}function Te(t,e,n,i){return ee(t)||(t=wt(t)),("number"!=typeof n||i)&&(n=0),be(t,e,n)>=0}var Ve=v((function(t,e,n){var i,o;return j(e)?o=e:(e=Ct(e),i=e.slice(0,-1),e=e[e.length-1]),we(t,(function(t){var r=o;if(!r){if(i&&i.length&&(t=St(t,i)),null==t)return;r=t[e]}return null==r?r:r.apply(t,n)}))}));function Ce(t,e){return we(t,At(e))}function Se(t,e,n){var i,o,r=-1/0,a=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var s=0,c=(t=ee(t)?t:wt(t)).length;s<c;s++)null!=(i=t[s])&&i>r&&(r=i);else e=Ot(e,n),ge(t,(function(t,n,i){((o=e(t,n,i))>a||o===-1/0&&r===-1/0)&&(r=t,a=o)}));return r}var Be=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Ie(t){return t?R(t)?a.call(t):k(t)?t.match(Be):ee(t)?we(t,It):wt(t):[]}function Fe(t,e,n){if(null==e||n)return ee(t)||(t=wt(t)),t[Dt(t.length-1)];var i=Ie(t),o=X(i);e=Math.max(Math.min(e,o),0);for(var r=o-1,a=0;a<e;a++){var s=Dt(a,r),c=i[a];i[a]=i[s],i[s]=c}return i.slice(0,e)}function Ae(t,e){return function(n,i,o){var r=e?[[],[]]:{};return i=Ot(i,o),ge(n,(function(e,o){var a=i(e,o,n);t(r,e,a)})),r}}var je=Ae((function(t,e,n){z(t,n)?t[n].push(e):t[n]=[e]})),Pe=Ae((function(t,e,n){t[n]=e})),Le=Ae((function(t,e,n){z(t,n)?t[n]++:t[n]=1})),Oe=Ae((function(t,e,n){t[n?0:1].push(e)}),!0);function Ne(t,e,n){return e in n}var De=v((function(t,e){var n={},i=e[0];if(null==t)return n;j(i)?(e.length>1&&(i=jt(i,e[1])),e=st(t)):(i=Ne,e=ne(e,!1,!1),t=Object(t));for(var o=0,r=e.length;o<r;o++){var a=e[o],s=t[a];i(s,a,t)&&(n[a]=s)}return n})),Re=v((function(t,e){var n,i=e[0];return j(i)?(i=ae(i),e.length>1&&(n=e[1])):(e=we(ne(e,!1,!1),String),i=function(t,n){return!Te(e,n)}),De(t,i,n)}));function ze(t,e,n){return a.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))}function We(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[0]:ze(t,t.length-e)}function He(t,e,n){return a.call(t,null==e||n?1:e)}var Me=v((function(t,e){return e=ne(e,!0,!0),_e(t,(function(t){return!Te(e,t)}))})),Ue=v((function(t,e){return Me(t,e)}));function qe(t,e,n,i){_(e)||(i=n,n=e,e=!1),null!=n&&(n=Ot(n,i));for(var o=[],r=[],a=0,s=X(t);a<s;a++){var c=t[a],l=n?n(c,a,t):c;e&&!n?(a&&r===l||o.push(c),r=l):n?Te(r,l)||(r.push(l),o.push(c)):Te(o,c)||o.push(c)}return o}var Je=v((function(t){return qe(ne(t,!0,!0))}));function Ye(t){for(var e=t&&Se(t,X).length||0,n=Array(e),i=0;i<e;i++)n[i]=Ce(t,i);return n}var Ke=v(Ye);function Ge(t,e){return t._chain?nt(e).chain():e}function Qe(t){return ge(yt(t),(function(e){var n=nt[e]=t[e];nt.prototype[e]=function(){var t=[this._wrapped];return r.apply(t,arguments),Ge(this,n.apply(nt,t))}})),nt}ge(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=n[t];nt.prototype[t]=function(){var n=this._wrapped;return null!=n&&(e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0]),Ge(this,n)}})),ge(["concat","join","slice"],(function(t){var e=n[t];nt.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=e.apply(t,arguments)),Ge(this,t)}}));var Xe={__proto__:null,VERSION:t,restArguments:v,isObject:y,isNull:function(t){return null===t},isUndefined:x,isBoolean:_,isElement:function(t){return!(!t||1!==t.nodeType)},isString:k,isNumber:T,isDate:V,isRegExp:C,isError:S,isSymbol:B,isArrayBuffer:I,isDataView:D,isArray:R,isFunction:j,isArguments:H,isFinite:function(t){return!B(t)&&$(t)&&!isNaN(parseFloat(t))},isNaN:M,isTypedArray:Q,isEmpty:function(t){if(null==t)return!0;var e=X(t);return"number"==typeof e&&(R(t)||k(t)||H(t))?0===e:0===X(tt(t))},isMatch:et,isEqual:function(t,e){return rt(t,e)},isMap:bt,isWeakMap:$t,isSet:mt,isWeakSet:gt,keys:tt,allKeys:st,values:wt,pairs:function(t){for(var e=tt(t),n=e.length,i=Array(n),o=0;o<n;o++)i[o]=[e[o],t[e[o]]];return i},invert:vt,functions:yt,methods:yt,extend:_t,extendOwn:Et,assign:Et,defaults:kt,create:function(t,e){var n=Tt(t);return e&&Et(n,e),n},clone:function(t){return y(t)?R(t)?t.slice():_t({},t):t},tap:function(t,e){return e(t),t},get:Bt,has:function(t,e){for(var n=(e=Ct(e)).length,i=0;i<n;i++){var o=e[i];if(!z(t,o))return!1;t=t[o]}return!!n},mapObject:function(t,e,n){e=Ot(e,n);for(var i=tt(t),o=i.length,r={},a=0;a<o;a++){var s=i[a];r[s]=e(t[s],s,t)}return r},identity:It,constant:U,noop:Nt,toPath:Vt,property:At,propertyOf:function(t){return null==t?Nt:function(e){return Bt(t,e)}},matcher:Ft,matches:Ft,times:function(t,e,n){var i=Array(Math.max(0,t));e=jt(e,n,1);for(var o=0;o<t;o++)i[o]=e(o);return i},random:Dt,now:Rt,escape:Ht,unescape:Mt,templateSettings:Ut,template:function(t,e,n){!e&&n&&(e=n),e=kt({},e,nt.templateSettings);var i=RegExp([(e.escape||qt).source,(e.interpolate||qt).source,(e.evaluate||qt).source].join("|")+"|$","g"),o=0,r="__p+='";t.replace(i,(function(e,n,i,a,s){return r+=t.slice(o,s).replace(Yt,Kt),o=s+e.length,n?r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?r+="'+\n((__t=("+i+"))==null?'':__t)+\n'":a&&(r+="';\n"+a+"\n__p+='"),e})),r+="';\n";var a,s=e.variable;if(s){if(!Gt.test(s))throw new Error("variable is not a bare identifier: "+s)}else r="with(obj||{}){\n"+r+"}\n",s="obj";r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{a=new Function(s,"_",r)}catch(t){throw t.source=r,t}var c=function(t){return a.call(this,t,nt)};return c.source="function("+s+"){\n"+r+"}",c},result:function(t,e,n){var i=(e=Ct(e)).length;if(!i)return j(n)?n.call(t):n;for(var o=0;o<i;o++){var r=null==t?void 0:t[e[o]];void 0===r&&(r=n,o=i),t=j(r)?r.call(t):r}return t},uniqueId:function(t){var e=++Qt+"";return t?t+e:e},chain:function(t){var e=nt(t);return e._chain=!0,e},iteratee:Lt,partial:Zt,bind:te,bindAll:ie,memoize:function(t,e){var n=function(i){var o=n.cache,r=""+(e?e.apply(this,arguments):i);return z(o,r)||(o[r]=t.apply(this,arguments)),o[r]};return n.cache={},n},delay:oe,defer:re,throttle:function(t,e,n){var i,o,r,a,s=0;n||(n={});var c=function(){s=!1===n.leading?0:Rt(),i=null,a=t.apply(o,r),i||(o=r=null)},l=function(){var l=Rt();s||!1!==n.leading||(s=l);var u=e-(l-s);return o=this,r=arguments,u<=0||u>e?(i&&(clearTimeout(i),i=null),s=l,a=t.apply(o,r),i||(o=r=null)):i||!1===n.trailing||(i=setTimeout(c,u)),a};return l.cancel=function(){clearTimeout(i),s=0,i=o=r=null},l},debounce:function(t,e,n){var i,o,r,a,s,c=function(){var l=Rt()-o;e>l?i=setTimeout(c,e-l):(i=null,n||(a=t.apply(s,r)),i||(r=s=null))},l=v((function(l){return s=this,r=l,o=Rt(),i||(i=setTimeout(c,e),n&&(a=t.apply(s,r))),a}));return l.cancel=function(){clearTimeout(i),i=r=s=null},l},wrap:function(t,e){return Zt(e,t)},negate:ae,compose:function(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}},after:function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},before:se,once:ce,findKey:le,findIndex:de,findLastIndex:fe,sortedIndex:he,indexOf:be,lastIndexOf:$e,find:me,detect:me,findWhere:function(t,e){return me(t,Ft(e))},each:ge,forEach:ge,map:we,collect:we,reduce:ye,foldl:ye,inject:ye,reduceRight:xe,foldr:xe,filter:_e,select:_e,reject:function(t,e,n){return _e(t,ae(Ot(e)),n)},every:Ee,all:Ee,some:ke,any:ke,contains:Te,includes:Te,include:Te,invoke:Ve,pluck:Ce,where:function(t,e){return _e(t,Ft(e))},max:Se,min:function(t,e,n){var i,o,r=1/0,a=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var s=0,c=(t=ee(t)?t:wt(t)).length;s<c;s++)null!=(i=t[s])&&i<r&&(r=i);else e=Ot(e,n),ge(t,(function(t,n,i){((o=e(t,n,i))<a||o===1/0&&r===1/0)&&(r=t,a=o)}));return r},shuffle:function(t){return Fe(t,1/0)},sample:Fe,sortBy:function(t,e,n){var i=0;return e=Ot(e,n),Ce(we(t,(function(t,n,o){return{value:t,index:i++,criteria:e(t,n,o)}})).sort((function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index})),"value")},groupBy:je,indexBy:Pe,countBy:Le,partition:Oe,toArray:Ie,size:function(t){return null==t?0:ee(t)?t.length:tt(t).length},pick:De,omit:Re,first:We,head:We,take:We,initial:ze,last:function(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[t.length-1]:He(t,Math.max(0,t.length-e))},rest:He,tail:He,drop:He,compact:function(t){return _e(t,Boolean)},flatten:function(t,e){return ne(t,e,!1)},without:Ue,uniq:qe,unique:qe,union:Je,intersection:function(t){for(var e=[],n=arguments.length,i=0,o=X(t);i<o;i++){var r=t[i];if(!Te(e,r)){var a;for(a=1;a<n&&Te(arguments[a],r);a++);a===n&&e.push(r)}}return e},difference:Me,unzip:Ye,transpose:Ye,zip:Ke,object:function(t,e){for(var n={},i=0,o=X(t);i<o;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},range:function(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var i=Math.max(Math.ceil((e-t)/n),0),o=Array(i),r=0;r<i;r++,t+=n)o[r]=t;return o},chunk:function(t,e){if(null==e||e<1)return[];for(var n=[],i=0,o=t.length;i<o;)n.push(a.call(t,i,i+=e));return n},mixin:Qe,default:nt},Ze=Qe(Xe);return Ze._=Ze,Ze})),function(t){var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],(function(n,i,o){e.Backbone=t(e,o,n,i)}));else if("undefined"!=typeof exports){var n,i=require("underscore");try{n=require("jquery")}catch(t){}t(e,exports,i,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}((function(t,e,n,i){var o=t.Backbone,r=Array.prototype.slice;e.VERSION="1.4.1",e.$=i,e.noConflict=function(){return t.Backbone=o,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a,s=e.Events={},c=/\s+/,l=function(t,e,i,o,r){var a,s=0;if(i&&"object"==typeof i){void 0!==o&&"context"in r&&void 0===r.context&&(r.context=o);for(a=n.keys(i);s<a.length;s++)e=l(t,e,a[s],i[a[s]],r)}else if(i&&c.test(i))for(a=i.split(c);s<a.length;s++)e=t(e,a[s],o,r);else e=t(e,i,o,r);return e};s.on=function(t,e,n){return this._events=l(u,this._events||{},t,e,{context:n,ctx:this,listening:a}),a&&((this._listeners||(this._listeners={}))[a.id]=a,a.interop=!1),this},s.listenTo=function(t,e,i){if(!t)return this;var o=t._listenId||(t._listenId=n.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),s=a=r[o];s||(this._listenId||(this._listenId=n.uniqueId("l")),s=a=r[o]=new $(this,t));var c=d(t,e,i,this);if(a=void 0,c)throw c;return s.interop&&s.on(e,i),this};var u=function(t,e,n,i){if(n){var o=t[e]||(t[e]=[]),r=i.context,a=i.ctx,s=i.listening;s&&s.count++,o.push({callback:n,context:r,ctx:r||a,listening:s})}return t},d=function(t,e,n,i){try{t.on(e,n,i)}catch(t){return t}};s.off=function(t,e,n){return this._events?(this._events=l(f,this._events,t,e,{context:n,listeners:this._listeners}),this):this},s.stopListening=function(t,e,i){var o=this._listeningTo;if(!o)return this;for(var r=t?[t._listenId]:n.keys(o),a=0;a<r.length;a++){var s=o[r[a]];if(!s)break;s.obj.off(e,i,this),s.interop&&s.off(e,i)}return n.isEmpty(o)&&(this._listeningTo=void 0),this};var f=function(t,e,i,o){if(t){var r,a=o.context,s=o.listeners,c=0;if(e||a||i){for(r=e?[e]:n.keys(t);c<r.length;c++){var l=t[e=r[c]];if(!l)break;for(var u=[],d=0;d<l.length;d++){var f=l[d];if(i&&i!==f.callback&&i!==f.callback._callback||a&&a!==f.context)u.push(f);else{var h=f.listening;h&&h.off(e,i)}}u.length?t[e]=u:delete t[e]}return t}for(r=n.keys(s);c<r.length;c++)s[r[c]].cleanup()}};s.once=function(t,e,n){var i=l(h,{},t,e,this.off.bind(this));return"string"==typeof t&&null==n&&(e=void 0),this.on(i,e,n)},s.listenToOnce=function(t,e,n){var i=l(h,{},e,n,this.stopListening.bind(this,t));return this.listenTo(t,i)};var h=function(t,e,i,o){if(i){var r=t[e]=n.once((function(){o(e,r),i.apply(this,arguments)}));r._callback=i}return t};s.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),n=Array(e),i=0;i<e;i++)n[i]=arguments[i+1];return l(p,this._events,t,void 0,n),this};var p=function(t,e,n,i){if(t){var o=t[e],r=t.all;o&&r&&(r=r.slice()),o&&b(o,i),r&&b(r,[e].concat(i))}return t},b=function(t,e){var n,i=-1,o=t.length,r=e[0],a=e[1],s=e[2];switch(e.length){case 0:for(;++i<o;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r);return;case 2:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r,a);return;case 3:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r,a,s);return;default:for(;++i<o;)(n=t[i]).callback.apply(n.ctx,e);return}},$=function(t,e){this.id=t._listenId,this.listener=t,this.obj=e,this.interop=!0,this.count=0,this._events=void 0};$.prototype.on=s.on,$.prototype.off=function(t,e){var n;this.interop?(this._events=l(f,this._events,t,e,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()},$.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},s.bind=s.on,s.unbind=s.off,n.extend(e,s);var m=e.Model=function(t,e){var i=t||{};e||(e={}),this.preinitialize.apply(this,arguments),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{});var o=n.result(this,"defaults");i=n.defaults(n.extend({},o,i),o),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};n.extend(m.prototype,s,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(t){return n.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return n.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!n.iteratee(t,this)(this.attributes)},set:function(t,e,i){if(null==t)return this;var o;if("object"==typeof t?(o=t,i=e):(o={})[t]=e,i||(i={}),!this._validate(o,i))return!1;var r=i.unset,a=i.silent,s=[],c=this._changing;this._changing=!0,c||(this._previousAttributes=n.clone(this.attributes),this.changed={});var l=this.attributes,u=this.changed,d=this._previousAttributes;for(var f in o)e=o[f],n.isEqual(l[f],e)||s.push(f),n.isEqual(d[f],e)?delete u[f]:u[f]=e,r?delete l[f]:l[f]=e;if(this.idAttribute in o){var h=this.id;this.id=this.get(this.idAttribute),this.trigger("changeId",this,h,i)}if(!a){s.length&&(this._pending=i);for(var p=0;p<s.length;p++)this.trigger("change:"+s[p],this,l[s[p]],i)}if(c)return this;if(!a)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,n.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,n.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!n.isEmpty(this.changed):n.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&n.clone(this.changed);var e,i=this._changing?this._previousAttributes:this.attributes,o={};for(var r in t){var a=t[r];n.isEqual(i[r],a)||(o[r]=a,e=!0)}return!!e&&o},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(t){t=n.extend({parse:!0},t);var e=this,i=t.success;return t.success=function(n){var o=t.parse?e.parse(n,t):n;if(!e.set(o,t))return!1;i&&i.call(t.context,e,n,t),e.trigger("sync",e,n,t)},M(this,t),this.sync("read",this,t)},save:function(t,e,i){var o;null==t||"object"==typeof t?(o=t,i=e):(o={})[t]=e;var r=(i=n.extend({validate:!0,parse:!0},i)).wait;if(o&&!r){if(!this.set(o,i))return!1}else if(!this._validate(o,i))return!1;var a=this,s=i.success,c=this.attributes;i.success=function(t){a.attributes=c;var e=i.parse?a.parse(t,i):t;if(r&&(e=n.extend({},o,e)),e&&!a.set(e,i))return!1;s&&s.call(i.context,a,t,i),a.trigger("sync",a,t,i)},M(this,i),o&&r&&(this.attributes=n.extend({},c,o));var l=this.isNew()?"create":i.patch?"patch":"update";"patch"!==l||i.attrs||(i.attrs=o);var u=this.sync(l,this,i);return this.attributes=c,u},destroy:function(t){t=t?n.clone(t):{};var e=this,i=t.success,o=t.wait,r=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(n){o&&r(),i&&i.call(t.context,e,n,t),e.isNew()||e.trigger("sync",e,n,t)};var a=!1;return this.isNew()?n.defer(t.success):(M(this,t),a=this.sync("delete",this,t)),o||r(),a},url:function(){var t=n.result(this,"urlRoot")||n.result(this.collection,"url")||H();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},n.extend({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=n.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;return!i||(this.trigger("invalid",this,i,n.extend(e,{validationError:i})),!1)}});var g=e.Collection=function(t,e){e||(e={}),this.preinitialize.apply(this,arguments),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,n.extend({silent:!0},e))},w={add:!0,remove:!0,merge:!0},v={add:!0,remove:!1},y=function(t,e,n){n=Math.min(Math.max(n,0),t.length);var i,o=Array(t.length-n),r=e.length;for(i=0;i<o.length;i++)o[i]=t[i+n];for(i=0;i<r;i++)t[i+n]=e[i];for(i=0;i<o.length;i++)t[i+r+n]=o[i]};n.extend(g.prototype,s,{model:m,preinitialize:function(){},initialize:function(){},toJSON:function(t){return this.map((function(e){return e.toJSON(t)}))},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,n.extend({merge:!1},e,v))},remove:function(t,e){e=n.extend({},e);var i=!n.isArray(t);t=i?[t]:t.slice();var o=this._removeModels(t,e);return!e.silent&&o.length&&(e.changes={added:[],merged:[],removed:o},this.trigger("update",this,e)),i?o[0]:o},set:function(t,e){if(null!=t){(e=n.extend({},w,e)).parse&&!this._isModel(t)&&(t=this.parse(t,e)||[]);var i=!n.isArray(t);t=i?[t]:t.slice();var o=e.at;null!=o&&(o=+o),o>this.length&&(o=this.length),o<0&&(o+=this.length+1);var r,a,s=[],c=[],l=[],u=[],d={},f=e.add,h=e.merge,p=e.remove,b=!1,$=this.comparator&&null==o&&!1!==e.sort,m=n.isString(this.comparator)?this.comparator:null;for(a=0;a<t.length;a++){r=t[a];var g=this.get(r);if(g){if(h&&r!==g){var v=this._isModel(r)?r.attributes:r;e.parse&&(v=g.parse(v,e)),g.set(v,e),l.push(g),$&&!b&&(b=g.hasChanged(m))}d[g.cid]||(d[g.cid]=!0,s.push(g)),t[a]=g}else f&&(r=t[a]=this._prepareModel(r,e))&&(c.push(r),this._addReference(r,e),d[r.cid]=!0,s.push(r))}if(p){for(a=0;a<this.length;a++)d[(r=this.models[a]).cid]||u.push(r);u.length&&this._removeModels(u,e)}var x=!1,_=!$&&f&&p;if(s.length&&_?(x=this.length!==s.length||n.some(this.models,(function(t,e){return t!==s[e]})),this.models.length=0,y(this.models,s,0),this.length=this.models.length):c.length&&($&&(b=!0),y(this.models,c,null==o?this.length:o),this.length=this.models.length),b&&this.sort({silent:!0}),!e.silent){for(a=0;a<c.length;a++)null!=o&&(e.index=o+a),(r=c[a]).trigger("add",r,this,e);(b||x)&&this.trigger("sort",this,e),(c.length||u.length||l.length)&&(e.changes={added:c,removed:u,merged:l},this.trigger("update",this,e))}return i?t[0]:t}},reset:function(t,e){e=e?n.clone(e):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],e);return e.previousModels=this.models,this._reset(),t=this.add(t,n.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,n.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,n.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return r.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.modelId(this._isModel(t)?t.attributes:t,t.idAttribute)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var i=e.length;return n.isFunction(e)&&(e=e.bind(this)),1===i||n.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(t){var e=(t=n.extend({parse:!0},t)).success,i=this;return t.success=function(n){var o=t.reset?"reset":"set";i[o](n,t),e&&e.call(t.context,i,n,t),i.trigger("sync",i,n,t)},M(this,t),this.sync("read",this,t)},create:function(t,e){var i=(e=e?n.clone(e):{}).wait;if(!(t=this._prepareModel(t,e)))return!1;i||this.add(t,e);var o=this,r=e.success;return e.success=function(t,e,n){i&&o.add(t,n),r&&r.call(n.context,t,e,n)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t,e){return t[e||this.model.prototype.idAttribute||"id"]},values:function(){return new _(this,E)},keys:function(){return new _(this,k)},entries:function(){return new _(this,T)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){return this._isModel(t)?(t.collection||(t.collection=this),t):((e=e?n.clone(e):{}).collection=this,(i=this.model.prototype?new this.model(t,e):this.model(t,e)).validationError?(this.trigger("invalid",this,i.validationError,e),!1):i);var i},_removeModels:function(t,e){for(var n=[],i=0;i<t.length;i++){var o=this.get(t[i]);if(o){var r=this.indexOf(o);this.models.splice(r,1),this.length--,delete this._byId[o.cid];var a=this.modelId(o.attributes,o.idAttribute);null!=a&&delete this._byId[a],e.silent||(e.index=r,o.trigger("remove",o,this,e)),n.push(o),this._removeReference(o,e)}}return n},_isModel:function(t){return t instanceof m},_addReference:function(t,e){this._byId[t.cid]=t;var n=this.modelId(t.attributes,t.idAttribute);null!=n&&(this._byId[n]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var n=this.modelId(t.attributes,t.idAttribute);null!=n&&delete this._byId[n],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){if(e){if(("add"===t||"remove"===t)&&n!==this)return;if("destroy"===t&&this.remove(e,i),"changeId"===t){var o=this.modelId(e.previousAttributes(),e.idAttribute),r=this.modelId(e.attributes,e.idAttribute);null!=o&&delete this._byId[o],null!=r&&(this._byId[r]=e)}}this.trigger.apply(this,arguments)}});var x="function"==typeof Symbol&&Symbol.iterator;x&&(g.prototype[x]=g.prototype.values);var _=function(t,e){this._collection=t,this._kind=e,this._index=0},E=1,k=2,T=3;x&&(_.prototype[x]=function(){return this}),_.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var t,e=this._collection.at(this._index);if(this._index++,this._kind===E)t=e;else{var n=this._collection.modelId(e.attributes,e.idAttribute);t=this._kind===k?n:[n,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var V=e.View=function(t){this.cid=n.uniqueId("view"),this.preinitialize.apply(this,arguments),n.extend(this,n.pick(t,S)),this._ensureElement(),this.initialize.apply(this,arguments)},C=/^(\S+)\s*(.*)$/,S=["model","collection","el","id","attributes","className","tagName","events"];n.extend(V.prototype,s,{tagName:"div",$:function(t){return this.$el.find(t)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=n.result(this,"events")),!t)return this;for(var e in this.undelegateEvents(),t){var i=t[e];if(n.isFunction(i)||(i=this[i]),i){var o=e.match(C);this.delegate(o[1],o[2],i.bind(this))}}return this},delegate:function(t,e,n){return this.$el.on(t+".delegateEvents"+this.cid,e,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,n){return this.$el.off(t+".delegateEvents"+this.cid,e,n),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"));else{var t=n.extend({},n.result(this,"attributes"));this.id&&(t.id=n.result(this,"id")),this.className&&(t.class=n.result(this,"className")),this.setElement(this._createElement(n.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}});var B=function(t,e,i,o){n.each(i,(function(n,i){e[i]&&(t.prototype[i]=function(t,e,n,i){switch(e){case 1:return function(){return t[n](this[i])};case 2:return function(e){return t[n](this[i],e)};case 3:return function(e,o){return t[n](this[i],I(e,this),o)};case 4:return function(e,o,r){return t[n](this[i],I(e,this),o,r)};default:return function(){var e=r.call(arguments);return e.unshift(this[i]),t[n].apply(t,e)}}}(e,n,i,o))}))},I=function(t,e){return n.isFunction(t)?t:n.isObject(t)&&!e._isModel(t)?F(t):n.isString(t)?function(e){return e.get(t)}:t},F=function(t){var e=n.matches(t);return function(t){return e(t.attributes)}};n.each([[g,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"],[m,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],(function(t){var e=t[0],i=t[1],o=t[2];e.mixin=function(t){var i=n.reduce(n.functions(t),(function(t,e){return t[e]=0,t}),{});B(e,t,i,o)},B(e,n,i,o)})),e.sync=function(t,i,o){var r=A[t];n.defaults(o||(o={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var a={type:r,dataType:"json"};if(o.url||(a.url=n.result(i,"url")||H()),null!=o.data||!i||"create"!==t&&"update"!==t&&"patch"!==t||(a.contentType="application/json",a.data=JSON.stringify(o.attrs||i.toJSON(o))),o.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),o.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){a.type="POST",o.emulateJSON&&(a.data._method=r);var s=o.beforeSend;o.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",r),s)return s.apply(this,arguments)}}"GET"===a.type||o.emulateJSON||(a.processData=!1);var c=o.error;o.error=function(t,e,n){o.textStatus=e,o.errorThrown=n,c&&c.call(o.context,t,e,n)};var l=o.xhr=e.ajax(n.extend(a,o));return i.trigger("request",i,l,o),l};var A={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var j=e.Router=function(t){t||(t={}),this.preinitialize.apply(this,arguments),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},P=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,O=/\*\w+/g,N=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(j.prototype,s,{preinitialize:function(){},initialize:function(){},route:function(t,i,o){n.isRegExp(t)||(t=this._routeToRegExp(t)),n.isFunction(i)&&(o=i,i=""),o||(o=this[i]);var r=this;return e.history.route(t,(function(n){var a=r._extractParameters(t,n);!1!==r.execute(o,a,i)&&(r.trigger.apply(r,["route:"+i].concat(a)),r.trigger("route",i,a),e.history.trigger("route",r,i,a))})),this},execute:function(t,e,n){t&&t.apply(this,e)},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var t,e=n.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(N,"\\$&").replace(P,"(?:$1)?").replace(L,(function(t,e){return e?t:"([^/?]+)"})).replace(O,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return n.map(i,(function(t,e){return e===i.length-1?t||null:t?decodeURIComponent(t):null}))}});var D=e.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},R=/^[#\/]|\s+$/g,z=/^\/+|\/+$/g,W=/#.*$/;D.started=!1,n.extend(D.prototype,s,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(R,"")},start:function(t){if(D.started)throw new Error("Backbone.history has already been started");if(D.started=!0,this.options=n.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(z,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,o=i.insertBefore(this.iframe,i.firstChild).contentWindow;o.document.open(),o.document.close(),o.location.hash="#"+this.fragment}var r=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),D.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(t){return!!this.matchRoot()&&(t=this.fragment=this.getFragment(t),n.some(this.handlers,(function(e){if(e.route.test(t))return e.callback(t),!0})))},navigate:function(t,e){if(!D.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var n=this.root;""!==t&&"?"!==t.charAt(0)||(n=n.slice(0,-1)||"/");var i=n+t;t=t.replace(W,"");var o=this.decodeFragment(t);if(this.fragment!==o){if(this.fragment=o,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;e.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),e.history=new D,m.extend=g.extend=j.extend=V.extend=D.extend=function(t,e){var i,o=this;return i=t&&n.has(t,"constructor")?t.constructor:function(){return o.apply(this,arguments)},n.extend(i,o,e),i.prototype=n.create(o.prototype,t),i.prototype.constructor=i,i.__super__=o.prototype,i};var H=function(){throw new Error('A "url" property or function must be specified')},M=function(t,e){var n=e.error;e.error=function(i){n&&n.call(e.context,t,i,e),t.trigger("error",t,i,e)}};return e}))}();const de="treeSidebar => onSelectChange";function fe(t){const i=$$("tree"),o=i.getSelectedItem().id,r=i.getParentId(o),a=i.data.order;let s=[];function c(t){try{const n=$$("table-templateHeadline"),i=$$("table-view-templateHeadline");n&&e.tableNames.forEach((function(e,i){e.id==t&&n.setValues(e.name)})),i&&e.tableNames.forEach((function(e,n){e.id==t&&i.setValues(e.name)}))}catch(t){l(t,de,"setTableName")}}function u(t){function o(){$$("container").addView({view:"align",align:"middle,center",id:"webix__null-content",body:{borderless:!0,template:"Блок в процессе разработки",height:50,width:220,css:{color:"#858585","font-size":"14px!important"}}},2)}!function(){try{let t=$$("webix__null-content");t&&h(t)}catch(t){l(t,de,"removeNullContent")}}(),d($$("user_auth")),d($$("userprefs")),s=function(){let t=[];try{a.forEach((function(e,n){0==i.getParentId(e)&&t.push(e)}))}catch(t){l(t,de,"getTreeParents")}return t}(),void 0!==t?s.forEach((function(i,a){let s=$$("tree").getItem(t).action,l=$$("tree").getItem(i).action;t&&async function(){let i;if(e.fields||await n("fields"),e.fields){let n=e.fields.content;i=!1,n[t]&&(i=!0,"dbtable"==n[t].type?f($$("tables")):"tform"==n[t].type?f($$("forms")):"dashboard"==n[t].type&&f($$("dashboards")),c(t))}return i}().then((function(t){t||(d($$("webix__none-content")),$$("webix__null-content")||o())})),s!==l&&l&&("dbtable"==l||"all_dbtable"==l?d($$("tables")):"tform"==l||"all_tform"==l?d($$("forms")):"dashboard"!=l&&"dashboards"===r||d($$("dashboards")))})):function(){try{s.forEach((function(t,e){if(t==r)$$(t)?$$(t).show():$$("webix__null-content")||o();else if($$(t)||"treeTempl"==t)$$(t)&&$$(t).hide();else{const e=$$("tree").getItem(t).action;"dbtable"==e&&"tables"!==r?d($$("tables")):"tform"==e&&"forms"!==r?d($$("forms")):"dashboard"==e&&"dashboards"!==r&&d($$("dashboards"))}}))}catch(t){l(t,de,"viewDefaultElements")}}()}$$("header").getChildViews().forEach((function(t){t.config.id.includes("search")&&t.show()})),d($$("filterTableBarContainer")),f($$("filterEmptyTempalte")),f($$("EditEmptyTempalte")),p($$("btnFilterSubmit")),p($$("filterLibrarySaveBtn")),p($$("resetFilterBtn")),function(){try{const t=$$("table-editForm");t&&t.config.width<320&&(t.config.width=320,t.refresh())}catch(t){l(t,de,"setWidthEditForm")}}(),ue(),function(){try{let e=$$("treeTempl");e&&!$$(t)&&e.hide()}catch(t){l(t,de,"hideTreeTempl")}}(),function(){try{t[0]&&0!==r&&d($$("webix__none-content"))}catch(t){l(t,de,"hideNoneContent")}}(),"tables"==r||"dashboards"==r?u():"forms"==r?(d($$("propTableView")),u()):(0==r&&"tables"!==o&&"user_auth"!==o&&"dashboards"!==o&&"forms"!==o||0!==r)&&u(t[0]),"tables"==r?(Q(),T("table",t[0]),c(o)):"dashboards"==r?V():"forms"==r&&(T("table-view",t[0]),c(o))}const he="treeSidebar => onItemClick";function pe(t){const e=$$("editTableFormProperty"),n=e.getValues(),o=function(){let t;return $$("tables").isVisible()?t=$$("table").config.idTable:$$("forms").isVisible()&&(t=$$("table-view").config.idTable),t}();function r(){try{e.config.dirty=!1,e.refresh()}catch(t){l(t,he,"setDirtyProperty")}}function a(){try{const t=$$("table-saveNewBtn"),e=$$("table-saveBtn"),n=$$("table-delBtnId");t.isVisible()?t.hide():e.isVisible()&&e.hide(),n.disable()}catch(t){l(t,he,"setDefaultStateBtns")}}function s(){try{j().forEach((function(t,e){let n;$$("table").getColumns().forEach((function(e,i){e.id==t.nameCol&&(n=e.label)})),i("error",t.textError+" (Поле: "+n+")")}))}catch(t){l(t,he,"validateError")}}function u(t){const e=$$("tree");e&&e.select(t)}if(e.config.dirty)return function(){const d=$$("table-saveBtn");m().then((function(f){1==f?(a(),function(){try{e&&e.isVisible()&&(e.clear(),e.hide())}catch(t){l(t,he,"setDirtyProperty")}}(),r(),$$("tree").select(t)):2==f&&(d.isVisible()?function(){if(j().length)s();else if(n.id){const e="/init/default/api/"+o+"/"+n.id,a=function(t){let e={};return Object.values(t).forEach((function(n,i){!function(n){try{let i=$$("table").getItem(t.id),o=Object.keys(i),r=Object.keys(t)[n],a=Object.values(t)[n];o.forEach((function(t){t==r&&i[t]!==a&&(e[r]=a)}))}catch(t){l(t,he,"compareVals")}}(i)})),e}(n),s=webix.ajax().put(e,a);s.then((function(e){"i"==(e=e.json()).err_type?(r(),h($$("propertyRefbtnsContainer")),u(t),i("success","Данные успешно добавлены",o)):l(e.err,"sidebar","onItemClick => putData")})),s.fail((function(t){c(t,"sidebar","onItemClick => putData")}))}}():function(){if(j().length)s();else{const e="/init/default/api/"+o,a=webix.ajax().post(e,n);a.then((function(e){if(null!==(e=e.json()).content.id)r(),h($$("propertyRefbtnsContainer")),u(t),i("success","Данные успешно добавлены",o);else{const t=e.content.errors;let n="";Object.values(t).forEach((function(e,i){n+=e+" (Поле: "+Object.keys(t)[i]+"); "})),i("error",n)}"i"!==e.err_type&&l(e.err,"sidebar","onItemClick => postNewData")})),a.fail((function(t){c(t,"sidebar","onItemClick => postNewData")}))}}(),r()),0!==f&&h($$("propertyRefbtnsContainer"))}))}(),!1;a()}const be="treeSidebar => onBeforeSelect",$e="treeSidebar => onBeforeOpen";function me(){return{view:"edittree",id:"tree",css:"webix_tree-main",minWidth:100,width:250,editable:!1,select:!0,editor:"text",editValue:"value",activeTitle:!0,clipboard:!0,data:[],on:{onSelectChange:function(t){fe(t)},onItemClick:function(t){return pe(t)},onBeforeSelect:function(t){!function(t){const i=$$("tree").getItem(t),o=$$("filterTableForm"),r=$$("inputsFilter");if(t.includes("q-none_data-tree_")||t.includes("q-load_data-tree_")||i.webix_kids)return!1;!function(){const t=document.querySelector(".webix_btn-filter"),e="webix-transparent-btn--primary";t&&t.classList.contains(e)&&(t.classList.add("webix-transparent-btn"),t.classList.remove(e))}(),function(){try{o&&o.isVisible()&&(o.hide(),ue(),f($$("table-editForm"))),r&&h(r)}catch(t){l(t,be,"setFilterDefaultState")}}(),h($$("propertyRefbtnsContainer")),d($$("editTableFormProperty")),function(){const t=$$("viewTools"),e=$$("formsContainer");d(t),f(e)}(),function(){const t=$$("dashboard-tool-main"),e=$$("dashboardInfoContainer");d(t),f(e)}(),d($$("table-backTableBtn")),d($$("table-editForm")),f($$("tableContainer")),async function(){e.fields||await n("fields");const i=e.fields.content,o=Object.keys(i);!function(){try{o.forEach((function(e){e==t&&(d($$("webix__none-content")),h($$("webix__null-content")),"dbtable"==i[e].type?(f($$("tables")),T("table",t)):"tform"==i[e].type?(f($$("forms")),T("table-view",t)):"dashboard"==i[e].type&&(f($$("dashboards")),V(t)))}))}catch(t){l(t,be,"generateItem")}}()}()}(t)},onLoadError:function(t){c(t,"sidebar","onLoadError")},onBeforeOpen:function(t){!function(t){const i=$$("tree"),o=$$("tree").getItem(t),r="q-load_data-tree_"+webix.uid(),a="q-none_data-tree_"+webix.uid();-1===$$("tree").getItem(t).$count&&(i.data.add({id:r,disabled:!0,value:"Загрузка ..."},0,t),i.addCss(r,"tree_load-items"),async function(){e.fields||await n("fields");const s=e.fields.content,c=Object.keys(s);function u(t=!1){try{i.exists(r)&&i.remove(r),i.exists(a)&&t&&i.remove(a)}catch(t){l(t,$e,"removeTreeEls")}}if(o.action.includes("all_")){const n=o.action.indexOf("_");!function(n){let o=!1;try{c.forEach((function(r){s[r].type!=n||function(t){let n=!1;try{e.mmenu.mmenu.forEach((function(e,i){e.name==t&&(n=!0)}))}catch(t){l(t,$e,"findNotUniqueItem")}return n}(r)||(i.data.add({id:r,value:s[r].plural?s[r].plural:s[r].singular,type:s[r].type},0,t),o||(o=!0),u(!0))})),o||(u(),i.exists(a)||(i.data.add({id:a,disabled:!0,value:"Раздел пуст"},0,t),i.addCss(a,"tree_none-items")))}catch(t){l(t,$e,"generateMenuData")}}(o.action.slice(n+1))}}())}(t)},onAfterSelect:function(t){!function(t){!async function(){if(e.mmenu||await n("fields"),e.fields)try{Backbone.history.navigate("tree/"+t,{trigger:!0})}catch(t){l(t,"treeSidebar => onAfterSelect","getFields")}}(),function(){try{window.innerWidth<850&&$$("tree").hide()}catch(t){l(t,"treeSidebar => onAfterSelect","setAdaptiveState")}}()}(t)}}}}function ge(){window.addEventListener("resize",(function(t){!async function(){e.mmenu||await n("mmenu"),e.mmenu&&e.mmenu.mmenu.forEach((function(t,e){var n;$$(t.name)&&$$(t.name).isVisible()&&("forms"==(n=t.name)?function(){const t=$$("formsTools"),e=$$("formsContainer"),n=$$("formsTools-resizer"),i=$$("table-backFormsBtnFilter");window.innerWidth<850&&t.isVisible()&&(t.config.width=window.innerWidth-45,t.resize(),d(e),d(n),d(tree),f(i)),window.innerWidth>850&&t.isVisible()&&350!==t.config.width&&(t.config.width=350,t.resize(),f(n),f(e),d(i))}():"dashboards"==n?function(){const t=$$("dashboard-tool-main"),e=$$("dashboardInfoContainer"),n=$$("tree"),i=$$("dash-backDashBtn");window.innerWidth<850&&t.isVisible()&&(t.config.width=window.innerWidth-45,t.resize(),d(e),d(n),f(i)),window.innerWidth>850&&t.isVisible()&&350!==t.config.width&&(t.config.width=350,t.resize(),f(e),d(i))}():"tables"==n&&(function(){const t=$$("tableContainer"),e=$$("table-editForm"),n=$$("table-backTableBtn"),i=$$("tree");$$("container").$width<850&&e.isVisible()&&d(i),window.innerWidth<850&&e.isVisible()&&(e.config.width=window.innerWidth-45,e.resize(),d(t),d(i),f(n)),window.innerWidth>850&&e.isVisible()&&350!==e.config.width&&(e.config.width=350,e.resize(),f(t),d(n))}(),function(){const t=$$("filterTableForm"),e=$$("tableContainer"),n=$$("table-backTableBtnFilter"),i=$$("tree");window.innerWidth<850&&t.isVisible()&&(t.config.width=window.innerWidth-45,t.resize(),d(e),d(i),f(n)),$$("container").$width<850&&t.isVisible()&&d(i),window.innerWidth>850&&t.isVisible()&&350!==t.config.width&&(t.config.width=350,t.resize(),f(e),d(n))}()))}))}(),function(){const t=$$("tree");window.innerWidth<850&&d(t),!t.isVisible()&&window.innerWidth<=800&&d($$("sideMenuResizer")),window.innerWidth>850&&$$("tree")&&function(){try{t&&(t.config.width=250,t.resize())}catch(t){l(t,"adaptive","resizeSidebar => resizeTree")}}()}(),window.innerWidth>850&&$$("header").getChildViews().forEach((function(t){t.config.id.includes("search")&&t.show()}))}),!0)}console.log("expa 1.0.42");try{webix.ready((function(){webix.protoUI({name:"edittree"},webix.EditAbility,webix.ui.tree),webix.ui({view:"scrollview",type:"clean",id:"layout",css:"layoutContainer",scroll:"y",body:{cells:[{},{hidden:!0,id:"userAuth",cols:[{view:"align",align:"middle,center",body:(ce(),{view:"form",id:"formAuth",width:250,borderless:!0,elements:[{view:"text",label:"Логин",name:"username",invalidMessage:"Поле должно быть заполнено",on:{onItemClick:function(){$$("formAuth").clearValidation()}}},{view:"text",label:"Пароль",name:"password",invalidMessage:"Поле должно быть заполнено",type:"password",on:{onItemClick:function(){$$("formAuth").clearValidation()}}},{view:"button",value:"Войти",css:"webix_primary",hotkey:"enter",align:"center",click:function(){let e=$$("formAuth").getValues(),n={};try{$$("formAuth").validate(),n.un=e.username,n.np=e.password,webix.ajax().post("/init/default/login",n,{success:function(e,n,i){webix.ajax("/init/default/api/whoami",{success:function(e,n,i){try{let e={};e.id=n.json().content.id,e.name=n.json().content.first_name,e.username=n.json().content.username,t("user",JSON.stringify(e)),$$("formAuth")&&$$("formAuth").clear(),Backbone.history.navigate("content",{trigger:!0}),window.location.reload()}catch(t){console.log(t),a("007-005",t)}},error:function(t,e,n){$$("formAuth")&&$$("formAuth").isDirty()&&($$("formAuth").markInvalid("username",""),$$("formAuth").markInvalid("password","Неверный логин или пароль")),s("007-006",n.status,n.statusText,n.responseURL)}}).then((function(t){}))},error:function(t,e,n){webix.message({type:"error",expire:3e3,text:"Не удалось выполнить выход"}),s("007-006",n.status,n.statusText,n.responseURL)}}).catch((t=>{console.log(t),s("007-006",t.status,t.statusText,t.responseURL)}))}catch(t){console.log(t),a("007-000",t)}}}],rules:{username:webix.rules.isNotEmpty,password:webix.rules.isNotEmpty},elementsConfig:{labelPosition:"top"}})}]},{hidden:!0,id:"mainLayout",rows:[{id:"mainContent",css:"webix_mainContent",cols:[{rows:[le(),{id:"adaptive",rows:[]},{cols:[me(),{id:"sideMenuResizer",view:"resizer",css:"webix_resizer-hide"},{id:"container",cols:[{view:"align",align:"middle,center",id:"webix__none-content",body:{borderless:!0,template:"Выберите элемент дерева",height:50,width:210,css:{color:"#858585","font-size":"14px!important"}}}]}]}]}]},{view:"resizer",id:"log-resizer"},r]}]}}),ge(),window.location.host.includes("localhost:3000")?Backbone.history.start({pushState:!0,root:"/index.html/"}):Backbone.history.start({pushState:!0,root:"/init/default/spaw/"}),function(){const t=$$("tree");window.innerWidth<850&&t&&t.hide(),function(){if(window.innerWidth<1200){const e=$$("editTableBarContainer");t.attachEvent("onAfterLoad",(function(){d(e)})),d(e)}}()}(),webix.editors.customDate=webix.extend({render:function(){return webix.html.create("div",{class:"webix_dt_editor"},"<input class='webix_custom-date-editor' id='custom-date-editor' type='text'>")}},webix.editors.text),function(){let t=null;webix.event(document.body,"mousedown",(e=>{const n=$$(e);n&&n.getInputNode&&(t=n)})),webix.event(document,"click",(e=>{const n=$$(e);t&&n&&n.config.id!==t.config.id&&(e.cancelBubble=!0,webix.html.preventEvent(e)),t=null}),{capture:!0})}(),function(){const e=webix.ajax("/init/default/api/userprefs/");e.then((function(e){const n=webix.storage.local.get("user");e=e.json().content,n&&(function(){try{e.forEach((function(e,i){e.owner!=n.id||e.name.includes("fav-link_")||t(e.name,e.prefs)}))}catch(t){l(t,"storageSettings","setDataToStorage")}}(),function(){if("/index.html/content"==window.location.pathname||"/init/default/spaw/content"==window.location.pathname){const t=webix.storage.local.get("userprefsWorkspaceForm"),e=webix.storage.local.get("userLocationHref"),n=new URL(e.href);t&&t.LoginActionOpt&&n.origin==window.location.origin&&!n.pathname.includes("logout")&&function(t,e){try{2==e.LoginActionOpt&&t&&t.href&&t.href!==window.location.href&&window.location.replace(t.href)}catch(t){l(t,"storageSettings","setLoginActionPref")}}(e,t)}}())})),e.fail((function(t){c(t,"storageSettings","setUserPrefs")})),function(){const t=webix.storage.local.get("userprefsWorkspaceForm"),e=$$("logLayout"),n=$$("webix_log-btn");try{t&&void 0!==t.logBlockOpt&&("2"==t.logBlockOpt?(e.config.height=5,n.config.icon="icon-eye"):"1"==t.logBlockOpt&&(e.config.height=90,n.config.icon="icon-eye-slash"),e.resize(),n.refresh())}catch(t){l(t,"storageSettings","userprefsWorkspace")}}()}(),window.addEventListener("popstate",(function(t){window.location.replace(window.location.href),window.location.reload()})),function(){let t;function e(){const t=webix.ajax().get("/init/default/api/userprefs/");t.then((function(t){"i"!==t.err_type&&l(t.json().err,"autoLogout","putUserPrefs"),t=t.json().content;let e=!1,n={};n.href=window.location.href;let o={name:"userLocationHref",prefs:n};"/index.html/content"!==window.location.pathname&&(function(){try{t.forEach((function(t,n){if("userLocationHref"==t.name){e=!0;const n=webix.ajax().put("/init/default/api/userprefs/"+t.id,o);n.then((function(t){"i"!==(t=t.json()).err_type&&i("error",t.err)})),n.fail((function(t){c(t,"autoLogout","putUserPrefs")}))}}))}catch(t){l(t,"autoLogout","putUserPrefs")}}(),e||(function(){let t=webix.storage.local.get("user").id;try{if(t)o.owner=t;else{const t=webix.ajax("/init/default/api/whoami");t.then((function(t){o.owner=t.json().content.id;let e={};e.id=t.json().content.id,e.name=t.json().content.first_name,e.username=t.json().content.username})),t.fail((function(t){c(t,"autoLogout","getWhoamiData")}))}}catch(t){l(t,"autoLogout","getWhoamiData")}}(),function(){const t=webix.ajax().post("/init/default/api/userprefs/",o);t.then((function(t){"i"!==(t=t.json()).err_type&&l(t.err,"autoLogout","putUserPrefs")})),t.fail((function(t){c(t,"autoLogout","postUserPrefs")}))}()))})),t.then((function(t){Backbone.history.navigate("logout",{trigger:!0})})),t.fail((function(t){c(t,"autoLogout","logout")}))}function n(){try{"/index.html"!==window.location.pathname&&"/"!==window.location.pathname&&"/init/default/spaw"!==window.location.pathname&&(clearTimeout(t),t=setTimeout(e,6e5))}catch(t){l(t,"autoLogout","resetTimer")}}window.onload=n,window.onmousemove=n,window.onmousedown=n,window.ontouchstart=n,window.onclick=n,window.onkeypress=n,window.addEventListener("scroll",n,!0)}(),webix.message.position="bottom",webix.i18n.setLocale("ru-RU"),webix.i18n.parseFormat="%d.%m.%Y %H:%i:%s",webix.i18n.setLocale(),webix.Date.startOnMonday=!0}))}catch(t){console.log(t),alert("Ошибка при выполнении "+t),a("007-005",t)}})();