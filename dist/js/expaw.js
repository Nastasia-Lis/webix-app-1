(()=>{"use strict";const e={id:"dashboardTool",css:"webix_dashTool",rows:[]};function t(e,t){"undefined"!=typeof Storage&&localStorage.setItem(e,t)}function i(e,i,n=!1){try{let o,r,s=(i=window.location.href).slice(i.lastIndexOf("/")+1);e&&e.forEach((function(e,t){e.id==s&&(o=e.name)})),r={tableName:o,tableId:s,href:i,autoLogout:n},t("userLocation",JSON.stringify(r))}catch(e){console.log(e),s("010-000",e)}}function n(e,i){const n=new Date;let o=`${n.getDate()}.${String(n.getMonth()+1).padStart(2,"0")}.${n.getFullYear()} ${n.getHours()}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`;try{let n,r=null;if(void 0!==$$("tree").getSelectedItem()&&(r=$$("tree").getSelectedItem().id,r.includes("single"))){let e=r.search("-single");r=r.slice(0,e)}if(r){let e;O.forEach((function(t,i){t.id==r&&(e=t.name)})),$$("logBlock-list").add({date:o,value:i,src:e})}else $$("logBlock-list").add({date:o,value:i,src:"Expa v1.0.24"});let s=document.querySelector(".webix_log-block");s&&s.querySelectorAll(".webix_list_item").forEach((function(e,t){n=t}));let l=document.querySelectorAll(".webix_list_item")[n];"error"==e&&(void 0!==l&&l.style.setProperty("color","red","important"),"wxi-eye"==$$("webix_log-btn").config.icon&&($$("logLayout").config.height=90,$$("logLayout").resize(),$$("webix_log-btn").setValue(2),$$("webix_log-btn").config.icon="wxi-eye-slash",$$("webix_log-btn").refresh(),t("LogVisible",JSON.stringify("show"))))}catch(e){console.log(e),s("006-000",e)}}let o=0;const r={id:"logLayout",height:80,rows:[{template:"<div class='webix_log-headline'>Системные сообщения</div>",height:30},{id:"logBlock-list",css:"webix_log-block",view:"list",template:"#date# — #value#  (Источник: #src#)",data:[],on:{onAfterLoad:function(){try{n("success","Интерфейс загружен")}catch(e){console.log(e),s("006-000",e)}},onAfterAdd:function(e,t){"wxi-eye"==$$("webix_log-btn").config.icon?(""==$$("webix_log-btn").config.badge&&(o=0),o++,$$("webix_log-btn").config.badge=o,$$("webix_log-btn").setValue(1),$$("webix_log-btn").refresh()):"wxi-eye-slash"==$$("webix_log-btn").config.icon&&(o=0,$$("webix_log-btn").config.badge="",$$("webix_log-btn").setValue(2),$$("webix_log-btn").refresh())}}}]};function s(e,t,i=!1){return $$("webix_log-btn").setValue(2),o=0,n("error",i?"ОШИБКА "+e+": "+t:"ОШИБКА "+e+": "+t.stack)}function l(e,t,i,r){return $$("webix_log-btn").setValue(2),o=0,n("error","ОШИБКА "+e+": СТАТУС: "+t+" "+i+". ПОДРОБНОСТИ: "+r)}let a,c,u,d=!1;function h(e,t,i,o){let r=[];if("get"==i)if("refresh"==o)try{e.forEach(((e,t)=>{e.id.includes("customCombo")?r.push(e.name+"="+$$(e.id).getText()):(e.id.includes("customInputs")||e.id.includes("customDatepicker"))&&r.push(e.name+"="+$$(e.id).getValue())})),webix.ajax(t+"?"+r.join("&"),{success:function(e,t,i){try{$$("table-view").clearAll(),0!==(t=t.json().content).length?($$("table-view").hideOverlay("Ничего не найдено"),$$("table-view").parse(t)):$$("table-view").showOverlay("Ничего не найдено"),a=$$("table-view").count(),$$("table-view-findElements").setValues(a.toString())}catch(e){console.log(e),s("009-000",e)}},error:function(e,t,i){l("009-000",i.status,i.statusText,i.responseURL),$$("table-newAddBtnId")&&!$$("table-newAddBtnId").isEnabled()&&$$("table-newAddBtnId").enable()}}).catch((e=>{console.log(e),l("009-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),s("009-000",e)}else"download"==o&&webix.ajax().response("blob").get(t,(function(e,t,i){try{webix.html.download(t,"table.docx")}catch(e){console.log(e),s("009-000",e)}})).catch((e=>{console.log(e),l("009-000",e.status,e.statusText,e.responseURL)}));else if("post"==i)try{e.forEach(((e,t)=>{e.id.includes("customUploader")&&$$(e.id).send((function(t){"e"==t.err_type?($$("table-view").parse($$(e.id).getValue()),n("error",t.err)):"i"==t.err_type?(n("success",t.err),$$("table-view").refresh()):"x"==t.err_type&&n("debug",t.err)}))}))}catch(e){console.log(e),s("009-000",e)}}function p(e){return new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get("/init/default/api/"+e).then((function(e){try{e=e.json().content;let t,i=[];return e.forEach(((e,n)=>{let o=0;for(;o<=Object.values(e).length;){if("string"==typeof Object.values(e)[o]){t=Object.keys(e)[o];break}o++}if(null==e[t])for(;o<=Object.values(e).length;){if("number"==typeof Object.values(e)[1]){t=Object.keys(e)[1];break}o++}i.push({id:e.id,value:e[t]})})),i}catch(e){console.log(e),s("009-000",e)}})).catch((e=>{console.log(e),l("009-000",e.status,e.statusText,e.responseURL)}))}}})}function f(e,t,i,o,r=!1){let c=i,u=$$("tree").getItem(i),f=$$("table-view-filterIdView").getParentView();try{if($$(e).clearAll(),null==u)n("error","Данные не найдены");else{let t;"table-view"==e&&($$("contextActionsPopup")&&$$("contextActionsPopup").destructor(),$$("contextActionsBtnAdaptive")&&f.removeView($$("contextActionsBtnAdaptive")),$$("customInputs")&&$$("customInputs").getParentView().removeView($$("customInputs")),$$("customInputsMain")&&$$("customInputsMain").getParentView().removeView($$("customInputsMain"))),webix.ajax().get("/init/default/api/fields.json").then((function(n){let u=n.json().content;if(n.treeTemplate={fields:{id:{type:"id",unique:!1,notnull:!1,length:512,label:"Id",comment:null,default:"None"},pid:{type:"reference trees",unique:!1,notnull:!1,length:512,label:"Родитель",comment:null,default:"None"},owner:{type:"reference auth_user",unique:!1,notnull:!1,length:512,label:"Владелец",comment:null,default:"None"},ttype:{type:"integer",unique:!1,notnull:!1,length:512,label:"Тип",comment:"Тип записи|1=системная;2=пользовательская|Перечисление",default:"1"},name:{type:"string",unique:!1,notnull:!1,length:100,label:"Наименование",comment:null,default:""},descr:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Описание",comment:null,default:""},value:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Значение",comment:null,default:""},cdt:{type:"datetime",unique:!1,notnull:!1,length:512,label:"Создано",comment:null,default:"now"}},singular:"Классификатор-пример",ref_name:"name",plural:"Классификаторы-пример",type:"treeConf"},r){let e=i.search("-single");i=i.slice(0,e)}let b,$,g=(n=u[i]).fields,m=Object.keys(n.fields),w=[];try{m.forEach((function(e){if(g[e].type.includes("reference")){let t=g[e].type.slice(10);g[e].editor="combo",g[e].collection=p(t),g[e].template=function(e,t,i,n){let o=n.collection.getItem(e[n.id]);return o?o.value:""}}else"datetime"==g[e].type?(g[e].format=webix.i18n.fullDateFormatStr,g[e].editor="date"):"string"==g[e].type||"text"==g[e].type?g[e].editor="text":"integer"==g[e].type?(g[e].editor="text",g[e].numberFormat="1 111"):"boolean"==g[e].type&&(g[e].editor="combo",g[e].collection=[{id:1,value:"Да"},{id:2,value:"Нет"}]);g[e].id=e,g[e].fillspace=!0,g[e].header=g[e].label,"id"==g[e].id&&(g[e].hidden=!0),w.push(g[e])})),$$(e).refreshColumns(w)}catch(e){console.log(e),s("009-000",e)}d=!1;try{w.forEach((function(e,t){"action"==e.type&&"detail"==n.actions[e.id].rtype&&(d=!0,b=t,$=e.id)})),void 0!==$&&d&&($$(e).config.columns.splice(0,0,{id:"action-first"+b,maxWidth:130,header:"Подробнее",template:"<span class='webix_icon wxi-angle-down'></span> "}),$$(e).refreshColumns())}catch(e){console.log(e),s("009-000",e)}try{if($$("contextActionsBtn")&&$$(f.config.id).removeView($$("contextActionsBtn")),n.inputs){let i=Object.keys(n.inputs),o=[],r=[],a=n.inputs;if(i.forEach(((t,i)=>{if("string"==a[t].type)o.push({view:"text",placeholder:a[t].label,id:"customInputs"+i,height:48,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",a[t].comment)}}});else if("apiselect"==a[t].type){let e=new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get("/init/default/api/"+a[t].apiname).then((function(e){let t=e.json().content,i=[];try{return void 0!==t[0].name?t.forEach((function(e,t){i.push({id:t+1,value:e.name})})):t.forEach((function(e,t){i.push({id:t+1,value:e})})),i}catch(e){console.log(e),s("009-000",e)}})).catch((e=>{console.log(e),l("009-000",e.status,e.statusText,e.responseURL)}))}}});o.push({view:"combo",height:48,id:"customCombo"+i,placeholder:a[t].label,labelPosition:"top",options:{data:e},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",a[t].comment)}}})}else if("submit"==a[t].type||"button"==a[t].type){let s=a[t].action,l=n.actions[s];if("DELETE"==l.verb&&"submit"!==s){let t=$$(e).getColumns().length;$$(e).config.columns.splice(t,0,{id:"action"+i,header:"Действие",maxWidth:100,template:"{common.trashIcon()}"}),$$(e).refreshColumns()}else"DELETE"==l.verb?o.push({view:"button",id:"customBtnDel"+i,css:"webix_danger",type:"icon",icon:"wxi-trash",inputHeight:48,height:48,value:a[t].label,click:function(e){h(r,l.url,"delete")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",a[t].comment)}}}):o.push({view:"button",css:"webix_primary",id:"customBtn"+i,inputHeight:46,height:46,value:a[t].label,click:function(e){"GET"==l.verb?"refresh"==l.rtype?h(r,l.url,"get","refresh"):"download"==l.rtype&&h(r,l.url,"get","download"):"POST"==l.verb?h(r,l.url,"post"):"download"==l.verb&&h(r,l.url,"get","download"),$$("contextActionsPopup")&&$$("contextActionsPopup").hide()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",a[t].comment)}}})}else"upload"==a[t].type?o.push({view:"uploader",value:"Upload file",id:"customUploader"+i,height:48,autosend:!1,upload:n.actions.submit.url,label:a[t].label,labelPosition:"top",click:function(){$$("contextActionsPopup")&&$$("contextActionsPopup").destructor()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",a[t].comment)}}}):"datetime"==a[t].type?o.push({view:"datepicker",format:"%d.%m.%Y %H:%i:%s",placeholder:a[t].label,id:"customDatepicker"+i,timepicker:!0,labelPosition:"top",height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",a[t].comment)}}}):"checkbox"==a[t].type&&o.push({view:"checkbox",id:"customСheckbox"+i,css:"webix_checkbox-style",labelRight:a[t].label,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",a[t].comment)}}})})),o.forEach(((e,t)=>{void 0!==e.id&&("text"==e.view?r.push({id:e.id,name:"substr"}):"combo"==e.view?r.push({id:e.id,name:"valtype"}):("uploader"==e.view||"datepicker"==e.view)&&r.push({id:e.id}))})),window.innerWidth>830){o.forEach((function(e,t){"text"==e.view&&(e.maxWidth=300,e.minWidth=150),"combo"==e.view&&(e.width=250),"button"==e.view&&"wxi-trash"==e.icon&&(e.width=100),"button"==e.view&&"webix_primary"==e.css&&(e.maxWidth=550,e.minWidth=100),"datepicker"==e.view&&(e.width=300,e.minWidth=100),"checkbox"==e.view&&(e.minWidth=220)})),t={id:"customInputs",css:"webix_custom-inp",cols:o};let e=$$("table-view-filterIdView").getParentView();$$(e.config.id).addView({id:"customInputsMain",cols:[t]},2)}else o.forEach((function(e,t){e.bottomPadding=10})),o.push({}),t={id:"customInputs",css:"webix_custom-inp",rows:o},$$(f.config.id).addView({view:"button",id:"contextActionsBtn",maxWidth:100,value:"Действия",css:"webix_primary",popup:webix.ui({view:"popup",css:"webix_popup-actions-container webix_popup-config",modal:!0,id:"contextActionsPopup",escHide:!0,position:"center",body:{rows:[{cols:[{template:"Доступные действия",css:"webix_template-actions",borderless:!0,height:40},{view:"button",id:"buttonClosePopupActions",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("contextActionsPopup")&&$$("contextActionsPopup").hide()}}]},{view:"scrollview",borderless:!0,scroll:"y",body:{id:"contextActionsPopupContainer",css:"webix_context-actions-popup",rows:[t]}}]}}),click:function(){$$("contextActionsPopup").config.height!==$$("customInputs").$height+50&&($$("contextActionsPopup").config.height=$$("customInputs").$height+50,$$("contextActionsPopup").resize());let e=window.innerWidth-100;$$("contextActionsPopup").$width>200&&($$("contextActionsPopup").config.width=e,$$("contextActionsPopup").resize())}},2)}}catch(e){console.log(e),s("009-000",e)}function v(t){$$(t).load({$proxy:!0,load:function(t,i){return webix.ajax().get("/init/default/api/"+c,{success:function(t,i,n){try{$$(e).clearAll(),$$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable(),$$("table-filterId").isEnabled()||$$("table-filterId").enable(),$$("table-exportBtn").isEnabled()||$$("table-exportBtn").enable(),0!==(i=i.json().content).length?($$(e).hideOverlay("Ничего не найдено"),$$(e).parse(i)):($$(e).showOverlay("Ничего не найдено"),$$(e).clearAll()),a=$$(e).count(),$$(o).setValues(a.toString()),"table"==e&&$$("table-findElements").setValues(a.toString())}catch(e){console.log(e),s("009-000",e)}},error:function(e,t,i){l("009-000",i.status,i.statusText,i.responseURL),a="-";try{$$(o).setValues(a.toString()),$$("table-findElements").setValues(a.toString()),$$("table-newAddBtnId").isEnabled()&&$$("table-newAddBtnId").disable(),$$("table-filterId")&&$$("table-filterId").disable(),$$("table-exportBtn")&&$$("table-exportBtn").disable()}catch(e){console.log(e),s("009-000",e)}}}).catch((e=>{console.log(e),l("009-000",e.status,e.statusText,e.responseURL)}))}})}if(r&&(c=i),"dbtable"==n.type?v("table"):"tform"==n.type&&v("table-view"),n.autorefresh){let e=webix.storage.local.get("userprefsOtherForm");void 0!==e.autorefCounterOpt&&(e.autorefCounterOpt>=15e3?setInterval((function(){"dbtable"==n.type?v("table"):"tform"==n.type&&v("table-view")}),e.autorefCounterOpt):setInterval((function(){"dbtable"==n.type?v("table"):"tform"==n.type&&v("table-view")}),12e4))}})).catch((e=>{console.log(e),e.status?l("009-000",e.status,e.statusText,e.responseURL):s("009-000",e),$$("btnFilterSubmit")&&$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").disable()}))}}catch(e){console.log(e),s("009-000",e)}}function b(e,t=!1){let i=$$("tree").getSelectedItem().id;function o(e,t,o=!1){webix.ajax().get(e,{success:function(r,l,a){let c=[{type:"wide",rows:[]}],u=l.json().charts,d={};try{if($$("dashBodyScroll")&&$$("dashBodyScroll").getParentView().removeView($$("dashBodyScroll")),o||($$("dashboardInfoContainerInner")&&$$("dashboardInfoContainerInner").getParentView().removeView($$("dashboardInfoContainerInner")),$$("dash-template")&&$$("dash-template").getParentView().removeView($$("dash-template")),$$("dashboard-tool")&&$$("dashboard-tool").getParentView().removeView($$("dashboard-tool"))),null==u)$$("dashboardTool").addView({view:"scrollview",id:"dashboard-tool",borderless:!0,css:{margin:"20px!important",height:"50px!important"},body:{view:"flexlayout",rows:[]}},0),$$("dashboardTool").addView({rows:[{template:"",id:"dash-template",css:"webix_style-template-count webix_dash-title",borderless:!1,height:40}]},1),$$("dashboardInfoContainer").addView({view:"scrollview",scroll:"auto",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",borderless:!0,body:{view:"flexlayout",rows:[]}}]}}),n("error","Ошибка при загрузке данных");else{let e;u.forEach((function(e,t){d=e.title,delete e.title,e.borderless=!0,e.minWidth=250,c[0].rows.push({css:"webix_dash-chart-headline",rows:[{template:d,borderless:!0,css:{"font-weight":"400!important","font-size":"17px!important"},height:35},e]})})),i.includes("single")&&(i=i.slice(0,i.search("-single"))),O.forEach((function(t,n){t.id==i&&(e=t.name)})),o?$$("dashboardInfoContainerInner").addView({view:"scrollview",scroll:"auto",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",rows:c}]}}):($$("dashboardTool").addView({id:"dashboard-tool",padding:20,minWidth:250,rows:[{rows:[{template:"Фильтр",height:30,css:"webix_dash-filter-headline",borderless:!0}]},{rows:t}]}),$$("dashboardInfoContainer").addView({id:"dashboardInfoContainerInner",rows:[{template:e,id:"dash-template",css:"webix_style-template-count webix_dash-title",borderless:!1,height:75},{view:"scrollview",scroll:"auto",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",rows:c}]}}]}))}"wxi-eye"==$$("webix_log-btn").config.icon?($$("logLayout").config.height=90,$$("logLayout").resize(),$$("logLayout").config.height=5,$$("logLayout").resize()):($$("logLayout").config.height=5,$$("logLayout").resize(),$$("logLayout").config.height=90,$$("logLayout").resize()),(e.includes("?")||e.includes("sdt")&&e.includes("edt"))&&n("success","Данные обновлены")}catch(e){console.log(e),s("009-004",e)}},error:function(e,t,i){l("009-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("009-000",e.status,e.statusText,e.responseURL)}))}try{$$("dashBodyScroll")&&$$("dashBodyScroll").getParentView().removeView($$("dashBodyScroll")),$$("dashBodyScroll")||webix.ajax().get("/init/default/api/fields",{success:function(r,l,a){let c,u,d,h=[];l=l.json().content;try{if(t){let t=e.search("-single");e=e.slice(0,t)}if(Object.values(l).forEach((function(t,i){t.nameObj=Object.keys(l)[i],t.nameObj==e&&(d=t)})),t){let e=d.inputs;if(Object.keys(e),Object.values(e).forEach((function(t,i){"datetime"==t.type&&3==t.order?(Object.keys(e)[i],h.push({width:200,id:"datepicker-containersdt",rows:[{template:"Начиная с:",height:30,borderless:!0,css:"webix_template-datepicker"},{view:"datepicker",format:"%d.%m.%y",editable:!0,value:new Date,id:"dashDatepicker_sdt",placeholder:t.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",t.comment)}}},{height:10},{view:"datepicker",format:"%H:%i:%s",id:"dashDatepicker_sdt-time",placeholder:"Время",height:48,editable:!0,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}},{height:20},{template:"Заканчивая:",height:30,borderless:!0,css:"webix_template-datepicker"},{view:"datepicker",format:"%d.%m.%y",value:new Date,editable:!0,id:"dashDatepicker_edt",placeholder:t.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",t.comment)}}},{height:10},{view:"datepicker",format:"%H:%i:%s",id:"dashDatepicker_edt-time",placeholder:"Время",editable:!0,height:48,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",hotkey:"enter",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}}]})):"submit"==t.type&&(c=t.action,u=d.actions[c],h.push({rows:[{height:10},{view:"button",css:"webix_primary",id:"dashBtn"+i,inputHeight:48,height:48,minWidth:100,maxWidth:200,value:t.label,click:function(){let e,t=[],r=webix.Date.dateToStr("%d.%m.%y"),s=[],l=webix.Date.dateToStr("%H:%i:%s"),a="",c="",d=!0;if(h.forEach((function(e,t){e.id.includes("container")&&$$(e.id).getChildViews().forEach((function(e,t){e.config.id.includes("sdt")?e.config.id.includes("time")?null!==$$(e.config.id).getValue()?a=a.concat(" "+l($$(e.config.id).getValue())):d=!1:null!==$$(e.config.id).getValue()?a=r($$(e.config.id).getValue()):d=!1:e.config.id.includes("edt")&&(e.config.id.includes("time")?null!==$$(e.config.id).getValue()?c=c.concat(" "+l($$(e.config.id).getValue())):d=!1:null!==$$(e.config.id).getValue()?c=r($$(e.config.id).getValue()):d=!1)}))})),t.push("sdt="+a),t.push("edt="+c),s.push(a),s.push(c),d){let r=webix.Date.dateToStr("%Y/%m/%d %H:%i:%s");webix.filters.date.greater(r(s[0]),r(s[1]))&&s[0]!=s[1]?n("error","Начало периода больше, чем конец"):(e=u.url+"?"+t.join("&"),$$("dashboard-charts")&&$$("dashboardBody").removeView($$("dashboard-charts")),$$("dashboard-charts")||o(e,h,!0),$$("dashBtn"+i).disable(),setInterval((function(){$$("dashBtn"+i).enable()}),1e3))}else n("error","Не все поля заполнены")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",t.comment)}}},{}]}))})),o(d.actions.submit.url,h),d.autorefresh){let e=webix.storage.local.get("userprefsOtherForm");void 0!==e.autorefCounterOpt&&(e.autorefCounterOpt>=15e3?setInterval((function(){o(d.actions.submit.url,h)}),e.autorefCounterOpt):setInterval((function(){o(d.actions.submit.url,h)}),5e4))}}else{let e=l;Object.values(e).forEach((function(e,t){if("dashboard"==e.type&&e.nameObj==i){let t=e.inputs;if(Object.values(t).forEach((function(i,r){"datetime"==i.type&&3==i.order?(Object.keys(t)[r],h.push({width:200,id:"datepicker-containersdt",rows:[{template:"Начиная с:",height:30,borderless:!0,css:"webix_template-datepicker"},{view:"datepicker",format:"%d.%m.%y",editable:!0,value:new Date,id:"dashDatepicker_sdt",placeholder:i.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i.comment)},onKeyPress:function(e,t){console.log(e,t)}}},{height:10},{view:"datepicker",format:"%H:%i:%s",id:"dashDatepicker_sdt-time",placeholder:"Время",height:48,editable:!0,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",hotkey:"enter",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}},{height:20},{template:"Заканчивая:",height:30,borderless:!0,css:"webix_template-datepicker"},{view:"datepicker",format:"%d.%m.%y",editable:!0,value:new Date,id:"dashDatepicker_edt",placeholder:i.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i.comment)}}},{height:10},{view:"datepicker",format:"%H:%i:%s",id:"dashDatepicker_edt-time",placeholder:"Время",height:48,editable:!0,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",body:{button:!0,seconds:!0,twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}}]})):"submit"==i.type&&(c=i.action,u=e.actions[c],h.push({rows:[{height:10},{view:"button",css:"webix_primary",id:"dashBtn"+r,inputHeight:48,height:48,minWidth:100,maxWidth:200,value:i.label,click:function(){let e,t=[],i=webix.Date.dateToStr("%d.%m.%y"),s=[],l=webix.Date.dateToStr("%H:%i:%s"),a="",c="",d=!0;if(h.forEach((function(e,t){e.id.includes("container")&&$$(e.id).getChildViews().forEach((function(e,t){e.config.id.includes("sdt")?e.config.id.includes("time")?null!==$$(e.config.id).getValue()?a=a.concat(" "+l($$(e.config.id).getValue())):d=!1:null!==$$(e.config.id).getValue()?a=i($$(e.config.id).getValue()):d=!1:e.config.id.includes("edt")&&(e.config.id.includes("time")?null!==$$(e.config.id).getValue()?c=c.concat(" "+l($$(e.config.id).getValue())):d=!1:null!==$$(e.config.id).getValue()?c=i($$(e.config.id).getValue()):d=!1)}))})),t.push("sdt="+a),t.push("edt="+c),s.push(a),s.push(c),d){let i=webix.Date.dateToStr("%Y/%m/%d %H:%i:%s");webix.filters.date.greater(i(s[0]),i(s[1]))&&s[0]!=s[1]?n("error","Начало периода больше, чем конец"):(e=u.url+"?"+t.join("&"),$$("dashboard-charts")&&$$("dashboardBody").removeView($$("dashboard-charts")),o(e,h,!0),$$("dashBtn"+r).disable(),setInterval((function(){$$("dashBtn"+r).enable()}),1e3))}else n("error","Не все поля заполнены")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i.comment)}}},{}]}))})),o(e.actions.submit.url,h),e.autorefresh){let e=webix.storage.local.get("userprefsOtherForm");void 0!==e.autorefCounterOpt&&(e.autorefCounterOpt>=15e3?setInterval((function(){o(d.actions.submit.url,h)}),e.autorefCounterOpt):setInterval((function(){o(d.actions.submit.url,h)}),5e4))}}}))}}catch(e){console.log(e),s("009-000",e)}},error:function(e,t,i){console.log(i),l("009-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("009-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),s("009-000",e)}}function $(){$$("treeEdit").clearAll(),webix.ajax().get("/init/default/api/trees",{success:function(e,t,i){try{(t=t.json().content)[0].pid=0;let e={},i=[],n=[];t.forEach((function(e,t){0==e.pid?n.push({id:e.id,open:!0,value:e.name,pid:e.pid,data:[]}):n.push({id:e.id,value:e.name,pid:e.pid,data:[]})})),n.forEach((function(t,o){e[t.id]=o,0!==t.pid&&t.pid!==t.id&&null!==t.pid?n[e[t.pid]].data.push(t):i.push(t)})),$$("treeEdit").parse(i)}catch(e){console.log(e),s("009-004",e)}},error:function(e,t,i){l("009-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("009-000",e.status,e.statusText,e.responseURL)}))}function g(e){return webix.confirm({width:300,ok:"Да",cancel:"Отмена",title:e,text:"Вы уверены, что хотите продолжить?"})}function m(){return webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"})}function w(){let e=$$("tree").getSelectedItem().id;if(0==e.length)c=void 0;else{if(e.includes("-single")){let t=e.search("-single");e=e.slice(0,t)}c=e}}function v(e=!1){try{w();let t=$$("table-editForm").getValues();$$("table-editForm").validate()?t.id&&webix.ajax().put("/init/default/api/"+c+"/"+t.id,t,{success:function(i,o,r){o=o.json(),$$("table").updateItem(t.id,t),_(),A(),$$("table").clearSelection(),e?($$("table").filter(!1),x("table-editForm"),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show()):($$("inputsTable")&&$$("inputsTable").hide(),$$("table-newAddBtnId").enable(),$$("EditEmptyTempalte")&&!$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").show()),"i"==o.err_type&&n("success","Данные сохранены"),"e"==o.err_type&&n("error",o.error)},error:function(e,t,i){l("003-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("003-011",e.status,e.statusText,e.responseURL)})):n("error","Заполните пустые поля")}catch(e){s("003-000",e)}}function y(){try{if(w(),$$("table-editForm").validate())if($$("table-editForm").isDirty()){let e=$$("table-editForm").getValues();e.id=webix.uid(),webix.ajax().post("/init/default/api/"+c,e,{success:function(t,i,o){i=i.json(),$$("table").add(e),_(),A(),$$("inputsTable")&&$$("inputsTable").hide(),$$("table-newAddBtnId").enable(),$$("EditEmptyTempalte")&&!$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").show(),"i"==i.err_type?n("success","Данные успешно добавлены"):"e"==i.err_type&&n("error",i.error)},error:function(e,t,i){l("003-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("003-001",e.status,e.statusText,e.responseURL)}))}else webix.message({type:"debug",expire:1e3,text:"Форма пуста"});else n("error","Заполните пустые поля")}catch(e){s("003-000",e)}}function x(e,t=1){try{let i=$$("table").getColumns();if(0==Object.keys($$(e).elements).length){let o=[];i.forEach(((t,i)=>{if("datetime"==t.type)o.push({view:"datepicker",format:"%d.%m.%Y %H:%i:%s",id:t.id,name:t.id,label:t.label,placeholder:"дд.мм.гг",timepicker:!0,labelPosition:"top",on:{onItemClick:function(){$$(e).clearValidation()}}});else if(t.type.includes("reference")){let i,r=t.type.slice(10);O.forEach((function(e,t){e.id==r&&(i=e.name)})),o.push({cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id,name:t.id,labelPosition:"top",options:{data:p(r)},on:{onItemClick:function(){$$(e).clearValidation()}}},{view:"button",css:{"vertical-align":"bottom!important",height:"38px!important"},type:"icon",icon:"wxi-angle-right",inputHeight:38,width:40,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Перейти в таблицу «"+i+"»")}},click:function(){try{$$("tree").select(r)}catch(e){console.log(e),n("error","Таблица не найдена"),$$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide()}}}]})}else t.type.includes("boolean")?o.push({cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id,name:t.id,labelPosition:"top",options:[{id:1,value:"Да"},{id:2,value:"Нет"}],on:{onItemClick:function(){$$(e).clearValidation()}}}]}):t.type.includes("integer")?o.push({cols:[{view:"text",name:t.id,id:t.id,label:t.label,labelPosition:"top",invalidMessage:"Поле поддерживает только числовой формат",on:{onKeyPress:function(){$$(e).clearValidation()}},validate:function(e){return!isNaN(1*e)}}]}):o.push({view:"text",name:t.id,id:t.id,label:t.label,labelPosition:"top",on:{onKeyPress:function(){$$(e).clearValidation()}}})}));let r={margin:8,id:"inputsTable",rows:o};return"table-editForm"==e&&$$("table-delBtnId").enable(),$$(e).addView(r,t)}$$(e).clear(),$$(e).clearValidation(),"table-editForm"==e&&$$("table-delBtnId").enable(),$$("inputsTable").show()}catch(e){s("003-000",e)}}function _(){$$("table-editForm").clear(),$$("table-editForm").clearValidation(),A()}function A(){$$("table-saveNewBtn").isVisible()?$$("table-saveNewBtn").hide():$$("table-saveBtn").isVisible()&&$$("table-saveBtn").hide(),$$("table-delBtnId").disable()}try{u={view:"form",id:"table-editForm",css:"webix_form-edit",minHeight:350,minWidth:210,width:320,scroll:!0,elements:[{minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{margin:5,rows:[{margin:5,cols:[{view:"button",id:"table-newAddBtnId",height:48,minWidth:90,hotkey:"shift",value:"Новая запись",click:function(){try{$$("table-editForm").isDirty()?m().then((function(e){if(1==e)$$("table").filter(!1),x("table-editForm"),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show();else if(2==e){if(!$$("table-editForm").validate())return n("error","Заполните пустые поля"),!1;v(!0)}})):($$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide(),$$("table").clearSelection(),$$("table").filter(!1),$$("table").hideOverlay("Ничего не найдено"),x("table-editForm"),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show(),$$("table-newAddBtnId").disable())}catch(e){s("003-000",e)}}},{view:"button",id:"table-delBtnId",disabled:!0,height:48,minWidth:90,width:100,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"wxi-trash",click:function(){try{w(),g("Запись будет удалена").then((function(){$$("table").remove($$("table-editForm").getValues().id);let e=$$("table-editForm").getValues();webix.ajax().del("/init/default/api/"+c+"/"+e.id+".json",e,{success:function(e,t,i){t=t.json(),_(),A(),$$("inputsTable").hide(),"i"==t.err_type&&n("success","Данные успешно удалены"),"e"==t.err_type&&n("error",t.error)},error:function(e,t,i){l("003-002",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("003-002",e.status,e.statusText,e.responseURL)}))}))}catch(e){s("003-000",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить запись из таблицы")}}}]}]},{margin:10,rows:[{view:"button",id:"table-saveBtn",hidden:!0,value:"Сохранить",height:48,css:"webix_primary",click:function(){v()},hotkey:"enter"},{view:"button",id:"table-saveNewBtn",value:"Сохранить новую запись",hidden:!0,height:48,hotkey:"enter",css:"webix_primary",click:y},{id:"EditEmptyTempalte",template:"<div style='color:#858585;font-size:13px!important'>Добавьте новую запись или выберите существующую из таблицы</div>",borderless:!0}]}]}],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}}}catch(e){alert("Ошибка при выполнении "+e),console.log(e),window.stop()}function E(e,t,i,o,r,l,a,c=!1){function u(e,t,i){let o,r=e.type.slice(10);function l(n){try{if(o=$$(e.id+"_filter_rows").getChildViews().length,"text"==i)return{view:"text",placeholder:"Введите текст",name:e.id+"_filter-child-"+n+"-"+o,id:e.id+"_filter-child-"+n+"-"+o,on:{onKeyPress:function(){$$(t).clearValidation(),$$("btnFilterSubmit")&&!$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").enable()}}};if("combo"==i)return{view:"combo",name:e.id+"_filter-child-"+n+"-"+o,id:e.id+"_filter-child-"+n+"-"+o,placeholder:"Выберите вариант",options:{data:p(r)},on:{onItemClick:function(){$$(t).clearValidation(),$$("btnFilterSubmit").enable()}}};if("boolean"==i)return{view:"combo",name:e.id+"_filter-child-"+n+"-"+o,id:e.id+"_filter-child-"+n+"-"+o,placeholder:"Выберите вариант",options:[{id:1,value:"Да"},{id:2,value:"Нет"}],on:{onItemClick:function(){$$(t).clearValidation(),$$("btnFilterSubmit").enable()}}};if("datepicker"==i)return{view:"datepicker",name:e.id+"_filter-child-"+n+"-"+o,id:e.id+"_filter-child-"+n+"-"+o,format:"%d.%m.%Y %H:%i:%s",placeholder:"дд.мм.гг",timepicker:!0,on:{onItemClick:function(){$$(t).clearValidation(),$$("btnFilterSubmit").enable()}}};if("integer"==i)return{view:"text",name:e.id+"_filter-child-"+n+"-"+o,id:e.id+"_filter-child-"+n+"-"+o,invalidMessage:"Поле поддерживает только числовой формат",placeholder:"Введите число",on:{onItemClick:function(){$$(t).clearValidation(),$$("btnFilterSubmit").enable()}},validate:function(e){return!isNaN(1*e)}}}catch(e){console.log(e),s("012-000",e)}}function a(e,t){try{let i=$$(e);if(t.includes("eql"))return i.setValue("=");if(t.includes("notEqual"))return i.setValue("!=");if(t.includes("less"))return i.setValue("<");if(t.includes("more"))return i.setValue(">");if(t.includes("mrEqual"))return i.setValue(">=");if(t.includes("lsEqual"))i.setValue("<=");else if(t.includes("contains"))return i.setValue("⊆")}catch(e){console.log(e),s("012-000",e)}}function c(){return webix.once((function(){"combo"==i?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"})):"text"==i?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"содержит",id:"operations_contains"})):"datepicker"==i?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"<",id:"operations_less"}),this.add({value:">",id:"operations_more"}),this.add({value:">=",id:"operations_mrEqual"}),this.add({value:"<=",id:"operations_lsEqual"})):"integer"==i&&(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"<",id:"operations_less"}),this.add({value:">",id:"operations_more"}),this.add({value:">=",id:"operations_mrEqual"}),this.add({value:"<=",id:"operations_lsEqual"}),this.add({value:"содержит",id:"operations_contains"}))}))}return{id:e.id+"_filter_container-btns",css:{"margin-top":"27px!important"},hidden:!0,cols:[{view:"button",id:e.id+"_filter-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){a(e.id+"_filter-btnFilterOperations",t)},onAfterLoad:c()}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns",value:"+",id:e.id+"_filter_condition",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[{value:"и",id:"add_and"},{value:"или",id:"add_or"}],on:{onMenuItemClick(t){let i=$$(e.id+"_filter_rows").getChildViews().length;t.includes("and")?$$(e.id+"_filter_rows").addView({id:e.id+"_filter-container-child-"+i,padding:5,rows:[{template:"<div style='color:var(--primary)'>+ и</div>",height:30,borderless:!0},{cols:[l("operAnd"),{id:e.id+"_filter_container-btns"+i,cols:[{view:"button",id:e.id+"_filter-child-operAnd-"+i+"-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){a(e.id+"_filter-child-operAnd-"+i+"-btnFilterOperations",t)},onAfterLoad:c()}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns webix_danger",id:e.id+"_filter-"+i+"_remove",type:"icon",icon:"wxi-trash",inputHeight:38,width:40,click:function(){try{g("Поле фильтра будет удалено").then((function(){$$(e.id+"_filter_rows").removeView($$(e.id+"_filter-container-child-"+i)),$$(e.id+"_filter_rows").refresh(),n("success","Поле удалено")}))}catch(e){n("error","Ошибка удаления поля")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить поле фильтра")}}}]}]}]},i):t.includes("or")&&$$(e.id+"_filter_rows").addView({id:e.id+"_filter-container-child-operOr-"+i,padding:5,rows:[{template:"<div style='color:var(--primary)'>+ или</div>",height:30,borderless:!0},{cols:[l("operOr"),{id:e.id+"_filter_container-btns"+i,cols:[{view:"button",id:e.id+"_filter-child-operOr-"+i+"-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){a(e.id+"_filter-child-operOr-"+i+"-btnFilterOperations",t)},onAfterLoad:c()}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns webix_danger",id:e.id+"_filter-operOr-"+i+"_remove",type:"icon",icon:"wxi-trash",inputHeight:38,width:40,click:function(){try{g("Поле фильтра будет удалено").then((function(){$$(e.id+"_filter_rows").removeView($$(e.id+"_filter-container-child-operOr-"+i)),n("success","Поле удалено")}))}catch(e){n("error","Ошибка удаления поля")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить поле фильтра")}}}]}]}]},i)}}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить ещё вариант поля")}}}]}}return{rows:[{css:"webix_filterBar",padding:17,height:80,margin:5,cols:[{view:"button",width:50,type:"icon",id:a,hidden:c,icon:"wxi-filter",css:"webix_btn-filter",title:"текст",height:50,click:function(){try{$$(l).clearSelection();let e=document.querySelector(".webix_btn-filter");e.classList.contains("webix_primary")?($$("filterTableForm").hide(),$$("table-editForm").show(),e.classList.add("webix_secondary"),e.classList.remove("webix_primary"),$$(i).hide()):($$("filterTableForm").show(),$$("table-editForm").hide(),0!==$$("filterTableForm").getChildViews()&&function(e,t=1){try{let i=$$("table").getColumns();if(0==Object.keys($$(e).elements).length){let n=[];i.forEach(((t,i)=>{if("datetime"==t.type)n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"datepicker",format:"%d.%m.%Y %H:%i:%s",id:t.id+"_filter",name:t.id+"_filter",hidden:!0,label:t.label,placeholder:"дд.мм.гг",timepicker:!0,labelPosition:"top",on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},u(t,e,"datepicker")]}]});else if(t.type.includes("reference")){let i=t.type.slice(10);n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id+"_filter",hidden:!0,name:t.id+"_filter",labelPosition:"top",options:{data:p(i)},on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},u(t,e,"combo")]}]})}else t.type.includes("boolean")?n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id+"_filter",hidden:!0,name:t.id+"_filter",labelPosition:"top",options:[{id:1,value:"Да"},{id:2,value:"Нет"}],on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},u(t,e,"combo")]}]}):t.type.includes("integer")?n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,css:"webix_inputs-show",cols:[{view:"text",name:t.id+"_filter",id:t.id+"_filter",css:{"padding-bottom":"5px!important"},placeholder:"Введите число",hidden:!0,label:t.label,labelPosition:"top",invalidMessage:"Поле поддерживает только числовой формат",on:{onKeyPress:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}},validate:function(e){return!isNaN(1*e)}},u(t,e,"integer")]}]}):n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,css:"webix_inputs-show",cols:[{view:"text",name:t.id+"_filter",id:t.id+"_filter",css:{"passing-bottom":"5px!important"},placeholder:"Введите текст",hidden:!0,label:t.label,labelPosition:"top",on:{onKeyPress:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},u(t,e,"text")]}]})}));let o={margin:8,id:"inputsFilter",css:"webix_inputs-table-filter",rows:n};return"table-editForm"==e&&$$("table-delBtnId").enable(),$$(e).addView(o,t)}$$(e).clear(),$$(e).clearValidation(),"table-editForm"==e&&$$("table-delBtnId").enable(),$$("inputsFilter").show()}catch(e){console.log(e),s("012-000",e)}}("filterTableForm",3),e.classList.add("webix_primary"),e.classList.remove("webix_secondary"),$$(i).show())}catch(e){console.log(e),s("012-000",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть фильтры")}}},{view:"button",maxWidth:200,value:"<span class='webix_icon wxi-pencil'></span><span style='padding-left: 4px'>Редактор таблицы</span>",id:i,hidden:!0,css:"webix_btn-edit",title:"текст",height:50,click:function(){try{let e=document.querySelector(".webix_btn-filter");$$("filterTableForm").hide(),$$("table-editForm").show(),e.classList.add("webix_secondary"),e.classList.remove("webix_primary"),$$(i).hide(),this.hide()}catch(e){console.log(e),s("012-000",e)}},on:{onAfterRender:function(){"table"!==l&&this.isVisible()&&this.hide(),this.getInputNode().setAttribute("title","Редактировать таблицу")}}},{},{view:"button",width:50,type:"icon",id:t,hidden:c,icon:"wxi-download",css:"webix_btn-download",title:"текст",height:50,click:function(){webix.toExcel(l,{filename:"Table",filterHTML:!0,styles:!0}),n("success","Таблица сохранена")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Экспорт таблицы")}}}]},{cols:[{view:"template",id:o,css:"webix_style-template-count",height:30,template:function(){return 0!==Object.keys($$(o).getValues()).length?"<div style='color:#999898;'> Общее количество записей: "+$$(o).getValues()+" </div>":""}},{view:"template",id:r,css:"webix_style-template-count",height:30,template:function(){return 0!==Object.keys($$(r).getValues()).length?"<div style='color:#999898;'>Видимое количество записей: "+$$(r).getValues()+" </div>":""}}]}]}}function k(e,t,i=!1){return{view:"datatable",id:e,css:"webix_table-style webix_header_border webix_data_border",resizeColumn:!0,autoConfig:!0,editable:i,editaction:"dblclick",minHeight:350,datafetch:5,datathrottle:5e3,loadahead:100,footer:!0,minWidth:500,select:!0,minColumnWidth:200,on:t,onClick:{"wxi-trash":function(){try{g("Запись будет удалена").then((function(){let t=$$(e).getItem(id),i=$$("tree").getSelectedItem().id;webix.ajax().del("/init/default/api/"+i+"/"+t.id+".json",t,{success:function(){$$(e).remove($$(e).getSelectedId()),n("success","Данные успешно удалены")},error:function(e,t,i){l("012-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("012-000",e.status,e.statusText,e.responseURL)}))}))}catch(e){console.log(e),s("012-000",e)}},"wxi-angle-down":function(e,t,i){try{if($$("propTableView").isVisible())$$("propTableView").hide(),$$("propResize").hide();else{let e=t.row,i=urlFieldAction.search("{"),n=urlFieldAction.slice(0,i);webix.ajax(n+e+".json",{success:function(e,t,i){try{t=t.json().content;let e=[];t.forEach((function(t,i){e.push({type:"text",id:i+1,label:t.name,value:t.value})})),$$("propTableView").define("elements",e),$$("propTableView").show(),$$("propResize").show()}catch(e){console.log(e),s("012-000",e)}},error:function(e,t,i){l("012-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("012-000",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),s("012-000",e)}}}}}let V={onBeforeLoad:function(){this.showOverlay("Загрузка...")},onAfterEditStop:function(e,t,i){try{e.value!=e.old&&($$(t.column).setValue(e.value),v())}catch(e){console.log(e),s("012-011",e)}},onAfterSelect(e){try{if($$("table-editTableBtnId").isVisible()&&$$("table-editTableBtnId").hide(),$$("table-newAddBtnId")&&$$("table-newAddBtnId").enable(),$$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide(),!$$("table-editForm").isVisible()){$$("table-editForm").show(),$$("filterTableForm").hide();let e=document.querySelector(".webix_btn-filter");e.classList.add("webix_secondary"),e.classList.remove("webix_primary")}}catch(e){console.log(e),s("012-000",e)}let t=$$("table").getItem(e);function i(){try{$$("table-editForm").setValues(t),$$("table-saveNewBtn").hide(),$$("table-saveBtn").show(),$$("table-editForm").clearValidation()}catch(e){console.log(e),s("012-000",e)}}if($$("table-editForm").isDirty())try{m().then((function(e){if(1==e)$$("table-editForm").clear(),$$("table-delBtnId").enable(),i();else if(2==e){if(!$$("table-editForm").validate())return n("error","Заполните пустые поля"),!1;$$("table-editForm").getValues().id?v():y(),$$("table-editForm").clear(),$$("table-delBtnId").enable(),i()}}))}catch(e){console.log(e),s("012-000",e)}else x("table-editForm"),i()},onAfterLoad:function(){try{this.hideOverlay(),A()}catch(e){console.log(e),s("012-000",e)}},onAfterDelete:function(){try{$$("table-findElements").setValues($$("table").count().toString()),this.count()||this.showOverlay("Ничего не найдено"),this.count()&&this.hideOverlay()}catch(e){console.log(e),s("012-000",e)}},onAfterAdd:function(){try{$$("table-findElements").setValues($$("table").count().toString()),this.hideOverlay()}catch(e){console.log(e),s("012-000",e)}}};const I={id:"layout-cp",cols:[{view:"form",id:"cp-form",borderless:!0,margin:5,elements:[{template:"<div>Изменение пароля</div>",css:"webix_cp-form",height:35,borderless:!0},{view:"template",id:"authName",css:"webix_userprefs-info",template:function(){return 0!==Object.keys($$("authName").getValues()).length?"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600' >"+$$("authName").getValues()+"<div>":"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀ <div style='display:inline-block;font-size:13px!important;font-weight:600'>не указано</div>"},height:50,borderless:!0},{view:"text",width:300,labelPosition:"top",type:"password",label:"Старый пароль",name:"oldPass"},{view:"text",width:300,labelPosition:"top",type:"password",label:"Новый пароль",name:"newPass"},{view:"text",width:300,labelPosition:"top",type:"password",label:"Повтор нового пароля",name:"repeatPass"},{margin:5,cols:[{view:"button",height:48,width:300,value:"Сменить пароль",css:"webix_primary",click:function(){try{if($$("cp-form").validate()){let e={op:"",np:""},t=$$("cp-form").getValues();e.np=t.newPass,e.op=t.oldPass,webix.ajax().post("/init/default/api/cp",e,{success:function(e,t,i){"i"==(t=t.json()).err_type?n("success",t.err):"e"==t.err_type&&n("error",t.err),$$("cp-form").setDirty(!1)},error:function(e,t,i){l("011-000",i.status,i.statusText,i.responseURL)}})}}catch(e){console.log(e),s("011-000",e)}}}]}],rules:{$all:webix.rules.isNotEmpty,$obj:function(e){return e.newPass!=e.repeatPass?(n("error","Новый пароль не совпадает с повтором"),!1):e.newPass!=e.oldPass||!$$("cp-form").isDirty()||(n("error","Новый пароль должен отличаться от старого"),!1)}}},{}]};let T={userprefsOther:{},userprefsWorkspace:{}};function S(){const e=$$("userprefsTabbar").getValue()+"Form";$$(e).isDirty()?webix.ajax().get("/init/default/api/userprefs/",{success:function(i,o,r){"e"==(o=o.json().content).err_type&&n("error",o.error);let s=!1;const a=$$(e).getValues();let c={name:e,prefs:a};o.forEach((function(i,o){i.name==e&&(s=!0,webix.ajax().put("/init/default/api/userprefs/"+i.id,c,{success:function(i,o,r){"i"==(o=o.json()).err_type&&(t(e,JSON.stringify($$(e).getValues())),n("success","Настройки сохранены")),"e"==o.err_type&&n("error",o.error),T[$$("userprefsTabbar").getValue()]=a,$$(e).setDirty(!1)},error:function(e,t,i){l("015-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("015-011",e.status,e.statusText,e.responseURL)})))})),s||(c.owner=1,webix.ajax().post("/init/default/api/userprefs/",c,{success:function(t,i,o){"i"==(i=i.json()).err_type?n("success","Настройки сохранены"):"e"==i.err_type&&n("error",i.error),T[$$("userprefsTabbar").getValue()]=a,$$(e).setDirty(!1)},error:function(e,t,i){l("015-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("015-001",e.status,e.statusText,e.responseURL)})))},error:function(e,t,i){l("015-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("015-000",e.status,e.statusText,e.responseURL)})):n("debug","Сохранять нечего")}const j={rows:[{padding:{top:15,bottom:0,left:20,right:0},rows:[{view:"template",template:"<div>Настройки</div>",css:"webix_headline-userprefs",height:35,borderless:!0},{view:"template",id:"userprefsName",css:"webix_userprefs-info",template:function(){return 0!==Object.keys($$("userprefsName").getValues()).length?"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600' >"+$$("userprefsName").getValues()+"<div>":"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div><div style='display:inline-block;font-size:13px!important;font-weight:600'>не указано</div>"},height:50,borderless:!0}]},{rows:[{view:"tabbar",type:"top",id:"userprefsTabbar",css:"webix_filter-popup-tabbar",multiview:!0,options:[{value:"<span class='webix_tabbar-filter-headline'>Рабочее пространство</span>",id:"userprefsWorkspace"},{value:"<span class=webix_tabbar-filter-headline'>Другое</span>",id:"userprefsOther"}],height:50,on:{onBeforeTabClick:function(e){const t=$$("userprefsTabbar").getValue()+"Form";if($$(t).isDirty())return webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"}).then((function(i){1==i?($$(t).setValues(T[$$("userprefsTabbar").getValue()]),$$("userprefsTabbar").setValue(e)):2==i&&(S(),$$("userprefsTabbar").setValue(e))})),!1}}},{cells:[{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsWorkspace",scroll:"y",body:{view:"form",id:"userprefsWorkspaceForm",borderless:!0,elements:[{cols:[{rows:[{view:"radio",labelPosition:"top",name:"logBlockOpt",label:"Отображение блока системных сообщений",value:1,options:[{id:1,value:"Показать"},{id:2,value:"Скрыть"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть по умолчанию блок системных сообщений")},onChange:function(e,t,i){e!==t&&(T.userprefsWorkspace.logBlockOpt=t,1==e?$$("webix_log-btn").setValue(2):$$("webix_log-btn").setValue(1))}}},{height:15},{view:"select",name:"LoginActionOpt",label:"Действие после входа в систему",labelPosition:"top",value:2,options:[{id:1,value:"Перейти на главную страницу"},{id:2,value:"Перейти на последнюю открытую страницу"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показывать/не показывать всплывающее окно при загрузке приложения")},onChange:function(e,t,i){e!==t&&(T.userprefsWorkspace.LoginActionOpt=t)}}}]},{}]}]}},{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsOther",scroll:"y",body:{view:"form",id:"userprefsOtherForm",borderless:!0,elements:[{view:"radio",labelPosition:"top",label:"Автообновление специфичных страниц",value:1,name:"autorefOpt",options:[{id:1,value:"Включено"},{id:2,value:"Выключено"}],on:{onChange:function(e,t){1!=e||$$("userprefsAutorefCounter").isVisible()||$$("userprefsAutorefCounter").show(),2==e&&$$("userprefsAutorefCounter").isVisible()&&$$("userprefsAutorefCounter").hide(),e!==t&&(T.userprefsOther.autorefOpt=t)}}},{height:5},{view:"counter",id:"userprefsAutorefCounter",labelPosition:"top",name:"autorefCounterOpt",label:"Интервал автообновления (в миллисекундах)",min:15e3,max:9e5,on:{onChange:function(e,t){e!==t&&(T.userprefsOther.autorefCounterOpt=t);const i=$$("userprefsAutorefCounter").config.min,n=$$("userprefsAutorefCounter").config.max;e==i?webix.message({type:"debug",expire:1e3,text:"Минимальное возможное значение"}):e==n&&webix.message({type:"debug",expire:1e3,text:"Максимальное возможное значение"})}}},{}],on:{}}}]},{cols:[{width:20},{view:"button",height:48,value:"Сбросить"},{width:10},{view:"button",value:"Сохранить настройки",height:48,id:"userprefsSaveBtn",css:"webix_primary",click:S},{width:20}]}]}]};let F,B={};function P(){try{let e=$$("filterPopupTabbar").getValue();if("editFormPopupLib"==e)webix.message({type:"debug",expire:3e3,text:"Библиотека в разработке"});else if("editFormScroll"==e){$$("filterLibrarySaveBtn")&&!$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").enable();let e,t,i,o=$$("editFormPopup").getValues();Object.keys(o).forEach((function(n,r){if(i=n.lastIndexOf("_"),t=n.slice(0,i),e=document.querySelectorAll(".webix_filter-inputs"),o[n])$$(n).isVisible()||(e.forEach((function(e,i){e.classList.contains(t)?(e.classList.contains("webix_show-content")||e.classList.add("webix_show-content"),e.classList.contains("webix_hide-content")&&e.classList.remove("webix_hide-content")):e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content")})),$$(n).show(),$$(n+"_container-btns")&&!$$(n+"_container-btns").isVisible()&&$$(n+"_container-btns").show()),$$("resetFilterBtn").enable(),$$("filterEmptyTempalte").isVisible()&&($$("filterEmptyTempalte").hide(),$$("filterEmptyTempalte").refresh());else if($$(n).isVisible()&&(e.forEach((function(e,i){e.classList.contains(t)&&(e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content"),e.classList.contains("webix_show-content")&&e.classList.remove("webix_show-content"))})),$$(n).hide()),$$(n+"_container-btns")&&$$(n+"_container-btns").isVisible()&&$$(n+"_container-btns").hide(),$$(n+"_rows")){let e=$$(n+"_rows").getChildViews();Object.values(e).forEach((function(e,t){e.config.id.includes("child")&&$$(n+"_rows").removeView($$(e.config.id))}))}$$(n).refresh()}));let r=0;Object.values($$("filterTableForm").elements).forEach((function(e,t){e.config.hidden||r++})),r||$$("filterEmptyTempalte").isVisible()||($$("filterEmptyTempalte").show(),$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").disable(),$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").disable()),$$("popupFilterEdit").destructor(),n("success","Рабочая область фильтра обновлена")}}catch(e){$$("popupFilterEdit").destructor(),n("error","Ошибка при обновлении фильтров")}}try{F={view:"form",hidden:!0,id:"filterTableForm",minHeight:350,minWidth:210,width:320,scroll:!0,elements:[{id:"form-adaptive",minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{margin:5,rows:[{responsive:"form-adaptive",margin:5,cols:[{view:"button",value:"Редактор фильтров",height:48,minWidth:140,click:function(){webix.ui({view:"popup",id:"popupFilterEdit",css:"webix_popup-filter-container webix_popup-config",modal:!0,escHide:!0,position:"center",height:400,width:400,body:{scroll:"y",rows:[{css:"webix_filter-headline-wrapper",cols:[{template:"Редактор фильтров",css:"webix_template-recover",borderless:!0,height:40},{width:150},{view:"button",id:"buttonClosePopup",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("popupFilterEdit")&&$$("popupFilterEdit").destructor()}}]},{template:"Выберите нужные поля или шаблон из библиотеки",borderless:!0,height:47},{view:"form",id:"editFormPopup",css:"webix_edit-form-popup",borderless:!0,elements:[{rows:[{view:"tabbar",type:"top",id:"filterPopupTabbar",css:"webix_filter-popup-tabbar",multiview:!0,options:[{value:"<span class='webix_tabbar-filter-headline'>Поля</span>",id:"editFormScroll"},{value:"<span class=webix_tabbar-filter-headline'>Библиотека</span>",id:"editFormPopupLib"}],height:50,on:{onAfterTabClick:function(e){!function(e){function t(e){try{"enable"==e?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():"disable"==e&&$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable()}catch(e){console.log(e),s("004-000",e)}}try{if("editFormPopupLib"==e&&(""!==$$("filterEditLib").getValue()?t("enable"):t("disable")),"editFormScroll"==e){let e=$$("editFormPopup").getValues(),i=0;Object.values(e).forEach((function(e,t){e&&i++})),t(i>0?"enable":"disable")}}catch(e){console.log(e),s("004-000",e)}}(e)}}},{height:200,cells:[{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"editFormScroll",scroll:"y",body:{id:"editFormPopupScroll",rows:[]}},{view:"form",id:"editFormPopupLib",css:"webix_multivew-cell",borderless:!0,elements:[{view:"radio",id:"filterEditLib",vertical:!0,options:[{id:"radioNoneContent",disabled:!0,value:"Сохранённых шаблонов нет"}],on:{onChange:function(){try{this.getValue()&&$$("popupFilterSubmitBtn")&&($$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable())}catch(e){console.log(e),s("004-000",e)}},onAfterRender:function(){try{Object.keys(B).length>0&&($$("filterEditLib").addOption(B),$$("filterEditLib").removeOption("radioNoneContent"))}catch(e){console.log(e),s("004-000",e)}}}}]}]},{height:20},{view:"button",id:"popupFilterSubmitBtn",height:48,minWidth:140,disabled:!0,css:"webix_primary",hotkey:"Enter",value:"Применить",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбранные фильтры будут добавлены в рабочее поле, остальные скрыты")}},click:P}]},{}]}]}}).show();let e=[{cols:[{id:"editFormPopupScrollContent",css:"webix_edit-form-popup-scroll-content",rows:[{view:"checkbox",id:"selectAll",labelRight:"<div style='font-weight:600'>Выбрать всё</div>",labelWidth:0,name:"selectAll",on:{onChange:function(){try{this.getValue()?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable(),$$("editFormPopupScrollContent").getChildViews().forEach((function(e,t){e.config.id.includes("checkbox")&&($$("selectAll").getValue()?e.config.value=1:e.config.value=0,$$(e).refresh())}))}catch(e){console.log(e),s("004-000",e)}}}}]}]}],t=[],i=$$("filterTableForm").elements;try{Object.values(i).forEach((function(e,i){t.push({id:e.config.id,label:e.config.label})}))}catch(e){console.log(e),s("004-000",e)}function n(e){try{let t=$$(e.id+"_checkbox").getParentView().getChildViews(),i=0,n=0;t.forEach((function(e,t){e.config.id.includes("checkbox")&&(e.config.value&&""!=e.config.value||i++),e.config.value&&n++})),n>0?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable(),0==i?($$("selectAll").config.value=1,$$("selectAll").refresh()):0!==$$("selectAll").config.value&&($$("selectAll").config.value=0,$$("selectAll").refresh())}catch(e){console.log(e),s("004-000",e)}}try{t.forEach((function(t,i){t.id.includes("child")||($$(t.id)&&$$(t.id).isVisible()?e[0].cols[0].rows.push({view:"checkbox",id:t.id+"_checkbox",labelRight:t.label,labelWidth:0,name:t.id,value:1,on:{onChange:function(){n(t)}}}):e[0].cols[0].rows.push({view:"checkbox",id:t.id+"_checkbox",labelRight:t.label,labelWidth:0,name:t.id,on:{onChange:function(){n(t)}}}))})),$$("editFormPopupScroll").addView({rows:e},1)}catch(e){console.log(e),s("004-000",e)}let o=0,r=$$("editFormPopupScrollContent").getChildViews();try{r.forEach((function(e,t){e.config.id.includes("checkbox")&&(e.config.value&&""!=e.config.value||o++)})),0==o&&($$("selectAll").config.value=1,$$("selectAll").refresh())}catch(e){console.log(e),s("004-000",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить/удалить фильтры")}}},{view:"button",id:"resetFilterBtn",disabled:!0,height:48,minWidth:50,width:65,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"wxi-trash",click:function(){try{let e=$$("tree").getSelectedItem().id;webix.ajax("/init/default/api/smarts?query="+e+".id >= 0&sorts="+e+".id&offset=0",{success:function(e,t,i){0!==(t=t.json().content).length?($$("table").hideOverlay("Ничего не найдено"),$$("table").clearAll(),$$("table").parse(t)):($$("table").clearAll(),$$("table").showOverlay("Ничего не найдено"));let o=$$("table").count();$$("table-idFilterElements").setValues(o.toString()),n("success","Фильтры очищены")},error:function(e,t,i){l("004-000",i.status,i.statusText,i.responseURL),n("error","Ошибка очистки фильтров")}}).catch((e=>{console.log(e),l("004-000",e.status,e.statusText,e.responseURL)}))}catch(e){n("error","Ошибка при очищении фильтров")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Сбросить фильтры")}}}]}]},{id:"btns-adaptive",css:{"margin-top":"5px!important"},rows:[{responsive:"btns-adaptive",margin:5,cols:[{view:"button",id:"btnFilterSubmit",height:48,minWidth:70,css:"webix_primary",hotkey:"Enter",disabled:!0,value:"Применить фильтры",click:function(){let e=$$("filterTableForm").getValues(),t=[];function i(e,i,n,o,r,l=!1){let a=$$("tree").getSelectedItem().id,c=$$(n+"-btnFilterOperations").config.value;try{"parent"==r?l?"="==c?t.push("+and+"+a+"."+i+"+=+"+e):"!="==c?t.push("+and+"+a+"."+i+"+!=+"+e):"<"==c?t.push("+and+"+a+"."+i+"+<+"+e):">"==c?t.push("+and+"+a+"."+i+"+>+"+e):"<="==c?t.push("+and+"+a+"."+i+"+<=+"+e):">="==c?t.push("+and+"+a+"."+i+"+>=+"+e):"⊆"==c&&t.push("+and+"+a+"."+i+"+contains+"+e):"="==c?t.push(a+"."+i+"+=+"+e):"!="==c?t.push(a+"."+i+"+!=+"+e):"<"==c?t.push(a+"."+i+"+<+"+e):">"==c?t.push(a+"."+i+"+>+"+e):"<="==c?t.push(a+"."+i+"+<=+"+e):">="==c?t.push(a+"."+i+"+>=+"+e):"⊆"==c&&t.push(a+"."+i+"+contains+"+e):"child"==r&&("="==c?t.push("+"+o+"+"+i+"+=+"+e):"!="==c?t.push("+"+o+"+"+i+"+!=+"+e):"<"==c?t.push("+"+o+"+"+i+"+<+"+e):">"==c?t.push("+"+o+"+"+i+"+>+"+e):">="==c?t.push("+"+o+"+"+i+"+>=+"+e):"<="==c?t.push("+"+o+"+"+i+"+<=+"+e):"⊆"==c&&t.push("+"+o+"+"+i+"+contains+"+e))}catch(e){console.log(e),s("004-000",e)}}if($$("filterTableForm").validate()){let o,r,a=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s");try{Object.keys(e).sort().forEach((function(t,n){o=t,r=e[t],r&&("datepicker"==$$(t).config.view&&(r=a(e[t])),$$(t).config.text&&"Нет"==$$(t).config.text&&(r=0),t.includes("filter")&&!t.includes("condition")&&(o=t.lastIndexOf("_"),o=t.slice(0,o)),t.includes("condition")||""===e[t]||"selectAll"===t||t.includes("child")?t.includes("child")&&(t.includes("operAnd")?i(r,o,t,"and","child"):t.includes("operOr")&&i(r,o,t,"or","child")):n>0?i(r,o,t,"and","parent",!0):i(r,o,t,"and","parent"))}))}catch(e){console.log(e),s("004-000",e)}webix.ajax("/init/default/api/smarts?query="+t.join(""),{success:function(e,t,i){let o=t.json().err_type,r=t.json().err;0!==(t=t.json().content).length?($$("table").hideOverlay("Ничего не найдено"),$$("table").clearAll(),$$("table").parse(t)):($$("table").clearAll(),$$("table").showOverlay("Ничего не найдено"));let s=$$("table").count();$$("table-idFilterElements").setValues(s.toString()),"i"==o?n("success","Фильтры успшено применены"):"e"==o?n("error",r):"x"==o&&n("error","Ошибка фильтрации данных")},error:function(e,t,i){l("003-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("003-011",e.status,e.statusText,e.responseURL)}))}else n("error","Не все поля формы заполнены")}},{view:"button",id:"filterLibrarySaveBtn",disabled:!0,height:48,minWidth:50,width:65,hotkey:"shift+esc",type:"icon",icon:"wxi-file",click:function(){try{webix.prompt({title:"Название шаблона",ok:"Сохранить",cancel:"Отменить",css:"webix_prompt-filter-lib",input:{required:!0,placeholder:"Введите название шаблона..."},width:350}).then((function(e){let t=e,i=$$("filterTableForm").elements,n=[];Object.values(i).forEach((function(e,t){$$(e.config.id).isVisible()&&n.push(e)})),B={id:webix.uid(),value:t},webix.message({type:"success",expire:1e3,text:"Шаблон «"+t+"»  сохранён в библиотеку"})})).fail((function(){}))}catch(e){console.log(e),n("error","Не удалось сохранить шаблон"),s("004-001",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Сохранить шаблон с полями в библиотеку")}}}]},{height:10},{id:"filterEmptyTempalte",template:"<div style='color:#858585;font-size:13px!important'>Добавьте фильтры из редактора</div>",borderless:!0}]}]}],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}}}catch(e){console.log(e),s("004-003",e)}webix.UIManager.addHotKey("Ctrl+Shift+E",(function(){Backbone.history.navigate("experimental/treeEdit",{trigger:!0})})),function(){!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("underscore",t):(e="undefined"!=typeof globalThis?globalThis:e||self,function(){var i=e._,n=e._=t();n.noConflict=function(){return e._=i,n}}())}(this,(function(){var e="1.13.4",t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},i=Array.prototype,n=Object.prototype,o="undefined"!=typeof Symbol?Symbol.prototype:null,r=i.push,s=i.slice,l=n.toString,a=n.hasOwnProperty,c="undefined"!=typeof ArrayBuffer,u="undefined"!=typeof DataView,d=Array.isArray,h=Object.keys,p=Object.create,f=c&&ArrayBuffer.isView,b=isNaN,$=isFinite,g=!{toString:null}.propertyIsEnumerable("toString"),m=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],w=Math.pow(2,53)-1;function v(e,t){return t=null==t?e.length-1:+t,function(){for(var i=Math.max(arguments.length-t,0),n=Array(i),o=0;o<i;o++)n[o]=arguments[o+t];switch(t){case 0:return e.call(this,n);case 1:return e.call(this,arguments[0],n);case 2:return e.call(this,arguments[0],arguments[1],n)}var r=Array(t+1);for(o=0;o<t;o++)r[o]=arguments[o];return r[t]=n,e.apply(this,r)}}function y(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function x(e){return void 0===e}function _(e){return!0===e||!1===e||"[object Boolean]"===l.call(e)}function A(e){var t="[object "+e+"]";return function(e){return l.call(e)===t}}var E=A("String"),k=A("Number"),V=A("Date"),I=A("RegExp"),T=A("Error"),S=A("Symbol"),j=A("ArrayBuffer"),F=A("Function"),B=t.document&&t.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof B&&(F=function(e){return"function"==typeof e||!1});var P=F,L=A("Object"),O=u&&L(new DataView(new ArrayBuffer(8))),R="undefined"!=typeof Map&&L(new Map),C=A("DataView"),N=O?function(e){return null!=e&&P(e.getInt8)&&j(e.buffer)}:C,U=d||A("Array");function z(e,t){return null!=e&&a.call(e,t)}var M=A("Arguments");!function(){M(arguments)||(M=function(e){return z(e,"callee")})}();var W=M;function H(e){return k(e)&&b(e)}function D(e){return function(){return e}}function q(e){return function(t){var i=e(t);return"number"==typeof i&&i>=0&&i<=w}}function J(e){return function(t){return null==t?void 0:t[e]}}var K=J("byteLength"),Y=q(K),G=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,X=c?function(e){return f?f(e)&&!N(e):Y(e)&&G.test(l.call(e))}:D(!1),Q=J("length");function Z(e,t){t=function(e){for(var t={},i=e.length,n=0;n<i;++n)t[e[n]]=!0;return{contains:function(e){return!0===t[e]},push:function(i){return t[i]=!0,e.push(i)}}}(t);var i=m.length,o=e.constructor,r=P(o)&&o.prototype||n,s="constructor";for(z(e,s)&&!t.contains(s)&&t.push(s);i--;)(s=m[i])in e&&e[s]!==r[s]&&!t.contains(s)&&t.push(s)}function ee(e){if(!y(e))return[];if(h)return h(e);var t=[];for(var i in e)z(e,i)&&t.push(i);return g&&Z(e,t),t}function te(e,t){var i=ee(t),n=i.length;if(null==e)return!n;for(var o=Object(e),r=0;r<n;r++){var s=i[r];if(t[s]!==o[s]||!(s in o))return!1}return!0}function ie(e){return e instanceof ie?e:this instanceof ie?void(this._wrapped=e):new ie(e)}function ne(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,K(e))}ie.VERSION=e,ie.prototype.value=function(){return this._wrapped},ie.prototype.valueOf=ie.prototype.toJSON=ie.prototype.value,ie.prototype.toString=function(){return String(this._wrapped)};var oe="[object DataView]";function re(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=typeof e;return("function"===o||"object"===o||"object"==typeof t)&&se(e,t,i,n)}function se(e,t,i,n){e instanceof ie&&(e=e._wrapped),t instanceof ie&&(t=t._wrapped);var r=l.call(e);if(r!==l.call(t))return!1;if(O&&"[object Object]"==r&&N(e)){if(!N(t))return!1;r=oe}switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return o.valueOf.call(e)===o.valueOf.call(t);case"[object ArrayBuffer]":case oe:return se(ne(e),ne(t),i,n)}var s="[object Array]"===r;if(!s&&X(e)){if(K(e)!==K(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;s=!0}if(!s){if("object"!=typeof e||"object"!=typeof t)return!1;var a=e.constructor,c=t.constructor;if(a!==c&&!(P(a)&&a instanceof a&&P(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}n=n||[];for(var u=(i=i||[]).length;u--;)if(i[u]===e)return n[u]===t;if(i.push(e),n.push(t),s){if((u=e.length)!==t.length)return!1;for(;u--;)if(!re(e[u],t[u],i,n))return!1}else{var d,h=ee(e);if(u=h.length,ee(t).length!==u)return!1;for(;u--;)if(!z(t,d=h[u])||!re(e[d],t[d],i,n))return!1}return i.pop(),n.pop(),!0}function le(e){if(!y(e))return[];var t=[];for(var i in e)t.push(i);return g&&Z(e,t),t}function ae(e){var t=Q(e);return function(i){if(null==i)return!1;var n=le(i);if(Q(n))return!1;for(var o=0;o<t;o++)if(!P(i[e[o]]))return!1;return e!==pe||!P(i[ce])}}var ce="forEach",ue=["clear","delete"],de=["get","has","set"],he=ue.concat(ce,de),pe=ue.concat(de),fe=["add"].concat(ue,ce,"has"),be=R?ae(he):A("Map"),$e=R?ae(pe):A("WeakMap"),ge=R?ae(fe):A("Set"),me=A("WeakSet");function we(e){for(var t=ee(e),i=t.length,n=Array(i),o=0;o<i;o++)n[o]=e[t[o]];return n}function ve(e){for(var t={},i=ee(e),n=0,o=i.length;n<o;n++)t[e[i[n]]]=i[n];return t}function ye(e){var t=[];for(var i in e)P(e[i])&&t.push(i);return t.sort()}function xe(e,t){return function(i){var n=arguments.length;if(t&&(i=Object(i)),n<2||null==i)return i;for(var o=1;o<n;o++)for(var r=arguments[o],s=e(r),l=s.length,a=0;a<l;a++){var c=s[a];t&&void 0!==i[c]||(i[c]=r[c])}return i}}var _e=xe(le),Ae=xe(ee),Ee=xe(le,!0);function ke(e){if(!y(e))return{};if(p)return p(e);var t=function(){};t.prototype=e;var i=new t;return t.prototype=null,i}function Ve(e){return U(e)?e:[e]}function Ie(e){return ie.toPath(e)}function Te(e,t){for(var i=t.length,n=0;n<i;n++){if(null==e)return;e=e[t[n]]}return i?e:void 0}function Se(e,t,i){var n=Te(e,Ie(t));return x(n)?i:n}function je(e){return e}function Fe(e){return e=Ae({},e),function(t){return te(t,e)}}function Be(e){return e=Ie(e),function(t){return Te(t,e)}}function Pe(e,t,i){if(void 0===t)return e;switch(null==i?3:i){case 1:return function(i){return e.call(t,i)};case 3:return function(i,n,o){return e.call(t,i,n,o)};case 4:return function(i,n,o,r){return e.call(t,i,n,o,r)}}return function(){return e.apply(t,arguments)}}function Le(e,t,i){return null==e?je:P(e)?Pe(e,t,i):y(e)&&!U(e)?Fe(e):Be(e)}function Oe(e,t){return Le(e,t,1/0)}function Re(e,t,i){return ie.iteratee!==Oe?ie.iteratee(e,t):Le(e,t,i)}function Ce(){}function Ne(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}ie.toPath=Ve,ie.iteratee=Oe;var Ue=Date.now||function(){return(new Date).getTime()};function ze(e){var t=function(t){return e[t]},i="(?:"+ee(e).join("|")+")",n=RegExp(i),o=RegExp(i,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(o,t):e}}var Me={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},We=ze(Me),He=ze(ve(Me)),De=ie.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},qe=/(.)^/,Je={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Ke=/\\|'|\r|\n|\u2028|\u2029/g;function Ye(e){return"\\"+Je[e]}var Ge=/^\s*(\w|\$)+\s*$/,Xe=0;function Qe(e,t,i,n,o){if(!(n instanceof t))return e.apply(i,o);var r=ke(e.prototype),s=e.apply(r,o);return y(s)?s:r}var Ze=v((function(e,t){var i=Ze.placeholder,n=function(){for(var o=0,r=t.length,s=Array(r),l=0;l<r;l++)s[l]=t[l]===i?arguments[o++]:t[l];for(;o<arguments.length;)s.push(arguments[o++]);return Qe(e,n,this,this,s)};return n}));Ze.placeholder=ie;var et=v((function(e,t,i){if(!P(e))throw new TypeError("Bind must be called on a function");var n=v((function(o){return Qe(e,n,t,this,i.concat(o))}));return n})),tt=q(Q);function it(e,t,i,n){if(n=n||[],t||0===t){if(t<=0)return n.concat(e)}else t=1/0;for(var o=n.length,r=0,s=Q(e);r<s;r++){var l=e[r];if(tt(l)&&(U(l)||W(l)))if(t>1)it(l,t-1,i,n),o=n.length;else for(var a=0,c=l.length;a<c;)n[o++]=l[a++];else i||(n[o++]=l)}return n}var nt=v((function(e,t){var i=(t=it(t,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var n=t[i];e[n]=et(e[n],e)}return e})),ot=v((function(e,t,i){return setTimeout((function(){return e.apply(null,i)}),t)})),rt=Ze(ot,ie,1);function st(e){return function(){return!e.apply(this,arguments)}}function lt(e,t){var i;return function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=null),i}}var at=Ze(lt,2);function ct(e,t,i){t=Re(t,i);for(var n,o=ee(e),r=0,s=o.length;r<s;r++)if(t(e[n=o[r]],n,e))return n}function ut(e){return function(t,i,n){i=Re(i,n);for(var o=Q(t),r=e>0?0:o-1;r>=0&&r<o;r+=e)if(i(t[r],r,t))return r;return-1}}var dt=ut(1),ht=ut(-1);function pt(e,t,i,n){for(var o=(i=Re(i,n,1))(t),r=0,s=Q(e);r<s;){var l=Math.floor((r+s)/2);i(e[l])<o?r=l+1:s=l}return r}function ft(e,t,i){return function(n,o,r){var l=0,a=Q(n);if("number"==typeof r)e>0?l=r>=0?r:Math.max(r+a,l):a=r>=0?Math.min(r+1,a):r+a+1;else if(i&&r&&a)return n[r=i(n,o)]===o?r:-1;if(o!=o)return(r=t(s.call(n,l,a),H))>=0?r+l:-1;for(r=e>0?l:a-1;r>=0&&r<a;r+=e)if(n[r]===o)return r;return-1}}var bt=ft(1,dt,pt),$t=ft(-1,ht);function gt(e,t,i){var n=(tt(e)?dt:ct)(e,t,i);if(void 0!==n&&-1!==n)return e[n]}function mt(e,t,i){var n,o;if(t=Pe(t,i),tt(e))for(n=0,o=e.length;n<o;n++)t(e[n],n,e);else{var r=ee(e);for(n=0,o=r.length;n<o;n++)t(e[r[n]],r[n],e)}return e}function wt(e,t,i){t=Re(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=Array(o),s=0;s<o;s++){var l=n?n[s]:s;r[s]=t(e[l],l,e)}return r}function vt(e){var t=function(t,i,n,o){var r=!tt(t)&&ee(t),s=(r||t).length,l=e>0?0:s-1;for(o||(n=t[r?r[l]:l],l+=e);l>=0&&l<s;l+=e){var a=r?r[l]:l;n=i(n,t[a],a,t)}return n};return function(e,i,n,o){var r=arguments.length>=3;return t(e,Pe(i,o,4),n,r)}}var yt=vt(1),xt=vt(-1);function _t(e,t,i){var n=[];return t=Re(t,i),mt(e,(function(e,i,o){t(e,i,o)&&n.push(e)})),n}function At(e,t,i){t=Re(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=0;r<o;r++){var s=n?n[r]:r;if(!t(e[s],s,e))return!1}return!0}function Et(e,t,i){t=Re(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=0;r<o;r++){var s=n?n[r]:r;if(t(e[s],s,e))return!0}return!1}function kt(e,t,i,n){return tt(e)||(e=we(e)),("number"!=typeof i||n)&&(i=0),bt(e,t,i)>=0}var Vt=v((function(e,t,i){var n,o;return P(t)?o=t:(t=Ie(t),n=t.slice(0,-1),t=t[t.length-1]),wt(e,(function(e){var r=o;if(!r){if(n&&n.length&&(e=Te(e,n)),null==e)return;r=e[t]}return null==r?r:r.apply(e,i)}))}));function It(e,t){return wt(e,Be(t))}function Tt(e,t,i){var n,o,r=-1/0,s=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var l=0,a=(e=tt(e)?e:we(e)).length;l<a;l++)null!=(n=e[l])&&n>r&&(r=n);else t=Re(t,i),mt(e,(function(e,i,n){((o=t(e,i,n))>s||o===-1/0&&r===-1/0)&&(r=e,s=o)}));return r}var St=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function jt(e){return e?U(e)?s.call(e):E(e)?e.match(St):tt(e)?wt(e,je):we(e):[]}function Ft(e,t,i){if(null==t||i)return tt(e)||(e=we(e)),e[Ne(e.length-1)];var n=jt(e),o=Q(n);t=Math.max(Math.min(t,o),0);for(var r=o-1,s=0;s<t;s++){var l=Ne(s,r),a=n[s];n[s]=n[l],n[l]=a}return n.slice(0,t)}function Bt(e,t){return function(i,n,o){var r=t?[[],[]]:{};return n=Re(n,o),mt(i,(function(t,o){var s=n(t,o,i);e(r,t,s)})),r}}var Pt=Bt((function(e,t,i){z(e,i)?e[i].push(t):e[i]=[t]})),Lt=Bt((function(e,t,i){e[i]=t})),Ot=Bt((function(e,t,i){z(e,i)?e[i]++:e[i]=1})),Rt=Bt((function(e,t,i){e[i?0:1].push(t)}),!0);function Ct(e,t,i){return t in i}var Nt=v((function(e,t){var i={},n=t[0];if(null==e)return i;P(n)?(t.length>1&&(n=Pe(n,t[1])),t=le(e)):(n=Ct,t=it(t,!1,!1),e=Object(e));for(var o=0,r=t.length;o<r;o++){var s=t[o],l=e[s];n(l,s,e)&&(i[s]=l)}return i})),Ut=v((function(e,t){var i,n=t[0];return P(n)?(n=st(n),t.length>1&&(i=t[1])):(t=wt(it(t,!1,!1),String),n=function(e,i){return!kt(t,i)}),Nt(e,n,i)}));function zt(e,t,i){return s.call(e,0,Math.max(0,e.length-(null==t||i?1:t)))}function Mt(e,t,i){return null==e||e.length<1?null==t||i?void 0:[]:null==t||i?e[0]:zt(e,e.length-t)}function Wt(e,t,i){return s.call(e,null==t||i?1:t)}var Ht=v((function(e,t){return t=it(t,!0,!0),_t(e,(function(e){return!kt(t,e)}))})),Dt=v((function(e,t){return Ht(e,t)}));function qt(e,t,i,n){_(t)||(n=i,i=t,t=!1),null!=i&&(i=Re(i,n));for(var o=[],r=[],s=0,l=Q(e);s<l;s++){var a=e[s],c=i?i(a,s,e):a;t&&!i?(s&&r===c||o.push(a),r=c):i?kt(r,c)||(r.push(c),o.push(a)):kt(o,a)||o.push(a)}return o}var Jt=v((function(e){return qt(it(e,!0,!0))}));function Kt(e){for(var t=e&&Tt(e,Q).length||0,i=Array(t),n=0;n<t;n++)i[n]=It(e,n);return i}var Yt=v(Kt);function Gt(e,t){return e._chain?ie(t).chain():t}function Xt(e){return mt(ye(e),(function(t){var i=ie[t]=e[t];ie.prototype[t]=function(){var e=[this._wrapped];return r.apply(e,arguments),Gt(this,i.apply(ie,e))}})),ie}mt(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=i[e];ie.prototype[e]=function(){var i=this._wrapped;return null!=i&&(t.apply(i,arguments),"shift"!==e&&"splice"!==e||0!==i.length||delete i[0]),Gt(this,i)}})),mt(["concat","join","slice"],(function(e){var t=i[e];ie.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),Gt(this,e)}}));var Qt={__proto__:null,VERSION:e,restArguments:v,isObject:y,isNull:function(e){return null===e},isUndefined:x,isBoolean:_,isElement:function(e){return!(!e||1!==e.nodeType)},isString:E,isNumber:k,isDate:V,isRegExp:I,isError:T,isSymbol:S,isArrayBuffer:j,isDataView:N,isArray:U,isFunction:P,isArguments:W,isFinite:function(e){return!S(e)&&$(e)&&!isNaN(parseFloat(e))},isNaN:H,isTypedArray:X,isEmpty:function(e){if(null==e)return!0;var t=Q(e);return"number"==typeof t&&(U(e)||E(e)||W(e))?0===t:0===Q(ee(e))},isMatch:te,isEqual:function(e,t){return re(e,t)},isMap:be,isWeakMap:$e,isSet:ge,isWeakSet:me,keys:ee,allKeys:le,values:we,pairs:function(e){for(var t=ee(e),i=t.length,n=Array(i),o=0;o<i;o++)n[o]=[t[o],e[t[o]]];return n},invert:ve,functions:ye,methods:ye,extend:_e,extendOwn:Ae,assign:Ae,defaults:Ee,create:function(e,t){var i=ke(e);return t&&Ae(i,t),i},clone:function(e){return y(e)?U(e)?e.slice():_e({},e):e},tap:function(e,t){return t(e),e},get:Se,has:function(e,t){for(var i=(t=Ie(t)).length,n=0;n<i;n++){var o=t[n];if(!z(e,o))return!1;e=e[o]}return!!i},mapObject:function(e,t,i){t=Re(t,i);for(var n=ee(e),o=n.length,r={},s=0;s<o;s++){var l=n[s];r[l]=t(e[l],l,e)}return r},identity:je,constant:D,noop:Ce,toPath:Ve,property:Be,propertyOf:function(e){return null==e?Ce:function(t){return Se(e,t)}},matcher:Fe,matches:Fe,times:function(e,t,i){var n=Array(Math.max(0,e));t=Pe(t,i,1);for(var o=0;o<e;o++)n[o]=t(o);return n},random:Ne,now:Ue,escape:We,unescape:He,templateSettings:De,template:function(e,t,i){!t&&i&&(t=i),t=Ee({},t,ie.templateSettings);var n=RegExp([(t.escape||qe).source,(t.interpolate||qe).source,(t.evaluate||qe).source].join("|")+"|$","g"),o=0,r="__p+='";e.replace(n,(function(t,i,n,s,l){return r+=e.slice(o,l).replace(Ke,Ye),o=l+t.length,i?r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?r+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(r+="';\n"+s+"\n__p+='"),t})),r+="';\n";var s,l=t.variable;if(l){if(!Ge.test(l))throw new Error("variable is not a bare identifier: "+l)}else r="with(obj||{}){\n"+r+"}\n",l="obj";r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{s=new Function(l,"_",r)}catch(e){throw e.source=r,e}var a=function(e){return s.call(this,e,ie)};return a.source="function("+l+"){\n"+r+"}",a},result:function(e,t,i){var n=(t=Ie(t)).length;if(!n)return P(i)?i.call(e):i;for(var o=0;o<n;o++){var r=null==e?void 0:e[t[o]];void 0===r&&(r=i,o=n),e=P(r)?r.call(e):r}return e},uniqueId:function(e){var t=++Xe+"";return e?e+t:t},chain:function(e){var t=ie(e);return t._chain=!0,t},iteratee:Oe,partial:Ze,bind:et,bindAll:nt,memoize:function(e,t){var i=function(n){var o=i.cache,r=""+(t?t.apply(this,arguments):n);return z(o,r)||(o[r]=e.apply(this,arguments)),o[r]};return i.cache={},i},delay:ot,defer:rt,throttle:function(e,t,i){var n,o,r,s,l=0;i||(i={});var a=function(){l=!1===i.leading?0:Ue(),n=null,s=e.apply(o,r),n||(o=r=null)},c=function(){var c=Ue();l||!1!==i.leading||(l=c);var u=t-(c-l);return o=this,r=arguments,u<=0||u>t?(n&&(clearTimeout(n),n=null),l=c,s=e.apply(o,r),n||(o=r=null)):n||!1===i.trailing||(n=setTimeout(a,u)),s};return c.cancel=function(){clearTimeout(n),l=0,n=o=r=null},c},debounce:function(e,t,i){var n,o,r,s,l,a=function(){var c=Ue()-o;t>c?n=setTimeout(a,t-c):(n=null,i||(s=e.apply(l,r)),n||(r=l=null))},c=v((function(c){return l=this,r=c,o=Ue(),n||(n=setTimeout(a,t),i&&(s=e.apply(l,r))),s}));return c.cancel=function(){clearTimeout(n),n=r=l=null},c},wrap:function(e,t){return Ze(t,e)},negate:st,compose:function(){var e=arguments,t=e.length-1;return function(){for(var i=t,n=e[t].apply(this,arguments);i--;)n=e[i].call(this,n);return n}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:lt,once:at,findKey:ct,findIndex:dt,findLastIndex:ht,sortedIndex:pt,indexOf:bt,lastIndexOf:$t,find:gt,detect:gt,findWhere:function(e,t){return gt(e,Fe(t))},each:mt,forEach:mt,map:wt,collect:wt,reduce:yt,foldl:yt,inject:yt,reduceRight:xt,foldr:xt,filter:_t,select:_t,reject:function(e,t,i){return _t(e,st(Re(t)),i)},every:At,all:At,some:Et,any:Et,contains:kt,includes:kt,include:kt,invoke:Vt,pluck:It,where:function(e,t){return _t(e,Fe(t))},max:Tt,min:function(e,t,i){var n,o,r=1/0,s=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var l=0,a=(e=tt(e)?e:we(e)).length;l<a;l++)null!=(n=e[l])&&n<r&&(r=n);else t=Re(t,i),mt(e,(function(e,i,n){((o=t(e,i,n))<s||o===1/0&&r===1/0)&&(r=e,s=o)}));return r},shuffle:function(e){return Ft(e,1/0)},sample:Ft,sortBy:function(e,t,i){var n=0;return t=Re(t,i),It(wt(e,(function(e,i,o){return{value:e,index:n++,criteria:t(e,i,o)}})).sort((function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index-t.index})),"value")},groupBy:Pt,indexBy:Lt,countBy:Ot,partition:Rt,toArray:jt,size:function(e){return null==e?0:tt(e)?e.length:ee(e).length},pick:Nt,omit:Ut,first:Mt,head:Mt,take:Mt,initial:zt,last:function(e,t,i){return null==e||e.length<1?null==t||i?void 0:[]:null==t||i?e[e.length-1]:Wt(e,Math.max(0,e.length-t))},rest:Wt,tail:Wt,drop:Wt,compact:function(e){return _t(e,Boolean)},flatten:function(e,t){return it(e,t,!1)},without:Dt,uniq:qt,unique:qt,union:Jt,intersection:function(e){for(var t=[],i=arguments.length,n=0,o=Q(e);n<o;n++){var r=e[n];if(!kt(t,r)){var s;for(s=1;s<i&&kt(arguments[s],r);s++);s===i&&t.push(r)}}return t},difference:Ht,unzip:Kt,transpose:Kt,zip:Yt,object:function(e,t){for(var i={},n=0,o=Q(e);n<o;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},range:function(e,t,i){null==t&&(t=e||0,e=0),i||(i=t<e?-1:1);for(var n=Math.max(Math.ceil((t-e)/i),0),o=Array(n),r=0;r<n;r++,e+=i)o[r]=e;return o},chunk:function(e,t){if(null==t||t<1)return[];for(var i=[],n=0,o=e.length;n<o;)i.push(s.call(e,n,n+=t));return i},mixin:Xt,default:ie},Zt=Xt(Qt);return Zt._=Zt,Zt})),function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],(function(i,n,o){t.Backbone=e(t,o,i,n)}));else if("undefined"!=typeof exports){var i,n=require("underscore");try{i=require("jquery")}catch(e){}e(t,exports,n,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}((function(e,t,i,n){var o=e.Backbone,r=Array.prototype.slice;t.VERSION="1.4.1",t.$=n,t.noConflict=function(){return e.Backbone=o,this},t.emulateHTTP=!1,t.emulateJSON=!1;var s,l=t.Events={},a=/\s+/,c=function(e,t,n,o,r){var s,l=0;if(n&&"object"==typeof n){void 0!==o&&"context"in r&&void 0===r.context&&(r.context=o);for(s=i.keys(n);l<s.length;l++)t=c(e,t,s[l],n[s[l]],r)}else if(n&&a.test(n))for(s=n.split(a);l<s.length;l++)t=e(t,s[l],o,r);else t=e(t,n,o,r);return t};l.on=function(e,t,i){return this._events=c(u,this._events||{},e,t,{context:i,ctx:this,listening:s}),s&&((this._listeners||(this._listeners={}))[s.id]=s,s.interop=!1),this},l.listenTo=function(e,t,n){if(!e)return this;var o=e._listenId||(e._listenId=i.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),l=s=r[o];l||(this._listenId||(this._listenId=i.uniqueId("l")),l=s=r[o]=new $(this,e));var a=d(e,t,n,this);if(s=void 0,a)throw a;return l.interop&&l.on(t,n),this};var u=function(e,t,i,n){if(i){var o=e[t]||(e[t]=[]),r=n.context,s=n.ctx,l=n.listening;l&&l.count++,o.push({callback:i,context:r,ctx:r||s,listening:l})}return e},d=function(e,t,i,n){try{e.on(t,i,n)}catch(e){return e}};l.off=function(e,t,i){return this._events?(this._events=c(h,this._events,e,t,{context:i,listeners:this._listeners}),this):this},l.stopListening=function(e,t,n){var o=this._listeningTo;if(!o)return this;for(var r=e?[e._listenId]:i.keys(o),s=0;s<r.length;s++){var l=o[r[s]];if(!l)break;l.obj.off(t,n,this),l.interop&&l.off(t,n)}return i.isEmpty(o)&&(this._listeningTo=void 0),this};var h=function(e,t,n,o){if(e){var r,s=o.context,l=o.listeners,a=0;if(t||s||n){for(r=t?[t]:i.keys(e);a<r.length;a++){var c=e[t=r[a]];if(!c)break;for(var u=[],d=0;d<c.length;d++){var h=c[d];if(n&&n!==h.callback&&n!==h.callback._callback||s&&s!==h.context)u.push(h);else{var p=h.listening;p&&p.off(t,n)}}u.length?e[t]=u:delete e[t]}return e}for(r=i.keys(l);a<r.length;a++)l[r[a]].cleanup()}};l.once=function(e,t,i){var n=c(p,{},e,t,this.off.bind(this));return"string"==typeof e&&null==i&&(t=void 0),this.on(n,t,i)},l.listenToOnce=function(e,t,i){var n=c(p,{},t,i,this.stopListening.bind(this,e));return this.listenTo(e,n)};var p=function(e,t,n,o){if(n){var r=e[t]=i.once((function(){o(t,r),n.apply(this,arguments)}));r._callback=n}return e};l.trigger=function(e){if(!this._events)return this;for(var t=Math.max(0,arguments.length-1),i=Array(t),n=0;n<t;n++)i[n]=arguments[n+1];return c(f,this._events,e,void 0,i),this};var f=function(e,t,i,n){if(e){var o=e[t],r=e.all;o&&r&&(r=r.slice()),o&&b(o,n),r&&b(r,[t].concat(n))}return e},b=function(e,t){var i,n=-1,o=e.length,r=t[0],s=t[1],l=t[2];switch(t.length){case 0:for(;++n<o;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r);return;case 2:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r,s);return;case 3:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r,s,l);return;default:for(;++n<o;)(i=e[n]).callback.apply(i.ctx,t);return}},$=function(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0};$.prototype.on=l.on,$.prototype.off=function(e,t){var i;this.interop?(this._events=c(h,this._events,e,t,{context:void 0,listeners:void 0}),i=!this._events):(this.count--,i=0===this.count),i&&this.cleanup()},$.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},l.bind=l.on,l.unbind=l.off,i.extend(t,l);var g=t.Model=function(e,t){var n=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});var o=i.result(this,"defaults");n=i.defaults(i.extend({},o,n),o),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(g.prototype,l,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!i.iteratee(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;var o;if("object"==typeof e?(o=e,n=t):(o={})[e]=t,n||(n={}),!this._validate(o,n))return!1;var r=n.unset,s=n.silent,l=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=i.clone(this.attributes),this.changed={});var c=this.attributes,u=this.changed,d=this._previousAttributes;for(var h in o)t=o[h],i.isEqual(c[h],t)||l.push(h),i.isEqual(d[h],t)?delete u[h]:u[h]=t,r?delete c[h]:c[h]=t;if(this.idAttribute in o){var p=this.id;this.id=this.get(this.idAttribute),this.trigger("changeId",this,p,n)}if(!s){l.length&&(this._pending=n);for(var f=0;f<l.length;f++)this.trigger("change:"+l[f],this,c[l[f]],n)}if(a)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&i.clone(this.changed);var t,n=this._changing?this._previousAttributes:this.attributes,o={};for(var r in e){var s=e[r];i.isEqual(n[r],s)||(o[r]=s,t=!0)}return!!t&&o},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=i.extend({parse:!0},e);var t=this,n=e.success;return e.success=function(i){var o=e.parse?t.parse(i,e):i;if(!t.set(o,e))return!1;n&&n.call(e.context,t,i,e),t.trigger("sync",t,i,e)},H(this,e),this.sync("read",this,e)},save:function(e,t,n){var o;null==e||"object"==typeof e?(o=e,n=t):(o={})[e]=t;var r=(n=i.extend({validate:!0,parse:!0},n)).wait;if(o&&!r){if(!this.set(o,n))return!1}else if(!this._validate(o,n))return!1;var s=this,l=n.success,a=this.attributes;n.success=function(e){s.attributes=a;var t=n.parse?s.parse(e,n):e;if(r&&(t=i.extend({},o,t)),t&&!s.set(t,n))return!1;l&&l.call(n.context,s,e,n),s.trigger("sync",s,e,n)},H(this,n),o&&r&&(this.attributes=i.extend({},a,o));var c=this.isNew()?"create":n.patch?"patch":"update";"patch"!==c||n.attrs||(n.attrs=o);var u=this.sync(c,this,n);return this.attributes=a,u},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,o=e.wait,r=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(i){o&&r(),n&&n.call(e.context,t,i,e),t.isNew()||t.trigger("sync",t,i,e)};var s=!1;return this.isNew()?i.defer(e.success):(H(this,e),s=this.sync("delete",this,e)),o||r(),s},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||W();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1)}});var m=t.Collection=function(e,t){t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},w={add:!0,remove:!0,merge:!0},v={add:!0,remove:!1},y=function(e,t,i){i=Math.min(Math.max(i,0),e.length);var n,o=Array(e.length-i),r=t.length;for(n=0;n<o.length;n++)o[n]=e[n+i];for(n=0;n<r;n++)e[n+i]=t[n];for(n=0;n<o.length;n++)e[n+r+i]=o[n]};i.extend(m.prototype,l,{model:g,preinitialize:function(){},initialize:function(){},toJSON:function(e){return this.map((function(t){return t.toJSON(e)}))},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,v))},remove:function(e,t){t=i.extend({},t);var n=!i.isArray(e);e=n?[e]:e.slice();var o=this._removeModels(e,t);return!t.silent&&o.length&&(t.changes={added:[],merged:[],removed:o},this.trigger("update",this,t)),n?o[0]:o},set:function(e,t){if(null!=e){(t=i.extend({},w,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var n=!i.isArray(e);e=n?[e]:e.slice();var o=t.at;null!=o&&(o=+o),o>this.length&&(o=this.length),o<0&&(o+=this.length+1);var r,s,l=[],a=[],c=[],u=[],d={},h=t.add,p=t.merge,f=t.remove,b=!1,$=this.comparator&&null==o&&!1!==t.sort,g=i.isString(this.comparator)?this.comparator:null;for(s=0;s<e.length;s++){r=e[s];var m=this.get(r);if(m){if(p&&r!==m){var v=this._isModel(r)?r.attributes:r;t.parse&&(v=m.parse(v,t)),m.set(v,t),c.push(m),$&&!b&&(b=m.hasChanged(g))}d[m.cid]||(d[m.cid]=!0,l.push(m)),e[s]=m}else h&&(r=e[s]=this._prepareModel(r,t))&&(a.push(r),this._addReference(r,t),d[r.cid]=!0,l.push(r))}if(f){for(s=0;s<this.length;s++)d[(r=this.models[s]).cid]||u.push(r);u.length&&this._removeModels(u,t)}var x=!1,_=!$&&h&&f;if(l.length&&_?(x=this.length!==l.length||i.some(this.models,(function(e,t){return e!==l[t]})),this.models.length=0,y(this.models,l,0),this.length=this.models.length):a.length&&($&&(b=!0),y(this.models,a,null==o?this.length:o),this.length=this.models.length),b&&this.sort({silent:!0}),!t.silent){for(s=0;s<a.length;s++)null!=o&&(t.index=o+s),(r=a[s]).trigger("add",r,this,t);(b||x)&&this.trigger("sort",this,t),(a.length||u.length||c.length)&&(t.changes={added:a,removed:u,merged:c},this.trigger("update",this,t))}return n?e[0]:e}},reset:function(e,t){t=t?i.clone(t):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return r.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e,e.idAttribute)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var n=t.length;return i.isFunction(t)&&(t=t.bind(this)),1===n||i.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){var t=(e=i.extend({parse:!0},e)).success,n=this;return e.success=function(i){var o=e.reset?"reset":"set";n[o](i,e),t&&t.call(e.context,n,i,e),n.trigger("sync",n,i,e)},H(this,e),this.sync("read",this,e)},create:function(e,t){var n=(t=t?i.clone(t):{}).wait;if(!(e=this._prepareModel(e,t)))return!1;n||this.add(e,t);var o=this,r=t.success;return t.success=function(e,t,i){n&&o.add(e,i),r&&r.call(i.context,e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e,t){return e[t||this.model.prototype.idAttribute||"id"]},values:function(){return new _(this,A)},keys:function(){return new _(this,E)},entries:function(){return new _(this,k)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){return this._isModel(e)?(e.collection||(e.collection=this),e):((t=t?i.clone(t):{}).collection=this,(n=this.model.prototype?new this.model(e,t):this.model(e,t)).validationError?(this.trigger("invalid",this,n.validationError,t),!1):n);var n},_removeModels:function(e,t){for(var i=[],n=0;n<e.length;n++){var o=this.get(e[n]);if(o){var r=this.indexOf(o);this.models.splice(r,1),this.length--,delete this._byId[o.cid];var s=this.modelId(o.attributes,o.idAttribute);null!=s&&delete this._byId[s],t.silent||(t.index=r,o.trigger("remove",o,this,t)),i.push(o),this._removeReference(o,t)}}return i},_isModel:function(e){return e instanceof g},_addReference:function(e,t){this._byId[e.cid]=e;var i=this.modelId(e.attributes,e.idAttribute);null!=i&&(this._byId[i]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var i=this.modelId(e.attributes,e.idAttribute);null!=i&&delete this._byId[i],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){if(t){if(("add"===e||"remove"===e)&&i!==this)return;if("destroy"===e&&this.remove(t,n),"changeId"===e){var o=this.modelId(t.previousAttributes(),t.idAttribute),r=this.modelId(t.attributes,t.idAttribute);null!=o&&delete this._byId[o],null!=r&&(this._byId[r]=t)}}this.trigger.apply(this,arguments)}});var x="function"==typeof Symbol&&Symbol.iterator;x&&(m.prototype[x]=m.prototype.values);var _=function(e,t){this._collection=e,this._kind=t,this._index=0},A=1,E=2,k=3;x&&(_.prototype[x]=function(){return this}),_.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var e,t=this._collection.at(this._index);if(this._index++,this._kind===A)e=t;else{var i=this._collection.modelId(t.attributes,t.idAttribute);e=this._kind===E?i:[i,t]}return{value:e,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var V=t.View=function(e){this.cid=i.uniqueId("view"),this.preinitialize.apply(this,arguments),i.extend(this,i.pick(e,T)),this._ensureElement(),this.initialize.apply(this,arguments)},I=/^(\S+)\s*(.*)$/,T=["model","collection","el","id","attributes","className","tagName","events"];i.extend(V.prototype,l,{tagName:"div",$:function(e){return this.$el.find(e)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=i.result(this,"events")),!e)return this;for(var t in this.undelegateEvents(),e){var n=e[t];if(i.isFunction(n)||(n=this[n]),n){var o=t.match(I);this.delegate(o[1],o[2],n.bind(this))}}return this},delegate:function(e,t,i){return this.$el.on(e+".delegateEvents"+this.cid,t,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,i){return this.$el.off(e+".delegateEvents"+this.cid,t,i),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e.class=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}});var S=function(e,t,n,o){i.each(n,(function(i,n){t[n]&&(e.prototype[n]=function(e,t,i,n){switch(t){case 1:return function(){return e[i](this[n])};case 2:return function(t){return e[i](this[n],t)};case 3:return function(t,o){return e[i](this[n],j(t,this),o)};case 4:return function(t,o,r){return e[i](this[n],j(t,this),o,r)};default:return function(){var t=r.call(arguments);return t.unshift(this[n]),e[i].apply(e,t)}}}(t,i,n,o))}))},j=function(e,t){return i.isFunction(e)?e:i.isObject(e)&&!t._isModel(e)?F(e):i.isString(e)?function(t){return t.get(e)}:e},F=function(e){var t=i.matches(e);return function(e){return t(e.attributes)}};i.each([[m,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"],[g,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],(function(e){var t=e[0],n=e[1],o=e[2];t.mixin=function(e){var n=i.reduce(i.functions(e),(function(e,t){return e[t]=0,e}),{});S(t,e,n,o)},S(t,i,n,o)})),t.sync=function(e,n,o){var r=B[e];i.defaults(o||(o={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var s={type:r,dataType:"json"};if(o.url||(s.url=i.result(n,"url")||W()),null!=o.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(o.attrs||n.toJSON(o))),o.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),o.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){s.type="POST",o.emulateJSON&&(s.data._method=r);var l=o.beforeSend;o.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",r),l)return l.apply(this,arguments)}}"GET"===s.type||o.emulateJSON||(s.processData=!1);var a=o.error;o.error=function(e,t,i){o.textStatus=t,o.errorThrown=i,a&&a.call(o.context,e,t,i)};var c=o.xhr=t.ajax(i.extend(s,o));return n.trigger("request",n,c,o),c};var B={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var P=t.Router=function(e){e||(e={}),this.preinitialize.apply(this,arguments),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},L=/\((.*?)\)/g,O=/(\(\?)?:\w+/g,R=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(P.prototype,l,{preinitialize:function(){},initialize:function(){},route:function(e,n,o){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(o=n,n=""),o||(o=this[n]);var r=this;return t.history.route(e,(function(i){var s=r._extractParameters(e,i);!1!==r.execute(o,s,n)&&(r.trigger.apply(r,["route:"+n].concat(s)),r.trigger("route",n,s),t.history.trigger("route",r,n,s))})),this},execute:function(e,t,i){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(C,"\\$&").replace(L,"(?:$1)?").replace(O,(function(e,t){return t?e:"([^/?]+)"})).replace(R,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,(function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null}))}});var N=t.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},U=/^[#\/]|\s+$/g,z=/^\/+|\/+$/g,M=/#.*$/;N.started=!1,i.extend(N.prototype,l,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(U,"")},start:function(e){if(N.started)throw new Error("Backbone.history has already been started");if(N.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(z,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,o=n.insertBefore(this.iframe,n.firstChild).contentWindow;o.document.open(),o.document.close(),o.location.hash="#"+this.fragment}var r=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),N.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),i.some(this.handlers,(function(t){if(t.route.test(e))return t.callback(e),!0})))},navigate:function(e,t){if(!N.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");var i=this.root;""!==e&&"?"!==e.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+e;e=e.replace(M,"");var o=this.decodeFragment(e);if(this.fragment!==o){if(this.fragment=o,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;t.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new N,g.extend=m.extend=P.extend=V.extend=N.extend=function(e,t){var n,o=this;return n=e&&i.has(e,"constructor")?e.constructor:function(){return o.apply(this,arguments)},i.extend(n,o,t),n.prototype=i.create(o.prototype,e),n.prototype.constructor=n,n.__super__=o.prototype,n};var W=function(){throw new Error('A "url" property or function must be specified')},H=function(e,t){var i=t.error;t.error=function(n){i&&i.call(t.context,e,n,t),e.trigger("error",e,n,t)}};return t}))}();let L=[],O=[];function R(t){try{t||($$("dashboards")||$$("container").addView({view:"layout",id:"dashboards",hidden:!0,scroll:"auto",rows:[{view:"scrollview",id:"dashScroll",body:{view:"flexlayout",id:"dashboardContainer",cols:[{id:"dashboardInfoContainer",minWidth:250,rows:[]},{view:"resizer"},e]}}]},3),$$("tables")||$$("container").addView({id:"tables",hidden:!0,view:"scrollview",body:{view:"flexlayout",cols:[{id:"tableContainer",rows:[E(0,"table-exportBtn","table-editTableBtnId","table-findElements","table-idFilterElements","table","table-filterId"),{view:"resizer",class:"webix_resizers"},k("table",V,!0)]},{view:"resizer",class:"webix_resizers"},u,F]}},5),$$("forms")||$$("container").addView({view:"layout",id:"forms",css:"webix_tableView",hidden:!0,rows:[E(0,"table-view-exportBtn","table-view-editTableBtnId","table-view-findElements","table-view-idFilterElements","table-view","table-view-filterIdView",!0),{view:"resizer",class:"webix_resizers"},{view:"scrollview",body:{view:"flexlayout",cols:[k("table-view"),{view:"resizer",class:"webix_resizers",id:"propResize",hidden:!0},("propTableView",{view:"property",id:"propTableView",tooltip:"Имя: #label#<br> Значение: #value#",width:350,nameWidth:150,editable:!0,scroll:!0,hidden:!0})]}}]},6)),"treeTempl"==t&&($$("treeTempl")||($$("container").addView({view:"layout",id:"treeTempl",hidden:!0,scroll:"auto",rows:[{id:"treeEditContainer",cols:[{rows:[{view:"edittree",id:"treeEdit",editable:!0,editor:"text",editValue:"value",css:"webix_tree-edit",editaction:"dblclick",data:[],on:{onAfterEditStop:function(e,t,i){try{let i="/init/default/api/trees/";if(e.value!=e.old){let o=$$("treeEdit").getParentId(t.id),r={name:e.value,pid:o,id:t.id,owner:null,descr:"",ttype:1,value:"",cdt:null};webix.ajax().put(i+t.id,r).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?n("success","Данные изменены"):s("013-011",e.json().err,!0)})).fail((function(e){console.log(e),l("013-011",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),s("012-011",e)}}}}]},{}]}]},4),webix.ui({view:"contextmenu",id:"contextMenuEditTree",data:["Добавить","Переименовать",{$template:"Separator"},"Свернуть всё","Развернуть всё",{$template:"Separator"},"Удалить"],master:$$("treeEdit"),on:{onMenuItemClick:function(e){let t=this.getContext(),i=$$("treeEdit"),o=i.getItem(t.id),r=this.getMenu(e).getItem(e).value,a="/init/default/api/trees/",c={name:"",pid:"",owner:null,descr:"",ttype:1,value:"",cdt:null};try{switch(r){case"Добавить":{let e=prompt("Имя нового подэлемента '"+o.value+"'","");null!=e&&(console.log(o.id),c.name=e,c.pid=o.id,webix.ajax().post(a,c).then((function(t){if("e"!==t.json().err_type&&"x"!==t.json().err_type){let r=t.json().content.id;i.data.add({id:r,value:e,pid:o.id},0,o.id),i.open(o.id),n("success","Данные сохранены")}else s("013-001",t.json().err,!0)})).fail((function(e){console.log(e),l("013-001",e.status,e.statusText,e.responseURL)})));break}case"Переименовать":var u=prompt("Новое имя",o.value);null!=u&&(c.name=u,c.id=o.id,c.pid=o.pid,webix.ajax().put(a+o.id,c).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?(o.value=u,i.updateItem(o.id,o),n("success","Данные изменены")):s("013-011",e.json().err,!0)})).fail((function(e){console.log(e),l("013-011",e.status,e.statusText,e.responseURL)})));break;case"Удалить":webix.ajax().del(a+o.id).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?(i.remove(o.id),n("success","Данные удалены")):s("013-002",e.json().err,!0)})).fail((function(e){console.log(e),l("013-002",e.status,e.statusText,e.responseURL)}));break;case"Развернуть всё":try{i.open(o.id),i.data.eachSubItem(o.id,(function(e){i.open(e.id)}))}catch(e){console.log(e),s("013-000",e)}break;case"Свернуть всё":try{i.close(o.id),i.data.eachSubItem(o.id,(function(e){i.close(e.id)}))}catch(e){console.log(e),s("013-000",e)}}}catch(e){console.log(e),s("013-000",e)}}}}))),"cp"==t&&$$("container").addView({view:"layout",id:"user_auth",css:"webix_auth",hidden:!0,rows:[I,{}]},7),"userprefs"==t&&$$("container").addView({view:"layout",id:"userprefs",css:"webix_auth",hidden:!0,rows:[j]},8)}catch(e){console.log(e),s("015-004",e)}}function C(){try{$$("tables")&&$$("container").removeView($$("tables")),$$("dashboards")&&$$("container").removeView($$("dashboards")),$$("forms")&&$$("container").removeView($$("forms")),$$("user_auth")&&$$("container").removeView($$("user_auth"))}catch(e){console.log(e),s("015-004",e)}}function N(e,t){return webix.ajax("/init/default/api/whoami",{success:function(i,n,o){$$("userAuth").hide(),$$("mainLayout").show(),L.push(n.json().content.first_name,n.json().content.username),R(),webix.ajax().get("/init/default/api/fields.json",!1).then((function(i){let n=i.json().content,r=Object.keys(n),a={tables:[],forms:[],dashboards:[],treeConf:[]};try{$$("tree").unselectAll(),r.forEach((function(e){"treeConf"==n[e].type&&(a.treeConf.push({id:e,value:n[e].plural,type:n[e].type}),O.push({name:n[e].plural,id:e})),"dbtable"==n[e].type&&(n[e].plural?(a.tables.push({id:e,value:n[e].plural,type:n[e].type}),O.push({name:n[e].plural,id:e})):n[e].singular&&(a.tables.push({id:e,value:n[e].singular,type:n[e].type}),O.push({name:n[e].singular,id:e}))),"tform"==n[e].type&&(n[e].plural?(a.forms.push({id:e,value:n[e].plural,type:n[e].type}),O.push({name:n[e].plural,id:e})):n[e].singular&&(a.forms.push({id:e,value:n[e].singular,type:n[e].type}),O.push({name:n[e].singular,id:e}))),"dashboard"==n[e].type&&(n[e].plural?(a.dashboards.push({id:e,value:n[e].plural,type:n[e].type}),O.push({name:n[e].plural,id:e})):n[e].singular&&(a.dashboards.push({id:e,value:n[e].singular,type:n[e].type}),O.push({name:n[e].singular,id:e})))}))}catch(e){console.log(e),s("015-000",e)}webix.ajax().get("/init/default/api/mmenu.json").then((function(e){let t,i=e.json().mmenu,o=[],l=[],c=[];t=window.location.host.includes("localhost:3000")?"/index.html/":"/init/default/spaw/";try{i.forEach((function(e,i){if("user_auth"!=e.name&&"userprefs"!=e.name||(e.childs.length>0&&(e.childs.forEach((function(e,i){"login"==e.name?c.push({id:e.name,value:e.title,href:t+e.name}):"logout"!==e.name&&l.push({id:e.name,value:e.title,href:t+e.name}),O.push({name:e.title,id:e.name})})),e.childs.forEach((function(e,t){"logout"==e.name&&l.push({id:e.name,value:e.title,css:"webix_logout"}),O.push({name:e.title,id:e.name})}))),e.childs.length<=0&&l.push({id:e.name,value:e.title,href:t+e.name})),e.childs.length>0&&(a[e.name]=[],e.childs.forEach((function(t,i){a[e.name].push({id:t.name,value:t.title}),O.push({name:t.title,id:t.name})}))),e.name.includes("delim"));else{let t;r.forEach((function(i){i==e.name&&(t=e.title,o.push({id:e.name+"-single",value:e.title,typeof:n[i].type}))})),t||(e.title?e.typeof?o.push({id:e.name,value:e.title,typeof:e.typeof,data:a[e.name]}):o.push({id:e.name,value:e.title,data:a[e.name]}):o.push({id:e.name,value:"Без названия",data:a[e.name]}))}})),$$("tree").clearAll(),$$("tree").parse(o),$$("button-context-menu").config.popup.data=l,$$("button-context-menu").enable()}catch(e){console.log(e),s("015-000",e)}})).catch((e=>{console.log(e),l("015-000",o.status,o.statusText,o.responseURL)})),$$("tree").attachEvent("onAfterSelect",(function(t){e.navigate("tree/"+t,{trigger:!0})})),"userprefs"==t&&$$("userprefsName").setValues(L[0].toString()),"cp"==t&&$$("authName").setValues(L[0].toString())})).catch((e=>{console.log(e),l("015-000",e.status,e.statusText,e.responseURL)}))},error:function(t,i,n){e.navigate("",{trigger:!0}),l("015-006",n.status,n.statusText,n.responseURL)}})}function U(){try{$$("container").getChildViews().forEach((function(e,t){"scrollview"!=e.config.view&&"layout"!=e.config.view||$$(e.config.id).isVisible()&&$$(e.config.id).hide()}))}catch(e){console.log(e),s("015-000",e)}}"/index.html"!==window.location.pathname&&"/"!==window.location.pathname&&"/init/default/spaw/"!==window.location.pathname&&i("",window.location.href);let z="";console.log("expa 1.0.24");try{webix.ready((function(){webix.protoUI({name:"edittree"},webix.EditAbility,webix.ui.tree),webix.ui({view:"scrollview",type:"clean",id:"layout",css:"layoutContainer",scroll:"y",body:{cells:[{},{hidden:!0,id:"userAuth",cols:[{},{rows:[{},(function(){let e=new(Backbone.Router.extend({routes:{"":"index",content:"content",userprefs:"userprefs",cp:"cp",logout:"logout","tree/:id":"tree","experimental/:id":"experimental"},content:function(){try{N(e).then((function(e){}))}catch(e){console.log(e),s("015-005",e)}},index:function(){webix.ajax("/init/default/api/whoami",{success:function(e,t,i){try{Backbone.history.navigate("content",{trigger:!0})}catch(e){console.log(e),s("015-005",e)}},error:function(e,t,i){$$("mainLayout").hide(),$$("userAuth").show(),l("015-015",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("015-007",e.status,e.statusText,e.responseURL)}))},tree:function(t){try{if(0==$$("tree").data.order.length){N(e);let i=t;$$("tree").attachEvent("onAfterLoad",(function(e){let t;e=i,$$("tree").getItem(e)?(t=$$("tree").getParentId(e),$$("tree").open(t),$$("tree").select(e)):setTimeout((function(){webix.ui({view:"popup",id:"popupNotFound",css:"webix_popup-prev-href",width:340,height:125,position:"center",body:{rows:[{rows:[{cols:[{template:"Что-то пошло не так...",width:250,css:"webix_template-not-found",borderless:!0,height:20},{},{view:"button",id:"buttonClosePopup",css:"webix_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){$$("popupNotFound").hide()}}]},{template:"Страница не найдена",css:"webix_template-not-found-descr",borderless:!0,height:35},{view:"button",css:"webix_btn-not-found-back",height:46,value:"Вернуться на главную",click:function(){$$("popupNotFound")&&$$("popupNotFound").destructor(),Backbone.history.navigate("content",{trigger:!0}),window.location.reload()}},{height:20}]}]}}).show()}),1500)}))}}catch(e){console.log(e),s("015-005",e)}},cp:function(){try{$$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),U(),$$("webix__none-content").hide(),0==$$("tree").data.order.length&&N(e,"cp"),$$("user_auth")?$$("user_auth").show():(R("cp"),$$("user_auth").show(),L.length>0&&$$("authName").setValues(L[0].toString())),$$("tree").closeAll()}catch(e){console.log(e),s("015-005",e)}},userprefs:function(){try{$$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),U(),$$("webix__none-content").hide(),0==$$("tree").data.order.length&&N(e,"userprefs"),$$("userprefs")?$$("userprefs").show():(R("userprefs"),webix.ajax().get("/init/default/api/userprefs/",{success:function(e,t,i){"e"==(t=t.json().content).err_type&&n("error",t.error),t.forEach((function(e,t){e.name.includes("userprefs")&&$$(e.name).setValues(JSON.parse(e.prefs))}))},error:function(e,t,i){l("016-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("016-000",e.status,e.statusText,e.responseURL)})),$$("userprefs").show(),L.length>0&&$$("userprefsName").setValues(L[0].toString())),$$("tree").closeAll()}catch(e){console.log(e),s("016-005",e)}},experimental:function(){console.log("exp");try{$$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),U(),$$("webix__none-content").hide(),0==$$("tree").data.order.length&&N(e),$$("treeTempl")?($$("treeTempl").show(),$()):(R("treeTempl"),$(),$$("treeTempl").show(),console.log($$("treeTempl")),console.log($$("treeTempl").isVisible())),$$("tree").closeAll()}catch(e){console.log(e),s("015-005",e)}},logout:function(){webix.ajax().post("/init/default/logout/",{success:function(e,t,i){try{history.back(),C(),$$("webix__none-content").show(),$$("tree").clearAll(),webix.storage.local.clear()}catch(e){console.log(e),n("error","Не удалось выполнить выход"),webix.message({type:"error",expire:3e3,text:"Не удалось выполнить выход"}),s("015-000",e)}},error:function(e,t,i){n("error","Не удалось выполнить выход"),webix.message({type:"error",expire:3e3,text:"Не удалось выполнить выход"}),l("015-006",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("015-006",e.status,e.statusText,e.responseURL)}))}}))}(),{view:"form",id:"formAuth",maxWidth:300,borderless:!0,elements:[{view:"text",label:"Логин",name:"username",invalidMessage:"Поле должно быть заполнено"},{view:"text",label:"Пароль",name:"password",invalidMessage:"Поле должно быть заполнено",type:"password"},{view:"button",value:"Войти",css:"webix_primary",hotkey:"enter",align:"center",click:function(){let e=$$("formAuth").getValues(),t=[];try{$$("formAuth").validate(),t.push("un="+e.username),t.push("np="+e.password),webix.ajax("/init/default/login?"+t.join("&"),{success:function(e,t,i){webix.ajax("/init/default/api/whoami",{success:function(e,t,i){try{let e=webix.storage.local.get("userLocation"),t=new XMLHttpRequest;t.open("HEAD",e.href,!1),t.send(),e&&e.href&&200==t.status?(window.location.replace(e.href),localStorage.removeItem("userLocation"),$$("formAuth")&&$$("formAuth").clear()):($$("formAuth")&&$$("formAuth").clear(),Backbone.history.navigate("content",{trigger:!0}),window.location.reload())}catch(e){console.log(e),s("007-005",e)}},error:function(e,t,i){$$("formAuth")&&$$("formAuth").isDirty()&&webix.message({type:"error",expire:3e3,text:"Неверный логин или пароль"}),l("007-006",i.status,i.statusText,i.responseURL)}})},error:function(e,t,i){webix.message({type:"error",expire:3e3,text:"Не удалось выполнить выход"}),l("007-006",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("007-006",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),s("007-000",e)}}}],rules:{username:webix.rules.isNotEmpty,password:webix.rules.isNotEmpty},elementsConfig:{labelPosition:"top"}}),{}]},{}]},{hidden:!0,id:"mainLayout",rows:[{id:"mainContent",css:"webix_mainContent",cols:[{rows:[{view:"toolbar",id:"header",padding:10,css:"webix_header-style",elements:[{cols:[{view:"button",type:"icon",id:"collapseBtn",icon:"wxi-angle-double-left",css:"webix_collapse",title:"текст",height:45,width:40,click:function(){try{window.innerWidth>850?$$("tree").isVisible()?(this.config.icon="wxi-angle-double-right",this.refresh(),$$("tree").hide(),$$("sideMenuResizer")&&$$("sideMenuResizer").hide()):($$("tree").show(),this.config.icon="wxi-angle-double-left",this.refresh(),window.innerWidth>=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").show()):$$("tree").isVisible()?(this.config.icon="wxi-angle-double-right",this.refresh(),$$("tree").hide(),$$("sideMenuResizer")&&$$("sideMenuResizer").hide()):($$("tree").show(),console.log(window.innerHeight),$$("tree").config.width=window.innerWidth,$$("tree").resize(),this.config.icon="wxi-angle-double-left",this.refresh(),window.innerWidth>=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").show())}catch(e){console.log(e),s("009-000",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Видимость бокового меню")}}},{view:"label",label:"<img src='/init/static/images/expalogo.png' style='height:30px; margin: 10px;'>",height:30}]},{},{view:"search",placeholder:"Поиск",css:"searchTable",maxWidth:250,minWidth:40},{view:"button",id:"webix_log-btn",type:"icon",icon:"wxi-eye-slash",height:48,badge:0,width:60,css:"webix_log-btn",click:function(){1==this.getValue()?this.setValue(2):this.setValue(1)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть системные сообщения")},onChange:function(e,t,i){let n=$$("logBlock-list").getLastId();2==e?(this.config.badge="",$$("logBlock-list").showItem(n),$$("logLayout").config.height=90,$$("logLayout").resize(),this.config.icon="wxi-eye-slash",this.refresh()):($$("logLayout").config.height=5,$$("logLayout").resize(),this.config.icon="wxi-eye",this.refresh(),$$("webix_log-btn").config.badge="",$$("webix_log-btn").refresh())}}},{view:"button",id:"button-context-menu",type:"icon",disabled:!0,icon:"wxi-user",height:48,width:60,popup:{view:"contextmenu",id:"contextmenu",css:"webix_contextmenu",data:[],on:{onItemClick:function(e,t,i){try{if("logout"==e){if($$("table-editForm")&&$$("table-editForm").isDirty()||$$("cp-form")&&$$("cp-form").isDirty())return m().then((function(e){if(1==e)Backbone.history.navigate("logout",{trigger:!0});else if(2==e&&($$("cp-form")||$$("table-editForm")))if($$("cp-form")&&$$("cp-form").isDirty()&&$$("cp-form").validate()){let e={op:"",np:""},t=$$("cp-form").getValues();e.np=t.newPass,e.op=t.oldPass,webix.ajax().post("/init/default/api/cp",e,{success:function(e,t,i){"i"==(t=t.json()).err_type?n("success",t.err):"e"==t.err_type&&n("error",t.err)},error:function(e,t,i){l("011-000",i.status,i.statusText,i.responseURL)}}),Backbone.history.navigate("logout",{trigger:!0})}else{if(!($$("table-editForm")&&$$("table-editForm").isDirty()&&$$("table-editForm").validate()))return n("error","Заполните пустые поля"),!1;$$("table-editForm").getValues().id?v():y(),Backbone.history.navigate("logout",{trigger:!0})}})),!1;Backbone.history.navigate("logout",{trigger:!0})}}catch(e){console.log(e),s("005-000",e)}}}},on:{onItemClick:function(){try{i(O,void 0)}catch(e){console.log(e),s("005-000",e)}}}}]},{id:"adaptive",rows:[]},{cols:[{view:"edittree",id:"tree",css:"webix_tree-main",minWidth:100,width:250,editable:!1,select:!0,editor:"text",editValue:"value",activeTitle:!0,clipboard:!0,data:[],on:{onSelectChange:function(e){z=e[0];let t=$$("tree").getSelectedItem().id,i=$$("tree").getParentId(t),n=$$("tree").data.order,o=[],r="";try{$$("inputsTable")&&($$("table-editForm").removeView($$("inputsTable")),$$("EditEmptyTempalte").show()),$$("treeTempl")&&!$$(e)&&$$("treeTempl").hide(),n.forEach((function(e,t){0==$$("tree").getParentId(e)&&o.push(e)})),t.includes("single")&&(r=$$("tree").getSelectedItem().typeof),(e[0]&&0!==i||r)&&$$("webix__none-content").hide()}catch(e){console.log(e),s("009-000",e)}function l(e,t){try{return $$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),$$("user_auth")&&$$("user_auth").isVisible()&&$$("user_auth").hide(),$$("userprefs")&&$$("userprefs").isVisible()&&$$("userprefs").hide(),void 0!==t?o.forEach((function(i,n){i.includes("single")?e&&$$(e).hide():("treeTempl"!==t?($$("webix__none-content").isVisible()&&$$("webix__none-content").hide(),$$("webix__null-content")||$$("container").addView({view:"align",align:"middle,center",id:"webix__null-content",body:{borderless:!0,template:"Блок в процессе разработки",height:50,width:220,css:{color:"#858585","font-size":"14px!important"}}},2)):$$("webix__none-content").isVisible()||($$("webix__none-content").show(),$$("container").getChildViews().forEach((function(e,t){"webix__none-content"!==e.config.id&&0==e.config.hidden&&$$(e.config.id).hide()}))),i!==t&&$$(i)&&$$(i).hide())})):o.forEach((function(t,n){t.includes("single")?e&&$$(e).show():t==i?$$(t)?$$(t).show():$$("webix__null-content")||$$("container").addView({view:"align",align:"middle,center",id:"webix__null-content",body:{borderless:!0,template:"Блок в процессе разработки",height:50,width:220,css:{color:"#858585","font-size":"14px!important"}}},2):($$(t)||"treeTempl"==t)&&$$(t)&&$$(t).hide()}))}catch(e){console.log(e),s("009-000",e)}}try{"tables"==i||"dbtable"==r?l("tables"):"dashboards"==i||"dashboard"==r?l("dashboards"):"forms"==i||"tform"==r?($$("propTableView")&&$$("propTableView").isVisible()&&$$("propTableView").hide(),l("forms")):"user_auth"==i?l():0!=i||"tables"===t||"user_auth"===t||"dashboards"===t||"forms"===t||r?"treeTempl"==i&&l():l(!1,e[0]),"tables"==i||"dbtable"==r?(A(),0!==Object.keys($$("table-editForm").elements).length&&$$("inputsTable").hide(),"dbtable"==r?f("table",0,e[0],"table-findElements",!0):f("table",0,e[0],"table-findElements")):"dashboards"==i?b():"dashboard"==r?b(e[0],!0):"forms"==i?f("table-view",0,e[0],"table-view-findElements"):"tform"==r?f("table-view",0,e[0],"table-view-findElements",!0):"treeTempl"==i&&$()}catch(e){console.log(e),s("009-000",e)}},onItemClick:function(e,t,i){if($$("table-editForm").isDirty())return m().then((function(t){if(1==t)_(),$$("tree").select(e);else if(2==t){if(!$$("table-editForm").validate())return n("error","Заполните пустые поля"),!1;$$("table-editForm").getValues().id?v():y(),$$("tree").select(e)}})),!1},onBeforeSelect:function(e){if("tables"==$$("tree").getParentId(e)&&$$("filterTableForm")&&$$("filterTableForm").isVisible){$$("filterTableForm").hide(),$$("inputsFilter")&&$$("filterTableForm").removeView($$("inputsFilter"));let e=document.querySelector(".webix_btn-filter");e&&!e.classList.contains("webix_secondary")&&(e.classList.add("webix_secondary"),e.classList.remove("webix_primary")),$$("table-editTableBtnId").hide(),$$("table-editForm").show()}},onAfterSelect:function(){window.innerWidth<850&&this.hide()}}},{id:"sideMenuResizer",view:"resizer",css:"webix_resizer-hide"},{id:"container",cols:[{view:"align",align:"middle,center",id:"webix__none-content",body:{borderless:!0,template:"Выберите элемент дерева",height:50,width:210,css:{color:"#858585","font-size":"14px!important"}}}]}]}]}]},{view:"resizer",id:"log-resizer"},r]}]}}),window.addEventListener("resize",(function(e){if(window.innerWidth<850&&$$("tree")&&$$("tree").isVisible()&&$$("tree").hide(),$$("tree").isVisible()||window.innerWidth<=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").hide(),window.innerWidth>850&&$$("tree")&&($$("tree").config.width=250,$$("tree").resize()),window.innerWidth<830&&!$$("contextActionsBtn")){if($$("customInputsMain")){const e=$$("table-view-filterIdView").getParentView();let t;t=Object.values($$("customInputs")._collection),t.forEach((function(e,t){e.bottomPadding=10,e.width&&delete e.width,e.minWidth&&delete e.minWidth,e.maxWidth&&delete e.maxWidth})),$$("customInputsMain").getParentView().removeView($$("customInputsMain")),t={id:"customInputsAdaptive",rows:[{id:"customInputs",rows:t}]},$$(e.config.id).addView({view:"button",id:"contextActionsBtnAdaptive",maxWidth:100,value:"Действия",css:"webix_primary",popup:webix.ui({view:"popup",css:"webix_popup-actions-container webix_popup-config",modal:!0,id:"contextActionsPopup",escHide:!0,position:"center",width:400,body:{rows:[{cols:[{template:"Доступные действия",css:"webix_template-actions",borderless:!0,height:40},{view:"button",id:"buttonClosePopupActions",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("contextActionsPopup")&&$$("contextActionsPopup").hide()}}]},{view:"scrollview",borderless:!0,scroll:"y",body:{id:"contextActionsPopupContainer",css:"webix_context-actions-popup",rows:[t]}}]}}),click:function(){$$("contextActionsPopup").config.height!==$$("customInputsAdaptive").$height+60&&($$("contextActionsPopup").config.height=$$("customInputsAdaptive").$height+60,$$("contextActionsPopup").resize())}},2)}}else if((window.innerWidth>830&&$$("contextActionsBtnAdaptive")||window.innerWidth>830&&$$("contextActionsBtn"))&&$$("customInputsAdaptive")){const e=$$("table-view-filterIdView").getParentView(),t={id:"customInputs",cols:$$("customInputsAdaptive")._collection[0].rows};$$("contextActionsPopup").destructor(),$$("contextActionsBtnAdaptive").getParentView().removeView($$("contextActionsBtnAdaptive")),$$("customInputs")||$$(e.config.id).addView({id:"customInputsMain",cols:[t]},2)}if($$("contextActionsPopup")&&window.innerWidth/$$("contextActionsPopup").$width<1.3&&$$("contextActionsPopup").$width>100){let e=$$("contextActionsPopup").$width-20;$$("contextActionsPopup").config.width=e,$$("contextActionsPopup").resize()}if($$("contextActionsPopup")&&window.innerWidth/$$("contextActionsPopup").$width>1.3){let e=$$("contextActionsPopup").$width+20;$$("contextActionsPopup").config.width=e,$$("contextActionsPopup").resize()}window.innerWidth<850&&$$("dashboard-tool")&&$$("dashboard-tool").isVisible()&&($$("dashboard-tool").hide(),console.log($$("dashboard-tool")._collection),$$("my_button")||$$("dashboardInfoContainer").addView({view:"button",id:"dashFilterBtn",value:"Фильтры",css:{margin:"10px 0px!important"},height:46,margin:10,popup:webix.ui({view:"popup",css:"webix_popup-dash-container webix_popup-config",modal:!0,id:"contextDashFilterPopup",escHide:!0,position:"center",body:{rows:[{cols:[{template:"Фильтр",css:"webix_template-filter",borderless:!0,height:40},{view:"button",id:"buttonClosePopupDashFilter",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("contextDashFilterPopup")&&$$("contextDashFilterPopup").hide()}}]},{view:"scrollview",borderless:!0,scroll:"y",body:{css:"webix_context-actions-popup",rows:[]}}]}}),click:function(){$$("dashboard-tool").isVisible()?$$("dashboard-tool").hide():$$("dashboard-tool").show()}},0))}),!0),window.location.host.includes("localhost:3000")?Backbone.history.start({pushState:!0,root:"/index.html/"}):Backbone.history.start({pushState:!0,root:"/init/default/spaw/"}),window.innerWidth<850&&$$("tree")&&$$("tree").isVisible()&&$$("tree").hide(),function(){let e=null;webix.event(document.body,"mousedown",(t=>{const i=$$(t);i&&i.getInputNode&&(e=i)})),webix.event(document,"click",(t=>{const i=$$(t);e&&i&&i.config.id!==e.config.id&&(t.cancelBubble=!0,webix.html.preventEvent(t)),e=null}),{capture:!0})}(),function(){webix.ajax("/init/default/api/userprefs/",{success:function(e,i,n){(i=i.json().content).forEach((function(e,i){t(e.name,e.prefs)}))},error:function(e,t,i){l("010-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("010-000",e.status,e.statusText,e.responseURL)}));let e=webix.storage.local.get("userprefsWorkspaceForm");e&&void 0!==e.logBlockOpt&&("2"==e.logBlockOpt?($$("logLayout").config.height=5,$$("logLayout").resize(),$$("webix_log-btn").config.icon="wxi-eye",$$("webix_log-btn").refresh()):"1"==e.logBlockOpt&&($$("logLayout").config.height=90,$$("logLayout").resize(),$$("webix_log-btn").config.icon="wxi-eye-slash",$$("webix_log-btn").refresh()))}(),window.addEventListener("popstate",(function(e){window.location.replace(window.location.href),window.location.reload()})),function(){let e;function t(){console.log(window.location.href,"wr"),i("",window.location.href),console.log("logout1"),webix.ajax().post("/init/default/logout/",{success:function(e,t,i){try{$$("popupFilterEdit")&&$$("popupFilterEdit").isVisible()&&$$("popupFilterEdit").hide(),$$("popupPrevHref")&&$$("popupPrevHref").isVisible()&&$$("popupPrevHref").hide(),window.location.reload(),C(),$$("webix__none-content").show(),$$("tree").clearAll(),n("debug","Превышено время бездействия")}catch(e){console.log(e),s("008-000",e)}},error:function(e,t,i){n("error","Не удалось выполнить выход"),l("008-006",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),l("008-006",e.status,e.statusText,e.responseURL)}))}function o(){try{"/index.html"!==window.location.pathname&&"/"!==window.location.pathname&&"/init/default/spaw"!==window.location.pathname&&(clearTimeout(e),e=setTimeout(t,6e5))}catch(e){console.log(e),s("008-000",e)}}window.onload=o,window.onmousemove=o,window.onmousedown=o,window.ontouchstart=o,window.onclick=o,window.onkeypress=o,window.addEventListener("scroll",o,!0)}(),webix.message.position="bottom",webix.i18n.setLocale("ru-RU"),webix.i18n.parseFormat="%d.%m.%Y %H:%i:%s",webix.i18n.setLocale()}))}catch(e){console.log(e),alert("Ошибка при выполнении "+e),s("007-005",e)}})();