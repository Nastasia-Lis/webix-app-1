(()=>{"use strict";function e(e,t){"undefined"!=typeof Storage&&localStorage.setItem(e,t)}const t={};function n(e){if("/index.html"!==window.location.pathname&&"/init/default/spaw"!==window.location.pathname||"whoami"==e)return webix.ajax().get(`/init/default/api/${e}.json`).then((function(n){t[e]=n.json();try{"fields"==e&&t[e]&&(t.tableNames=function(e){let t=[];try{Object.values(e).forEach((function(n,i){t.push({id:Object.keys(e)[i],name:n.plural?n.plural:n.singular})}))}catch(e){l(e,"globalStorage","getTableNames")}return t}(t[e].content))}catch(e){l(e,"globalStorage","getData")}return t[e]})).catch((e=>{c(e,"globalStorage","getData"),function(e){401===e.status&&"/index.html"!==window.location.pathname&&"/init/default/spaw/"!==window.location.pathname&&Backbone.history.navigate("/",{trigger:!0})}(e)}))}function i(i,o,r){const a=new Date;let s=`${a.getDate()}.${String(a.getMonth()+1).padStart(2,"0")}.${a.getFullYear()} ${a.getHours()}:${String(a.getMinutes()).padStart(2,"0")}:${String(a.getSeconds()).padStart(2,"0")}`;async function c(e,i){let r;var a;"version"==e?r="Expa v1.0.41":"cp"==e?r="Смена пароля":(t.tableNames||await n("fields"),t.tableNames&&function(){try{t.tableNames.forEach((function(t,n){t.id==e&&(r=t.name)}))}catch(e){l(e,"logBlock","findTableName")}}()),(a=r)||(a="expa"),$$("logBlock-list").add({date:s,value:o,src:a})}!function(){try{let e=null;if($$("tree").getSelectedItem())e=$$("tree").getSelectedItem().id;else{let t=window.location.pathname,n=t.lastIndexOf("/");e=t.slice(n+1)}r?c(r):e&&c(e)}catch(e){l(e,"logBlock","initLogMsg")}}(),function(){let t=function(){let e,t=document.querySelector(".webix_log-block");try{t&&t.querySelectorAll(".webix_list_item").forEach((function(t,n){e=n}))}catch(e){l(e,"logBlock","getItemIndex")}return e}(),n=document.querySelectorAll(".webix_list_item")[t];"error"==i&&(function(){try{void 0!==n&&n.style.setProperty("color","red","important")}catch(e){l(e,"logBlock","setStyle")}}(),function(){try{"icon-eye"==$$("webix_log-btn").config.icon&&($$("logLayout").config.height=90,$$("logLayout").resize(),$$("webix_log-btn").setValue(2),$$("webix_log-btn").config.icon="icon-eye-slash",$$("webix_log-btn").refresh(),e("LogVisible",JSON.stringify("show")))}catch(e){l(e,"logBlock","openLog")}}())}()}let o=0;const r={id:"logLayout",height:80,rows:[{template:"<div class='webix_log-headline'>Системные сообщения</div>",height:30},{id:"logBlock-list",css:"webix_log-block",view:"list",template:"#date# — #value#  (Источник: #src#)",data:[],on:{onAfterLoad:function(){try{i("success","Интерфейс загружен","version")}catch(e){l(e,"logBlock","logBlock onAfterLoad")}},onAfterAdd:function(e,t){"icon-eye"==$$("webix_log-btn").config.icon?function(){try{""==$$("webix_log-btn").config.badge&&(o=0),o++,$$("webix_log-btn").config.badge=o,$$("webix_log-btn").setValue(1),$$("webix_log-btn").refresh()}catch(e){l(e,"logBlock","logBlock onAfterAdd function addNotify")}}():"icon-eye-slash"==$$("webix_log-btn").config.icon&&function(){try{o=0,$$("webix_log-btn").config.badge="",$$("webix_log-btn").setValue(2),$$("webix_log-btn").refresh()}catch(e){l(e,"logBlock","logBlock onAfterAdd function clearNotify")}}()}}}]};function a(e,t,n=!1){try{return $$("webix_log-btn").setValue(2),o=0,i("error",n?"ОШИБКА "+e+": "+t:"ОШИБКА "+e+": "+t.stack)}catch(t){console.log(t),alert("Ошибка при выполнении "+t),window.stop()}}function s(e,t,n,r){return $$("webix_log-btn").setValue(2),o=0,i("error","ОШИБКА "+e+": СТАТУС: "+t+" "+n+". ПОДРОБНОСТИ: "+r)}function c(e,t,n){400===e.status||401===e.status||404===e.status?i("error",t+" function "+n+": "+e.status+" "+e.statusText+" "+e.responseURL+" ("+e.responseText+") "):(i("error",t+" function "+n+": "+e.status+" "+e.statusText+" "+e.responseURL+" ("+e.responseText+") ","version"),window.alert("Ошибка. Статус: "+e.status+". Отсутствует соединение с сервером."))}function l(e,t,n){console.log(e),i("error",t+" function "+n+": "+e)}function u(){let e;try{const t=$$("tables"),n=$$("tables-view");t.isVisible()?e=t.config.idTable:$$("forms").isVisible()&&(e=n.config.idTable)}catch(e){l(e,"commonFunctions","getItemId")}return e}function d(e){try{e&&e.isVisible()&&e.hide()}catch(t){l(t,"commonFunctions","hideElem, element: "+e)}}function f(e){try{e&&!e.isVisible()&&e.show()}catch(t){l(t,"commonFunctions","showElem element: "+e)}}const h={id:"dashboardTool",css:"webix_dashTool",rows:[]};function p(e){return webix.confirm({width:300,ok:"Да",cancel:"Отмена",title:e,text:"Вы уверены, что хотите продолжить?"})}function b(e,t,n){return e||t||n?webix.modalbox({title:e,css:"webix_modal-custom-save",buttons:n,width:500,text:t}):webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"})}function $(){let e;try{const t=$$("tree");if(t&&t.getSelectedId())e=t.getSelectedId();else{const t=window.location.pathname,n=window.location.pathname.lastIndexOf("/")+1;e=t.slice(n)}}catch(e){l(e,"favsLink","getCurrId")}return e}function m(){function o(){try{$$("popupFavsLinkSave")&&$$("popupFavsLinkSave").destructor()}catch(e){l(e,"favsLink","destrucPopupSave")}}function r(e,t,n){return{id:e,css:"popup_subtitle",borderless:!0,height:20,template:function(){return 0!==Object.keys($$(e).getValues()).length?"<div style='font-weight:600'>"+t+": </div>"+$$(e).getValues():"<div style='font-weight:600'>"+t+": </div>"+t+" "+n}}}const a={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){o()}},s={view:"button",value:"Сохранить ссылку",css:"webix_primary",click:function(){!function(){let t,n;const r=$();!function(){try{t=$$("favNameLink").getValues(),n=$$("favLink").getValues()}catch(e){l(e,"favsLink","btnSaveLinkClick => getData")}}(),function(){const a=webix.ajax().get("/init/default/api/userprefs/");a.then((function(a){a=a.json().content;const s=[];!function(){try{a.forEach((function(e){e.name.includes("fav-link")&&s.push(e.name)}))}catch(e){l(e,"favsLink","getUserprefs => getFavPrefs")}}(),function(){try{let a=!0;s.length&&s.forEach((function(e){if(e.includes(r)){const t=e.indexOf("_")+1;e.slice(t)==r&&a&&(a=!1,i("success","Такая ссылка уже есть в избранном"))}})),!s.length||a?function(){let a,s=webix.storage.local.get("user");if(s||(function(){const t=webix.ajax("/init/default/api/whoami");t.then((function(t){t=t.json().content;let n={};n.id=t.id,n.name=t.first_name,n.username=t.username,e("user",JSON.stringify(n))})),t.fail((function(e){c(e,"favsLink","btnSaveLpostContentinkClick => getUserData")}))}(),s=webix.storage.local.get("user")),s){a=s.id;const e={name:"fav-link_"+r,owner:a,prefs:{name:t,link:n,id:r}},u=webix.ajax().post("/init/default/api/userprefs/",e);u.then((function(e){"i"==(e=e.json()).err_type?i("success","Ссылка «"+t+"»  сохранёна в избранное"):l(e.err,"favsLink","btnSaveLinkClick => postContent msg"),o()})),u.fail((function(e){c(e,"favsLink","btnSaveLinkClick => postContent")}))}}():a||o()}catch(e){l(e,"favsLink","getUserprefs => getNotUniquePrefs")}}()})),a.fail((function(e){c(e,"favsLink","getUserprefs getData")}))}()}()}};webix.ui({view:"popup",id:"popupFavsLinkSave",css:"popup_padding-container",escHide:!0,width:500,modal:!0,position:"center",body:{rows:[{rows:[{cols:[{template:"Сохранить ссылку",width:250,css:"popup_headline",borderless:!0,height:20},{},a]},r("favNameLink","Имя","не указано"),{height:5},r("favLink","Ссылка","не указана"),{height:10},s,{}]}]}}).show(),async function(){t.fields||await n("fields"),t.tableNames&&function(e){try{const n=$$("favNameLink");t.tableNames.forEach((function(t,i){t.id==e&&n&&n.setValues(t.name)}))}catch(e){l(e,"favsLink","findName")}}($())}(),function(){try{const e=window.location.href,t=$$("favLink");t&&t.setValues(e)}catch(e){l(e,"favsLink","getLink")}}()}function g(e,t=null){let n;try{n=t||function(){return 0!==Object.keys($$(e).getValues()).length?$$(e).getValues():"Имя не указано"}}catch(e){l(e,"blockHeadline","setHeadlineBlock")}return{css:"webix_block-headline",cols:[{view:"template",id:e,borderless:!0,css:"webix_block-headline",height:34,template:n},{},{view:"button",css:"webix-transparent-btn",type:"icon",icon:"icon-star",width:50,click:function(){m()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить ссылку в избранное")}}}]}}function w(e){try{e&&e.isVisible()&&e.hide()}catch(e){l(e,"content","hideElem")}}function v(e){try{e&&!e.isVisible()&&e.show()}catch(e){l(e,"content","showElem")}}function y(e,t,n,o){let r=[];"get"==n?"refresh"==o?function(){!function(){try{e.forEach(((e,t)=>{e.id.includes("customCombo")?r.push(e.name+"="+$$(e.id).getText()):(e.id.includes("customInputs")||e.id.includes("customDatepicker"))&&r.push(e.name+"="+$$(e.id).getValue())}))}catch(e){l(e,"content","refreshButton => createQuery")}}();const n=webix.ajax(t+"?"+r.join("&"));n.then((function(e){"i"==e.json().err_type?(function(){e=e.json().content;try{$$("table-view").clearAll(),0!==e.length?($$("table-view").hideOverlay("Ничего не найдено"),$$("table-view").parse(e),i("success","Данные обновлены")):$$("table-view").showOverlay("Ничего не найдено")}catch(e){l(e,"content","refreshButton => setTableState")}}(),function(){let e,t=$$("table-view-findElements");try{e=$$("table-view").count(),t.setValues(e.toString())}catch(e){l(e,"content","refreshButton => setTableCounter")}}()):l(e.err,"content","refreshButton")})),n.fail((function(e){c(e,"content","refreshButton")}))}():"download"==o&&webix.ajax().response("blob").get(t,(function(e,t,n){try{webix.html.download(t,"table.docx")}catch(e){l(e,"content","downloadButton")}})).catch((e=>{c(e,"content","downloadButton")})):"post"==n&&function(){try{e.forEach(((e,t)=>{if(e.id.includes("customUploader")){let t=Object.values($$(e.id).files.data.pull)[0],n=$$(e.id).config.upload,o=new FormData;$$(e.id).getParentView().addView({id:"templateLoad",template:function(){return 0!==Object.keys($$("templateLoad").getValues()).length?$$("templateLoad").getValues():"Загрузка ..."},borderless:!0}),o.append("file",t.file),async function(e,t){fetch(t,{method:"POST",body:e}).then((e=>e.json())).then((function(e){const t=$$("templateLoad");"i"==e.err_type?(t.setValues("Файл загружен"),i("success","Файл успешно загружен")):(t.setValues("Ошибка"),i("error",e.err))}))}(o,n)}}))}catch(e){l(e,"content","postButton")}}()}function x(e){const t="/init/default/api/"+e;return new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get(t).then((function(e){e=e.json().content;let t,n=[];return function(){try{e.forEach(((e,i)=>{!function(e,n){try{for(;e<=Object.values(n).length;){if("string"==typeof Object.values(n)[e]){t=Object.keys(n)[e];break}e++}}catch(e){l(e,"content","getComboOptions => stringOption")}}(0,e),function(e,i){try{if(null==i[t])for(;e<=Object.values(i).length;){if("number"==typeof Object.values(i)[1]){t=Object.keys(i)[1];break}e++}n.push({id:i.id,value:i[t]})}catch(e){l(e,"content","getComboOptions => numOption")}}(0,e)}))}catch(e){l(e,"content","getComboOptions => createComboValues")}}(),n})).catch((e=>{c(e,"content","getComboOptions")}))}}})}function _(e,o){let r,a,s,u,d;function f(){let n=t.fields.content[o],i=n.inputs;!function(){!function(){try{$$("contextActionsBtn")&&$$(s.config.id).removeView($$("contextActionsBtn"))}catch(e){l(e,"content","adaptiveCustomInputs => removeContextBtn")}}();const t=$$("formsTools");if(n.inputs){let o;o=function(){let t=[];function o(e,t){const n="/init/default/api/"+e[t].apiname;return new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get(n).then((function(e){let t,n=e.json().content,i=[];function o(e,t){return{id:e+1,value:t}}return function(){try{void 0!==n[0].name?n.forEach((function(e,n){t=o(n,e.name),i.push(t)})):n.forEach((function(e,n){t=o(n,e),i.push(t)}))}catch(e){l(e,"content","generateCustomInputs => getOptionData")}}(),i})).catch((e=>{console.log(e),c(e,"content","generateCustomInputs => getOptionData")}))}}})}function r(e){let t=e.getParentView().getChildViews(),n=[];try{t.forEach(((e,t)=>{void 0!==e.config.id&&("text"==e.config.view?n.push({id:e.config.id,name:"substr"}):"combo"==e.config.view?n.push({id:e.config.id,name:"valtype"}):("uploader"==e.config.view||"datepicker"==e.config.view)&&n.push({id:e.config.id}))}))}catch(e){l(e,"content","generateCustomInputs => getInputsId")}return n}return Object.keys(n.inputs).forEach(((a,s)=>{if("string"==i[a].type)t.push(function(e,t){return{view:"text",placeholder:i[e].label,id:"customInputs"+t,height:48,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i[e].comment)},onChange:function(){$$("customInputs").getChildViews().forEach((function(e,t){"button"!=e.config.view||$$(e.config.id).isEnabled()||$$(e.config.id).enable()}))}}}}(a,s));else if("apiselect"==i[a].type)t.push(function(e,t){return{view:"combo",height:48,id:"customCombo"+t,placeholder:i[e].label,labelPosition:"top",options:{data:o(i,e)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i[e].comment)}}}}(a,s));else if("submit"==i[a].type||"button"==i[a].type){let o=i[a].action,c=n.actions[o];"DELETE"==c.verb&&"submit"!==o?function(t){let n=$$(e).getColumns().length,i=$$(e).config.columns;try{i.splice(n,0,{id:"action"+t,header:"Действие",label:"Действие",maxWidth:100,template:"{common.trashIcon()}"}),$$(e).refreshColumns()}catch(e){l(e,"content","generateCustomInputs => createDeleteAction")}}(s):"DELETE"==c.verb?t.push(function(e,t,n){return{view:"button",id:"customBtnDel"+n,css:"webix_danger",type:"icon",disabled:!0,icon:"icon-trash",inputWidth:55,inputHeight:35,value:i[e].label,click:function(e){y(r(this),t.url,"delete")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i[e].comment)}}}}(a,c,s)):t.push(function(e,t,n){return{view:"button",css:"webix_primary",id:"customBtn"+n,inputHeight:35,value:i[e].label,click:function(e){let i=r(this);"GET"==t.verb?"refresh"==t.rtype?y(i,t.url,"get","refresh"):"download"==t.rtype&&y(i,t.url,"get","download"):"POST"==t.verb?(y(i,t.url,"post"),$$("customBtn"+n).disable()):"download"==t.verb&&y(i,t.url,"get","download"),$$("contextActionsPopup")&&$$("contextActionsPopup").hide()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i[e].comment)}}}}(a,c,s))}else"upload"==i[a].type?t.push(function(e,t){return{view:"uploader",value:"Upload file",id:"customUploader"+t,height:48,autosend:!1,upload:n.actions.submit.url,label:i[e].label,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i[e].comment),this.getParentView().getChildViews().forEach((function(e,t){e.config.id.includes("customBtn")&&e.disable()}))},onBeforeFileAdd:function(){const e=$$("templateLoad");e&&e.getParentView().removeView(e)},onAfterFileAdd:function(e){this.getParentView().getChildViews().forEach((function(e,t){e.config.id.includes("customBtn")&&e.enable()}))}}}}(a,s)):"datetime"==i[a].type?t.push(function(e,t){return{view:"datepicker",format:"%d.%m.%Y %H:%i:%s",placeholder:i[e].label,id:"customDatepicker"+t,timepicker:!0,labelPosition:"top",height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i[e].comment)},onChange:function(){try{$$("customInputs").getChildViews().forEach((function(e,t){"button"!=e.config.view||$$(e.config.id).isEnabled()||$$(e.config.id).enable()}))}catch(e){l(e,"content","generateCustomInputs => createDatepicker onChange")}}}}}(a,s)):"checkbox"==i[a].type&&t.push(function(e,t){return{view:"checkbox",id:"customСheckbox"+t,css:"webix_checkbox-style",labelRight:i[e].label,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",i[e].comment)},onChange:function(){try{$$("customInputs").getChildViews().forEach((function(e,t){"button"!=e.config.view||$$(e.config.id).isEnabled()||$$(e.config.id).enable()}))}catch(e){l(e,"content","generateCustomInputs => createCheckbox onChange")}}}}}(a,s))})),t}();const r=$$("table-view-filterId").getParentView(),a={view:"button",width:50,type:"icon",id:"viewToolsBtn",icon:"icon-filter",css:"webix_btn-filter webix-transparent-btn",title:"текст",height:42,click:function(){!function(){const e=document.querySelector(".webix_btn-filter"),n="webix-transparent-btn--primary",i="webix-transparent-btn",o=$$("formsTools-resizer"),r=$$("formsContainer").$width;e.classList.contains(n)?(e.classList.add(i),e.classList.remove(n),w(t),w(o)):e.classList.contains(i)&&(e.classList.add(n),e.classList.remove(i),v(t),v(o)),e.classList.contains(i)?(w(t),w(o),w($$("table-backFormsBtnFilter")),v($$("formsContainer"))):(r<850?(w($$("tree")),r<850&&(w($$("formsContainer")),w($$("tree")),v($$("table-backFormsBtnFilter")),w(o),t.config.width=window.innerWidth-45,t.resize())):(w($$("table-backFormsBtnFilter")),t.config.width=350,t.resize()),v(o))}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть доступные дейсвтия")}}};$$("viewToolsBtn")?v($$("viewToolsBtn")):r.addView(a,2),function(e){let t={id:"customInputs",css:"webix_custom-inp",rows:[{height:20},{rows:e}],width:350};!function(){try{$$("viewToolsContainer").addView(t,0)}catch(e){l(e,"content","adaptiveCustomInputs => addInputs")}}()}(o)}else w(t),w($$("viewToolsBtn"))}()}!function(){if(u=o,d=$$("tree").getItem(o),d||(d=o),e.includes("view"))try{r="table-view-search",a="table-view-findElements",s=$$("table-view-filterId").getParentView()}catch(e){l(e,"content","getValsTable")}else try{r="table-search",a="table-findElements",s=$$("table-filterId").getParentView()}catch(e){l(e,"content","getValsTable")}}(),null==d?i("error","Данные не найдены"):(function(){try{$$(e).clearAll(),"table-view"==e&&($$("contextActionsPopup")&&$$("contextActionsPopup").destructor(),$$("contextActionsBtnAdaptive")&&s.removeView($$("contextActionsBtnAdaptive")),$$("customInputs")&&$$("customInputs").getParentView().removeView($$("customInputs")),$$("customInputsMain")&&$$("customInputsMain").getParentView().removeView($$("customInputsMain")))}catch(e){l(e,"content","preparationTable")}}(),async function(){t.fields||await n("fields"),t.fields&&(t.fields.content.treeTemplate={fields:{id:{type:"id",unique:!1,notnull:!1,length:512,label:"Id",comment:null,default:"None"},pid:{type:"reference trees",unique:!1,notnull:!1,length:512,label:"Родитель",comment:null,default:"None"},owner:{type:"reference auth_user",unique:!1,notnull:!1,length:512,label:"Владелец",comment:null,default:"None"},ttype:{type:"integer",unique:!1,notnull:!1,length:512,label:"Тип",comment:"Тип записи|1=системная;2=пользовательская|Перечисление",default:"1"},name:{type:"string",unique:!1,notnull:!1,length:100,label:"Наименование",comment:null,default:""},descr:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Описание",comment:null,default:""},value:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Значение",comment:null,default:""},cdt:{type:"datetime",unique:!1,notnull:!1,length:512,label:"Создано",comment:null,default:"now"}},singular:"Классификатор-пример",ref_name:"name",plural:"Классификаторы-пример",type:"treeConf"},function(n){let i,r,a=!1,s=t.fields.content[o];if(n.forEach((function(e,t){"action"==e.type&&"detail"==s.actions[e.id].rtype&&(a=!0,i=t,r=e.id)})),void 0!==r){let t=s.actions[r].url;a&&($$(e).config.columns.splice(0,0,{id:"action-first"+i,maxWidth:130,src:t,label:"Подробнее",header:"Подробнее",template:"<span class='webix_icon wxi-angle-down'></span> "}),$$(e).refreshColumns())}}(function(){let n,i=t.fields.content[o],r=i.fields,a=Object.keys(i.fields),s=[];try{a.forEach((function(e){n=r[e].type,n.includes("reference")?function(){try{let t=n.slice(10);r[e].editor="combo",r[e].collection=x(t),r[e].template=function(e,t,n,i){let o=i.collection.getItem(e[i.id]);return o?o.value:""}}catch(e){l(e,"content","createTableCols => createReferenceCol")}}():"datetime"==n?function(){try{r[e].format=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s:%S"),r[e].editor="date"}catch(e){l(e,"content","createTableCols => createDatetimeCol")}}():"boolean"==n?function(){try{r[e].editor="combo",r[e].sort="text",r[e].collection=[{id:1,value:"Да"},{id:2,value:"Нет"}]}catch(e){l(e,"content","createTableCols => createBoolCol")}}():"integer"==n?function(){try{r[e].editor="text",r[e].sort="int",r[e].numberFormat="1 111"}catch(e){l(e,"content","createTableCols => createIntegerCol")}}():function(){try{r[e].editor="text",r[e].sort="string"}catch(e){l(e,"content","createTableCols => createTextCol")}}(),r[e].id=e,r[e].fillspace=!0,r[e].header=r[e].label,"id"==r[e].id&&function(){let t=webix.storage.local.get("userprefsOtherForm");t&&"2"==t.visibleIdOpt&&(r[e].hidden=!0)}(),function(){try{s.push(r[e])}catch(e){l(e,"content","createTableCols => pushColsData")}}()})),function(t){$$(e)&&$$(e).refreshColumns(t)}(s)}catch(e){l(e,"content","createTableCols")}return s}()),f(),function(){let n=t.fields.content[o];function i(t){$$(t).load({$proxy:!0,load:function(n,i){return webix.ajax().get("/init/default/api/"+u,{success:function(n,i,o){i=i.json().content,$$(t).config.idTable=u;try{$$(t).clearAll(),function(){try{"table"==t&&($$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable(),$$("table-filterId").isEnabled()||$$("table-filterId").enable(),$$("table-exportBtn").isEnabled()||$$("table-exportBtn").enable())}catch(e){l(e,"content","createTableRows => setTableState")}}(),function(e){let n,i=$$(t).getColumns(),o=[];!function(){try{i.forEach((function(e,t){"datetime"==e.type&&o.push(e.id)}))}catch(e){l(e,"content","createTableRows => searchDateCols")}}(),e.forEach((function(e,t){function i(t){e[t]&&(n=new Date(e[t]),e[t]=n)}o.forEach((function(e,t){i(e)}))}))}(i),function(t){const n=$$(e);try{0!==t.length?(n.hideOverlay("Ничего не найдено"),n.parse(t)):(n.showOverlay("Ничего не найдено"),n.clearAll())}catch(e){l(e,"content","createTableRows => parseRowData")}}(i),function(){let t;try{t=$$(e).count(),$$(a).setValues(t.toString()),"table"==e&&$$("table-findElements").setValues(t.toString())}catch(e){l(e,"content","createTableRows => setCounterVal")}}()}catch(e){l(e,"content","getItemData => table load")}},error:function(e,t,n){!function(){try{$$(a).setValues("-".toString()),$$("table-findElements").setValues("-".toString()),$$("table-newAddBtnId").isEnabled()&&$$("table-newAddBtnId").disable(),$$("table-filterId")&&$$("table-filterId").disable(),$$("table-exportBtn")&&$$("table-exportBtn").disable()}catch(e){l(e,"content","tableErrorState")}}(),401==n.status&&($$("popupNotAuth")||function(){const e={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){try{$$("popupNotAuth")&&$$("popupNotAuth").destructor()}catch(e){l(e,"content","notAuthPopup btnClosePopup click")}}},t={view:"button",css:"webix_btn-go-login",height:46,value:"Войти",click:function(){!function(){try{$$("popupNotAuth")&&$$("popupNotAuth").destructor()}catch(e){l(e,"content","notAuthPopup destructPopup")}}(),function(){try{Backbone.history.navigate("/",{trigger:!0}),window.location.reload()}catch(e){l(e,"content","notAuthPopup navigate")}}()}};webix.ui({view:"popup",id:"popupNotAuth",css:"webix_popup-prev-href",width:340,height:125,modal:!0,position:"center",body:{rows:[{rows:[{cols:[{template:"Вы не авторизованы",width:250,css:"webix_template-not-found",borderless:!0,height:20},{},e]},{template:"Войдите в систему, чтобы продолжить.",css:"webix_template-not-found-descr",borderless:!0,height:35},t,{height:20}]}]}}).show()}())}})}}).finally((function(){}))}"dbtable"==n.type?i("table"):"tform"==n.type&&i("table-view"),function(){if(n.autorefresh){let e=webix.storage.local.get("userprefsOtherForm");e&&void 0!==e.autorefCounterOpt&&(e.autorefCounterOpt>=15e3?setInterval((function(){"dbtable"==n.type?i("table"):"tform"==n.type&&i("table-view")}),e.autorefCounterOpt):setInterval((function(){"dbtable"==n.type?i("table"):"tform"==n.type&&i("table-view")}),12e4))}}()}())}())}function E(e,o=!1){let r;function a(){try{let e,t=$$("dashBodyScroll");t&&(e=t.getParentView(),t&&e.removeView(t))}catch(e){l(e,"content","getInfoDashboard => removeScroll")}}function s(e,n,o=!1){const s=webix.ajax().get(e);s.then((function(c){let u=[{type:"wide",rows:[]}],d=c.json().charts,f={};a(),o||function(){let e,t;function n(n){try{if(n){e=n,t=e.getParentView();try{e&&t.removeView(e)}catch(e){l(e,"content","getAjax => setVars")}}}catch(e){l(e,"content","getInfoDashboard => setVars")}}n($$("dashboardInfoContainerInner")),n($$("dash-template")),n($$("dashboard-tool-main")),n($$("dashboard-tool-adaptive"))}(),null==d?(function(){try{$$("dashboardTool").addView({view:"scrollview",id:"dashboard-tool-main",borderless:!0,css:{margin:"20px!important",height:"50px!important"},body:{view:"flexlayout",padding:20,rows:[]}},0),$$("dashboardTool").addView({rows:[{template:"",id:"dash-template",css:"webix_style-template-count webix-block-title",borderless:!1,height:40}]},1);const e={id:"dashboard-charts",borderless:!0,body:{view:"flexlayout",rows:[]}};$$("dashboardInfoContainer").addView({view:"scrollview",scroll:"auto",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[e]}})}catch(e){l(e,"content","getInfoDashboard => addErrorView")}}(),i("error","Ошибка при загрузке данных")):(function(){try{d.forEach((function(e,t){f=e.title,delete e.title,e.borderless=!0,e.minWidth=250,u[0].rows.push({css:"webix_dash-chart-headline",rows:[{template:f,borderless:!0,css:{"font-weight":"400!important","font-size":"17px!important"},height:35},e]})}))}catch(e){l(e,"content","getInfoDashboard => createCharts")}}(),o?function(){const e={id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",rows:u};try{$$("dashboardInfoContainerInner").addView({view:"scrollview",scroll:"y",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[e]}})}catch(e){l(e,"content","getInfoDashboard => updateDash")}}():(function(){const e={id:"dashboard-tool-main",padding:20,hidden:!0,minWidth:250,rows:[{id:"dashboardToolHeadContainer",cols:[{template:"Фильтр",height:30,css:"webix_dash-filter-headline",borderless:!0},{view:"button",id:"dash-backDashBtn",type:"icon",icon:"icon-arrow-right",value:"Вернуться к дашбордам",hidden:!0,height:15,hotkey:"esc",minWidth:50,width:55,click:function(){w($$("dashboard-tool-main")),v($$("dashboardInfoContainer"))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Вернуться к дашбордам")}}}]},{rows:n}]};try{$$("dashboardTool").addView(e)}catch(e){l(e,"content","getInfoDashboard => createMainView")}}(),function(){const e=g("dash-template"),n={view:"scrollview",scroll:"y",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",rows:u}]}};try{$$("dashboardInfoContainer").addView({id:"dashboardInfoContainerInner",rows:[e,n]})}catch(e){l(e,"content","getInfoDashboard => createDashInfo")}!async function(){try{t.tableNames||await s("fields"),t.tableNames&&t.tableNames.forEach((function(e,t){e.id==r&&$$("dash-template").setValues(e.name.toString())}))}catch(e){l(e,"content","getInfoDashboard => setTableName")}}()}(),function(){const e={view:"button",id:"dashFilterBtn",css:"webix-transparent-btn",type:"icon",icon:"icon-filter",width:50,click:function(){!function(){const e=$$("dashboard-tool-main");e.isVisible()?w(e):v(e),$$("dashboardContainer").$width<850?(w($$("tree")),$$("dashboardContainer").$width<850&&(w($$("tree")),w($$("dashboardInfoContainer")),v(e),v($$("dash-backDashBtn")),e.config.width=window.innerWidth-45,e.resize())):(w($$("dash-backDashBtn")),350!==e.config.width&&(e.config.width=350,e.resize()))}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть фильтры")}}},t=$$("dash-template").getParentView(),n=$$(t.config.id);$$("dashFilterBtn")||n.addView({id:"dashboard-tool-btn",cols:[e]},2)}())),function(){try{"icon-eye"==$$("webix_log-btn").config.icon?($$("logLayout").config.height=90,$$("logLayout").resize(),$$("logLayout").config.height=5,$$("logLayout").resize()):($$("logLayout").config.height=5,$$("logLayout").resize(),$$("logLayout").config.height=90,$$("logLayout").resize())}catch(e){l(e,"content","getInfoDashboard => setScrollHeight")}}(),(e.includes("?")||e.includes("sdt")&&e.includes("edt"))&&i("success","Данные обновлены")})),s.fail((function(e){c(e,"content","getInfoDashboard => getAjax")}))}e?r=e:$$("tree").getSelectedItem()&&(r=$$("tree").getSelectedItem().id),a(),$$("dashBodyScroll")||async function(){t.fields||await n("fields"),t.fields&&function(){let e,n,o,a=t.fields.content,c=[];function u(t,o){function r(e,t){let n={view:"datepicker",format:"%d.%m.%y",editable:!0,value:new Date,placeholder:t.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",t.comment)}}};if("first"==e){let e=n;return e.id="dashDatepicker_sdt",e}if("last"==e){let e=n;return e.id="dashDatepicker_edt",e}}function a(e){let t={view:"datepicker",format:"%H:%i:%s",placeholder:"Время",height:48,editable:!0,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",hotkey:"enter",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}};if("first"==e){let e=t;return e.id="dashDatepicker_sdt-time",e}if("last"==e){let e=t;return e.id="dashDatepicker_edt-time",e}}function u(e,t){return{rows:[{height:10},{view:"button",css:"webix_primary",id:"dashBtn"+t,inputHeight:48,height:48,minWidth:100,maxWidth:200,value:e.label,click:function(){!function(){let e,o=[],r=[],a=webix.Date.dateToStr("%d.%m.%y"),u=webix.Date.dateToStr("%H:%i:%s"),d="",f="",h=!0;!function(){try{c.forEach((function(e,t){e.id.includes("container")&&function(e){try{$$(e.id).getChildViews().forEach((function(e,t){function n(t){if(null!==$$(e.config.id).getValue()){let n=$$(e.config.id).getValue();"sdt"==t?d=d.concat(" "+u(n)):"edt"==t&&(f=f.concat(" "+u(n)))}else h=!1}function i(t){if(null!==$$(e.config.id).getValue()){let n=$$(e.config.id).getValue();"sdt"==t?d=a(n):"edt"==t&&(f=a(n))}else h=!1}e.config.id.includes("sdt")?e.config.id.includes("time")?n("sdt"):i("sdt"):e.config.id.includes("edt")&&(e.config.id.includes("time")?n("edt"):i("edt"))}))}catch(e){l(e,"content","getInfoDashboard => enumerationElements")}}(e)}))}catch(e){l(e,"content","getInfoDashboard => setInputs")}}(),o.push("sdt="+d),o.push("edt="+f),r.push(d),r.push(f),function(){if(h){let a=webix.Date.dateToStr("%Y/%m/%d %H:%i:%s"),u=a(r[0]),d=a(r[1]);webix.filters.date.greater(u,d)&&r[0]!=r[1]?i("error","Начало периода больше, чем конец"):(e=n.url+"?"+o.join("&"),function(){try{let e=$$("dashboard-charts");e&&$$("dashboardBody").removeView(e)}catch(e){l(e,"content","getInfoDashboard => removeCharts")}}(),s(e,c,!0),function(){try{$$("dashBtn"+t).disable(),setInterval((function(){$$("dashBtn"+t).enable()}),1e3)}catch(e){l(e,"content","getInfoDashboard => setStateBtn")}}())}else i("error","Не все поля заполнены")}()}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",e.comment)}}},{}]}}return function(i){Object.values(t).forEach((function(o,s){"datetime"==o.type&&3==o.order?(Object.keys(t)[s],function(){try{c.push({width:200,id:"datepicker-containersdt",rows:[{template:"Начиная с:",height:30,borderless:!0,css:"webix_template-datepicker"},r("first",o),{height:10},a("first"),{height:20},{template:"Заканчивая:",height:30,borderless:!0,css:"webix_template-datepicker"},r("last",o),{height:10},a("last")]})}catch(e){l(e,"content","getInfoDashboard => createInputs")}}()):"submit"==o.type&&(e=o.action,n=i.actions[e],c.push(u(o,s)))}))}(o),c}Object.values(a).forEach((function(e,t){if("dashboard"==e.type&&Object.keys(a)[t]==r){let t=e.inputs;s(e.actions.submit.url,u(t,e)),function(e){if(e.autorefresh){let e=webix.storage.local.get("userprefsOtherForm");try{void 0!==e.autorefCounterOpt&&(e.autorefCounterOpt>=15e3?setInterval((function(){s(o.actions.submit.url,c)}),e.autorefCounterOpt):setInterval((function(){s(o.actions.submit.url,c)}),5e4))}catch(e){l(e,"content","getInfoDashboard => autorefresh")}}}(e)}}))}()}()}function k(){const e=$$("treeEdit");e.clearAll();const t=webix.ajax().get("/init/default/api/trees");t.then((function(t){(t=t.json().content)[0].pid=0;let n={},i=[],o=[];!function(){try{t.forEach((function(e,t){0==e.pid?o.push({id:e.id,open:!0,value:e.name,pid:e.pid,data:[]}):o.push({id:e.id,value:e.name,pid:e.pid,data:[]})}))}catch(e){l(e,"content","pushTreeData")}}(),function(){try{o.forEach((function(e,t){n[e.id]=t,0!==e.pid&&e.pid!==e.id&&null!==e.pid?o[n[e.pid]].data.push(e):i.push(e)}))}catch(e){l(e,"content","createStruct")}}(),e.parse(i)})),t.fail((function(e){c(e,"content","getInfoEditTree")}))}const T="tableEditForm => property";function V(e=!1){try{const t=$$("editTableFormProperty");t&&(t.config.dirty=e,t.refresh())}catch(e){l(e,T,"setDirtyProperty")}}function I(e,t){try{const n=$$("editTableFormProperty");n.getItem(e).value=t,n.updateItem(e),V(!0)}catch(e){l(e,T,"editingEnd")}}const C={scroll:"y",cols:[{cols:[{id:"propertyRefbtns",rows:[]},{width:5}]},{width:4},{view:"property",id:"editTableFormProperty",css:"webix_edit-table-form-property",dirty:!1,nameWidth:150,editable:!0,tooltip:function(e){const t="Название: "+e.label+" <br>",n=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s:%S");let i,o;return o="date"==e.type?"Выберите дату":"combo"==e.type?"Выберите значение":"integer"==e.customType?"Введите число":"Введите текст",i="date"==e.type?n(e.value):e.value,e.value?t+"Значение: "+i:t+o},hidden:!0,elements:[],on:{onEditorChange:function(e,t){I(e,t),function(){const e=$$("table-saveBtn");e&&e.isVisible()&&!e.isEnabled()&&e.enable()}(),document.getElementById("custom-date-editor")&&document.getElementById("custom-date-editor").addEventListener("input",(function(e){const t=e.target.value.replace(/\D/g,"").match(/(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,3})/);function n(e){return t[e]?t[e]:" __ "}"deleteContentBackward"!==e.inputType&&(e.target.value=n(1)+"."+n(2)+"."+n(3)+"  "+n(4)+":"+n(5)+":"+n(6)+":"+n(7))}))},onBeforeRender:function(){const e=28*this.config.elements.length;e&&this.$height!==e&&(this.define("height",e),this.resize())},onAfterEditStop:function(e,t){e.value!==e.old&&I(t.id,e.value)}}},{width:4}]},S="tableEditForm => validation";function B(){const e={},t=[];try{!function(){const t=$$("editTableFormProperty");Object.keys(t.getValues()).forEach((function(n,i){const o=t.getItem(n),r=t.getValues();e[n]={},function(){if(o.customType&&"integer"==o.customType){const i=(t=r[n],/\D/.test(t));e[n].isNum=i?"Данное поле должно содержать только числа":null}var t}(),function(){try{r[n]&&(r[n].length>o.length&&0!==o.length?e[n].length="Длина строки не должна превышать "+o.length+" симв.":e[n].length=null)}catch(e){l(e,S,"valLength")}}(),function(){try{1==o.notnull&&0==r[n].length?e[n].notnull="Поле не может быть пустым":e[n].notnull=null}catch(e){l(e,S,"valNotNull")}}(),function(){try{if(e[n].unique=null,1==o.unique){const t=Object.values($$("table").data.pull),i=$$("table").getSelectedId().id;t.forEach((function(t,o){0==r[n].localeCompare(t[n])&&t.id!==i&&(e[n].unique="Поле должно быть уникальным")}))}}catch(e){l(e,S,"valUnique")}}(),console.log(e)}))}(),Object.values(e).forEach((function(n,i){Object.values(n).forEach((function(o,r){if(null!==o){let a=Object.keys(e)[i],s=o,c=Object.keys(n)[r];t.push({nameCol:a,typeError:c,textError:s})}}))}))}catch(e){l(e,S,"validateProfForm")}return t}function F(){try{const e=$$("table");B().forEach((function(t,n){let o;e.getColumns().forEach((function(e,n){e.id==t.nameCol&&(o=e.label)})),i("error",t.textError+" (Поле: "+o+")")}))}catch(e){l(e,S,"setLogError")}}const A="tableEditForm => buttons";function j(e=!1,t=!1){try{const n=$$("editTableFormProperty").getValues(),o=u();if(B().length)B().forEach((function(e,t){F()}));else if(n.id){const r="/init/default/api/"+o+"/"+n.id,a=webix.ajax().put(r,function(e){const t={};try{const n=$$("table");Object.values(e).forEach((function(i,o){const r=n.getItem(e.id),a=Object.keys(r);!function(){const n=Object.keys(e)[o];a.forEach((function(i){i==n&&r[i]!==Object.values(e)[o]&&(t[n]=Object.values(e)[o])}))}()}))}catch(e){l(e,S,"uniqueData")}return t}(n)),s=$$("table-editForm"),u=$$("editTableFormProperty"),h=$$("table-newAddBtnId"),p=$$("EditEmptyTempalte"),b=$$("tableContainer");a.then((function(r){"i"==(r=r.json()).err_type?(t||(function(e){try{const t=$$("table");t.updateItem(e.id,e),t.clearSelection(),Y()}catch(e){l(e,A,"saveItem => updateWorkspace")}}(n),d(s)),e?(f(u),function(){const e=$$("table"),t=$$("table-delBtnId"),n=$$("table-saveBtn"),i=$$("table-saveNewBtn");try{e.filter(!1),J("table-editForm"),t.disable(),n.hide(),i.show()}catch(e){l(e,A,"saveItem => addNewStateSpace")}}(),d(p)):(h.enable(),function(e){try{e.config.dirty=!1,e.refresh()}catch(e){l(e,A,"saveItem => setDirtyProp")}}(u)),f(b),window.innerWidth<850&&s.hide(),i("success","Данные сохранены",o)):i("error",A+" function saveItem: "+r.err)})),a.fail((function(e){c(e,A,"saveItem")}))}}catch(e){l(e,A,"saveItem")}}function P(){const e=u();if(B().length)F();else{const t=$$("table-editForm"),n=$$("editTableFormProperty"),o=n.getValues(),r=function(e){const t=Object.values(e),n=Object.keys(e),i={};return t.forEach((function(e,t){e&&(i[n[t]]=e)})),i}(o),a=webix.ajax().post("/init/default/api/"+e,r);a.then((function(r){if(null!==(r=r.json()).content.id)if("i"==r.err_type){try{o.id=r.content.id,$$("table").add(o),Y(),function(){try{n.config.dirty=!1,n.refresh()}catch(e){l(e,A,"saveNewItem => setDirtyProp")}}(),$$("table-newAddBtnId").enable(),d(t),f($$("tableContainer")),window.innerWidth<850&&t.hide()}catch(e){l(e,A,"saveNewItem")}i("success","Данные успешно добавлены",e)}else console.log(r),i("error",A+" function saveNewItem: "+r.err);else{let e=r.content.errors,t="";Object.values(e).forEach((function(n,i){t+=n+" (Поле: "+Object.keys(e)[i]+"); "})),i("error","editTableForm function saveNewItem: "+t)}})),a.fail((function(e){c(e,"tableEditForm => btns","saveNewItem")}))}}const L={view:"button",id:"table-newAddBtnId",height:48,minWidth:90,disabled:!0,hotkey:"shift",value:"Новая запись",click:function(){const e=$$("EditEmptyTempalte"),t=$$("editTableFormProperty"),n=$$("table");function i(){try{n.filter(!1),n.clearSelection(),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show(),$$("table-newAddBtnId").disable(),J("table-editForm"),d(e)}catch(e){l(e,A,"addItem => setWorkspaceState")}}function o(){try{t.config.dirty=!1,t.refresh()}catch(e){l(e,A,"addItem => setDirtyProp")}}try{1==t.config.dirty?b().then((function(t){1==t?(i(),o()):2==t&&(j(!0),o(),d(e))})):(f(t),t.clear(),i(),n.hideOverlay("Ничего не найдено"))}catch(e){l(e,A,"addItem")}}},O={view:"button",id:"table-delBtnId",disabled:!0,height:48,minWidth:90,width:100,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"icon-trash",click:function(){try{const e=u();p("Запись будет удалена").then((function(){const t=$$("editTableFormProperty").getValues(),n=$$("table"),o=n.getSelectedId().id;n&&n.remove(o);const r="/init/default/api/"+e+"/"+t.id+".json",a=webix.ajax().del(r,t);a.then((function(e){"i"==(e=e.json()).err_type?(Y(),V(),f($$("tableContainer")),window.innerWidth<850&&$$("table-editForm").hide(),i("success","Данные успешно удалены")):i("error","editTableForm function removeItem: "+e.err)})),a.fail((function(e){c(e,A,"removeItem")}))}))}catch(e){l(e,A,"removeItem")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить запись из таблицы")}}},N={view:"button",id:"table-backTableBtn",type:"icon",icon:"icon-arrow-left",value:"Вернуться к таблице",hidden:!0,height:48,minWidth:60,width:90,click:function(){!function(){const e=$$("table-editForm"),t=$$("tableContainer"),n=$$("editTableFormProperty"),i=$$("table");function o(){d(e),f(t),i&&i.clearSelection()}n.config.dirty?b().then((function(e){1!=e&&2!=e||(1==e?o():2==e&&(n.getValues().id?(j(),o()):P()),V())})):o()}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Вернуться к таблице")}}},R={minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{cols:[{id:"tablePropBtnsSpace",width:35,hidden:!0},{rows:[{margin:5,rows:[{margin:5,cols:[N,L,O]}]},{margin:10,rows:[{view:"button",id:"table-saveBtn",hidden:!0,value:"Сохранить",height:48,css:"webix_primary",click:function(){j()}},{view:"button",id:"table-saveNewBtn",value:"Сохранить новую запись",hidden:!0,height:48,css:"webix_primary",click:function(){P()}},{id:"EditEmptyTempalte",css:"webix_empty-template",template:"Добавьте новую запись или выберите существующую из таблицы",borderless:!0}]}]}]}]},D="tableEditForm => states";function z(e){try{const t=e;t&&t.destructor()}catch(e){l(e,D,"destructPopup")}}function H(e){try{const t=e;t&&!t.isEnabled()&&t.enable()}catch(e){l(e,D,"enableBtn")}}function W(e){const i=$$("table"),o=$$("tree");try{i.getColumns().forEach((function(i,r){if(i.id==e){const e=i.type.slice(10);o.getItem(e)?o.select(e):e&&async function(e){t.fields||await n("fields"),t.fields&&e&&(Backbone.history.navigate("tree/"+e,{trigger:!0}),window.location.reload())}(e)}}))}catch(e){l(e,D,"setRefTable"),d($$("EditEmptyTempalte"))}}function U(e){const t=$$("editTableFormProperty");!function(){try{$$("propertyRefbtnsContainer").addView({view:"button",type:"icon",width:30,height:29,icon:"icon-window-restore",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Открыть большой редактор текста")}},click:function(){!function(){const n={template:"Редактор поля  «"+e.label+"»",width:250,css:"popup_headline",borderless:!0,height:20},i={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){!function(){const n=$$("editPropTextarea"),i=n.getValue();n.dirtyValue?b().then((function(n){1!=n&&2!=n||(2==n&&t.setValues({[e.id]:[i]},!0),z($$("editTablePopupText")))})):z($$("editTablePopupText"))}()}},o={view:"textarea",id:"editPropTextarea",height:150,dirtyValue:!1,placeholder:"Введите текст",on:{onKeyPress:function(){H($$("editPropSubmitBtn")),$$("editPropTextarea").dirtyValue=!0}}},r={view:"button",id:"editPropSubmitBtn",value:"Добавить значение",css:"webix_primary",disabled:!0,click:function(){!function(){try{const n=$$("editPropTextarea").getValue();t.setValues({[e.id]:[n]},!0)}catch(e){l(e,D,"editPropSubmitClick")}z($$("editTablePopupText"))}()}};webix.ui({view:"popup",id:"editTablePopupText",css:"webix_popup-prev-href",width:400,minHeight:300,modal:!0,escHide:!0,position:"center",body:{rows:[{rows:[{cols:[n,{},i]},o,{height:15},r]}]}}).show(),function(){try{const t=$$("editPropTextarea");e.value&&t.setValue(e.value)}catch(e){l(e,D,"setTextareaVal")}}()}()}})}catch(e){l(e,D,"createBtnTextEditor")}}(),f($$("tablePropBtnsSpace"))}function M(e){const t=$$("editTableFormProperty");function n(){const n=webix.Date.dateToStr("%d.%m.%y");function i(){const i=t.getValues().id,o=$$("editCalendarDate"),r=$$("hourInp").getValue(),a=$$("minInp").getValue(),s=$$("secInp").getValue(),c=$$("msecInp").getValue(),u=r+":"+a+":"+s+":"+c,d=n(o.getValue())+" "+u,f=[];function h(e,t,n){try{e>t&&($$("timeForm").markInvalid(n),f.push(n)),/^\d+$/.test(e)||($$("timeForm").markInvalid(n),f.push(n)),e.length<2&&"msecInp"!==n&&($$("timeForm").markInvalid(n),f.push(n)),e.length<3&&"msecInp"==n&&($$("timeForm").markInvalid(n),f.push(n))}catch(e){l(e,D,"validTime element: "+n)}}h(r,23,"hourInp"),h(a,59,"minInp"),h(s,59,"secInp"),h(c,999,"msecInp"),function(){try{f.length||(t.setValues({[e.id]:d},!0),i&&t.setValues({id:i},!0),z($$("editTablePopupCalendar")))}catch(e){l(e,D,"setValToProperty")}}()}!function(){const n={template:"Редактор поля  «"+e.label+"»",width:250,css:"popup_headline",borderless:!0,height:20},o={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){!function(){let e=!1;function t(t){t.config.dirtyProp&&!e&&(e=!0)}t($$("editCalendarDate")),t($$("hourInp")),t($$("minInp")),t($$("secInp")),t($$("msecInp")),e?b().then((function(e){1!=e&&2!=e||(2==e&&i(),z($$("editTablePopupCalendar")))})):z($$("editTablePopupCalendar"))}()}};function r(e,t="00",n=2){return{view:"text",name:e,id:e,placeholder:t,attributes:{maxlength:n},dirtyProp:!1,on:{onKeyPress:function(){$$("timeForm").markInvalid(e,!1),H($$("editPropCalendarSubmitBtn"))},onChange:function(){this.config.dirtyProp=!0,H($$("editPropCalendarSubmitBtn"))}}}}function a(e){return{template:":",id:e,borderless:!0,width:9,height:5,css:"popup_time-spacer"}}const s={rows:[{view:"calendar",format:"%d.%m.%y",borderless:!0,id:"editCalendarDate",width:300,height:250,dirtyProp:!1,on:{onChange:function(){this.config.dirtyProp=!0,H($$("editPropCalendarSubmitBtn"))}}},{height:10},{view:"form",id:"timeForm",height:85,type:"space",elements:[{template:"<div style='font-size:13px!important'>Введите время в формате xx : xx : xx : xxx</div>",borderless:!0,css:"popup_time-timeFormHead"},{cols:[r("hourInp"),a(1),r("minInp"),a(2),r("secInp"),a(3),r("msecInp","000",3)]}]},{height:10}]},c={view:"button",id:"editPropCalendarSubmitBtn",value:"Добавить значение",css:"webix_primary",click:function(){i()}};webix.ui({view:"popup",id:"editTablePopupCalendar",css:"webix_popup-prev-href",width:400,minHeight:300,modal:!0,escHide:!0,position:"center",body:{rows:[{rows:[{cols:[n,{},o]},s,{height:15},c]}]}}).show(),function(){const n=t.getValues()[e.id],i=webix.Date.dateToStr("%H"),o=webix.Date.dateToStr("%i"),r=webix.Date.dateToStr("%s"),a=$$("editCalendarDate"),s=$$("editPropCalendarSubmitBtn");function c(e){e.config.dirtyProp=!1}!function(){try{n?(a.setValue(n),$$("hourInp").setValue(i(n)),$$("minInp").setValue(o(n)),$$("secInp").setValue(r(n)),$$("msecInp").setValue(function(){const e=n.lastIndexOf(":")+1;return n.slice(e)}())):(a.setValue(new Date),s&&s.disable()),c(a),c($$("hourInp")),c($$("minInp")),c($$("secInp")),c($$("msecInp"))}catch(e){l(e,D,"setValuesDate")}}()}()}()}!function(){try{$$("propertyRefbtnsContainer").addView({view:"button",type:"icon",width:30,height:29,icon:"icon-calendar",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Открыть календарь")}},click:function(e){n()}})}catch(e){l(e,D,"createDateBtn")}}(),f($$("tablePropBtnsSpace"))}function q(){const e=$$("editTableFormProperty"),t=$$("propertyRefbtns");let n=e.config.elements;t._cells.length||($$("propertyRefbtnsContainer")||function(){try{t.addView({id:"propertyRefbtnsContainer",rows:[]})}catch(e){l(e,D,"createBtnsContainer")}}(),n.forEach((function(e,t){"combo"==e.type?function(e){const t=$$("editTableFormProperty");!function(){try{$$("propertyRefbtnsContainer").addView({view:"button",type:"icon",srcTable:e,width:30,height:29,icon:"icon-share-square-o",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Перейти в родительскую таблицу")}},click:function(e){!function(e){const n=$$(e).config.srcTable;t.config.dirty?function(){try{b().then((function(e){1!=e&&2!=e||(1==e||2==e&&(t.getValues().id?j(!1,!0):P()),V(),W(n))}))}catch(e){l(e,D,"createModalBox")}}():W(n)}(e)}})}catch(e){l(e,D,"btnLayout")}}(),f($$("tablePropBtnsSpace"))}(e.id):"popup"==e.customType?U(e):"customDate"==e.type?M(e):$$("propertyRefbtnsContainer").addView({height:29,width:1})})))}function J(e){const t=$$("editTableFormProperty");try{const i=$$("table").getColumns();if(0==Object.keys($$(e).elements).length){const e=[];i.forEach(((t,n)=>{let i={id:t.id,label:t.label,unique:t.unique,notnull:t.notnull,length:t.length,value:function(){const e=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s:%S");let n;return"now"===t.default&&"datetime"==t.type?n=e(new Date):Date.parse(new Date(t.default))&&"datetime"==t.type?n=e(new Date(t.default)):t.default.includes("make_guid")?n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})):"False"==t.default?n=2:"True"==t.default?n=1:"None"!==t.default&&"null"!==t.default?n=t.default:"None"!=t.default&&"null"!=t.default||(n=""),n}()};function o(){(0==t.length||t.length>512)&&(i.customType="popup"),i.type="text"}"datetime"==t.type?i.type="customDate":t.type.includes("reference")?function(){let e=t.type.slice(10);i.type="combo",i.css=t.id+"_container",i.options=x(e),i.template=function(e,t,n,i){let o=i.collection.getItem(e.value);return o?o.value:""}}():t.type.includes("boolean")?(i.type="select",i.options=[{id:1,value:"Да"},{id:2,value:"Нет"}]):t.type.includes("integer")?(o(),i.customType="integer"):o(),e.push(i)})),webix.editors.$popup={date:{view:"popup",body:{weekHeader:!0,view:"calendar",events:webix.Date.isHoliday,timepicker:!0,icons:!0}}},n=e,t.define("elements",n),t.refresh(),q()}else $$(e).clear(),$$(e).clearValidation(),"table-editForm"==e&&$$("table-delBtnId").enable()}catch(e){l(e,D,"createEditFields")}var n}function Y(){const e=$$("editTableFormProperty");try{!function(){const e=$$("table-saveBtn"),t=$$("table-saveNewBtn"),n=$$("table-delBtnId");t.isVisible()?t.hide():e.isVisible()&&e.hide(),n.disable()}(),e&&(e.clear(),e.hide()),f($$("EditEmptyTempalte")),function(){const e=$$("propertyRefbtnsContainer"),t=$$("propertyRefbtns");e&&t.removeView(e)}()}catch(e){l(e,D,"defaultStateForm")}}function K(){let e;return $$("tables").isVisible()?e=$$("table").config.idTable:$$("forms").isVisible()&&(e=$$("table-view").config.idTable),e}function G(e,t,n=!1){return{view:"datatable",id:e,css:"webix_table-style webix_header_border webix_data_border",autoConfig:!0,editable:n,editaction:"dblclick",minHeight:350,datafetch:5,datathrottle:5e3,loadahead:100,footer:!0,select:!0,resizeColumn:!0,on:t,onClick:{"wxi-trash":function(){try{p("Запись будет удалена").then((function(){let t=$$(e).getItem(id),n=K();webix.ajax().del("/init/default/api/"+n+"/"+t.id+".json",t,{success:function(){$$(e).remove($$(e).getSelectedId()),i("success","Данные успешно удалены")},error:function(e,t,n){s("012-000",n.status,n.statusText,n.responseURL)}}).catch((e=>{console.log(e),s("012-000",e.status,e.statusText,e.responseURL)}))}))}catch(e){console.log(e),a("012-000",e)}},"wxi-angle-down":function(e,t,n){try{if($$("propTableView").isVisible())$$("propTableView").hide(),$$("propResize").hide();else{let e,n=t.row;$$("table-view").getColumns().forEach((function(i,o){if(i.id==t.column){e=i.src;let t=e.search("{");e=e.slice(0,t)+n+".json"}})),webix.ajax(e,{success:function(e,t,n){try{t=t.json().content;let e=[];t.forEach((function(t,n){e.push({type:"text",id:n+1,label:t.name,value:t.value})})),$$("propTableView").define("elements",e),$$("propTableView").show(),$$("propTableView").config.width<200&&($$("propTableView").config.width=200,$$("propTableView").resize()),$$("propResize").show()}catch(e){console.log(e),a("012-000",e)}},error:function(e,t,n){s("012-000",n.status,n.statusText,n.responseURL)}}).catch((e=>{console.log(e),s("012-000",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),a("012-000",e)}}}}}function Q(){$$("table-findElements").setValues($$("table").count().toString())}function X(e){let t=$$("table").getItem(e);try{$$("editTableFormProperty")&&!$$("editTableFormProperty").isVisible()&&($$("editTableFormProperty").show(),window.innerWidth>850&&($$("table-editForm").config.width=350,$$("table-editForm").resize())),$$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),function(){const e=webix.Date.dateToStr("%d.%m.%y %H:%i:%s:%S");Object.values(t).forEach((function(n,i){if(n instanceof Date){const o=Object.keys(t)[i],r=e(n);t[o]=r}}))}(),$$("editTableFormProperty").setValues(t),$$("table-saveNewBtn").hide(),$$("table-saveBtn").show(),$$("table-delBtnId").enable()}catch(e){console.log(e),i("error","toEditForm: "+e)}}function Z(){$$("propertyRefbtnsContainer")&&$$("propertyRefbtns").removeView($$("propertyRefbtnsContainer"))}function ee(){B().forEach((function(e,t){let n;$$("table").getColumns().forEach((function(t,i){t.id==e.nameCol&&(n=t.label)})),i("error",e.textError+" (Поле: "+n+")")}))}function te(e,t,n,o=!1){if(B().length)ee();else if(t.id){let r;r=o?function(e){let t={};return Object.values(e).forEach((function(n,i){let o=$$("table").getItem(e.id),r=Object.keys(o);!function(){let n=Object.keys(e)[i];r.forEach((function(r){r==n&&o[r]!==Object.values(e)[i]&&(t[Object.keys(e)[i]]=Object.values(e)[i])}))}()})),t}(t):t,webix.ajax().put("/init/default/api/"+n+"/"+t.id,r,{success:function(n,r,a){"i"==(r=r.json()).err_type&&(i("success","Данные сохранены"),$$("table").updateItem(t.id,t),Z(),o&&(X(e),$$("table").select(e))),"e"==r.err_type&&i("error",r.error)},error:function(e,t,n){i("error","table function putData: "+n.status+" "+n.statusText+" "+n.responseURL)}}).catch((e=>{console.log(e),i("error","table function putData ajax: "+e.status+" "+e.statusText+" "+e.responseURL)}))}}let ne={onBeforeLoad:function(){this.showOverlay("Загрузка...")},onBeforeEditStop:function(e,t,n){let i=$$("table").getSelectedItem(),o=K();try{if(e.value!=e.old){let n=t.row,r=t.column,a=e.value;$$("table").updateItem(n,{[r]:a}),$$("editTableFormProperty").setValues($$("table").getSelectedItem()),te("",i,o)}}catch(e){console.log(e),a("012-011",e)}},onAfterSelect(e){function t(){$$("EditEmptyTempalte")&&$$("EditEmptyTempalte").hide()}try{!function(){try{$$("editTableBarContainer")&&!$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").show(),$$("table-newAddBtnId")&&$$("table-newAddBtnId").enable(),t(),$$("table-editForm").isVisible()||($$("table-editForm").show(),function(){try{$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").hide(),$$("filterTableForm")&&$$("filterTableForm").isVisible()&&$$("filterTableForm").hide();let e=document.querySelector(".webix_btn-filter");e.classList.add("webix-transparent-btn"),e.classList.remove("webix-transparent-btn--primary")}catch(e){i("error","table filterTableHide: "+e)}}())}catch(e){i("error","table statePutEditForm: "+e)}}(),function(){try{$$("container").$width<850&&($$("tree")&&$$("tree").isVisible()&&$$("tree").hide(),$$("container").$width<850&&($$("tableContainer")&&$$("tableContainer").isVisible()&&$$("tableContainer").hide(),$$("table-editForm").config.width=window.innerWidth,$$("table-editForm").resize(),$$("table-backTableBtn").show()),$$("table-editForm").show(),t())}catch(e){i("error","table adaptiveEditFormPopup: "+e)}}()}catch(e){console.log(e),i("error","table onAfterSelect: "+e)}},onBeforeSelect:function(e,t){const n=document.querySelector(".edit-popup");if(n){const e=n.getAttribute("view_id");$$(e).hide()}let o=$$("editTableFormProperty").getValues(),r=K(),a=e.id;if(function(){if($$("editTableFormProperty").config.dirty)return $$("table").getSelectedId(),b().then((function(t){const n=$$("table-saveBtn");1==t?(X(a),$$("table").select(e.id),Z()):2==t&&(n.isVisible()?te(a,o,r,!0):function(e,t,n){B().length?ee():webix.ajax().post("/init/default/api/"+t,n,{success:function(t,o,r){if(null!==(o=o.json()).content.id)n.id=o.content.id,$$("table").add(n),X(e),Z(),$$("table").select(e),i("success","Данные успешно добавлены");else{let e=o.content.errors,t="";Object.values(e).forEach((function(n,i){t+=n+" (Поле: "+Object.keys(e)[i]+"); "})),i("error",t)}},error:function(e,t,n){i("error","table modalBox (post new data): "+n.status+" "+n.statusText+" "+n.responseURL)}})}(a,r,o))})),!1;J("table-editForm"),X(a)}(),$$("editTableFormProperty").config.dirty)return!1},onAfterLoad:function(){try{this.hideOverlay(),this.count(),Y()}catch(e){l(e,"table","onAfterLoad")}},onAfterDelete:function(){try{Q(),function(){let e;$$("table").isVisible()?e="table":$$("table-view").isVisible()&&(e="table-view"),$$(e).count()||$$(e).showOverlay("Ничего не найдено"),$$(e).count()&&$$(e).hideOverlay()}()}catch(e){console.log(e),i("error","table onAfterDelete: "+e)}},onAfterAdd:function(){try{Q(),this.hideOverlay()}catch(e){console.log(e),i("error","table onAfterAdd: "+e)}},onAfterRender:function(){}};function ie(e,t){return{view:"text",width:300,labelPosition:"top",type:"password",name:t,label:e}}const oe={view:"button",height:48,width:300,value:"Сменить пароль",css:"webix_primary",click:function(){try{const e=$$("cp-form");if(e&&e.validate()){let t={op:"",np:""},n=e.getValues();t.np=n.newPass,t.op=n.oldPass;const o=webix.ajax().post("/init/default/api/cp",t);o.then((function(t){"i"==(t=t.json()).err_type?i("success",t.err):i("error","authSettings function doAuthCp: "+t.err,"cp"),e.setDirty(!1)})),o.fail((function(e){c(e,"authSettings","doAuthCp post")}))}}catch(e){l(e,"authSettings","doAuthCp")}}},re={id:"layout-cp",cols:[{view:"form",id:"cp-form",borderless:!0,margin:5,elements:[{template:"<div>Изменение пароля</div>",css:"webix_cp-form",height:35,borderless:!0},{view:"template",id:"authName",css:"webix_userprefs-info",height:50,borderless:!0,template:function(){return 0!==Object.keys($$("authName").getValues()).length?"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600'>"+$$("authName").getValues()+"<div>":"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600'>не указано</div>"}},ie("Старый пароль","oldPass"),ie("Новый пароль","newPass"),ie("Повтор нового пароля","repeatPass"),{margin:5,cols:[oe]}],rules:{$all:webix.rules.isNotEmpty,$obj:function(e){return e.newPass!=e.repeatPass?(i("error","Новый пароль не совпадает с повтором"),!1):e.newPass!=e.oldPass||!$$("cp-form").isDirty()||(i("error","Новый пароль должен отличаться от старого"),!1)}}},{}]};let ae={userprefsOther:{},userprefsWorkspace:{}};function se(){const t=$$("userprefsTabbar").getValue()+"Form";if($$(t).isDirty())try{webix.ajax().get("/init/default/api/userprefs/",{success:function(n,o,r){"e"==(o=o.json().content).err_type&&i("error",o.error);let c=!1;const l=$$(t).getValues();let u={name:t,prefs:l};try{o.forEach((function(n,o){n.name==t&&(c=!0,webix.ajax().put("/init/default/api/userprefs/"+n.id,u,{success:function(n,o,r){"i"==(o=o.json()).err_type&&(e(t,JSON.stringify($$(t).getValues())),i("success","Настройки сохранены")),"e"==o.err_type&&i("error",o.error),ae[$$("userprefsTabbar").getValue()]=l,$$(t).setDirty(!1)},error:function(e,t,n){s("015-011",n.status,n.statusText,n.responseURL)}}).catch((e=>{console.log(e),s("015-011",e.status,e.statusText,e.responseURL)})))}))}catch(e){console.log(e),a("015-000",e)}try{if(!c){let n=webix.storage.local.get("user").id;n?u.owner=n:webix.ajax("/init/default/api/whoami",{success:function(t,n,i){u.owner=n.json().content.id;let o={};o.id=n.json().content.id,o.name=n.json().content.first_name,o.username=n.json().content.username,e("user",JSON.stringify(o))},error:function(e,t,n){s("005-011",n.status,n.statusText,n.responseURL)}}).catch((e=>{console.log(e),s("005-000",e.status,e.statusText,e.responseURL)})),webix.ajax().post("/init/default/api/userprefs/",u,{success:function(e,n,o){"i"==(n=n.json()).err_type?i("success","Настройки сохранены"):"e"==n.err_type&&i("error",n.error),ae[$$("userprefsTabbar").getValue()]=l,$$(t).setDirty(!1)},error:function(e,t,n){s("015-001",n.status,n.statusText,n.responseURL)}}).catch((e=>{console.log(e),s("015-001",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),a("015-000",e)}},error:function(e,t,n){s("015-000",n.status,n.statusText,n.responseURL)}}).catch((e=>{console.log(e),s("015-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),a("015-000",e)}else i("debug","Сохранять нечего")}const ce={rows:[{padding:{top:15,bottom:0,left:20,right:0},rows:[{view:"template",template:"<div>Настройки</div>",css:"webix_headline-userprefs",height:35,borderless:!0},{view:"template",id:"userprefsName",css:"webix_userprefs-info",template:function(){return 0!==Object.keys($$("userprefsName").getValues()).length?"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600' >"+$$("userprefsName").getValues()+"<div>":"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div><div style='display:inline-block;font-size:13px!important;font-weight:600'>не указано</div>"},height:50,borderless:!0}]},{rows:[{view:"tabbar",type:"top",id:"userprefsTabbar",css:"webix_filter-popup-tabbar",multiview:!0,options:[{value:"<span class='webix_tabbar-filter-headline'>Рабочее пространство</span>",id:"userprefsWorkspace"},{value:"<span class=webix_tabbar-filter-headline'>Другое</span>",id:"userprefsOther"}],height:50,on:{onBeforeTabClick:function(e){const t=$$("userprefsTabbar").getValue()+"Form";try{if($$(t).isDirty())return webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"}).then((function(n){if(1==n){let n=webix.storage.local.get(t);$$(t).setValues(n),$$("userprefsTabbar").setValue(e),$$("userprefsSaveBtn").isEnabled()&&$$("userprefsSaveBtn").disable(),$$("userprefsResetBtn").isEnabled()&&$$("userprefsResetBtn").disable()}else 2==n&&(se(),$$("userprefsTabbar").setValue(e))})),!1}catch(e){console.log(e),a("005-000",e)}}}},{cells:[{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsWorkspace",scroll:"y",body:{view:"form",id:"userprefsWorkspaceForm",borderless:!0,elements:[{cols:[{rows:[{view:"radio",labelPosition:"top",name:"logBlockOpt",label:"Отображение блока системных сообщений",value:1,options:[{id:1,value:"Показать"},{id:2,value:"Скрыть"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть по умолчанию блок системных сообщений")},onChange:function(e,t,n){try{e!==t&&(1==e?$$("webix_log-btn").setValue(2):$$("webix_log-btn").setValue(1))}catch(e){console.log(e),a("015-000",e)}}}},{height:15},{cols:[{view:"select",name:"LoginActionOpt",label:"Действие после входа в систему",labelPosition:"top",value:2,options:[{id:1,value:"Перейти на главную страницу"},{id:2,value:"Перейти на последнюю открытую страницу"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показывать/не показывать всплывающее окно при загрузке приложения")}}},{}]}]}]}],on:{onChange:function(){this.isDirty()&&!$$("userprefsSaveBtn").isEnabled()?$$("userprefsSaveBtn").enable():this.isDirty()||$$("userprefsSaveBtn").disable(),this.isDirty()&&!$$("userprefsResetBtn").isEnabled()?$$("userprefsResetBtn").enable():this.isDirty()||$$("userprefsResetBtn").disable()}}}},{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsOther",scroll:"y",body:{view:"form",id:"userprefsOtherForm",borderless:!0,elements:[{view:"radio",labelPosition:"top",label:"Автообновление специфичных страниц",value:1,name:"autorefOpt",options:[{id:1,value:"Включено"},{id:2,value:"Выключено"}],on:{onChange:function(e,t,n){try{1!=e||$$("userprefsAutorefCounter").isVisible()||$$("userprefsAutorefCounter").show(),2==e&&$$("userprefsAutorefCounter").isVisible()&&$$("userprefsAutorefCounter").hide()}catch(e){console.log(e),a("015-000",e)}}}},{height:5},{view:"counter",id:"userprefsAutorefCounter",labelPosition:"top",name:"autorefCounterOpt",label:"Интервал автообновления (в миллисекундах)",min:15e3,max:9e5,on:{onChange:function(e,t,n){try{const t=$$("userprefsAutorefCounter").config.min,n=$$("userprefsAutorefCounter").config.max;e==t?webix.message({type:"debug",expire:1e3,text:"Минимальное возможное значение"}):e==n&&webix.message({type:"debug",expire:1e3,text:"Максимальное возможное значение"})}catch(e){console.log(e),a("015-000",e)}}}},{height:5},{view:"radio",labelPosition:"top",label:"ID в таблицах",value:1,name:"visibleIdOpt",options:[{id:1,value:"Показывать"},{id:2,value:"Не показывать"}]},{}],on:{onChange:function(){this.isDirty()&&!$$("userprefsSaveBtn").isEnabled()?$$("userprefsSaveBtn").enable():this.isDirty()||$$("userprefsSaveBtn").disable(),this.isDirty()&&!$$("userprefsResetBtn").isEnabled()?$$("userprefsResetBtn").enable():this.isDirty()||$$("userprefsResetBtn").disable()}}}}]},{id:"a1",rows:[{responsive:"a1",cols:[{view:"button",height:48,minWidth:200,value:"Сбросить",id:"userprefsResetBtn",disabled:!0},{view:"button",value:"Сохранить настройки",height:48,minWidth:200,id:"userprefsSaveBtn",css:"webix_primary",disabled:!0,click:se}]}]}]}]};webix.UIManager.addHotKey("Ctrl+Shift+E",(function(){Backbone.history.navigate("experimental/treeEdit",{trigger:!0})}));const le="tableFilter => toolbar";function ue(e,t,n,i){let o;return i.editor&&"combo"==i.editor&&(o=i.type.slice(10)),function(){const r=function(){let e;if(i.id.includes("_filter")){let t=i.id.indexOf("_filter");e=i.id.slice(0,t)}else e=i.id;return e}(),a=$$(r+"_filter_rows");t=a.getChildViews().length;const s=r+"_filter-child-"+e+"-"+t,c={id:s,name:s,on:{onKeyPress:function(){const e=$$("btnFilterSubmit");$$("filterTableForm").clearValidation(),e&&!e.isEnabled()&&e.enable()}}};function l(e){const t=c;return t.view="text","text"==e?t.placeholder="Введите текст":"int"==e&&(t.placeholder="Введите число",t.invalidMessage="Поле поддерживает только числовой формат",t.validate=function(e){return!isNaN(1*e)}),t}function u(e){const t=c;return t.view="combo",t.placeholder="Выберите вариант","default"==e?t.options={data:x(o)}:"bool"==e&&(t.options=[{id:1,value:"Да"},{id:2,value:"Нет"}]),t}return"text"==n?l("text"):"combo"==n?u("default"):"boolean"==n?u("bool"):"date"==n?function(){const e=c;return e.view="datepicker",e.placeholder="дд.мм.гг",e.format="%d.%m.%Y %H:%i:%s",e.timepicker=!0,e}():"integer"==n?l("int"):void 0}()}function de(e,t){try{let n=$$(e);t.includes("eql")?n.setValue("="):t.includes("notEqual")?n.setValue("!="):t.includes("less")?n.setValue("<"):t.includes("more")?n.setValue(">"):t.includes("mrEqual")?n.setValue(">="):t.includes("lsEqual")?n.setValue("<="):t.includes("contains")&&n.setValue("⊆")}catch(e){l(e,le,"filterOperationsBtnLogic")}}function fe(e){return webix.once((function(){"combo"==e||"boolean"==e?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"})):"text"==e?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"содержит",id:"operations_contains"})):"date"==e?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"<",id:"operations_less"}),this.add({value:">",id:"operations_more"}),this.add({value:">=",id:"operations_mrEqual"}),this.add({value:"<=",id:"operations_lsEqual"})):"integer"==e&&(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"<",id:"operations_less"}),this.add({value:">",id:"operations_more"}),this.add({value:">=",id:"operations_mrEqual"}),this.add({value:"<=",id:"operations_lsEqual"}),this.add({value:"содержит",id:"operations_contains"}))}))}function he(e,t){const n=e.id+"_filter-btnFilterOperations",i={view:"button",id:n,css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(e){de(n,e)},onAfterLoad:fe(t)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},o={view:"button",css:"webix_filterBtns",value:"+",id:e.id+"_filter_condition",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[{value:"и",id:"add_and"},{value:"или",id:"add_or"}],on:{onMenuItemClick(t){pe(t,e)}}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить ещё вариант поля")}}};return{id:e.id+"_filter_container-btns",css:{"margin-top":"27px!important"},hidden:!0,cols:[i,o]}}function pe(e,t){const n=t.id,i=$$(n+"_filter_rows"),o=i.getChildViews().length;let r;r="boolean"!==t.type?t.editor:"boolean",e.includes("and")?function(){const e={id:"and_"+webix.uid(),template:"<div style='color:var(--primary)'>+ и</div>",height:30,borderless:!0},a=n+"_filter-child-operAnd-"+o,s=a+"-btnFilterOperations",c={view:"button",id:s,css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(e){de(s,e)},onAfterLoad:fe(r)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},u=a+"_remove",d={id:n+"_filter_container-btns"+o,cols:[c,{view:"button",id:u,css:"webix_filterBtns webix_danger",type:"icon",icon:"wxi-trash",inputHeight:38,width:40,click:function(){p("Поле фильтра будет удалено").then((function(){!function(){try{const e=$$(u).getParentView().getParentView().getParentView();$$(n+"_filter_rows").removeView($$(e.config.id)),setLogValue("success","Поле удалено")}catch(e){l(e,le,"createAndInput => popupSuccess")}}()}))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить поле фильтра")}}}]};!function(){try{i.addView({id:n+"_filter-container-child-"+o,padding:5,rows:[e,{id:webix.uid(),cols:[ue("operAnd",o,r,t),d]}]},o)}catch(e){l(e,le,"createAndInput => addInput")}}()}():e.includes("or")&&function(){const e={id:"or_"+webix.uid(),template:"<div style='color:var(--primary)'>+ или</div>",height:30,borderless:!0},a=n+"_filter-child-operOr-"+o,s=a+"-btnFilterOperations",c={view:"button",id:s,css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(e){de(s,e)},onAfterLoad:fe(r)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},u=a+"_remove",d={id:n+"_filter_container-btns"+o,cols:[c,{view:"button",css:"webix_filterBtns webix_danger",id:u,type:"icon",icon:"wxi-trash",inputHeight:38,width:40,click:function(){p("Поле фильтра будет удалено").then((function(){!function(){try{let e=$$(u).getParentView().getParentView().getParentView();i.removeView($$(e.config.id)),setLogValue("success","Поле удалено")}catch(e){l(e,le,"createOrInput => popupSuccess")}}()}))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить поле фильтра")}}}]};i.addView({id:n+"_filter-container-child-operOr-"+o,padding:5,rows:[e,{id:webix.uid(),cols:[ue("operOr",o,r,t),d]}]},o)}()}function be(e,t){return{view:"button",width:50,type:"icon",id:e+"-filterId",hidden:t,icon:"icon-filter",css:"webix_btn-filter webix-transparent-btn ",disabled:!0,title:"текст",height:42,click:function(){!function(e){const t=$$("filterTableForm");$$(e).clearSelection(),function(){const e=document.querySelector(".webix_btn-filter"),n="webix-transparent-btn--primary",i="webix-transparent-btn";e.classList.contains(n)?(function(){try{e.classList.add(i),e.classList.remove(n)}catch(e){l(e,le,"filterMaxAdaptive => setSecondaryBtnState")}}(),d($$("filterTableForm")),d($$("filterTableBarContainer"))):(d($$("table-editForm")),f(t),0!==t.getChildViews()&&function(e,t=1){const n=$$(e).elements;function i(){const t=$$("table-delBtnId");try{"table-editForm"==e&&t&&t.enable()}catch(e){l(e,le,"createFilterElements => enableDelBtn")}}0==Object.keys(n).length?function(){const n=$$("table").getColumns();let o=[];try{n.forEach(((t,n)=>{const i={id:t.id+"_filter",name:t.id+"_filter",hidden:!0,label:t.label,labelPosition:"top",on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},r=t.id+"_filter_rows",a=t.id+"_container",s=t.id+" webix_filter-inputs";function c(e,t){return{id:r,css:s,rows:[{id:a,padding:5,cols:[e,t]}]}}function l(e){const t=i;return t.view="text",t.css={"passing-bottom":"5px!important"},"text"==e?t.placeholder="Введите текст":"int"==e&&(t.placeholder="Введите число",t.invalidMessage="Поле поддерживает только числовой формат",t.validate=function(e){return!isNaN(1*e)}),t}if("datetime"==t.type)o.push(c(function(){const e=i;return e.view="datepicker",e.format="%d.%m.%Y %H:%i:%s",e.placeholder="дд.мм.гг",e.timepicker=!0,e}(),he(t,"date")));else if(t.type.includes("reference")){let e=t.type.slice(10);o.push(c(function(e){const t=i;return t.view="combo",t.placeholder="Выберите вариант",t.options={data:x(e)},t}(e),he(t,"combo")))}else t.type.includes("boolean")?o.push(c(function(){const e=i;return e.view="combo",e.placeholder="Выберите вариант",e.options=[{id:1,value:"Да"},{id:2,value:"Нет"}],e}(),he(t,"combo"))):t.type.includes("integer")?o.push(c(l("int"),he(t,"integer"))):o.push(c(l("text"),he(t,"text")))}))}catch(e){l(e,le,"createFilterElements => generateElements")}let r={margin:8,id:"inputsFilter",css:"webix_inputs-table-filter",rows:o};i(),function(){try{$$(e)&&$$(e).addView(r,t)}catch(e){l(e,le,"createFilterElements => addInputs")}}()}():(function(){try{$$(e)&&($$(e).clear(),$$(e).clearValidation())}catch(e){l(e,le,"createFilterElements => setFormState")}}(),i(),f($$("inputsFilter")))}("filterTableForm",3),function(){try{e.classList.add(n),e.classList.remove(i)}catch(e){l(e,le,"filterMaxAdaptive => setPrimaryBtnState")}}(),f($$("filterTableBarContainer")))}(),$$("container").$width<850?(d($$("tree")),$$("container").$width<850&&(d($$("tableContainer")),d($$("tree")),f($$("table-backTableBtnFilter")),t.config.width=window.innerWidth-45,t.resize())):(d($$("table-backTableBtnFilter")),t.config.width=350,t.resize())}(e)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть фильтры")}}}}const $e="tableEditForm => toolbarBtn";function me(e){return{view:"button",maxWidth:200,value:"<span class='webix_icon icon-pencil'></span><span style='padding-left: 5px'>Редактор таблицы</span>",id:e+"-editTableBtnId",css:"webix_btn-edit",title:"текст",height:42,click:function(){!function(){const e=$$("table-editForm"),t=$$("table-backTableBtn"),n=$$("tree"),i=$$("container");!function(){const t=$$("editTableBarContainer"),n=$$("filterTableBarContainer"),i=$$("filterTableForm");d(n),d(i),function(){const e=document.querySelector(".webix_btn-filter");try{e.classList.add("webix-transparent-btn"),e.classList.remove("webix-transparent-btn--primary")}catch(e){l(e,$e,"setSecondaryState")}}(),e&&e.isVisible()?(d(e),d(t)):e&&!e.isVisible()&&(f(e),f(t),d($$("tablePropBtnsSpace")))}(),i.$width<850?(d(n),i.$width<850&&(d($$("tableContainer")),d(n),f(t),e.config.width=window.innerWidth-45,e.resize())):(d(t),e.config.width=350,e.resize())}()},on:{onAfterRender:function(){try{"table"!==e&&this.isVisible()&&this.hide()}catch(e){l(e,$e,"btn edit onAfterRender")}this.getInputNode().setAttribute("title","Редактировать таблицу")}}}}function ge(e,t){return{view:"button",width:50,type:"icon",id:e+"-exportBtn",hidden:t,icon:"icon-arrow-circle-down",css:"webix_btn-download webix-transparent-btn",title:"текст",height:42,click:function(){!function(e){try{webix.toExcel(e,{filename:"Table",filterHTML:!0,styles:!0}),i("success","Таблица сохранена")}catch(e){l(e,"toolbarTable","exportToExcel")}}(e)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Экспорт таблицы")}}}}function we(e,t){return{view:"template",id:e,css:"webix_style-template-count",height:30,template:function(){return 0!==Object.keys($$(e).getValues()).length?"<div style='color:#999898;'>"+t+": "+$$(e).getValues()+" </div>":""}}}function ve(e,t=!1){const n=e+"-findElements",i=e+"-idFilterElements";return{rows:[g(e+"-templateHeadline"),{css:"webix_filterBar",padding:{bottom:4},height:40,cols:[be(e,t),me(e),{},ge(e,t)]},{cols:[we(n,"Общее количество записей"),we(i,"Видимое количество записей")]}]}}const ye={view:"form",id:"table-editForm",hidden:!0,css:"webix_form-edit",minHeight:350,borderless:!0,scroll:!0,elements:[R,C],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}};let xe;const _e="tableFilter => popup",Ee={template:"Редактор фильтров",css:"webix_template-recover",borderless:!0,height:40},ke={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("popupFilterEdit")&&$$("popupFilterEdit").destructor()}},Te={css:"webix_empty-template",template:"Выберите нужные поля или шаблон из библиотеки",borderless:!0,height:47};function Ve(e){e?$$("popupFilterSubmitBtn").enable():$$("popupFilterSubmitBtn").disable()}const Ie={view:"form",id:"editFormPopup",css:"webix_edit-form-popup",borderless:!0,elements:[{rows:[{view:"tabbar",type:"top",id:"filterPopupTabbar",css:"webix_filter-popup-tabbar",multiview:!0,options:[{value:"<span class='webix_tabbar-filter-headline'>Поля</span>",id:"editFormScroll"},{value:"<span class=webix_tabbar-filter-headline'>Библиотека</span>",id:"editFormPopupLib"}],height:50,on:{onAfterTabClick:function(e){!function(e){function t(e){try{"enable"==e?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():"disable"==e&&$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable()}catch(e){l(e,_e,"btnSubmitState")}}function n(e){$$("popupFilterClearBtn")&&$$("popupFilterClearBtn").isVisible()&&(e?$$("popupFilterClearBtn").show():$$("popupFilterClearBtn").hide())}function i(e){$$("editFormPopupLibRemoveBtn")&&!$$("editFormPopupLibRemoveBtn").isVisible()&&(e?$$("editFormPopupLibRemoveBtn").show():$$("editFormPopupLibRemoveBtn").hide())}try{"editFormPopupLib"==e&&function(){try{n(!1),""!==$$("filterEditLib").getValue()?t("enable"):t("disable"),i(!0)}catch(e){l(e,_e,"filterLibrary")}}(),"editFormScroll"==e&&function(){let e=$$("editFormPopup").getValues(),o=0;try{Object.values(e).forEach((function(e,t){e&&o++})),n(!0),i(!1),t(o>0?"enable":"disable")}catch(e){l(e,_e,"editFilter")}}()}catch(e){l(e,_e,"tabbarLogic")}}(e)}}},{height:200,cells:[{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"editFormScroll",scroll:"y",body:{id:"editFormPopupScroll",rows:[]}},{view:"form",scroll:!0,id:"editFormPopupLib",css:"webix_multivew-cell",borderless:!0,elements:[{view:"radio",id:"filterEditLib",vertical:!0,options:[],on:{onChange:function(){this.getValue()?(xe=this.getValue(),$$("editFormPopupLibRemoveBtn").isEnabled()||$$("editFormPopupLibRemoveBtn").enable(),$$("popupFilterSubmitBtn").isEnabled()||Ve(!0)):$$("popupFilterSubmitBtn").isEnabled()&&Ve(!1)}}}]}]},{height:20},{cols:[{view:"button",id:"popupFilterSubmitBtn",height:48,minWidth:140,disabled:!0,css:"webix_primary",hotkey:"Enter",value:"Применить",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбранные фильтры будут добавлены в рабочее поле, остальные скрыты")}},click:function(){function e(e,t=null,n=null){let i=document.querySelectorAll(".webix_filter-inputs");if(e)try{!function(){try{i.forEach((function(e,n){e.classList.contains(t)?(e.classList.contains("webix_show-content")||e.classList.add("webix_show-content"),e.classList.contains("webix_hide-content")&&e.classList.remove("webix_hide-content")):e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content")}))}catch(e){l(e,_e,"function visibleField => showHtmlEl")}}(),$$(n)&&$$(n).show(),$$(n+"_container-btns")&&!$$(n+"_container-btns").isVisible()&&$$(n+"_container-btns").show(),$$("resetFilterBtn").isEnabled()||$$("resetFilterBtn").enable(),$$("filterLibrarySaveBtn").isEnabled()||$$("filterLibrarySaveBtn").enable(),$$("filterEmptyTempalte").isVisible()&&$$("filterEmptyTempalte").hide()}catch(e){l(e,_e,"function visibleField => showElements")}else try{$$(n).isVisible()&&function(){try{i.forEach((function(e,n){e.classList.contains(t)&&(e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content"),e.classList.contains("webix_show-content")&&e.classList.remove("webix_show-content"))}))}catch(e){l(e,_e,"function visibleField => hideHtmlEl")}}(),function(){const e=$$(n+"-btnFilterOperations");e&&e.setValue("="),$$(n).setValue(""),$$(n).hide(),$$(n+"_container-btns")&&$$(n+"_container-btns").isVisible()&&$$(n+"_container-btns").hide()}(),$$(n+"_rows")&&function(){let e=$$(n+"_rows").getChildViews();try{Object.values(e).forEach((function(e,t){e.config.id.includes("child")&&$$(n+"_rows").removeView($$(e.config.id))}))}catch(e){l(e,_e,"function visibleField => removeChids")}}()}catch(e){l(e,_e,"function visibleField => hideElements")}}try{let t=$$("filterPopupTabbar").getValue();"editFormPopupLib"==t?function(){let t=$$("filterEditLib").getOption($$("filterEditLib").getValue()),n=webix.ajax("/init/default/api/userprefs/");n.then((function(n){n.json(),n=n.json().content;const o=u();function r(t){let n=[];try{t.collection.content.forEach((function(t,i){"parent"==t.condition&&(function(){let i=function(){let e=t.parentField.id.indexOf("_filter");return t.parentField.id.slice(0,e)}(),o=function(){let e=t.parentField.id.indexOf("_rows");return t.parentField.id.slice(0,e)}();e(1,i,o),n.push(o)}(),$$(t.parentValue.id)&&$$(t.parentValue.id).setValue(t.parentValue.value),function(){try{$$(t.parentField.id)&&$$(t.parentField.id)._cells.forEach((function(e,n){e.config.id.includes("child")&&$$(t.parentField.id).removeView($$(e.config.id))}))}catch(e){l(e,_e,"function createWorkspace => removeLastChilds")}}()),function(t){const n=$$("inputsFilter").getChildViews();try{n.forEach((function(n,i){let o=function(e){let n;return t.forEach((function(t,i){e.includes(t)&&(n=t)})),n}(n.config.id),r=n.config.id;if(!o){let t=function(){let e=r.indexOf("_rows");return r.slice(0,e)}(),n=function(e){let t=e.indexOf("_filter");return r.slice(0,t)}(t);e(0,n,t)}}))}catch(e){l(e,_e,"function hideFalseInputs")}}(n),function(){let e=$$("table").getColumns();try{e.forEach((function(e,n){t.parentField.id.includes(e.id)&&("and"==t.condition?(pe("and",e),$$(t.childValue.id).setValue(t.childValue.value)):"or"==t.condition&&(pe("or",e),$$(t.childValue.id).setValue(t.childValue.value)))}))}catch(e){l(e,_e,"function createWorkspace => createChilds")}}()})),$$("filterTableForm").setValues(t.values)}catch(e){l(e,_e,"function createWorkspace")}}!function(){try{n.forEach((function(e,n){e.name==o+"_filter-template_"+t.value&&r(JSON.parse(e.prefs)),$$("popupFilterEdit")&&$$("popupFilterEdit").destructor(),$$("btnFilterSubmit")&&!$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").enable()}))}catch(e){l(e,_e,"function dataEnumeration")}}(),i("success","Рабочая область фильтра обновлена")})),n.fail((function(e){c(e,_e,"getLibraryData")}))}():"editFormScroll"==t&&function(){try{$$("filterLibrarySaveBtn")&&!$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").enable(),function(){let t,n,i=$$("editFormPopup").getValues();try{Object.keys(i).forEach((function(o,r){n=o.lastIndexOf("_"),t=o.slice(0,n),e(i[o],t,o)}))}catch(e){l(e,_e,"function createWorkspaceCheckbox")}}(),function(){let e=0;try{Object.values($$("filterTableForm").elements).forEach((function(t,n){t.config.hidden||e++}))}catch(e){l(e,_e,"function getCheckboxData => visibleCounter")}return e}()||($$("filterEmptyTempalte").isVisible()||$$("filterEmptyTempalte").show(),$$("btnFilterSubmit")&&$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").disable(),$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").disable()),$$("popupFilterEdit")&&$$("popupFilterEdit").destructor()}catch(e){l(e,_e,"function getCheckboxData")}i("success","Рабочая область фильтра обновлена")}()}catch(e){l(e,_e,"function popupSubmitBtn"),$$("popupFilterEdit").destructor()}}},{width:5},{view:"button",id:"popupFilterClearBtn",width:110,height:48,css:"webix_secondary",disabled:!0,value:"Сбросить",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Все фильтры будут очищены и удалены")}},click:function(){$$("popupFilterEdit").destructor(),Le()}},{view:"button",css:"webix_danger",id:"editFormPopupLibRemoveBtn",type:"icon",icon:"icon-trash",hidden:!0,disabled:!0,width:50,click:function(){const e=u();b("Шаблон будет удалён","Вы уверены, что хотите продолжить?",["Отмена","Удалить"]).then((function(t){1==t&&async function(){let t=$$("filterEditLib").getValue(),n=$$("filterEditLib").getOption(t);if(Ce.userprefs||await Be(),Ce.userprefs){let t=Ce.userprefs.content,o=e+"_filter-template_"+n.value;t.forEach((function(e,t){e.name==o&&function(){let t=webix.ajax().del("/init/default/api/userprefs/"+e.id,e);t.then((function(e){"e"!==(e=e.json()).err_type&&"x"!==e.err_type?(i("success","Шаблон « "+n.value+" » удален"),function(){try{$$("filterEditLib").config.options.forEach((function(e,t){e.id==n.id&&(e.value=n.value+" (шаблон удалён)",$$("filterEditLib").refresh(),$$("filterEditLib").disableOption($$("filterEditLib").getValue()),$$("filterEditLib").setValue(""))}))}catch(e){l(e,_e,"function deleteElement => removeOptionState")}}()):i("error",_e+" function userprefsData: "+e.err)})),t.fail((function(e){c(e,_e,"getLibraryData")}))}()}))}}()}))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбранный шаблон будет удален")}}}]}]},{}]},Ce={},Se="tableFilter => buttons";function Be(){return webix.ajax().get("/init/default/api/userprefs/").then((function(e){return Ce.userprefs=e.json(),Ce.userprefs})).fail((e=>{c(e,Se,"getUserprefsData")}))}function Fe(){const t=u();function n(e){e?$$("popupFilterSubmitBtn").enable():$$("popupFilterSubmitBtn").disable()}webix.ui({view:"popup",id:"popupFilterEdit",css:"webix_popup-filter-container webix_popup-config",modal:!0,escHide:!0,position:"center",height:400,width:400,body:{scroll:"y",rows:[{css:"webix_filter-headline-wrapper",cols:[Ee,{width:150},ke]},Te,Ie]}}).show(),function(){const n=webix.ajax("/init/default/api/userprefs/");n.then((function(n){let o=webix.storage.local.get("user");try{o||function(){let t=webix.ajax("/init/default/api/whoami");t.then((function(t){t=t.json().content;try{!function(){let n={};n.id=t.id,n.name=t.first_name,n.username=t.username,e("user",JSON.stringify(n))}(),o=webix.storage.local.get("user")}catch(e){l(e,Se,"function getUserData")}"e"==t.err_type?i("error",t.error):i("success","Рабочая область фильтра обновлена")})),t.fail((function(e){c(e,Se,"getUserData")}))}(),o&&(function(e){!function(){const e=$$("filterEditLib"),t=[];0!==e.config.options.length&&(e.config.options.forEach((function(e){t.push(e.id)})),t.forEach((function(t){e.removeOption(t)})))}();let i=n.json().content;try{i.forEach((function(n,i){if(n.name.includes("filter-template_")&&n.owner==e.id){let e=JSON.parse(n.prefs);e.table==t&&$$("filterEditLib").addOption({id:i+1,value:e.name})}}))}catch(e){l(e,Se,"function setTemplates")}}(o),$$("filterEditLib")&&0==$$("filterEditLib").data.options.length&&$$("filterEditLib").addOption({id:"radioNoneContent",disabled:!0,value:"Сохранённых шаблонов нет"}),function(){try{!function(){let e=0,t=$$("filterTableForm").elements;try{Object.values(t).forEach((function(t,n){t.config.hidden||e++}))}catch(e){l(e,Se,"function counterVisibleElements")}return e}()?$$("filterEmptyTempalte")&&!$$("filterEmptyTempalte").isVisible()&&$$("popupFilterClearBtn").isEnabled()&&$$("popupFilterClearBtn").disable():$$("popupFilterClearBtn")&&!$$("popupFilterClearBtn").isEnabled()&&$$("popupFilterClearBtn").enable()}catch(e){l(e,Se,"function setBtnState")}}())}catch(e){l(e,Se,"function userprefsData")}})),n.fail((function(e){console.log(e),i("error","tableFilter => buttons function userprefsData: "+e.status+" "+e.statusText+" "+e.responseURL)}))}(),$$("filterEditLib")&&$$("filterEditLib").setValue(xe),window.innerWidth<1200&&function(){let e=window.innerWidth-500;try{$$("popupFilterEdit")&&$$("popupFilterEdit").$width>200&&($$("popupFilterEdit").config.width=e,$$("popupFilterEdit").resize())}catch(e){l(e,Se,"function userprefsData => popupSizeAdaptive")}}();const o={view:"checkbox",id:"selectAll",labelRight:"<div style='font-weight:600'>Выбрать всё</div>",labelWidth:0,name:"selectAll",on:{onChange:function(){!function(){try{$$("selectAll").getValue()?$$("popupFilterSubmitBtn").isEnabled()||n(!0):$$("popupFilterSubmitBtn").isEnabled()&&n(!1)}catch(e){l(e,Se,"function checkbox:onchange => setStateSubmitBtn")}}(),function(){let e=$$("editFormPopupScrollContent").getChildViews();try{e.forEach((function(e,t){e.config.id.includes("checkbox")&&($$("selectAll").getValue()?e.config.value=1:e.config.value=0,$$(e).refresh())}))}catch(e){l(e,Se,"function checkbox:onchange => setValueCheckbox")}}()}}};let r=function(){let e=[],t=$$("filterTableForm").elements;try{Object.values(t).forEach((function(t,n){e.push({id:t.config.id,label:t.config.label})}))}catch(e){l(e,Se,"function editFiltersBtn => getAllCheckboxes")}return e}();!function(){const e=[{cols:[{id:"editFormPopupScrollContent",css:"webix_edit-form-popup-scroll-content",rows:[o]}]}];try{r.forEach((function(t,i){if(!t.id.includes("child")){let i={view:"checkbox",id:t.id+"_checkbox",labelRight:t.label,labelWidth:0,name:t.id,on:{onChange:function(){!function(e){let t=$$(e.id+"_checkbox").getParentView().getChildViews(),i=0,o=0;try{!function(){try{t.forEach((function(e,t){e.config.id.includes("checkbox")&&(e.config.value&&""!=e.config.value||i++),e.config.value&&o++}))}catch(e){l(e,Se,"function checkboxOnChange => getStatusCheckboxes")}}(),function(){try{o>0?$$("popupFilterSubmitBtn").isEnabled()||n(!0):$$("popupFilterSubmitBtn").isEnabled()&&n(!1)}catch(e){l(e,Se,"function checkboxOnChange => setStateBtnSubmit")}}(),function(){try{0==i?($$("selectAll").config.value=1,$$("selectAll").refresh()):0!==$$("selectAll").config.value&&($$("selectAll").config.value=0,$$("selectAll").refresh())}catch(e){l(e,Se,"function checkboxOnChange => setSelectAllState")}}()}catch(e){l(e,Se,"function checkboxOnChange")}}(t)}}};$$(t.id)&&$$(t.id).isVisible()?(i.value=1,e[0].cols[0].rows.push(i)):e[0].cols[0].rows.push(i)}})),$$("editFormPopupScroll")&&$$("editFormPopupScroll").addView({rows:e},1)}catch(e){l(e,Se,"function createCheckboxes")}}();let a=0,s=$$("editFormPopupScrollContent").getChildViews();!function(){try{s.forEach((function(e,t){e.config.id.includes("checkbox")&&(e.config.value&&""!=e.config.value||a++)}))}catch(e){l(e,Se,"function countSelectCheckboxes")}}(),function(){try{0==a&&($$("selectAll").config.value=1,$$("selectAll").refresh())}catch(e){l(e,Se,"function stateSelectAll")}}()}function Ae(){$$("tableFilterPopup")&&$$("tableFilterPopup").isVisible()&&$$("tableFilterPopup").hide()}function je(){let e=$$("filterTableForm").getValues(),t=[];function n(e,n,i,o,r,a=!1){const s=u();let c=$$(i+"-btnFilterOperations").config.value;function d(t){return"+and+"+s+"."+n+t+e}function f(t){return s+"."+n+t+e}function h(t){return"+"+o+"+"+n+t+e}try{"parent"==r?a?"="==c?t.push(d("+=+")):"!="==c?t.push(d("+!=+")):"<"==c?t.push(d("+<+")):">"==c?t.push(d("+>+")):"<="==c?t.push(d("+<=+")):">="==c?t.push(d("+>=+")):"⊆"==c&&t.push(d("+contains+")):"="==c?t.push(f("+=+")):"!="==c?t.push(f("+!=+")):"<"==c?t.push(f("+<+")):">"==c?t.push(f("+>+")):"<="==c?t.push(f("+<=+")):">="==c?t.push(f("+>=+")):"⊆"==c&&t.push(f("+contains+")):"child"==r&&("="==c?t.push(h("+=+")):"!="==c?t.push(h("+!=+")):"<"==c?t.push(h("+<+")):">"==c?t.push(h("+>+")):">="==c?t.push(h("+>=+")):"<="==c?t.push(h("+<=+")):"⊆"==c&&t.push(h("+contains+")))}catch(e){l(e,Se,"function filterSubmitBtn => getOperationVal")}}if($$("filterTableForm").validate()){!function(){let t,i,o=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s"),r=0;Object.keys(e).sort().forEach((function(a,s){if(t=a,i=e[a],i&&$$(a))try{"datepicker"==$$(a).config.view&&(i=o(i)),$$(a).config.text&&"Нет"==$$(a).config.text&&(i=0),a.includes("filter")&&!a.includes("condition")&&(t=a.lastIndexOf("_"),t=a.slice(0,t)),function(){try{a.includes("condition")||a.includes("child")||""===e[a]||"selectAll"===a||!$$(a).isVisible()?a.includes("child")&&(a.includes("operAnd")?n(i,t,a,"and","child"):a.includes("operOr")&&n(i,t,a,"or","child")):(r>0?n(i,t,a,"and","parent",!0):n(i,t,a,"and","parent"),r++)}catch(e){l(e,Se,"function createQuery")}}()}catch(e){l(e,Se,"function createGetData")}}))}();const o=webix.ajax("/init/default/api/smarts?query="+t.join(""));o.then((function(e){let t=e.json().err_type,n=e.json().err;e=e.json().content,"i"==t?(function(){try{0!==e.length?($$("table").hideOverlay("Ничего не найдено"),$$("table").clearAll(),$$("table").parse(e)):($$("table").clearAll(),$$("table").showOverlay("Ничего не найдено"))}catch(e){l(e,Se,"function filterSubmitBtn => setData")}}(),function(){const e=$$("table").count().toString();try{$$("table-idFilterElements").setValues(e)}catch(e){l(e,Se,"function filterSubmitBtn => setCounterValue")}}(),Ae(),i("success","Фильтры успшено применены")):i("error",n)})),o.fail((function(e){c(e,Se,"createGetData")}))}else i("error","Не все поля формы заполнены")}function Pe(){try{webix.prompt({title:"Название шаблона",ok:"Сохранить",cancel:"Отменить",css:"webix_prompt-filter-lib",input:{required:!0,placeholder:"Введите название шаблона..."},width:350}).then((function(t){!async function(){Ce.userprefs||await Be();let n=Ce.userprefs.content,o=t,r={content:[]},a=!1;const s=u(),d=$$("inputsFilter")._collection;let f={name:o,collection:r,values:$$("filterTableForm").getValues(),table:s},h={name:s+"_filter-template_"+o,prefs:f};Ce.userprefs&&(d.forEach((function(e,t){let n=e.id.lastIndexOf("_rows"),i=e.id.slice(0,n);$$(i).isVisible()&&function(e,t){try{$$(e.id).getChildViews().forEach((function(n,i){let o=$$(n.config.id)._collection[0].id,a=e.id.lastIndexOf("_rows"),s=e.id.slice(0,a);n.config.id.includes("child")?function(){let e=$$(n.config.id).getChildViews()[1]._collection[0].id,t={parentField:$$(s).config,childValue:{id:e+"-btnFilterOperations",value:$$(e+"-btnFilterOperations").getValue()}};o.includes("and")?(t.condition="and",r.content.push(t)):o.includes("or")&&(t.condition="or",r.content.push(t))}():r.content.push({condition:"parent",parentField:$$(e.id).config,parentValue:{id:t+"-btnFilterOperations",value:$$(t+"-btnFilterOperations").getValue()}})}))}catch(e){l(e,Se,"function filterLibraryBtn => childs:")}}(e,i)})),function(e){n.forEach((function(t,n){let r=s+"_filter-template_"+o;t.name==r&&(a=!0,b("Шаблон с таким именем существует","После сохранения предыдущие данные будут стёрты",["Отмена","Сохранить изменения"]).then((function(n){1==n&&function(){const n=webix.ajax().put("/init/default/api/userprefs/"+t.id,e);n.then((function(e){"i"==(e=e.json()).err_type?i("success","Шаблон «"+o+"»  сохранён в библиотеку"):i("error","tableFilter => buttons function modalBoxExists: "+e.err)})),n.fail((function(e){c(e,Se,"saveExistsTemplate => putUserprefsData")}))}()})))}))}(h),a||function(){let t=webix.storage.local.get("user").id;t?h.owner=t:function(){const t=webix.ajax("/init/default/api/whoami");t.then((function(t){h.owner=t.json().content.id;let n={};n.id=t.json().content.id,n.name=t.json().content.first_name,n.username=t.json().content.username,e("user",JSON.stringify(n))})),t.fail((function(e){c(e,Se,"saveTemplate => setDataStorage")}))}();const n=webix.ajax().post("/init/default/api/userprefs/",h);n.then((function(e){"i"==(e=e.json()).err_type?i("success","Шаблон «"+o+"»  сохранён в библиотеку"):i("error",e.error)})),n.fail((function(e){c(e,Se,"saveTemplate => saveNewTemplate")}))}())}()}))}catch(e){l(e,Se,"function filterSubmitBtn")}}function Le(){try{const e=u(),t=webix.ajax("/init/default/api/smarts?query="+e+".id >= 0");t.then((function(e){let t=e.json();if(e=e.json().content,"i"==t.err_type){try{!function(){try{0!==e.length?($$("table").hideOverlay("Ничего не найдено"),$$("table").clearAll(),$$("table").parse(e)):($$("table").clearAll(),$$("table").showOverlay("Ничего не найдено"))}catch(e){l(e,Se,"function resetFilterBtn => setDataTable")}}(),function(){try{let e=$$("table").count().toString();$$("table-idFilterElements").setValues(e)}catch(e){l(e,Se,"function setFilterCounterVal")}}(),Ae(),$$("filterTableForm")&&$$("filterTableForm").clear(),function(){let e=document.querySelectorAll(".webix_filter-inputs");try{e.forEach((function(e,t){e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content")}))}catch(e){l(e,Se,"function resetFilterBtn => hideInputsContainer")}}(),function(){let e=[];$$("inputsFilter").getChildViews().forEach((function(t,n){let i=t._collection[0].cols[0].id;try{$$(i).hide(),function(){try{$$(t.config.id).getChildViews().forEach((function(t,n){t.config.id.includes("child")&&e.push(t.config.id)}))}catch(e){l(e,Se,"function resetFilterBtn => getChildsId")}}(),$$(i+"_container-btns")&&$$(i+"_container-btns").isVisible()&&$$(i+"_container-btns").hide()}catch(e){l(e,Se,"function resetFilterBtn => clearSpace")}})),function(){try{e.forEach((function(e,t){$$(e).getParentView().removeView($$(e))}))}catch(e){l(e,Se,"function resetFilterBtn => removeChilds")}}()}(),$$("filterLibrarySaveBtn")&&$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").disable(),$$("filterEmptyTempalte")&&!$$("filterEmptyTempalte").isVisible()&&($$("filterEmptyTempalte").show(),$$("filterEmptyTempalte").refresh()),$$("resetFilterBtn").disable()}catch(e){l(e,Se,"function resetFilterBtn")}i("success","Фильтры очищены")}else i("error","tableFilter => buttons function resetFilterBtn ajax: "+t.err)})),t.fail((function(e){c(e,Se,"resetFilterBtn")}))}catch(e){l(e,"Ошибка при очищении фильтров; tableFilter => buttons","function resetFilterBtn")}}function Oe(e){return"formResetBtn"==e?{view:"button",id:"resetFilterBtn",disabled:!0,height:48,minWidth:50,width:65,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"icon-trash",click:Le,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Сбросить фильтры")}}}:"formBtnSubmit"==e?{view:"button",id:"btnFilterSubmit",height:48,minWidth:70,css:"webix_primary",hotkey:"Enter",disabled:!0,value:"Применить фильтры",click:je}:"formEditBtn"==e?{view:"button",value:"Редактор фильтров",height:48,minWidth:140,click:Fe,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить/удалить фильтры")}}}:"filterBackTableBtn"==e?{view:"button",id:"table-backTableBtnFilter",type:"icon",icon:"icon-arrow-left",value:"Вернуться к таблице",hidden:!0,height:48,minWidth:50,width:55,click:function(){!function(){const e=$$("filterTableForm"),t=$$("tableContainer");e&&e.isVisible()&&e.hide(),t&&!t.isVisible()&&t.show(),$$("table")&&$$("table").clearSelection(),function(){const e=document.querySelector(".webix_btn-filter"),t="webix-transparent-btn--primary";e.classList.contains(t)&&(e.classList.add("webix-transparent-btn"),e.classList.remove(t))}()}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Вернуться к таблице")}}}:"formLibrarySaveBtn"==e?{view:"button",id:"filterLibrarySaveBtn",disabled:!0,height:48,minWidth:50,width:65,hotkey:"shift+esc",type:"icon",icon:"icon-file",click:Pe,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Сохранить шаблон с полями в библиотеку")}}}:void 0}const Ne={view:"form",hidden:!0,id:"filterTableForm",minHeight:350,minWidth:210,width:320,scroll:!0,borderless:!0,elements:[{id:"form-adaptive",minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{margin:5,rows:[{responsive:"form-adaptive",margin:5,cols:[Oe("filterBackTableBtn"),Oe("formEditBtn"),Oe("formResetBtn")]}]},{id:"btns-adaptive",css:{"margin-top":"5px!important"},rows:[{responsive:"btns-adaptive",margin:5,cols:[Oe("formBtnSubmit"),Oe("formLibrarySaveBtn")]},{height:10},{id:"filterEmptyTempalte",css:"webix_empty-template",template:"Добавьте фильтры из редактора",borderless:!0}]}]}],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}},Re={id:"viewTools",padding:10,rows:[{cols:[{template:"Действия",height:30,css:"popup_headline",borderless:!0},{},{view:"button",id:"table-backFormsBtnFilter",type:"icon",icon:"icon-arrow-right",value:"Вернуться к таблице",hidden:!0,height:28,minWidth:50,width:55,click:function(){!function(){const e=$$("formsTools"),t=$$("formsContainer"),n=$$("formsTools-resizer");e&&e.isVisible()&&(e.hide(),n.hide()),t&&!t.isVisible()&&t.show(),function(){const e=document.querySelector(".webix_btn-filter"),t="webix-transparent-btn--primary";e.classList.contains(t)&&(e.classList.add("webix-transparent-btn"),e.classList.remove(t))}()}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Вернуться к таблице")}}}]},{id:"viewToolsContainer",rows:[{}]}]};function De(e){e||(function(){try{$$("dashboards")||$$("container").addView({view:"layout",id:"dashboards",hidden:!0,scroll:"auto",rows:[{view:"scrollview",id:"dashScroll",body:{view:"flexlayout",id:"dashboardContainer",cols:[{id:"dashboardInfoContainer",minWidth:250,rows:[]},{view:"resizer"},h]}}]},3)}catch(e){l(e,"router","createDashboards")}}(),function(){try{$$("tables")||$$("container").addView({id:"tables",hidden:!0,view:"scrollview",body:{view:"flexlayout",cols:[{id:"tableContainer",rows:[ve("table"),{view:"resizer",class:"webix_resizers"},G("table",ne,!0)]},{view:"resizer",class:"webix_resizers"},{id:"editTableBarContainer",rows:[ye]},{id:"filterTableBarContainer",hidden:!0,rows:[{id:"editFilterBarAdaptive",rows:[Ne]}]}]}},5)}catch(e){l(e,"router","createTables")}}(),function(){try{$$("forms")||$$("container").addView({view:"layout",id:"forms",css:"webix_tableView",hidden:!0,rows:[{cols:[{id:"formsContainer",rows:[ve("table-view",!0),{view:"resizer",class:"webix_resizers"},{view:"scrollview",body:{view:"flexlayout",cols:[G("table-view"),{view:"resizer",class:"webix_resizers",id:"propResize",hidden:!0}]}}]},{view:"resizer",id:"formsTools-resizer",hidden:!0,class:"webix_resizers"},{id:"formsTools",hidden:!0,rows:[Re,("propTableView",{view:"property",id:"propTableView",tooltip:"Имя: #label#<br> Значение: #value#",width:350,nameWidth:150,editable:!0,scroll:!0,hidden:!0})]}]}]},6)}catch(e){l(e,"router","createForms")}}()),function(){try{"treeTempl"==e&&($$("treeTempl")||($$("container").addView({view:"layout",id:"treeTempl",hidden:!0,scroll:"auto",rows:[{id:"treeEditContainer",cols:[{rows:[{view:"edittree",id:"treeEdit",editable:!0,editor:"text",editValue:"value",css:"webix_tree-edit",editaction:"dblclick",data:[],on:{onAfterEditStop:function(e,t,n){try{let n="/init/default/api/trees/";if(e.value!=e.old){let o=$$("treeEdit").getParentId(t.id),r={name:e.value,pid:o,id:t.id,owner:null,descr:"",ttype:1,value:"",cdt:null};const a=webix.ajax().put(n+t.id,r);a.then((function(e){"i"==(e=e.json()).err_type?i("success","Данные изменены"):l(e.err,"editTree","tree onAfterEditStop postData msg")})),a.fail((function(e){c(e,"editTree","tree onAfterEditStop postData")}))}}catch(e){c(e,"editTree","tree onAfterEditStop")}}}}]},{}]}]},4),webix.ui({view:"contextmenu",id:"contextMenuEditTree",data:["Добавить","Переименовать",{$template:"Separator"},"Свернуть всё","Развернуть всё",{$template:"Separator"},"Удалить"],master:$$("treeEdit"),on:{onMenuItemClick:function(e){let t=this.getContext(),n=$$("treeEdit"),o=n.getItem(t.id),r="/init/default/api/trees/",a={name:"",pid:"",owner:null,descr:"",ttype:1,value:"",cdt:null};switch(this.getMenu(e).getItem(e).value){case"Добавить":{let e=prompt("Имя нового подэлемента '"+o.value+"'","");if(null!=e){a.name=e,a.pid=o.id;const t=webix.ajax().post(r,a);t.then((function(t){try{if("i"==(t=t.json()).err_type){let r=t.content.id;n.data.add({id:r,value:e,pid:o.id},0,o.id),n.open(o.id),i("success","Данные сохранены")}else l(t.err,"editTree","case add post msg")}catch(e){l(e,"editTree","case add")}})),t.fail((function(e){c(e,"editTree","case add")}))}break}case"Переименовать":var s=prompt("Новое имя",o.value);if(null!=s){a.name=s,a.id=o.id,a.pid=o.pid;const e=webix.ajax().put(r+o.id,a);e.then((function(e){try{"i"==(e=e.json()).err_type?(o.value=s,n.updateItem(o.id,o),i("success","Данные изменены")):l(e.err,"editTree","case rename put msg")}catch(e){l(e,"editTree","case rename")}})),e.fail((function(e){c(e,"editTree","case rename")}))}break;case"Удалить":{const e=webix.ajax().del(r+o.id,o);e.then((function(e){try{"i"==(e=e.json()).err_type?(n.remove(o.id),i("success","Данные удалены")):l(e.err,"editTree","case delete del msg")}catch(e){l(e,"editTree","case delete")}})),e.fail((function(e){c(e,"editTree","case delete")}));break}case"Развернуть всё":try{n.open(o.id),n.data.eachSubItem(o.id,(function(e){n.open(e.id)}))}catch(e){l(e,"editTree","case open all")}break;case"Свернуть всё":try{n.close(o.id),n.data.eachSubItem(o.id,(function(e){n.close(e.id)}))}catch(e){l(e,"editTree","case close all")}}}}})))}catch(e){l(e,"router","createTreeTempl")}}(),function(){try{"cp"==e&&$$("container").addView({view:"layout",id:"user_auth",css:"webix_auth",hidden:!0,rows:[re,{}]},7)}catch(e){l(e,"router","createCp")}}(),function(){try{"userprefs"==e&&$$("container").addView({view:"layout",id:"userprefs",css:"webix_auth",hidden:!0,rows:[ce]},8)}catch(e){l(e,"router","createUserprefs")}}()}function ze(){async function i(){t.mmenu||await n("mmenu"),function(){let e,n=[],i=[];const o=[];try{e=t.mmenu.mmenu,e.forEach((function(e,t){3!==e.mtype?(n.push(function(e){let t;try{t={id:e.name,value:e.title,action:e.action},e.title||(t.value="Без названия"),2==e.mtype&&(0==e.childs.length?t.webix_kids=!0:t.data=function(e){let t=[];try{e.childs.forEach((function(e,n){t.push({id:e.name,value:e.title,action:e.action})}))}catch(e){l(e,"router","generateChildsTree")}return t}(e))}catch(e){l(e,"router","generateParentTree")}return t}(e)),0!==e.childs.length&&(i=function(e){let t=[];try{t.push({id:"favs",value:"Избранное",icon:"icon-star"}),t.push({id:"userprefs",value:"Настройки",icon:"icon-cog"}),t.push({id:"cp",value:"Смена пароля",icon:"icon-lock"}),t.push({id:"logout",value:"Выйти",css:"webix_logout",icon:"icon-sign-out"})}catch(e){l(e,"router","generateHeaderMenu")}return t}())):(o.push(e.name),n.push({id:e.name,disabled:!0,value:"1"}))})),$$("tree").clearAll(),$$("tree").parse(n),void 0!==$$("button-context-menu").config.popup.data&&($$("button-context-menu").config.popup.data=i,$$("button-context-menu").enable()),o.forEach((function(e){$$("tree").addCss(e,"tree_delim-items")}))}catch(e){l(e,"router","generateMenuTree")}}()}!async function(){t.whoami||await n("whoami"),t.whoami&&(function(){try{$$("userAuth").hide(),$$("mainLayout").show()}catch(e){window.alert("showMainContent: "+e+" (Подробности: ошибка в отрисовке контента)"),l(e,"router","showMainContent")}}(),function(){let n={};n.id=t.whoami.content.id,n.name=t.whoami.content.first_name,n.username=t.whoami.content.username,e("user",JSON.stringify(n))}(),De(),i())}()}function He(){try{0==$$("tree").data.order.length&&ze()}catch(e){l(e,"router","router function checkTreeOrder")}}function We(){try{$$("tree")&&$$("tree").closeAll()}catch(e){l(e,"router","closeTree")}}function Ue(){try{$$("container").getChildViews().forEach((function(e,t){"scrollview"!=e.config.view&&"layout"!=e.config.view||$$(e.config.id).isVisible()&&$$(e.config.id).hide()}))}catch(e){l(e,"router","hideAllElements")}}function Me(e){function i(){let n,i=!1;function o(e){try{$$(e)&&$$(e).show()}catch(t){l(t,"router","router:tree function showTableData (element: "+e+")")}}n=t.fields.content,function(){try{Object.values(n).forEach((function(t,r){Object.keys(n)[r]==e&&(i=!0,"dbtable"!=t.type&&"tform"!=t.type&&"dashboard"!=t.type||(d($$("webix__none-content")),"dbtable"==t.type?(o("tables"),_("table",e)):"tform"==t.type?(o("forms"),_("table-view",e)):"dashboard"==t.type&&(o("dashboards"),E(e))))}))}catch(e){l(e,"router","router:tree function createElem")}}(),i||function(){try{setTimeout((function(){!function(){const e={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){try{$$("popupNotFound")&&$$("popupNotFound").hide()}catch(e){l(e,"router","router:tree, btnClosePopup click")}}},t={view:"button",css:"webix_btn-not-found-back",height:46,value:"Вернуться на главную",click:function(){!function(){try{$$("popupNotFound")&&$$("popupNotFound").destructor()}catch(e){l(e,"router","router:tree, mainBtnPopup click destructPopup")}}(),function(){try{Backbone.history.navigate("content",{trigger:!0}),window.location.reload()}catch(e){l(e,"router","router:tree, mainBtnPopup click navigate")}}()}};webix.ui({view:"popup",id:"popupNotFound",css:"webix_popup-prev-href",width:340,height:125,position:"center",body:{rows:[{rows:[{cols:[{template:"Что-то пошло не так...",width:250,css:"popup-headline",borderless:!0,height:20},{},e]},{template:"Страница не найдена",css:"webix_template-not-found-descr",borderless:!0,height:35},t,{height:20}]}]}}).show()}()}),1500)}catch(e){l(e,"router","router:tree function showNotFoundPopup")}}()}function o(){if($$("table-templateHeadline"))try{t.tableNames.forEach((function(t,n){t.id==e&&$$("table-templateHeadline")&&$$("table-templateHeadline").setValues(t.name)}))}catch(e){l(e,"router","router:tree function setTableName element table-templateHeadline")}if($$("table-view-templateHeadline"))try{t.tableNames.forEach((function(t,n){t.id==e&&$$("table-view-templateHeadline")&&$$("table-view-templateHeadline").setValues(t.name)}))}catch(e){l(e,"router","router:tree function setTableName element table-view-templateHeadline")}}!function(){try{0==$$("tree").data.order.length&&async function(){await ze();try{$$("tree").attachEvent("onAfterLoad",(function(){let r;$$("tree").getItem(e)?(r=$$("tree").getParentId(e),$$("tree").open(r),$$("tree").select(e)):t.fields?t.fields&&(i(),o()):async function(){t.fields||await n("fields"),t.fields&&(i(),o())}()}))}catch(e){l(e,"router","router:tree function createTable")}}()}catch(e){l(e,"router","router:tree function checkTable")}}()}function qe(){$$("webix__null-content")&&$$("webix__null-content").getParentView().removeView($$("webix__null-content")),He(),Ue(),$$("user_auth")||De("cp"),function(){try{$$("user_auth")&&$$("user_auth").show()}catch(e){l(e,"router","router:cp function showUserAuth")}}(),We(),function(){const e=webix.storage.local.get("user"),t=$$("authName");try{e&&t.setValues(e.name.toString())}catch(e){l(e,"router","router:cp function setUserValues")}}(),$$("webix__none-content")&&$$("webix__none-content").hide()}function Je(){try{$$("userprefs").show()}catch(e){l(e,"router","router:userprefs function showUserprefs")}}function Ye(){try{$$("treeTempl").show()}catch(e){l(e,"router","router:experimental function showTreeTempl")}}function Ke(){return new(Backbone.Router.extend({routes:{"":"index",content:"content",userprefs:"userprefs",cp:"cp",logout:"logout","tree/:id":"tree","experimental/:id":"experimental"},content:function(){ze()},index:function(){!async function(){t.whoami||await n("whoami"),t.whoami?function(){try{Backbone.history.navigate("content",{trigger:!0})}catch(e){l(e,"router","router:index function goToContentPage")}}():function(){try{$$("mainLayout")&&$$("mainLayout").hide(),$$("userAuth")&&$$("userAuth").show()}catch(e){window.alert("getAuth: "+e+" (Подробности: ошибка в отрисовке контента, router:index function showWorkspace)"),l(e,"router","router:index function showWorkspace")}}()}()},tree:function(e){Me(e)},cp:function(){qe()},userprefs:function(){!function(){if(Ue(),He(),$$("userprefs"))Je();else{De("userprefs");const e=webix.ajax().get("/init/default/api/userprefs/");e.then((function(e){e=e.json().content,function(){try{e.forEach((function(e,t){e.name.includes("userprefs")&&0==e.name.lastIndexOf("userprefs")&&$$(e.name).setValues(JSON.parse(e.prefs))}))}catch(e){l(e,"router","router:cp function setUserValues")}}()})),e.fail((function(e){c(e,"router","router:userprefs userprefsData")})),Je()}(function(){let e=webix.storage.local.get("user");try{e&&$$("userprefsName").setValues(e.name.toString())}catch(e){l(e,"router","router:userprefs function setUserprefsNameValue")}})(),We(),$$("webix__none-content")&&$$("webix__none-content").hide(),$$("webix__null-content")&&$$("webix__null-content").getParentView().removeView($$("webix__null-content"))}()},experimental:function(){$$("webix__null-content")&&$$("webix__null-content").getParentView().removeView($$("webix__null-content")),Ue(),d($$("webix__none-content")),He(),$$("treeTempl")?(Ye(),k()):(De("treeTempl"),k(),Ye()),We()},logout:function(){!function(){const e=webix.ajax().post("/init/default/logout/");e.then((function(e){!function(){try{history.back()}catch(e){l(e,"router","router:logout function backPage")}}(),function(){try{$$("webix__none-content")&&$$("webix__none-content").show()}catch(e){l(e,"router","router:logout function showNoneContent")}}(),function(){try{$$("tree")&&$$("tree").clearAll()}catch(e){l(e,"router","router:logout function clearTree")}}(),function(){try{webix.storage.local.clear()}catch(e){l(e,"router","router:logout function clearStorage")}}()})),e.fail((function(e){c(e,"router","router:logout logoutData")}))}()}}))}function Ge(){const t={view:"toolbar",id:"header",padding:10,css:"webix_header-style",elements:[{cols:[{view:"button",type:"icon",id:"collapseBtn",icon:"icon-bars",css:"webix_collapse",title:"текст",height:42,width:40,click:function(){function e(e=!1){$$("header").getChildViews().forEach((function(t){(t.config.id.includes("search")||t.config.id.includes("log-btn")||t.config.id.includes("context-menu"))&&(e?t.show():t.hide())}))}try{window.innerWidth>850?$$("tree").isVisible()?(this.refresh(),$$("tree").hide(),$$("sideMenuResizer")&&$$("sideMenuResizer").hide()):($$("tree").show(),this.refresh(),window.innerWidth>=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").show()):$$("tree").isVisible()?(this.refresh(),$$("tree").hide(),$$("sideMenuResizer")&&$$("sideMenuResizer").hide(),e(!0)):($$("tree").show(),$$("tree").config.width=window.innerWidth,$$("tree").resize(),this.refresh(),window.innerWidth>=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").show(),e())}catch(e){console.log(e),a("009-000",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Видимость бокового меню")}}},{view:"label",label:"<img src='/init/static/images/expalogo.png' style='height:30px; margin: 10px;'>",height:25}]},{},{view:"search",placeholder:"Поиск",css:"searchTable",height:42,maxWidth:250,minWidth:40},{view:"button",id:"webix_log-btn",type:"icon",icon:"icon-eye",height:42,badge:0,width:50,css:"webix_log-btn",click:function(){1==this.getValue()?this.setValue(2):this.setValue(1)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть системные сообщения")},onChange:function(e,t,n){let i=$$("logBlock-list").getLastId();2==e?(this.config.badge="",$$("logBlock-list").showItem(i),$$("logLayout").config.height=90,$$("logLayout").resize(),this.config.icon="icon-eye-slash",this.refresh()):($$("logLayout").config.height=5,$$("logLayout").resize(),this.config.icon="icon-eye",this.refresh(),$$("webix_log-btn").config.badge="",$$("webix_log-btn").refresh())}}},{view:"button",id:"button-context-menu",type:"icon",disabled:!0,icon:"icon-user",height:38,width:50,popup:{view:"contextmenu",id:"contextmenu",css:"webix_contextmenu",data:[],on:{onItemClick:function(e,t,n){function o(){$$("tree")&&$$("tree").clearAll()}function r(e){try{b().then((function(t){const n=$$("table-saveBtn");1==t?(Backbone.history.navigate(e,{trigger:!0}),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),o()):2==t&&$$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty&&(n.isVisible()?j(!1,!1):P(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),Backbone.history.navigate(e,{trigger:!0}),o())}))}catch(e){console.log(e),a("005-000",e)}}function u(e){$$("container").getChildViews().forEach((function(t){t.config.id!==e&&$$(t.config.id).isVisible()&&$$(t.config.id).hide()}))}try{if("logout"==e){if($$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty||$$("cp-form")&&$$("cp-form").isDirty()){try{b().then((function(e){if(1==e)Backbone.history.navigate("logout",{trigger:!0}),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh();else if(2==e&&($$("cp-form")||$$("editTableFormProperty")))if($$("cp-form")&&$$("cp-form").isDirty()&&$$("cp-form").validate()){let e={op:"",np:""},t=$$("cp-form").getValues();e.np=t.newPass,e.op=t.oldPass,webix.ajax().post("/init/default/api/cp",e,{success:function(e,t,n){"i"==(t=t.json()).err_type?i("success",t.err):"e"==t.err_type&&i("error",t.err)},error:function(e,t,n){s("011-000",n.status,n.statusText,n.responseURL)}}),Backbone.history.navigate("logout",{trigger:!0})}else{if(!$$("editTableFormProperty")||!$$("editTableFormProperty").config.dirty)return i("error","Заполните пустые поля"),!1;$$("editTableFormProperty").getValues().id?j(!1,!1):P(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),Backbone.history.navigate("logout",{trigger:!0})}}))}catch(e){console.log(e),a("005-000",e)}return!1}Backbone.history.navigate("logout",{trigger:!0})}else"cp"==e?($$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty?r("cp"):(o(),Backbone.history.navigate("/cp",{trigger:!0})),u("user_auth")):"userprefs"==e?($$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty?r("userprefs"):(o(),Backbone.history.navigate("/userprefs",{trigger:!0})),u("userprefs")):"favs"==e&&function(){const e={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){try{$$("popupFavsLink")&&$$("popupFavsLink").destructor()}catch(e){l(e,"favsLink","favsPopup click")}}},t={view:"radio",id:"favCollectionLinks",vertical:!0,options:[{id:"radioNoneContent",disabled:!0,value:"Здесь будут сохранены Ваши ссылки"}],on:{onChange:function(e,t){try{const n=$$("favLinkSubmit");e!==t&&n&&!n.isEnabled()&&n.enable()}catch(e){l(e,"favsLink","favsPopup => radioLinks")}}}},n={view:"button",id:"favLinkSubmit",value:"Открыть ссылку",css:"webix_primary",disabled:!0,click:function(){!function(){try{const e=$$("favCollectionLinks"),t=e.getValue(),n=e.getOption(t);window.location.replace(n.favLink)}catch(e){l(e,"favsLink","favsPopupSubmitClick")}}()}};webix.ui({view:"popup",id:"popupFavsLink",css:"webix_popup-prev-href",width:400,minHeight:300,escHide:!0,modal:!0,position:"center",body:{rows:[{rows:[{cols:[{template:"Избранное",width:250,css:"popup_headline",borderless:!0,height:20},{},e]},t,{height:15},n]}]}}),function(){const e=webix.ajax().get("/init/default/api/userprefs/");e.then((function(e){e=e.json().content;const t=[];!function(){try{e.forEach((function(e){e.name.includes("fav-link")&&t.push(JSON.parse(e.prefs))}))}catch(e){l(e,"favsLink","favsPopupCollectionClick => getFavsCollection")}}(),function(){const e=$$("favCollectionLinks");try{t.length&&t.forEach((function(t){e.addOption({id:t.id,value:t.name,favLink:t.link}),e.removeOption("radioNoneContent")})),$$("popupFavsLink").show()}catch(e){l(e,"favsLink","favsPopupCollectionClick => createOptions")}}()})),e.fail((function(e){c(e,"favsLink","favsPopupCollectionClick getData")}))}()}()}catch(e){console.log(e),a("005-000",e)}}}},on:{onItemClick:function(){try{webix.ajax().get("/init/default/api/userprefs/",{success:function(t,n,o){if("e"==(n=n.json().content).err_type&&i("error",n.error),"/index.html/content"!==window.location.pathname&&"/init/default/spaw/content"!==window.location.pathname){let t=!1,o={};o.href=window.location.href;let r={name:"userLocationHref",prefs:o};try{n.forEach((function(e,n){"userLocationHref"==e.name&&(t=!0,webix.ajax().put("/init/default/api/userprefs/"+e.id,r,{success:function(e,t,n){"e"==(t=t.json()).err_type&&i("error",t.error)},error:function(e,t,n){s("005-011",n.status,n.statusText,n.responseURL)}}).catch((e=>{console.log(e),s("005-011",e.status,e.statusText,e.responseURL)})))}))}catch(e){console.log(e),a("005-000",e)}try{if(!t){let t=webix.storage.local.get("user").id;t?r.owner=t:webix.ajax("/init/default/api/whoami",{success:function(t,n,i){r.owner=n.json().content.id;let o={};o.id=n.json().content.id,o.name=n.json().content.first_name,o.username=n.json().content.username,e("user",JSON.stringify(o))},error:function(e,t,n){s("005-011",n.status,n.statusText,n.responseURL)}}).catch((e=>{console.log(e),s("005-000",e.status,e.statusText,e.responseURL)})),webix.ajax().post("/init/default/api/userprefs/",r,{success:function(e,t,n){"e"==(t=t.json()).err_type&&i("error",t.error)},error:function(e,t,n){s("005-001",n.status,n.statusText,n.responseURL)}}).catch((e=>{console.log(e),s("005-001",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),a("005-000",e)}}},error:function(e,t,n){s("005-000",n.status,n.statusText,n.responseURL)}}).catch((e=>{console.log(e),s("005-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),a("005-000",e)}}}}]};return t}function Qe(e){try{e&&e.getParentView().removeView(e)}catch(e){l(e,"sidebar","removeElements")}}function Xe(e){try{e&&e.isVisible()&&e.hide()}catch(e){l(e,"sidebar","hideElements")}}function Ze(e){try{e&&!e.isVisible()&&e.show()}catch(e){l(e,"sidebar","showElements")}}function et(e){try{e&&e.isEnabled()&&e.disable()}catch(e){l(e,"sidebar","disableElements")}}function tt(){try{let e=document.querySelector(".webix_btn-filter");e&&e.classList.contains("webix-transparent-btn--primary")&&(e.classList.add("webix-transparent-btn"),e.classList.remove("webix-transparent-btn--primary"))}catch(e){l(e,"sidebar","setStateFilterBtn")}}function nt(){let e={view:"edittree",id:"tree",css:"webix_tree-main",minWidth:100,width:250,editable:!1,select:!0,editor:"text",editValue:"value",activeTitle:!0,clipboard:!0,data:[],on:{onSelectChange:function(e){let i=$$("tree").getSelectedItem().id,o=$$("tree").getParentId(i),r=$$("tree").data.order,a=[];function s(e){try{const n=$$("table-templateHeadline"),i=$$("table-view-templateHeadline");n&&t.tableNames.forEach((function(t,i){t.id==e&&n.setValues(t.name)})),i&&t.tableNames.forEach((function(t,n){t.id==e&&i.setValues(t.name)}))}catch(e){l(e,"sidebar","onSelectChange => setTableName")}}function c(e){function i(){$$("container").addView({view:"align",align:"middle,center",id:"webix__null-content",body:{borderless:!0,template:"Блок в процессе разработки",height:50,width:220,css:{color:"#858585","font-size":"14px!important"}}},2)}!function(){try{let e=$$("webix__null-content");e&&Qe(e)}catch(e){l(e,"sidebar","onSelectChange => removeNullContent")}}(),Xe($$("user_auth")),Xe($$("userprefs")),a=function(){let e=[];try{r.forEach((function(t,n){0==$$("tree").getParentId(t)&&e.push(t)}))}catch(e){l(e,"sidebar","onSelectChange => getTreeParents")}return e}(),void 0!==e?a.forEach((function(r,a){let c=$$("tree").getItem(e).action,l=$$("tree").getItem(r).action;e&&async function(){let i;if(t.fields||await n("fields"),t.fields){let n=t.fields.content;i=!1,n[e]&&(i=!0,"dbtable"==n[e].type?Ze($$("tables")):"tform"==n[e].type?Ze($$("forms")):"dashboard"==n[e].type&&Ze($$("dashboards")),s(e))}return i}().then((function(e){e||(Xe($$("webix__none-content")),$$("webix__null-content")||i())})),c!==l&&l&&("dbtable"==l||"all_dbtable"==l?Xe($$("tables")):"tform"==l||"all_tform"==l?Xe($$("forms")):"dashboard"!=l&&"dashboards"===o||Xe($$("dashboards")))})):function(){try{a.forEach((function(e,t){if(e==o)$$(e)?$$(e).show():$$("webix__null-content")||i();else if($$(e)||"treeTempl"==e)$$(e)&&$$(e).hide();else{let t=$$("tree").getItem(e).action;"dbtable"==t&&"tables"!==o?Xe($$("tables")):"tform"==t&&"forms"!==o?Xe($$("forms")):"dashboard"==t&&"dashboards"!==o&&Xe($$("dashboards"))}}))}catch(e){l(e,"sidebar","onSelectChange => viewDefaultElements")}}()}$$("header").getChildViews().forEach((function(e){e.config.id.includes("search")&&e.show()})),Xe($$("filterTableBarContainer")),Ze($$("filterEmptyTempalte")),Ze($$("EditEmptyTempalte")),et($$("btnFilterSubmit")),et($$("filterLibrarySaveBtn")),et($$("resetFilterBtn")),function(){try{let e=$$("table-editForm");e&&e.config.width<320&&(e.config.width=320,e.refresh())}catch(e){l(e,"sidebar","onSelectChange => setWidthEditForm")}}(),tt(),function(){try{let t=$$("treeTempl");t&&!$$(e)&&t.hide()}catch(e){l(e,"sidebar","onSelectChange => hideTreeTempl")}}(),function(){try{e[0]&&0!==o&&Xe($$("webix__none-content"))}catch(e){l(e,"sidebar","onSelectChange => hideNoneContent")}}(),"tables"==o||"dashboards"==o?c():"forms"==o?(Xe($$("propTableView")),c()):(0==o&&"tables"!==i&&"user_auth"!==i&&"dashboards"!==i&&"forms"!==i||0!==o)&&c(e[0]),"tables"==o?(Y(),_("table",e[0]),s(i)):"dashboards"==o?E():"forms"==o&&(_("table-view",e[0]),s(i))},onItemClick:function(e){const t=$$("editTableFormProperty"),n=t.getValues(),o=function(){let e;return $$("tables").isVisible()?e=$$("table").config.idTable:$$("forms").isVisible()&&(e=$$("table-view").config.idTable),e}();function r(){try{t.config.dirty=!1,t.refresh()}catch(e){l(e,"sidebar","onItemClick => setDirtyProperty")}}function a(){try{const e=$$("table-saveNewBtn"),t=$$("table-saveBtn"),n=$$("table-delBtnId");e.isVisible()?e.hide():t.isVisible()&&t.hide(),n.disable()}catch(e){l(e,"sidebar","onItemClick => setDefaultStateBtns")}}function s(){try{B().forEach((function(e,t){let n;$$("table").getColumns().forEach((function(t,i){t.id==e.nameCol&&(n=t.label)})),i("error",e.textError+" (Поле: "+n+")")}))}catch(e){l(e,"sidebar","onItemClick => validateError")}}function u(e){$$("tree")&&$$("tree").select(e)}if(t.config.dirty)return function(){const d=$$("table-saveBtn");b().then((function(f){1==f?(a(),function(){try{t&&t.isVisible()&&(t.clear(),t.hide())}catch(e){l(e,"sidebar","onItemClick => setDirtyProperty")}}(),r(),$$("tree").select(e)):2==f&&(d.isVisible()?function(){if(B().length)s();else if(n.id){const t="/init/default/api/"+o+"/"+n.id,a=function(e){let t={};return Object.values(e).forEach((function(n,i){!function(n){try{let i=$$("table").getItem(e.id),o=Object.keys(i),r=Object.keys(e)[n],a=Object.values(e)[n];o.forEach((function(e){e==r&&i[e]!==a&&(t[r]=a)}))}catch(e){l(e,"sidebar","onItemClick => compareVals")}}(i)})),t}(n),s=webix.ajax().put(t,a);s.then((function(t){"i"==(t=t.json()).err_type?(r(),Qe($$("propertyRefbtnsContainer")),u(e),i("success","Данные успешно добавлены",o)):l(t.err,"sidebar","onItemClick => putData")})),s.fail((function(e){c(e,"sidebar","onItemClick => putData")}))}}():function(){if(B().length)s();else{const t="/init/default/api/"+o,a=webix.ajax().post(t,n);a.then((function(t){if(null!==(t=t.json()).content.id)r(),Qe($$("propertyRefbtnsContainer")),u(e),i("success","Данные успешно добавлены",o);else{let e=t.content.errors,n="";Object.values(e).forEach((function(t,i){n+=t+" (Поле: "+Object.keys(e)[i]+"); "})),i("error",n)}"i"!==t.err_type&&l(t.err,"sidebar","onItemClick => postNewData")})),a.fail((function(e){c(e,"sidebar","onItemClick => postNewData")}))}}(),r()),0!==f&&Qe($$("propertyRefbtnsContainer"))}))}(),!1;a()},onBeforeSelect:function(e){const i=$$("tree"),o=(i.getParentId(e),i.getItem(e)),r=$$("filterTableForm"),a=$$("inputsFilter");if(e.includes("q-none_data-tree_")||e.includes("q-load_data-tree_")||o.webix_kids)return!1;!function(){const e=document.querySelector(".webix_btn-filter"),t="webix-transparent-btn--primary";e&&e.classList.contains(t)&&(e.classList.add("webix-transparent-btn"),e.classList.remove(t))}(),function(){try{r&&r.isVisible()&&(r.hide(),tt(),Ze($$("table-editForm"))),a&&Qe(a)}catch(e){l(e,"sidebar","onBeforeSelect => setFilterDefaultState")}}(),Qe($$("propertyRefbtnsContainer")),Xe($$("editTableFormProperty")),function(){const e=$$("viewTools"),t=$$("formsContainer");Xe(e),Ze(t)}(),function(){const e=$$("dashboard-tool-main"),t=$$("dashboardInfoContainer");Xe(e),Ze(t)}(),Xe($$("table-backTableBtn")),Xe($$("table-editForm")),Ze($$("tableContainer")),async function(){t.fields||await n("fields");let i=t.fields.content,o=Object.keys(i);!function(){try{o.forEach((function(t){t==e&&(Xe($$("webix__none-content")),Qe($$("webix__null-content")),"dbtable"==i[t].type?(Ze($$("tables")),_("table",e)):"tform"==i[t].type?(Ze($$("forms")),_("table-view",e)):"dashboard"==i[t].type&&(Ze($$("dashboards")),E(e)))}))}catch(e){l(e,"sidebar","onBeforeSelect => generateItem")}}()}()},onLoadError:function(e){c(e,"content","sidebar onLoadError")},onBeforeOpen:function(e){const i=$$("tree"),o=$$("tree").getItem(e),r="q-load_data-tree_"+webix.uid(),a="q-none_data-tree_"+webix.uid();-1===$$("tree").getItem(e).$count&&(i.data.add({id:r,disabled:!0,value:"Загрузка ..."},0,e),i.addCss(r,"tree_load-items"),async function(){t.fields||await n("fields");let s=t.fields.content,c=Object.keys(s);function u(e=!1){try{i.exists(r)&&i.remove(r),i.exists(a)&&e&&i.remove(a)}catch(e){l(e,"sidebar","onBeforeOpen => removeTreeEls")}}if(o.action.includes("all_")){let n=o.action.indexOf("_");!function(n){let o=!1;try{c.forEach((function(r){s[r].type!=n||function(e){let n=!1;try{t.mmenu.mmenu.forEach((function(t,i){t.name==e&&(n=!0)}))}catch(e){l(e,"sidebar","onBeforeOpen => findNotUniqueItem")}return n}(r)||(i.data.add({id:r,value:s[r].plural?s[r].plural:s[r].singular,type:s[r].type},0,e),o||(o=!0),u(!0))})),o||(u(),i.exists(a)||(i.data.add({id:a,disabled:!0,value:"Раздел пуст"},0,e),i.addCss(a,"tree_none-items")))}catch(e){l(e,"sidebar","onBeforeOpen => generateMenuData")}}(o.action.slice(n+1))}}())},onAfterSelect:function(e){!async function(){if(t.mmenu||await n("fields"),t.fields)try{Backbone.history.navigate("tree/"+e,{trigger:!0})}catch(e){l(e,"sidebar","onAfterSelect => getFields")}}(),function(){try{window.innerWidth<850&&$$("tree").hide()}catch(e){l(e,"sidebar","onAfterSelect => setAdaptiveState")}}()}}};return e}function it(){window.addEventListener("resize",(function(e){!async function(){t.mmenu||await n("mmenu"),t.mmenu&&t.mmenu.mmenu.forEach((function(e,t){var n;$$(e.name)&&$$(e.name).isVisible()&&("forms"==(n=e.name)?function(){const e=$$("formsTools"),t=$$("formsContainer"),n=$$("formsTools-resizer"),i=$$("table-backFormsBtnFilter");window.innerWidth<850&&e.isVisible()&&(e.config.width=window.innerWidth-45,e.resize(),d(t),d(n),d(tree),f(i)),window.innerWidth>850&&e.isVisible()&&350!==e.config.width&&(e.config.width=350,e.resize(),f(n),f(t),d(i))}():"dashboards"==n?function(){const e=$$("dashboard-tool-main"),t=$$("dashboardInfoContainer"),n=$$("tree"),i=$$("dash-backDashBtn");window.innerWidth<850&&e.isVisible()&&(e.config.width=window.innerWidth-45,e.resize(),d(t),d(n),f(i)),window.innerWidth>850&&e.isVisible()&&350!==e.config.width&&(e.config.width=350,e.resize(),f(t),d(i))}():"tables"==n&&(function(){const e=$$("tableContainer"),t=$$("table-editForm"),n=$$("table-backTableBtn"),i=$$("tree");$$("container").$width<850&&t.isVisible()&&d(i),window.innerWidth<850&&t.isVisible()&&(t.config.width=window.innerWidth-45,t.resize(),d(e),d(i),f(n)),window.innerWidth>850&&t.isVisible()&&350!==t.config.width&&(t.config.width=350,t.resize(),f(e),d(n))}(),function(){const e=$$("filterTableForm"),t=$$("tableContainer"),n=$$("table-backTableBtnFilter"),i=$$("tree");window.innerWidth<850&&e.isVisible()&&(e.config.width=window.innerWidth-45,e.resize(),d(t),d(i),f(n)),$$("container").$width<850&&e.isVisible()&&d(i),window.innerWidth>850&&e.isVisible()&&350!==e.config.width&&(e.config.width=350,e.resize(),f(t),d(n))}()))}))}(),function(){const e=$$("tree");window.innerWidth<850&&d(e),!e.isVisible()&&window.innerWidth<=800&&d($$("sideMenuResizer")),window.innerWidth>850&&$$("tree")&&function(){try{e&&(e.config.width=250,e.resize())}catch(e){l(e,"adaptive","resizeSidebar => resizeTree")}}()}(),window.innerWidth>850&&$$("header").getChildViews().forEach((function(e){e.config.id.includes("search")&&e.show()}))}),!0)}!function(){!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("underscore",t):(e="undefined"!=typeof globalThis?globalThis:e||self,function(){var n=e._,i=e._=t();i.noConflict=function(){return e._=n,i}}())}(this,(function(){var e="1.13.4",t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},n=Array.prototype,i=Object.prototype,o="undefined"!=typeof Symbol?Symbol.prototype:null,r=n.push,a=n.slice,s=i.toString,c=i.hasOwnProperty,l="undefined"!=typeof ArrayBuffer,u="undefined"!=typeof DataView,d=Array.isArray,f=Object.keys,h=Object.create,p=l&&ArrayBuffer.isView,b=isNaN,$=isFinite,m=!{toString:null}.propertyIsEnumerable("toString"),g=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],w=Math.pow(2,53)-1;function v(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),i=Array(n),o=0;o<n;o++)i[o]=arguments[o+t];switch(t){case 0:return e.call(this,i);case 1:return e.call(this,arguments[0],i);case 2:return e.call(this,arguments[0],arguments[1],i)}var r=Array(t+1);for(o=0;o<t;o++)r[o]=arguments[o];return r[t]=i,e.apply(this,r)}}function y(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function x(e){return void 0===e}function _(e){return!0===e||!1===e||"[object Boolean]"===s.call(e)}function E(e){var t="[object "+e+"]";return function(e){return s.call(e)===t}}var k=E("String"),T=E("Number"),V=E("Date"),I=E("RegExp"),C=E("Error"),S=E("Symbol"),B=E("ArrayBuffer"),F=E("Function"),A=t.document&&t.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof A&&(F=function(e){return"function"==typeof e||!1});var j=F,P=E("Object"),L=u&&P(new DataView(new ArrayBuffer(8))),O="undefined"!=typeof Map&&P(new Map),N=E("DataView"),R=L?function(e){return null!=e&&j(e.getInt8)&&B(e.buffer)}:N,D=d||E("Array");function z(e,t){return null!=e&&c.call(e,t)}var H=E("Arguments");!function(){H(arguments)||(H=function(e){return z(e,"callee")})}();var W=H;function U(e){return T(e)&&b(e)}function M(e){return function(){return e}}function q(e){return function(t){var n=e(t);return"number"==typeof n&&n>=0&&n<=w}}function J(e){return function(t){return null==t?void 0:t[e]}}var Y=J("byteLength"),K=q(Y),G=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,Q=l?function(e){return p?p(e)&&!R(e):K(e)&&G.test(s.call(e))}:M(!1),X=J("length");function Z(e,t){t=function(e){for(var t={},n=e.length,i=0;i<n;++i)t[e[i]]=!0;return{contains:function(e){return!0===t[e]},push:function(n){return t[n]=!0,e.push(n)}}}(t);var n=g.length,o=e.constructor,r=j(o)&&o.prototype||i,a="constructor";for(z(e,a)&&!t.contains(a)&&t.push(a);n--;)(a=g[n])in e&&e[a]!==r[a]&&!t.contains(a)&&t.push(a)}function ee(e){if(!y(e))return[];if(f)return f(e);var t=[];for(var n in e)z(e,n)&&t.push(n);return m&&Z(e,t),t}function te(e,t){var n=ee(t),i=n.length;if(null==e)return!i;for(var o=Object(e),r=0;r<i;r++){var a=n[r];if(t[a]!==o[a]||!(a in o))return!1}return!0}function ne(e){return e instanceof ne?e:this instanceof ne?void(this._wrapped=e):new ne(e)}function ie(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,Y(e))}ne.VERSION=e,ne.prototype.value=function(){return this._wrapped},ne.prototype.valueOf=ne.prototype.toJSON=ne.prototype.value,ne.prototype.toString=function(){return String(this._wrapped)};var oe="[object DataView]";function re(e,t,n,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=typeof e;return("function"===o||"object"===o||"object"==typeof t)&&ae(e,t,n,i)}function ae(e,t,n,i){e instanceof ne&&(e=e._wrapped),t instanceof ne&&(t=t._wrapped);var r=s.call(e);if(r!==s.call(t))return!1;if(L&&"[object Object]"==r&&R(e)){if(!R(t))return!1;r=oe}switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return o.valueOf.call(e)===o.valueOf.call(t);case"[object ArrayBuffer]":case oe:return ae(ie(e),ie(t),n,i)}var a="[object Array]"===r;if(!a&&Q(e)){if(Y(e)!==Y(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;a=!0}if(!a){if("object"!=typeof e||"object"!=typeof t)return!1;var c=e.constructor,l=t.constructor;if(c!==l&&!(j(c)&&c instanceof c&&j(l)&&l instanceof l)&&"constructor"in e&&"constructor"in t)return!1}i=i||[];for(var u=(n=n||[]).length;u--;)if(n[u]===e)return i[u]===t;if(n.push(e),i.push(t),a){if((u=e.length)!==t.length)return!1;for(;u--;)if(!re(e[u],t[u],n,i))return!1}else{var d,f=ee(e);if(u=f.length,ee(t).length!==u)return!1;for(;u--;)if(!z(t,d=f[u])||!re(e[d],t[d],n,i))return!1}return n.pop(),i.pop(),!0}function se(e){if(!y(e))return[];var t=[];for(var n in e)t.push(n);return m&&Z(e,t),t}function ce(e){var t=X(e);return function(n){if(null==n)return!1;var i=se(n);if(X(i))return!1;for(var o=0;o<t;o++)if(!j(n[e[o]]))return!1;return e!==he||!j(n[le])}}var le="forEach",ue=["clear","delete"],de=["get","has","set"],fe=ue.concat(le,de),he=ue.concat(de),pe=["add"].concat(ue,le,"has"),be=O?ce(fe):E("Map"),$e=O?ce(he):E("WeakMap"),me=O?ce(pe):E("Set"),ge=E("WeakSet");function we(e){for(var t=ee(e),n=t.length,i=Array(n),o=0;o<n;o++)i[o]=e[t[o]];return i}function ve(e){for(var t={},n=ee(e),i=0,o=n.length;i<o;i++)t[e[n[i]]]=n[i];return t}function ye(e){var t=[];for(var n in e)j(e[n])&&t.push(n);return t.sort()}function xe(e,t){return function(n){var i=arguments.length;if(t&&(n=Object(n)),i<2||null==n)return n;for(var o=1;o<i;o++)for(var r=arguments[o],a=e(r),s=a.length,c=0;c<s;c++){var l=a[c];t&&void 0!==n[l]||(n[l]=r[l])}return n}}var _e=xe(se),Ee=xe(ee),ke=xe(se,!0);function Te(e){if(!y(e))return{};if(h)return h(e);var t=function(){};t.prototype=e;var n=new t;return t.prototype=null,n}function Ve(e){return D(e)?e:[e]}function Ie(e){return ne.toPath(e)}function Ce(e,t){for(var n=t.length,i=0;i<n;i++){if(null==e)return;e=e[t[i]]}return n?e:void 0}function Se(e,t,n){var i=Ce(e,Ie(t));return x(i)?n:i}function Be(e){return e}function Fe(e){return e=Ee({},e),function(t){return te(t,e)}}function Ae(e){return e=Ie(e),function(t){return Ce(t,e)}}function je(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,i,o){return e.call(t,n,i,o)};case 4:return function(n,i,o,r){return e.call(t,n,i,o,r)}}return function(){return e.apply(t,arguments)}}function Pe(e,t,n){return null==e?Be:j(e)?je(e,t,n):y(e)&&!D(e)?Fe(e):Ae(e)}function Le(e,t){return Pe(e,t,1/0)}function Oe(e,t,n){return ne.iteratee!==Le?ne.iteratee(e,t):Pe(e,t,n)}function Ne(){}function Re(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}ne.toPath=Ve,ne.iteratee=Le;var De=Date.now||function(){return(new Date).getTime()};function ze(e){var t=function(t){return e[t]},n="(?:"+ee(e).join("|")+")",i=RegExp(n),o=RegExp(n,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(o,t):e}}var He={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},We=ze(He),Ue=ze(ve(He)),Me=ne.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},qe=/(.)^/,Je={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Ye=/\\|'|\r|\n|\u2028|\u2029/g;function Ke(e){return"\\"+Je[e]}var Ge=/^\s*(\w|\$)+\s*$/,Qe=0;function Xe(e,t,n,i,o){if(!(i instanceof t))return e.apply(n,o);var r=Te(e.prototype),a=e.apply(r,o);return y(a)?a:r}var Ze=v((function(e,t){var n=Ze.placeholder,i=function(){for(var o=0,r=t.length,a=Array(r),s=0;s<r;s++)a[s]=t[s]===n?arguments[o++]:t[s];for(;o<arguments.length;)a.push(arguments[o++]);return Xe(e,i,this,this,a)};return i}));Ze.placeholder=ne;var et=v((function(e,t,n){if(!j(e))throw new TypeError("Bind must be called on a function");var i=v((function(o){return Xe(e,i,t,this,n.concat(o))}));return i})),tt=q(X);function nt(e,t,n,i){if(i=i||[],t||0===t){if(t<=0)return i.concat(e)}else t=1/0;for(var o=i.length,r=0,a=X(e);r<a;r++){var s=e[r];if(tt(s)&&(D(s)||W(s)))if(t>1)nt(s,t-1,n,i),o=i.length;else for(var c=0,l=s.length;c<l;)i[o++]=s[c++];else n||(i[o++]=s)}return i}var it=v((function(e,t){var n=(t=nt(t,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var i=t[n];e[i]=et(e[i],e)}return e})),ot=v((function(e,t,n){return setTimeout((function(){return e.apply(null,n)}),t)})),rt=Ze(ot,ne,1);function at(e){return function(){return!e.apply(this,arguments)}}function st(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}var ct=Ze(st,2);function lt(e,t,n){t=Oe(t,n);for(var i,o=ee(e),r=0,a=o.length;r<a;r++)if(t(e[i=o[r]],i,e))return i}function ut(e){return function(t,n,i){n=Oe(n,i);for(var o=X(t),r=e>0?0:o-1;r>=0&&r<o;r+=e)if(n(t[r],r,t))return r;return-1}}var dt=ut(1),ft=ut(-1);function ht(e,t,n,i){for(var o=(n=Oe(n,i,1))(t),r=0,a=X(e);r<a;){var s=Math.floor((r+a)/2);n(e[s])<o?r=s+1:a=s}return r}function pt(e,t,n){return function(i,o,r){var s=0,c=X(i);if("number"==typeof r)e>0?s=r>=0?r:Math.max(r+c,s):c=r>=0?Math.min(r+1,c):r+c+1;else if(n&&r&&c)return i[r=n(i,o)]===o?r:-1;if(o!=o)return(r=t(a.call(i,s,c),U))>=0?r+s:-1;for(r=e>0?s:c-1;r>=0&&r<c;r+=e)if(i[r]===o)return r;return-1}}var bt=pt(1,dt,ht),$t=pt(-1,ft);function mt(e,t,n){var i=(tt(e)?dt:lt)(e,t,n);if(void 0!==i&&-1!==i)return e[i]}function gt(e,t,n){var i,o;if(t=je(t,n),tt(e))for(i=0,o=e.length;i<o;i++)t(e[i],i,e);else{var r=ee(e);for(i=0,o=r.length;i<o;i++)t(e[r[i]],r[i],e)}return e}function wt(e,t,n){t=Oe(t,n);for(var i=!tt(e)&&ee(e),o=(i||e).length,r=Array(o),a=0;a<o;a++){var s=i?i[a]:a;r[a]=t(e[s],s,e)}return r}function vt(e){var t=function(t,n,i,o){var r=!tt(t)&&ee(t),a=(r||t).length,s=e>0?0:a-1;for(o||(i=t[r?r[s]:s],s+=e);s>=0&&s<a;s+=e){var c=r?r[s]:s;i=n(i,t[c],c,t)}return i};return function(e,n,i,o){var r=arguments.length>=3;return t(e,je(n,o,4),i,r)}}var yt=vt(1),xt=vt(-1);function _t(e,t,n){var i=[];return t=Oe(t,n),gt(e,(function(e,n,o){t(e,n,o)&&i.push(e)})),i}function Et(e,t,n){t=Oe(t,n);for(var i=!tt(e)&&ee(e),o=(i||e).length,r=0;r<o;r++){var a=i?i[r]:r;if(!t(e[a],a,e))return!1}return!0}function kt(e,t,n){t=Oe(t,n);for(var i=!tt(e)&&ee(e),o=(i||e).length,r=0;r<o;r++){var a=i?i[r]:r;if(t(e[a],a,e))return!0}return!1}function Tt(e,t,n,i){return tt(e)||(e=we(e)),("number"!=typeof n||i)&&(n=0),bt(e,t,n)>=0}var Vt=v((function(e,t,n){var i,o;return j(t)?o=t:(t=Ie(t),i=t.slice(0,-1),t=t[t.length-1]),wt(e,(function(e){var r=o;if(!r){if(i&&i.length&&(e=Ce(e,i)),null==e)return;r=e[t]}return null==r?r:r.apply(e,n)}))}));function It(e,t){return wt(e,Ae(t))}function Ct(e,t,n){var i,o,r=-1/0,a=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,c=(e=tt(e)?e:we(e)).length;s<c;s++)null!=(i=e[s])&&i>r&&(r=i);else t=Oe(t,n),gt(e,(function(e,n,i){((o=t(e,n,i))>a||o===-1/0&&r===-1/0)&&(r=e,a=o)}));return r}var St=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Bt(e){return e?D(e)?a.call(e):k(e)?e.match(St):tt(e)?wt(e,Be):we(e):[]}function Ft(e,t,n){if(null==t||n)return tt(e)||(e=we(e)),e[Re(e.length-1)];var i=Bt(e),o=X(i);t=Math.max(Math.min(t,o),0);for(var r=o-1,a=0;a<t;a++){var s=Re(a,r),c=i[a];i[a]=i[s],i[s]=c}return i.slice(0,t)}function At(e,t){return function(n,i,o){var r=t?[[],[]]:{};return i=Oe(i,o),gt(n,(function(t,o){var a=i(t,o,n);e(r,t,a)})),r}}var jt=At((function(e,t,n){z(e,n)?e[n].push(t):e[n]=[t]})),Pt=At((function(e,t,n){e[n]=t})),Lt=At((function(e,t,n){z(e,n)?e[n]++:e[n]=1})),Ot=At((function(e,t,n){e[n?0:1].push(t)}),!0);function Nt(e,t,n){return t in n}var Rt=v((function(e,t){var n={},i=t[0];if(null==e)return n;j(i)?(t.length>1&&(i=je(i,t[1])),t=se(e)):(i=Nt,t=nt(t,!1,!1),e=Object(e));for(var o=0,r=t.length;o<r;o++){var a=t[o],s=e[a];i(s,a,e)&&(n[a]=s)}return n})),Dt=v((function(e,t){var n,i=t[0];return j(i)?(i=at(i),t.length>1&&(n=t[1])):(t=wt(nt(t,!1,!1),String),i=function(e,n){return!Tt(t,n)}),Rt(e,i,n)}));function zt(e,t,n){return a.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))}function Ht(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[0]:zt(e,e.length-t)}function Wt(e,t,n){return a.call(e,null==t||n?1:t)}var Ut=v((function(e,t){return t=nt(t,!0,!0),_t(e,(function(e){return!Tt(t,e)}))})),Mt=v((function(e,t){return Ut(e,t)}));function qt(e,t,n,i){_(t)||(i=n,n=t,t=!1),null!=n&&(n=Oe(n,i));for(var o=[],r=[],a=0,s=X(e);a<s;a++){var c=e[a],l=n?n(c,a,e):c;t&&!n?(a&&r===l||o.push(c),r=l):n?Tt(r,l)||(r.push(l),o.push(c)):Tt(o,c)||o.push(c)}return o}var Jt=v((function(e){return qt(nt(e,!0,!0))}));function Yt(e){for(var t=e&&Ct(e,X).length||0,n=Array(t),i=0;i<t;i++)n[i]=It(e,i);return n}var Kt=v(Yt);function Gt(e,t){return e._chain?ne(t).chain():t}function Qt(e){return gt(ye(e),(function(t){var n=ne[t]=e[t];ne.prototype[t]=function(){var e=[this._wrapped];return r.apply(e,arguments),Gt(this,n.apply(ne,e))}})),ne}gt(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=n[e];ne.prototype[e]=function(){var n=this._wrapped;return null!=n&&(t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0]),Gt(this,n)}})),gt(["concat","join","slice"],(function(e){var t=n[e];ne.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),Gt(this,e)}}));var Xt={__proto__:null,VERSION:e,restArguments:v,isObject:y,isNull:function(e){return null===e},isUndefined:x,isBoolean:_,isElement:function(e){return!(!e||1!==e.nodeType)},isString:k,isNumber:T,isDate:V,isRegExp:I,isError:C,isSymbol:S,isArrayBuffer:B,isDataView:R,isArray:D,isFunction:j,isArguments:W,isFinite:function(e){return!S(e)&&$(e)&&!isNaN(parseFloat(e))},isNaN:U,isTypedArray:Q,isEmpty:function(e){if(null==e)return!0;var t=X(e);return"number"==typeof t&&(D(e)||k(e)||W(e))?0===t:0===X(ee(e))},isMatch:te,isEqual:function(e,t){return re(e,t)},isMap:be,isWeakMap:$e,isSet:me,isWeakSet:ge,keys:ee,allKeys:se,values:we,pairs:function(e){for(var t=ee(e),n=t.length,i=Array(n),o=0;o<n;o++)i[o]=[t[o],e[t[o]]];return i},invert:ve,functions:ye,methods:ye,extend:_e,extendOwn:Ee,assign:Ee,defaults:ke,create:function(e,t){var n=Te(e);return t&&Ee(n,t),n},clone:function(e){return y(e)?D(e)?e.slice():_e({},e):e},tap:function(e,t){return t(e),e},get:Se,has:function(e,t){for(var n=(t=Ie(t)).length,i=0;i<n;i++){var o=t[i];if(!z(e,o))return!1;e=e[o]}return!!n},mapObject:function(e,t,n){t=Oe(t,n);for(var i=ee(e),o=i.length,r={},a=0;a<o;a++){var s=i[a];r[s]=t(e[s],s,e)}return r},identity:Be,constant:M,noop:Ne,toPath:Ve,property:Ae,propertyOf:function(e){return null==e?Ne:function(t){return Se(e,t)}},matcher:Fe,matches:Fe,times:function(e,t,n){var i=Array(Math.max(0,e));t=je(t,n,1);for(var o=0;o<e;o++)i[o]=t(o);return i},random:Re,now:De,escape:We,unescape:Ue,templateSettings:Me,template:function(e,t,n){!t&&n&&(t=n),t=ke({},t,ne.templateSettings);var i=RegExp([(t.escape||qe).source,(t.interpolate||qe).source,(t.evaluate||qe).source].join("|")+"|$","g"),o=0,r="__p+='";e.replace(i,(function(t,n,i,a,s){return r+=e.slice(o,s).replace(Ye,Ke),o=s+t.length,n?r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?r+="'+\n((__t=("+i+"))==null?'':__t)+\n'":a&&(r+="';\n"+a+"\n__p+='"),t})),r+="';\n";var a,s=t.variable;if(s){if(!Ge.test(s))throw new Error("variable is not a bare identifier: "+s)}else r="with(obj||{}){\n"+r+"}\n",s="obj";r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{a=new Function(s,"_",r)}catch(e){throw e.source=r,e}var c=function(e){return a.call(this,e,ne)};return c.source="function("+s+"){\n"+r+"}",c},result:function(e,t,n){var i=(t=Ie(t)).length;if(!i)return j(n)?n.call(e):n;for(var o=0;o<i;o++){var r=null==e?void 0:e[t[o]];void 0===r&&(r=n,o=i),e=j(r)?r.call(e):r}return e},uniqueId:function(e){var t=++Qe+"";return e?e+t:t},chain:function(e){var t=ne(e);return t._chain=!0,t},iteratee:Le,partial:Ze,bind:et,bindAll:it,memoize:function(e,t){var n=function(i){var o=n.cache,r=""+(t?t.apply(this,arguments):i);return z(o,r)||(o[r]=e.apply(this,arguments)),o[r]};return n.cache={},n},delay:ot,defer:rt,throttle:function(e,t,n){var i,o,r,a,s=0;n||(n={});var c=function(){s=!1===n.leading?0:De(),i=null,a=e.apply(o,r),i||(o=r=null)},l=function(){var l=De();s||!1!==n.leading||(s=l);var u=t-(l-s);return o=this,r=arguments,u<=0||u>t?(i&&(clearTimeout(i),i=null),s=l,a=e.apply(o,r),i||(o=r=null)):i||!1===n.trailing||(i=setTimeout(c,u)),a};return l.cancel=function(){clearTimeout(i),s=0,i=o=r=null},l},debounce:function(e,t,n){var i,o,r,a,s,c=function(){var l=De()-o;t>l?i=setTimeout(c,t-l):(i=null,n||(a=e.apply(s,r)),i||(r=s=null))},l=v((function(l){return s=this,r=l,o=De(),i||(i=setTimeout(c,t),n&&(a=e.apply(s,r))),a}));return l.cancel=function(){clearTimeout(i),i=r=s=null},l},wrap:function(e,t){return Ze(t,e)},negate:at,compose:function(){var e=arguments,t=e.length-1;return function(){for(var n=t,i=e[t].apply(this,arguments);n--;)i=e[n].call(this,i);return i}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:st,once:ct,findKey:lt,findIndex:dt,findLastIndex:ft,sortedIndex:ht,indexOf:bt,lastIndexOf:$t,find:mt,detect:mt,findWhere:function(e,t){return mt(e,Fe(t))},each:gt,forEach:gt,map:wt,collect:wt,reduce:yt,foldl:yt,inject:yt,reduceRight:xt,foldr:xt,filter:_t,select:_t,reject:function(e,t,n){return _t(e,at(Oe(t)),n)},every:Et,all:Et,some:kt,any:kt,contains:Tt,includes:Tt,include:Tt,invoke:Vt,pluck:It,where:function(e,t){return _t(e,Fe(t))},max:Ct,min:function(e,t,n){var i,o,r=1/0,a=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,c=(e=tt(e)?e:we(e)).length;s<c;s++)null!=(i=e[s])&&i<r&&(r=i);else t=Oe(t,n),gt(e,(function(e,n,i){((o=t(e,n,i))<a||o===1/0&&r===1/0)&&(r=e,a=o)}));return r},shuffle:function(e){return Ft(e,1/0)},sample:Ft,sortBy:function(e,t,n){var i=0;return t=Oe(t,n),It(wt(e,(function(e,n,o){return{value:e,index:i++,criteria:t(e,n,o)}})).sort((function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return e.index-t.index})),"value")},groupBy:jt,indexBy:Pt,countBy:Lt,partition:Ot,toArray:Bt,size:function(e){return null==e?0:tt(e)?e.length:ee(e).length},pick:Rt,omit:Dt,first:Ht,head:Ht,take:Ht,initial:zt,last:function(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[e.length-1]:Wt(e,Math.max(0,e.length-t))},rest:Wt,tail:Wt,drop:Wt,compact:function(e){return _t(e,Boolean)},flatten:function(e,t){return nt(e,t,!1)},without:Mt,uniq:qt,unique:qt,union:Jt,intersection:function(e){for(var t=[],n=arguments.length,i=0,o=X(e);i<o;i++){var r=e[i];if(!Tt(t,r)){var a;for(a=1;a<n&&Tt(arguments[a],r);a++);a===n&&t.push(r)}}return t},difference:Ut,unzip:Yt,transpose:Yt,zip:Kt,object:function(e,t){for(var n={},i=0,o=X(e);i<o;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},range:function(e,t,n){null==t&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var i=Math.max(Math.ceil((t-e)/n),0),o=Array(i),r=0;r<i;r++,e+=n)o[r]=e;return o},chunk:function(e,t){if(null==t||t<1)return[];for(var n=[],i=0,o=e.length;i<o;)n.push(a.call(e,i,i+=t));return n},mixin:Qt,default:ne},Zt=Qt(Xt);return Zt._=Zt,Zt})),function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],(function(n,i,o){t.Backbone=e(t,o,n,i)}));else if("undefined"!=typeof exports){var n,i=require("underscore");try{n=require("jquery")}catch(e){}e(t,exports,i,n)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}((function(e,t,n,i){var o=e.Backbone,r=Array.prototype.slice;t.VERSION="1.4.1",t.$=i,t.noConflict=function(){return e.Backbone=o,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a,s=t.Events={},c=/\s+/,l=function(e,t,i,o,r){var a,s=0;if(i&&"object"==typeof i){void 0!==o&&"context"in r&&void 0===r.context&&(r.context=o);for(a=n.keys(i);s<a.length;s++)t=l(e,t,a[s],i[a[s]],r)}else if(i&&c.test(i))for(a=i.split(c);s<a.length;s++)t=e(t,a[s],o,r);else t=e(t,i,o,r);return t};s.on=function(e,t,n){return this._events=l(u,this._events||{},e,t,{context:n,ctx:this,listening:a}),a&&((this._listeners||(this._listeners={}))[a.id]=a,a.interop=!1),this},s.listenTo=function(e,t,i){if(!e)return this;var o=e._listenId||(e._listenId=n.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),s=a=r[o];s||(this._listenId||(this._listenId=n.uniqueId("l")),s=a=r[o]=new $(this,e));var c=d(e,t,i,this);if(a=void 0,c)throw c;return s.interop&&s.on(t,i),this};var u=function(e,t,n,i){if(n){var o=e[t]||(e[t]=[]),r=i.context,a=i.ctx,s=i.listening;s&&s.count++,o.push({callback:n,context:r,ctx:r||a,listening:s})}return e},d=function(e,t,n,i){try{e.on(t,n,i)}catch(e){return e}};s.off=function(e,t,n){return this._events?(this._events=l(f,this._events,e,t,{context:n,listeners:this._listeners}),this):this},s.stopListening=function(e,t,i){var o=this._listeningTo;if(!o)return this;for(var r=e?[e._listenId]:n.keys(o),a=0;a<r.length;a++){var s=o[r[a]];if(!s)break;s.obj.off(t,i,this),s.interop&&s.off(t,i)}return n.isEmpty(o)&&(this._listeningTo=void 0),this};var f=function(e,t,i,o){if(e){var r,a=o.context,s=o.listeners,c=0;if(t||a||i){for(r=t?[t]:n.keys(e);c<r.length;c++){var l=e[t=r[c]];if(!l)break;for(var u=[],d=0;d<l.length;d++){var f=l[d];if(i&&i!==f.callback&&i!==f.callback._callback||a&&a!==f.context)u.push(f);else{var h=f.listening;h&&h.off(t,i)}}u.length?e[t]=u:delete e[t]}return e}for(r=n.keys(s);c<r.length;c++)s[r[c]].cleanup()}};s.once=function(e,t,n){var i=l(h,{},e,t,this.off.bind(this));return"string"==typeof e&&null==n&&(t=void 0),this.on(i,t,n)},s.listenToOnce=function(e,t,n){var i=l(h,{},t,n,this.stopListening.bind(this,e));return this.listenTo(e,i)};var h=function(e,t,i,o){if(i){var r=e[t]=n.once((function(){o(t,r),i.apply(this,arguments)}));r._callback=i}return e};s.trigger=function(e){if(!this._events)return this;for(var t=Math.max(0,arguments.length-1),n=Array(t),i=0;i<t;i++)n[i]=arguments[i+1];return l(p,this._events,e,void 0,n),this};var p=function(e,t,n,i){if(e){var o=e[t],r=e.all;o&&r&&(r=r.slice()),o&&b(o,i),r&&b(r,[t].concat(i))}return e},b=function(e,t){var n,i=-1,o=e.length,r=t[0],a=t[1],s=t[2];switch(t.length){case 0:for(;++i<o;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;++i<o;)(n=e[i]).callback.call(n.ctx,r);return;case 2:for(;++i<o;)(n=e[i]).callback.call(n.ctx,r,a);return;case 3:for(;++i<o;)(n=e[i]).callback.call(n.ctx,r,a,s);return;default:for(;++i<o;)(n=e[i]).callback.apply(n.ctx,t);return}},$=function(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0};$.prototype.on=s.on,$.prototype.off=function(e,t){var n;this.interop?(this._events=l(f,this._events,e,t,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()},$.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},s.bind=s.on,s.unbind=s.off,n.extend(t,s);var m=t.Model=function(e,t){var i=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(i=this.parse(i,t)||{});var o=n.result(this,"defaults");i=n.defaults(n.extend({},o,i),o),this.set(i,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(m.prototype,s,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!n.iteratee(e,this)(this.attributes)},set:function(e,t,i){if(null==e)return this;var o;if("object"==typeof e?(o=e,i=t):(o={})[e]=t,i||(i={}),!this._validate(o,i))return!1;var r=i.unset,a=i.silent,s=[],c=this._changing;this._changing=!0,c||(this._previousAttributes=n.clone(this.attributes),this.changed={});var l=this.attributes,u=this.changed,d=this._previousAttributes;for(var f in o)t=o[f],n.isEqual(l[f],t)||s.push(f),n.isEqual(d[f],t)?delete u[f]:u[f]=t,r?delete l[f]:l[f]=t;if(this.idAttribute in o){var h=this.id;this.id=this.get(this.idAttribute),this.trigger("changeId",this,h,i)}if(!a){s.length&&(this._pending=i);for(var p=0;p<s.length;p++)this.trigger("change:"+s[p],this,l[s[p]],i)}if(c)return this;if(!a)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&n.clone(this.changed);var t,i=this._changing?this._previousAttributes:this.attributes,o={};for(var r in e){var a=e[r];n.isEqual(i[r],a)||(o[r]=a,t=!0)}return!!t&&o},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=n.extend({parse:!0},e);var t=this,i=e.success;return e.success=function(n){var o=e.parse?t.parse(n,e):n;if(!t.set(o,e))return!1;i&&i.call(e.context,t,n,e),t.trigger("sync",t,n,e)},U(this,e),this.sync("read",this,e)},save:function(e,t,i){var o;null==e||"object"==typeof e?(o=e,i=t):(o={})[e]=t;var r=(i=n.extend({validate:!0,parse:!0},i)).wait;if(o&&!r){if(!this.set(o,i))return!1}else if(!this._validate(o,i))return!1;var a=this,s=i.success,c=this.attributes;i.success=function(e){a.attributes=c;var t=i.parse?a.parse(e,i):e;if(r&&(t=n.extend({},o,t)),t&&!a.set(t,i))return!1;s&&s.call(i.context,a,e,i),a.trigger("sync",a,e,i)},U(this,i),o&&r&&(this.attributes=n.extend({},c,o));var l=this.isNew()?"create":i.patch?"patch":"update";"patch"!==l||i.attrs||(i.attrs=o);var u=this.sync(l,this,i);return this.attributes=c,u},destroy:function(e){e=e?n.clone(e):{};var t=this,i=e.success,o=e.wait,r=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(n){o&&r(),i&&i.call(e.context,t,n,e),t.isNew()||t.trigger("sync",t,n,e)};var a=!1;return this.isNew()?n.defer(e.success):(U(this,e),a=this.sync("delete",this,e)),o||r(),a},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||W();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return!i||(this.trigger("invalid",this,i,n.extend(t,{validationError:i})),!1)}});var g=t.Collection=function(e,t){t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},w={add:!0,remove:!0,merge:!0},v={add:!0,remove:!1},y=function(e,t,n){n=Math.min(Math.max(n,0),e.length);var i,o=Array(e.length-n),r=t.length;for(i=0;i<o.length;i++)o[i]=e[i+n];for(i=0;i<r;i++)e[i+n]=t[i];for(i=0;i<o.length;i++)e[i+r+n]=o[i]};n.extend(g.prototype,s,{model:m,preinitialize:function(){},initialize:function(){},toJSON:function(e){return this.map((function(t){return t.toJSON(e)}))},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,v))},remove:function(e,t){t=n.extend({},t);var i=!n.isArray(e);e=i?[e]:e.slice();var o=this._removeModels(e,t);return!t.silent&&o.length&&(t.changes={added:[],merged:[],removed:o},this.trigger("update",this,t)),i?o[0]:o},set:function(e,t){if(null!=e){(t=n.extend({},w,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var i=!n.isArray(e);e=i?[e]:e.slice();var o=t.at;null!=o&&(o=+o),o>this.length&&(o=this.length),o<0&&(o+=this.length+1);var r,a,s=[],c=[],l=[],u=[],d={},f=t.add,h=t.merge,p=t.remove,b=!1,$=this.comparator&&null==o&&!1!==t.sort,m=n.isString(this.comparator)?this.comparator:null;for(a=0;a<e.length;a++){r=e[a];var g=this.get(r);if(g){if(h&&r!==g){var v=this._isModel(r)?r.attributes:r;t.parse&&(v=g.parse(v,t)),g.set(v,t),l.push(g),$&&!b&&(b=g.hasChanged(m))}d[g.cid]||(d[g.cid]=!0,s.push(g)),e[a]=g}else f&&(r=e[a]=this._prepareModel(r,t))&&(c.push(r),this._addReference(r,t),d[r.cid]=!0,s.push(r))}if(p){for(a=0;a<this.length;a++)d[(r=this.models[a]).cid]||u.push(r);u.length&&this._removeModels(u,t)}var x=!1,_=!$&&f&&p;if(s.length&&_?(x=this.length!==s.length||n.some(this.models,(function(e,t){return e!==s[t]})),this.models.length=0,y(this.models,s,0),this.length=this.models.length):c.length&&($&&(b=!0),y(this.models,c,null==o?this.length:o),this.length=this.models.length),b&&this.sort({silent:!0}),!t.silent){for(a=0;a<c.length;a++)null!=o&&(t.index=o+a),(r=c[a]).trigger("add",r,this,t);(b||x)&&this.trigger("sort",this,t),(c.length||u.length||l.length)&&(t.changes={added:c,removed:u,merged:l},this.trigger("update",this,t))}return i?e[0]:e}},reset:function(e,t){t=t?n.clone(t):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return r.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e,e.idAttribute)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var i=t.length;return n.isFunction(t)&&(t=t.bind(this)),1===i||n.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){var t=(e=n.extend({parse:!0},e)).success,i=this;return e.success=function(n){var o=e.reset?"reset":"set";i[o](n,e),t&&t.call(e.context,i,n,e),i.trigger("sync",i,n,e)},U(this,e),this.sync("read",this,e)},create:function(e,t){var i=(t=t?n.clone(t):{}).wait;if(!(e=this._prepareModel(e,t)))return!1;i||this.add(e,t);var o=this,r=t.success;return t.success=function(e,t,n){i&&o.add(e,n),r&&r.call(n.context,e,t,n)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e,t){return e[t||this.model.prototype.idAttribute||"id"]},values:function(){return new _(this,E)},keys:function(){return new _(this,k)},entries:function(){return new _(this,T)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){return this._isModel(e)?(e.collection||(e.collection=this),e):((t=t?n.clone(t):{}).collection=this,(i=this.model.prototype?new this.model(e,t):this.model(e,t)).validationError?(this.trigger("invalid",this,i.validationError,t),!1):i);var i},_removeModels:function(e,t){for(var n=[],i=0;i<e.length;i++){var o=this.get(e[i]);if(o){var r=this.indexOf(o);this.models.splice(r,1),this.length--,delete this._byId[o.cid];var a=this.modelId(o.attributes,o.idAttribute);null!=a&&delete this._byId[a],t.silent||(t.index=r,o.trigger("remove",o,this,t)),n.push(o),this._removeReference(o,t)}}return n},_isModel:function(e){return e instanceof m},_addReference:function(e,t){this._byId[e.cid]=e;var n=this.modelId(e.attributes,e.idAttribute);null!=n&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var n=this.modelId(e.attributes,e.idAttribute);null!=n&&delete this._byId[n],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){if(t){if(("add"===e||"remove"===e)&&n!==this)return;if("destroy"===e&&this.remove(t,i),"changeId"===e){var o=this.modelId(t.previousAttributes(),t.idAttribute),r=this.modelId(t.attributes,t.idAttribute);null!=o&&delete this._byId[o],null!=r&&(this._byId[r]=t)}}this.trigger.apply(this,arguments)}});var x="function"==typeof Symbol&&Symbol.iterator;x&&(g.prototype[x]=g.prototype.values);var _=function(e,t){this._collection=e,this._kind=t,this._index=0},E=1,k=2,T=3;x&&(_.prototype[x]=function(){return this}),_.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var e,t=this._collection.at(this._index);if(this._index++,this._kind===E)e=t;else{var n=this._collection.modelId(t.attributes,t.idAttribute);e=this._kind===k?n:[n,t]}return{value:e,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var V=t.View=function(e){this.cid=n.uniqueId("view"),this.preinitialize.apply(this,arguments),n.extend(this,n.pick(e,C)),this._ensureElement(),this.initialize.apply(this,arguments)},I=/^(\S+)\s*(.*)$/,C=["model","collection","el","id","attributes","className","tagName","events"];n.extend(V.prototype,s,{tagName:"div",$:function(e){return this.$el.find(e)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=n.result(this,"events")),!e)return this;for(var t in this.undelegateEvents(),e){var i=e[t];if(n.isFunction(i)||(i=this[i]),i){var o=t.match(I);this.delegate(o[1],o[2],i.bind(this))}}return this},delegate:function(e,t,n){return this.$el.on(e+".delegateEvents"+this.cid,t,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,n){return this.$el.off(e+".delegateEvents"+this.cid,t,n),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"));else{var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e.class=n.result(this,"className")),this.setElement(this._createElement(n.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}});var S=function(e,t,i,o){n.each(i,(function(n,i){t[i]&&(e.prototype[i]=function(e,t,n,i){switch(t){case 1:return function(){return e[n](this[i])};case 2:return function(t){return e[n](this[i],t)};case 3:return function(t,o){return e[n](this[i],B(t,this),o)};case 4:return function(t,o,r){return e[n](this[i],B(t,this),o,r)};default:return function(){var t=r.call(arguments);return t.unshift(this[i]),e[n].apply(e,t)}}}(t,n,i,o))}))},B=function(e,t){return n.isFunction(e)?e:n.isObject(e)&&!t._isModel(e)?F(e):n.isString(e)?function(t){return t.get(e)}:e},F=function(e){var t=n.matches(e);return function(e){return t(e.attributes)}};n.each([[g,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"],[m,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],(function(e){var t=e[0],i=e[1],o=e[2];t.mixin=function(e){var i=n.reduce(n.functions(e),(function(e,t){return e[t]=0,e}),{});S(t,e,i,o)},S(t,n,i,o)})),t.sync=function(e,i,o){var r=A[e];n.defaults(o||(o={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var a={type:r,dataType:"json"};if(o.url||(a.url=n.result(i,"url")||W()),null!=o.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(o.attrs||i.toJSON(o))),o.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),o.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){a.type="POST",o.emulateJSON&&(a.data._method=r);var s=o.beforeSend;o.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",r),s)return s.apply(this,arguments)}}"GET"===a.type||o.emulateJSON||(a.processData=!1);var c=o.error;o.error=function(e,t,n){o.textStatus=t,o.errorThrown=n,c&&c.call(o.context,e,t,n)};var l=o.xhr=t.ajax(n.extend(a,o));return i.trigger("request",i,l,o),l};var A={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var j=t.Router=function(e){e||(e={}),this.preinitialize.apply(this,arguments),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},P=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,O=/\*\w+/g,N=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(j.prototype,s,{preinitialize:function(){},initialize:function(){},route:function(e,i,o){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(i)&&(o=i,i=""),o||(o=this[i]);var r=this;return t.history.route(e,(function(n){var a=r._extractParameters(e,n);!1!==r.execute(o,a,i)&&(r.trigger.apply(r,["route:"+i].concat(a)),r.trigger("route",i,a),t.history.trigger("route",r,i,a))})),this},execute:function(e,t,n){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var e,t=n.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(N,"\\$&").replace(P,"(?:$1)?").replace(L,(function(e,t){return t?e:"([^/?]+)"})).replace(O,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var i=e.exec(t).slice(1);return n.map(i,(function(e,t){return t===i.length-1?e||null:e?decodeURIComponent(e):null}))}});var R=t.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},D=/^[#\/]|\s+$/g,z=/^\/+|\/+$/g,H=/#.*$/;R.started=!1,n.extend(R.prototype,s,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(D,"")},start:function(e){if(R.started)throw new Error("Backbone.history has already been started");if(R.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(z,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,o=i.insertBefore(this.iframe,i.firstChild).contentWindow;o.document.open(),o.document.close(),o.location.hash="#"+this.fragment}var r=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),R.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),n.some(this.handlers,(function(t){if(t.route.test(e))return t.callback(e),!0})))},navigate:function(e,t){if(!R.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");var n=this.root;""!==e&&"?"!==e.charAt(0)||(n=n.slice(0,-1)||"/");var i=n+e;e=e.replace(H,"");var o=this.decodeFragment(e);if(this.fragment!==o){if(this.fragment=o,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;t.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),t.history=new R,m.extend=g.extend=j.extend=V.extend=R.extend=function(e,t){var i,o=this;return i=e&&n.has(e,"constructor")?e.constructor:function(){return o.apply(this,arguments)},n.extend(i,o,t),i.prototype=n.create(o.prototype,e),i.prototype.constructor=i,i.__super__=o.prototype,i};var W=function(){throw new Error('A "url" property or function must be specified')},U=function(e,t){var n=t.error;t.error=function(i){n&&n.call(t.context,e,i,t),e.trigger("error",e,i,t)}};return t}))}(),console.log("expa 1.0.41");try{webix.ready((function(){webix.protoUI({name:"edittree"},webix.EditAbility,webix.ui.tree),webix.ui({view:"scrollview",type:"clean",id:"layout",css:"layoutContainer",scroll:"y",body:{cells:[{},{hidden:!0,id:"userAuth",cols:[{view:"align",align:"middle,center",body:(Ke(),{view:"form",id:"formAuth",width:250,borderless:!0,elements:[{view:"text",label:"Логин",name:"username",invalidMessage:"Поле должно быть заполнено",on:{onItemClick:function(){$$("formAuth").clearValidation()}}},{view:"text",label:"Пароль",name:"password",invalidMessage:"Поле должно быть заполнено",type:"password",on:{onItemClick:function(){$$("formAuth").clearValidation()}}},{view:"button",value:"Войти",css:"webix_primary",hotkey:"enter",align:"center",click:function(){let t=$$("formAuth").getValues(),n={};try{$$("formAuth").validate(),n.un=t.username,n.np=t.password,webix.ajax().post("/init/default/login",n,{success:function(t,n,i){webix.ajax("/init/default/api/whoami",{success:function(t,n,i){try{let t={};t.id=n.json().content.id,t.name=n.json().content.first_name,t.username=n.json().content.username,e("user",JSON.stringify(t)),$$("formAuth")&&$$("formAuth").clear(),Backbone.history.navigate("content",{trigger:!0}),window.location.reload()}catch(e){console.log(e),a("007-005",e)}},error:function(e,t,n){$$("formAuth")&&$$("formAuth").isDirty()&&($$("formAuth").markInvalid("username",""),$$("formAuth").markInvalid("password","Неверный логин или пароль")),s("007-006",n.status,n.statusText,n.responseURL)}}).then((function(e){}))},error:function(e,t,n){webix.message({type:"error",expire:3e3,text:"Не удалось выполнить выход"}),s("007-006",n.status,n.statusText,n.responseURL)}}).catch((e=>{console.log(e),s("007-006",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),a("007-000",e)}}}],rules:{username:webix.rules.isNotEmpty,password:webix.rules.isNotEmpty},elementsConfig:{labelPosition:"top"}})}]},{hidden:!0,id:"mainLayout",rows:[{id:"mainContent",css:"webix_mainContent",cols:[{rows:[Ge(),{id:"adaptive",rows:[]},{cols:[nt(),{id:"sideMenuResizer",view:"resizer",css:"webix_resizer-hide"},{id:"container",cols:[{view:"align",align:"middle,center",id:"webix__none-content",body:{borderless:!0,template:"Выберите элемент дерева",height:50,width:210,css:{color:"#858585","font-size":"14px!important"}}}]}]}]}]},{view:"resizer",id:"log-resizer"},r]}]}}),it(),window.location.host.includes("localhost:3000")?Backbone.history.start({pushState:!0,root:"/index.html/"}):Backbone.history.start({pushState:!0,root:"/init/default/spaw/"}),function(){const e=$$("tree");window.innerWidth<850&&e&&e.hide(),function(){if(window.innerWidth<1200){const t=$$("editTableBarContainer");e.attachEvent("onAfterLoad",(function(){d(t)})),d(t)}}()}(),webix.editors.customDate=webix.extend({render:function(){return webix.html.create("div",{class:"webix_dt_editor"},"<input class='webix_custom-date-editor' id='custom-date-editor' type='text'>")}},webix.editors.text),function(){let e=null;webix.event(document.body,"mousedown",(t=>{const n=$$(t);n&&n.getInputNode&&(e=n)})),webix.event(document,"click",(t=>{const n=$$(t);e&&n&&n.config.id!==e.config.id&&(t.cancelBubble=!0,webix.html.preventEvent(t)),e=null}),{capture:!0})}(),function(){const t=webix.ajax("/init/default/api/userprefs/");t.then((function(t){const n=webix.storage.local.get("user");t=t.json().content,n&&(function(){try{t.forEach((function(t,i){console.log(t),t.owner!=n.id||t.name.includes("fav-link_")||e(t.name,t.prefs)}))}catch(e){l(e,"storageSettings","setDataToStorage")}}(),function(){if("/index.html/content"==window.location.pathname||"/init/default/spaw/content"==window.location.pathname){const e=webix.storage.local.get("userprefsWorkspaceForm"),t=webix.storage.local.get("userLocationHref"),n=new URL(t.href);console.log(t),e&&e.LoginActionOpt&&n.origin==window.location.origin&&!n.pathname.includes("logout")&&function(e,t){try{2==t.LoginActionOpt&&e&&e.href&&e.href!==window.location.href&&window.location.replace(e.href)}catch(e){l(e,"storageSettings","setLoginActionPref")}}(t,e)}}())})),t.fail((function(e){c(e,"storageSettings","setUserPrefs")})),function(){const e=webix.storage.local.get("userprefsWorkspaceForm"),t=$$("logLayout"),n=$$("webix_log-btn");try{e&&void 0!==e.logBlockOpt&&("2"==e.logBlockOpt?(t.config.height=5,n.config.icon="icon-eye"):"1"==e.logBlockOpt&&(t.config.height=90,n.config.icon="icon-eye-slash"),t.resize(),n.refresh())}catch(e){l(e,"storageSettings","userprefsWorkspace")}}()}(),window.addEventListener("popstate",(function(e){window.location.replace(window.location.href),window.location.reload()})),function(){let e;function t(){const e=webix.ajax().get("/init/default/api/userprefs/");e.then((function(e){"i"!==e.err_type&&l(e.json().err,"autoLogout","putUserPrefs"),e=e.json().content;let t=!1,n={};n.href=window.location.href;let o={name:"userLocationHref",prefs:n};"/index.html/content"!==window.location.pathname&&(function(){try{e.forEach((function(e,n){if("userLocationHref"==e.name){t=!0;const n=webix.ajax().put("/init/default/api/userprefs/"+e.id,o);n.then((function(e){"i"!==(e=e.json()).err_type&&i("error",e.err)})),n.fail((function(e){c(e,"autoLogout","putUserPrefs")}))}}))}catch(e){l(e,"autoLogout","putUserPrefs")}}(),t||(function(){let e=webix.storage.local.get("user").id;try{if(e)o.owner=e;else{const e=webix.ajax("/init/default/api/whoami");e.then((function(e){o.owner=e.json().content.id;let t={};t.id=e.json().content.id,t.name=e.json().content.first_name,t.username=e.json().content.username})),e.fail((function(e){c(e,"autoLogout","getWhoamiData")}))}}catch(e){l(e,"autoLogout","getWhoamiData")}}(),function(){const e=webix.ajax().post("/init/default/api/userprefs/",o);e.then((function(e){"i"!==(e=e.json()).err_type&&l(e.err,"autoLogout","putUserPrefs")})),e.fail((function(e){c(e,"autoLogout","postUserPrefs")}))}()))})),e.then((function(e){Backbone.history.navigate("logout",{trigger:!0})})),e.fail((function(e){c(e,"autoLogout","logout")}))}function n(){try{"/index.html"!==window.location.pathname&&"/"!==window.location.pathname&&"/init/default/spaw"!==window.location.pathname&&(clearTimeout(e),e=setTimeout(t,6e5))}catch(e){l(e,"autoLogout","resetTimer")}}window.onload=n,window.onmousemove=n,window.onmousedown=n,window.ontouchstart=n,window.onclick=n,window.onkeypress=n,window.addEventListener("scroll",n,!0)}(),webix.message.position="bottom",webix.i18n.setLocale("ru-RU"),webix.i18n.parseFormat="%d.%m.%Y %H:%i:%s",webix.i18n.setLocale(),webix.Date.startOnMonday=!0}))}catch(e){console.log(e),alert("Ошибка при выполнении "+e),a("007-005",e)}})();