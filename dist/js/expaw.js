(()=>{"use strict";const t="getServerData";class e{constructor(t){this.id=t.id,this.isFullPath=t.isFullPath,this.errorActions=t.errorActions}returnPath(){const t=`/init/default/api/${this.id}`;return this.isFullPath?this.id:t}validate(t){return!!t&&!function(t,e){const n=t.err_type,i=t.err;if(n&&i&&"i"!==n)return e&&e(),ka(i,"getServerData","checkErrors"),!0}(t=t.json(),this.errorActions)&&t}get(){const e=this;if(e.id){const n=e.returnPath();return webix.ajax().get(n).then((function(t){return e.validate(t)})).fail((function(n){e.errorActions&&e.errorActions(),Ca(n,t,"get server data")}))}}put(e){const n=this;if(n.id){const i=n.returnPath();return webix.ajax().put(i,e).then((function(t){return n.validate(t)})).fail((function(e){n.errorActions&&n.errorActions(),Ca(e,t,"put server data")}))}}post(e){const n=this;if(n.id){const i=n.returnPath();return webix.ajax().post(i,e).then((function(t){return n.validate(t)})).fail((function(e){n.errorActions&&n.errorActions(),Ca(e,t,"post server data")}))}}del(e){const n=this;if(n.id){const i=n.returnPath();return webix.ajax().del(i,e).then((function(t){return n.validate(t)})).fail((function(e){n.errorActions&&n.errorActions(),Ca(e,t,"del server data")}))}}}async function n(){Backbone.history.navigate("logout?auto=true",{trigger:!0})}function i(t){let e=!1;if(401===t.status&&"/index.html"!==window.location.pathname&&"/init/default/spaw/"!==window.location.pathname){e=!0;let t=new URLSearchParams(document.location.search).get("auto");const n={href:window.location.href};t||fa("outsideHref",JSON.stringify(n))}return e}const o={};function r(t){if("/index.html"!==window.location.pathname&&"/init/default/spaw"!==window.location.pathname||"whoami"==t)return webix.ajax().get(`/init/default/api/${t}.json`).then((function(e){o[t]=e.json();try{"fields"==t&&o[t]&&(o.tableNames=function(t){let e=[];return t&&t.length&&Object.values(t).forEach((function(n,i){e.push({id:Object.keys(t)[i],name:n.plural?n.plural:n.singular})})),e}(o[t].content))}catch(t){ka(t,"globalStorage","getData")}return o[t]})).catch((t=>{console.log(t),console.log("globalStorage function getData"),i(t)}))}class s{static async content(t){const e=this;if(!e[t]){const n=`/init/default/api/${t}.json`;return webix.ajax().get(n).then((function(n){return e[t]=n.json(),!0})).fail((function(t){if(!i(t))return $$("tree").callEvent("onLoadError",[t]),!1}))}}}class a extends s{constructor(){super()}static get content(){if(this.mmenu)return this.mmenu.mmenu}}class c extends s{constructor(){super()}static attribute(t,e){if(this.fields&&this.fields.content[t])return this.fields.content[t][e]}static item(t){if(this.fields&&this.fields.content)return this.fields.content[t]}static get keys(){if(this.fields&&"object"==typeof this.fields)return Object.keys(this.fields.content)}static get values(){if(this.fields&&"object"==typeof this.fields)return Object.values(this.fields.content)}static get names(){const t=this.values,e=this.keys;if(this.fields){const n=[];return t&&t.length&&t.forEach((function(t,i){n.push({id:e[i],name:t.plural?t.plural:t.singular})})),n}}}class l{constructor(t){this.buttonView={view:"button",height:42,on:{}},this.options=t.config,this.values=Object.values(this.options),this.keys=Object.keys(this.options),this.adaptValue=t.adaptValue,this.title=t.titleAttribute,this.onFunc=t.onFunc,this.css=t.css}modifyTitle(t){this.title=this.title+" ("+this.values[t]+")"}setAdaptiveValue(t,e,n){const i=t.$width;i<120&&t.config.value!==e?(t.config.value=e,t.refresh()):i>120&&t.config.value!==n&&(t.config.value=n,t.refresh())}addOnFunctions(t){const e=this;if(this.onFunc){const e=Object.keys(this.onFunc),n=Object.values(this.onFunc);e&&e.length&&e.forEach((function(e,i){t.on[e]=n[i]}))}t.on.onAfterRender=function(){this.getInputNode().setAttribute("title",e.title),e.adaptValue&&e.setAdaptiveValue(this,e.adaptValue,e.options.value)}}addCss(t){const e=this.buttonView,n=this.css||"";"primary"==t?e.css="webix_primary ":"delete"==t?e.css="webix_danger ":(e.css=t||"",e.css=e.css+" "+n||"")}addConfig(){const t=this.buttonView,e=this.values,n=this;return this.keys&&this.keys.length&&(this.keys.forEach((function(i,o){t[i]=e[o],"hotkey"===i&&n.modifyTitle(o)})),this.addOnFunctions(t)),t}maxView(t){return this.addCss(t),this.addConfig()}minView(t){this.addCss(t);const e=this.buttonView;return e.width=50,e.type="icon",this.addConfig()}transparentView(){this.addCss("webix-transparent-btn");const t=this.buttonView;return t.width=50,t.type="icon",this.addConfig()}static transparentDefaultState(){const t="webix-transparent-btn--primary";try{const e=document.querySelector(".webix_btn-filter");e&&e.classList.contains(t)&&(e.classList.add("webix-transparent-btn"),e.classList.remove(t))}catch(t){ka(t,"buttons","transparentViewDefaultState")}}}class u{constructor(t){this.elements=t.elements,this.headline={template:"<div class='no-wrap-headline'>"+t.headline+"</div>",css:"webix_popup-headline",borderless:!0,height:40},this.closeBtn={view:"button",id:"buttonClosePopup",css:"popup_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){if(t.closeClick){const e=t.closeConfig,n=e?e.currElem:null;t.closeClick(n)}else{const e=$$(t.config.id);e&&e.destructor()}}},this.popupView={view:"popup",css:"webix_popup-config",modal:!0,escHide:!0,position:"center",body:{scroll:"y",rows:[{css:"webix_popup-headline-wrapper",cols:[this.headline,this.closeBtn,{width:12}]},this.elements]}},this.options=t.config,this.id=t.config.id,this.values=Object.values(this.options),this.keys=Object.keys(this.options)}addConfig(){const t=this.popupView,e=this.values;return this.keys&&this.keys.length&&this.keys.forEach((function(n,i){t[n]=e[i]})),t}createView(){const t=this.popupView,e=this.values;return this.keys&&this.keys.length&&this.keys.forEach((function(n,i){t[n]=e[i]})),webix.ui(this.addConfig())}showPopup(){$$(this.id).show()}}const f="viewHeadline";function d(t,e){return"<div style='font-weight:600'>"+t+": </div>"+e}function h(t,e,n){return{id:t,css:"popup_subtitle",borderless:!0,height:20,template:function(){const i=$$(t).getValues();return 0!==Object.keys(i).length?d(e,i):d(e,n)}}}function p(t){return $$(t).getValues()}function m(t){Ia("success","Ссылка «"+t+"»  сохранёна в избранное")}function b(t){return{name:p("favNameLink"),link:p("favLink"),id:t}}const g=new l({config:{value:"Сохранить ссылку",click:function(){!async function(){const t=Ea();if(t){const n=`fields/${t}`,i=`userprefs.name+=+%27${n}%27`,o=await Ba();if(o&&o.id){const r=`userprefs.owner+=+${o.id}`;new e({id:`smarts?query=${i}+and+${r}&limit=80&offset=0`}).get().then((function(i){if(i&&i.content){const r=i.content;if(r.length){const n=r[0];if(n){const i=JSON.parse(n.prefs);i.favorite?(Ia("success","Ссылка уже в избранном"),Va.destructItem($$("popupFavsLinkSave"))):(i.favorite=b(t),n.prefs=i,function(t){const n=p("favNameLink");new e({id:`userprefs/${t.id}`}).put(t).then((function(t){t&&(t.content?(Va.destructItem($$("popupFavsLinkSave")),m(n)):(Va.destructItem($$("popupFavsLinkSave")),ka("Не удалось сохранить ссылку",f,"putContent")))})),Va.destructItem($$("popupVisibleCols"))}(n))}}else{p("favNameLink");const i={name:n,owner:o.id,prefs:{}};i.prefs.favorite=b(t),async function(t){const n=p("favNameLink");new e({id:"userprefs"}).post(t).then((function(t){t&&m(n),Va.destructItem($$("popupFavsLinkSave"))}))}(i)}}}))}else ka("owner does not exists",f,"btnSaveLinkClick")}}()}},titleAttribute:"Сохранить ссылку в избранное"}).maxView("primary");function w(){const t=new u({headline:"Сохранить ссылку",config:{id:"popupFavsLinkSave",width:500},elements:{rows:[h("favNameLink","Имя","не указано"),{height:5},h("favLink","Ссылка","не указана"),{height:10},{padding:{left:8,right:8},rows:[g]},{}]}});t.createView(),t.showPopup(),async function(){await s.content("fields");const t=c.names;t&&function(t,e){try{const n=$$("favNameLink");e&&e.length&&e.forEach((function(e){e.id==t&&n&&n.setValues(e.name)}))}catch(t){ka(t,f,"findName")}}(Ea(),t)}(),function(){try{let t=window.location.href,e=t.lastIndexOf("?");-1!==e&&(t=t.slice(0,e));const n=$$("favLink");n&&n.setValues(t)}catch(t){ka(t,f,"getLink")}}()}function $(t){return la.tabs.getInfo()[t]}function v(t,e,n=!1){la.tabs.setInfo(t,n),y("onBeforeTabClick",e),y("onAfterTabClick",e)}function y(t,e){$$("globalTabbar").callEvent(t,[e])}function x(){return $$("globalTabbar").getValue()}function I(){const t=x(),e=function(t){if(t&&t.length){let e=1;(function(t){const e=t[t.length-1],n=la.tabs.getInfo();if(n&&e&&(n.tree?n.tree.field:null)==e.field)return!0})(t)&&(e=2);const n=t.length-e,i=t.slice(0,n);if(n<=1&&la.tabs.setHistoryBtnState(!1,!1),la.tabs.setHistoryBtnState(!0),t[n])return{tree:t[n],history:i}}}($("history"));e&&(function(t){const e=$("tree");t.nextPage=e}(e),v(e,t))}function C(t="Имя не указано"){return"<div class='no-wrap-headline'>"+t+"</div>"}function S(t,e){let n;try{n=e||function(){const n=$$(t).getValues();return 0!==Object.keys(n).length?C(e=n):C()}}catch(t){ka(t,f,"setHeadlineBlock")}return function(t,e){return{view:"template",id:t,borderless:!0,css:"webix_block-headline",height:34,template:e,on:{}}}(t,n)}function T(t,e=null){return{css:"webix_block-headline",cols:[S(t,e),{},{css:"btn-history",cols:[new l({config:{id:`historyBtnLeft_${webix.uid()}`,hotkey:"Ctrl+Shift+P",icon:"icon-arrow-left",disabled:!0,css:"historyBtnLeft",click:function(){I()}},titleAttribute:"Вернуться назад"}).transparentView(),new l({config:{id:`historyBtnRight_${webix.uid()}`,hotkey:"Ctrl+Shift+B",icon:"icon-arrow-right",css:"historyBtnRight",disabled:!0,click:function(){!function(){const t=$("nextPage");if(function(t){if(t)return t}(t)){const e=x(),n=function(t){const e=$("history"),n=$("tree");return e.push(n),{tree:t,history:e}}(t);v(n,e,!0),la.tabs.setHistoryBtnState(!0,!1),la.tabs.setHistoryBtnState()}}()}},titleAttribute:"Перейти вперёд "}).transparentView()]},new l({config:{id:webix.uid(),hotkey:"Ctrl+Shift+L",icon:"icon-star",click:function(){w()}},titleAttribute:"Добавить ссылку в избранное"}).transparentView()]}}function k(t,e="Загрузка...",n=!1){const i={view:"align",hidden:n,align:"middle,center",body:{borderless:!0,template:e,width:100,height:50},css:"global_loadTemplate"};return t&&(i.id=t),i}const E="dashboard/dynamicElements";let V,F,A,B;function O(t){try{const e=$$("logLayout");e.config.height=t,e.resize()}catch(t){ka(t,E,"setScrollHeight")}}function P(t){A?(Va.removeItem($$("dashboardInfoContainerInner")),z(F,t)):(Va.removeItem($$("dash-headline-container")),$$("dashboardInfoContainer").addView({id:"dash-headline-container",cols:[T("dash-template")]}),async function(t){const e=t;try{await s.content("fields");const t=c.names;t&&t.forEach((function(t){if(t.id==e){const e=$$("dash-template"),n=t.name.toString();e.setValues(n)}}))}catch(t){ka(t,E,"setDashName")}}(F),z(F,t),function(t){(function(t){const e={id:"dashboard-tool-main",padding:20,hidden:!0,minWidth:250,rows:[{id:"dashboardToolHeadContainer",cols:[{template:"Фильтр",height:30,css:"webix_dash-filter-headline",borderless:!0},new l({config:{id:"dash-backDashBtn",hotkey:"Esc",hidden:!0,icon:"icon-arrow-right",click:function(){Va.hideItem($$("dashboardTool")),Va.showItem($$("dashboardInfoContainer"))}},titleAttribute:"Вернуться к дашбордам"}).minView()]},{id:"dashboardFilterElems",rows:t}]};try{$$("dashboardTool").addView(e,0)}catch(t){ka(t,E,"createMainView")}})(t),function(t){const e=$$("dash-template").getParentView(),n=$$(e.config.id);$$("dashFilterBtn")||n.addView({id:"dashboard-tool-btn",cols:[t]},2)}(new l({config:{id:"dashFilterBtn",hotkey:"Ctrl+Shift+F",icon:"icon-filter",click:function(){ct()}},titleAttribute:"Показать/скрыть фильтры",onFunc:{clickEvent:function(){ct()}}}).transparentView())}(V),function(t){const e=window.location.search;if("filter"==new URLSearchParams(e).get("view")){$$("dashFilterBtn").callEvent("clickEvent",[""]);const t=webix.storage.local.get("dashFilterState");if(t){const e=t.content;e&&(function(t){const e=la.tabs.getInfo();e&&(e.temp||(e.temp={}),e.temp.filter||(e.temp.filter={}),e.temp.filter.dashboards=!0,e.temp.filter.values=t,la.tabs.setInfo(e))}(e),e.forEach((function(t){const e=$$(t.id);if(e){let n=t.value;e.config.id.includes("-time")&&(n=webix.Date.dateToStr("%H:%i:%s")(n)),e.setValue(n)}})))}}}())}function L(){const t="dashLoadErr";Va.removeItem($$("dashLoad")),$$(t)||$$("dashboardInfoContainer").addView(k(t,"Ошибка"))}function j(t,n,i,o=!1){V=n,F=i,A=o,B=t,function(){const t="dashLoad";if(!$$(t)){Va.removeItem($$("dashLoadErr"));const e=k(t);$$("dashboardInfoContainer").addView(e)}}(),new e({id:B,isFullPath:!0,errorActions:L}).get().then((function(t){if(t){const n=t.charts;n&&(Va.removeItem($$("dashLoad")),Va.removeItem($$("dashBodyScroll")),A||(Va.removeItem($$("dashboard-tool-main")),Va.removeItem($$("dashboard-tool-adaptive"))),Va.removeItem($$("dashboardInfoContainerInner")),null==(e=n)?Ia("error","Ошибка при загрузке данных"):P(e),(B.includes("?")||B.includes("sdt")&&B.includes("edt"))&&Ia("success","Данные обновлены"),Va.removeItem($$("dash-load-charts")),"icon-eye"==$$("webix_log-btn").config.icon?(O(90),O(5)):(O(5),O(90)))}var e}))}function N(t){return{template:t,borderless:!0,height:35,css:"dash-HeadlineBlock"}}function D(t){const e=[];try{t.forEach((function(t){t.cols||t.rows?(function(t,e){let n;(t.rows||t.cols||[t.body]).forEach((function(t){const i=t.rows||t.cols||[t.body];n=i[0]?function(t,e){let n;const i=[];return function t(n){n&&n.forEach((function(n){if(n){const o=n.rows||n.cols||[n.body];n.rows||n.cols?t(o):(n.view&&"scrollview"!==n.view&&"flexlayout"!==n.view&&(n=dt(n,e)),i.push(n))}}))}(t),i.length&&(n=i),n}(i,e):dt(t,e)}))}(t,t.action),t.view="flexlayout",t.margin=10,t.padding=0):t=dt(t);const n=t.title;delete t.title;const i=t.height?t.height:300,o=t.minWidth?t.minWidth:function(){const t=$$("dashboardInfoContainer");return t?t.$width/2:500}();e.push({css:"webix_dash-chart",rows:[N(n),{margin:4,minHeight:i,minWidth:o,padding:4,borderless:!0,rows:[{view:"scrollview",body:t}]}]})}))}catch(t){ka(t,E,"createChart")}return e}function H(t){return{id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",cols:D(t)}}function R(t){return{view:"scrollview",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[H(t)]}}}function z(t,e){const n=$$("dashboardInfoContainer"),i={id:"dashboardInfoContainerInner",rows:[R(e)]};try{n.addView(i)}catch(t){ka(t,E,"createFilterLayout")}!function(t){const e=$$("dashboardContainer");e&&(e.config.idDash=t)}(t),function(){const t=window.location.search,e=new URLSearchParams(t),n=e.get("src"),i=e.get("filter");return!(!n||!i)||(webix.storage.local.remove("dashTableContext"),!1)}()&&function(){const t=webix.storage.local.get("dashTableContext");t&&wt(t)}()}function W(t){const e=t.getParentView().getChildViews(),n=[];if(e.forEach((function(t){"datepicker"==t.config.view&&n.push({id:t.config.id,value:t.config.value})})),n.length){const t={content:n};webix.storage.local.put("dashFilterState",t),function(t){const e=la.tabs.getInfo();e&&(e.temp||(e.temp={}),e.temp.filter={dashboards:!0,values:t})}(n)}}const M=[];let q,U,J,K,Y,G;function Q(t){t.getNode().firstElementChild.style.width=t.$width+"px",t.getInputNode().style.width=t.$width-5+"px"}function X(t){const e=t.getNode().getElementsByTagName("input")[0],n="dash-filter-invalid";e&&e.classList.contains(n)&&webix.html.removeCss(e,n)}function Z(t,e){return{view:"datepicker",id:`dashDatepicker_${e}`,format:"%d.%m.%y",sentAttr:e,editable:!0,value:new Date,placeholder:t.label,keyPressTimeout:900,height:42,on:{onItemClick:function(){X(this)},onAfterRender:function(){this.getInputNode().setAttribute("title",t.comment),Q(this)},onChange:function(t,e,n){n&&W(this)},onTimedKeyPress:function(){W(this)}}}}function tt(t){return{view:"datepicker",id:`dashDatepicker_${t}-time`,sentAttr:t,format:"%H:%i:%s",placeholder:"Время",height:42,editable:!0,keyPressTimeout:900,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",css:"dash-timeboard",hotkey:"enter",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onItemClick:function(){X(this)},onTimedKeyPress:function(){!function(t){t.getText()||this.setValue("00:00:00")}(this),W(this)},onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды"),Q(this)}}}}function et(t,e){const n=new l({config:{id:"dashBtn"+e,hotkey:"Ctrl+Shift+Space",value:t.label,click:function(){!function(t,e,n,i){J=e,n=n,K=i,ot.length=0,rt.length=0,Y="",G="",function(){try{J.forEach((function(t){t.id.includes("container")&&function(t){$$(t.id).getChildViews().forEach((function(t){const e=t.config.id;st(e,"sdt"),st(e,"edt")}))}(t)}))}catch(t){ka(t,E,"setInputs")}}(),at("sdt",Y),at("edt",G),function(){const t=function(){const t=$$("dashboardFilterElems"),e=[];if(t){const n=t.getChildViews();n&&n.length&&n.forEach((function(t){const n=t.config.view;if(!n||"button"!==n){const n=t.getChildViews();n&&n.length&&function(t,e){t.forEach((function(t){t.config.view&&e.push(t)}))}(n,e)}}))}return e}();let e,n=0;if(t&&t.length){const i=function(t){const e=[];let n=0;const i={time:[],date:[]};return t.forEach((function(t){let o=t.getValue();const r=t.config.view,s=t.config.sentAttr,a=t.config.type;var c;o?"datepicker"==r?a&&"time"==a?(c=o,o=webix.Date.dateToStr("%H:%i:%s")(c),i.time.push({id:s,value:o})):(o=function(t){return webix.Date.dateToStr("%d.%m.%y")(t)}(o),i.date.push({id:s,value:o})):e.push(s+"="+o):n++})),i.time.length&&i.date.length&&function(t,e){t.date.forEach((function(n){const i=n.id,o=n.value;if(i){const n=function(t,e){return t.time.find((t=>t.id===e))}(t,i);e.push(i+"="+o+"+"+n.value)}}))}(i,e),{values:e,emptyValues:n}}(t);e=i.values,n=i.emptyValues}if(n)Ia("error","Не все поля заполнены");else{const n=K.url+"?"+e.join("&");!function(){const t=$$("dashboard-charts"),e=t.getParentView();Va.removeItem(t),e.addView({id:"dash-load-charts",template:"Загрузка..."})}(),j(n,t,void 0,!0)}}()}(0,M,U,q)}},titleAttribute:t.comment,onFunc:{onViewResize:function(){Q(this)}}}).maxView("primary");return n}function nt(t){return{template:t,height:30,borderless:!0,css:"webix_template-datepicker"}}function it(t){return new webix.DataCollection({url:{$proxy:!0,load:function(){return new e({id:t.apiname}).get().then((function(t){if(t){const e=t.content;return e&&e.length?function(t){const e=[];return t&&t.length&&t.forEach((function(t,n){let i=t;"object"==typeof t&&(i=t.name);const o=function(t,e){return{id:t+1,value:e}}(n,i);e.push(o)})),e}(e):[{id:1,value:""}]}}))}}})}const ot=[],rt=[];function st(t,e){t.includes(e)&&(t.includes("time")?function(t,e){const n=webix.Date.dateToStr("%H:%i:%s"),i=$$(t).getValue(),o=" "+n(i);try{i&&("sdt"==e?Y=Y.concat(o):"edt"==e&&(G=G.concat(o)))}catch(t){ka(t,E,"createTimeFormat")}}(t,e):function(t,e){try{if(null!==$$(t).getValue()){const n=$$(t).getValue(),i=webix.Date.dateToStr("%d.%m.%y");"sdt"==e?Y=i(n):"edt"==e&&(G=i(n))}}catch(t){ka(t,E,"createDateFormat")}}(t,e))}function at(t,e){ot.push(t+"="+e),rt.push(e)}function ct(){const t=$$("dashboard-tool-main"),e=$$("dashboardContainer"),n=$$("tree"),i=$$("dash-backDashBtn"),o=$$("dashboardTool"),r=$$("dashboardInfoContainer");Va.removeItem($$("dashContextLayout")),Va.hideItem($$("dashboardContext")),t.isVisible()?(Va.hideItem(o),la.linkParam(!1,"view"),la.tabs.clearTemp("dashFilterState","filter")):(Va.showItem(o),Va.showItem(t),la.linkParam(!0,{view:"filter"}),la.tabs.clearTemp("dashTableContext","context")),e.$width<850?(Va.hideItem(n),e.$width<850&&(Va.hideItem(n),Va.hideItem(r),Va.showItem(o),Va.showItem(i),o.config.width=window.innerWidth-45,o.resize())):Va.hideItem(i)}const lt={navigate:"true - переход на другую страницу, false - обновление в данном дашборде",context:"true - открыть окно с записью таблицы, false - обновить таблицу",field:"название из fields (id таблицы должен быть идентичным, если navigate = false)",params:{filter:"auth_group.id > 3"}};function ut(t,e,n){t.forEach((function(t){t.tagName&&(t.getAttribute("webix_area_id")==n||e)&&(t.style.cursor="pointer")}))}async function ft(t){await s.content("fields");const e=c.keys;let n=t;t&&t.field&&(n=t.field);let i=!1;e.forEach((function(e){e==n&&(i=!0,t.navigate?function(t,e){const n=mt(t);if(n){let i;"dbtable"==n?(ht.length=0,pt.length=0,t&&(function(t){t.forEach((function(t,e){!function(t,e){let n=null,i=t[1];const o=i.lastIndexOf(".")+1;i=i.slice(o);let r=t[4];const s=function(t){let e;return t&&(e=t.replace(/['"]+/g,"")),e}(t[3]);pt.push(i),pt.filter((t=>t==i)).length>1?(n=i,i=i+"_filter-child-"+webix.uid()):i+="_filter",r="and"==r?"1":"2",ht.push({id:i,value:s,operation:t[2],logic:r,parent:n,index:e})}(t.split(" "),e)}))}(function(t){const e=t.split(" "),n=[];let i="",o=0;return e.forEach((function(t,r){const s=e.length;s-1===r&&(i+=" "+t,o++),(o>=4||s-1===r)&&(n.push(i),i="",o=0),o<4&&(i+=" "+t,o++)})),n}(e)),i={tree:{field:t,type:"dbtable"},temp:{filter:{id:t,values:{values:ht}},queryFilter:e}})):"tform"==n?i={tree:{field:t,type:"tform"}}:"dashboard"==n&&(i={tree:{field:t,type:"dashboard"}}),i&&la.tabs.openInNewTab(i)}}(t.field,t.params.filter):(wt(t),webix.storage.local.put("dashTableContext",t)))})),i||(ka("Key «"+n+"» doesn't exist","dashboard / create space / click / itemClickLogic","findField"),la.linkParam(!1,"src"),la.linkParam(!1,"filter"))}function dt(t,e){return e&&(t.action=e),t.borderless=!0,t.minWidth=250,t.on={onAfterRender:function(){!function(t,e){const n=t.getNode(),i=n.getElementsByTagName("map").item(0);if(i){const t=i.childNodes;e.action?ut(t,!0):e.data&&e.data.forEach((function(e,n){e.action&&ut(t,!1,e.id)}))}else n&&(n.style.cursor="pointer")}(this,t)},onItemClick:function(e){console.log("пример: ",lt),t.action?ft(t.action):function(t,e){let n;t.data.forEach((function(t){t.id==e&&(n=t)}));const i=n.action;i&&ft(i)}(t,e)}},t}const ht=[],pt=[];function mt(t){const e=c.item(t);if(e)return e.type;s("fields").then((function(e){mt(t)}))}function bt(){la.linkParam(!1,"src"),la.linkParam(!1,"filter")}function gt(t,n,i){const o=n.join("&");new e({id:"smarts?"+o,isFullPath:!1,errorActions:bt}).get().then((function(e){if(e){const n=e.content;if(n){const e=n[0];i?e&&kt(e,t):(function(t,e){const n=la.tabs.getInfo();n&&(n.temp||(n.temp={}),n.temp.filter&&delete n.temp.filter,n.temp.context={},n.temp.context.id=t,n.temp.context.filter=e,la.tabs.setInfo(n))}(t,o),function(t,e){const n=$$(t);n?(n.clearAll(),n.parse(e),function(t){la.linkParam(!0,{src:t,filter:!0})}(t),function(t){t.getNode().scrollIntoView()}(n)):(ka("Таблица с id «"+t+"» не найдена на странице",E,"setDataToTable"),bt())}(t,n))}}}))}function wt(t){const e=t.field;var n,i;gt(e,(n=t.params.filter||e+".id > 0",i=t.params.sorts||e+".id",["query="+n,"sorts="+i,"limit=80","offset=0"]),t.context)}let $t,vt,yt;const xt={template:"<div class='no-wrap-headline'>Подробности</div>",css:"webix_popup-headline",borderless:!0,height:40},It=new l({config:{id:"dashContexCloseBtn",hotkey:"Esc",icon:"icon-arrow-right",click:function(){Va.removeItem($$("dashContextLayout")),Va.hideItem($t),Va.showItem($$("dashboardInfoContainer")),la.linkParam(!1,"id"),la.linkParam(!1,"src")}},css:"webix-transparent-btn",titleAttribute:"Скрыть конекстное окно"}).minView();async function Ct(){const t=[];if(vt){const e=Object.values(vt),n=Object.keys(vt),i=await async function(){await s.content("fields");const t=c.item(yt),e=Object.values(t.fields),n=[];return e.forEach((function(t){n.push(t.label)})),n}();e.forEach((function(e,o){t.push({id:n[o],label:i[o],value:e})}))}return t}async function St(){return{scroll:"y",rows:[{view:"property",id:"dashContextProperty",minHeight:100,elements:await Ct()},{height:20}]}}const Tt=new l({config:{id:"goToTableBtn",hotkey:"Ctrl+Shift+Space",value:"Редактировать",click:function(){!function(){const t=vt.id;if(vt&&vt.id){const e=$$("dashContextProperty").getValues(),n={tree:{field:yt,type:"dbtable"},temp:{edit:{selected:t,values:{status:"put",table:yt,values:e}}}};la.tabs.openInNewTab(n)}}()}},titleAttribute:"Перейти в таблицу для редактирования записи"}).maxView("primary");function kt(t,e){vt=t,yt=e;const n=$$("dashboardTool");Va.hideItem(n),$t=$$("dashboardContext"),Va.showItem($t),window.innerWidth<850&&($t.config.width=window.innerWidth-45,$t.resize(),Va.hideItem($$("dashboardInfoContainer"))),function(){const t={src:yt,id:vt.id};la.linkParam(!0,t)}(),async function(){const t=$$("dashContextLayout");t&&Va.removeItem(t),$t&&$t.addView(await async function(){return{id:"dashContextLayout",padding:15,rows:[{cols:[xt,{},It]},await St(),Tt,{}]}}(),0)}(),function(){const t=la.tabs.getInfo();t&&(t.temp||(t.temp={}),t.temp.filter&&delete t.temp.filter,t.temp.context={},t.temp.context.open=!0,t.temp.context.field=yt,t.temp.context.id=vt.id,la.tabs.setInfo(t))}()}let Et;function _t(){const t=c.item(Et);t&&(Va.removeItem($$("dash-none-content")),j(t.actions.submit.url,function(t,e,n){U=n,M.length=0;const i=Object.keys(t);return Object.values(t).forEach((function(t,n){if("datetime"==t.type)!function(t,e){const n={width:200,rows:[nt(t.label),Z(t,e),tt(e),{height:20}]};M&&M.push(n)}(t,i[n]);else if("string"==t.type)!function(t,e){const n=t.value?t.value:"",i={width:200,rows:[nt(t.label),{view:"text",value:n,sentAttr:e,placeholder:t.label},{height:20}]};M&&M.push(i)}(t,i[n]);else if("apiselect"==t.type)!function(t,e){const n={width:200,rows:[nt(t.label),{view:"combo",placeholder:t.label,sentAttr:e,options:it(t)},{height:20}]};M&&M.push(n)}(t,i[n]);else if("submit"==t.type){const i=t.action;q=e.actions[i],M.push({height:15}),M.push(et(t,n))}})),M}(t.inputs,t,Et),Et),function(t,e){if(t.autorefresh){const t=webix.storage.local.get("userprefsOtherForm").autorefCounterOpt;Et=e;const n=15e3,i=5e4;!function(t){setInterval((function(){la.dashboards.load(Et)}),t)}(void 0!==t&&t>=n?t:i)}}(t,Et))}function Vt(t){const e=window.location.search;return new URLSearchParams(e).get(t)}function Ft(t,n){Et=t;const i=$$("dashBodyScroll");Va.removeItem(i),async function(t){t||await s.content("fields"),c.keys||await s.content("fields"),_t()}(n),function(){!function(){const t=la.tabs.getInfo();if(t&&t.temp){const e=t.temp.context;e&&e.open?la.linkParam(!0,{src:e.field,id:e.id}):e&&la.linkParam(!0,{src:e.id,filter:!0})}}();const t=Vt("id"),n=Vt("src");t&&n&&function(t,n){const i=["query="+n+".id="+t,"sorts="+n+".id","limit=80","offset=0"].join("&");new e({id:"smarts?"+i}).get().then((function(t){if(t){const e=t.content;if(e){const t=e[0];t&&kt(t,n)}}}))}(t,n)}()}function At(t){return{id:"dashboard"+t,css:"webix_dashTool",minWidth:200,width:350,hidden:!0,rows:[{}],on:{onViewShow:function(){window.innerWidth>850&&(this.config.width=350,this.resize())}}}}const Bt=At("Tool"),Ot=At("Context");function Pt(t){return webix.confirm({width:300,ok:"Да",cancel:"Отмена",title:t,text:"Вы уверены, что хотите продолжить?"})}function Lt(t,e,n){return t||e||n?webix.modalbox({title:t,css:"webix_modal-custom-save",buttons:n,width:500,text:e}):webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"})}function jt(t,e){const n={css:"webix_empty-template",template:t,borderless:!0,height:47};return e&&(n.id=e),n}const Nt="table/editForm",Dt=webix.Date.dateToStr("%d.%m.%y %H:%i:%s");function Ht(t){let e;const n=t.default,i=Date.parse(new Date(n)),o=t.type;return"now"===n&&"datetime"==o?e=Dt(new Date):i&&"datetime"==o?e=function(t){const e=new Date(t.default);return Dt(e)}(t):n&&n.includes("make_guid")?e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})):"False"==n?e=2:"True"==n?e=1:"None"!==n&&"null"!==n?e=n:"null"==n&&(e=null),e}function Rt(){const t={},e=[],n=$$("editTableFormProperty");try{!function(){const e=n.getValues();if(e){const i=Object.keys(e);i.length?i.forEach((function(e){const i=n.getItem(e),o=n.getValues();let r=o[e];t[e]={},function(){function n(t,e){let n,i=[];for(n=0;n<t.length;n++)t[n]===e&&i.push(n);return i}function o(t,e,n){if(function(t){if(2===t.length)return!0}(t)&&function(t,e,n){if(t[0]==e&&t[1]==n)return!0}(t,e,n))return!0}if(i.type&&"customDate"==i.type&&r){let i=function(t){if(17===t.length){const e=n(t,"."),i=n(t,":"),r=o(e,2,5),s=o(i,11,14);return!r||!s}return!0}(r.split("")),s=0;const a=r.replace(/\D/g,"").match(/(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})/);for(let t=1;t<7;t++)0==a[t].length&&s++,2!==a[t].length&&(i||(i=!0));6==s?t[e].date=null:((a[1]>31||a[1]<1||a[2]>12||a[2]<1||a[4]>23||a[5]>59||a[6]>59)&&(i=!0),t[e].date=i?"Неверный формат даты. Введите дату в формате xx.xx.xx xx:xx:xx":null)}}(),function(){if(i.customType&&"integer"==i.customType){const n=/\D/.test(r);t[e].isNum=n?"Данное поле должно содержать только числа":null}}(),function(){try{r&&(r.length>i.length&&0!==i.length?t[e].length="Длина строки не должна превышать "+i.length+" симв.":t[e].length=null)}catch(t){ka(t,Nt,"valLength")}}(),function(){try{0==i.notnull&&r&&0==r.length?t[e].notnull="Поле не может быть пустым":t[e].notnull=null}catch(t){ka(t,Nt,"valNotNull")}}(),function(){t[e].unique=null;const n=$$("table").data.pull;if(1==i.unique&&n){const i=Object.values(n);i.length?i.forEach((function(n){let i=n[e];function s(t){return t&&"number"==typeof t?t.toString():t}if(i=s(i),r=s(r),i&&"number"==typeof i&&(i=i.toString()),r&&i){const s=0==r.localeCompare(i),a=n.id,c=o.id;s&&c!==a&&(t[e].unique="Поле должно быть уникальным")}})):ka("array is null",Nt,"valUnique")}}()})):ka("array length is null",Nt,"checkConditions")}}(),function(){if(t){const n=Object.values(t);n&&n.length?n.forEach((function(n,i){Object.values(n).forEach((function(o,r){if(null!==o){let s=Object.keys(t)[i],a=o,c=Object.keys(n)[r];e.push({nameCol:s,typeError:c,textError:a})}}))})):ka("array length is null",Nt,"findErrors")}}()}catch(t){ka(t,Nt,"validateProfForm")}return e&&e.length&&e.forEach((function(t){n.getItem(t.nameCol).css="propery-error",n.refresh()})),e}function zt(){try{const t=$$("table");Rt().forEach((function(e){let n;const i=t.getColumns(!0);i&&i.length?(t.getColumns(!0).forEach((function(t){t.id==e.nameCol&&(n=t.label)})),Ia("error",e.textError+" (Поле: "+n+")")):ka("array is null",Nt,"setLogError")}))}catch(t){ka(t,Nt,"setLogError")}}function Wt(){const t=$$("table-editForm");t&&!t.isDirty()&&t.setDirty(!0)}function Mt(t){t.config.tempData||(t.config.tempData=!0);const e=Ea(),n=t.config.tableStatus,i=t.getValues();if(!function(t,e){if(!t)return!1;{const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(let i of n)if(t[i]!==e[i])return!1}return!0}($$("table").getItem(i.id),i)){const t={table:e,status:n,values:i};!function(t){const e=la.tabs.getInfo(),n=$$("table").getSelectedId();let i;n&&(i=n.id),e&&(e.temp||(e.temp={}),e.temp.edit={values:t,selected:i},la.tabs.setInfo(e))}(t),webix.storage.local.put("editFormTempData",t)}la.tabs.setDirtyParam()}const qt={view:"property",id:"editTableFormProperty",css:"webix_edit-table-form-property",dirty:!1,editable:!0,tooltip:function(t){const e="Название: "+t.label+" <br>",n=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s");let i,o;if("date"==t.type)o="Выберите дату";else if("combo"==t.type){o="Выберите значение";const e=$$("editTableFormProperty").getItemNode(t.id);if(e){const n="webix_property_value",i=e.getElementsByClassName(n)[0].innerHTML;t.value=i||t.value}}else o="integer"==t.customType?"Введите число":"Введите текст";return i="date"==t.type?n(t.value):t.value,t.value?e+"Значение: "+i:e+o},hidden:!0,tempData:!1,elements:[],keyPressTimeout:800,statusForm:null,on:{onAfterEditStop:function(t,e){Va.enableItem($$("table-saveBtn")),document.getElementById("custom-date-editor")&&document.getElementById("custom-date-editor").addEventListener("input",(function(t){const e=t.target.value.replace(/\D/g,"").match(/(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})(\d{0,2})/);function n(t){return e[t]?e[t]:" __ "}"deleteContentBackward"!==t.inputType&&(t.target.value=n(1)+"."+n(2)+"."+n(3)+"  "+n(4)+":"+n(5)+":"+n(6))})),Wt(),this.callEvent("onNewValues",[t.value,e.config])},onNewValues:function(t,e){!function(t,e){try{const n=$$("editTableFormProperty");n.getItem(t).value=e,n.updateItem(t)}catch(t){ka(t,Nt,"editingEnd")}}(e.id,t),Mt(this)},onEditorChange:function(){Wt()},onBeforeRender:function(){const t=28*this.config.elements.length;t&&this.$height!==t&&(this.define("height",t),this.resize())},onItemClick:function(t){const e=$$("editTableFormProperty");e.getItem(t).css="",e.refresh()},onTimedKeyPress:function(){Mt(this)}}},Ut={scroll:"y",cols:[{width:4},qt,{width:4},{id:"propertyContainer",cols:[{id:"propertyRefbtns",rows:[]},{width:5}]}]};let Jt,Kt,Yt;function Gt(t){const e=$$(t).config,n=e.srcTable;var i;i=e.idEditor,Kt=$$("editTableFormProperty").getItem(i).value,function(t){if(t){const e=$$("table").getColumns();e&&e.length?e.forEach((function(e){if(e.id==t){const t={tree:{field:n=e.type.slice(10),type:"dbtable"},temp:{edit:{selected:Kt,values:{status:"put",table:n,values:{}}}}};la.tabs.openInNewTab(t)}var n})):(ka("array length is null",Nt,"setRefTable"),Va.hideItem($$("EditEmptyTempalte")))}}(n)}function Qt(t){t.config.dirtyProp=!1}function Xt(t){return webix.Date.dateToStr("%"+t)}const Zt=Xt("H"),te=Xt("i"),ee=Xt("s");const ne=[];function ie(t,e){const n=$$(t).getValue();return function(t,e,n){function i(){try{$$("timeForm").markInvalid(n)}catch(t){ka(t,Nt,"validTime element: "+n)}ne.push(n)}t>e&&i(),/^\d+$/.test(t)||i(),t.length<2&&i()}(n,e,t),n}function oe(t,e){const n=$$("editTableFormProperty"),i=n.getItem(t.id);n.callEvent("onNewValues",[e,i])}function re(t){ne.length=0;const e=$$("editCalendarDate"),n=$$("table-editForm"),i=ie("hourInp",23),o=ie("minInp",59),r=ie("secInp",59),s=e.getValue();return function(t,e){const n=Yt.getValues().id;try{ne.length||(Yt.setValues({[e.id]:t},!0),n&&Yt.setValues({id:n},!0),oe(e,t),Va.destructItem($$("editTablePopupCalendar")))}catch(t){ka(t,Nt,"setValToProperty")}}(Xt("d.%m.%y")(s)+" "+(i+":"+o+":"+r),t),n.setDirty(!0),ne.length}function se(t){const e=$$("editTablePopupCalendar");e&&(function(){let t=!1;function e(e){e.config.dirtyProp&&!t&&(t=!0)}return e($$("editCalendarDate")),e($$("hourInp")),e($$("minInp")),e($$("secInp")),t}()?Lt().then((function(n){1==n&&Va.destructItem(e),2!=n||re(t)||Va.destructItem(e)})):Va.destructItem(e))}function ae(t){const e=$$("editPropCalendarSubmitBtn");return{view:"text",name:t,id:t,placeholder:"00",attributes:{maxlength:2},dirtyProp:!1,on:{onKeyPress:function(){$$("timeForm").markInvalid(t,!1),Va.enableItem(e)},onChange:function(){this.config.dirtyProp=!0,Va.enableItem(e)}}}}function ce(t){return{template:":",id:t,borderless:!0,width:9,height:5,css:"popup_time-spacer"}}function le(t){return new l({config:{id:"editPropCalendarSubmitBtn",hotkey:"Ctrl+Space",value:"Добавить значение",click:function(){re(t)}},titleAttribute:"Добавить значение в запись таблицы"}).maxView("primary")}function ue(t){Yt=$$("editTableFormProperty"),function(t){const e="Редактор поля  «"+t.label+"»",n=new u({headline:e,config:{id:"editTablePopupCalendar",width:400,minHeight:300},closeConfig:{currElem:t},closeClick:se,elements:{rows:[{rows:[{view:"calendar",id:"editCalendarDate",format:"%d.%m.%y",borderless:!0,width:300,height:250,dirtyProp:!1,on:{onChange:function(){this.config.dirtyProp=!0,Va.enableItem($$("editPropCalendarSubmitBtn"))}}},{height:10},{view:"form",id:"timeForm",height:85,type:"space",elements:[{template:"<div style='font-size:13px!important'>Введите время в формате xx : xx : xx</div>",borderless:!0,css:"popup_time-timeFormHead"},{cols:[ae("hourInp"),ce(1),ae("minInp"),ce(2),ae("secInp")]}]},{height:10}]},{height:15},le(t)]}});n.createView(),n.showPopup(),function(t){const e=Yt.getValues()[t.id],n=Zt(e),i=$$("editCalendarDate"),o=$$("editPropCalendarSubmitBtn");try{e&&!isNaN(n)?(i.setValue(e),r=e,$$("hourInp").setValue(Zt(r)),$$("minInp").setValue(te(r)),$$("secInp").setValue(ee(r))):(i.setValue(new Date),Va.disableItem(o)),function(t){Qt(t),Qt($$("hourInp")),Qt($$("minInp")),Qt($$("secInp"))}(i)}catch(t){ka(t,Nt,"setValuesDate")}var r}(t)}(t)}let fe;function de(t,e){fe.setValues({[t.id]:[e]},!0)}function he(t){const e=$$("editPropTextarea");return e&&function(t,e){const n=e.getValue(),i=$$("editTablePopupText");e.dirtyValue?Lt().then((function(e){1!=e&&2!=e||(2==e&&de(t,n),Va.destructItem(i))})):Va.destructItem(i)}(t,e),he}function pe(t){const e=new l({config:{id:"editPropSubmitBtn",disabled:!0,hotkey:"Ctrl+Space",value:"Добавить значение",click:function(){!function(t){try{const e=$$("editPropTextarea").getValue();de(t,e),$$("table-editForm").setDirty(!0),oe(t,e)}catch(t){ka(t,Nt,"submitBtnClick")}Va.destructItem($$("editTablePopupText"))}(t)}},titleAttribute:"Добавить значение в запись таблицы"}).maxView("primary");return e}function me(t){fe=$$("editTableFormProperty"),function(t){const e=new l({config:{width:30,height:29,icon:"icon-window-restore",click:function(){!function(t){const e="Редактор поля  «"+t.label+"»",n=new u({headline:e,config:{id:"editTablePopupText",width:400,minHeight:300},closeConfig:{currElem:t},closeClick:he(t),elements:{padding:{left:9,right:9},rows:[{view:"textarea",id:"editPropTextarea",height:150,dirtyValue:!1,placeholder:"Введите текст",on:{onAfterRender:webix.once((function(){const t=$$("editTablePopupText").$width;this.config.width=.8*t,this.resize()})),onKeyPress:function(){Va.enableItem($$("editPropSubmitBtn")),$$("editPropTextarea").dirtyValue=!0}}},{height:15},pe(t)]}});n.createView(),n.showPopup(),function(t){try{const e=$$("editPropTextarea"),n=t.value;n&&e.setValue(n)}catch(t){ka(t,Nt,"setTextareaVal")}}(t),$$("editPropTextarea").focus()}(t)}},titleAttribute:"Открыть большой редактор текста"}).minView();try{$$("propertyRefbtnsContainer").addView(e)}catch(t){ka(t,Nt,"createBtnTextEditor")}}(t),Va.showItem($$("tablePropBtnsSpace"))}class be{static createForm(){$$("flexlayoutTable").addView(je()),Va.enableItem($$("table-newAddBtnId"))}static defaultState(t=!0){!function(t){const e=$$("table-editForm");t?xe():e&&e.setDirty(!1),Va.hideItem($$(e)),Va.hideItem($$("tablePropBtnsSpace")),Va.hideItem($$("table-saveNewBtn")),Va.hideItem($$("table-saveBtn")),Va.showItem($$("tableContainer")),Va.showItem($$("EditEmptyTempalte")),Va.enableItem($$("table-newAddBtnId")),Va.disableItem($$("table-delBtnId")),Va.removeItem($$("propertyRefbtnsContainer")),function(){la.tables.editForm.clearTempStorage();const t=$$("editTableFormProperty");t&&(t.clear(),t.hide())}(),ye(null)}(t)}static putState(){!function(){try{const t=$$("table-editForm");!function(t){$$("table-editForm"),t&&!t.isVisible()&&t.show()}($$("editTableFormProperty")),t.setDirty(!1),Va.showItem($$("table-saveBtn")),Va.hideItem($$("table-saveNewBtn")),Va.hideItem($$("EditEmptyTempalte")),Va.enableItem($$("table-delBtnId")),Va.enableItem($$("table-newAddBtnId")),t.isVisible()||(la.tables.defaultState("filter"),l.transparentDefaultState(),function(t){try{const e=$$("container");e.$width<850&&(Va.hideItem($$("tree")),e.$width<850&&(Va.hideItem($$("tableContainer")),t.config.width=window.innerWidth,t.resize(),Va.showItem($$("table-backTableBtn"))))}catch(t){ka(t,Nt,"adaptiveView")}}(t),t.show()),ye("put")}catch(t){ka(t,Nt,"editTablePutState")}}()}static postState(){!function(){const t=$$("table");(function(){const t=$$("editTableFormProperty");Va.showItem(t),t.clear(),$$("table-editForm").setDirty(!1)})(),function(t){const e=$$("EditEmptyTempalte");try{t.filter(!1),t.clearSelection(),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show(),$$("table-newAddBtnId").disable(),_e("table-editForm"),Va.hideItem(e)}catch(t){ka(t,Nt,"setWorkspaceState")}}(t),ye("post"),xe(),la.linkParam(!0,{view:"edit"})}()}static put(t=!0,n=!1){return function(t,n,i){try{const o=$$("editTableFormProperty").getValues(),r=Ea(),s=Rt().length,a=o.id,c=$$("table-editForm").isDirty();if(!s&&a&&c){const s=function(t){const e=function(t){const e={};if(t){const n=$$("table"),i=Object.values(t);i.length?i.forEach((function(i,o){const r=n.getItem(t.id),s=Object.keys(r);!function(){const n=Object.keys(t)[o];s.forEach((function(i){i==n&&r[i]!==Object.values(t)[o]&&(e[n]=Object.values(t)[o])}))}()})):ka("array is null",Nt,"uniqueData")}return e}(t);return $e(we(e))}(o);return new e({id:`${r}/${a}`}).put(s).then((function(e){if(e)return t&&i.defaultState(),!t&&n||function(t){try{const e=$$("table"),n=t.id;e.updateItem(n,t),e.clearSelection()}catch(t){ka(t,Nt,"updateTable")}}(o),ge(),Ia("success","Данные сохранены",r),!0}))}s?Rt().forEach((function(){zt()})):a?c||Ia("error","Обновлять нечего"):Ia("error","Поле id не заполнено")}catch(t){ka(t,Nt,"saveItem")}}(t,n,this)}static post(t=!0,n=!1){return function(t,n,i){const o=Ea();if(!Rt().length){const r=$$("editTableFormProperty").getValues(),s=function(t){const e=function(t){const e=Object.values(t),n=Object.keys(t),i={};return Oa(e,Nt,"removeNullFields")&&e.forEach((function(e,o){e&&(i[n[o]]=e),we(t)})),i}(t);return $e(we(e))}(r);return new e({id:o}).post(s).then((function(e){if(e){const s=e.content.id;if(s)return r.id=s,t&&i.defaultState(),!t&&n||function(t){const e=$$("table"),n=e.config.offsetAttr;t.id<=n&&e.add(t),ve()}(r),ge(),Ia("success","Данные успешно добавлены",o),!0}}))}zt()}(t,n,this)}static remove(){!function(t){const n=Ea();Pt("Запись будет удалена").then((function(){const i=$$("editTableFormProperty").getValues(),o=i.id;new e({id:`${n}/${o}.json`}).del(i).then((function(e){e&&(t.defaultState(),ge(),Ia("success","Данные успешно удалены"),function(){const t=$$("table"),e=t.getSelectedId().id;t&&t.remove(e)}(),ve(!0))}))}))}(this)}static clearTempStorage(){$$("editTableFormProperty").config.tempData=!1,webix.storage.local.remove("editFormTempData")}}function ge(){$$("table-editForm").setDirty(!1),la.tabs.setDirtyParam(),la.tables.editForm.clearTempStorage()}function we(t){const e=t;if(Oa(e,Nt,"dateFormatting")){const n=Object.values(t),i=Object.keys(t);i.length?i.forEach((function(t,i){const o=$$("editTableFormProperty").getItem(t),r=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s");"customDate"==o.type&&(e[t]=r(n[i]))})):ka("array length is null",Nt,"dateFormatting")}return e}function $e(t){const e=$$("table").getColumns();return Oa(e,Nt,"formattingBoolVals")&&e.forEach((function(e,n){t[e.id]&&"boolean"==e.type&&(2==t[e.id]?t[e.id]=!1:t[e.id]=!0)})),t}function ve(t){try{const e=$$("table-findElements"),n=$$("table").config.reccount;let i;i=t?n-1:n+1,$$("table").config.reccount=i;const o={full:i};e.setValues(JSON.stringify(o))}catch(t){ka(t,Nt,"setCounterVal")}}function ye(t){const e=$$("editTableFormProperty");e&&(e.config.statusForm=t)}function xe(){$$("table-editForm").setDirty(!1),la.tabs.setDirtyParam()}const Ie="propertyRefbtnsContainer";function Ce(t){ka("array length is null",Nt,t)}function Se(){const t=$$("editTableFormProperty"),e=$$("propertyRefbtns"),n=t.config.elements;Va.removeItem($$(Ie)),function(t){try{t.addView({id:Ie,rows:[]})}catch(t){ka(t,Nt,"createBtnsContainer")}}(e),n&&n.length?n.forEach((function(t){var e;"combo"==t.type?(e=t.id,Jt=e,function(t){const e=new l({config:{width:30,height:29,idEditor:t,icon:"icon-share-square-o",srcTable:Jt,click:function(t){Gt(t)}},titleAttribute:"Перейти в родительскую таблицу"}).minView();try{$$("propertyRefbtnsContainer").addView(e)}catch(t){ka(t,Nt,"btnLayout")}}(e),Va.showItem($$("tablePropBtnsSpace"))):"popup"==t.customType?me(t):"customDate"==t.type?function(t){!function(t){const e=new l({config:{width:30,height:29,icon:"icon-calendar",click:function(){ue(t)}},titleAttribute:"Открыть календарь"}).minView();try{$$("propertyRefbtnsContainer").addView(e)}catch(t){ka(t,Nt,"createDateBtn")}}(t),Va.showItem($$("tablePropBtnsSpace"))}(t):$$(Ie).addView({height:29,width:1})})):Ce("setToolBtns")}function Te(t){return{id:t.id,label:t.label,unique:t.unique,notnull:t.notnull,length:t.length,value:Ht(t)}}function ke(t,e){const n=t.value,i=e.collection.getItem(n);return i?i.value:""}function Ee(t){const e=Te(t);return(0==t.length||t.length>512)&&(e.customType="popup"),e.type="text",e}function _e(t){const e=$$(t),n=$$("table").getColumns(!0),i=e.elements,o=Object.keys(i).length;try{if(o)e.clear(),e.clearValidation(),"table-editForm"==t&&$$("table-delBtnId").enable();else{const t=[];n&&n.length?(n.forEach((e=>{const n=function(t){let e;return e="datetime"==t.type?function(t){const e=Te(t);return e.type="customDate",e}(t):t.type.includes("reference")?function(t){const e=Te(t);let n=t.type.slice(10);return e.type="combo",e.css=t.id+"_container",e.options=Fa(n),e.template=function(t,e,n,i){return ke(t,i)},e}(t):t.type.includes("boolean")?function(t){const e=Te(t);return e.type="combo",e.options=[{id:1,value:"Да"},{id:2,value:"Нет"}],e.template=function(t,e,n,i){return ke(t,i)},e}(t):t.type.includes("integer")?function(t){const e=Ee(t);return e.customType="integer",e}(t):Ee(t),e}(e);t.push(n)})),webix.editors.$popup={date:{view:"popup",body:{view:"calendar",weekHeader:!0,events:webix.Date.isHoliday,timepicker:!0,icons:!0}}},function(t){const e=$$("editTableFormProperty");e.define("elements",t),e.refresh()}(t),Se()):Ce("createProperty")}!function(){const t=$$("table-editForm"),e=function(t){let e=0;return t&&t.length?t.forEach((function(t,n){const i=t.$height;i&&(e+=i)})):Ce("findContentHeight"),e}(t.getChildViews()),n=function(t){if(t&&t.isVisible())return t.$height}($$("container"));if(e<n){const e=2;t.config.height=n-e,t.resize()}}()}catch(t){ka(t,Nt,"createEditFields")}}function Ve(){la.tables.editForm.postState()}const Fe=new l({config:{id:"table-newAddBtnId",hotkey:"Alt+A",disabled:!0,value:"Новая запись",click:function(){$$("table-editForm").isDirty()?Lt().then((function(t){1==t?Ve():2==t&&la.tables.editForm.put(!1).then((function(t){t&&Ve()}))})):(la.tables.editForm.clearTempStorage(),Ve())}},titleAttribute:"Добавить новую запись",adaptValue:"+"}).maxView(),Ae=new l({config:{id:"table-delBtnId",hotkey:"Ctrl+Enter",disabled:!0,icon:"icon-trash",click:function(){la.tables.editForm.remove()},on:{onViewShow:function(){"put"==$$("editTableFormProperty").config.statusForm&&$$("table-delBtnId").enable()}}},titleAttribute:"Удалить запись из таблицы"}).minView("delete"),Be=new l({config:{id:"table-saveBtn",hotkey:"Shift+Space",hidden:!0,value:"Сохранить",click:function(){la.tables.editForm.put()},on:{onViewShow:function(){this.isVisible()&&($$("editTableFormProperty").config.tableStatus="put")}}},titleAttribute:"Сохранить запись в таблицу"}).maxView("primary"),Oe=new l({config:{id:"table-saveNewBtn",hotkey:"Ctrl+Shift+Space",hidden:!0,value:"Сохранить",click:function(){la.tables.editForm.post()},on:{onViewShow:function(){this.isVisible()&&($$("editTableFormProperty").config.tableStatus="post")}}},titleAttribute:"Сохранить новую запись в таблицу"}).maxView("primary"),Pe=new l({config:{id:"table-backTableBtn",hotkey:"Shift+Q",hidden:!0,icon:"icon-arrow-left",click:function(){const t=$$("table-editForm"),e=$$("tableContainer"),n=$$("table");function i(){la.tables.editForm.clearTempStorage(),Va.hideItem(t),Va.showItem(e),n&&n.clearSelection()}t.isDirty()?Lt().then((function(e){1!=e&&2!=e||(1==e?i():2==e&&($$("table-saveBtn").isVisible()?la.tables.editForm.put():la.tables.editForm.post()),t.setDirty(!1))})):i()}},titleAttribute:"Вернуться к таблице"}).minView(),Le={view:"form",id:"table-editForm",hidden:!0,css:"webix_form-edit",minHeight:350,minWidth:230,borderless:!0,scroll:!0,elements:[{minHeight:48,id:"editBtnsContainer",css:"webix_form-adaptive",margin:5,rows:[{cols:[{rows:[{margin:5,rows:[{margin:2,cols:[Pe,Fe,Ae]}]},{margin:10,rows:[Be,Oe,{id:"EditEmptyTempalte",rows:[{height:20},jt("Добавьте новую запись или выберите существующую из таблицы")]}]}]},{id:"tablePropBtnsSpace",width:35,hidden:!0}]}]},Ut],on:{onViewShow:webix.once((function(){this.config.width=350,this.resize(),la.setForm(this)}))},rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}};function je(){return Le}const Ne="table/filter",De={};class He extends class{static pushInPull(t,e){De[t].push(e)}static getIndex(){}static clearItem(t){De[t]=[]}static getItem(t){return De[t]}static getAllChilds(t){const e=Object.values(De);return t?(n=e,[].concat(...n)):e;var n}static getIndexFilters(){const t=$$("inputsFilter"),e=[];if(t){const n=t.getChildViews();n.length&&n.forEach((function(t,n){e[t.config.idCol]=n}))}return e}static getAll(){return De}static getItems(){return Object.keys(De)}static lengthItem(t){return De[t].length}static lengthPull(){return this.getItems().length}static clearAll(){const t=this.getItems();t.length&&t.forEach((function(t){delete De[t]}))}static removeItemChild(t,e){const n=this.getItem(t);n.length&&n.forEach((function(t,i){t==e&&n.splice(i,1)}))}static spliceChild(t,e,n){De[t].splice(e,0,n)}}{static addClass(t,e){t.classList.contains(e)||t.classList.add(e)}static removeClass(t,e){t.classList.contains(e)&&t.classList.remove(e)}static setFieldState(t,e){!function(t,e){"selectAll"!==e&&e&&(Ue=t,qe=e,Je=e+"_filter",Me=$$(Je+"_segmentBtn"),function(){if(Ue){He.getItem(qe)||He.clearItem(qe);const t=function(t){let e=!0;return He.lengthItem(t)&&(e=!1),e}(qe);t&&(He.pushInPull(qe,Je),Va.showItem(Me))}else He.clearItem(qe)}(),function(){let t=!1;return $$(Je+"_rows").getChildViews().length>1&&(t=!0),t}()?Ue||Ge():Ue?(Ye(ze,We),Va.showItem($$(Je)),Va.showItem($$(Je+"_container-btns")),Va.enableItem($$("resetFilterBtn")),Va.enableItem($$("filterLibrarySaveBtn")),Va.hideItem($$("filterEmptyTempalte"))):Ge())}(t,e)}static clearFilter(){!function(){const t=He.getAllChilds();t&&t.length&&(t.forEach((function(t){var e;t.length&&(e=t)&&e.length&&e.forEach((function(t){if(!t.includes("_filter-child-")){const e=$$(t).config.columnName,n=$$(t+"_segmentBtn");He.setFieldState(0,e,t),n.setValue(1),Va.hideItem(n)}}))})),Va.disableItem($$("btnFilterSubmit")))}()}static getFilter(){return function(){const t=He.getItems(),e=He.lengthPull();Re={values:[]};for(let i=0;i<e;i++){const e=t[i];(n=He.getItem(e))&&n.length&&n.forEach((function(t,e){const n=$$(t+"_segmentBtn");if(n)try{let i=null;n.isVisible()&&(i=n.getValue()),function(t,e,n){const i=$$(t+"-btnFilterOperations");if(i){const o=i.getValue(),r=$$(t).getValue(),s=function(t){const e=t.config,n=e.columnName;let i=null;return n+"_filter"!==e.id&&(i=n),i}($$(t));Re.values.push({id:t,value:r,operation:o,logic:e,parent:s,index:n})}}(t,i,e)}catch(t){ka(t,Ne,"setOperation")}}))}var n;return Re}()}static setStateToStorage(){!function(){const t=He.getFilter(),e=He.getActiveTemplate(),n={id:Ea(),activeTemplate:e,values:t};(function(t,e){const n=la.tabs.getInfo();n&&(n.temp||(n.temp={}),n.temp.filter=e)})(0,n),webix.storage.local.put("currFilterState",n)}()}static setActiveTemplate(t){$$("filterTableForm").config.activeTemplate=t}static getActiveTemplate(){return $$("filterTableForm").config.activeTemplate}static showApplyNotify(t=!0){const e=_a();if(e){const n=e.config.id,i=$$(n+"_applyNotify");t?Va.showItem(i):Va.hideItem(i)}}static async resetTable(){return await async function(){const t=Ea(),n=_a(),i=[`query=${t}.id+%3E%3D+0&sorts=${t}.id&limit=80&offset=0`];return await new e({id:`smarts?${i}`}).get().then((function(t){if(t){const e=t.content;if(e)return n.config.filter=null,function(t,e){const n="Ничего не найдено";try{0!==t.length?(e.hideOverlay(n),e.clearAll(),e.parse(t)):(e.clearAll(),e.showOverlay(n))}catch(t){ka(t,Ne,"setDataTable")}}(e,n),function(t){try{const e=$$("table-findElements"),n={visible:t.count()};e.setValues(JSON.stringify(n))}catch(t){ka(t,Ne,"setFilterCounterVal")}}(n),Ia("success","Фильтры очищены"),!0}}))}()}static hideInputsContainers(t){const e=_a().getColumns();e&&e.length&&e.forEach((function(e){if(!t.find((t=>t==e.id))){const t=document.querySelector("."+e.id);He.addClass(t,"webix_hide-content"),He.removeClass(t,"webix_show-content")}}))}static enableSubmitButton(){const t=$$("btnFilterSubmit"),e=this.getAllChilds(!0);let n=!0;e.length&&(e.forEach((function(t){!$$(t).getValue()&&n&&(n=!1)})),n?Va.enableItem(t):Va.disableItem(t))}}let Re;const ze="webix_show-content",We="webix_hide-content";let Me,qe,Ue,Je;function Ke(t,e){t&&t.setValue(e)}function Ye(t,e){const n=document.querySelectorAll(".webix_filter-inputs");n&&n.length&&n.forEach((function(n){n.classList.contains(qe)&&(He.addClass(n,t),He.removeClass(n,e))}))}function Ge(){Ye(We,ze),$$(Je+"_rows")&&function(){const t=$$(Je+"_rows");if(t){const e=t.getChildViews();if(e&&e.length){const t=Object.values(e),n=[];t&&t.length&&t.forEach((function(t){const e=t.config.id;e.includes("child")&&n.push($$(e))})),n&&n.length&&n.forEach((function(t){Va.removeItem(t)}))}}}(),$$(Je).setValue(""),$$(Je).hide(),function(){const t=$$(Je+"-btnFilterOperations"),e=$$(Je+"_container-btns");Ke(t,"="),Ke(Me,1),Va.hideItem(Me),Va.hideItem(e)}()}function Qe(t){const e=function(t){return Ea()+"."+t}(t.name),n=function(t,e){let n="'"+e+"'";return function(t){const e=_a().getColumnConfig(t).type;let n=!1;return e&&"boolean"===e&&(n=!0),n}(t)&&(n=function(t){return 1==t||2!=t&&void 0}(e)),function(t){if(webix.isDate(t))return!0}(e)&&(n=webix.Date.dateToStr("%d.%m.%Y+%H:%i:%s")(e)),n}(t.name,t.value),i=function(t){let e=null;return"1"==t?e="+and+":"2"==t&&(e="+or+"),e}(t.logic),o=function(t){let e;return e=t?"⊆"===t?"contains":"="===t?"%3D":t:"=","+"+e+"+"}(t.operation);let r=e+o+n;return i&&(r+=i),r}function Xe(){const t=function(){const t=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s"),e=function(){const t=[],e=He.getAllChilds(!0);return e&&e.length&&e.forEach((function(e){const n=$$(e).config.columnName,i=$$(e).getValue(),o=$$(e+"-btnFilterOperations").getValue(),r=function(t){const e=$$(t+"_segmentBtn");let n=null;return e.isVisible()&&(n=e.getValue()),n}(e);t.push({id:e,name:n,value:i,operation:o,logic:r})})),t}(),n=[];return e&&e.length&&e.forEach((function(e){const i=$$(e.id);let o=e.value;i&&("datepicker"==i.config.view&&(o=t(o)),function(){const t=i.config.text;t&&"Нет"==t&&(o=0)}(),n.push(Qe(e)))})),n}();return t.join("")}function Ze(){He.showApplyNotify(!1)}const tn=new l({config:{id:"btnFilterSubmit",hotkey:"Ctrl+Shift+Space",disabled:!0,value:"Применить фильтры",click:function(){if($$("filterTableForm").validate()){const t=_a(),n=Xe();(function(t,e){t.config.filter={table:t.config.idTable,query:e},function(t){const e=la.tabs.getInfo();e.temp||(e.temp={}),e.temp.queryFilter=t,la.tabs.setInfo(e)}(e)})(t,n),new e({id:`smarts?query=${n}`,isFullPath:!1,errorActions:Ze}).get().then((function(e){if(e){const n=e.reccount,i=e.content;He.showApplyNotify(),function(t,e){const n="Ничего не найдено";try{t.clearAll(),e.length?(t.hideOverlay(n),t.parse(e)):t.showOverlay(n)}catch(t){ka(t,Ne,"setData")}}(t,i),function(t){try{const e=_a().config.id,n=$$(e+"-findElements"),i={visible:t};n.setValues(JSON.stringify(i))}catch(t){ka(t,Ne,"setCounterVal")}}(n),Va.hideItem($$("tableFilterPopup")),Ia("success","Фильтры успшено применены")}}))}else Ia("error","Не все поля формы заполнены")}},titleAttribute:"Применить фильтры"}).maxView("primary");function en(){(function(){const t=He.getItems();t&&t.length&&t.forEach((function(t){var e;(e=He.getItem(t))&&e.length&&e.forEach((function(t){t.includes("_filter-child-")&&Va.removeItem($$(t+"-container"))}))}))})(),function(){const t=$$("filterTableForm");t&&t.clear()}(),function(){const t=document.querySelectorAll(".webix_filter-inputs");t&&t.length&&t.forEach((function(t){He.addClass(t,"webix_hide-content")}))}(),He.clearFilter(),Va.hideItem($$("tableFilterPopup")),Va.disableItem($$("filterLibrarySaveBtn")),Va.disableItem($$("resetFilterBtn")),Va.showItem($$("filterEmptyTempalte")),He.setActiveTemplate(null),He.clearAll(),He.setStateToStorage()}function nn(){const t=la.tabs.getInfo();t.temp&&t.temp.queryFilter&&(t.temp.queryFilter=null)}const on=new l({config:{id:"resetFilterBtn",hotkey:"Shift+Esc",disabled:!0,icon:"icon-trash",click:function(){!function(){const t=_a();try{Lt("Все фильтры будут удалены","Вы уверены?",["Отмена","Удалить"]).then((function(e){1==e&&He.resetTable().then((function(e){e&&(en(),He.showApplyNotify(!1)),t.config.filter=null,nn(),Va.hideItem($$("templateInfo"))}))}))}catch(t){ka(t,"Ошибка при очищении фильтров; filterForm => buttons","resetFilterBtnClick")}}()}},titleAttribute:"Сбросить фильтры",onFunc:{resetFilter:function(){_a().config.filter=null,He.resetTable().then((function(t){t&&(en(),He.showApplyNotify(!1))}))}}}).minView("delete");let rn,sn,an;function cn(){Ia("success","Шаблон «"+rn+"»  сохранён в библиотеку")}function ln(t){new e({id:`userprefs/${t.id}`}).put(t).then((function(t){t&&cn()}))}const un=new l({config:{id:"filterLibrarySaveBtn",hotkey:"Shift+Esc",icon:"icon-file",disabled:!0,click:function(){try{webix.prompt({title:"Название шаблона",ok:"Сохранить",cancel:"Отменить",css:"webix_prompt-filter-lib",input:{required:!0,placeholder:"Введите название шаблона..."},width:350}).then((function(t){!async function(t){const n=await Ba(),i=Ea(),o=He.getFilter().values;rn=t,an=`fields/${i}`;const r={name:rn,table:i,values:o},s=await async function(t,n){let i={check:!1};return await new e({id:`smarts?query=userprefs.name+=+%27${an}%27+and+userprefs.owner+=+${t}`}).get().then((function(t){if(t&&t.content){const e=t.content[0];if(e){const t=JSON.parse(e.prefs);if(t){e.prefs=t;const o=t.filterTemplates;o&&o.length?(o.forEach((function(t,o){t.name==n&&(i={check:!0,item:e,index:o})})),i.check||(i.item=e)):i={check:!1,item:e}}}}})),i}(n.id,rn);if(s.check){const t=s.item,e=s.index;t&&(t.prefs.filterTemplates[e]=r,sn=t,async function(t){Lt("Шаблон с таким именем существует","После сохранения предыдущие данные будут стёрты",["Отмена","Сохранить изменения"]).then((function(e){1==e&&ln(t)}))}(sn))}else{const t=s.item;t?(t.prefs.filterTemplates||(t.prefs.filterTemplates=[]),t.prefs.filterTemplates.push(r),sn=t,ln(sn)):(sn={name:an,owner:n.id,prefs:{filterTemplates:[r]}},function(t){new e({id:"userprefs"}).post(t).then((function(t){t&&cn()}))}(sn))}}(t)}))}catch(t){ka(t,Ne,"filterSubmitBtn")}}},titleAttribute:"Сохранить шаблон с полями в библиотеку"}).minView();const fn=new l({config:{id:"table-backTableBtnFilter",hotkey:"Shift+Q",hidden:!0,icon:"icon-arrow-left",click:function(){!function(){const t=$$("filterTableBarContainer"),e=$$("tableContainer");Va.hideItem(t),Va.showItem(e)}(),function(){const t=$$("table");t&&t.clearSelection()}(),function(){const t=document.querySelector(".webix_btn-filter");He.addClass(t,"webix-transparent-btn"),He.removeClass(t,"webix-transparent-btn--primary")}()}},titleAttribute:"Вернуться к таблице"}).minView();function dn(t){return"formResetBtn"==t?on:"formBtnSubmit"==t?tn:"formEditBtn"==t?yn:"filterBackTableBtn"==t?fn:"formLibrarySaveBtn"==t?un:void 0}let hn,pn;async function mn(){pn=$$("filterEditLib"),hn=await Ba();const t=Ea();(function(){const t=[],e=pn.config.options,n=e.length;pn&&n&&e&&t&&(e.forEach((function(e){t.push(e.id)})),t.forEach((function(t){pn.removeOption(t)})))})(),hn&&t&&new e({id:`smarts?query=userprefs.name+=+%27fields/${t}%27+and+userprefs.owner+=+${hn.id}`}).get().then((function(t){if(t){const e=t.content;if(e&&e.length){const t=e[0];if(t.prefs){const e=JSON.parse(t.prefs).filterTemplates;e&&e.length&&function(t){t.forEach((function(t,e){!function(t,e){const n=e;pn.addOption({id:t+1,value:n.name,prefs:e})}(e,t)}))}(e)}}}const e=$$("filterEditLib");e&&0==e.data.options.length&&$$("filterEditLib").addOption({id:"radioNoneContent",disabled:!0,value:"Сохранённых шаблонов нет"})}))}function bn(){const t={view:"checkbox",id:"selectAll",labelRight:"<div style='font-weight:600'>Выбрать всё</div>",labelWidth:0,name:"selectAll",on:{onChange:function(){Va.enableItem($$("popupFilterSubmitBtn")),function(){const t=$$("editFormPopupScrollContent");if(t){const e=t.getChildViews(),n=$$("selectAll").getValue();e&&e.length&&e.forEach((function(t){t.config.id.includes("checkbox")&&(n?t.setValue(1):t.setValue(0))}))}}()}}};return t}function gn(t){let e=0;return t&&t.length&&t.forEach((function(t){if(t.config.id.includes("checkbox")){const n=t.config.value;n&&""!=n||e++}})),e}function wn(t,e){try{t.config.value=e,t.refresh()}catch(t){ka(t,Ne,"setSelectAllState")}}function $n(t){const e=function(t){return{view:"checkbox",id:t.id+"_checkbox",labelRight:t.label,labelWidth:0,name:t.id,on:{onChange:function(){!function(t){gn($$(t.id+"_checkbox").getParentView().getChildViews()),function(t){const e=gn($$(t.id+"_checkbox").getParentView().getChildViews()),n=$$("selectAll"),i=n.config.value;e?i&&wn(n,0):wn(n,1)}(t),Va.enableItem($$("popupFilterSubmitBtn"))}(t)}}}}(t),n=$$(t.id),i=$$(t.id+"_rows").getChildViews();return(n&&n.isVisible()||i.length>1)&&(e.value=1),e}function vn(){window.innerWidth<1200&&function(){const t=.89*window.innerWidth,e=$$("popupFilterEdit");try{e.config.width=t,e.resize()}catch(t){ka(t,Ne,"popupSizeAdaptive")}}(),function(){const t=[bn()],e=function(){const t=[],e=$$("filterTableForm");if(e){const n=e.elements;if(n){const e=Object.values(n);e&&e.length&&e.forEach((function(e){var n;t.push({id:(n=e.config).id,label:n.label})}))}}return t}();e&&e.length&&(e.forEach((function(e){e.id.includes("child")||t.push($n(e))})),function(t){const e=$$("editFormPopupScroll"),n=function(t){return[{cols:[{id:"editFormPopupScrollContent",css:"webix_edit-form-popup-scroll-content",rows:t}]}]}(t);try{e&&e.addView({rows:n},1)}catch(t){ka(t,Ne,"addCheckboxesToLayout")}}(t))}(),function(){const t=$$("selectAll");gn($$("editFormPopupScrollContent").getChildViews())||wn(t,1)}()}const yn=new l({config:{hotkey:"Alt+A",value:"Открыть редактор",click:function(){!function(){const t=new u({headline:"Редактор фильтров",config:{id:"popupFilterEdit",height:400,width:400},elements:{rows:[jt("Выберите нужные поля или шаблон из библиотеки"),Ai]}});t.createView(),t.showPopup()}(),mn(),vn()}},titleAttribute:"Добавить/удалить фильтры"}).maxView();function xn(t,e,n){t.add({value:e,id:n})}function In(t){xn(t,"=","eql"),xn(t,"!=","notEqual")}function Cn(t){xn(t,"< ","less"),xn(t,"> ","more"),xn(t,">=","mrEqual"),xn(t,"<=","lsEqual")}function Sn(t){return webix.once((function(){"combo"==t||"boolean"==t?In(this):"text"==t?(In(this),xn(this,"содержит","contains")):"date"==t?(In(this),Cn(this)):"integer"==t&&(In(this),Cn(this),xn(this,"содержит","contains"))}))}function Tn(t,e){const n={view:"contextmenu",width:100,data:[],on:{onMenuItemClick(t){!function(t,e){const n=$$(t);let i;i="notEqual"===e?"!=":"less"===e?"<":"more"===e?">":"mrEqual"===e?">=":"lsEqual"===e?"<=":"contains"===e?"⊆":"=";try{n.setValue(i)}catch(t){ka(t,Ne,"filterOperationsBtnLogic")}}(i,t)},onAfterLoad:Sn(t)}},i=e+"-btnFilterOperations";return new l({config:{id:i,value:"=",width:40,popup:n,inputHeight:38,on:{onChange:function(t){"contains"==t&&this.setValue("⊆"),He.getActiveTemplate()&&Va.showItem($$("templateInfo")),He.setStateToStorage()}}},titleAttribute:"Выбрать условие поиска по полю",css:"webix_filterBtns"}).maxView()}function kn(){He.getActiveTemplate()&&Va.showItem($$("templateInfo"))}function En(t,e){let n=!1;return t===e&&(n=!0),n}function _n(){(function(t=!1){const e=He.getAllChilds(),n=[];let i=0;return e&&e.length&&e.forEach((function(t,e){t.length&&(i++,n.push(e))})),t?n.pop():i})()||Va.showItem($$("filterEmptyTempalte"))}function Vn(t,e){const n={};let i=!1,o=He.getItem(t);return n.prevIndex=o.length-2,n.lastIndex=o.length-1,n.lastInput=o[n.lastIndex],n.prevIndex<0&&(o=function(t,e){let n;return function e(i){let o=t.indexOf(i)-1;if(o>=0){const i=t[o];He.lengthItem(i)?n=He.getItem(i):e(i)}}(e),n}(e,t),o?n.prevIndex=o.length-1:i=!0),i?(He.getActiveTemplate()&&He.setActiveTemplate(null),Va.hideItem($$("templateInfo")),_n()):n.prevInput=o[n.prevIndex],n}function Fn(t){const e=$$(t+"_segmentBtn");Va.hideItem(e)}function An(t,e,n){const i=He.getItems(),o=function(t,e){const n=[];e&&e.length&&e.forEach((function(t){He.getItem(t).length&&n.push(t)}));const i=function(t){const e=He.getIndexFilters(),n=[];if(t&&t.length){t.forEach((function(t){n.push(e[t])}));let i=0;for(let t=0;t<n.length;t++)n[t]>i&&(i=n[t]);return Object.keys(e).find((t=>e[t]===i))}}(n);if(t==i)return!0}(e,i);if("add"===t&&o){const t=Vn(e,i);En(t.lastInput,n)&&Fn(t.lastInput)}else if("remove"===t&&o){const t=Vn(e,i);En(t.lastInput,n)&&Fn(t.prevInput)}}function Bn(t,e){const n=e.id+"_filter",i=$$(n+"_segmentBtn");"add"===t?(function(){const t=Xn(e);An("add",e.id,t),Va.showItem(i),He.setStateToStorage()}(),He.enableSubmitButton(),kn()):"remove"===t&&Pt("Поле фильтра будет удалено").then((function(){(function(){const t=$$(n).getParentView().getChildViews();!function(t,e){const n=$$(t+"-btnFilterOperations");e&&e.length&&(e.forEach((function(t){Va.hideItem(t)})),n?n.setValue(" = "):ka("button is not defined",Ne,"hideMainInput"))}(n,t),function(t){const e=$$(t+"_filter_rows");if(1==e.getChildViews().length){const t=e.getNode();He.removeClass(t,"webix_show-content"),He.addClass(t,"webix_hide-content")}}(e.id),An("remove",e.id,n),He.removeItemChild(e.id,n),_n(),He.setStateToStorage(),Ia("success","Поле удалено")})(),He.enableSubmitButton(),Va.hideItem(i),kn()}))}let On,Pn,Ln,jn,Nn,Dn,Hn,Rn,zn,Wn,Mn,qn,Un,Jn;function Kn(t,e,n){Ln=e,On=function(t){const e=t.config.master,n=e.indexOf("_contextMenuFilter");return e.slice(0,n)}(n),Pn=On+"-container","add"==t?(function(){const t=$$(On+"_segmentBtn"),e=function(t,e){const n=$$(t+"_filter").isVisible(),i=He.getItem(t);let o=0;return i&&i.length&&(i.forEach((function(t,n){t+"-container"===e&&(o=n+1)})),n||o++),o}(Ln.id,Pn),n=Xn(Ln,e);An("add",Ln.id,n),Va.showItem(t),He.setStateToStorage()}(),He.enableSubmitButton(),kn()):"remove"===t&&Pt("Поле фильтра будет удалено").then((function(t){t&&(An("remove",Ln.id,On),He.removeItemChild(Ln.id,On),Va.removeItem($$(Pn)),_n(),He.setStateToStorage(),Ia("success","Поле удалено"),He.enableSubmitButton(),kn())}))}function Yn(t,e,n){return new l({config:{id:e+"_contextMenuFilter",icon:"wxi-dots",width:40,inputHeight:38,popup:{view:"contextmenu",css:"webix_contextmenu",data:[{id:"add",value:"Добавить поле",icon:"icon-plus"},{id:"remove",value:"Удалить поле",icon:"icon-trash"}],on:{onMenuItemClick:function(e){n?Kn(e,t,this):Bn(e,t)}}}},titleAttribute:"Добавить/удалить поле",css:"webix_filterBtns"}).minView()}function Gn(t,e,n,i=null){let o,r=!1;return n?o=t.id+"_filter-child-"+i:(o=t.id+"_filter",r=!0),{id:o+"_container-btns",hidden:r,css:{"margin-top":"22px!important"},cols:[Tn(e,o),Yn(t,o,n)]}}function Qn(){He.getItem(Nn)||He.clearItem(Nn);const t=ii(Dn,Rn,jn);!function(t){const e=function(){let t=Hn;return $$(Nn+"_filter").isVisible()||(t=Hn-1),t}();He.spliceChild(Nn,e,t)}(t.id);const e=function(t){return[{id:webix.uid(),height:105,rows:[{cols:[t,Gn(jn,Rn,!0,Dn)]},ri(jn,!0,Dn)]}]}(t);!function(t){const e=$$(Nn+"_filter_rows"),n=Nn+"_filter-child-"+Dn+"-container";e.addView({id:n,padding:5,positionElem:Hn,rows:t},Hn)}(e)}function Xn(t,e){return jn=t,Nn=t.id,Dn=webix.uid(),function(t){Hn=null==t?1:t}(e),function(t){Rn="boolean"!==t.type?t.editor:"boolean"}(t),Qn(),Nn+"_filter-child-"+Dn}function Zn(){const t=zn.id,e=t+qn,n={id:e,name:e,label:zn.label,columnName:t,labelPosition:"top"};return Mn||(n.hidden=!0),n}function ti(){Va.enableItem($$("btnFilterSubmit")),He.setStateToStorage(),$$("filterTableForm").clearValidation()}function ei(t){const e=Zn();return e.view="text",e.on={onTimedKeypress:function(){ti()}},"text"==t?e.placeholder="Введите текст":"int"==t&&(e.placeholder="Введите число",e.invalidMessage="Поле поддерживает только числовой формат",e.validate=function(t){return!isNaN(1*t)}),e}function ni(t){const e=Zn(),n=function(){if(zn.editor&&"combo"==zn.editor)return zn.type.slice(10)}();return e.view="combo",e.placeholder="Выберите вариант",e.on={onChange:function(){ti()}},"default"==t?e.options={data:Fa(n)}:"bool"==t&&(e.options=[{id:1,value:"Да"},{id:2,value:"Нет"}]),e}function ii(t,e,n){return Mn=t,qn=Mn?"_filter-child-"+Mn:"_filter",zn=n,Wn=e,"text"==Wn?ei("text"):"combo"==Wn?ni("default"):"boolean"==Wn?ni("bool"):"date"==Wn?function(){const t=Zn();return t.view="datepicker",t.placeholder="дд.мм.гг",t.editable=!0,t.format="%d.%m.%Y %H:%i:%s",t.timepicker=!0,t.on={onChange:function(){ti()}},t}():"integer"==Wn?ei("int"):void 0}function oi(t){return"datetime"==t.type?[ii(!1,"date",t),Gn(t,"date")]:t.type.includes("reference")?[ii(!1,"combo",t),Gn(t,"combo")]:t.type.includes("boolean")?[ii(!1,"boolean",t),Gn(t,"combo")]:t.type.includes("integer")?[ii(!1,"integer",t),Gn(t,"integer")]:[ii(!1,"text",t),Gn(t,"text")]}function ri(t,e,n){let i,o=!1;const r=t.id+"_filter";return e?i=r+"-child-"+n:(i=r,o=!0),{view:"segmented",id:i+"_segmentBtn",hidden:o,value:1,options:[{id:"1",value:"и"},{id:"2",value:"или"}],on:{onChange:function(t){He.setStateToStorage(),He.getActiveTemplate()&&Va.showItem($$("templateInfo"))}}}}const si={view:"form",hidden:!0,id:"filterTableForm",minHeight:350,scroll:!0,elements:[{css:"webix_form-adaptive",rows:[{rows:[{margin:2,cols:[dn("filterBackTableBtn"),dn("formEditBtn"),dn("formResetBtn")]}]},{id:"btns-adaptive",rows:[{margin:2,cols:[dn("formBtnSubmit"),dn("formLibrarySaveBtn")]}]}]},{id:"filterEmptyTempalte",rows:[jt("Добавьте фильтры из редактора")]},function(){const t=new l({config:{id:"putTemplateBtn",inputHeight:40,icon:"icon-pencil",click:function(){!function(){const t=He.getActiveTemplate(),n=He.getFilter().values,i=JSON.parse(t.prefs.prefs);i.values=n;const o={prefs:i};!function(t,n,i){new e({id:`userprefs/${t}`}).put(n).then((function(t){t&&(Ia("success","Шаблон «"+i+"»  обновлён"),Va.hideItem($$("templateInfo")))}))}(t.prefs.id,o,i.name)}()}},titleAttribute:"Сохранить изменения"}).transparentView();return{id:"templateInfo",hidden:!0,css:"filter-template-info",cols:[{template:"Есть несохранённые изменения в шаблоне",height:65,borderless:!0},{rows:[{},t,{}]},{width:5}]}}()],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}};const ai="webix-transparent-btn--primary",ci="webix-transparent-btn";function li(t,e,n){He.addClass(t,e),He.removeClass(t,n)}let ui;function fi(t){ui=document.querySelector(".webix_btn-filter"),ui.classList.contains(ai)?(li(ui,ci,ai),Va.hideItem($$("filterTableForm")),Va.hideItem($$("filterTableBarContainer")),la.tabs.clearTemp("currFilterState","filter"),la.linkParam(!1,"view")):(function(t){Va.hideItem($$("table-editForm")),Va.showItem(t),t.getChildViews()&&function(t,e=1){Un=t,Jn=e;const n=$$(Un).elements;if(0==Object.keys(n).length){Va.removeItem($$("inputsFilter"));const t=function(){const t=[],e=$$("table").getColumns(!0);return e.length&&e.forEach((e=>{const n=e.id,i={id:n+"_filter_rows",idCol:n,css:n+" webix_filter-inputs",rows:[{id:n+"_filter-container",padding:5,rows:[{cols:oi(e)},ri(e,!1)]}]};t.push(i)})),t}();!function(t){const e=$$(Un);try{e&&e.addView({margin:8,id:"inputsFilter",css:"webix_inputs-table-filter",rows:t},Jn)}catch(t){ka(t,Ne,"addInputs")}}(t)}else!function(){const t=$$(Un);try{t&&(t.clear(),t.clearValidation())}catch(t){ka(t,Ne,"clearFormValidation")}}(),Va.showItem($$("inputsFilter"))}("filterTableForm",3),li(ui,ai,ci),Va.showItem($$("filterTableBarContainer"))}(t),la.linkParam(!0,{view:"filter"}))}function di(t){const e=$$("filterTableForm"),n=$$("container");!function(t,e){$$(e).clearSelection(),fi(t)}(e,t);const i=n.$width;i<850?(Va.hideItem($$("tree")),i<850&&(Va.hideItem($$("tableContainer")),Va.hideItem($$("tree")),Va.showItem($$("table-backTableBtnFilter")),function(t){const e=$$("filterTableBarContainer");e.config.width=t,e.resize()}(window.innerWidth-45))):(Va.hideItem($$("table-backTableBtnFilter")),e.config.width=350,e.resize())}function hi(t,e){e&&t.setValue(e)}function pi(t){const e=t.id,n=$$(e+"_segmentBtn"),i=$$(e+"-btnFilterOperations");hi(n,t.logic),hi(i,t.operation)}function mi(t){He.clearFilter(),t&&t.length&&(t.forEach((function(t){t.parent?function(t){const e=Xn(_a().getColumnConfig(t.parent),t.index),n=t;n.id=e,pi(n),hi($$(e),t.value)}(t):function(t){const e=t.id,n=$$(e);if(n){const i=n.config.columnName;He.setFieldState(1,i,e),pi(t),hi(n,t.value)}else ka("element is "+n,Ne,"showParentField")}(t)})),function(){const t=function(t){const e=He.getIndexFilters(),n=[];if(t&&t.length){t.forEach((function(t){n.push(e[t])}));let i=0;for(let t=0;t<n.length;t++)n[t]>i&&(i=n[t]);return Object.keys(e).find((t=>e[t]===i))}}(He.getItems()),e=function(t){return t[t.length-1]}(He.getItem(t)),n=$$(e+"_segmentBtn");Va.hideItem(n)}())}function bi(){Va.enableItem($$("filterLibrarySaveBtn")),function(){const t=$$("editFormPopup");if(t){const e=t.getValues(),n=[];try{const t=Object.keys(e);if(t&&t.length){let i=!1;t.forEach((function(t){e[t]&&"selectAll"!==t?n.push(t):"selectAll"==t&&(i=!0);const o=$$(t).config.columnName;He.setFieldState(e[t],o)})),function(t,e){const n=e.length;e&&n&&e.forEach((function(e,i){const o=function(t){const e=$$(t).config.columnName;return He.getItem(e)}(e),r=o[o.length-1],s=$$(r+"_segmentBtn"),a=n-1;i===n-1?Va.hideItem(s):(i===a||t)&&Va.showItem(s)}))}(i,n)}}catch(t){ka(t,Ne,"createWorkspaceCheckbox")}}}(),function(){const t=function(){const t=$$("filterTableForm");let e=0;if(t){const t=$$("filterTableForm").elements;if(t){const n=Object.values(t);n&&n.length&&n.forEach((function(t){t.config.hidden||e++}))}}return e}();t||(Va.showItem($$("filterEmptyTempalte")),Va.disableItem($$("btnFilterSubmit")),Va.disableItem($$("filterLibrarySaveBtn")))}(),Va.destructItem($$("popupFilterEdit")),Ia("success","Рабочая область фильтра обновлена")}async function gi(t){return Lt("С таблицы будет сброшен текущий фильтр","Вы уверены?",["Отмена","Продолжить"]).then((function(e){if(1==e)return He.resetTable().then((function(e){return e&&(He.showApplyNotify(!1),t.config.filter=null,nn()),e}))}))}function wi(){bi(),He.setStateToStorage(),He.enableSubmitButton(),He.getActiveTemplate()&&Va.showItem($$("templateInfo"))}function $i(){He.clearFilter(),He.clearAll(),async function(){const t=function(){const t=$$("filterEditLib"),e=t.getValue();return t.getOption(e)}();mi(t.prefs.values),Va.destructItem($$("popupFilterEdit")),He.setActiveTemplate(t),function(){const t=He.getItems();t&&t.length&&(t.forEach((function(t){const e=document.querySelector("."+t);He.addClass(e,"webix_show-content"),He.removeClass(e,"webix_hide-content")})),He.hideInputsContainers(t))}(),He.setStateToStorage(),He.enableSubmitButton(),Va.hideItem($$("templateInfo"))}()}const vi=new l({config:{id:"popupFilterSubmitBtn",hotkey:"Shift+Space",disabled:!0,value:"Применить",click:function(){try{const t=$$("filterPopupTabbar").getValue();if("editFormPopupLib"==t){const t=_a();t.config.filter?gi(t).then((function(t){t&&He.resetTable().then((function(t){t&&$i()}))})):$i()}else"editFormScroll"==t&&(function(){const t=_a(),e=t.config.filter;(function(){const t=$$("editFormPopupScrollContent");let e=!0;if(t){const n=t.getChildViews();n&&n.length&&n.forEach((function(t){const n=t.config.id,i=$$(n);i&&i.getValue()&&e&&"selectAll"!==n&&(e=!1)}))}return e})()&&e?gi(t).then((function(t){t&&wi()})):wi()}(),He.setStateToStorage())}catch(t){ka(t,Ne,"popupSubmitBtn"),Va.destructItem($$("popupFilterEdit"))}He.lengthPull()||Va.showItem($$("filterEmptyTempalte"))}},titleAttribute:"Выбранные фильтры будутдобавлены в рабочее поле, остальные скрыты"}).maxView("primary");let yi,xi;async function Ii(){const t=xi.prefs,n=`fields/${t.table}`;hn=await Ba(),new e({id:`smarts?query=userprefs.name+=+%27${n}%27+and+userprefs.owner+=+${hn.id}`}).get().then((function(n){if(n&&n.content&&n.content.length){const i=n.content[0];if(i){const n=function(t,e){const n=[];let i=e.prefs;if(i){i=JSON.parse(i);const e=i.filterTemplates;e&&e.length&&e.forEach((function(e){e.name!==t.name&&n.push(e)}))}return n}(t,i);let o=i.prefs;o&&(o=JSON.parse(o),o.filterTemplates=n,i.prefs=o,function(t){new e({id:`userprefs/${t.id}`}).put(t).then((function(t){t&&(Ia("success","Шаблон « "+xi.value+" » удален"),function(){if(yi){const t=xi.id,e=yi.config.options;e&&e.forEach((function(e){e.id==t&&(e.value=e.value+" (шаблон удалён)",yi.refresh(),yi.disableOption(yi.getValue()),yi.setValue(""))}))}}(),He.clearFilter(),He.setStateToStorage(),Va.showItem($$("filterEmptyTempalte")))}))}(i))}}}))}const Ci={cols:[vi,{width:5},new l({config:{id:"editFormPopupLibRemoveBtn",hotkey:"Shift+Q",hidden:!0,disabled:!0,icon:"icon-trash",click:function(){Lt("Шаблон будет удалён","Вы уверены, что хотите продолжить?",["Отмена","Удалить"]).then((function(t){1==t&&async function(){yi=$$("filterEditLib");const t=yi.getValue();xi=yi.getOption(t),xi.prefs.table&&(Ii(),He.setActiveTemplate(null),Va.disableItem($$("editFormPopupLibRemoveBtn")))}()}))}},titleAttribute:"Выбранный шаблон будет удален"}).minView("delete")]},Si={view:"radio",id:"filterEditLib",vertical:!0,options:[],on:{onChange:function(){!function(){const t=$$("popupFilterSubmitBtn"),e=He.getActiveTemplate()||null,n=$$("filterEditLib"),i=n.getValue(),o=n.getOption(i);o&&o.id!==e?(Va.enableItem($$("editFormPopupLibRemoveBtn")),Va.enableItem(t)):Va.disableItem(t)}()}}},Ti={view:"form",scroll:!0,id:"editFormPopupLib",css:"webix_multivew-cell",borderless:!0,elements:[Si]};function ki(t){const e=$$("popupFilterSubmitBtn");"enable"==t?Va.enableItem(e):"disable"==t&&Va.disableItem(e)}function Ei(t){const e=$$("editFormPopupLibRemoveBtn");t?Va.showItem(e):Va.hideItem(e)}function _i(t){"editFormPopupLib"==t&&function(){try{""!==$$("filterEditLib").getValue()?ki("enable"):ki("disable"),Ei(!0),function(){const t=$$("filterEditLib"),e=He.getActiveTemplate();e&&e.id&&(t.setValue(e.id),Va.enableItem($$("editFormPopupLibRemoveBtn")),ki("disable"))}()}catch(t){ka(t,Ne,"filterLibrary")}}(),"editFormScroll"==t&&function(){const t=$$("editFormPopup").getValues();let e=0;t&&(function(){const n=Object.values(t);n&&n.length&&n.forEach((function(t){t&&e++}))}(),Ei(!1),ki(e>0?"enable":"disable"))}()}function Vi(t){return"<spanclass='webix_tabbar-filter-headline'>"+t+"</span>"}const Fi={view:"tabbar",type:"top",id:"filterPopupTabbar",css:"webix_filter-popup-tabbar",multiview:!0,height:50,options:[{value:Vi("Поля"),id:"editFormScroll"},{value:Vi("Библиотека"),id:"editFormPopupLib"}],on:{onAfterTabClick:function(t){_i(t)}}},Ai={view:"form",id:"editFormPopup",css:"webix_edit-form-popup",borderless:!0,elements:[{rows:[{rows:[Fi,{height:200,cells:[{view:"scrollview",id:"editFormScroll",borderless:!0,css:"webix_multivew-cell",scroll:"y",body:{id:"editFormPopupScroll",rows:[]}},Ti]}]},{height:20},Ci]},{}]},Bi="table/generateTable";let Oi,Pi,Li,ji,Ni,Di,Hi,Ri,zi,Wi;async function Mi(){return await s.content("fields"),c.keys}function qi(t,n,i){ji=t,Li=n,Pi=$$("tree").getItem(Li),Pi||(Pi=Li),null==Pi?Ia("error","Данные не найдены"):(function(){try{if($$(ji).clearAll(),"table-view"==ji){const t=$$("contextActionsPopup");t&&t.destructor(),Va.removeItem($$("contextActionsBtnAdaptive")),Va.removeItem($$("customInputs")),Va.removeItem($$("customInputsMain"))}}catch(t){ka(t,Bi,"preparationTable")}}(),async function(t){let n;if(t||(n=await Mi()),!n&&t&&(n=await Mi()),n){const t=function(t,e){const n=c.item(t),i=n.fields,o=Object.keys(n.fields),r=[];return Oi=$$(e),o.length?(o.forEach((function(t){var e;Ni=i[t],(e=Ni.type).includes("reference")?function(){try{const t=Ni.type.slice(10);Ni.editor="combo",Ni.sort="int",Ni.collection=Fa(t),Ni.template=function(t,e,n,i){const o=t[i.id],r=i.collection.getItem(o);return r?r.value:""}}catch(t){ka(t,Bi,"createReferenceCol")}}():"datetime"==e?function(){try{Ni.format=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s"),Ni.editor="date",Ni.sort="date",Ni.css={"text-align":"right"}}catch(t){ka(t,Bi,"createDatetimeCol")}}():"boolean"==e?function(){try{Ni.editor="combo",Ni.sort="text",Ni.collection=[{id:1,value:"Да"},{id:2,value:"Нет"}]}catch(t){ka(t,Bi,"createBoolCol")}}():"integer"==e||"id"==e?function(){try{Ni.editor="text",Ni.sort="int",Ni.numberFormat="1 111",Ni.css={"text-align":"right"}}catch(t){ka(t,Bi,"createIntegerCol")}}():function(){try{Ni.editor="text",Ni.sort="string"}catch(t){ka(t,Bi,"createTextCol")}}(),function(t){Ni.id=t}(t),function(t){const e=Object.values(t).length,n=($$("tableContainer").$width-17)/e;Ni.width=n}(i),Ni.header=Ni.label,"id"==Ni.id&&function(){const t=webix.storage.local.get("userprefsOtherForm");t&&"2"==t.visibleIdOpt&&(Ni.hidden=!0)}(),Ni.label&&r.push(Ni)})),function(t){Oi&&Oi.refreshColumns(t)}(r),function(t,e){Oi=t;const n=`fields/${e}`;Di=webix.storage.local.get(n),Di&&(Di=Di.columns);const i=Oi.getColumns(!0);Di&&Di.values.length?(function(t){Oa(t,Bi,"setVisibleCols")&&t.forEach((function(t,e){if(function(t){let e=!1;return Oa(Di,Bi,"findUniqueCols")&&Di.values.forEach((function(n){n.column==t&&(e=!0)})),e}(t.id))Oi.isColumnVisible(t.id)||Oi.showColumn(t.id);else{const e=Oi.getColumnIndex(t.id);Oi.isColumnVisible(t.id)&&-1!==e&&Oi.hideColumn(t.id)}}))}(i),Oa(Di,Bi,"setPositionCols")&&Di.values.forEach((function(t){Oi.moveColumn(t.column,t.position)})),function(){const t=function(){let t;return Di&&Di.values.length&&(t=function(){const t=[];return Oa(Di,Bi,"setColsUserSize")&&Di.values.forEach((function(e){t.push(e.width),Oi.setColumnWidth(e.column,e.width)})),t}()),t}().reduce(((t,e)=>+t+ +e),0),e=function(){const t=$$("tree").$width;return window.innerWidth-t}();if(t<e){const n=function(){const t=Oi.getColumns();return t[t.length-1]}(),i=e-t,o=n.width+i;Oi.setColumnWidth(n.id,o)}}()):Oa(i,Bi,"setUserPrefs")&&i.forEach((function(t){!function(t){const e=function(){let t;return t=Di&&Di.values.length?Di.values.length:Oi.getColumns(!0).length,t}(),n=(function(){let t;return t=window.innerWidth-$$("tree").$width-25,t}()-17)/e;Oi.setColumnWidth(t,n)}(t.id)}))}(Oi,t)):ka("array length is null",Bi,"createTableCols"),r}(Li,ji);!function(t,e,n){let i,o,r=!1;const s=c.item(e),a=$$(n);if(Oa(t,"table/createSpace/cols/detailAction","createDetailAction")&&t.forEach((function(t,e){"action"==t.type&&"detail"==s.actions[t.id].rtype&&(r=!0,i=e,o=t.id)})),void 0!==o){const t=s.actions[o].url;r&&(a.config.columns.splice(0,0,{id:"action-first"+i,maxWidth:130,src:t,css:"action-column",label:"Подробнее",header:"Подробнее",template:"<span class='webix_icon wxi-angle-down'></span> "}),a.refreshColumns())}}(t,Li,ji),function(t,n){Zi=t,to=n,Xi=c.item(to),function(){Va.removeItem($$("contextActionsBtn"));const t=$$("viewToolsBtn");if(io=$$("formsTools"),Xi.inputs){const n=function(t,n){Yi=n,Ki=t,Qi=Ki.inputs;const i=[],o=Object.keys(Ki.inputs);return o.length?o.forEach(((t,n)=>{if(Gi=Qi[t],"string"==Gi.type)i.push(function(t){return{view:"text",placeholder:Gi.label,id:"customInputs"+t,height:48,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",Gi.comment),oo(this)},onChange:function(){const t=$$("customInputs").getChildViews();t.length?t.forEach((function(t){const e=t.config.view,n=$$(t.config.id);"button"==e&&Va.enableItem(n)})):ro("createTextInput")}}}}(n));else if("apiselect"==Gi.type)i.push(function(t,n){return{view:"combo",height:48,id:"customCombo"+n,placeholder:Gi.label,labelPosition:"top",options:{data:new webix.DataCollection({url:{$proxy:!0,load:function(){return new e({id:Gi.apiname}).get().then((function(t){if(t){const e=t.content;return e&&e.length?function(t){const e=[];return Oa(t,Bi,"createOptions")&&t.forEach((function(t,n){let i=t;"object"==typeof t&&(i=t.name);const o=function(t,e){return{id:t+1,value:e}}(n,i);e.push(o)})),e}(e):[{id:1,value:""}]}}))}}})},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",Gi.comment),oo(this)}}}}(0,n));else if("submit"==Gi.type||"button"==Gi.type){const t=Gi.action,e=Ki.actions[t];"DELETE"==e.verb&&"submit"!==t?function(t){const e=$$(Yi),n=e.getColumns().length,i=e.config.columns;try{i.splice(n,0,{id:"action"+t,header:"Действие",label:"Действие",css:"action-column",template:"{common.trashIcon()}"}),e.refreshColumns()}catch(t){ka(t,Bi,"generateCustomInputs => createDeleteAction")}}(n):"DELETE"==e.verb?i.push(function(t,e){return new l({config:{id:"customBtnDel"+e,hotkey:"Shift+Q",icon:"icon-trash",value:Gi.label,click:function(){Ji(so(this),t.url,"delete")}},titleAttribute:Gi.comment}).minView("delete")}(e,n)):i.push(function(t,e){const n=new l({config:{id:"customBtn"+e,value:Gi.label,click:function(n){!function(t,e,n,i){const o=so(i),r=$$("contextActionsPopup");"GET"==t.verb?"refresh"==t.rtype?Ji(o,t.url,"get","refresh"):"download"==t.rtype&&Ji(o,t.url,"get","download"):"POST"==t.verb?(Ji(o,t.url,"post"),$$("customBtn"+e).disable()):"download"==t.verb&&Ji(o,t.url,"get","download"),Va.hideItem(r)}(t,e,0,this)}},titleAttribute:Gi.comment,onFunc:{onViewResize:function(){oo(this)}}}).maxView("primary");return n}(e,n))}else"upload"==Gi.type?i.push(function(t){return{view:"uploader",value:"Upload file",id:"customUploader"+t,height:42,autosend:!1,upload:Ki.actions.submit.url,label:Gi.label,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",Gi.comment),oo(this);const t=this.getParentView().getChildViews();t.length?t.forEach((function(t,e){t.config.id.includes("customBtn")&&t.disable()})):ro("createUpload")},onBeforeFileAdd:function(){const t=$$("templateLoad");t&&t.getParentView().removeView(t)},onAfterFileAdd:function(t){const e=this.getParentView().getChildViews();e.length?e.forEach((function(t){t.config.id.includes("customBtn")&&t.enable()})):ro("createUpload")}}}}(n)):"datetime"==Gi.type?i.push(function(t){return{view:"datepicker",format:"%d.%m.%Y %H:%i:%s",placeholder:Gi.label,id:"customDatepicker"+t,timepicker:!0,labelPosition:"top",height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",Gi.comment),oo(this)},onChange:function(){try{const t=$$("customInputs").getChildViews();t.length?t.forEach((function(t,e){const n=$$(t.config.id);"button"!=t.config.view||n.isEnabled()||n.enable()})):ro("createDatepicker")}catch(t){ka(t,Bi,"generateCustomInputs => createDatepicker onChange")}}}}}(n)):"checkbox"==Gi.type&&i.push(function(t){return{view:"checkbox",id:"customСheckbox"+t,css:"webix_checkbox-style",labelRight:Gi.label,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",Gi.comment)},onChange:function(){try{const t=$$("customInputs").getChildViews();t.length?t.forEach((function(t,e){const n=t.config.view,i=$$(t.config.id);"button"!=n||i.isEnabled()||i.enable()})):ro("createCheckbox")}catch(t){ka(t,Bi,"generateCustomInputs => createCheckbox onChange")}}}}}(n))})):ro("generateCustomInputs"),i}(Xi,Zi),i=$$("table-view-filterId").getParentView(),o=new l({config:{id:"viewToolsBtn",hotkey:"Ctrl+Shift+G",icon:"icon-filter",click:function(){Va.hideItem($$("propTableView")),function(){const t=$$("viewTools");eo=document.querySelector(".webix_btn-filter"),eo.classList.contains(lo)?(eo.classList.add(co),eo.classList.remove(lo),Va.hideItem(io),Va.hideItem(no)):eo.classList.contains(co)&&(eo.classList.add(lo),eo.classList.remove(co),Va.showItem(io),Va.showItem(no),Va.showItem(t))}(),function(){no=$$("formsTools-resizer");const t=$$("container").$width;if(eo.classList.contains(co))Va.hideItem(io),Va.hideItem(no),Va.hideItem($$("table-backFormsBtnFilter")),Va.showItem($$("formsContainer"));else{const e=850,n=350;t<e?(Va.hideItem($$("tree")),t<e&&(Va.hideItem($$("formsContainer")),Va.hideItem($$("tree")),Va.showItem($$("table-backFormsBtnFilter")),Va.hideItem(no),io.config.width=window.innerWidth-45,io.resize())):(Va.hideItem($$("table-backFormsBtnFilter")),io.config.width=n,io.resize()),Va.showItem(no)}}()}},css:"webix_btn-filter",titleAttribute:"Показать/скрыть фильтры доступные дейсвтия"}).transparentView();t?Va.showItem(t):i.addView(o,2),function(t){Va.removeItem($$("customInputs"));const e={id:"customInputs",css:"webix_custom-inp",rows:[{height:20},{rows:t}]};try{$$("viewToolsContainer").addView(e,0)}catch(t){ka(t,Bi,"maxInputsSize")}}(n)}else Va.hideItem(io),Va.hideItem(t)}()}(ji,Li),To(ji,Li),function(t,e){try{const n=c.names;Oa(n,Bi,"setTableName")&&n.forEach((function(n){if(n.id==e){const e=$$(t+"-templateHeadline"),i=n.name.toString();e.setValues(i)}}))}catch(t){ka(t,Bi,"setTableName")}}(ji,Li)}}(i))}const Ui=[];function Ji(t,n,i,o){Hi=t,Ri=n,zi=i,Wi=o,Ui.length=0,"get"==zi?"refresh"==Wi?(Oa(Hi,Bi,"createQueryRefresh")&&Hi.forEach((t=>{const e=$$(t.id).getValue();if(t.id.includes("customCombo")){const e=$$(t.id).getText();Ui.push(t.name+"="+e)}else(t.id.includes("customInputs")||t.id.includes("customDatepicker"))&&Ui.push(t.name+"="+e)})),new e({id:`${Ri}?${Ui.join("&")}`,isFullPath:!0}).get().then((function(t){if(t){const e=t.content;if(e){const t=$$("table-view");!function(t,e){const n="Ничего не найдено";try{t.clearAll(),0!==e.length?(t.hideOverlay(n),t.parse(e),Ia("success","Данные обновлены")):t.showOverlay(n)}catch(t){ka(t,Bi,"setTableLoadState")}}(t,e),function(t){try{const e={full:t.count()},n=$$("table-view-findElements"),i=JSON.stringify(e);n.setValues(i)}catch(t){ka(t,Bi,"setTableCounter")}}(t)}}}))):"download"==Wi&&webix.ajax().response("blob").get(Ri,(function(t,e,n){try{webix.html.download(e,"table.docx")}catch(t){ka(t,Bi,"downloadButton")}})).catch((t=>{Ca(t,Bi,"downloadButton")})):"post"==zi&&function(){try{Oa(Hi,Bi,"postButton")&&Hi.forEach(((t,e)=>{if(t.id.includes("customUploader")){const e=$$(t.id).files.data.pull,n=Object.values(e)[0],i=$$(t.id).config.upload;let o=new FormData;!function(t){t.addView({id:"templateLoad",template:function(){const t=$$("templateLoad").getValues();return 0!==Object.keys(t).length?t:"Загрузка ..."},borderless:!0})}($$(t.id).getParentView()),o.append("file",n.file),async function(t,e){fetch(e,{method:"POST",body:t}).then((t=>t.json())).then((function(t){const e=$$("templateLoad");"i"==t.err_type?(e.setValues("Файл загружен"),Ia("success","Файл успешно загружен")):(e.setValues("Ошибка"),Ia("error",t.err))})).catch((function(t){ka(t,Bi,"uploadData")}))}(o,i)}}))}catch(t){ka(t,Bi,"postButton")}}()}let Ki,Yi,Gi,Qi,Xi,Zi,to,eo,no,io;function oo(t){t.getNode().firstElementChild.style.width=t.$width+"px",t.getInputNode().style.width=t.$width-5+"px"}function ro(t){ka("array length is null",Bi,t)}function so(t){const e=t.getParentView().getChildViews(),n=[];return e.length?e.forEach(((t,e)=>{const i=t.config.view,o=t.config.id;void 0!==o&&("text"==i?n.push({id:o,name:"substr"}):"combo"==i?n.push({id:o,name:"valtype"}):"uploader"!=i&&"datepicker"!=i||n.push({id:o}))})):ro("getInputsId"),n}let ao,co="webix-transparent-btn",lo="webix-transparent-btn--primary";const uo=[];function fo(t){uo.length&&uo.forEach((function(t,e){clearInterval(t),uo.splice(e,1)}));const e=_a();if(t.autorefresh){e.config.autorefresh=!0;const n="userprefsOtherForm",i=webix.storage.local.get(n);let o;i&&(o=i.autorefCounterOpt);const r=15e3,s=12e4;i&&void 0!==o&&function(t,e){ao=setInterval((()=>{_a().config.autorefresh?"dbtable"==t?So("table"):"tform"==t&&So("table-view"):clearInterval(ao)}),e),uo.push(ao)}(t.type,o>=r?o:s)}else e.config.autorefresh=!1}let ho,po,mo,bo,go,wo,$o,vo,yo,xo,Io,Co;function So(t){const e=$$(t).config.reccount;e?e-po>0&&Vo(t,ho,mo,po):Vo(t,ho,mo,po)}function To(t,e,n=0){const i=c.item(e);var o;ho=t,po=n,mo=e,"dbtable"==(o=i.type)?So("table"):"tform"==o&&So("table-view"),fo(i)}function ko(t){const e=function(){const t=[],e=bo.getColumns(!0);return Oa(e,Bi,"getBoolFieldNames")&&e.forEach((function(n){(function(t,e){const n=function(t){const e=[];return Oa(t,Bi,"findBoolColumns")&&t.forEach((function(t,n){"boolean"==t.type&&e.push(t.id)})),e}(t);let i=!1;return Oa(n,Bi,"isBoolField")&&n.forEach((function(t,n){t==e&&(i=!0)})),i})(e,n.id)&&t.push(n.id)})),t}();Oa(e,Bi,"setBoolValues")&&e.forEach((function(e){void 0!==t[e]&&(0==t[e]?t[e]=2:t[e]=1)}))}function Eo(t){yo=$$(go),wo||yo.clearAll(),function(t,e){bo=t,Oa(e,Bi,"formattingBoolVals")&&e.forEach((function(t,e){ko(t)}))}(yo,t),function(t,e){const n=function(t){const e=[];return Oa(t,Bi,"findDateCols")&&t.forEach((function(t,n){"datetime"==t.type&&e.push(t.id)})),e}($$(t).getColumns());Oa(n,Bi,"formattingDateVals")&&n.forEach((function(t,n){!function(t,e){Oa(t,Bi,"changeDateFormat")&&t.forEach((function(t){if(t[e]){const n=new Date(t[e]);t[e]=n}}))}(e,t)}))}(yo,t),function(t){Oa(t,Bi,"setDefaultValues")&&t.forEach((function(t){!function(t){const e=_a().getColumns(!0);Oa(e,Bi,"returnValue")&&e.forEach((function(e){const n=Ht(e),i=t[e.id];(function(t){if(t)return t.toString().length})(n)&&!i&&(t[e.id]=Ht(e))}))}(t)}))}(t),wo?function(t){Oa(t,Bi,"changePart")&&t.forEach((function(t){!function(t){const e=yo.data.pull,n=Object.values(e);Oa(n,Bi,"checkNotUnique")&&n.forEach((function(e){e.id==t&&yo.remove(e.id)}))}(t.id),yo.add(t)}))}(t):function(t){const e="Ничего не найдено";0!==t.length?(yo.hideOverlay(e),yo.parse(t)):(yo.showOverlay(e),yo.clearAll()),setTimeout((()=>{!function(){const t=$$("table-view-visibleCols"),e=$$("table-visibleCols");t.isVisible()?Va.enableItem(t):e.isVisible()&&Va.enableItem(e)}()}),1e3)}(t)}function _o(){const t={full:"-"}.toString();try{$$(go).showOverlay("Ничего не найдено"),$$(vo).setValues(JSON.stringify(t)),Va.disableItem($$("table-newAddBtnId")),Va.disableItem($$("table-filterId")),Va.disableItem($$("table-exportBtn"))}catch(t){ka(t,Bi,"tableErrorState")}}async function Vo(t,n,i,o){const r=$$(t);go=n,wo=o,$o=i,vo=go+"-findElements";const s=await async function(t){const e=t.config.filter,n={prefs:!0};if(!n.filter)if(n.prefs=!1,e&&e.table===$o){n.filter=e.query;const i=t.config.id+"_applyNotify";Va.showItem($$(i))}else n.filter=$o+".id+%3E%3D+0";return n}(r),a=s.prefs,c=s.filter;wo||function(){const t=webix.storage.local.get("tableSortData");t&&(_a().config.sort={idCol:t.idCol,type:t.type})}();const l=function(t){let e;const n=t.getColumns()[0].id,i=t.config.sort.idCol,o=t.config.sort.type;return i?(e="desc"==o?"~"+$o+"."+i:$o+"."+i,t.markSorting(i,o)):(e=$o+"."+n,t.markSorting(n,"asc")),e}(r),u=["query="+c,"sorts="+l,"limit=80","offset="+wo];r.load({$proxy:!0,load:function(){const n=function(t,e){let n;return n="table"==t.config.id?`smarts?${e.join("&")}`:$o,n}(r,u);new e({id:n,isFullPath:!1,errorActions:_o}).get().then((function(e){if(e){const n=e.reccount?e.reccount:e.content.length,i=e.content;!function(t,e,n){const i=t.config.id;wo||"table"!=i||(t.config.reccount=e.reccount,t.config.idTable=$o,t.config.limitLoad=80),"table-view"==i&&(t.config.idTable=$o,t.config.reccount=e.content?e.content.length:null)}(r,e),i&&(function(t){"table"==t&&(Va.enableItem($$("table-newAddBtnId")),Va.enableItem($$("table-filterId")),Va.enableItem($$("table-exportBtn")))}(t),Eo(i),wo||(function(){const t=Fo("id"),e=_a();e&&e.exists(t)?e.select(t):la.linkParam(!1,"id")}(),function(){if(function(){if("edit"==Fo("view"))return!0}()&&$$("table-editTableBtnId").callEvent("clickEvent",[""]),!function(){if("filter"==Fo("view"))return!0}()){const t=webix.storage.local.get("editFormTempData");if(t){xo=$$("editTableFormProperty"),Io=$$("table-editForm");const e=$$("table"),n=e.config.idTable,i=t.values,o=t.table,r=t.status;if(n==o)if(Va.hideItem($$("filterTableForm")),function(t){const e=la.tabs.getInfo();e&&(e.temp||(e.temp={}),e.temp.edit||(e.temp.edit={}),e.temp.edit.values=t,"put"==t.status&&(e.temp.edit.selected=t.values.id),la.tabs.setInfo(e))}(t),"put"===r){const t=i.id;e.exists(t)&&function(t){return t==Fo("id")}(t)&&(e.select(t),Ao(i))}else"post"===r&&(Va.showItem(Io),la.tables.editForm.postState(),Ao(i))}}la.tabs.setDirtyParam(),la.tabs.getInfo().isClose&&la.getGlobalModalBox().then((function(t){if(t){const t=$$("globalTabbar"),e=t.getValue();t.removeOption(e)}}))}(),function(t){const e=window.location.search;if("filter"==new URLSearchParams(e).get("view")){const e=webix.storage.local.get("currFilterState");if(Va.hideItem($$("table-editForm")),$$("table-filterId").callEvent("clickEvent",[""]),e){const n=e.activeTemplate;He.setActiveTemplate(n),function(t){if(t&&t.values.values.length)return!0}(e)&&t==e.id&&(mi(e.values.values),function(){const t=$$("inputsFilter").getChildViews();t&&t.length?t.forEach((function(t){const e=t.getNode();e.classList.contains("webix_show-content")||He.addClass(e,"webix_hide-content")})):ka("array length is null","table/createSpace/returnLostFilter","hideHtmlContainers")}(),He.enableSubmitButton()),n&&Va.hideItem($$("templateInfo")),He.setStateToStorage()}}}($o),a&&function(t){He.clearFilter(),He.clearAll(),Co=function(t){const e=t.split(" "),n=[];let i="",o=0;return Oa(e,Bi,"returnConditions")&&e.forEach((function(t,r){const s=e.length;s-1===r&&(i+=" "+t,o++),(o>=4||s-1===r)&&(n.push(i),i="",o=0),o<4&&(i+=" "+t,o++)})),n}(t),function(){const t=[];if(Oa(Co,Bi,"iterateConditions")){Co.forEach((function(e){const n=e.split(" ");!function(t){const e=function(t){const e=t.lastIndexOf(".");return t.slice(e+1)}(t[1]);let n=e+"_filter";$$(n).isVisible()?n=Xn(_a().getColumnConfig(e)):He.setFieldState(1,e),function(t,e){(function(t,e){e&&$$(t+"-btnFilterOperations").setValue(e)})(t,e[2]),function(t,e){if(e){const n=e.replace(/['"]+/g,"");$$(t).setValue(n)}}(t,e[3]),function(t,e){if(e&&"or"==e){const e=2;$$(t+"_segmentBtn").setValue(e)}}(t,e[4])}(n,t)}(n),t.push(n[1])}));const e=function(t){const e=[];return Oa(t,Bi,"returInputsId")&&t.forEach((function(t,n){const i=t.lastIndexOf(".")+1;e.push(t.slice(i))})),e}(t);He.hideInputsContainers(e)}}(),function(){const t=He.getIndexFilters(),e=(i=function(t){const e=[];if(Oa(t,Bi,"returnCurrIndexes")){const n=He.getItems(),i=Object.keys(t);i.length?i.forEach((function(i){(function(t,e){return t.find((t=>t==e))})(n,i)&&e.push(t[i])})):ka("array length is null",Bi,"returnCurrIndexes")}return e}(t),Math.max.apply(Math,i)),n=function(t){const e=He.getItem(t);return e[e.length-1]}(function(t,e){let n;return Object.values(t).find((function(i,o){i==e&&(n=Object.keys(t)[o])})),n}(t,e));var i;Va.hideItem($$(n+"_segmentBtn"))}(),Va.enableItem($$("btnFilterSubmit")),He.setStateToStorage()}(c)),function(t,e){const n=$$(e);try{const e={full:t,visible:n.count()};$$(vo).setValues(JSON.stringify(e))}catch(t){ka(t,Bi,"setCounterVal")}}(n,r))}}))}})}function Fo(t){const e=window.location.search;return new URLSearchParams(e).get(t)}function Ao(t){xo.setValues(t),Io.setDirty(!0)}const Bo="table/columnsSettings";function Oo(t,e){return{view:"scrollview",css:"webix_multivew-cell",borderless:!0,scroll:!1,body:{id:t,rows:e}}}let Po,Lo,jo,No,Do,Ho,Ro,zo;function Wo(){ka("array length is null",Bo,"returnPosition")}function Mo(){const t=Po.getColumns(!0);try{t.length?t.forEach((function(e,n){const i=function(){const t=$$("tree").$width;return((window.innerWidth-t-77)/Po.getColumns(!0).length).toFixed(2)}(),o=function(t){let e;const n=Po.data.pull[1];if(n){const i=Object.keys(n);i.length?i.forEach((function(n,i){n==t&&(e=i)})):Wo()}return e}(e.id);(function(t,e){const n=function(){const t=_a().config.id;return"table"==t?$$("tableContainer"):"table-view"==t?$$("formsContainer"):void 0}(),i=_a(),o=e.length,r=(n.$width-17)/o;i.setColumnWidth(t,r),i.setColumnWidth("action0",400)})(e.id,t),Po.isColumnVisible(e.id)||Po.showColumn(e.id),Po.setColumnWidth(e.id,i),Lo.push({column:e.id,position:o,width:i})})):Wo()}catch(t){ka(t,Bo,"clearBtnColsClick / showCols")}}function qo(t,e){return{css:"list-filter-empty",rows:[jt(e,t)]}}function Uo(t,e){const n=t.getNextId(e);n&&t.select(n)}function Jo(t,e){Object.keys(t.data.pull).length||Va.showItem($$(e))}function Ko(){const t="visibleColsEmptyTempalte",e=[{template:"Доступные колонки",css:"list-filter-headline",height:25,borderless:!0},qo(t,"Нет доступных колонок"),{view:"list",id:"visibleList",template:"#label#",select:!0,css:"list-filter-borders",borderless:!0,data:[],on:{onAfterAdd:function(){Va.enableItem($$("addColsBtn")),Va.hideItem($$(t))},onAfterDelete:function(e){Jo(this,t),Uo(this,e)}}}];return e}function Yo(){const t="visibleColsEmptyTempalteSelected",e=[{template:"Выбранные колонки",css:"list-filter-headline",height:25,borderless:!0},qo(t,"Выберите колонки из доступных"),{view:"list",id:"visibleListSelected",template:"#label#",css:"list-filter-borders",select:!0,borderless:!0,data:[],on:{onAfterAdd:function(){Va.enableItem($$("removeColsBtn")),Va.hideItem($$(t))},onAfterDelete:function(e){Jo(this,t),Uo(this,e)}}}];return e}function Go(){$$("visibleColsMsg")||webix.message({id:"visibleColsMsg",type:"debug",text:"Элемент не выбран"})}function Qo(t){return Object.keys(t.data.pull).length}function Xo(t){const e="available"==t?jo:No,n="available"==t?No:jo,i=$$("visibleColsSubmit"),o=e.getSelectedItem(),r=e.getSelectedId();o?(n.add(o),e.remove(r),"available"==t?Qo(n)?Va.enableItem(i):Va.disableItem(i):Qo(e)?Va.enableItem(i):Va.disableItem(i)):Go()}function Zo(t){jo=$$("visibleList"),No=$$("visibleListSelected"),"add"==t?Xo("available"):"remove"==t&&Xo("selected")}function tr(t){const e=$$("visibleColsSubmit"),n=e.isEnabled();"enable"!=t||n?"disable"==t&&n&&e.disable():e.enable()}function er(t){const e=$$("visibleListSelected"),n=e.getSelectedId();n?"up"==t?(e.moveUp(n,1),tr("enable")):"down"==t&&(e.moveDown(n,1),tr("enable")):Go()}function nr(t,e){return(e/t.getColumns(!0).length).toFixed(2)}function ir(){const t=new l({config:{id:"visibleColsSubmit",hotkey:"Shift+S",disabled:!0,value:"Сохранить состояние",click:function(){!function(){const t=$$("visibleListSelected"),e=t.data.pull,n=Object.values(e),i=[],o=_a(),r=window.innerWidth-$$("tree").$width-77;try{const e=[],s={};n.length?(n.forEach((function(n){const a=t.getIndexById(n.id),c=t.getLastId();let l;n.id!==c?(l=o.getColumnConfig(n.column).width,l>=r&&(l=nr()),e.push(l),i.push({column:n.column,position:a,width:Number(l)})):(s.column=n.column,s.position=a)})),function(t,e){const n=e.reduce(((t,e)=>t+e),0);let s=r-n;s<50&&(s=nr(o,r)),t.width=Number(s),i.push(t)}(s,e)):ka("array length is null",Bo,"visibleColsSubmitClick")}catch(t){ka(t,Bo,"visibleColsSubmitClick")}lr(i,!0)}()}},titleAttribute:"Изменить отображение колонок в таблице"}).maxView("primary");return t}function or(){const t={view:"search",id:"searchColsList",placeholder:"Поиск (Alt+Shift+F)",css:"searchTable",height:42,hotkey:"alt+shift+f",on:{onTimedKeyPress:function(){!function(){const t=$$("visibleList"),e=$$("searchColsList").getValue().toLowerCase(),n=$$("visibleColsEmptyTempalte");let i=0;try{t.filter((function(t){const n=-1!==t.label.toLowerCase().indexOf(e);return n&&i++,n})),0==i?Va.showItem(n):Va.hideItem(n)}catch(t){ka(t,Bo,"searchColsListPress")}}()}}};return t}function rr(t){t.attachEvent("onColumnResize",(function(e,n,i,o){if(o){const e=t.getColumns(),n=[];e.length?(e.forEach((function(e){n.push({column:e.id,position:t.getColumnIndex(e.id),width:e.width.toFixed(2)})})),lr(n)):ka("array length is null","table/columnsSettings/columnsWidtn","visibleColsSubmitClick")}}))}function sr(t){t.attachEvent("onAfterColumnDrop",(function(){const e=function(t){const e=t.getColumns(),n=[];return e.length?e.forEach((function(t,e){n.push({column:t.id,position:e,width:Number(t.width)})})):ka("array length is null","table/columnsSettings/onAfterColumnDrop","visibleColsSubmitClick"),n}(t);lr(e,!1,!1)}))}function ar(t){const e=_a();(function(t,e){const n=e.getColumns(!0);try{n.length?n.forEach((function(n){if(function(t,e){let n=!1;return Oa(t,Bo,"findUniqueCols")&&t.values.forEach((function(t){t.column==e&&(n=!0)})),n}(t,n.id))e.isColumnVisible(n.id)||e.showColumn(n.id);else{const t=e.getColumnIndex(n.id);e.isColumnVisible(n.id)&&-1!==t&&e.hideColumn(n.id)}})):ka("array length is null",Bo,"setVisibleState")}catch(t){ka(t,Bo,"setVisibleState")}})(t,e),function(t,e){Oa(t.values,Bo,"moveListItem")&&t.values.forEach((function(t){e.moveColumn(t.column,t.position)}))}(t,e)}function cr(t,n){const i=Ea(),o=`userprefs.name+=+%27fields/${i}%27`,r=`userprefs.owner+=+${Ho.id}`;new e({id:`smarts?query=${o}+and+${r}&limit=80&offset=0`}).get().then((function(o){if(o){const r=o.content;if(r&&r.length){const i=r[0];if(i){const o=JSON.parse(i.prefs);o&&(o.columns=t,i.prefs=o),function(t,n,i){const o=t.prefs,r=Ea();new e({id:`userprefs/${n}`}).put(t).then((function(e){e&&e.content&&(Ia("success","Рабочая область таблицы обновлена"),fa("visibleColsPrefs_"+r,JSON.stringify(t.prefs)),Do&&ar(o.columns),i&&function(t){const e=_a();if(t&&t.columns){const n=t.columns.values;Oa(n,Bo,"setSize")&&n.forEach((function(t){!function(t){e.eachColumn((function(n){t.column==n&&e.setColumnWidth(n,t.width)}),!0)}(t)}))}}(o))})),Va.destructItem($$("popupVisibleCols"))}(i,i.id,n)}}else!function(t){const n=t.prefs,i=Ea();new e({id:"userprefs"}).post(t).then((function(e){e&&e.content&&(Ia("success","Рабочая область таблицы обновлена"),fa("visibleColsPrefs_"+i,JSON.stringify(t.prefs)),Do&&ar(n.columns))})),Va.destructItem($$("popupVisibleCols"))}({name:`fields/${i}`,owner:Ho.id,prefs:{columns:t}})}}))}async function lr(t,e=!1,n=!0){Do=n,Ho=await Ba(),cr({values:t,tableIdPrefs:Ea()},e)}function ur(t){return Ro[zo-t]}function fr(t){t.attachEvent("onColumnResize",(function(e,n,i,o){if(Ro=t.getColumns(),zo=Ro.length,o){ur(2),function(t){const e=ur(1),n=t.$width-17,i=function(){let t=0;return Ro&&Ro.length&&Ro.forEach((function(e){t+=e.width})),t}();if(i<n&&e){const o=n-i,r=e.width+o;t.setColumnWidth(e.id,r)}}(t)}}))}const dr="table/tableElement";const hr={id:"viewTools",padding:10,rows:[{cols:[{template:"Действия",height:30,css:"popup_headline",borderless:!0},{},{view:"button",id:"table-backFormsBtnFilter",type:"icon",icon:"icon-arrow-right",value:"Вернуться к таблице",height:28,minWidth:50,width:55,click:function(){!function(){const t=$$("formsTools"),e=$$("formsContainer"),n=$$("formsTools-resizer");t&&t.isVisible()&&(t.hide(),n.hide()),e&&!e.isVisible()&&e.show()}(),function(){const t=document.querySelector(".webix_btn-filter"),e="webix-transparent-btn--primary";t.classList.contains(e)&&(t.classList.add("webix-transparent-btn"),t.classList.remove(e))}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Вернуться к таблице")}}}]},{id:"viewToolsContainer",rows:[{}]}]};function pr(t){new u({headline:"Видимость колонок",config:{id:"popupVisibleCols",width:600,maxHeight:400},elements:{rows:[{cols:[{rows:[or(),Oo("listContent",Ko())]},{width:10},{rows:[{height:45},{},{rows:[new l({config:{id:"addColsBtn",hotkey:"Shift+A",icon:"icon-arrow-right",disabled:!0,click:function(){Zo("add")}},titleAttribute:"Добавить выбранные колонки"}).transparentView(),new l({config:{id:"removeColsBtn",hotkey:"Shift+D",icon:"icon-arrow-left",disabled:!0,click:function(){Zo("remove")}},titleAttribute:"Убрать выбранные колонки"}).transparentView()]},{}]},{width:10},{rows:[{cols:[{cols:[new l({config:{id:"moveSelctedUp",hotkey:"Shift+U",icon:"icon-arrow-up",click:function(){er("up")}},titleAttribute:"Поднять выбраную колонку вверх"}).transparentView(),new l({config:{id:"moveSelctedDown",hotkey:"Shift+W",icon:"icon-arrow-down",click:function(){er("down")}},titleAttribute:"Опустить выбраную колонку вниз"}).transparentView(),{}]},new l({config:{id:"clearBtnCols",hotkey:"Alt+Shift+R",icon:"icon-trash",click:function(){Po=_a(),Lo=[],Lt("Будут установлены стандартные настройки","Вы уверены?",["Отмена","Сохранить изменения"]).then((function(t){1==t&&(Mo(),lr(Lo),Va.destructItem($$("popupVisibleCols")),Ia("success","Рабочая область таблицы обновлена"))}))}},css:"webix-trash-btn-color",titleAttribute:"Установить стандартные настройки"}).transparentView()]},Oo("listSelectedContent",Yo())]}]},{height:20},ir()]}}).createView(),function(t){const e=$$(t);let n=e.getColumns(!0);try{n=e.getColumns(!0);const t=_.sortBy(n,"label");t.length&&t.forEach((function(t){"action-column"===t.css||t.hiddenCustomAttr||$$("visibleList").add({column:t.id,label:t.label})}))}catch(t){ka(t,dr,"getCheckboxArray")}}(t),Va.hideItem($$("visibleColsEmptyTempalte")),Va.showItem($$("popupVisibleCols")),function(){const t=_a(),e=$$("visibleList"),n=Object.values(e.data.pull),i=t.getColumns();n.length&&(n&&n.length&&n.forEach((function(t){(function(t){let e=!1;return i.length&&i.forEach((function(n,i){t==n.id&&(e=!0)})),e})(t.column)&&e.remove(t.id)})),function(){const t=$$("visibleListSelected"),e=$$("visibleColsEmptyTempalteSelected");i.length&&Va.hideItem(e),i&&i.length&&i.forEach((function(e){t.add({column:e.id,label:e.label})}))}())}()}function mr(t){return new l({config:{id:t+"-visibleCols",hotkey:"Ctrl+Shift+A",disabled:!0,icon:"icon-columns",click:function(){pr(t)}},titleAttribute:"Показать/скрыть колонки"}).transparentView()}function br(t,e){return new l({config:{id:t+"-filterId",hotkey:"Ctrl+Shift+F",disabled:!0,hidden:e,icon:"icon-filter",click:function(){this.callEvent("clickEvent",[""])},on:{clickEvent:function(){di(t)}}},css:"webix_btn-filter",titleAttribute:"Показать/скрыть фильтры"}).transparentView()}function gr(t,e){const n=new l({config:{id:t+"-exportBtn",hotkey:"Ctrl+Shift+Y",hidden:e,icon:"icon-arrow-circle-down",click:function(){!function(t){try{webix.toExcel(t,{filename:"Table",filterHTML:!0,styles:!0}),Ia("success","Таблица сохранена")}catch(t){ka(t,"toolbarTable","exportToExcel")}}(t)}},titleAttribute:"Экспорт таблицы"}).transparentView();return n}function wr(t,e){function n(t=!0){const e="<span class='webix_icon icon-pencil btn-edit-icon-toolbar'></span>";return t?e:e+"<span style='padding-left: 5px; font-size:13px!important; margin-right: 11px;' >Редактор записи</span>"}return new l({config:{id:t+"-editTableBtnId",hotkey:"Ctrl+Shift+X",value:n(!1),hidden:e,minWidth:40,maxWidth:200,onlyIcon:!1,click:function(){this.callEvent("clickEvent",[""])},on:{clickEvent:function(){!function(){const t=$$("table-editForm"),e=$$("table-backTableBtn"),n=$$("tree"),i=$$("table"),o=$$("container");!function(){const e=$$("editTableBarContainer"),n=$$("filterTableBarContainer"),o=$$("filterTableForm"),r=t.isVisible();Va.hideItem(n),Va.hideItem(o),function(){const t=document.querySelector(".webix_btn-filter");try{t.classList.add("webix-transparent-btn"),t.classList.remove("webix-transparent-btn--primary")}catch(t){ka(t,dr,"setSecondaryState")}}(),t&&r?(la.tables.editForm.defaultState(),Va.hideItem(t),Va.hideItem(e),la.linkParam(!1,"view"),la.linkParam(!1,"id"),la.tabs.clearTemp("editFormTempData","edit"),i.unselectAll()):t&&!r&&(Va.showItem(t),Va.showItem(e),Va.hideItem($$("tablePropBtnsSpace")),function(){if(new URLSearchParams(window.location.search).get("id"))return!0}()||la.linkParam(!0,{view:"edit"}),la.tabs.clearTemp("currFilterState","filter"))}(),o.$width<850?(Va.hideItem(n),o.$width<850&&function(){const i=$$("tableContainer");Va.hideItem(i),Va.hideItem(n),Va.showItem(e),t.config.width=window.innerWidth-45,t.resize()}()):Va.hideItem(e)}()}}},css:"edit-btn-icon",titleAttribute:"Показать/скрыть фильтры",adaptValue:n()}).maxView()}function $r(t,e){const n={view:"template",id:t,css:"webix_style-template-count",height:30,template:function(){const n=$$(t).getValues();if(Object.keys(n).length){const t=_a(),i=JSON.parse(n),o=i.full?i.full:t.config.reccount,r=i.visible?i.visible:t.count();return"<div style='color:#999898;'>"+e+": "+r+" / "+o+" </div>"}return""}};return n}function vr(t){return{cols:[{template:"Фильтры применены",id:t+"_applyNotify",hidden:!0,css:"applyNotify",inputHeigth:20,width:160,borderless:!0},{}]}}function yr(t,e=!1){const n=t+"-findElements";return{rows:[T(t+"-templateHeadline"),{css:"webix_filterBar",id:t+"_toolbarBtns",padding:{bottom:4},height:40,cols:[br(t,e),wr(t,e),vr(t),{},mr(t),gr(t,e)]},{cols:[$r(n,"Количество записей")]}]}}function xr(t,n){const i=function(t){let e;try{const n=t.row,i=$$("table-view").getColumns();i&&i.length&&i.forEach((function(i,o){if(i.id==t.column){e=i.src;let t=e.search("{");e=e.slice(0,t)+n+".json"}}))}catch(t){ka(t,dr,"createUrl")}return e}(n);new e({id:i,isFullPath:!0}).get().then((function(e){if(e){const n=e.content;n&&n.length&&(function(t,e){const n=[];e&&e.length&&(e.forEach((function(t,e){n.push({type:"text",id:e+1,label:t.name,value:t.value})})),t.define("elements",n))}(t,n),function(t){!function(){const t=document.querySelector(".webix_btn-filter"),e="webix-transparent-btn--primary";Va.hideItem($$("formsTools")),t.classList.contains(e)&&(t.classList.add("webix-transparent-btn"),t.classList.remove(e))}(),Va.showItem(t)}(t),function(t){try{t.config.width<200&&(t.config.width=200,t.resize())}catch(t){ka(t,dr,"resizeProp")}}(t))}}))}function Ir(t){const e=t.config.idTable,n=t.config.offsetAttr,i=n+80;t.config.offsetAttr=i,t.refresh(),To("table",e,n)}function Cr(t){t.attachEvent("onResize",(function(e){const n=t.getColumns();e-=17;let i=0;if(n&&n.length&&(n.forEach((function(t){i+=t.width})),i<e)){const o=e-i,r=n.length-1;n.forEach((function(e,n){if(n==r){const n=e.width+o;t.setColumnWidth(e.id,n)}}))}}))}const Sr={onBeforeLoad:function(){this.showOverlay("Загрузка...")},onBeforeEditStop:function(t,e){const n=$$("table");try{if(t.value!=t.old){const i=e.row,o=e.column,r=t.value,s=this.getItem(e.row),a=s[e.column];s[e.column]=r,$$("editTableFormProperty").setValues(s),n.updateItem(i,{[o]:a}),la.tables.editForm.put(!1)}}catch(t){ka(t,dr,"onBeforeEditStop")}},onBeforeSelect:function(t){const e=$$("table"),n=t.id;function i(){$$("table-editForm").setDirty(!1),e.select(t.id)}const o="table-editForm";if($$(o).isDirty())return function(){try{Lt().then((function(n){const o=$$("table-saveBtn"),r=la.tables.editForm;1==n?(la.tables.editForm.defaultState(),e.select(t.id)):2==n&&(o.isVisible()?r.put(!1).then((function(t){t&&i()})):r.post(!1).then((function(t){t&&i()})))}))}catch(t){ka(t,dr,"onBeforeSelect => modalBoxTable")}}(),!1;_e(o),function(t){const e=$$("table").getItem(t);be.putState(),function(){const t=webix.Date.dateToStr("%d.%m.%y %H:%i:%s");if(e){const n=Object.values(e);if(n.length)try{n.forEach((function(n,i){if(n instanceof Date){const o=Object.keys(e)[i],r=t(n);e[o]=r}}))}catch(t){ka(t,dr,"setViewDate")}}}(),$$("editTableFormProperty").setValues(e)}(n)},onAfterSelect:function(t){la.linkParam(!0,{id:t.id})},onAfterUnSelect:function(){la.linkParam(!1,"id")},onAfterLoad:function(){try{this.hideOverlay(),function(){const t=$$("editTableFormProperty");try{!function(){const t=$$("table-saveBtn"),e=$$("table-saveNewBtn"),n=$$("table-delBtnId");e.isVisible()?e.hide():t.isVisible()&&t.hide(),n.disable()}(),t&&(t.clear(),t.hide()),Va.showItem($$("EditEmptyTempalte")),function(){const t=$$("propertyRefbtnsContainer"),e=$$("propertyRefbtns");t&&e.removeView(t)}()}catch(t){ka(t,Nt,"defaultStateForm")}}()}catch(t){ka(t,dr,"onAfterLoad")}},onAfterDelete:function(){!function(){const t=_a().config.id,e=$$(t);e.count()?e.hideOverlay():e.showOverlay("Ничего не найдено")}()},onAfterAdd:function(){this.hideOverlay()},onHeaderClick:function(t){const e=this.getColumns(),n=t.column,i=this.getColumnConfig(n),o=this;if(e&&e.length){const t=e.length-1;let r;if(e.forEach((function(t,e){t.id==n&&(r=e)})),t==r&&!$$("resizeLastCol")){const t=i.width?i.width:0;webix.prompt({title:"Размер последней колонки",ok:"Применить",cancel:"Отменить",css:"webix_prompt-filter-lib",input:{required:!0,placeholder:"Введите число...",value:Math.round(t)},width:350}).then((function(t){var e;t&&(isNaN(+t)?ka("Нельзя изменить размер колонки. «"+t+"» – не является числом",dr,"last column resize"):(e=t,o.setColumnWidth(n,e)))}))}}}};function Tr(t,n,i=!1){return{view:"datatable",id:t,css:"webix_table-style webix_header_border webix_data_border ",autoConfig:!0,editable:i,editaction:"dblclick",minHeight:350,dragColumn:!0,footer:!0,select:!0,resizeColumn:!0,sort:[],offsetAttr:80,on:n,onClick:{"wxi-trash":function(n,i,o){!function(t,n){Pt("Запись будет удалена").then((function(i){i&&function(){const i=$$(n),o=i.getItem(t.row),r=Ea();new e({id:`${r}/${o.name}`}).del(o).then((function(t){if(t){const t=i.getSelectedId();i.remove(t),Ia("success","Данные успешно удалены")}}))}()}))}(i,t)},"wxi-angle-down":function(t,e,n){!function(t){const e=$$("propTableView");e.isVisible()?Va.hideItem(e):xr(e,t)}(e)}},ready:function(){this.getColumns()[0]}}}const kr={id:"tableContainer",rows:[yr("table"),{view:"resizer",class:"webix_resizers"},Tr("table",Sr,!0)]},Er={view:"scrollview",body:{view:"flexlayout",cols:[Tr("table-view")]}},_r={view:"resizer",id:"formsTools-resizer",hidden:!0,class:"webix_resizers"},Vr={id:"formsContainer",rows:[yr("table-view",!0),{view:"resizer",class:"webix_resizers"},Er]},Fr={id:"formsTools",hidden:!0,minWidth:190,rows:[hr]},Ar="treeEdit";let Br,Or,Pr,Lr,jr,Nr,Dr,Hr;class Rr{constructor(){this.combo=$$("editTreeCombo"),this.comboData=this.combo.getPopup().getList(),this.pull=Object.values(this.comboData.data.pull)}static returnCombo(){return $$("editTreeCombo")}static returnComboData(){return this.returnCombo().getPopup().getList()}static returnPullValues(){const t=this.returnComboData();return Object.values(t.data.pull)}static add(t){const e=this.returnComboData(),n=this.returnPullValues();n&&n.length&&n.forEach((function(n,i){n.id!==t.id&&e.parse(t)}))}static rename(t){const e=this.returnComboData(),n=this.returnPullValues();n&&n.length&&n.forEach((function(n){n.id==t.id&&e.parse(t)}))}static remove(t){const e=this.returnComboData(),n=this.returnPullValues(),i=function(t){const e=[t];return Hr.data.eachSubItem(t,(function(t){e.push(t.id)})),e}(t.id);i&&i.length&&i.forEach((function(t){(function(t){let e=!1;return n&&n.length&&n.forEach((function(n){n.id==t&&(e=!0)})),e})(t)&&e.remove(t)}))}}const zr="tree_disabled-item";function Wr(t,e){if(Hr){const n=Hr.data.pull;if(n){const i=Object.values(n);i&&i.length&&i.forEach((function(n){if("remove"==t)Hr.removeCss(n.id,zr);else if("add"==t&&e){const t=e.find((t=>t==n.id));t||Hr.addCss(n.id,zr)}}))}}}function Mr(t){const e=Hr.getParentId(t);return e&&Hr.getParentId(e)?(Hr.open(e),Mr(e)):(Hr.open(t),Hr.open(e)),t}function qr(){Hr=$$("treeEdit"),Wr("remove");const t=$$("editTreeForm").getValues(),e=t.parents,n=t.owners;let i;e&&"111"!==e&&(i=function(t){let e;if(Hr.exists(t)){e=Mr(t),Hr.showItem(t),Hr.open(t);const n=function(t){const e=[t];return Hr.data.eachSubItem(t,(function(t){e.push(t.id)})),e}(t);Wr("add",n)}return e}(e)),n&&"111"!==n&&function(t,e){const n=Hr.data.pull,i=Object.values(n),o=[];if(e){const n=function(t){const e=[t];return Hr.data.eachSubItem(t,(function(t){e.push(t.id)})),e}(e);n&&n.length&&(n.forEach((function(e,n){Hr.getItem(e).owner==t&&o.push(e)})),Wr("add",o))}else i&&i.length&&i.forEach((function(e){const n=e.owner;n&&n==t&&o.push(e.id)}));Wr("add",o),function(t){const e=t[t.length-1];Hr.showItem(e)}(o),o&&o.length&&o.forEach((function(t){Mr(t)}))}(n,i)}let Ur,Jr;function Kr(t){return{id:t.id,value:t.name,owner:t.owner,pid:t.pid,data:[]}}function Yr(){const t={view:"edittree",id:"treeEdit",editable:!0,editor:"text",editValue:"value",css:"webix_tree-edit",editaction:"dblclick",data:[],on:{onAfterEditStop:function(t,n){!function(t,n){if(t.value!=t.old){const i=$$("treeEdit").getParentId(n.id),o={name:t.value,pid:i,id:n.id,owner:null,descr:"",ttype:1,value:"",cdt:null};new e({id:`trees/${n.id}`}).put(o).then((function(t){t&&Ia("success","Данные изменены")}))}}(t,n)}}};return t}async function Gr(){if(Jr=$$("cp-form"),Jr&&Jr.validate()){const t=function(){const t=Jr.getValues();return{op:t.oldPass,np:t.newPass}}();return await new e({id:"cp"}).post(t).then((function(t){if(t)return t.err&&Ia("success",t.err),Jr.clear(),Jr.setDirty(!1),!0}))}return!1}function Qr(t){const e="display:inline-block; font-size:13px!important; font-weight:600;";return"<div style='"+e+"color:var(--primary);'>Имя пользователя:</div>⠀<div style=' "+e+" '>"+t+"<div>"}webix.UIManager.addHotKey("Ctrl+Shift+E",(function(){Backbone.history.navigate("experimental/treeEdit",{trigger:!0})}));const Xr={view:"template",id:"authName",css:"webix_userprefs-info",height:50,borderless:!0,template:function(){const t=$$("authName").getValues();return 0!==Object.keys(t).length?Qr(t):Qr("не указано")}};function Zr(t,e){return{view:"text",width:300,labelPosition:"top",type:"password",name:e,label:t,on:{onChange:function(){$$("cp-form").setDirty(!0)}}}}const ts=new l({config:{hotkey:"Shift+Space",value:"Сменить пароль",click:Gr},titleAttribute:"Изменить пароль"}).maxView("primary"),es={view:"form",id:"cp-form",borderless:!0,margin:5,elements:[{template:"<div>Изменение пароля</div>",css:"webix_cp-form",height:35,borderless:!0},Xr,Zr("Старый пароль","oldPass"),Zr("Новый пароль","newPass"),Zr("Повтор нового пароля","repeatPass"),{margin:5,cols:[ts]}],on:{onViewShow:webix.once((function(){la.setForm(this)}))},rules:{$all:webix.rules.isNotEmpty,$obj:function(t){const e=$$("cp-form").isDirty();return t.newPass!=t.repeatPass?(Ia("error","Новый пароль не совпадает с повтором"),!1):t.newPass!=t.oldPass||!e||(Ia("error","Новый пароль должен отличаться от старого"),!1)}}},ns={id:"layout-cp",cols:[es,{}]},is="settings",os=[{view:"template",template:"<div>Настройки</div>",css:"webix_headline-userprefs",height:35,borderless:!0},{view:"template",id:"settingsName",css:"webix_userprefs-info",height:50,borderless:!0,template:function(){const t=$$("settingsName").getValues();return`\n            <div style = '\n                display:inline-block;\n                color:var(--primary);\n                font-size:13px!important;\n                font-weight:600\n            '>Имя пользователя:</div>\n\n            <div style = '\n                display:inline-block;\n                font-size:13px!important;\n                font-weight:600\n            '>${0!==Object.keys(t).length?t:"не указано"}</div>`}}];function rs(t){return`<span class='webix_tabbar-filter-headline'>\n            ${t}\n            </span>`}const ss={view:"tabbar",type:"top",id:"userprefsTabbar",css:"webix_filter-popup-tabbar",multiview:!0,height:50,options:[{value:rs("Рабочее пространство"),id:"userprefsWorkspace"},{value:rs("Другое"),id:"userprefsOther"}],on:{onBeforeTabClick:function(t){const e=$$("userprefsTabbar"),n=e.getValue()+"Form",i=$$(n);if(i.isDirty())return function(){try{webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"}).then((function(o){if(1==o){const o=webix.storage.local.get(n),r=$$("userprefsSaveBtn"),s=$$("userprefsResetBtn");i.setValues(o),e.setValue(t),Va.disableItem(r),Va.disableItem(s)}else 2==o&&(gs(),e.setValue(t))}))}catch(t){ka(t,is,"createModalBox")}}(),!1}}};function as(t,e){const n={view:"form",id:t,borderless:!0,elements:[{cols:e}],on:{onViewShow:webix.once((function(){la.setForm(this)})),onChange:function(){const t=this.isDirty(),e=$$("userprefsSaveBtn"),n=$$("userprefsResetBtn");t?Va.enableItem(e):t||Va.disableItem(e),t?Va.enableItem(n):t||Va.disableItem(n)}}};return n}const cs={view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsWorkspace",scroll:"y",body:as("userprefsWorkspaceForm",[{rows:[{view:"radio",labelPosition:"top",name:"logBlockOpt",label:"Отображение блока системных сообщений",value:1,options:[{id:1,value:"Показать"},{id:2,value:"Скрыть"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть по умолчанию блок системных сообщений")},onChange:function(t,e){try{const n=$$("webix_log-btn");t!==e&&(1==t?n.setValue(2):n.setValue(1))}catch(t){ka(t,is,"onChange")}}}},{height:15}]}])},ls={view:"counter",id:"userprefsAutorefCounter",labelPosition:"top",name:"autorefCounterOpt",label:"Интервал автообновления (в миллисекундах)",min:15e3,max:9e5,on:{onChange:function(t){function e(t){return webix.message({type:"debug",expire:1e3,text:t})}try{const n=$$("userprefsAutorefCounter"),i=n.config.min,o=n.config.max,r="возможное значение";t==i?e("Минимально"+r):t==o&&e("Максимально"+r)}catch(t){ka(t,is,"onChange")}}}},us={view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsOther",scroll:"y",body:as("userprefsOtherForm",[{rows:[{view:"radio",labelPosition:"top",label:"Автообновление специфичных страниц",value:1,name:"autorefOpt",options:[{id:1,value:"Включено"},{id:2,value:"Выключено"}],on:{onChange:function(t){const e=$$("userprefsAutorefCounter");1==t&&Va.showItem(e),2==t&&Va.hideItem(e)}}},{height:25},ls,{height:25},{view:"radio",labelPosition:"top",label:"ID в таблицах",value:1,name:"visibleIdOpt",options:[{id:1,value:"Показывать"},{id:2,value:"Не показывать"}]},{height:25},{view:"radio",labelPosition:"top",label:"История последнего сеанса",value:2,name:"saveHistoryOpt",options:[{id:1,value:"Сохранять"},{id:2,value:"Не сохранять"}]},{}]}])},fs={userprefsOther:{},userprefsWorkspace:{}};let ds,hs,ps,ms,bs;async function gs(){ds=$$("userprefsTabbar");const t=ds.getValue();return hs=t+"Form",ps=$$(hs),ps.isDirty()?async function(){const t=await Ba(),n=`userprefs.owner=${t.id}`;return new e({id:`smarts?query=userprefs.name='/settings'+and+${n}&limit=80&offset=0`}).get().then((function(n){if(n&&n.content){if(ms=ps.getValues(),n.content&&(bs=n.content[0]),bs){const t=JSON.parse(bs.prefs);t[`${hs}`]=ms,bs.prefs=t}else bs=function(t,e){return{name:"/settings",owner:t,prefs:{[hs]:e}}}(t.id,ms);if(bs){if(!n.content||!n.content.length)return new e({id:"userprefs"}).post(bs).then((function(t){if(t){const t=ds.getValue();return fs[t]=ms,ps.setDirty(!1),Ia("success","Настройки сохранены"),!0}}));{const t=n.content[0];if(t)return function(t){return new e({id:`userprefs/${t}`}).put(bs).then((function(t){if(t){const t=JSON.stringify(ms);fa(hs,t);const e=ds.getValue();return fs[e]=ms,ps.setDirty(!1),Ia("success","Настройки сохранены"),!0}}))}(t.id)}}}}))}():(Ia("debug","Сохранять нечего"),!0)}const ws=new l({config:{id:"userprefsResetBtn",hotkey:"Shift+X",value:"Сбросить",click:function(){const t=$$("userprefsTabbar").getValue()+"Form",e=$$(t);"userprefsWorkspaceForm"===t?e.setValues({logBlockOpt:"1"}):"userprefsOtherForm"===t&&e.setValues({autorefOpt:"1",autorefCounterOpt:15e3,visibleIdOpt:"1"}),e.setDirty(!0),gs()}},titleAttribute:"Вернуть начальные настройки"}).maxView(),$s={rows:[{padding:{top:15,bottom:0,left:20,right:0},rows:os},{rows:[ss,{cells:[cs,us]},{id:"adaptiveUp",rows:[{responsive:"adaptiveUserprefs",cols:[ws,new l({config:{id:"userprefsSaveBtn",hotkey:"Shift+Space",disabled:!0,value:"Сохранить настройки",click:gs},titleAttribute:"Применить настройки"}).maxView("primary")]}]}]}]},vs="treeSidebar";function ys(t){const e=c.attribute(t,"type");Va.hideItem($$("webix__none-content")),Va.removeItem($$("treeTempl")),Va.destructItem($$("contextMenuEditTree"));const n=$$("tree").isBranch(t);e||n?Va.removeItem($$("webix__null-content")):function(){if(!$$("webix__null-content"))try{la.tabs.isOtherViewTab()?la.tabs.addTab(!0):function(){la.tabs.changeTabName(!1,!1);const t=la.tabs.getInfo();t.tree={none:!0},la.tabs.setInfo(t)}(),$$("container").addView({view:"align",align:"middle,center",id:"webix__null-content",body:{borderless:!0,template:"Блок в процессе разработки",height:50,width:220,css:{color:"#858585","font-size":"14px!important"}}},2)}catch(t){ka(t,vs,"createUndefinedView")}}(),function(t,e){const n=la.getViews();let i;if(t){const n={tree:{type:t,field:e}};la.tabs.setInfo(n)}"dbtable"==t?(i="tables",la.tables.load(e)):"tform"==t?(i="forms",la.forms.load(e)):"dashboard"==t&&(i="dashboards",la.dashboards.load(e),Va.hideItem($$("propTableView"))),n&&n.length&&(n.forEach((function(t){t!==i&&Va.hideItem($$(t)),t==e&&(Va.removeItem($$("webix__null-content")),Va.showItem($$("webix__none-content")))})),Va.showItem($$(i)))}(e,t)}let xs,Is,Cs;function Ss(t,e){return"q-"+t+"_data-tree_"+e}function Ts(t,e,n=Is){xs.data.add({id:t,disabled:!0,value:e},0,n)}function ks(t=!1,e){const n="q-load_data-tree_"+e,i="q-none_data-tree_"+e;try{xs.exists(n)&&xs.remove(n),xs.exists(i)&&t&&xs.remove(i)}catch(t){ka(t,vs,"removeTreeEls")}}function Es(t,e){const n=webix.uid();xs=$$("tree"),Is=t,Cs=e;const i=xs.getItem(Is);xs.getItem(Is)&&-1===i.$count&&(function(t){const e=Ss("none",t);Ts(e,"Загрузка ..."),xs.addCss(e,"tree_load-items")}(n),async function(t){const e=xs.getItem(Is);if(e.action.includes("all_")){const n=e.action.indexOf("_");!async function(t,e,n){await s.content("fields"),await s.content("mmenu");const i=a.content,o=c.keys,r=c.values;let l=!1;if(o&&o.length)try{if(o.forEach((function(o,s){(function(t,e){return t.type==e})(r[s],t)&&function(t,e){let n=!0;return Oa(t,vs,"isUniqueItem")&&t.forEach((function(t,i){t.name==e&&(n=!1)})),n}(i,o)&&(xs.data.add({id:o,value:r[s].plural?r[s].plural:r[s].singular,type:r[s].type},0,e),l||(l=!0),ks(!0,n))})),!l){ks(!1,n);const t="q-none_data-tree_"+n;xs.exists(t)||(function(t,e){Ts(Ss("none",t),"Раздел пуст",e)}(n,e),xs.addCss(t,"tree_none-items"))}}catch(t){ka(t,vs,"generateMenuData")}}(e.action.slice(n+1),Is,t)}}(n))}function _s(t){return $$("tree").isBranch(t)}const Vs="favorites";const Fs={view:"scrollview",scroll:"y",maxHeight:300,borderless:!0,body:{rows:[{view:"radio",id:"favCollectionLinks",vertical:!0,options:[{id:"radioNoneContent",disabled:!0,value:"Здесь будут сохранены Ваши ссылки"}],on:{onChange:function(t,e){t!==e&&Va.enableItem($$("favLinkSubmit")),Va.enableItem($$("removeFavsBtn"))}}}]}},As=new l({config:{id:"favLinkSubmit",hotkey:"Ctrl+Shift+Space",value:"Открыть ссылку",disabled:!0,click:function(){!function(){try{const t=$$("favCollectionLinks"),e=t.getValue(),n=t.getOption(e).id;if(n){const t={tree:{field:n,type:"dbtable"}};la.tabs.openInNewTab(t)}Va.destructItem($$("popupFavsLink"))}catch(t){ka(t,Vs,"favsPopupSubmitClick")}}()}},titleAttribute:"Открыть ссылку"}).maxView("primary");function Bs(){return new l({config:{id:"removeFavsBtn",hotkey:"Alt+Shift+R",icon:"icon-trash",disabled:!0,click:function(){!function(){const t=$$("favCollectionLinks"),n=t.getValue(),i=t.getOption(n);Lt("Закладка будет удалена из избранного","Вы уверены?",["Отмена","Удалить"]).then((function(n){1==n&&(async function(t,n){if(n&&t){const i=await Ba(),o=`userprefs.name+=+%27fields/${n.id}%27`,r=`userprefs.owner+=+${i.id}`;new e({id:`smarts?query=${o}+and+${r}&limit=80&offset=0`}).get().then((function(i){if(i&&i.content){const o=i.content[0];if(o){const i=JSON.parse(o.prefs);i.favorite&&delete i.favorite,o.prefs=i,function(t,n,i){new e({id:`userprefs/${t.id}`}).put(t).then((function(t){t&&t.content&&(Ia("success","Ссылка удалена из избранного"),function(t,e){if(1==t.data.options.length){const e={id:"radioNoneContent",disabled:!0,value:"Здесь будут сохранены Ваши ссылки"};t.addOption(e)}t.removeOption(e.id)}(n,i))}))}(o,t,n)}}}))}}(t,i),Ia("success",`Закладка «${i.value}» удалена из избранного`))}))}()}},titleAttribute:"Удалить ссылку из избранного"}).minView("delete")}function Os(){new u({headline:"Избранное",config:{id:"popupFavsLink",width:400,minHeight:300},elements:{padding:{left:5,right:5},rows:[Fs,{height:15},{cols:[As,Bs()]}]}}).createView(),async function(){const t=await Ba();new e({id:"userprefs"}).get().then((function(e){if(e){const n=e.content;n&&t&&function(t,e){const n=function(t,e){const n=[];try{t&&t.length&&t.forEach((function(t){if(t.name.includes("fields/")&&e==t.owner){const e=JSON.parse(t.prefs);e&&e.favorite&&(e.favorite.dataId=t.id,n.push(e.favorite))}}))}catch(t){ka(t,Vs,"findFavsisUserData")}return n}(t,e.id),i=$$("favCollectionLinks");try{n&&n.length&&n.forEach((function(t){i.addOption({id:t.id,value:t.name,favLink:t.link,dataId:t.dataId}),i.removeOption("radioNoneContent")})),Va.showItem($$("popupFavsLink"))}catch(t){ka(t,Vs,"createOptions")}}(n,t)}}))}(),function(t){if(window.innerWidth<1200){const e=.89*window.innerWidth;try{t.config.width=e,t.resize()}catch(t){ka(t,Vs,"setAdaptiveSize")}}}($$("popupFavsLink"))}const Ps="header";function Ls(t){return Backbone.history.navigate(t,{trigger:!0})}function js(){const t=$$("tree");t&&(t.unselectAll(),t.closeAll())}const Ns=new l({config:{id:"button-context-menu",hotkey:"Ctrl+L",icon:"icon-user",disabled:!0,popup:{view:"contextmenu",id:"contextmenu",css:"webix_contextmenu",data:[],on:{onItemClick:function(t){!function(t){if("logout"==t)!function(t,e=t){la.getGlobalModalBox(t).then((function(t){t&&(js(),Ls(e))}))}("logout","logout?auto=true");else if("cp"==t)js(),Ls("/cp");else if("settings"==t)js(),Ls("/settings");else if("favs"==t){const t=$$("popupFavsLink");t?t.show():Os()}}(t)}}}},onFunc:{onItemClick:function(){!async function(){const t=await Ba(),n=window.location.pathname,i="userLocationHref";t&&t.id?new e({id:`smarts?query=userprefs.name=${i}+and+userprefs.owner=${t.id}&limit=80&offset=0`}).get().then((function(t){if(t&&"/index.html/content"!==n&&"/init/default/spaw/content"!==n){const n={href:window.location.href},o={name:i,owner:ownerId.id,prefs:n},r=t.content;r&&r.length?function(t,n){new e({id:"userprefs/"+t}).put(n)}(r[0].id,o):function(t){new e({id:"userprefs"}).post(t)}(o)}})):ka("owner is not defined","commonFunctions","onItemClickBtn")}()}},titleAttribute:"Пользователь"}).minView(),Ds=new l({config:{id:"webix_log-btn",hotkey:"Ctrl+M",icon:"icon-eye",badge:0,click:function(t){!function(t){const e=$$(t);1==e.getValue()?e.setValue(2):e.setValue(1)}(t)}},onFunc:{onChange:function(t){!function(t){const e=$$("logBlock-list"),n=$$("logLayout"),i=$$("webix_log-btn"),o=e.getLastId();function r(t,e){i.config.badge="",n.config.height=t,n.resize(),i.config.icon=e,i.refresh()}2==t?(r(90,"icon-eye-slash"),e.showItem(o)):r(5,"icon-eye")}(t)},setStorageData:function(){}},titleAttribute:"Показать/скрыть системные сообщения"}).minView();function Hs(t=!1){const e=$$("header").getChildViews();Oa(e,Ps,"setSearchInputState")&&e.forEach((function(e){(function(t){if(t.config.id.includes("search")||t.config.id.includes("log-btn")||t.config.id.includes("context-menu"))return!0})(e)&&(t?e.show():e.hide())}))}const Rs={view:"button",type:"icon",id:"collapseBtn",icon:"icon-bars",css:"webix_collapse",title:"текст",height:42,width:40,click:function(){const t=$$("sidebarContainer"),e=$$("tree"),n=$$("sideMenuResizer");function i(){Va.showItem(t),Va.showItem(e),window.innerWidth>=600&&Va.showItem(n)}function o(){Va.hideItem(t),Va.hideItem(e),Va.hideItem(n)}try{const t=850;window.innerWidth>t?e.isVisible()?o():i():e.isVisible()?(o(),Hs(!0)):(i(),e.config.width=window.innerWidth,e.resize(),Hs()),this.refresh()}catch(t){ka(t,Ps,"collapseClick")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Видимость бокового меню"),document.fonts.onloadingdone=function(t){const e=t.fontfaces;let n=!1;e.forEach((function(t){t.family.includes("icomoon")&&(n=!0)})),n||Ia("success","Не удалось загрузить шрифт иконок","expa")}}}},zs={view:"toolbar",id:"header",padding:10,css:"webix_header-style",elements:[{cols:[Rs,{view:"template",borderless:!0,css:{"background-color":"transparent!important"},template:"<img src='/init/static/images/expalogo.png'  style='height:30px; margin: 10px;'>",height:25}]},{},{view:"search",id:"headerSearch",placeholder:"Поиск (Alt+Shift+F)",css:"searchTable",height:42,hotkey:"alt+shift+f",maxWidth:250,minWidth:40,on:{onViewResize:function(){console.log(12)}}},Ds,Ns]},Ws=[],Ms=[];function qs(){const t=$$("tabsHistoryList"),e=t.getValue();return t.getOption(e)}function Us(){const t=la.tabs.getTabHistory(),e=[];return t&&t.length?t.forEach((function(t,n){e.push(function(t,e){const n=c.item(t.field),i=n.plural?n.plural:n.singular;return{id:webix.uid(),value:i,config:t,index:e}}(t,n))})):e.push({id:"radioNoneContent",disabled:!0,value:"История пуста"}),e}function Js(t){Ia("succcess",t,'"expa')}function Ks(){const t=new l({config:{id:"removeTabsHistory",hotkey:"Alt+Shift+R",icon:"icon-trash",popup:{view:"contextmenu",css:"webix_contextmenu",data:[{id:"clearSingle",value:"Удалить ссылку"},{id:"clearAll",value:"Очистить историю"}],on:{onItemClick:function(t){"clearAll"==t?Lt("История будет очищена полностью","Вы уверены?",["Отмена","Продолжить"]).then((function(t){1==t&&(la.tabs.clearTabHistory(),Va.destructItem($$("popupTabsHistory")),Js("История успешно очищена"))})):"clearSingle"==t&&function(){const t=qs();if(t){const e=t.value;Lt("Запись «"+e+"» будет удалена из истории","Вы уверены?",["Отмена","Продолжить"]).then((function(n){1==n&&(la.tabs.removeTabHistoryPage(t.index),function(t){const e=$$("tabsHistoryList");try{t.value=t.value+" (запись удалена)",e.refresh(),e.disableOption(t.id)}catch(t){ka(t,"tabs / tabsHistory","removeOptionState")}}(t),Js("Запись «"+e+"» удалена из истории"))}))}else webix.message({text:"Запись не выбрана",type:"error"})}()}}}},titleAttribute:"Очистить историю / удалить выбранную ссылку"}).minView("delete");return t}function Ys(){const t=new l({config:{id:"historyTabBtn",icon:"icon-file",popup:{view:"contextmenu",css:"webix_contextmenu",data:[{id:"addTab",value:"Новая вкладка"},{id:"history",value:"Открыть историю"},{id:"restore",value:"Открыть закрытую вкладку"},{id:"empty",value:""}],on:{onItemClick:function(t){"addTab"==t?la.tabs.openInNewTab({tree:{none:!0}}):"history"==t?function(){const t=new u({headline:"История",config:{id:"popupTabsHistory",width:500},elements:{rows:[{view:"scrollview",scroll:"y",maxHeight:300,borderless:!0,body:{rows:[{view:"radio",id:"tabsHistoryList",vertical:!0,options:Us(),on:{onChange:function(t,e){t!==e&&Va.enableItem($$("tabsHistoryBtn"))}}}]}},{cols:[new l({config:{id:"tabsHistoryBtn",hotkey:"Ctrl+Shift+Space",value:"Открыть ссылку",disabled:!0,click:function(){!function(){const t={tree:qs().config};la.tabs.openInNewTab(t),Va.destructItem($$("popupTabsHistory"))}()}},titleAttribute:"Открыть ссылку"}).maxView("primary"),Ks()]}]}});t.createView(),t.showPopup()}():"restore"==t&&function(){const t=function(){const t=la.tabs.getRemovedTabs();if(t){const e=t.length-1,n=t[e];return la.tabs.deleteOpenRemovedTab(e),n}}();t&&la.tabs.openInNewTab({tree:t})}()}}}},titleAttribute:"Действия с вкладками"}).transparentView();return t}function Gs(t,e,n){if(n)Backbone.history.navigate("/"+t.view,{trigger:!0});else{const n=t.field,i=t.type;if(t.none)la.hideAllContent(),Backbone.history.navigate("tree/tab?new=true",{trigger:!0}),Va.showItem($$("webix__none-content"));else{const t=function(t){let e;return"dbtable"==t?e="tables":"tform"==t?e="forms":"dashboard"==t&&(e="dashboards"),e}(i);!function(t){const e=la.getViews();e&&e.length&&e.forEach((function(e){e!==t&&Va.hideItem($$(e))})),Va.hideItem($$("webix__null-content")),Va.hideItem($$("webix__none-content"))}(t),Va.showItem($$(t)),n&&(function(t){const e="tree/"+t;Backbone.history.navigate(e)}(n),function(t,e){"tables"==t||"forms"==t?la.tables.showExists(e):"dashboards"==t&&la.dashboards.showExists(e)}(t,n),function(t,e){const n=$$("tree");n.exists(t)&&e&&(n.config.isTabSelect=!0,n.select(t))}(n,e))}!function(){const t=la.tabs.getInfo();if(t&&t.history){const e=t.history,n=t.nextPage;e.length>1?la.tabs.setHistoryBtnState(!1):la.tabs.setHistoryBtnState(!1,!1),n?la.tabs.setHistoryBtnState(!0):la.tabs.setHistoryBtnState(!0,!1)}}()}}function Qs(t,e){const n=t.filter,i=t.edit;if(n){if(n.dashboards){const t={content:n.values};webix.storage.local.put("dashFilterState",t)}else{if(t.queryFilter){const e=_a();e&&(e.config.filter={table:n.id,query:t.queryFilter})}webix.storage.local.put("currFilterState",n)}window.history.pushState("","","?view=filter")}i&&(webix.storage.local.put("editFormTempData",i.values),i.selected&&window.history.pushState("","","?id="+i.selected))}function Xs(){const t=$$("tree");t&&t.unselectAll()}function Zs(t,e){Va.showItem(t),Va.hideItem(e)}function ta(t){const e=$$("globalTabbar").config.options;if(e){const n={tabs:e,select:t};webix.storage.local.put("tabbar",n)}else webix.storage.local.remove("tabbar")}function ea(){la.tables.defaultState(),la.dashboards.defaultState(),la.forms.defaultState()}function na(){Backbone.history.navigate("tree/tab?new=true",{trigger:!0})}let ia;function oa(t,e){$$("globalTabbar").callEvent(t,[e])}function ra(t){return webix.storage.local.get(t)}function sa(){!function(){const t=la.getForms();t&&"object"==typeof t?t.forEach((function(t){t&&t.isDirty()&&(t.clear(),function(t){const e=t.config.id;"userprefsWorkspaceForm"!=e&&"userprefsOtherForm"!=e||ra(t);const n=ra(e);n&&t.setValues(n)}(t),t.setDirty(!1))})):ka(`type of content is not a array: ${t} or array does not exists`,"commonFunctions","createComboValues")}()}const aa=["dashboards","tables","forms","settings","user_auth"],ca=[],la={dashboards:new class{constructor(){this.name="dashboards"}create(){$$(this.name)||$$("container").addView({view:"layout",id:this.name,hidden:!0,scroll:"auto",rows:[{id:"dashboardContainer",rows:[{cols:[{id:"dashboardInfoContainer",css:"dash_container",minWidth:250,rows:[{id:"dash-none-content"}]},{view:"resizer"},Bt,Ot]}]}]},3)}showView(){Va.showItem($$(this.name))}showExists(t){Ft(t,!0)}load(t){Ft(t)}defaultState(){Va.hideItem($$("dashboardTool")),Va.showItem($$("dashboardInfoContainer"))}},tables:new class{constructor(){this.name="tables",this.components={editForm:new be}}create(){try{if(!$$(this.name)){$$("container").addView(function(t){return{id:t,hidden:!0,view:"scrollview",body:{id:"flexlayoutTable",cols:[{cols:[kr,{view:"resizer",class:"webix_resizers",id:"tableBarResizer"},je(),{id:"filterTableBarContainer",minWidth:250,width:350,hidden:!0,rows:[{id:"editFilterBarAdaptive",rows:[si]}]}]}]}}}(this.name),5),$$("filterEmptyTempalte").attachEvent("onViewShow",(function(){Va.hideItem($$("templateInfo"))}));const t=$$("table");!function(t){t.attachEvent("onAfterSort",(function(e,n){const i={idCol:e,type:n};t.config.sort=i,t.config.offsetAttr=0,webix.storage.local.put("tableSortData",i),t.clearAll(),Ir(t)}))}(t),Cr(t),function(t){t.attachEvent("onScrollY",(function(){const t=this,e=t.getScrollState(),n=t._dtable_height,i=t._dtable_offset_height;n-e.y==i&&Ir(t)}))}(t),rr(t),fr(t),sr(t)}}catch(t){ka(t,dr,"createTables")}}showView(){Va.showItem($$(this.name))}showExists(t){qi(_a().config.id,t,!0)}load(t){qi("table",t)}get editForm(){return be}get filter(){return He}defaultState(t,e=!0){"edit"==t?be.defaultState(e):("filter"==t||be.defaultState(),function(){const t=$$("filterTableBarContainer"),e=$$("inputsFilter");!function(){const t=_a();t&&(t.config.filter=null)}(),He.clearAll(),He.showApplyNotify(!1),t&&t.isVisible()&&Va.hideItem(t),Va.disableItem($$("btnFilterSubmit")),Va.disableItem($$("filterLibrarySaveBtn")),Va.disableItem($$("resetFilterBtn")),Va.removeItem(e),Va.showItem($$("filterEmptyTempalte")),function(){const t=$$("table-filterId").getNode();He.addClass(t,"webix-transparent-btn"),He.removeClass(t,"webix-transparent-btn--primary")}()}())}setSize(t){const e=$$("flexlayoutTable").$width,n=$$("table");if(t){const t=e-30;n.config.width=t,n.resize(),console.log(n.$width,t)}else{const t=e-$$("table-editForm").$width-30;n.$width>t&&(n.config.width=t,n.resize())}}},forms:new class{constructor(){this.name="forms"}create(){try{if(!$$(this.name)){$$("container").addView(function(t){return{view:"layout",id:t,css:"webix_tableView",hidden:!0,rows:[{cols:[Vr,_r,(e="propTableView",{view:"property",id:e,tooltip:"Имя: #label#<br> Значение: #value#",width:348,nameWidth:150,editable:!0,scroll:!0,hidden:!0}),Fr]}]};var e}(this.name),6);const t=$$("table-view");Cr(t),rr(t),fr(t),sr(t)}}catch(t){ka(t,dr,"createForms")}}showView(){Va.showItem($$(this.name))}load(t){qi("table-view",t)}defaultState(){!function(){const t=$$("propTableView");t&&t.isVisible()&&(t.clear(),Va.hideItem(t)),Va.hideItem($$("formsTools")),Va.showItem($$("formsContainer"))}(),l.transparentDefaultState()}},settings:new class{constructor(){this.name="dashboards"}create(){$$("container").addView({view:"layout",id:"settings",css:"webix_auth",hidden:!0,rows:[$s]},8)}async put(){return await gs()}},user_auth:new class{constructor(){this.name="user_auth"}create(){$$("container").addView({view:"layout",id:this.name,css:"webix_auth",hidden:!0,rows:[ns,{}]},7)}put(){return Gr()}},treeEdit:new class{constructor(){this.name="treeTempl"}create(){try{$$(this.name)||($$("container").addView({view:"layout",id:this.name,hidden:!0,scroll:"auto",rows:[{id:"treeEditContainer",cols:[{rows:[Yr()]},{view:"form",id:"editTreeForm",width:300,elements:[{view:"combo",id:"editTreeCombo",name:"parents",value:111,labelPosition:"top",label:"Выберите элемент для редактирования",options:[]},{view:"combo",id:"editTreeComboOwner",name:"owners",labelPosition:"top",value:111,label:"Выберите владельца",options:[]},{view:"button",value:"Применить",css:"webix_primary",click:qr},{}]}]}]},4),webix.ui(function(){const t={view:"contextmenu",id:"contextMenuEditTree",data:["Добавить","Переименовать",{$template:"Separator"},"Развернуть всё","Свернуть всё",{$template:"Separator"},"Удалить"],master:$$("treeEdit"),on:{onMenuItemClick:function(t){!function(t,n){switch(Or=n.getContext(),Br=$$("treeEdit"),Pr=Br.getItem(Or.id),Lr=n.getMenu(t),jr=Lr.getItem(t).value,Nr="trees/",Dr={name:"",pid:"",owner:null,descr:"",ttype:1,value:"",cdt:null},jr){case"Добавить":{const t=prompt("Имя нового подэлемента '"+Pr.value+"'","");null!=t&&function(t){Dr.name=t,Dr.pid=Pr.id,new e({id:Nr}).post(Dr).then((function(e){if(e){const n=e.content;if(n){let e=n.id;Br.data.add({id:e,value:t,pid:Pr.id},0,Pr.id),Br.open(Pr.id);const i={id:Pr.id,value:Pr.value};Rr.add(i),Ia("success","Данные сохранены")}}}))}(t);break}case"Переименовать":{const t=prompt("Новое имя",Pr.value);null!=t&&function(t){Dr.name=t,Dr.id=Pr.id,Dr.pid=Pr.pid,new e({id:Nr+Pr.id}).put(Dr).then((function(e){if(e){Pr.value=t,Br.updateItem(Pr.id,Pr);const e={id:Pr.id,value:Pr.value};Rr.rename(e),Ia("success","Данные изменены")}}))}(t);break}case"Удалить":new e({id:Nr+Pr.id}).del(Pr).then((function(t){if(t){const t={id:Pr.id,value:Pr.value};Rr.remove(t),Br.remove(Pr.id),Ia("success","Данные удалены")}}));break;case"Развернуть всё":!function(){try{Br.open(Pr.id),Br.data.eachSubItem(Pr.id,(function(t){Br.open(t.id)}))}catch(t){ka(t,"editTree","case open all")}}();break;case"Свернуть всё":!function(){try{Br.close(Pr.id),Br.data.eachSubItem(Pr.id,(function(t){Br.close(t.id)}))}catch(t){ka(t,"editTree","case close all")}}()}}(t,this)}}};return t}()))}catch(t){ka(t,Ar,"createTreeTempl")}}showView(){Va.showItem($$(this.name))}load(){Ur=$$("treeEdit"),new e({id:"trees"}).get().then((function(t){if(t){const n=t.content;if(n){n[0].pid=0;const t=function(t){const e=[];return t&&t.length&&t.forEach((function(t){if(0==t.pid){const n=Kr(t);n.open=!0,e.push(n)}else{const n=Kr(t);e.push(n)}})),e}(n),i=function(t){const e=[],n={};try{t&&t.length&&t.forEach((function(i,o){n[i.id]=o,0!==i.pid&&i.pid!==i.id&&null!==i.pid?t[n[i.pid]].data.push(i):e.push(i)}))}catch(t){ka(t,Ar,"createStruct")}return e}(t);Ur.parse(i),function(t){const e=function(t){const e=[];return t&&t.length&&t.forEach((function(t,n){(function(t){let e=!1;return Ur.getFirstChildId(t)&&(e=!0),e})(t.id)&&e.push(t)})),e}(t);if(e&&e.length){const t=[{id:111,value:"Не выбрано"}],n=$$("editTreeCombo");e.forEach((function(e){t.push({id:e.id,value:e.value})})),n.getPopup().getList().parse(t);const i=t[0].id;n.setValue(i)}}(t),async function(){const t=await async function(){await s.content("fields");return c.item("trees").fields.owner.type.slice(10)}();new e({id:t}).get().then((function(t){if(t){const e=t.content;if(e){const t=function(t){const e=[{id:111,value:"Не выбрано"}];return t&&t.length&&t.forEach((function(t){e.push({id:t.id,value:t.first_name})})),e}(e);!function(t){$$("editTreeComboOwner").getPopup().getList().parse(t)}(t)}}}))}()}}})),Ur&&Ur.clearAll()}defaultState(t){try{const e=$$("treeTempl");$$(t)||Va.hideItem(e)}catch(t){ka(t,Ar,"hideTreeTempl")}}},sidebar:new class{constructor(){this.name="tree"}create(){return function(){const t={view:"edittree",id:"tree",css:"webix_tree-main",minWidth:100,width:300,editable:!1,select:!0,editor:"text",editValue:"value",activeTitle:!0,clipboard:!0,data:[],on:{onAfterLoad:function(){Va.hideItem($$("treeErrOverlay"))},onLoadError:function(t){!function(t){Va.hideItem($$("loadTreeOverlay"));const e=$$("sidebarContainer"),n="treeErrOverlay";if(!$$(n)&&e){const t=k(n,"Ошибка");e.addView(t,0)}Ia("error",t?t.status+" "+t.statusText+" "+t.responseURL+" ("+t.responseText+"). Меню не загружено sidebar => onLoadError":"Меню не загружено sidebar => onLoadError","version")}(t)},onItemClick:function(t){if(!_s(t))return la.getGlobalModalBox().then((function(e){e&&$$("tree").select(t)})),!1},onBeforeSelect:function(t){const e=$$("globalTabbar");if(e.config.options.length||e.addOption({id:t,value:"Новая вкладка",info:{tree:{none:!0}},close:!0},!0),this.config.isTabSelect)la.forms.defaultState();else{const e=this.getItem(t);_s(t)&&!e.webix_kids||this.open(t),function(t){la.header.defaultState(),la.treeEdit.defaultState(t),la.dashboards.defaultState(),la.tables.defaultState(),la.forms.defaultState(),async function(t){await s.content("fields"),c.keys&&ys(t)}(t)}(t)}},onBeforeOpen:function(t,e){Es(t,e)},onAfterSelect:function(t){this.config.isTabSelect?this.config.isTabSelect=!1:(function(t){if(a.content)try{Backbone.history.navigate("tree/"+t,{trigger:!0})}catch(t){ka(t,vs,"getFields")}}(t),function(){try{window.innerWidth<850&&$$("tree").hide()}catch(t){ka(t,vs,"setAdaptiveState")}}())}},ready:function(){}};return t}()}showView(){Va.showItem($$(this.name))}load(t){!function(t){const e=[],n=[],i=$$("tree"),o=$$("button-context-menu");let r=[];if(Oa(t,vs,"generateMenuTree")){t.forEach((function(t,i){3!==t.mtype?(e.push(function(t){let e;try{e={id:t.name,value:t.title,action:t.action},t.title||(e.value="Без названия"),2==t.mtype&&(0==t.childs.length?e.webix_kids=!0:e.data=function(t){let e=[];const n=t.childs;return n&&n.length&&n.forEach((function(t){e.push({id:t.name,value:t.title,action:t.action})})),e}(t))}catch(t){ka(t,vs,"generateParentTree")}return e}(t)),t.childs.length):(n.push(t.name),e.push({id:t.name,disabled:!0,value:""}))})),i.clearAll(),i.parse(e),Va.hideItem($$("loadTreeOverlay"));let s=o.config.popup.data;void 0!==s&&(s=r,o.enable()),n&&n.length&&n.forEach((function(t){i.addCss(t,"tree_delim-items")}))}}(t)}selectItem(t){return ys(t)}dataLength(){return $$(this.name).data.order.length}close(){const t=$$(this.name);t&&t.closeAll()}clear(){const t=$$(this.name);t&&t.clearAll()}},header:new class{constructor(){this.name="tree"}create(){return zs}showView(){Va.showItem($$(this.name))}load(t){!function(t){const e=$$("button-context-menu");let n;Oa(t,"header/loadContextMenu","generateHeaderMenu")&&(t.forEach((function(t,e){3!==t.mtype&&3!==t.mtype&&0!==t.childs.length&&(n=function(){const t=[];function e(e,n,i){const o={id:e,value:n,icon:i};return"logout"==e&&(o.css="webix_logout"),t.push(o),t}return e("favs","Избранное","icon-star"),e("settings","Настройки","icon-cog"),e("cp","Смена пароля","icon-lock"),e("logout","Выйти","icon-sign-out"),t}())})),void 0!==e.config.popup.data&&(e.config.popup.data=n,e.enable()))}(t)}defaultState(){!function(){const t=$$("header").getChildViews();Oa(t,"header/setDefaultState","headerDefState")&&t.forEach((function(t){t.config.id.includes("search")&&t.show()}))}()}},tabs:new class{addTab(t,e=!0){return function(t,e){const n=$$("globalTabbar"),i=webix.uid();return n.addOption({id:i,value:"Новая вкладка",info:{tree:{none:!0}},close:!0},e),Xs(),e&&ea(),la.hideAllContent(!1),ta(),function(t){const e=$$("webix__null-content"),n=$$("webix__none-content");t?Zs(e,n):Zs(n,e)}(t),Backbone.history.navigate("tree/tab?new=true",{trigger:!0}),i}(t,e)}removeTab(t){!function(t){ea(),t.length?(function(t){const e=$$("globalTabbar");e.setValue(t);const n=e.config.options;let i=0;n&&n.length&&n.forEach((function(t,e){t.info&&t.info.tree&&t.info.tree.none&&i++})),n.length==i&&na()}(t),la.tables.filter.clearAll(),function(t){const e=$$("globalTabbar").getOption(t),n=e.info.tree,i=e.info.temp;n&&Gs(n,!0,e.isOtherView),i&&Qs(i)}(t)):(na(),la.hideAllContent()),Xs(),ta(t)}(t)}setDataToStorage(t,e){const n={tabs:t.config.options,select:e};webix.storage.local.put("tabbar",n)}isOtherViewTab(){const t=$$("globalTabbar").getValue();if($$("globalTabbar").getOption(t).isOtherView)return!0}clearTemp(t,e){webix.storage.local.remove(t);const n=$$("globalTabbar"),i=n.getValue(),o=n.getOption(i);o.info.temp&&("filter"==e?o.info.temp.filter&&delete o.info.temp.filter:"edit"==e&&o.info.temp.edit&&delete o.info.temp.edit)}setInfo(t,e=!0){const n=$$("globalTabbar");let i=n.getValue();(function(t){const e=$$("globalTabbar").getOption(t);if(e&&e.isOtherView)return!0})(i)&&($$("globalTabbar").addOption({id:webix.uid(),value:" ",info:{},close:!0},!0),i=n.getValue());const o=n.optionIndex(i);if(o>-1){const r=n.config.options[o].info.history;if(n.config.options[o].info=t,n.refresh(),function(t,e){if(e&&e.tree){const n=e.tree.field;t.changeTabName(n)}}(this,t),e){t.history=r;const e=function(t,e){const n=t.config.options[e].info,i=n.history;let o=[];return i&&(o=function(t){let e=t;return t.length>4&&(e=e.slice(1)),e}(i)),o=function(t,e){const n=t;if(t&&!t.none){const t=function(t,e){const n=t[t.length-1];if(n&&n.field==e.field)return!0}(e,n);t||(la.tabs.addTabHistory(n),e.push(n))}return e}(n.tree,o),o}(n,o);t.history=e}this.setDataToStorage(n,i)}}getInfo(){const t=$$("globalTabbar"),e=t.getValue(),n=t.optionIndex(e);return t.config.options[n].info}changeTabName(t,e){let n;n=t||e?t?function(t){const e=c.item(t);let n;if(e){const t=e.plural,i=e.singular;n=e?t||i:"Новая вкладка"}else ka("Ссылки с id "+t+" не существует","tabs/_tabMediator","getFieldsname");return n}(t):e:"Новая вкладка",function(t){const e=$$("globalTabbar"),n=e.getValue(),i=e.optionIndex(n);i>-1&&(e.config.options[i].value=t,e.refresh())}(n)}setDirtyParam(){const t=$$("globalTabbar"),e=t.getValue(),n=t.getOption(e);n&&n.info&&(n.info.dirty=function(){const t=la.getForms();let e={dirty:!1};return t&&t.length&&t.forEach((function(t){t&&t.isDirty()&&!e.dirty&&(e={dirty:!0,id:t.config.id})})),e}().dirty)}openInNewTab(t){const e=this.addTab();la.tabs.setInfo(t),oa("onBeforeTabClick",e),oa("onAfterTabClick",e)}getTabHistory(){return Ws}saveTabHistory(){const t={history:la.tabs.getTabHistory()};webix.storage.local.put("tabsHistory",t)}addTabHistory(t){console.log(),Ws.length>10&&Ws.shift(),function(){const t=document.querySelector(".historyBtnLeft"),e=document.querySelector(".historyBtnRight");if(t&&e){const e=function(){const t=$$("globalTabbar"),e=t.getValue();return t.getOption(e)}();if(e&&e.info.history.length>1){const e=t.getAttribute("view_id");Va.enableItem($$(e))}}}(),Ws.push(t),this.saveTabHistory()}removeTabHistoryPage(t){Ws.splice(t,1),this.saveTabHistory()}clearTabHistory(){Ws.length=0,this.saveTabHistory()}addRemovedTab(t){Ms.length>10&&Ms.shift(),Ms.push(t)}deleteOpenRemovedTab(t){Ms.splice(t,1)}getRemovedTabs(){return Ms}setHistoryBtnState(t,e=!0){const n="historyBtn"+(t?"Right":"Left"),i=document.querySelector(`.${n}`);if(i){const t=i.getAttribute("view_id");e?Va.enableItem($$(t)):Va.disableItem($$(t))}}},getViews:()=>aa,setForm(t){ca.push(t)},getForms:()=>ca,getGlobalModalBox:t=>async function(t){const e=function(){const t=la.getForms();let e={dirty:!1};return t&&t.forEach((function(t){t&&t.isDirty()&&!e.dirty&&(e={dirty:!0,id:t.config.id})})),e}();return!e.dirty||async function(t){return Lt().then((function(e){if(1==e)return sa(),!0;if(2==e){if("table-editForm"==t)return $$("table-saveBtn").isVisible()?la.tables.editForm.put(!1,!1).then((function(t){if(t)return sa(),t})):la.tables.editForm.post(!1,!1).then((function(t){if(t)return sa(),t}));if("cp-form"==t)return la.user_auth.put().then((function(t){if(t)return sa(),t}));if("userprefsOtherForm"==t||"userprefsWorkspaceForm"==t)return la.settings.put().then((function(t){if(t)return sa(),t}))}}))}(e.id)}(),linkParam(t,e){t?function(t){const e=function(t){return"?"+new URLSearchParams(t).toString()}(t);window.history.replaceState(null,null,e)}(e):function(t){const e=window.location.href,n=new URL(e);n.searchParams.delete(t),history.replaceState(null,null,n)}(e)},createQuery:t=>function(t){const e=[];for(let n in t){const i=encodeURIComponent(n),o=encodeURIComponent(t[n]);e.push(i+"="+o)}return e.join("&")}(t),hideAllContent(t=!0){const e=this.getViews();e&&e.forEach((function(t){Va.hideItem($$(t))})),t&&(Va.hideItem($$("webix__null-content")),Va.showItem($$("webix__none-content")))}},ua="storageSettings";function fa(t,e){"undefined"!=typeof Storage&&localStorage.setItem(t,e)}function da(t){const e=$$("logLayout"),n=$$("webix_log-btn");let i,o;1==t?(i=5,o="icon-eye"):(i=90,o="icon-eye-slash"),e.config.height=i,n.config.icon=o,n.setValue(t),e.resize(),n.refresh()}async function ha(t){const n=await Ba(),i=webix.ajax("/init/default/api/userprefs/");i.then((function(t){(t=t.json())&&t.content&&(function(t,n){Oa(t,ua,"setDataToStorage")&&t.forEach((function(t){const i=t.owner,o=t.name,r=o.includes("fav-link_");i!=n.id||r||("/settings"==o?function(t){const e=JSON.parse(t.prefs),n=Object.keys(e),i=Object.values(e);n.forEach((function(t,e){fa(t,JSON.stringify(i[e]))}))}(t):("userRestoreData"!==o&&fa(t.name,t.prefs),"tabbar"!=o&&"userRestoreData"!=o&&"tabsHistory"!=o||function(t,n){t&&new e({id:`userprefs/${t}`}).del(n)}(t.id,t)))}))}(t.content,n),function(){const t=webix.storage.local.get("userprefsWorkspaceForm");if(t){const e=t.logBlockOpt;e&&("2"==e?da(1):"1"==e&&da(2))}}(),function(){const t=webix.storage.local.get("tabsHistory");if(t){const e=t.history;Oa(t,ua,"setDataToStorage")&&(e.forEach((function(t){la.tabs.addTabHistory(t)})),webix.storage.local.remove("tabsHistory"))}}(),$$("globalTabbar").callEvent("setStorageData",["1"]))})),i.fail((function(t){console.log(t),console.log("storageSettings function setUserPrefs")}))}let pa,ma,ba;const ga="icon-eye",wa="icon-eye-slash";async function $a(t){let e;"version"==t?e="Expa v1.0.85":"cp"==t?e="Смена пароля":(await s.content("fields"),c.keys&&(e=function(t){const e=c.names;let n;try{e&&e.length&&e.forEach((function(e){e.id==t&&(n=e.name)}))}catch(t){ka(t,"logBlock","findTableName")}return n}(t))),function(t){const e=$$("logBlock-list"),n=function(){const t=new Date;return`${t.getDate()}.${String(t.getMonth()+1).padStart(2,"0")}.${t.getFullYear()} ${t.getHours()}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`}();t||(t="expa"),e.add({date:n,value:ba,src:t});const i=e.getLastId();e.showItem(i)}(e)}let va=0;const ya={id:"logBlock-list",css:"webix_log-block",view:"list",template:"#date# — #value#  (Источник: #src#)",data:[],on:{onAfterLoad:function(){Ia("success","Интерфейс загружен","version")},onAfterAdd:function(t){const e=$$("webix_log-btn");e.config.icon==ga?function(t){try{""==t.config.badge&&(va=0),va++,t.config.badge=va,t.setValue(1),t.refresh()}catch(t){ka(t,"logBlock","onAfterAdd addNotify")}}(e):e.config.icon==wa&&function(t){try{va=0,t.config.badge="",t.setValue(2),t.refresh()}catch(t){ka(t,"logBlock","onAfterAdd clearNotify")}}(e),function(t){const e=$$("logBlock-list");if("error"==pa&&e){try{const n=e.getItemNode(t);n&&n.style.setProperty("color","red","important")}catch(t){ka(t,"logBlock","addErrorStyle")}!function(){try{const t=$$("logLayout"),e=$$("webix_log-btn"),n=90;e.config.icon==ga&&(t.config.height=n,t.resize(),e.setValue(2),e.config.icon=wa,e.refresh(),fa("LogVisible",JSON.stringify("show")))}catch(t){ka(t,"logBlock","openLog")}}()}}(t)}}},xa={id:"logLayout",height:80,rows:[{template:"<div class='webix_log-headline'>Системные сообщения</div>",height:30},ya]};function Ia(t,e,n){pa=t,ma=n,ba=e,function(){try{let t=null;const e=$$("tree");if(e&&e.getSelectedItem())t=e.getSelectedItem().id;else{const e=window.location.pathname,n=e.lastIndexOf("/");t=e.slice(n+1)}ma?$a(ma):t&&$a(t)}catch(t){ka(t,"logBlock","initLogMsg")}}()}function Ca(t,e,n){400===t.status||401===t.status||404===t.status?Ia("error",e+" function "+n+": "+t.status+" "+t.statusText+" "+t.responseURL+" ("+t.responseText+") "):(Ia("error",e+" function "+n+": "+t.status+" "+t.statusText+" "+t.responseURL+" ("+t.responseText+") ","version"),window.alert("Ошибка. Статус: "+t.status+". Отсутствует соединение с сервером."))}let Sa,Ta;function ka(t,e,n){console.log(t);const i=e+" function "+n+": "+t;Ia("error",e+" function "+n+": "+t),function(t){if(Sa)console.log(Sa);else{const e={level:3,msg:t},n="/init/default/api/events",i=webix.ajax().post(n,e);i.then((function(t){t=t.json()})),i.fail((function(t){Sa=!0,Ca(t,"errors","setToLog")}))}}(i)}function Ea(){let t;try{const e=$$("table"),n=$$("table-view"),i=$$("dashboardContainer");$$("tables").isVisible()?(t=e.config.idTable,Ta=e):$$("forms").isVisible()?(t=n.config.idTable,Ta=n):i&&i.isVisible()&&(t=i.config.idDash,Ta=i)}catch(t){ka(t,"commonFunctions","getItemId")}return t}function _a(){return Ea(),Ta}class Va{static hideItem(t){t&&t.hide()}static showItem(t){t&&t.show()}static removeItem(t){t&&t.getParentView().removeView(t)}static disableItem(t){t&&t.isEnabled()&&t.disable()}static enableItem(t){t&&!t.isEnabled()&&t.enable()}static destructItem(t){t&&t.destructor()}}function Fa(t){return new webix.DataCollection({url:{$proxy:!0,load:function(){return new e({id:t}).get().then((function(t){const e=[];let n;if(t){const i=t.content;if(i)return function(t){"object"==typeof t?t.forEach((t=>{!function(t,e){try{for(;t<=Object.values(e).length;){if("string"==typeof Object.values(e)[t]){n=Object.keys(e)[t];break}t++}}catch(t){ka(t,"commonFunctions","getComboOptions => stringOption")}}(0,t),function(t,i){try{if(null==i[n])for(;t<=Object.values(i).length;){if("number"==typeof Object.values(i)[1]){n=Object.keys(i)[1];break}t++}e.push({id:i.id,value:i[n]})}catch(t){ka(t,"commonFunctions","getComboOptions => numOption")}}(0,t)})):ka(`type of content is not a array: ${t}`,"commonFunctions","createComboValues")}(i),e}}))}}})}function Aa(){return webix.storage.local.get("user")}async function Ba(){let t=await Aa();return t||(await async function(){return await new e({id:"whoami"}).get().then((function(t){if(t){const e=t.content;if(e){const t={};t.id=e.id,t.name=e.first_name,t.username=e.username,fa("user",JSON.stringify(t))}}}))}(),t=await Aa()),t}function Oa(t,e,n){if(t&&"object"==typeof t)return!0;ka(`type of content is not a array \n            or array does not exists : ${t}`,e,n)}!function(){!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("underscore",e):(t="undefined"!=typeof globalThis?globalThis:t||self,function(){var n=t._,i=t._=e();i.noConflict=function(){return t._=n,i}}())}(this,(function(){var t="1.13.4",e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},n=Array.prototype,i=Object.prototype,o="undefined"!=typeof Symbol?Symbol.prototype:null,r=n.push,s=n.slice,a=i.toString,c=i.hasOwnProperty,l="undefined"!=typeof ArrayBuffer,u="undefined"!=typeof DataView,f=Array.isArray,d=Object.keys,h=Object.create,p=l&&ArrayBuffer.isView,m=isNaN,b=isFinite,g=!{toString:null}.propertyIsEnumerable("toString"),w=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],$=Math.pow(2,53)-1;function v(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),i=Array(n),o=0;o<n;o++)i[o]=arguments[o+e];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,arguments[0],i);case 2:return t.call(this,arguments[0],arguments[1],i)}var r=Array(e+1);for(o=0;o<e;o++)r[o]=arguments[o];return r[e]=i,t.apply(this,r)}}function y(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function x(t){return void 0===t}function I(t){return!0===t||!1===t||"[object Boolean]"===a.call(t)}function C(t){var e="[object "+t+"]";return function(t){return a.call(t)===e}}var S=C("String"),T=C("Number"),k=C("Date"),E=C("RegExp"),_=C("Error"),V=C("Symbol"),F=C("ArrayBuffer"),A=C("Function"),B=e.document&&e.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof B&&(A=function(t){return"function"==typeof t||!1});var O=A,P=C("Object"),L=u&&P(new DataView(new ArrayBuffer(8))),j="undefined"!=typeof Map&&P(new Map),N=C("DataView"),D=L?function(t){return null!=t&&O(t.getInt8)&&F(t.buffer)}:N,H=f||C("Array");function R(t,e){return null!=t&&c.call(t,e)}var z=C("Arguments");!function(){z(arguments)||(z=function(t){return R(t,"callee")})}();var W=z;function M(t){return T(t)&&m(t)}function q(t){return function(){return t}}function U(t){return function(e){var n=t(e);return"number"==typeof n&&n>=0&&n<=$}}function J(t){return function(e){return null==e?void 0:e[t]}}var K=J("byteLength"),Y=U(K),G=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,Q=l?function(t){return p?p(t)&&!D(t):Y(t)&&G.test(a.call(t))}:q(!1),X=J("length");function Z(t,e){e=function(t){for(var e={},n=t.length,i=0;i<n;++i)e[t[i]]=!0;return{contains:function(t){return!0===e[t]},push:function(n){return e[n]=!0,t.push(n)}}}(e);var n=w.length,o=t.constructor,r=O(o)&&o.prototype||i,s="constructor";for(R(t,s)&&!e.contains(s)&&e.push(s);n--;)(s=w[n])in t&&t[s]!==r[s]&&!e.contains(s)&&e.push(s)}function tt(t){if(!y(t))return[];if(d)return d(t);var e=[];for(var n in t)R(t,n)&&e.push(n);return g&&Z(t,e),e}function et(t,e){var n=tt(e),i=n.length;if(null==t)return!i;for(var o=Object(t),r=0;r<i;r++){var s=n[r];if(e[s]!==o[s]||!(s in o))return!1}return!0}function nt(t){return t instanceof nt?t:this instanceof nt?void(this._wrapped=t):new nt(t)}function it(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,K(t))}nt.VERSION=t,nt.prototype.value=function(){return this._wrapped},nt.prototype.valueOf=nt.prototype.toJSON=nt.prototype.value,nt.prototype.toString=function(){return String(this._wrapped)};var ot="[object DataView]";function rt(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var o=typeof t;return("function"===o||"object"===o||"object"==typeof e)&&st(t,e,n,i)}function st(t,e,n,i){t instanceof nt&&(t=t._wrapped),e instanceof nt&&(e=e._wrapped);var r=a.call(t);if(r!==a.call(e))return!1;if(L&&"[object Object]"==r&&D(t)){if(!D(e))return!1;r=ot}switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return o.valueOf.call(t)===o.valueOf.call(e);case"[object ArrayBuffer]":case ot:return st(it(t),it(e),n,i)}var s="[object Array]"===r;if(!s&&Q(t)){if(K(t)!==K(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;s=!0}if(!s){if("object"!=typeof t||"object"!=typeof e)return!1;var c=t.constructor,l=e.constructor;if(c!==l&&!(O(c)&&c instanceof c&&O(l)&&l instanceof l)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];for(var u=(n=n||[]).length;u--;)if(n[u]===t)return i[u]===e;if(n.push(t),i.push(e),s){if((u=t.length)!==e.length)return!1;for(;u--;)if(!rt(t[u],e[u],n,i))return!1}else{var f,d=tt(t);if(u=d.length,tt(e).length!==u)return!1;for(;u--;)if(!R(e,f=d[u])||!rt(t[f],e[f],n,i))return!1}return n.pop(),i.pop(),!0}function at(t){if(!y(t))return[];var e=[];for(var n in t)e.push(n);return g&&Z(t,e),e}function ct(t){var e=X(t);return function(n){if(null==n)return!1;var i=at(n);if(X(i))return!1;for(var o=0;o<e;o++)if(!O(n[t[o]]))return!1;return t!==ht||!O(n[lt])}}var lt="forEach",ut=["clear","delete"],ft=["get","has","set"],dt=ut.concat(lt,ft),ht=ut.concat(ft),pt=["add"].concat(ut,lt,"has"),mt=j?ct(dt):C("Map"),bt=j?ct(ht):C("WeakMap"),gt=j?ct(pt):C("Set"),wt=C("WeakSet");function $t(t){for(var e=tt(t),n=e.length,i=Array(n),o=0;o<n;o++)i[o]=t[e[o]];return i}function vt(t){for(var e={},n=tt(t),i=0,o=n.length;i<o;i++)e[t[n[i]]]=n[i];return e}function yt(t){var e=[];for(var n in t)O(t[n])&&e.push(n);return e.sort()}function xt(t,e){return function(n){var i=arguments.length;if(e&&(n=Object(n)),i<2||null==n)return n;for(var o=1;o<i;o++)for(var r=arguments[o],s=t(r),a=s.length,c=0;c<a;c++){var l=s[c];e&&void 0!==n[l]||(n[l]=r[l])}return n}}var It=xt(at),Ct=xt(tt),St=xt(at,!0);function Tt(t){if(!y(t))return{};if(h)return h(t);var e=function(){};e.prototype=t;var n=new e;return e.prototype=null,n}function kt(t){return H(t)?t:[t]}function Et(t){return nt.toPath(t)}function _t(t,e){for(var n=e.length,i=0;i<n;i++){if(null==t)return;t=t[e[i]]}return n?t:void 0}function Vt(t,e,n){var i=_t(t,Et(e));return x(i)?n:i}function Ft(t){return t}function At(t){return t=Ct({},t),function(e){return et(e,t)}}function Bt(t){return t=Et(t),function(e){return _t(e,t)}}function Ot(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,o){return t.call(e,n,i,o)};case 4:return function(n,i,o,r){return t.call(e,n,i,o,r)}}return function(){return t.apply(e,arguments)}}function Pt(t,e,n){return null==t?Ft:O(t)?Ot(t,e,n):y(t)&&!H(t)?At(t):Bt(t)}function Lt(t,e){return Pt(t,e,1/0)}function jt(t,e,n){return nt.iteratee!==Lt?nt.iteratee(t,e):Pt(t,e,n)}function Nt(){}function Dt(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}nt.toPath=kt,nt.iteratee=Lt;var Ht=Date.now||function(){return(new Date).getTime()};function Rt(t){var e=function(e){return t[e]},n="(?:"+tt(t).join("|")+")",i=RegExp(n),o=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(o,e):t}}var zt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Wt=Rt(zt),Mt=Rt(vt(zt)),qt=nt.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},Ut=/(.)^/,Jt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Kt=/\\|'|\r|\n|\u2028|\u2029/g;function Yt(t){return"\\"+Jt[t]}var Gt=/^\s*(\w|\$)+\s*$/,Qt=0;function Xt(t,e,n,i,o){if(!(i instanceof e))return t.apply(n,o);var r=Tt(t.prototype),s=t.apply(r,o);return y(s)?s:r}var Zt=v((function(t,e){var n=Zt.placeholder,i=function(){for(var o=0,r=e.length,s=Array(r),a=0;a<r;a++)s[a]=e[a]===n?arguments[o++]:e[a];for(;o<arguments.length;)s.push(arguments[o++]);return Xt(t,i,this,this,s)};return i}));Zt.placeholder=nt;var te=v((function(t,e,n){if(!O(t))throw new TypeError("Bind must be called on a function");var i=v((function(o){return Xt(t,i,e,this,n.concat(o))}));return i})),ee=U(X);function ne(t,e,n,i){if(i=i||[],e||0===e){if(e<=0)return i.concat(t)}else e=1/0;for(var o=i.length,r=0,s=X(t);r<s;r++){var a=t[r];if(ee(a)&&(H(a)||W(a)))if(e>1)ne(a,e-1,n,i),o=i.length;else for(var c=0,l=a.length;c<l;)i[o++]=a[c++];else n||(i[o++]=a)}return i}var ie=v((function(t,e){var n=(e=ne(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var i=e[n];t[i]=te(t[i],t)}return t})),oe=v((function(t,e,n){return setTimeout((function(){return t.apply(null,n)}),e)})),re=Zt(oe,nt,1);function se(t){return function(){return!t.apply(this,arguments)}}function ae(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}var ce=Zt(ae,2);function le(t,e,n){e=jt(e,n);for(var i,o=tt(t),r=0,s=o.length;r<s;r++)if(e(t[i=o[r]],i,t))return i}function ue(t){return function(e,n,i){n=jt(n,i);for(var o=X(e),r=t>0?0:o-1;r>=0&&r<o;r+=t)if(n(e[r],r,e))return r;return-1}}var fe=ue(1),de=ue(-1);function he(t,e,n,i){for(var o=(n=jt(n,i,1))(e),r=0,s=X(t);r<s;){var a=Math.floor((r+s)/2);n(t[a])<o?r=a+1:s=a}return r}function pe(t,e,n){return function(i,o,r){var a=0,c=X(i);if("number"==typeof r)t>0?a=r>=0?r:Math.max(r+c,a):c=r>=0?Math.min(r+1,c):r+c+1;else if(n&&r&&c)return i[r=n(i,o)]===o?r:-1;if(o!=o)return(r=e(s.call(i,a,c),M))>=0?r+a:-1;for(r=t>0?a:c-1;r>=0&&r<c;r+=t)if(i[r]===o)return r;return-1}}var me=pe(1,fe,he),be=pe(-1,de);function ge(t,e,n){var i=(ee(t)?fe:le)(t,e,n);if(void 0!==i&&-1!==i)return t[i]}function we(t,e,n){var i,o;if(e=Ot(e,n),ee(t))for(i=0,o=t.length;i<o;i++)e(t[i],i,t);else{var r=tt(t);for(i=0,o=r.length;i<o;i++)e(t[r[i]],r[i],t)}return t}function $e(t,e,n){e=jt(e,n);for(var i=!ee(t)&&tt(t),o=(i||t).length,r=Array(o),s=0;s<o;s++){var a=i?i[s]:s;r[s]=e(t[a],a,t)}return r}function ve(t){var e=function(e,n,i,o){var r=!ee(e)&&tt(e),s=(r||e).length,a=t>0?0:s-1;for(o||(i=e[r?r[a]:a],a+=t);a>=0&&a<s;a+=t){var c=r?r[a]:a;i=n(i,e[c],c,e)}return i};return function(t,n,i,o){var r=arguments.length>=3;return e(t,Ot(n,o,4),i,r)}}var ye=ve(1),xe=ve(-1);function Ie(t,e,n){var i=[];return e=jt(e,n),we(t,(function(t,n,o){e(t,n,o)&&i.push(t)})),i}function Ce(t,e,n){e=jt(e,n);for(var i=!ee(t)&&tt(t),o=(i||t).length,r=0;r<o;r++){var s=i?i[r]:r;if(!e(t[s],s,t))return!1}return!0}function Se(t,e,n){e=jt(e,n);for(var i=!ee(t)&&tt(t),o=(i||t).length,r=0;r<o;r++){var s=i?i[r]:r;if(e(t[s],s,t))return!0}return!1}function Te(t,e,n,i){return ee(t)||(t=$t(t)),("number"!=typeof n||i)&&(n=0),me(t,e,n)>=0}var ke=v((function(t,e,n){var i,o;return O(e)?o=e:(e=Et(e),i=e.slice(0,-1),e=e[e.length-1]),$e(t,(function(t){var r=o;if(!r){if(i&&i.length&&(t=_t(t,i)),null==t)return;r=t[e]}return null==r?r:r.apply(t,n)}))}));function Ee(t,e){return $e(t,Bt(e))}function _e(t,e,n){var i,o,r=-1/0,s=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,c=(t=ee(t)?t:$t(t)).length;a<c;a++)null!=(i=t[a])&&i>r&&(r=i);else e=jt(e,n),we(t,(function(t,n,i){((o=e(t,n,i))>s||o===-1/0&&r===-1/0)&&(r=t,s=o)}));return r}var Ve=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Fe(t){return t?H(t)?s.call(t):S(t)?t.match(Ve):ee(t)?$e(t,Ft):$t(t):[]}function Ae(t,e,n){if(null==e||n)return ee(t)||(t=$t(t)),t[Dt(t.length-1)];var i=Fe(t),o=X(i);e=Math.max(Math.min(e,o),0);for(var r=o-1,s=0;s<e;s++){var a=Dt(s,r),c=i[s];i[s]=i[a],i[a]=c}return i.slice(0,e)}function Be(t,e){return function(n,i,o){var r=e?[[],[]]:{};return i=jt(i,o),we(n,(function(e,o){var s=i(e,o,n);t(r,e,s)})),r}}var Oe=Be((function(t,e,n){R(t,n)?t[n].push(e):t[n]=[e]})),Pe=Be((function(t,e,n){t[n]=e})),Le=Be((function(t,e,n){R(t,n)?t[n]++:t[n]=1})),je=Be((function(t,e,n){t[n?0:1].push(e)}),!0);function Ne(t,e,n){return e in n}var De=v((function(t,e){var n={},i=e[0];if(null==t)return n;O(i)?(e.length>1&&(i=Ot(i,e[1])),e=at(t)):(i=Ne,e=ne(e,!1,!1),t=Object(t));for(var o=0,r=e.length;o<r;o++){var s=e[o],a=t[s];i(a,s,t)&&(n[s]=a)}return n})),He=v((function(t,e){var n,i=e[0];return O(i)?(i=se(i),e.length>1&&(n=e[1])):(e=$e(ne(e,!1,!1),String),i=function(t,n){return!Te(e,n)}),De(t,i,n)}));function Re(t,e,n){return s.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))}function ze(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[0]:Re(t,t.length-e)}function We(t,e,n){return s.call(t,null==e||n?1:e)}var Me=v((function(t,e){return e=ne(e,!0,!0),Ie(t,(function(t){return!Te(e,t)}))})),qe=v((function(t,e){return Me(t,e)}));function Ue(t,e,n,i){I(e)||(i=n,n=e,e=!1),null!=n&&(n=jt(n,i));for(var o=[],r=[],s=0,a=X(t);s<a;s++){var c=t[s],l=n?n(c,s,t):c;e&&!n?(s&&r===l||o.push(c),r=l):n?Te(r,l)||(r.push(l),o.push(c)):Te(o,c)||o.push(c)}return o}var Je=v((function(t){return Ue(ne(t,!0,!0))}));function Ke(t){for(var e=t&&_e(t,X).length||0,n=Array(e),i=0;i<e;i++)n[i]=Ee(t,i);return n}var Ye=v(Ke);function Ge(t,e){return t._chain?nt(e).chain():e}function Qe(t){return we(yt(t),(function(e){var n=nt[e]=t[e];nt.prototype[e]=function(){var t=[this._wrapped];return r.apply(t,arguments),Ge(this,n.apply(nt,t))}})),nt}we(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=n[t];nt.prototype[t]=function(){var n=this._wrapped;return null!=n&&(e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0]),Ge(this,n)}})),we(["concat","join","slice"],(function(t){var e=n[t];nt.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=e.apply(t,arguments)),Ge(this,t)}}));var Xe={__proto__:null,VERSION:t,restArguments:v,isObject:y,isNull:function(t){return null===t},isUndefined:x,isBoolean:I,isElement:function(t){return!(!t||1!==t.nodeType)},isString:S,isNumber:T,isDate:k,isRegExp:E,isError:_,isSymbol:V,isArrayBuffer:F,isDataView:D,isArray:H,isFunction:O,isArguments:W,isFinite:function(t){return!V(t)&&b(t)&&!isNaN(parseFloat(t))},isNaN:M,isTypedArray:Q,isEmpty:function(t){if(null==t)return!0;var e=X(t);return"number"==typeof e&&(H(t)||S(t)||W(t))?0===e:0===X(tt(t))},isMatch:et,isEqual:function(t,e){return rt(t,e)},isMap:mt,isWeakMap:bt,isSet:gt,isWeakSet:wt,keys:tt,allKeys:at,values:$t,pairs:function(t){for(var e=tt(t),n=e.length,i=Array(n),o=0;o<n;o++)i[o]=[e[o],t[e[o]]];return i},invert:vt,functions:yt,methods:yt,extend:It,extendOwn:Ct,assign:Ct,defaults:St,create:function(t,e){var n=Tt(t);return e&&Ct(n,e),n},clone:function(t){return y(t)?H(t)?t.slice():It({},t):t},tap:function(t,e){return e(t),t},get:Vt,has:function(t,e){for(var n=(e=Et(e)).length,i=0;i<n;i++){var o=e[i];if(!R(t,o))return!1;t=t[o]}return!!n},mapObject:function(t,e,n){e=jt(e,n);for(var i=tt(t),o=i.length,r={},s=0;s<o;s++){var a=i[s];r[a]=e(t[a],a,t)}return r},identity:Ft,constant:q,noop:Nt,toPath:kt,property:Bt,propertyOf:function(t){return null==t?Nt:function(e){return Vt(t,e)}},matcher:At,matches:At,times:function(t,e,n){var i=Array(Math.max(0,t));e=Ot(e,n,1);for(var o=0;o<t;o++)i[o]=e(o);return i},random:Dt,now:Ht,escape:Wt,unescape:Mt,templateSettings:qt,template:function(t,e,n){!e&&n&&(e=n),e=St({},e,nt.templateSettings);var i=RegExp([(e.escape||Ut).source,(e.interpolate||Ut).source,(e.evaluate||Ut).source].join("|")+"|$","g"),o=0,r="__p+='";t.replace(i,(function(e,n,i,s,a){return r+=t.slice(o,a).replace(Kt,Yt),o=a+e.length,n?r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?r+="'+\n((__t=("+i+"))==null?'':__t)+\n'":s&&(r+="';\n"+s+"\n__p+='"),e})),r+="';\n";var s,a=e.variable;if(a){if(!Gt.test(a))throw new Error("variable is not a bare identifier: "+a)}else r="with(obj||{}){\n"+r+"}\n",a="obj";r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{s=new Function(a,"_",r)}catch(t){throw t.source=r,t}var c=function(t){return s.call(this,t,nt)};return c.source="function("+a+"){\n"+r+"}",c},result:function(t,e,n){var i=(e=Et(e)).length;if(!i)return O(n)?n.call(t):n;for(var o=0;o<i;o++){var r=null==t?void 0:t[e[o]];void 0===r&&(r=n,o=i),t=O(r)?r.call(t):r}return t},uniqueId:function(t){var e=++Qt+"";return t?t+e:e},chain:function(t){var e=nt(t);return e._chain=!0,e},iteratee:Lt,partial:Zt,bind:te,bindAll:ie,memoize:function(t,e){var n=function(i){var o=n.cache,r=""+(e?e.apply(this,arguments):i);return R(o,r)||(o[r]=t.apply(this,arguments)),o[r]};return n.cache={},n},delay:oe,defer:re,throttle:function(t,e,n){var i,o,r,s,a=0;n||(n={});var c=function(){a=!1===n.leading?0:Ht(),i=null,s=t.apply(o,r),i||(o=r=null)},l=function(){var l=Ht();a||!1!==n.leading||(a=l);var u=e-(l-a);return o=this,r=arguments,u<=0||u>e?(i&&(clearTimeout(i),i=null),a=l,s=t.apply(o,r),i||(o=r=null)):i||!1===n.trailing||(i=setTimeout(c,u)),s};return l.cancel=function(){clearTimeout(i),a=0,i=o=r=null},l},debounce:function(t,e,n){var i,o,r,s,a,c=function(){var l=Ht()-o;e>l?i=setTimeout(c,e-l):(i=null,n||(s=t.apply(a,r)),i||(r=a=null))},l=v((function(l){return a=this,r=l,o=Ht(),i||(i=setTimeout(c,e),n&&(s=t.apply(a,r))),s}));return l.cancel=function(){clearTimeout(i),i=r=a=null},l},wrap:function(t,e){return Zt(e,t)},negate:se,compose:function(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}},after:function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},before:ae,once:ce,findKey:le,findIndex:fe,findLastIndex:de,sortedIndex:he,indexOf:me,lastIndexOf:be,find:ge,detect:ge,findWhere:function(t,e){return ge(t,At(e))},each:we,forEach:we,map:$e,collect:$e,reduce:ye,foldl:ye,inject:ye,reduceRight:xe,foldr:xe,filter:Ie,select:Ie,reject:function(t,e,n){return Ie(t,se(jt(e)),n)},every:Ce,all:Ce,some:Se,any:Se,contains:Te,includes:Te,include:Te,invoke:ke,pluck:Ee,where:function(t,e){return Ie(t,At(e))},max:_e,min:function(t,e,n){var i,o,r=1/0,s=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,c=(t=ee(t)?t:$t(t)).length;a<c;a++)null!=(i=t[a])&&i<r&&(r=i);else e=jt(e,n),we(t,(function(t,n,i){((o=e(t,n,i))<s||o===1/0&&r===1/0)&&(r=t,s=o)}));return r},shuffle:function(t){return Ae(t,1/0)},sample:Ae,sortBy:function(t,e,n){var i=0;return e=jt(e,n),Ee($e(t,(function(t,n,o){return{value:t,index:i++,criteria:e(t,n,o)}})).sort((function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index})),"value")},groupBy:Oe,indexBy:Pe,countBy:Le,partition:je,toArray:Fe,size:function(t){return null==t?0:ee(t)?t.length:tt(t).length},pick:De,omit:He,first:ze,head:ze,take:ze,initial:Re,last:function(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[t.length-1]:We(t,Math.max(0,t.length-e))},rest:We,tail:We,drop:We,compact:function(t){return Ie(t,Boolean)},flatten:function(t,e){return ne(t,e,!1)},without:qe,uniq:Ue,unique:Ue,union:Je,intersection:function(t){for(var e=[],n=arguments.length,i=0,o=X(t);i<o;i++){var r=t[i];if(!Te(e,r)){var s;for(s=1;s<n&&Te(arguments[s],r);s++);s===n&&e.push(r)}}return e},difference:Me,unzip:Ke,transpose:Ke,zip:Ye,object:function(t,e){for(var n={},i=0,o=X(t);i<o;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},range:function(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var i=Math.max(Math.ceil((e-t)/n),0),o=Array(i),r=0;r<i;r++,t+=n)o[r]=t;return o},chunk:function(t,e){if(null==e||e<1)return[];for(var n=[],i=0,o=t.length;i<o;)n.push(s.call(t,i,i+=e));return n},mixin:Qe,default:nt},Ze=Qe(Xe);return Ze._=Ze,Ze})),function(t){var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],(function(n,i,o){e.Backbone=t(e,o,n,i)}));else if("undefined"!=typeof exports){var n,i=require("underscore");try{n=require("jquery")}catch(t){}t(e,exports,i,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}((function(t,e,n,i){var o=t.Backbone,r=Array.prototype.slice;e.VERSION="1.4.1",e.$=i,e.noConflict=function(){return t.Backbone=o,this},e.emulateHTTP=!1,e.emulateJSON=!1;var s,a=e.Events={},c=/\s+/,l=function(t,e,i,o,r){var s,a=0;if(i&&"object"==typeof i){void 0!==o&&"context"in r&&void 0===r.context&&(r.context=o);for(s=n.keys(i);a<s.length;a++)e=l(t,e,s[a],i[s[a]],r)}else if(i&&c.test(i))for(s=i.split(c);a<s.length;a++)e=t(e,s[a],o,r);else e=t(e,i,o,r);return e};a.on=function(t,e,n){return this._events=l(u,this._events||{},t,e,{context:n,ctx:this,listening:s}),s&&((this._listeners||(this._listeners={}))[s.id]=s,s.interop=!1),this},a.listenTo=function(t,e,i){if(!t)return this;var o=t._listenId||(t._listenId=n.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),a=s=r[o];a||(this._listenId||(this._listenId=n.uniqueId("l")),a=s=r[o]=new b(this,t));var c=f(t,e,i,this);if(s=void 0,c)throw c;return a.interop&&a.on(e,i),this};var u=function(t,e,n,i){if(n){var o=t[e]||(t[e]=[]),r=i.context,s=i.ctx,a=i.listening;a&&a.count++,o.push({callback:n,context:r,ctx:r||s,listening:a})}return t},f=function(t,e,n,i){try{t.on(e,n,i)}catch(t){return t}};a.off=function(t,e,n){return this._events?(this._events=l(d,this._events,t,e,{context:n,listeners:this._listeners}),this):this},a.stopListening=function(t,e,i){var o=this._listeningTo;if(!o)return this;for(var r=t?[t._listenId]:n.keys(o),s=0;s<r.length;s++){var a=o[r[s]];if(!a)break;a.obj.off(e,i,this),a.interop&&a.off(e,i)}return n.isEmpty(o)&&(this._listeningTo=void 0),this};var d=function(t,e,i,o){if(t){var r,s=o.context,a=o.listeners,c=0;if(e||s||i){for(r=e?[e]:n.keys(t);c<r.length;c++){var l=t[e=r[c]];if(!l)break;for(var u=[],f=0;f<l.length;f++){var d=l[f];if(i&&i!==d.callback&&i!==d.callback._callback||s&&s!==d.context)u.push(d);else{var h=d.listening;h&&h.off(e,i)}}u.length?t[e]=u:delete t[e]}return t}for(r=n.keys(a);c<r.length;c++)a[r[c]].cleanup()}};a.once=function(t,e,n){var i=l(h,{},t,e,this.off.bind(this));return"string"==typeof t&&null==n&&(e=void 0),this.on(i,e,n)},a.listenToOnce=function(t,e,n){var i=l(h,{},e,n,this.stopListening.bind(this,t));return this.listenTo(t,i)};var h=function(t,e,i,o){if(i){var r=t[e]=n.once((function(){o(e,r),i.apply(this,arguments)}));r._callback=i}return t};a.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),n=Array(e),i=0;i<e;i++)n[i]=arguments[i+1];return l(p,this._events,t,void 0,n),this};var p=function(t,e,n,i){if(t){var o=t[e],r=t.all;o&&r&&(r=r.slice()),o&&m(o,i),r&&m(r,[e].concat(i))}return t},m=function(t,e){var n,i=-1,o=t.length,r=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++i<o;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r);return;case 2:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r,s);return;case 3:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r,s,a);return;default:for(;++i<o;)(n=t[i]).callback.apply(n.ctx,e);return}},b=function(t,e){this.id=t._listenId,this.listener=t,this.obj=e,this.interop=!0,this.count=0,this._events=void 0};b.prototype.on=a.on,b.prototype.off=function(t,e){var n;this.interop?(this._events=l(d,this._events,t,e,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()},b.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},a.bind=a.on,a.unbind=a.off,n.extend(e,a);var g=e.Model=function(t,e){var i=t||{};e||(e={}),this.preinitialize.apply(this,arguments),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{});var o=n.result(this,"defaults");i=n.defaults(n.extend({},o,i),o),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};n.extend(g.prototype,a,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(t){return n.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return n.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!n.iteratee(t,this)(this.attributes)},set:function(t,e,i){if(null==t)return this;var o;if("object"==typeof t?(o=t,i=e):(o={})[t]=e,i||(i={}),!this._validate(o,i))return!1;var r=i.unset,s=i.silent,a=[],c=this._changing;this._changing=!0,c||(this._previousAttributes=n.clone(this.attributes),this.changed={});var l=this.attributes,u=this.changed,f=this._previousAttributes;for(var d in o)e=o[d],n.isEqual(l[d],e)||a.push(d),n.isEqual(f[d],e)?delete u[d]:u[d]=e,r?delete l[d]:l[d]=e;if(this.idAttribute in o){var h=this.id;this.id=this.get(this.idAttribute),this.trigger("changeId",this,h,i)}if(!s){a.length&&(this._pending=i);for(var p=0;p<a.length;p++)this.trigger("change:"+a[p],this,l[a[p]],i)}if(c)return this;if(!s)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,n.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,n.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!n.isEmpty(this.changed):n.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&n.clone(this.changed);var e,i=this._changing?this._previousAttributes:this.attributes,o={};for(var r in t){var s=t[r];n.isEqual(i[r],s)||(o[r]=s,e=!0)}return!!e&&o},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(t){t=n.extend({parse:!0},t);var e=this,i=t.success;return t.success=function(n){var o=t.parse?e.parse(n,t):n;if(!e.set(o,t))return!1;i&&i.call(t.context,e,n,t),e.trigger("sync",e,n,t)},M(this,t),this.sync("read",this,t)},save:function(t,e,i){var o;null==t||"object"==typeof t?(o=t,i=e):(o={})[t]=e;var r=(i=n.extend({validate:!0,parse:!0},i)).wait;if(o&&!r){if(!this.set(o,i))return!1}else if(!this._validate(o,i))return!1;var s=this,a=i.success,c=this.attributes;i.success=function(t){s.attributes=c;var e=i.parse?s.parse(t,i):t;if(r&&(e=n.extend({},o,e)),e&&!s.set(e,i))return!1;a&&a.call(i.context,s,t,i),s.trigger("sync",s,t,i)},M(this,i),o&&r&&(this.attributes=n.extend({},c,o));var l=this.isNew()?"create":i.patch?"patch":"update";"patch"!==l||i.attrs||(i.attrs=o);var u=this.sync(l,this,i);return this.attributes=c,u},destroy:function(t){t=t?n.clone(t):{};var e=this,i=t.success,o=t.wait,r=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(n){o&&r(),i&&i.call(t.context,e,n,t),e.isNew()||e.trigger("sync",e,n,t)};var s=!1;return this.isNew()?n.defer(t.success):(M(this,t),s=this.sync("delete",this,t)),o||r(),s},url:function(){var t=n.result(this,"urlRoot")||n.result(this.collection,"url")||W();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},n.extend({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=n.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;return!i||(this.trigger("invalid",this,i,n.extend(e,{validationError:i})),!1)}});var w=e.Collection=function(t,e){e||(e={}),this.preinitialize.apply(this,arguments),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,n.extend({silent:!0},e))},$={add:!0,remove:!0,merge:!0},v={add:!0,remove:!1},y=function(t,e,n){n=Math.min(Math.max(n,0),t.length);var i,o=Array(t.length-n),r=e.length;for(i=0;i<o.length;i++)o[i]=t[i+n];for(i=0;i<r;i++)t[i+n]=e[i];for(i=0;i<o.length;i++)t[i+r+n]=o[i]};n.extend(w.prototype,a,{model:g,preinitialize:function(){},initialize:function(){},toJSON:function(t){return this.map((function(e){return e.toJSON(t)}))},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,n.extend({merge:!1},e,v))},remove:function(t,e){e=n.extend({},e);var i=!n.isArray(t);t=i?[t]:t.slice();var o=this._removeModels(t,e);return!e.silent&&o.length&&(e.changes={added:[],merged:[],removed:o},this.trigger("update",this,e)),i?o[0]:o},set:function(t,e){if(null!=t){(e=n.extend({},$,e)).parse&&!this._isModel(t)&&(t=this.parse(t,e)||[]);var i=!n.isArray(t);t=i?[t]:t.slice();var o=e.at;null!=o&&(o=+o),o>this.length&&(o=this.length),o<0&&(o+=this.length+1);var r,s,a=[],c=[],l=[],u=[],f={},d=e.add,h=e.merge,p=e.remove,m=!1,b=this.comparator&&null==o&&!1!==e.sort,g=n.isString(this.comparator)?this.comparator:null;for(s=0;s<t.length;s++){r=t[s];var w=this.get(r);if(w){if(h&&r!==w){var v=this._isModel(r)?r.attributes:r;e.parse&&(v=w.parse(v,e)),w.set(v,e),l.push(w),b&&!m&&(m=w.hasChanged(g))}f[w.cid]||(f[w.cid]=!0,a.push(w)),t[s]=w}else d&&(r=t[s]=this._prepareModel(r,e))&&(c.push(r),this._addReference(r,e),f[r.cid]=!0,a.push(r))}if(p){for(s=0;s<this.length;s++)f[(r=this.models[s]).cid]||u.push(r);u.length&&this._removeModels(u,e)}var x=!1,I=!b&&d&&p;if(a.length&&I?(x=this.length!==a.length||n.some(this.models,(function(t,e){return t!==a[e]})),this.models.length=0,y(this.models,a,0),this.length=this.models.length):c.length&&(b&&(m=!0),y(this.models,c,null==o?this.length:o),this.length=this.models.length),m&&this.sort({silent:!0}),!e.silent){for(s=0;s<c.length;s++)null!=o&&(e.index=o+s),(r=c[s]).trigger("add",r,this,e);(m||x)&&this.trigger("sort",this,e),(c.length||u.length||l.length)&&(e.changes={added:c,removed:u,merged:l},this.trigger("update",this,e))}return i?t[0]:t}},reset:function(t,e){e=e?n.clone(e):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],e);return e.previousModels=this.models,this._reset(),t=this.add(t,n.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,n.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,n.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return r.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.modelId(this._isModel(t)?t.attributes:t,t.idAttribute)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var i=e.length;return n.isFunction(e)&&(e=e.bind(this)),1===i||n.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(t){var e=(t=n.extend({parse:!0},t)).success,i=this;return t.success=function(n){var o=t.reset?"reset":"set";i[o](n,t),e&&e.call(t.context,i,n,t),i.trigger("sync",i,n,t)},M(this,t),this.sync("read",this,t)},create:function(t,e){var i=(e=e?n.clone(e):{}).wait;if(!(t=this._prepareModel(t,e)))return!1;i||this.add(t,e);var o=this,r=e.success;return e.success=function(t,e,n){i&&o.add(t,n),r&&r.call(n.context,t,e,n)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t,e){return t[e||this.model.prototype.idAttribute||"id"]},values:function(){return new I(this,C)},keys:function(){return new I(this,S)},entries:function(){return new I(this,T)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){return this._isModel(t)?(t.collection||(t.collection=this),t):((e=e?n.clone(e):{}).collection=this,(i=this.model.prototype?new this.model(t,e):this.model(t,e)).validationError?(this.trigger("invalid",this,i.validationError,e),!1):i);var i},_removeModels:function(t,e){for(var n=[],i=0;i<t.length;i++){var o=this.get(t[i]);if(o){var r=this.indexOf(o);this.models.splice(r,1),this.length--,delete this._byId[o.cid];var s=this.modelId(o.attributes,o.idAttribute);null!=s&&delete this._byId[s],e.silent||(e.index=r,o.trigger("remove",o,this,e)),n.push(o),this._removeReference(o,e)}}return n},_isModel:function(t){return t instanceof g},_addReference:function(t,e){this._byId[t.cid]=t;var n=this.modelId(t.attributes,t.idAttribute);null!=n&&(this._byId[n]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var n=this.modelId(t.attributes,t.idAttribute);null!=n&&delete this._byId[n],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){if(e){if(("add"===t||"remove"===t)&&n!==this)return;if("destroy"===t&&this.remove(e,i),"changeId"===t){var o=this.modelId(e.previousAttributes(),e.idAttribute),r=this.modelId(e.attributes,e.idAttribute);null!=o&&delete this._byId[o],null!=r&&(this._byId[r]=e)}}this.trigger.apply(this,arguments)}});var x="function"==typeof Symbol&&Symbol.iterator;x&&(w.prototype[x]=w.prototype.values);var I=function(t,e){this._collection=t,this._kind=e,this._index=0},C=1,S=2,T=3;x&&(I.prototype[x]=function(){return this}),I.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var t,e=this._collection.at(this._index);if(this._index++,this._kind===C)t=e;else{var n=this._collection.modelId(e.attributes,e.idAttribute);t=this._kind===S?n:[n,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var k=e.View=function(t){this.cid=n.uniqueId("view"),this.preinitialize.apply(this,arguments),n.extend(this,n.pick(t,_)),this._ensureElement(),this.initialize.apply(this,arguments)},E=/^(\S+)\s*(.*)$/,_=["model","collection","el","id","attributes","className","tagName","events"];n.extend(k.prototype,a,{tagName:"div",$:function(t){return this.$el.find(t)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=n.result(this,"events")),!t)return this;for(var e in this.undelegateEvents(),t){var i=t[e];if(n.isFunction(i)||(i=this[i]),i){var o=e.match(E);this.delegate(o[1],o[2],i.bind(this))}}return this},delegate:function(t,e,n){return this.$el.on(t+".delegateEvents"+this.cid,e,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,n){return this.$el.off(t+".delegateEvents"+this.cid,e,n),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"));else{var t=n.extend({},n.result(this,"attributes"));this.id&&(t.id=n.result(this,"id")),this.className&&(t.class=n.result(this,"className")),this.setElement(this._createElement(n.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}});var V=function(t,e,i,o){n.each(i,(function(n,i){e[i]&&(t.prototype[i]=function(t,e,n,i){switch(e){case 1:return function(){return t[n](this[i])};case 2:return function(e){return t[n](this[i],e)};case 3:return function(e,o){return t[n](this[i],F(e,this),o)};case 4:return function(e,o,r){return t[n](this[i],F(e,this),o,r)};default:return function(){var e=r.call(arguments);return e.unshift(this[i]),t[n].apply(t,e)}}}(e,n,i,o))}))},F=function(t,e){return n.isFunction(t)?t:n.isObject(t)&&!e._isModel(t)?A(t):n.isString(t)?function(e){return e.get(t)}:t},A=function(t){var e=n.matches(t);return function(t){return e(t.attributes)}};n.each([[w,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"],[g,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],(function(t){var e=t[0],i=t[1],o=t[2];e.mixin=function(t){var i=n.reduce(n.functions(t),(function(t,e){return t[e]=0,t}),{});V(e,t,i,o)},V(e,n,i,o)})),e.sync=function(t,i,o){var r=B[t];n.defaults(o||(o={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var s={type:r,dataType:"json"};if(o.url||(s.url=n.result(i,"url")||W()),null!=o.data||!i||"create"!==t&&"update"!==t&&"patch"!==t||(s.contentType="application/json",s.data=JSON.stringify(o.attrs||i.toJSON(o))),o.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),o.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){s.type="POST",o.emulateJSON&&(s.data._method=r);var a=o.beforeSend;o.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",r),a)return a.apply(this,arguments)}}"GET"===s.type||o.emulateJSON||(s.processData=!1);var c=o.error;o.error=function(t,e,n){o.textStatus=e,o.errorThrown=n,c&&c.call(o.context,t,e,n)};var l=o.xhr=e.ajax(n.extend(s,o));return i.trigger("request",i,l,o),l};var B={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var O=e.Router=function(t){t||(t={}),this.preinitialize.apply(this,arguments),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},P=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,j=/\*\w+/g,N=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(O.prototype,a,{preinitialize:function(){},initialize:function(){},route:function(t,i,o){n.isRegExp(t)||(t=this._routeToRegExp(t)),n.isFunction(i)&&(o=i,i=""),o||(o=this[i]);var r=this;return e.history.route(t,(function(n){var s=r._extractParameters(t,n);!1!==r.execute(o,s,i)&&(r.trigger.apply(r,["route:"+i].concat(s)),r.trigger("route",i,s),e.history.trigger("route",r,i,s))})),this},execute:function(t,e,n){t&&t.apply(this,e)},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var t,e=n.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(N,"\\$&").replace(P,"(?:$1)?").replace(L,(function(t,e){return e?t:"([^/?]+)"})).replace(j,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return n.map(i,(function(t,e){return e===i.length-1?t||null:t?decodeURIComponent(t):null}))}});var D=e.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},H=/^[#\/]|\s+$/g,R=/^\/+|\/+$/g,z=/#.*$/;D.started=!1,n.extend(D.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(H,"")},start:function(t){if(D.started)throw new Error("Backbone.history has already been started");if(D.started=!0,this.options=n.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(R,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,o=i.insertBefore(this.iframe,i.firstChild).contentWindow;o.document.open(),o.document.close(),o.location.hash="#"+this.fragment}var r=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),D.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(t){return!!this.matchRoot()&&(t=this.fragment=this.getFragment(t),n.some(this.handlers,(function(e){if(e.route.test(t))return e.callback(t),!0})))},navigate:function(t,e){if(!D.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var n=this.root;""!==t&&"?"!==t.charAt(0)||(n=n.slice(0,-1)||"/");var i=n+t;t=t.replace(z,"");var o=this.decodeFragment(t);if(this.fragment!==o){if(this.fragment=o,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;e.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),e.history=new D,g.extend=w.extend=O.extend=k.extend=D.extend=function(t,e){var i,o=this;return i=t&&n.has(t,"constructor")?t.constructor:function(){return o.apply(this,arguments)},n.extend(i,o,e),i.prototype=n.create(o.prototype,t),i.prototype.constructor=i,i.__super__=o.prototype,i};var W=function(){throw new Error('A "url" property or function must be specified')},M=function(t,e){var n=e.error;e.error=function(i){n&&n.call(e.context,t,i,e),t.trigger("error",t,i,e)}};return e}))}();const Pa="router";async function La(){return await Ba()}function ja(t){Backbone.history.start({pushState:!0,root:t})}let Na,Da,Ha=!1;async function Ra(t){const e=window.location.search;new URLSearchParams(e).get("new")&&(Ha=!0),Na=t,async function(){try{la.sidebar.dataLength()||async function(){Ya.createContentSpace();const t=c.keys;try{$$("tree").attachEvent("onAfterLoad",webix.once((function(){t||Ha||async function(){await s.content("fields"),c.keys&&la.sidebar.selectItem(Na)}()})))}catch(t){ka(t,Pa,"createTableSpace")}}()}catch(t){ka(t,Pa,"checkTable")}}()}function za(){const t="settings",n=$$(t);Ya.hideContent(),0==la.sidebar.dataLength()&&Ya.createContentSpace(),$$("globalTabbar").addOption({id:"settings",value:"Настройки",isOtherView:!0,info:{tree:{view:"settings"}},close:!0},!0),n?Va.showItem(n):(Ya.createContentElements(t),async function(){const t=`userprefs.owner=${(await La()).id}`;new e({id:`smarts?query=userprefs.name='/settings'+and+${t}&limit=80&offset=0`}).get().then((function(t){t?t.content.length&&function(t){if(Oa(t,Pa,"setTemplateValue")){const e=JSON.parse(t.prefs);if(e){const t=Object.keys(e),n=Object.values(e);t.length&&t.forEach((function(t,e){const i=$$(t);i&&(i.setValues(n[e]),i.config.storagePrefs=n[e])}))}}}(t.content[0]):ka(`data is ${t}`,Pa,"getDataUserprefs")}))}(),Va.showItem($$(t))),function(){const t=webix.storage.local.get("user");try{if(t){const e=t.name.toString();$$("settingsName").setValues(e)}}catch(t){ka(t,Pa,"setUserprefsNameValue")}}(),la.sidebar.close(),Ya.hideEmptyTemplates()}async function Wa(t,n,i,o){const r=function(t,e){return{name:t,prefs:e}}(n,i),s=function(t,e){const n={exists:!1};return Oa(t,Pa,"isPrefExists")&&t.forEach((function(t){t.name==e&&(n.exists=!0,n.id=t.id)})),n}(t,n);s.exists?function(t,n){new e({id:`userprefs/${t}`}).put(n)}(s.id,r):(r.owner=o.id,function(t){new e({id:"userprefs"}).post(t)}(r))}function Ma(t){return webix.storage.local.get(t)}async function qa(){await async function(){const t=await La();new e({id:"userprefs"}).get().then((function(e){if(e&&e.content){const n=e.content;Wa(n,"tabbar",Ma("tabbar"),t),function(){const t=webix.storage.local.get("userprefsOtherForm");if(t&&"1"==t.saveHistoryOpt)return!0}()&&Wa(n,"tabsHistory",Ma("tabsHistory"),t),"/index.html/content"!==window.location.pathname&&Wa(n,"userRestoreData",{editProp:Ma("editFormTempData"),filter:Ma("currFilterState")},t)}}))}(),new e({id:"/init/default/logout/",isFullPath:!0}).post().then((function(t){t?(function(){try{const t=window.location.search;Backbone.history.navigate("/content"+t,{trigger:!0}),window.location.reload()}catch(t){ka(t,Pa,"backPage")}}(),la.sidebar.clear(),function(){try{webix.storage.local.clear()}catch(t){ka(t,Pa,"clearStorage")}}()):ka("data is "+t,Pa,"logoutRouter")}))}function Ua(){la.sidebar.dataLength()||Ya.createContentSpace(),Ya.hideContent(),function(){const t=$$("user_auth");$$("globalTabbar").addOption({id:"cp",value:"Смена пароля",isOtherView:!0,info:{tree:{view:"cp"}},close:!0},!0),t?Va.showItem(t):(Ya.createContentElements("cp"),Va.showItem($$("user_auth")))}(),la.sidebar.close(),function(){const t=webix.storage.local.get("user"),e=$$("authName");try{if(t){const n=t.name.toString();e.setValues(n)}}catch(t){ka(t,Pa,"setUserValues")}}(),Ya.hideEmptyTemplates()}function Ja(t){Da=t,Da||(la.dashboards.create(),la.tables.create(),la.forms.create()),"treeTempl"==Da&&la.treeEdit.create(),"cp"==Da&&la.user_auth.create(),"settings"==Da&&la.settings.create()}async function Ka(){o.whoami||await r("whoami"),o.whoami?(Va.hideItem($$("userAuth")),Va.showItem($$("mainLayout")),function(){const t=o.whoami.content,e={id:t.id,name:t.first_name,username:t.username};fa("user",JSON.stringify(e))}(),Ja(),s.content("mmenu").then((function(t){if(t){const t=a.content;la.sidebar.load(t),la.header.load(t)}}))):(Backbone.history.navigate("/",{trigger:!0}),window.location.reload())}class Ya{static hideEmptyTemplates(){Va.removeItem($$("webix__null-content")),Va.hideItem($$("webix__none-content"))}static hideContent(){!function(){const t=$$("container").getChildViews();t.length?t.forEach((function(t){const e=t.config.view;"scrollview"!=e&&"layout"!=e||Va.hideItem($$(t.config.id))})):ka("array length is null","routerConfig/hideAllElements","hideAllElements")}()}static async createContentSpace(){await Ka()}static async loadSpace(){la.sidebar.dataLength()||await Ka()}static createContentElements(t){Ja(t)}}function Ga(){const t=$$("formAuth");t&&t.isDirty()&&(t.markInvalid("username",""),t.markInvalid("password","Неверный логин или пароль"))}const Qa="Поле должно быть заполнено";const Xa={hidden:!0,id:"userAuth",cols:[{view:"align",align:"middle,center",body:(new(Backbone.Router.extend({routes:{"":"index",content:"content",settings:"settings",cp:"cp",logout:"logout","tree/:id":"tree","experimental/:id":"experimental"},content:function(){Ya.createContentSpace()},index:function(){!async function(){o.whoami||await r("whoami"),o.whoami?function(){try{Backbone.history.navigate("content",{trigger:!0})}catch(t){console.log(t+" router goToContentPage")}}():(Va.hideItem($$("mainLayout")),Va.showItem($$("userAuth")))}()},tree:function(t){Ra(t)},cp:function(){Ua()},settings:function(){za()},experimental:function(){Ya.hideEmptyTemplates(),Ya.hideContent(),la.sidebar.dataLength()||Ya.createContentSpace(),function(){const t="treeTempl";$$(t)||Ya.createContentElements(t),la.treeEdit.showView(),la.treeEdit.load()}(),la.sidebar.close()},logout:function(){qa()}})),{view:"form",id:"formAuth",width:250,borderless:!0,elements:[{view:"text",label:"Логин",name:"username",invalidMessage:Qa,on:{onItemClick:function(){$$("formAuth").clearValidation()}}},{view:"text",label:"Пароль",name:"password",invalidMessage:Qa,type:"password",icon:"password-icon wxi-eye",keyPressTimeout:12e4,on:{onItemClick:function(t,e){!function(t,e){const n=t.target.className,i=e.getInputNode();function o(e){webix.html.removeCss(t.target,e)}function r(e,n){webix.html.addCss(t.target,n),i.type=e}n.includes("password-icon")&&(o("wxi-eye-slash"),o("wxi-eye"),"text"==i.type?r("password","wxi-eye"):r("text","wxi-eye-slash")),$$("formAuth").clearValidation()}(e,this)},onTimedKeyPress:function(){this.setValue("")}}},{view:"button",value:"Войти",css:"webix_primary",hotkey:"enter",align:"center",click:function(){$$("formAuth").validate(),function(){const t=function(){const t={},e=$$("formAuth");try{const n=e.getValues();t.un=n.username,t.np=n.password}catch(t){console.log(t+" login function createSentObj")}return t}(),n=$$("formAuth");new e({id:"/init/default/login",isFullPath:!0,errorActions:Ga}).post(t).then((function(t){t?t.content&&(n&&n.clear(),Backbone.history.navigate("content",{trigger:!0}),window.location.reload()):Ga()}))}()}}],rules:{username:webix.rules.isNotEmpty,password:webix.rules.isNotEmpty},elementsConfig:{labelPosition:"top"}})}]},Za=850;function tc(t,e,n){t.isVisible()&&(t.config.width=window.innerWidth-45,t.resize(),Va.hideItem(e),Va.showItem(n))}function ec(t,e,n){t.isVisible()&&350!==t.config.width&&(t.config.width=350,t.resize(),Va.showItem(e),Va.hideItem(n))}function nc(){window.addEventListener("resize",(function(){!async function(){["forms","dashboards","tables","userprefs","user_auth"].forEach((function(t,e){const n=$$(t);var i;n&&n.isVisible()&&("forms"==(i=t)?function(){const t=$$("formsTools"),e=$$("formsContainer"),n=$$("formsTools-resizer"),i=$$("table-backFormsBtnFilter");window.innerWidth<Za&&(tc(t,e,i),Va.hideItem(n)),window.innerWidth>Za&&(ec(t,e,i),Va.showItem(n))}():"dashboards"==i?(function(){const t=$$("dashboardTool"),e=$$("dashboardInfoContainer"),n=$$("dash-backDashBtn");window.innerWidth<Za&&tc(t,e,n),window.innerWidth>Za&&ec(t,e,n)}(),function(){const t=$$("dashboardInfoContainer"),e=$$("dashboardContext");window.innerWidth<Za&&tc(e,t),window.innerWidth>Za&&ec(e,t)}()):"tables"==i&&(function(){const t=$$("tableContainer"),e=$$("table-editForm"),n=$$("table-backTableBtn"),i=$$("tree");$$("container").$width<Za&&e.isVisible()&&Va.hideItem(i),window.innerWidth<Za&&tc(e,t,n),window.innerWidth>Za&&ec(e,t,n)}(),function(){const t=$$("filterTableBarContainer"),e=$$("tableContainer"),n=$$("table-backTableBtnFilter"),i=$$("tree");window.innerWidth<Za&&tc(t,e,n),$$("container").$width<Za&&t.isVisible()&&Va.hideItem(i),window.innerWidth>Za&&ec(t,e,n)}()))}))}(),function(){const t=$$("tree"),e=$$("sideMenuResizer"),n=$$("sidebarContainer");window.innerWidth<Za?(Va.hideItem(t),Va.hideItem(e),Va.hideItem(n),t.config.adaptiveState=!0):t.config.adaptiveState&&(Va.showItem(t),Va.showItem(e),Va.showItem(n),t.config.adaptiveState=!1),window.innerWidth>Za&&$$("tree")&&function(){try{t&&(t.config.width=250,t.resize())}catch(t){ka(t,"adaptive","resizeSidebar => resizeTree")}}()}(),window.innerWidth>Za&&$$("header").getChildViews().forEach((function(t){t.show()}))}),!0)}console.log("expa 1.0.85");const ic={hidden:!0,id:"mainLayout",rows:[{id:"mainContent",css:"webix_mainContent",cols:[{rows:[la.header.create(),{id:"adaptive",rows:[]},{cols:[{id:"sidebarContainer",rows:[k("loadTreeOverlay"),la.sidebar.create()]},{id:"sideMenuResizer",view:"resizer",css:"webix_resizer-hide"},{rows:[function(){const t={view:"tabbar",id:"globalTabbar",css:"global-tabbar",value:"container",tooltip:"#value#",optionWidth:300,multiview:!0,options:[],on:{onBeforeTabClick:function(){la.tables.defaultState("edit",!1),la.tables.defaultState("filter"),la.dashboards.defaultState(),la.forms.defaultState(),ia=this.getValue()},onAfterTabClick:function(t){la.tables.filter.clearAll(),function(t){const e=$$("globalTabbar").getOption(t),n=e.info.tree,i=e.info.temp;n&&(Gs(n,function(t){let e=!0;return null==ia&&(e=!1),e}(),e.isOtherView),i&&Qs(i,n.field))}(t),function(t){const e={tabs:$$("globalTabbar").config.options,select:t};webix.storage.local.put("tabbar",e)}(t)},setStorageData:function(){const t=webix.storage.local.get("tabbar");t&&t.tabs.length?function(t){const e=$$("globalTabbar"),n=t.tabs,i=t.select;if(n&&n.length&&n.forEach((function(t){e.addOption(t,!1)})),i)e.setValue(i),oa("onBeforeTabClick",i),oa("onAfterTabClick",i);else{const t=e.config.options,n=t[t.length-1];if(n){const t=n.id;e.setValue(t)}}}(t):$$("globalTabbar").addOption({id:"container",value:"Новая вкладка",info:{},close:!0},!0)},onBeforeTabClose:function(t){const e=this.getOption(t);e&&e.info&&la.tabs.addRemovedTab(e.info.tree);const n=this,i=n.getOption(t).info.dirty;if(function(t){if($$("globalTabbar").getValue()==t)return!0}(t))la.getGlobalModalBox().then((function(e){e&&n.removeOption(t)}));else if(i){n.setValue(t),oa("onBeforeTabClick",t),oa("onAfterTabClick",t);const e=la.tabs.getInfo();e.isClose=!0,la.tabs.setInfo(e)}else n.removeOption(t);return!1},onOptionRemove:function(t,e){la.tabs.removeTab(e)}}};return{rows:[{height:6},{cols:[new l({config:{id:"addTabBtn",icon:"icon-plus",click:function(){la.tabs.addTab()}},titleAttribute:"Добавить вкладку"}).transparentView(),t,Ys()]},{height:6}]}}(),{id:"globalTabCells",css:"tabbar_globalCells",cells:[{id:"container",cols:[{view:"align",align:"middle,center",id:"webix__none-content",body:{borderless:!0,template:"Выберите элемент дерева",height:50,width:210,css:{color:"#858585","font-size":"14px!important"}}}]}]}]}]}]}]},{view:"resizer",id:"log-resizer"},xa]};try{webix.ready((function(){webix.protoUI({name:"edittree"},webix.EditAbility,webix.ui.tree),webix.ui({view:"scrollview",type:"clean",id:"layout",css:"layoutContainer",scroll:"y",body:{cells:[{},Xa,ic]}}),ha(),nc(),window.location.host.includes("localhost:3000")?ja("/index.html/"):ja("/init/default/spaw/"),function(){const t=$$("tree");window.innerWidth,function(){if(window.innerWidth<1200){const e=$$("editTableBarContainer");t.attachEvent("onAfterLoad",(function(){Va.hideItem(e)})),Va.hideItem(e)}}()}(),function(){let t=null;webix.event(document.body,"mousedown",(e=>{const n=$$(e);n&&n.getInputNode&&(t=n)})),webix.event(document,"click",(e=>{const n=$$(e);t&&n&&n.config.id!==t.config.id&&(e.cancelBubble=!0,webix.html.preventEvent(e)),t=null}),{capture:!0})}(),window.addEventListener("popstate",(function(t){window.location.replace(window.location.href),window.location.reload()})),function(){let t;function e(){try{"/index.html"!==window.location.pathname&&"/"!==window.location.pathname&&"/init/default/spaw"!==window.location.pathname&&(clearTimeout(t),t=setTimeout(n,6e5))}catch(t){ka(t,"autoLogout","resetTimer")}}window.onload=e,window.onmousemove=e,window.onmousedown=e,window.ontouchstart=e,window.onclick=e,window.onkeypress=e,window.addEventListener("scroll",e,!0)}(),webix.editors.customDate=webix.extend({render:function(){return webix.html.create("div",{class:"webix_dt_editor"},"<input class='webix_custom-date-editor' id='custom-date-editor' type='text'>")}},webix.editors.text),webix.i18n.setLocale("ru-RU"),webix.i18n.parseFormat="%d.%m.%Y %H:%i:%s",webix.i18n.setLocale(),webix.Date.startOnMonday=!0,webix.message.position="bottom"}))}catch(t){alert("Ошибка при выполнении "+t),ka(t,"app","layout")}})();