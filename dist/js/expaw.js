(()=>{"use strict";const e={id:"dashboardTool",css:"webix_dashTool",rows:[]};function t(e,t,i){console.log(e),a("error",t+" function "+i+": "+e.status+" "+e.statusText+" "+e.responseURL+" ("+e.responseText+") ")}function i(e,t,i){console.log(e),a("error",t+" function "+i+": "+e)}function n(e,t){"undefined"!=typeof Storage&&localStorage.setItem(e,t)}const o={};function r(e){if("/index.html"!==window.location.pathname&&"/init/default/spaw"!==window.location.pathname||"whoami"==e)return webix.ajax().get(`/init/default/api/${e}.json`).then((function(t){o[e]=t.json();try{"fields"==e&&o[e]&&(o.tableNames=function(e){let t=[];try{Object.values(e).forEach((function(i,n){t.push({id:Object.keys(e)[n],name:i.plural?i.plural:i.singular})}))}catch(e){i(e,"globalStorage","getTableNames")}return t}(o[e].content))}catch(e){i(e,"globalStorage","getData")}return o[e]})).catch((e=>{t(e,"globalStorage","getData"),function(e){401===e.status&&"/index.html"!==window.location.pathname&&"/init/default/spaw/"!==window.location.pathname&&Backbone.history.navigate("/",{trigger:!0})}(e)}))}function a(e,t,a){const l=new Date;let s=`${l.getDate()}.${String(l.getMonth()+1).padStart(2,"0")}.${l.getFullYear()} ${l.getHours()}:${String(l.getMinutes()).padStart(2,"0")}:${String(l.getSeconds()).padStart(2,"0")}`;async function c(e,n){let a;var l;o.tableNames||await r("fields"),o.tableNames&&function(){try{o.tableNames.forEach((function(t,i){"version"==e?a="Expa v1.0.35":t.id==e&&(a=t.name)}))}catch(e){i(e,"logBlock","findTableName")}}(),(l=a)||(l="expa"),$$("logBlock-list").add({date:s,value:t,src:l})}!function(){try{let e=null;if($$("tree").getSelectedItem())e=$$("tree").getSelectedItem().id;else{let t=window.location.pathname,i=t.lastIndexOf("/");e=t.slice(i+1)}a?c(a):e&&c(e)}catch(e){i(e,"logBlock","initLogMsg")}}(),function(){let t=function(){let e,t=document.querySelector(".webix_log-block");try{t&&t.querySelectorAll(".webix_list_item").forEach((function(t,i){e=i}))}catch(e){i(e,"logBlock","getItemIndex")}return e}(),o=document.querySelectorAll(".webix_list_item")[t];"error"==e&&(function(){try{void 0!==o&&o.style.setProperty("color","red","important")}catch(e){i(e,"logBlock","setStyle")}}(),function(){try{"wxi-eye"==$$("webix_log-btn").config.icon&&($$("logLayout").config.height=90,$$("logLayout").resize(),$$("webix_log-btn").setValue(2),$$("webix_log-btn").config.icon="wxi-eye-slash",$$("webix_log-btn").refresh(),n("LogVisible",JSON.stringify("show")))}catch(e){i(e,"logBlock","openLog")}}())}()}let l=0;const s={id:"logLayout",height:80,rows:[{template:"<div class='webix_log-headline'>Системные сообщения</div>",height:30},{id:"logBlock-list",css:"webix_log-block",view:"list",template:"#date# — #value#  (Источник: #src#)",data:[],on:{onAfterLoad:function(){try{a("success","Интерфейс загружен","version")}catch(e){i(e,"logBlock","logBlock onAfterLoad")}},onAfterAdd:function(e,t){"wxi-eye"==$$("webix_log-btn").config.icon?function(){try{""==$$("webix_log-btn").config.badge&&(l=0),l++,$$("webix_log-btn").config.badge=l,$$("webix_log-btn").setValue(1),$$("webix_log-btn").refresh()}catch(e){i(e,"logBlock","logBlock onAfterAdd function addNotify")}}():"wxi-eye-slash"==$$("webix_log-btn").config.icon&&function(){try{l=0,$$("webix_log-btn").config.badge="",$$("webix_log-btn").setValue(2),$$("webix_log-btn").refresh()}catch(e){i(e,"logBlock","logBlock onAfterAdd function clearNotify")}}()}}}]};function c(e,t,i=!1){try{return $$("webix_log-btn").setValue(2),l=0,a("error",i?"ОШИБКА "+e+": "+t:"ОШИБКА "+e+": "+t.stack)}catch(t){console.log(t),alert("Ошибка при выполнении "+t),window.stop()}}function u(e,t,i,n){return $$("webix_log-btn").setValue(2),l=0,a("error","ОШИБКА "+e+": СТАТУС: "+t+" "+i+". ПОДРОБНОСТИ: "+n)}let d,f;function h(e,n,o,r){let l=[];if("get"==o)if("refresh"==r)try{e.forEach(((e,t)=>{e.id.includes("customCombo")?l.push(e.name+"="+$$(e.id).getText()):(e.id.includes("customInputs")||e.id.includes("customDatepicker"))&&l.push(e.name+"="+$$(e.id).getValue())}));const t=webix.ajax(n+"?"+l.join("&"));t.then((function(e){if("i"==e.json().err_type)try{$$("table-view").clearAll(),0!==(e=e.json().content).length?($$("table-view").hideOverlay("Ничего не найдено"),$$("table-view").parse(e)):$$("table-view").showOverlay("Ничего не найдено"),d=$$("table-view").count(),$$("table-view-findElements").setValues(d.toString())}catch(e){console.log(e),a("error","content function submitBtn: "+e)}else a("error","content function submitBtn: "+e.err)})),t.fail((function(e){console.log(e),a("error","content function submitBtn ajax: "+e.status+" "+e.statusText+" "+e.responseURL)}))}catch(e){console.log(e),c("018-000",e)}else"download"==r&&webix.ajax().response("blob").get(n,(function(e,t,i){try{webix.html.download(t,"table.docx")}catch(e){console.log(e),c("018-000",e)}})).catch((e=>{console.log(e),u("018-000",e.status,e.statusText,e.responseURL)}));else if("post"==o)try{e.forEach(((e,n)=>{if(e.id.includes("customUploader")){let n=Object.values($$(e.id).files.data.pull)[0],o=$$(e.id).config.upload;const r=webix.ajax().post(o,n);r.then((function(e){e=e.json(),console.log(e),"i"!==e.err_type&&i(e.err,"content","submitBtn post upload")})),r.fail((function(e){t(e,"content","submitBtn post upload")}))}}))}catch(e){console.log(e),c("018-000",e)}}function p(e){return new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get("/init/default/api/"+e).then((function(e){try{e=e.json().content;let t,i=[];return e.forEach(((e,n)=>{let o=0;for(;o<=Object.values(e).length;){if("string"==typeof Object.values(e)[o]){t=Object.keys(e)[o];break}o++}if(null==e[t])for(;o<=Object.values(e).length;){if("number"==typeof Object.values(e)[1]){t=Object.keys(e)[1];break}o++}i.push({id:e.id,value:e[t]})})),i}catch(e){console.log(e),c("018-000",e)}})).catch((e=>{console.log(e),a("error","content function getComboOptions: "+e.status+" "+e.statusText+" "+e.responseURL+" ("+e.responseText+") ")}))}}})}function $(e,t){let i,n,l,s,u;function f(){let i=o.fields.content[t],n=i.inputs;!function(){if($$("contextActionsBtn")&&$$(l.config.id).removeView($$("contextActionsBtn")),i.inputs){let t;t=function(){let t=[];function o(e,t){return new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get("/init/default/api/"+e[t].apiname).then((function(e){let t=e.json().content,i=[];try{return void 0!==t[0].name?t.forEach((function(e,t){i.push({id:t+1,value:e.name})})):t.forEach((function(e,t){i.push({id:t+1,value:e})})),i}catch(e){console.log(e),c("018-000",e)}})).catch((e=>{console.log(e),a("error","content function getOptionData: "+e.status+" "+e.statusText+" "+e.responseURL)}))}}})}function r(e){let t=e.getParentView().getChildViews(),i=[];return t.forEach(((e,t)=>{void 0!==e.config.id&&("text"==e.config.view?i.push({id:e.config.id,name:"substr"}):"combo"==e.config.view?i.push({id:e.config.id,name:"valtype"}):("uploader"==e.config.view||"datepicker"==e.config.view)&&i.push({id:e.config.id}))})),i}return Object.keys(i.inputs).forEach(((a,l)=>{if("string"==n[a].type)t.push(function(e,t){return{view:"text",placeholder:n[e].label,id:"customInputs"+t,height:48,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",n[e].comment)},onChange:function(){$$("customInputs").getChildViews().forEach((function(e,t){"button"!=e.config.view||$$(e.config.id).isEnabled()||$$(e.config.id).enable()}))}}}}(a,l));else if("apiselect"==n[a].type)t.push(function(e,t){return{view:"combo",height:48,id:"customCombo"+t,placeholder:n[e].label,labelPosition:"top",options:{data:o(n,e)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",n[e].comment)}}}}(a,l));else if("submit"==n[a].type||"button"==n[a].type){let o=n[a].action,s=i.actions[o];"DELETE"==s.verb&&"submit"!==o?function(t){let i=$$(e).getColumns().length;$$(e).config.columns.splice(i,0,{id:"action"+t,header:"Действие",maxWidth:100,template:"{common.trashIcon()}"}),$$(e).refreshColumns()}(l):"DELETE"==s.verb?t.push(function(e,t,i){return{view:"button",id:"customBtnDel"+i,css:"webix_danger",type:"icon",disabled:!0,icon:"wxi-trash",inputHeight:48,height:48,value:n[e].label,click:function(e){h(r(this),t.url,"delete")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",n[e].comment)}}}}(a,s,l)):t.push(function(e,t,i){return{view:"button",css:"webix_primary",id:"customBtn"+i,inputHeight:46,height:46,value:n[e].label,click:function(e){let i=r(this);"GET"==t.verb?"refresh"==t.rtype?h(i,t.url,"get","refresh"):"download"==t.rtype&&h(i,t.url,"get","download"):"POST"==t.verb?h(i,t.url,"post"):"download"==t.verb&&h(i,t.url,"get","download"),$$("contextActionsPopup")&&$$("contextActionsPopup").hide()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",n[e].comment)}}}}(a,s,l))}else"upload"==n[a].type?t.push(function(e,t){return{view:"uploader",value:"Upload file",id:"customUploader"+t,name:"customUploader"+t,height:48,autosend:!1,upload:i.actions.submit.url,label:n[e].label,labelPosition:"top",click:function(){$$("contextActionsPopup")&&$$("contextActionsPopup").destructor()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",n[e].comment)},onAfterFileAdd:function(e){}}}}(a,l)):"datetime"==n[a].type?t.push(function(e,t){return{view:"datepicker",format:"%d.%m.%Y %H:%i:%s",placeholder:n[e].label,id:"customDatepicker"+t,timepicker:!0,labelPosition:"top",height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",n[e].comment)},onChange:function(){$$("customInputs").getChildViews().forEach((function(e,t){"button"!=e.config.view||$$(e.config.id).isEnabled()||$$(e.config.id).enable()}))}}}}(a,l)):"checkbox"==n[a].type&&t.push(function(e,t){return{view:"checkbox",id:"customСheckbox"+t,css:"webix_checkbox-style",labelRight:n[e].label,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",n[e].comment)},onChange:function(){$$("customInputs").getChildViews().forEach((function(e,t){"button"!=e.config.view||$$(e.config.id).isEnabled()||$$(e.config.id).enable()}))}}}}(a,l))})),t}(),window.innerWidth>830?function(e){e.forEach((function(e,t){"text"==e.view&&(e.maxWidth=300,e.minWidth=150),"combo"==e.view&&(e.width=250),"button"==e.view&&"wxi-trash"==e.icon&&(e.width=100),"button"==e.view&&"webix_primary"==e.css&&(e.maxWidth=550,e.minWidth=100),"datepicker"==e.view&&(e.width=300,e.minWidth=100),"checkbox"==e.view&&(e.minWidth=220)}));let t={id:"customInputs",css:"webix_custom-inp",cols:e},i=$$("table-view-filterId").getParentView();$$(i.config.id).addView({id:"customInputsMain",cols:[t]},2)}(t):function(e){e.forEach((function(e,t){e.bottomPadding=10})),e.push({});let t={id:"customInputsAdaptive",rows:[{id:"customInputs",css:"webix_custom-inp",rows:e}]};$$(l.config.id).addView({view:"button",id:"contextActionsBtnAdaptive",maxWidth:100,value:"Действия",css:"webix_primary",popup:webix.ui({view:"popup",css:"webix_popup-actions-container webix_popup-config",modal:!0,id:"contextActionsPopup",escHide:!0,position:"center",body:{rows:[{cols:[{template:"Доступные действия",css:"webix_template-actions",borderless:!0,height:40},{view:"button",id:"buttonClosePopupActions",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("contextActionsPopup")&&$$("contextActionsPopup").hide()}}]},{view:"scrollview",borderless:!0,scroll:"y",body:{id:"contextActionsPopupContainer",css:"webix_context-actions-popup",rows:[t]}}]}}),click:function(){$$("contextActionsPopup").config.height!==$$("customInputs").$height+50&&($$("contextActionsPopup").config.height=$$("customInputs").$height+50,$$("contextActionsPopup").resize());let e=window.innerWidth-100;$$("contextActionsPopup").$width>200&&($$("contextActionsPopup").config.width=e,$$("contextActionsPopup").resize())}},2)}(t)}}()}try{s=t,u=$$("tree").getItem(t),u||(u=t),e.includes("view")?(i="table-view-search",n="table-view-findElements",l=$$("table-view-filterId").getParentView()):(i="table-search",n="table-findElements",l=$$("table-filterId").getParentView()),null==u?a("error","Данные не найдены"):($$(e).clearAll(),"table-view"==e&&($$("contextActionsPopup")&&$$("contextActionsPopup").destructor(),$$("contextActionsBtnAdaptive")&&l.removeView($$("contextActionsBtnAdaptive")),$$("customInputs")&&$$("customInputs").getParentView().removeView($$("customInputs")),$$("customInputsMain")&&$$("customInputsMain").getParentView().removeView($$("customInputsMain"))),async function(){o.fields||await r("fields"),o.fields&&(o.fields.content.treeTemplate={fields:{id:{type:"id",unique:!1,notnull:!1,length:512,label:"Id",comment:null,default:"None"},pid:{type:"reference trees",unique:!1,notnull:!1,length:512,label:"Родитель",comment:null,default:"None"},owner:{type:"reference auth_user",unique:!1,notnull:!1,length:512,label:"Владелец",comment:null,default:"None"},ttype:{type:"integer",unique:!1,notnull:!1,length:512,label:"Тип",comment:"Тип записи|1=системная;2=пользовательская|Перечисление",default:"1"},name:{type:"string",unique:!1,notnull:!1,length:100,label:"Наименование",comment:null,default:""},descr:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Описание",comment:null,default:""},value:{type:"string",unique:!1,notnull:!1,length:1e3,label:"Значение",comment:null,default:""},cdt:{type:"datetime",unique:!1,notnull:!1,length:512,label:"Создано",comment:null,default:"now"}},singular:"Классификатор-пример",ref_name:"name",plural:"Классификаторы-пример",type:"treeConf"},function(i){let n,r,a=!1,l=o.fields.content[t];if(i.forEach((function(e,t){"action"==e.type&&"detail"==l.actions[e.id].rtype&&(a=!0,n=t,r=e.id)})),void 0!==r){let t=l.actions[r].url;a&&($$(e).config.columns.splice(0,0,{id:"action-first"+n,maxWidth:130,src:t,header:"Подробнее",template:"<span class='webix_icon wxi-angle-down'></span> "}),$$(e).refreshColumns())}}(function(){let i,n=o.fields.content[t],r=n.fields,a=Object.keys(n.fields),l=[];return a.forEach((function(e){if(i=r[e].type,i.includes("reference")){let t=i.slice(10);r[e].editor="combo",r[e].collection=p(t),r[e].template=function(e,t,i,n){let o=n.collection.getItem(e[n.id]);return o?o.value:""}}else"datetime"==i?(r[e].format=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s:%S"),r[e].editor="date"):"string"==i||"text"==i?r[e].editor="text":"integer"==i?(r[e].editor="text",r[e].numberFormat="1 111"):"boolean"==i&&(r[e].editor="combo",r[e].collection=[{id:1,value:"Да"},{id:2,value:"Нет"}]);r[e].id=e,r[e].fillspace=!0,r[e].header=r[e].label,"id"==r[e].id&&function(){let t=webix.storage.local.get("userprefsOtherForm");t&&"2"==t.visibleIdOpt&&(r[e].hidden=!0)}(),l.push(r[e])})),$$(e).refreshColumns(l),l}()),f(),function(){let i=o.fields.content[t];function r(t){$$(t).load({$proxy:!0,load:function(i,o){return webix.ajax().get("/init/default/api/"+s,{success:function(i,o,r){o=o.json().content,$$(t).config.idTable=s;try{$$(t).clearAll(),"table"==t&&($$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable(),$$("table-filterId").isEnabled()||$$("table-filterId").enable(),$$("table-exportBtn").isEnabled()||$$("table-exportBtn").enable()),function(){let e,i=$$(t).getColumns(),n=[];i.forEach((function(e,t){"datetime"==e.type&&n.push(e.id)})),o.forEach((function(t,i){function o(i){t[i]&&(e=new Date(t[i]),t[i]=e)}n.forEach((function(e,t){o(e)}))}))}(),0!==o.length?($$(e).hideOverlay("Ничего не найдено"),$$(e).parse(o)):($$(e).showOverlay("Ничего не найдено"),$$(e).clearAll()),d=$$(e).count(),$$(n).setValues(d.toString()),"table"==e&&$$("table-findElements").setValues(d.toString())}catch(e){console.log(e),a("error","content createRow: "+e)}},error:function(e,t,i){!function(){d="-";try{$$(n).setValues(d.toString()),$$("table-findElements").setValues(d.toString()),$$("table-newAddBtnId").isEnabled()&&$$("table-newAddBtnId").disable(),$$("table-filterId")&&$$("table-filterId").disable(),$$("table-exportBtn")&&$$("table-exportBtn").disable()}catch(e){console.log(e)}}()}}).catch((e=>{console.log(e),console.log(e.status),401==e.status&&($$("popupNotAuth")||function(){const e={view:"button",id:"buttonClosePopup",css:"webix_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){try{$$("popupNotAuth")&&$$("popupNotAuth").destructor()}catch(e){}}},t={view:"button",css:"webix_btn-go-login",height:46,value:"Войти",click:function(){!function(){try{$$("popupNotAuth")&&$$("popupNotAuth").destructor()}catch(e){}}(),function(){try{Backbone.history.navigate("/",{trigger:!0}),window.location.reload()}catch(e){}}()}};webix.ui({view:"popup",id:"popupNotAuth",css:"webix_popup-prev-href",width:340,height:125,modal:!0,position:"center",body:{rows:[{rows:[{cols:[{template:"Вы не авторизованы",width:250,css:"webix_template-not-found",borderless:!0,height:20},{},e]},{template:"Войдите в систему, чтобы продолжить.",css:"webix_template-not-found-descr",borderless:!0,height:35},t,{height:20}]}]}}).show()}()),a("error","content createRow: "+e.status+" "+e.statusText+" "+e.responseURL)}))}})}"dbtable"==i.type?r("table"):"tform"==i.type&&r("table-view"),function(){if(i.autorefresh){let e=webix.storage.local.get("userprefsOtherForm");e&&void 0!==e.autorefCounterOpt&&(e.autorefCounterOpt>=15e3?setInterval((function(){"dbtable"==i.type?r("table"):"tform"==i.type&&r("table-view")}),e.autorefCounterOpt):setInterval((function(){"dbtable"==i.type?r("table"):"tform"==i.type&&r("table-view")}),12e4))}}()}())}())}catch(e){console.log(e),c("018-000",e)}}function b(e,t=!1){let i;function n(e,t,n=!1){webix.ajax().get(e,{success:function(l,s,u){let d=[{type:"wide",rows:[]}],f=s.json().charts,h={};try{if($$("dashBodyScroll")&&$$("dashBodyScroll").getParentView().removeView($$("dashBodyScroll")),n||($$("dashboardInfoContainerInner")&&$$("dashboardInfoContainerInner").getParentView().removeView($$("dashboardInfoContainerInner")),$$("dash-template")&&$$("dash-template").getParentView().removeView($$("dash-template")),$$("dashboard-tool-main")&&$$("dashboard-tool-main").getParentView().removeView($$("dashboard-tool-main")),$$("dashboard-tool-adaptive")&&$$("dashboard-tool-adaptive").getParentView().removeView($$("dashboard-tool-adaptive"))),null==f)$$("dashboardTool").addView({view:"scrollview",id:"dashboard-tool-main",borderless:!0,css:{margin:"20px!important",height:"50px!important"},body:{view:"flexlayout",rows:[]}},0),$$("dashboardTool").addView({rows:[{template:"",id:"dash-template",css:"webix_style-template-count webix-block-title",borderless:!1,height:40}]},1),$$("dashboardInfoContainer").addView({view:"scrollview",scroll:"auto",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",borderless:!0,body:{view:"flexlayout",rows:[]}}]}}),a("error","Ошибка при загрузке данных");else{let e;async function a(){o.tableNames||await r("fields"),o.tableNames&&o.tableNames.forEach((function(t,n){t.id==i&&(e=t.name)}))}f.forEach((function(e,t){h=e.title,delete e.title,e.borderless=!0,e.minWidth=250,d[0].rows.push({css:"webix_dash-chart-headline",rows:[{template:h,borderless:!0,css:{"font-weight":"400!important","font-size":"17px!important"},height:35},e]})})),i.includes("single")&&(i=i.slice(0,i.search("-single"))),a(),n?$$("dashboardInfoContainerInner").addView({view:"scrollview",scroll:"y",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",rows:d}]}}):(window.innerWidth>830?$$("dashboardTool").addView({id:"dashboard-tool-main",padding:20,minWidth:250,rows:[{id:"dashboardToolHeadContainer",cols:[{template:"Фильтр",height:30,css:"webix_dash-filter-headline",borderless:!0},{view:"button",id:"buttonClosePopupDashFilter",css:"webix_close-btn",type:"icon",hotkey:"esc",hidden:!0,width:25,icon:"wxi-close",click:function(){$$("contextDashFilterPopup")&&$$("contextDashFilterPopup").hide()}}]},{rows:t}]}):$$("dashFilterBtn")||$$("dashboardInfoContainer").addView({id:"dashboard-tool-adaptive",cols:[{view:"button",id:"dashFilterBtn",value:"Фильтры",css:{margin:"10px 0px!important"},height:46,margin:10,popup:webix.ui({view:"popup",css:"webix_popup-dash-container webix_popup-config",modal:!0,id:"contextDashFilterPopup",escHide:!0,position:"center",body:{id:"contextDashFilterPopupContainer",rows:[{id:"dashToolInputsAdaptive",rows:[{id:"dashboardToolHeadContainer",cols:[{template:"Фильтр",height:30,css:"webix_dash-filter-headline",borderless:!0},{view:"button",id:"buttonClosePopupDashFilter",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("contextDashFilterPopup")&&$$("contextDashFilterPopup").hide()}}]},{rows:t}]}]}}),click:function(){let e=window.innerWidth-130;e>200&&($$("contextDashFilterPopupContainer").config.width=e,$$("contextDashFilterPopupContainer").resize())}}]},0),$$("dashboardInfoContainer").addView({id:"dashboardInfoContainerInner",rows:[{template:e,id:"dash-template",css:"webix_style-template-count webix_block-title",borderless:!1,height:75},{view:"scrollview",scroll:"y",id:"dashBodyScroll",borderless:!0,body:{id:"dashboardBody",css:"dashboardBody",cols:[{id:"dashboard-charts",view:"flexlayout",css:"webix_dash-charts-flex",rows:d}]}}]}))}"wxi-eye"==$$("webix_log-btn").config.icon?($$("logLayout").config.height=90,$$("logLayout").resize(),$$("logLayout").config.height=5,$$("logLayout").resize()):($$("logLayout").config.height=5,$$("logLayout").resize(),$$("logLayout").config.height=90,$$("logLayout").resize()),(e.includes("?")||e.includes("sdt")&&e.includes("edt"))&&a("success","Данные обновлены")}catch(e){console.log(e),c("018-004",e)}},error:function(e,t,i){u("018-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),u("018-000",e.status,e.statusText,e.responseURL)}))}e?i=e:$$("tree").getSelectedItem()&&(i=$$("tree").getSelectedItem().id);try{$$("dashBodyScroll")&&$$("dashBodyScroll").getParentView().removeView($$("dashBodyScroll")),$$("dashBodyScroll")||async function(){o.fields||await r("fields"),o.fields&&function(){let e,t,r,l=o.fields.content,s=[];console.log(i),Object.values(l).forEach((function(o,c){if("dashboard"==o.type&&Object.keys(l)[c]==i){let i=o.inputs;n(o.actions.submit.url,function(i,o){function r(e,t){let i={view:"datepicker",format:"%d.%m.%y",editable:!0,value:new Date,placeholder:t.label,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",t.comment)}}};if("first"==e){let e=i;return e.id="dashDatepicker_sdt",e}if("last"==e){let e=i;return e.id="dashDatepicker_edt",e}}function l(e){let t={view:"datepicker",format:"%H:%i:%s",placeholder:"Время",height:48,editable:!0,value:"00:00:00",type:"time",seconds:!0,suggest:{type:"timeboard",hotkey:"enter",body:{button:!0,seconds:!0,value:"00:00:00",twelve:!1,height:110}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Часы, минуты, секунды")}}};if("first"==e){let e=t;return e.id="dashDatepicker_sdt-time",e}if("last"==e){let e=t;return e.id="dashDatepicker_edt-time",e}}return function(o){Object.values(i).forEach((function(c,u){"datetime"==c.type&&3==c.order?(Object.keys(i)[u],s.push({width:200,id:"datepicker-containersdt",rows:[{template:"Начиная с:",height:30,borderless:!0,css:"webix_template-datepicker"},r("first",c),{height:10},l("first"),{height:20},{template:"Заканчивая:",height:30,borderless:!0,css:"webix_template-datepicker"},r("last",c),{height:10},l("last")]})):"submit"==c.type&&(e=c.action,t=o.actions[e],s.push(function(e,i){return{rows:[{height:10},{view:"button",css:"webix_primary",id:"dashBtn"+i,inputHeight:48,height:48,minWidth:100,maxWidth:200,value:e.label,click:function(){let e,o=[],r=[],l=webix.Date.dateToStr("%d.%m.%y"),c=webix.Date.dateToStr("%H:%i:%s"),u="",d="",f=!0;s.forEach((function(e,t){e.id.includes("container")&&$$(e.id).getChildViews().forEach((function(e,t){e.config.id.includes("sdt")?e.config.id.includes("time")?null!==$$(e.config.id).getValue()?u=u.concat(" "+c($$(e.config.id).getValue())):f=!1:null!==$$(e.config.id).getValue()?u=l($$(e.config.id).getValue()):f=!1:e.config.id.includes("edt")&&(e.config.id.includes("time")?null!==$$(e.config.id).getValue()?d=d.concat(" "+c($$(e.config.id).getValue())):f=!1:null!==$$(e.config.id).getValue()?d=l($$(e.config.id).getValue()):f=!1)}))})),o.push("sdt="+u),o.push("edt="+d),r.push(u),r.push(d),function(){if(f){let l=webix.Date.dateToStr("%Y/%m/%d %H:%i:%s");webix.filters.date.greater(l(r[0]),l(r[1]))&&r[0]!=r[1]?a("error","Начало периода больше, чем конец"):(e=t.url+"?"+o.join("&"),$$("dashboard-charts")&&$$("dashboardBody").removeView($$("dashboard-charts")),n(e,s,!0),$$("dashBtn"+i).disable(),setInterval((function(){$$("dashBtn"+i).enable()}),1e3))}else a("error","Не все поля заполнены")}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",e.comment)}}},{}]}}(c,u)))}))}(o),s}(i,o)),function(e){if(e.autorefresh){let e=webix.storage.local.get("userprefsOtherForm");void 0!==e.autorefCounterOpt&&(e.autorefCounterOpt>=15e3?setInterval((function(){n(r.actions.submit.url,s)}),e.autorefCounterOpt):setInterval((function(){n(r.actions.submit.url,s)}),5e4))}}(o)}}))}()}()}catch(e){console.log(e),c("018-000",e)}}function m(){$$("treeEdit").clearAll(),webix.ajax().get("/init/default/api/trees",{success:function(e,t,i){try{(t=t.json().content)[0].pid=0;let e={},i=[],n=[];t.forEach((function(e,t){0==e.pid?n.push({id:e.id,open:!0,value:e.name,pid:e.pid,data:[]}):n.push({id:e.id,value:e.name,pid:e.pid,data:[]})})),n.forEach((function(t,o){e[t.id]=o,0!==t.pid&&t.pid!==t.id&&null!==t.pid?n[e[t.pid]].data.push(t):i.push(t)})),$$("treeEdit").parse(i)}catch(e){console.log(e),c("018-004",e)}},error:function(e,t,i){u("018-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),u("018-000",e.status,e.statusText,e.responseURL)}))}function w(e){return webix.confirm({width:300,ok:"Да",cancel:"Отмена",title:e,text:"Вы уверены, что хотите продолжить?"})}function g(e,t,i){return e||t||i?webix.modalbox({title:e,css:"webix_modal-custom-save",buttons:i,width:500,text:t}):webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"})}function v(){$$("tables").isVisible()?f=$$("table").config.idTable:$$("forms").isVisible()&&(f=$$("table-view").config.idTable)}function y(){let e={},t=[];try{Object.keys($$("editTableFormProperty").getValues()).forEach((function(t,n){let o=$$("editTableFormProperty").getItem(t),r=$$("editTableFormProperty").getValues();e[t]={},function(){try{console.log(r[t]),r[t]&&(r[t].length>o.length&&0!==o.length?e[t].length="Длина строки не должна превышать "+o.length+" симв.":e[t].length=null)}catch(e){i(e,"editTableForm","valLength")}}(),function(){try{1==o.notnull&&0==r[t].length?e[t].notnull="Поле не может быть пустым":e[t].notnull=null}catch(e){i(e,"editTableForm","valNotNull")}}(),function(){try{e[t].unique=null,1==o.unique&&Object.values($$("table").data.pull).forEach((function(i,n){0==r[t].localeCompare(i[t])&&i.id!==$$("table").getSelectedId().id&&(e[t].unique="Поле должно быть уникальным")}))}catch(e){i(e,"editTableForm","valUnique")}}()})),Object.values(e).forEach((function(i,n){Object.values(i).forEach((function(o,r){if(null!==o){let a=Object.keys(e)[n],l=o,s=Object.keys(i)[r];t.push({nameCol:a,typeError:s,textError:l})}}))}))}catch(e){i(e,"editTableForm","validateProfForm")}return t}function x(){try{y().forEach((function(e,t){let i;$$("table").getColumns().forEach((function(t,n){t.id==e.nameCol&&(i=t.label)})),a("error",e.textError+" (Поле: "+i+")")}))}catch(e){i(e,"editTableForm","setLogError")}}function _(e=!1){try{$$("editTableFormProperty")&&($$("editTableFormProperty").config.dirty=e,$$("editTableFormProperty").refresh())}catch(e){i(e,"editTableForm","setDirtyProperty")}}function T(){try{$$("tableEditPopup")&&$$("tableEditPopup").hide()}catch(e){i(e,"editTableForm","hideEditPopup")}}function F(){try{$$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide()}catch(e){i(e,"editTableForm","showEmptyTempalte")}}function B(e=!1,n=!1){try{let o=$$("editTableFormProperty").getValues();if(v(),y().length)y().forEach((function(e,t){x()}));else if(o.id){const r="/init/default/api/"+f+"/"+o.id,l=webix.ajax().put(r,function(e){let t={};try{Object.values(e).forEach((function(i,n){let o=$$("table").getItem(e.id),r=Object.keys(o);!function(){let i=Object.keys(e)[n];r.forEach((function(r){r==i&&o[r]!==Object.values(e)[n]&&(t[Object.keys(e)[n]]=Object.values(e)[n])}))}()}))}catch(e){i(e,"editTableForm","uniqueData")}return t}(o));l.then((function(t){"i"==(t=t.json()).err_type?(n||function(){try{$$("table").updateItem(o.id,o),$$("table").clearSelection(),P()}catch(e){i(e,"editTableForm","saveItem => updateWorkspace")}}(),e?(function(){try{$$("editTableFormProperty").isVisible()||$$("editTableFormProperty").show()}catch(e){i(e,"editTableForm","saveItem => showFormProperty")}}(),function(){try{$$("table").filter(!1),V("table-editForm"),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show()}catch(e){i(e,"editTableForm","saveItem => addNewStateSpace")}}(),F()):($$("table-newAddBtnId").enable(),function(){try{$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh()}catch(e){i(e,"editTableForm","saveItem => setDirtyProp")}}()),window.innerWidth<1200&&$$("tableEditPopup")&&T(),a("success","Данные сохранены",f)):a("error","editTableForm function saveItem: "+t.err)})),l.fail((function(e){t(e,"editTableForm","saveItem")}))}}catch(e){i(e,"editTableForm","saveItem")}}function E(){if(v(),y().length)x();else{let e=$$("editTableFormProperty").getValues();const n=webix.ajax().post("/init/default/api/"+f,e);n.then((function(t){if(null!==(t=t.json()).content.id)if("i"==t.err_type){try{e.id=t.content.id,$$("table").add(e),P(),function(){try{$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh()}catch(e){i(e,"editTableForm","saveNewItem => setDirtyProp")}}(),$$("table-newAddBtnId").enable(),window.innerWidth<1200&&$$("tableEditPopup")&&T()}catch(e){i(e,"editTableForm","saveNewItem")}a("success","Данные успешно добавлены",f)}else console.log(t),a("error","editTableForm function saveNewItem: "+t.err);else{let e=t.content.errors,i="";Object.values(e).forEach((function(t,n){i+=t+" (Поле: "+Object.keys(e)[n]+"); "})),a("error","editTableForm function saveNewItem: "+i)}})),n.fail((function(e){t(e,"editTableForm","saveNewItem")}))}}function V(e){try{let t=$$("table").getColumns();if(0==Object.keys($$(e).elements).length){let e=[];t.forEach(((t,i)=>{let n={id:t.id,label:t.label,unique:t.unique,notnull:t.notnull,length:t.length,value:function(){let e,i=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s:%S");return"now"===t.default&&"datetime"==t.type?e=new Date:Date.parse(new Date(t.default))&&"datetime"==t.type?e=i(new Date(t.default)):t.default.includes("make_guid")?e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})):"False"==t.default?e=2:"True"==t.default?e=1:"None"!==t.default&&"null"!==t.default?e=t.default:"None"!=t.default&&"null"!=t.default||(e=""),e}()};function o(){var e;0==t.length||t.length>512?($$(t.id+"_popup")&&$$(t.id+"_popup").destructor(),n.type="popup",n.popup=(e=t.id,webix.ui({view:"popup",css:"edit-popup",body:{view:"textarea",id:e+"_popup",width:300,height:100,on:{onChange:function(){$$("table-saveBtn")&&$$("table-saveBtn").isVisible()&&!$$("table-saveBtn").isEnabled()&&$$("table-saveBtn").enable()}}},on:{onBlur:function(){}}}))):n.type="text"}"datetime"==t.type?(n.format=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s:%S"),n.type="date"):t.type.includes("reference")?function(){let e=t.type.slice(10);n.type="combo",n.css=t.id+"_container",n.options=p(e),n.template=function(e,t,i,n){let o=n.collection.getItem(e.value);return o?o.value:""}}():t.type.includes("boolean")?(n.type="select",n.options=[{id:1,value:"Да"},{id:2,value:"Нет"}]):t.type.includes("integer")?(o(),n.customType="integer"):o(),e.push(n)})),webix.editors.$popup={date:{view:"popup",body:{weekHeader:!0,view:"calendar",events:webix.Date.isHoliday,timepicker:!0,icons:!0}}},function(e){$$("editTableFormProperty").define("elements",e),$$("editTableFormProperty").refresh()}(e),function(){let e=$$("editTableFormProperty").config.elements;function t(e){try{$$("table").getColumns().forEach((function(t,i){if(t.id==e){let e=t.type.slice(10);$$("tree").getItem(e)?$$("tree").select(e):e&&async function(e){o.fields||await r("fields"),o.fields&&e&&(Backbone.history.navigate("tree/"+e,{trigger:!0}),window.location.reload())}(e),T()}}))}catch(e){i(e,"editTableForm","setRefTable"),F()}}$$("propertyRefbtns")._cells.length||($$("propertyRefbtnsContainer")||$$("propertyRefbtns").addView({id:"propertyRefbtnsContainer",rows:[]}),e.forEach((function(e,n){var o;"combo"==e.type?(o=e.id,$$("propertyRefbtnsContainer").addView({view:"button",type:"icon",srcTable:o,width:30,height:28,icon:"wxi-angle-right",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Перейти в родительскую таблицу")}},click:function(e){!function(e){const n=$$(e).config.srcTable;$$("editTableFormProperty").config.dirty?function(){try{g().then((function(e){1!=e&&2!=e||(1==e||2==e&&($$("editTableFormProperty").getValues().id?B(!1,!0):E()),_(),t(n))}))}catch(e){i(e,"editTableForm","createModalBox")}}():t(n)}(e)}})):$$("propertyRefbtnsContainer").addView({height:28,width:1})})))}()}else $$(e).clear(),$$(e).clearValidation(),"table-editForm"==e&&$$("table-delBtnId").enable()}catch(e){i(e,"editTableForm","createEditFields")}}function P(){try{$$("table-saveNewBtn").isVisible()?$$("table-saveNewBtn").hide():$$("table-saveBtn").isVisible()&&$$("table-saveBtn").hide(),$$("table-delBtnId").disable(),$$("editTableFormProperty")&&$$("editTableFormProperty").isVisible()&&($$("editTableFormProperty").clear(),$$("editTableFormProperty").hide()),$$("EditEmptyTempalte")&&!$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").show(),$$("propertyRefbtnsContainer")&&$$("propertyRefbtns").removeView($$("propertyRefbtnsContainer"))}catch(e){i(e,"editTableForm","defaultStateForm")}}const A={id:"editTableBarHeadline",hidden:!0,cols:[{template:"Редактор записей",height:30,css:"table-edit-headline",borderless:!0},{view:"button",id:"buttonClosePopupTableEdit",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){!function(){function e(){$$("table-saveNewBtn").hide(),$$("table-newAddBtnId").enable(),$$("editTableFormProperty").hide(),$$("EditEmptyTempalte").show(),$$("table-delBtnId").disable(),$$("table-saveBtn").hide()}function t(){$$("editTableFormProperty").clear(),$$("tableEditPopup")&&$$("tableEditPopup").hide()}$$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty?g().then((function(i){0==i||(1==i?(t(),e(),_()):2==i&&($$("editTableFormProperty").getValues().id?B():E(),t(),e(),$$("editTableFormProperty").config.dirty&&_()))})):($$("table").filter(!1),_(),t(),e()),$$("propertyRefbtnsContainer")&&$$("propertyRefbtns").removeView($$("propertyRefbtnsContainer"))}()}}]};function C(e,t){$$("editTableFormProperty").getItem(e).value=t,$$("editTableFormProperty").updateItem(e),_(!0)}const k={view:"form",id:"table-editForm",css:"webix_form-edit",minHeight:350,minWidth:210,width:360,borderless:!0,scroll:!0,elements:[{minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{margin:5,rows:[{margin:5,cols:[{view:"button",id:"table-newAddBtnId",height:48,minWidth:90,disabled:!0,hotkey:"shift",value:"Новая запись",click:function(){function e(){try{$$("table").filter(!1),$$("table").clearSelection(),$$("table-delBtnId").disable(),$$("table-saveBtn").hide(),$$("table-saveNewBtn").show(),$$("table-newAddBtnId").disable(),V("table-editForm"),F()}catch(e){i(e,"editTableForm","addItem => setWorkspaceState")}}function t(){try{$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh()}catch(e){i(e,"editTableForm","addItem => setDirtyProp")}}try{1==$$("editTableFormProperty").config.dirty?g().then((function(i){1==i?(e(),t()):2==i&&(B(!0),t(),F())})):($$("editTableFormProperty")&&!$$("editTableFormProperty").isVisible()&&$$("editTableFormProperty").show(),$$("editTableFormProperty").clear(),e(),$$("table").hideOverlay("Ничего не найдено"))}catch(e){i(e,"editTableForm","addItem")}}},{view:"button",id:"table-delBtnId",disabled:!0,height:48,minWidth:90,width:100,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"wxi-trash",click:function(){try{v(),w("Запись будет удалена").then((function(){let e=$$("editTableFormProperty").getValues();$$("table")&&$$("table").remove($$("table").getSelectedId().id);const i="/init/default/api/"+f+"/"+e.id+".json",n=webix.ajax().del(i,e);n.then((function(e){"i"==(e=e.json()).err_type?(P(),_(),window.innerWidth<1200&&$$("tableEditPopup")&&T(),a("success","Данные успешно удалены")):a("error","editTableForm function removeItem: "+e.err)})),n.fail((function(e){t(e,"editTableForm","removeItem")}))}))}catch(e){i(e,"editTableForm","removeItem")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить запись из таблицы")}}}]}]},{margin:10,rows:[{view:"button",id:"table-saveBtn",hidden:!0,value:"Сохранить",height:48,css:"webix_primary",click:function(){B()},hotkey:"enter"},{view:"button",id:"table-saveNewBtn",value:"Сохранить новую запись",hidden:!0,height:48,hotkey:"enter",css:"webix_primary",click:function(){E()}},{id:"EditEmptyTempalte",template:"<div style='color:#858585;font-size:13px!important'>Добавьте новую запись или выберите существующую из таблицы</div>",borderless:!0}]}]},{scroll:"y",cols:[{width:5},{view:"property",id:"editTableFormProperty",css:"webix_edit-table-form-property",dirty:!1,nameWidth:150,editable:!0,tooltip:function(e){let t,i=e.label;return t="date"==e.type?webix.Date.dateToStr("%d.%m.%Y %H:%i:%s:%S")(e.value):e.value,"Название: "+i+" <br> Значение: "+t},hidden:!0,elements:[],on:{onEditorChange:function(e,t){C(e,t),$$("table-saveBtn")&&$$("table-saveBtn").isVisible()&&!$$("table-saveBtn").isEnabled()&&$$("table-saveBtn").enable()},onBeforeRender:function(){let e=28*this.config.elements.length;e&&this.$height!==e&&(this.define("height",e),this.resize())},onAfterEditStop:function(e,t,i){e.value!==e.old&&C(t.id,e.value)}}},{width:8},{id:"propertyRefbtns",rows:[]}]}],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}};function I(e,t,i,n){let o,r;if(n.editor&&"combo"==n.editor?o=n.type.slice(10):n.view,n.id.includes("_filter")){let e=n.id.indexOf("_filter");r=n.id.slice(0,e)}else r=n.id;try{if(t=$$(r+"_filter_rows").getChildViews().length,"text"==i)return{view:"text",placeholder:"Введите текст",name:r+"_filter-child-"+e+"-"+t,id:r+"_filter-child-"+e+"-"+t,on:{onKeyPress:function(){$$("filterTableForm").clearValidation(),$$("btnFilterSubmit")&&!$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").enable()}}};if("combo"==i)return{view:"combo",name:r+"_filter-child-"+e+"-"+t,id:r+"_filter-child-"+e+"-"+t,placeholder:"Выберите вариант",options:{data:p(o)},on:{onItemClick:function(){$$("filterTableForm").clearValidation(),$$("btnFilterSubmit").enable()}}};if("boolean"==i)return{view:"combo",name:r+"_filter-child-"+e+"-"+t,id:r+"_filter-child-"+e+"-"+t,placeholder:"Выберите вариант",options:[{id:1,value:"Да"},{id:2,value:"Нет"}],on:{onItemClick:function(){$$("filterTableForm").clearValidation(),$$("btnFilterSubmit").enable()}}};if("datepicker"==i)return{view:"datepicker",name:r+"_filter-child-"+e+"-"+t,id:r+"_filter-child-"+e+"-"+t,format:"%d.%m.%Y %H:%i:%s",placeholder:"дд.мм.гг",timepicker:!0,on:{onItemClick:function(){$$("filterTableForm").clearValidation(),$$("btnFilterSubmit").enable()}}};if("integer"==i)return{view:"text",name:r+"_filter-child-"+e+"-"+t,id:r+"_filter-child-"+e+"-"+t,invalidMessage:"Поле поддерживает только числовой формат",placeholder:"Введите число",on:{onItemClick:function(){$$("filterTableForm").clearValidation(),$$("btnFilterSubmit").enable()}},validate:function(e){return!isNaN(1*e)}}}catch(e){console.log(e),c("012-000",e)}}function S(e,t){try{let i=$$(e);if(t.includes("eql"))return i.setValue("=");if(t.includes("notEqual"))return i.setValue("!=");if(t.includes("less"))return i.setValue("<");if(t.includes("more"))return i.setValue(">");if(t.includes("mrEqual"))return i.setValue(">=");if(t.includes("lsEqual"))i.setValue("<=");else if(t.includes("contains"))return i.setValue("⊆")}catch(e){console.log(e),c("012-000",e)}}function j(e){return webix.once((function(){"combo"==e?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"})):"text"==e?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"содержит",id:"operations_contains"})):"datepicker"==e?(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"<",id:"operations_less"}),this.add({value:">",id:"operations_more"}),this.add({value:">=",id:"operations_mrEqual"}),this.add({value:"<=",id:"operations_lsEqual"})):"integer"==e&&(this.add({value:"=",id:"operations_eql"}),this.add({value:"!=",id:"operations_notEqual"}),this.add({value:"<",id:"operations_less"}),this.add({value:">",id:"operations_more"}),this.add({value:">=",id:"operations_mrEqual"}),this.add({value:"<=",id:"operations_lsEqual"}),this.add({value:"содержит",id:"operations_contains"}))}))}function O(e,t){return{id:e.id+"_filter_container-btns",css:{"margin-top":"27px!important"},hidden:!0,cols:[{view:"button",id:e.id+"_filter-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(t){S(e.id+"_filter-btnFilterOperations",t)},onAfterLoad:j(t)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns",value:"+",id:e.id+"_filter_condition",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[{value:"и",id:"add_and"},{value:"или",id:"add_or"}],on:{onMenuItemClick(t){L(t,e)}}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить ещё вариант поля")}}}]}}function L(e,t){let i=t.id,n=t.editor,o=$$(i+"_filter_rows").getChildViews().length;e.includes("and")?$$(i+"_filter_rows").addView({id:i+"_filter-container-child-"+o,padding:5,rows:[{id:"and_"+webix.uid(),template:"<div style='color:var(--primary)'>+ и</div>",height:30,borderless:!0},{id:webix.uid(),cols:[I("operAnd",o,n,t),{id:i+"_filter_container-btns"+o,cols:[{view:"button",id:i+"_filter-child-operAnd-"+o+"-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(e){S(i+"_filter-child-operAnd-"+o+"-btnFilterOperations",e)},onAfterLoad:j(n)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns webix_danger",id:i+"_filter-child-operAnd-"+o+"_remove",type:"icon",icon:"wxi-trash",inputHeight:38,width:40,click:function(){try{w("Поле фильтра будет удалено").then((function(){let e=$$(i+"_filter-child-operAnd-"+o+"_remove").getParentView().getParentView().getParentView();$$(i+"_filter_rows").removeView($$(e.config.id)),$$(i+"_filter_rows").refresh(),a("success","Поле удалено")}))}catch(e){a("error","Ошибка удаления поля")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить поле фильтра")}}}]}]}]},o):e.includes("or")&&$$(i+"_filter_rows").addView({id:i+"_filter-container-child-operOr-"+o,padding:5,rows:[{id:"or_"+webix.uid(),template:"<div style='color:var(--primary)'>+ или</div>",height:30,borderless:!0},{id:webix.uid(),cols:[I("operOr",o,n,t),{id:i+"_filter_container-btns"+o,cols:[{view:"button",id:i+"_filter-child-operOr-"+o+"-btnFilterOperations",css:"webix_primary webix_filterBtns",value:"=",inputHeight:38,width:40,popup:{view:"contextmenu",width:200,data:[],on:{onMenuItemClick(e){S(i+"_filter-child-operOr-"+o+"-btnFilterOperations",e)},onAfterLoad:j(n)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбрать условие поиска по полю")}}},{view:"button",css:"webix_filterBtns webix_danger",id:i+"_filter-child-operOr-"+o+"_remove",type:"icon",icon:"wxi-trash",inputHeight:38,width:40,click:function(){try{w("Поле фильтра будет удалено").then((function(){let e=$$(i+"_filter-child-operOr-"+o+"_remove").getParentView().getParentView().getParentView();console.log(e),$$(i+"_filter_rows").removeView($$(e.config.id)),a("success","Поле удалено")}))}catch(e){a("error","Ошибка удаления поля")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить поле фильтра")}}}]}]}]},o)}function R(e,t=1){try{let i=$$("table").getColumns();if(0==Object.keys($$(e).elements).length){let n=[];i.forEach(((t,i)=>{if("datetime"==t.type)n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"datepicker",format:"%d.%m.%Y %H:%i:%s",id:t.id+"_filter",name:t.id+"_filter",hidden:!0,label:t.label,placeholder:"дд.мм.гг",timepicker:!0,labelPosition:"top",on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},O(t,"datepicker")]}]});else if(t.type.includes("reference")){let i=t.type.slice(10);n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id+"_filter",hidden:!0,name:t.id+"_filter",labelPosition:"top",options:{data:p(i)},on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},O(t,"combo")]}]})}else t.type.includes("boolean")?n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,cols:[{view:"combo",placeholder:"Выберите вариант",label:t.label,id:t.id+"_filter",hidden:!0,name:t.id+"_filter",labelPosition:"top",options:[{id:1,value:"Да"},{id:2,value:"Нет"}],on:{onItemClick:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},O(t,"combo")]}]}):t.type.includes("integer")?n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,css:"webix_inputs-show",cols:[{view:"text",name:t.id+"_filter",id:t.id+"_filter",css:{"padding-bottom":"5px!important"},placeholder:"Введите число",hidden:!0,label:t.label,labelPosition:"top",invalidMessage:"Поле поддерживает только числовой формат",on:{onKeyPress:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}},validate:function(e){return!isNaN(1*e)}},O(t,"integer")]}]}):n.push({id:t.id+"_filter_rows",css:t.id+" webix_filter-inputs",rows:[{id:t.id+"_container",padding:5,css:"webix_inputs-show",cols:[{view:"text",name:t.id+"_filter",id:t.id+"_filter",css:{"passing-bottom":"5px!important"},placeholder:"Введите текст",hidden:!0,label:t.label,labelPosition:"top",on:{onKeyPress:function(){$$(e).clearValidation(),$$("btnFilterSubmit").enable()}}},O(t,"text")]}]})}));let o={margin:8,id:"inputsFilter",css:"webix_inputs-table-filter",rows:n};return"table-editForm"==e&&$$("table-delBtnId").enable(),$$(e).addView(o,t)}$$(e).clear(),$$(e).clearValidation(),"table-editForm"==e&&$$("table-delBtnId").enable(),$$("inputsFilter").show()}catch(e){console.log(e),c("012-000",e)}}function z(e,t=!1){let i=e+"-editTableBtnId",n=e+"-findElements",o=e+"-idFilterElements",r=e+"-templateHeadline";return{rows:[{view:"template",id:r,css:"webix_style-template-count webix_block-title",height:34,template:function(){return 0!==Object.keys($$(r).getValues()).length?"<div style='display:inline-block;font-size:15px!important;font-weight:600'>"+$$(r).getValues()+"</div>":"<div style='display:inline-block;font-size:13px!important;font-weight:600'>Имя не указано</div>"}},{css:"webix_filterBar",padding:17,height:80,margin:5,cols:[{view:"button",width:50,type:"icon",id:e+"-filterId",hidden:t,icon:"wxi-filter",css:"webix_btn-filter",disabled:!0,title:"текст",height:50,click:function(){!function(e,t){try{if(window.innerWidth>1200){let i;$$("filterTableForm").getValues()&&(i=$$("filterTableForm").getValues()),"filterTableBarContainer"!==$$("editFilterBarAdaptive").getParentView().config.id&&$$("filterTableBarContainer").addView($$("editFilterBarAdaptive")),$$("editFilterBarHeadline")&&$$("editFilterBarHeadline").hide(),$$("editFilterBarAdaptive").config.width=350,$$("editFilterBarAdaptive").resize(),$$(e).clearSelection();let n=document.querySelector(".webix_btn-filter");n.classList.contains("webix_primary")?($$("filterTableForm").hide(),$$("table-editForm").show(),n.classList.add("webix_secondary"),n.classList.remove("webix_primary"),$$(t).hide(),$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").hide(),$$("editTableBarContainer")&&!$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").show()):($$("filterTableForm").show(),$$("table-editForm").hide(),0!==$$("filterTableForm").getChildViews()&&R("filterTableForm",3),i&&($$("filterTableForm").setValues(i),i=null),n.classList.add("webix_primary"),n.classList.remove("webix_secondary"),$$(t).show(),$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide(),$$("filterTableBarContainer")&&!$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").show())}else{let e;$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide(),$$("tableFilterPopup")&&$$("tableFilterPopup").show(),$$("tableFilterPopupContainer")&&!$$("tableFilterPopupContainer").isVisible()&&$$("tableFilterPopupContainer").show(),$$("filterTableForm").getValues()&&(e=$$("filterTableForm").getValues()),$$("tableFilterPopupContainer")&&$$("tableFilterPopupContainer").addView($$("editFilterBarAdaptive")),$$("editFilterBarHeadline")&&!$$("editFilterBarHeadline").isVisible()&&$$("editFilterBarHeadline").show(),0!==$$("filterTableForm").getChildViews()&&R("filterTableForm",3),$$("filterTableForm").show(),e&&($$("filterTableForm").setValues(e),$$("filterTableForm").setDirty(),e=null);let t=window.innerWidth-200;$$("editFilterBarAdaptive").$width>200&&($$("editFilterBarAdaptive").config.width=t,$$("editFilterBarAdaptive").resize())}}catch(e){console.log(e),c("012-000",e)}}(e,i)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть фильтры")}}},{view:"button",maxWidth:200,value:"<span class='webix_icon wxi-pencil'></span><span style='padding-left: 4px'>Редактор таблицы</span>",id:i,hidden:!0,css:"webix_btn-edit",title:"текст",height:50,click:function(){!function(e){try{if(window.innerWidth>1200){let t=document.querySelector(".webix_btn-filter");$$("filterTableForm").hide(),$$("table-editForm").show(),t.classList.add("webix_secondary"),t.classList.remove("webix_primary"),$$(e).hide(),$$("editTableBarContainer")&&$$("editTableBarContainer").show(),$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").hide()}else{if($$("tableEditPopup")){$$("tableEditPopup").show();let e=.7*window.innerWidth;$$("editTableBarAdaptive").$width>200&&($$("editTableBarAdaptive").config.width=e,$$("editTableBarAdaptive").resize()),$$("tableEditPopupContainer").getChildViews().length?($$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable(),$$("editTableBarContainer")&&$$("editTableBarContainer").show()):($$("tableEditPopupContainer").addView($$("editTableBarAdaptive")),$$("editTableBarHeadline")&&!$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").show())}else{webix.ui({view:"popup",css:"webix_popup-table-container webix_popup-config",modal:!0,id:"tableEditPopup",escHide:!0,position:"center",body:{id:"tableEditPopupContainer",rows:[]}}).show(),$$("tableEditPopupContainer").addView($$("editTableBarAdaptive")),$$("editTableBarHeadline")&&!$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").show();let e=.7*window.innerWidth;$$("editTableBarAdaptive").$width>200&&($$("editTableBarAdaptive").config.width=e,$$("editTableBarAdaptive").resize())}$$("table-newAddBtnId")&&($$("table-saveNewBtn").isVisible()&&$$("table-newAddBtnId").isEnabled()?$$("table-newAddBtnId").disable():$$("table-newAddBtnId").enable())}}catch(e){console.log(e),c("012-000",e)}}(i)},on:{onAfterRender:function(){"table"!==e&&this.isVisible()&&this.hide(),this.getInputNode().setAttribute("title","Редактировать таблицу")}}},{},{view:"button",width:50,type:"icon",id:e+"-exportBtn",hidden:t,icon:"wxi-download",css:"webix_btn-download",title:"текст",height:50,click:function(){!function(e){webix.toExcel(e,{filename:"Table",filterHTML:!0,styles:!0}),a("success","Таблица сохранена")}(e)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Экспорт таблицы")}}}]},{cols:[{view:"template",id:n,css:"webix_style-template-count",height:30,template:function(){return 0!==Object.keys($$(n).getValues()).length?"<div style='color:#999898;'> Общее количество записей: "+$$(n).getValues()+" </div>":""}},{view:"template",id:o,css:"webix_style-template-count",height:30,template:function(){return 0!==Object.keys($$(o).getValues()).length?"<div style='color:#999898;'>Видимое количество записей: "+$$(o).getValues()+" </div>":""}}]}]}}function N(){let e;return $$("tables").isVisible()?e=$$("table").config.idTable:$$("forms").isVisible()&&(e=$$("table-view").config.idTable),e}function D(e,t,i=!1){return{view:"datatable",id:e,css:"webix_table-style webix_header_border webix_data_border",resizeColumn:!0,autoConfig:!0,editable:i,editaction:"dblclick",minHeight:350,datafetch:5,datathrottle:5e3,loadahead:100,footer:!0,minWidth:500,select:!0,minColumnWidth:200,on:t,onClick:{"wxi-trash":function(){try{w("Запись будет удалена").then((function(){let t=$$(e).getItem(id),i=N();webix.ajax().del("/init/default/api/"+i+"/"+t.id+".json",t,{success:function(){$$(e).remove($$(e).getSelectedId()),a("success","Данные успешно удалены")},error:function(e,t,i){u("012-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),u("012-000",e.status,e.statusText,e.responseURL)}))}))}catch(e){console.log(e),c("012-000",e)}},"wxi-angle-down":function(e,t,i){try{if($$("propTableView").isVisible())$$("propTableView").hide(),$$("propResize").hide();else{let e,i=t.row;$$("table-view").getColumns().forEach((function(n,o){if(n.id==t.column){e=n.src;let t=e.search("{");e=e.slice(0,t)+i+".json"}})),webix.ajax(e,{success:function(e,t,i){try{t=t.json().content;let e=[];t.forEach((function(t,i){e.push({type:"text",id:i+1,label:t.name,value:t.value})})),$$("propTableView").define("elements",e),$$("propTableView").show(),$$("propTableView").config.width<200&&($$("propTableView").config.width=200,$$("propTableView").resize()),$$("propResize").show()}catch(e){console.log(e),c("012-000",e)}},error:function(e,t,i){u("012-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),u("012-000",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),c("012-000",e)}}}}}function H(){$$("table-findElements").setValues($$("table").count().toString())}function W(e){let t=$$("table").getItem(e);try{$$("editTableFormProperty")&&!$$("editTableFormProperty").isVisible()&&$$("editTableFormProperty").show(),$$("table-newAddBtnId").isEnabled()||$$("table-newAddBtnId").enable(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),$$("editTableFormProperty").setValues(t),$$("table-saveNewBtn").hide(),$$("table-saveBtn").show(),$$("table-saveBtn").disable(),$$("table-delBtnId").enable()}catch(e){console.log(e),a("error","toEditForm: "+e)}}function U(){$$("propertyRefbtnsContainer")&&$$("propertyRefbtns").removeView($$("propertyRefbtnsContainer"))}function M(){y().forEach((function(e,t){let i;$$("table").getColumns().forEach((function(t,n){t.id==e.nameCol&&(i=t.label)})),a("error",e.textError+" (Поле: "+i+")")}))}function q(e,t,i,n=!1){if(y().length)M();else if(t.id){let o;o=n?function(e){let t={};return Object.values(e).forEach((function(i,n){let o=$$("table").getItem(e.id),r=Object.keys(o);!function(){let i=Object.keys(e)[n];r.forEach((function(r){r==i&&o[r]!==Object.values(e)[n]&&(t[Object.keys(e)[n]]=Object.values(e)[n])}))}()})),t}(t):t,webix.ajax().put("/init/default/api/"+i+"/"+t.id,o,{success:function(i,o,r){"i"==(o=o.json()).err_type&&(a("success","Данные сохранены"),$$("table").updateItem(t.id,t),U(),n&&(W(e),$$("table").select(e))),"e"==o.err_type&&a("error",o.error)},error:function(e,t,i){a("error","table function putData: "+i.status+" "+i.statusText+" "+i.responseURL)}}).catch((e=>{console.log(e),a("error","table function putData ajax: "+e.status+" "+e.statusText+" "+e.responseURL)}))}}let J,Y={onBeforeLoad:function(){this.showOverlay("Загрузка...")},onBeforeEditStop:function(e,t,i){let n=$$("table").getSelectedItem(),o=N();try{if(e.value!=e.old){let i=t.row,r=t.column,a=e.value;$$("table").updateItem(i,{[r]:a}),$$("editTableFormProperty").setValues($$("table").getSelectedItem()),q("",n,o)}}catch(e){console.log(e),c("012-011",e)}},onAfterSelect(e){function t(){$$("EditEmptyTempalte")&&$$("EditEmptyTempalte").isVisible()&&$$("EditEmptyTempalte").hide()}function i(){try{$$("tableEditPopupContainer").addView($$("editTableBarAdaptive")),$$("editTableBarHeadline")&&!$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").show()}catch(e){a("error","table initPopup: "+e)}}try{$$("table-editTableBtnId").isVisible()&&window.innerWidth>1200&&$$("table-editTableBtnId").hide(),function(){try{$$("editTableBarContainer")&&!$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").show(),$$("table-newAddBtnId")&&$$("table-newAddBtnId").enable(),t(),$$("table-editForm").isVisible()||($$("table-editForm").show(),function(){try{$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").hide(),$$("filterTableForm")&&$$("filterTableForm").isVisible()&&$$("filterTableForm").hide();let e=document.querySelector(".webix_btn-filter");e.classList.add("webix_secondary"),e.classList.remove("webix_primary")}catch(e){a("error","table filterTableHide: "+e)}}())}catch(e){a("error","table statePutEditForm: "+e)}}(),function(){try{window.innerWidth<1200&&($$("tableEditPopup")?($$("tableEditPopup").show(),$$("tableEditPopupContainer").getChildViews().length||i()):(webix.ui({view:"popup",css:"webix_popup-table-container webix_popup-config",modal:!0,id:"tableEditPopup",escHide:!0,position:"center",body:{id:"tableEditPopupContainer",rows:[]}}).show(),i()),t())}catch(e){a("error","table adaptiveEditFormPopup: "+e)}}()}catch(e){console.log(e),a("error","table onAfterSelect: "+e)}},onBeforeSelect:function(e,t){const i=document.querySelector(".edit-popup");if(i){const e=i.getAttribute("view_id");console.log($$(e)),$$(e).hide(),console.log($$(e))}let n=$$("editTableFormProperty").getValues(),o=N(),r=e.id;!function(){if($$("editTableFormProperty").config.dirty)return g().then((function(t){1==t?(W(r),$$("table").select(e.id),U()):2==t&&($$("editTableFormProperty").getValues().id?q(r,n,o,!0):function(e,t,i){y().length?M():webix.ajax().post("/init/default/api/"+t,i,{success:function(t,n,o){if(null!==(n=n.json()).content.id)i.id=n.content.id,$$("table").add(i),W(e),U(),$$("table").select(e),a("success","Данные успешно добавлены");else{let e=n.content.errors,t="";Object.values(e).forEach((function(i,n){t+=i+" (Поле: "+Object.keys(e)[n]+"); "})),a("error",t)}},error:function(e,t,i){a("error","table modalBox (post new data): "+i.status+" "+i.statusText+" "+i.responseURL)}})}(r,o,n))})),!1;V("table-editForm"),W(r)}()},onAfterLoad:function(){try{this.hideOverlay(),this.count()||this.showOverlay("Ничего не найдено"),P()}catch(e){console.log(e),c("012-000",e)}},onAfterDelete:function(){try{H(),function(){let e;$$("table").isVisible()?e="table":$$("table-view").isVisible()&&(e="table-view"),$$(e).count()||$$(e).showOverlay("Ничего не найдено"),$$(e).count()&&$$(e).hideOverlay()}()}catch(e){console.log(e),a("error","table onAfterDelete: "+e)}},onAfterAdd:function(){try{H(),this.hideOverlay()}catch(e){console.log(e),a("error","table onAfterAdd: "+e)}},onAfterRender:function(){!function(){try{window.innerWidth<1200&&$$("table-editTableBtnId")&&!$$("table-editTableBtnId").isVisible()&&$$("table-editTableBtnId").show()}catch(e){a("error","table adaptiveBtnEditTable: "+e)}}()}};try{J={view:"form",id:"cp-form",borderless:!0,margin:5,elements:[{template:"<div>Изменение пароля</div>",css:"webix_cp-form",height:35,borderless:!0},{view:"template",id:"authName",css:"webix_userprefs-info",template:function(){return 0!==Object.keys($$("authName").getValues()).length?"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600' >"+$$("authName").getValues()+"<div>":"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀ <div style='display:inline-block;font-size:13px!important;font-weight:600'>не указано</div>"},height:50,borderless:!0},{view:"text",width:300,labelPosition:"top",type:"password",label:"Старый пароль",name:"oldPass"},{view:"text",width:300,labelPosition:"top",type:"password",label:"Новый пароль",name:"newPass"},{view:"text",width:300,labelPosition:"top",type:"password",label:"Повтор нового пароля",name:"repeatPass"},{margin:5,cols:[{view:"button",height:48,width:300,value:"Сменить пароль",css:"webix_primary",click:function(){try{if($$("cp-form").validate()){let e={op:"",np:""},t=$$("cp-form").getValues();e.np=t.newPass,e.op=t.oldPass,webix.ajax().post("/init/default/api/cp",e,{success:function(e,t,i){"i"==(t=t.json()).err_type?a("success",t.err):"e"==t.err_type&&a("error",t.err),$$("cp-form").setDirty(!1)},error:function(e,t,i){u("011-000",i.status,i.statusText,i.responseURL)}})}}catch(e){console.log(e),c("011-000",e)}}}]}],rules:{$all:webix.rules.isNotEmpty,$obj:function(e){return e.newPass!=e.repeatPass?(a("error","Новый пароль не совпадает с повтором"),!1):e.newPass!=e.oldPass||!$$("cp-form").isDirty()||(a("error","Новый пароль должен отличаться от старого"),!1)}}}}catch(e){console.log(e),c("011-000",e)}const K={id:"layout-cp",cols:[J,{}]};let G={userprefsOther:{},userprefsWorkspace:{}};function Q(){const e=$$("userprefsTabbar").getValue()+"Form";if($$(e).isDirty())try{webix.ajax().get("/init/default/api/userprefs/",{success:function(t,i,o){"e"==(i=i.json().content).err_type&&a("error",i.error);let r=!1;const l=$$(e).getValues();let s={name:e,prefs:l};try{i.forEach((function(t,i){t.name==e&&(r=!0,webix.ajax().put("/init/default/api/userprefs/"+t.id,s,{success:function(t,i,o){"i"==(i=i.json()).err_type&&(n(e,JSON.stringify($$(e).getValues())),a("success","Настройки сохранены")),"e"==i.err_type&&a("error",i.error),G[$$("userprefsTabbar").getValue()]=l,$$(e).setDirty(!1)},error:function(e,t,i){u("015-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),u("015-011",e.status,e.statusText,e.responseURL)})))}))}catch(e){console.log(e),c("015-000",e)}try{if(!r){let t=webix.storage.local.get("user").id;t?s.owner=t:webix.ajax("/init/default/api/whoami",{success:function(e,t,i){s.owner=t.json().content.id;let o={};o.id=t.json().content.id,o.name=t.json().content.first_name,o.username=t.json().content.username,n("user",JSON.stringify(o))},error:function(e,t,i){u("005-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),u("005-000",e.status,e.statusText,e.responseURL)})),webix.ajax().post("/init/default/api/userprefs/",s,{success:function(t,i,n){"i"==(i=i.json()).err_type?a("success","Настройки сохранены"):"e"==i.err_type&&a("error",i.error),G[$$("userprefsTabbar").getValue()]=l,$$(e).setDirty(!1)},error:function(e,t,i){u("015-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),u("015-001",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),c("015-000",e)}},error:function(e,t,i){u("015-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),u("015-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),c("015-000",e)}else a("debug","Сохранять нечего")}const X={rows:[{padding:{top:15,bottom:0,left:20,right:0},rows:[{view:"template",template:"<div>Настройки</div>",css:"webix_headline-userprefs",height:35,borderless:!0},{view:"template",id:"userprefsName",css:"webix_userprefs-info",template:function(){return 0!==Object.keys($$("userprefsName").getValues()).length?"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div>⠀<div style='display:inline-block;font-size:13px!important;font-weight:600' >"+$$("userprefsName").getValues()+"<div>":"<div style='display:inline-block;color:var(--primary);font-size:13px!important;font-weight:600'>Имя пользователя:</div><div style='display:inline-block;font-size:13px!important;font-weight:600'>не указано</div>"},height:50,borderless:!0}]},{rows:[{view:"tabbar",type:"top",id:"userprefsTabbar",css:"webix_filter-popup-tabbar",multiview:!0,options:[{value:"<span class='webix_tabbar-filter-headline'>Рабочее пространство</span>",id:"userprefsWorkspace"},{value:"<span class=webix_tabbar-filter-headline'>Другое</span>",id:"userprefsOther"}],height:50,on:{onBeforeTabClick:function(e){const t=$$("userprefsTabbar").getValue()+"Form";try{if($$(t).isDirty())return webix.modalbox({title:"Данные не сохранены",css:"webix_modal-custom-save",buttons:["Отмена","Не сохранять","Сохранить"],width:500,text:"Выберите действие перед тем как продолжить"}).then((function(i){if(1==i){let i=webix.storage.local.get(t);$$(t).setValues(i),$$("userprefsTabbar").setValue(e),$$("userprefsSaveBtn").isEnabled()&&$$("userprefsSaveBtn").disable(),$$("userprefsResetBtn").isEnabled()&&$$("userprefsResetBtn").disable()}else 2==i&&(Q(),$$("userprefsTabbar").setValue(e))})),!1}catch(e){console.log(e),c("005-000",e)}}}},{cells:[{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsWorkspace",scroll:"y",body:{view:"form",id:"userprefsWorkspaceForm",borderless:!0,elements:[{cols:[{rows:[{view:"radio",labelPosition:"top",name:"logBlockOpt",label:"Отображение блока системных сообщений",value:1,options:[{id:1,value:"Показать"},{id:2,value:"Скрыть"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть по умолчанию блок системных сообщений")},onChange:function(e,t,i){try{e!==t&&(1==e?$$("webix_log-btn").setValue(2):$$("webix_log-btn").setValue(1))}catch(e){console.log(e),c("015-000",e)}}}},{height:15},{cols:[{view:"select",name:"LoginActionOpt",label:"Действие после входа в систему",labelPosition:"top",value:2,options:[{id:1,value:"Перейти на главную страницу"},{id:2,value:"Перейти на последнюю открытую страницу"}],on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показывать/не показывать всплывающее окно при загрузке приложения")}}},{}]}]}]}],on:{onChange:function(){this.isDirty()&&!$$("userprefsSaveBtn").isEnabled()?$$("userprefsSaveBtn").enable():this.isDirty()||$$("userprefsSaveBtn").disable(),this.isDirty()&&!$$("userprefsResetBtn").isEnabled()?$$("userprefsResetBtn").enable():this.isDirty()||$$("userprefsResetBtn").disable()}}}},{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"userprefsOther",scroll:"y",body:{view:"form",id:"userprefsOtherForm",borderless:!0,elements:[{view:"radio",labelPosition:"top",label:"Автообновление специфичных страниц",value:1,name:"autorefOpt",options:[{id:1,value:"Включено"},{id:2,value:"Выключено"}],on:{onChange:function(e,t,i){try{1!=e||$$("userprefsAutorefCounter").isVisible()||$$("userprefsAutorefCounter").show(),2==e&&$$("userprefsAutorefCounter").isVisible()&&$$("userprefsAutorefCounter").hide()}catch(e){console.log(e),c("015-000",e)}}}},{height:5},{view:"counter",id:"userprefsAutorefCounter",labelPosition:"top",name:"autorefCounterOpt",label:"Интервал автообновления (в миллисекундах)",min:15e3,max:9e5,on:{onChange:function(e,t,i){try{const t=$$("userprefsAutorefCounter").config.min,i=$$("userprefsAutorefCounter").config.max;e==t?webix.message({type:"debug",expire:1e3,text:"Минимальное возможное значение"}):e==i&&webix.message({type:"debug",expire:1e3,text:"Максимальное возможное значение"})}catch(e){console.log(e),c("015-000",e)}}}},{height:5},{view:"radio",labelPosition:"top",label:"ID в таблицах",value:1,name:"visibleIdOpt",options:[{id:1,value:"Показывать"},{id:2,value:"Не показывать"}]},{}],on:{onChange:function(){this.isDirty()&&!$$("userprefsSaveBtn").isEnabled()?$$("userprefsSaveBtn").enable():this.isDirty()||$$("userprefsSaveBtn").disable(),this.isDirty()&&!$$("userprefsResetBtn").isEnabled()?$$("userprefsResetBtn").enable():this.isDirty()||$$("userprefsResetBtn").disable()}}}}]},{id:"a1",rows:[{responsive:"a1",cols:[{view:"button",height:48,minWidth:200,value:"Сбросить",id:"userprefsResetBtn",disabled:!0},{view:"button",value:"Сохранить настройки",height:48,minWidth:200,id:"userprefsSaveBtn",css:"webix_primary",disabled:!0,click:Q}]}]}]}]},Z={};function ee(){let e;return $$("tables").isVisible()?e=$$("table").config.idTable:$$("forms").isVisible()&&(e=$$("table-view").config.idTable),e}function te(){return webix.ajax().get("/init/default/api/userprefs/").then((function(e){return Z.userprefs=e.json(),Z.userprefs})).fail((e=>{t(e,"filterTableForm","getUserprefsData")}))}function ie(){function e(e,t=null,n=null){let o=document.querySelectorAll(".webix_filter-inputs");if(e)try{!function(){try{o.forEach((function(e,i){e.classList.contains(t)?(e.classList.contains("webix_show-content")||e.classList.add("webix_show-content"),e.classList.contains("webix_hide-content")&&e.classList.remove("webix_hide-content")):e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content")}))}catch(e){i(e,"filterTableForm","function visibleField => showHtmlEl")}}(),$$(n).show(),$$(n+"_container-btns")&&!$$(n+"_container-btns").isVisible()&&$$(n+"_container-btns").show(),$$("resetFilterBtn").isEnabled()||$$("resetFilterBtn").enable(),$$("filterLibrarySaveBtn").isEnabled()||$$("filterLibrarySaveBtn").enable(),$$("filterEmptyTempalte").isVisible()&&$$("filterEmptyTempalte").hide()}catch(e){i(e,"filterTableForm","function visibleField => showElements")}else try{$$(n).isVisible()&&function(){try{o.forEach((function(e,i){e.classList.contains(t)&&(e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content"),e.classList.contains("webix_show-content")&&e.classList.remove("webix_show-content"))}))}catch(e){i(e,"filterTableForm","function visibleField => hideHtmlEl")}}(),$$(n).setValue(""),$$(n).hide(),$$(n+"_container-btns")&&$$(n+"_container-btns").isVisible()&&$$(n+"_container-btns").hide(),$$(n+"_rows")&&function(){let e=$$(n+"_rows").getChildViews();try{Object.values(e).forEach((function(e,t){e.config.id.includes("child")&&$$(n+"_rows").removeView($$(e.config.id))}))}catch(e){i(e,"filterTableForm","function visibleField => removeChids")}}()}catch(e){i(e,"filterTableForm","function visibleField => hideElements")}}try{let n=$$("filterPopupTabbar").getValue();"editFormPopupLib"==n?function(){let n=$$("filterEditLib").getOption($$("filterEditLib").getValue()),o=webix.ajax("/init/default/api/userprefs/");o.then((function(t){t.json(),t=t.json().content;const o=ee();function r(t){let n=[];try{t.collection.content.forEach((function(t,o){"parent"==t.condition&&(function(){let i=function(){let e=t.parentField.id.indexOf("_filter");return t.parentField.id.slice(0,e)}(),o=function(){let e=t.parentField.id.indexOf("_rows");return t.parentField.id.slice(0,e)}();e(1,i,o),n.push(o)}(),$$(t.parentValue.id)&&$$(t.parentValue.id).setValue(t.parentValue.value),function(){try{$$(t.parentField.id)._cells.forEach((function(e,i){e.config.id.includes("child")&&$$(t.parentField.id).removeView($$(e.config.id))}))}catch(e){i(e,"filterTableForm","function createWorkspace => removeLastChilds")}}()),function(t){const n=$$("inputsFilter").getChildViews();try{n.forEach((function(i,n){let o=function(e){let i;return t.forEach((function(t,n){e.includes(t)&&(i=t)})),i}(i.config.id),r=i.config.id;if(!o){let t=function(){let e=r.indexOf("_rows");return r.slice(0,e)}(),i=function(e){let t=e.indexOf("_filter");return r.slice(0,t)}(t);e(0,i,t)}}))}catch(e){i(e,"filterTableForm","function hideFalseInputs")}}(n),function(){let e=$$("table").getColumns();try{e.forEach((function(e,i){t.parentField.id.includes(e.id)&&("and"==t.condition?(L("and",e),$$(t.childValue.id).setValue(t.childValue.value)):"or"==t.condition&&(L("or",e),$$(t.childValue.id).setValue(t.childValue.value)))}))}catch(e){i(e,"filterTableForm","function createWorkspace => createChilds")}}()})),$$("filterTableForm").setValues(t.values)}catch(e){i(e,"filterTableForm","function createWorkspace")}}!function(){try{t.forEach((function(e,t){e.name==o+"_filter-template_"+n.value&&r(JSON.parse(e.prefs)),$$("popupFilterEdit")&&$$("popupFilterEdit").destructor(),$$("btnFilterSubmit")&&!$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").enable()}))}catch(e){i(e,"filterTableForm","function dataEnumeration")}}(),a("success","Рабочая область фильтра обновлена")})),o.fail((function(e){t(e,"filterTableForm","getLibraryData")}))}():"editFormScroll"==n&&function(){try{$$("filterLibrarySaveBtn")&&!$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").enable(),function(){let t,n,o=$$("editFormPopup").getValues();try{Object.keys(o).forEach((function(i,r){n=i.lastIndexOf("_"),t=i.slice(0,n),e(o[i],t,i)}))}catch(e){i(e,"filterTableForm","function createWorkspaceCheckbox")}}(),function(){let e=0;try{Object.values($$("filterTableForm").elements).forEach((function(t,i){t.config.hidden||e++}))}catch(e){i(e,"filterTableForm","function getCheckboxData => visibleCounter")}return e}()||($$("filterEmptyTempalte").isVisible()||$$("filterEmptyTempalte").show(),$$("btnFilterSubmit")&&$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").disable(),$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").disable()),$$("popupFilterEdit")&&$$("popupFilterEdit").destructor()}catch(e){i(e,"filterTableForm","function getCheckboxData")}a("success","Рабочая область фильтра обновлена")}()}catch(e){i(e,"filterTableForm","function popupSubmitBtn"),$$("popupFilterEdit").destructor()}}let ne;function oe(){try{const e=ee(),n=webix.ajax("/init/default/api/smarts?query="+e+".id >= 0");n.then((function(e){let t=e.json();if(e=e.json().content,"i"==t.err_type){try{!function(){try{0!==e.length?($$("table").hideOverlay("Ничего не найдено"),$$("table").clearAll(),$$("table").parse(e)):($$("table").clearAll(),$$("table").showOverlay("Ничего не найдено"))}catch(e){i(e,"filterTableForm","function resetFilterBtn => setDataTable")}}(),function(){try{let e=$$("table").count().toString();$$("table-idFilterElements").setValues(e)}catch(e){i(e,"filterTableForm","function setFilterCounterVal")}}(),re(),$$("filterTableForm")&&$$("filterTableForm").clear(),function(){let e=document.querySelectorAll(".webix_filter-inputs");try{e.forEach((function(e,t){e.classList.contains("webix_hide-content")||e.classList.add("webix_hide-content")}))}catch(e){i(e,"filterTableForm","function resetFilterBtn => hideInputsContainer")}}(),function(){let e=[];$$("inputsFilter").getChildViews().forEach((function(t,n){let o=t._collection[0].cols[0].id;try{$$(o).hide(),function(){try{$$(t.config.id).getChildViews().forEach((function(t,i){t.config.id.includes("child")&&e.push(t.config.id)}))}catch(e){i(e,"filterTableForm","function resetFilterBtn => getChildsId")}}(),$$(o+"_container-btns")&&$$(o+"_container-btns").isVisible()&&$$(o+"_container-btns").hide()}catch(e){i(e,"filterTableForm","function resetFilterBtn => clearSpace")}})),function(){try{e.forEach((function(e,t){$$(e).getParentView().removeView($$(e))}))}catch(e){i(e,"filterTableForm","function resetFilterBtn => removeChilds")}}()}(),$$("filterLibrarySaveBtn")&&$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").disable(),$$("filterEmptyTempalte")&&!$$("filterEmptyTempalte").isVisible()&&($$("filterEmptyTempalte").show(),$$("filterEmptyTempalte").refresh()),$$("resetFilterBtn").disable()}catch(e){i(e,"filterTableForm","function resetFilterBtn")}a("success","Фильтры очищены")}else a("error","filterTableForm function resetFilterBtn ajax: "+t.err)})),n.fail((function(e){t(e,"filterTableForm","resetFilterBtn")}))}catch(e){i(e,"Ошибка при очищении фильтров; filterTableForm","function resetFilterBtn")}}function re(){$$("tableFilterPopup")&&$$("tableFilterPopup").isVisible()&&$$("tableFilterPopup").hide()}function ae(){$$("popupFilterEdit").destructor(),oe()}const le={template:"Редактор записей",height:30,css:"table-filter-headline",borderless:!0},se={view:"button",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("table-editForm")&&re()}},ce={view:"button",value:"Редактор фильтров",height:48,minWidth:140,click:function(){const e=ee(),o={view:"button",id:"buttonClosePopup",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){$$("popupFilterEdit")&&$$("popupFilterEdit").destructor()}};function r(e){e?$$("popupFilterSubmitBtn").enable():$$("popupFilterSubmitBtn").disable()}const l={view:"button",css:"webix_danger",id:"editFormPopupLibRemoveBtn",type:"icon",icon:"wxi-trash",hidden:!0,disabled:!0,width:50,click:function(){const e=ee();g("Шаблон будет удалён","Вы уверены, что хотите продолжить?",["Отмена","Удалить"]).then((function(n){1==n&&async function(){let n=$$("filterEditLib").getValue(),o=$$("filterEditLib").getOption(n);if(Z.userprefs||await te(),Z.userprefs){let n=Z.userprefs.content,r=e+"_filter-template_"+o.value;n.forEach((function(e,n){e.name==r&&function(){let n=webix.ajax().del("/init/default/api/userprefs/"+e.id,e);n.then((function(e){"e"!==(e=e.json()).err_type&&"x"!==e.err_type?(a("success","Шаблон « "+o.value+" » удален"),function(){try{$$("filterEditLib").config.options.forEach((function(e,t){e.id==o.id&&(e.value=o.value+" (шаблон удалён)",$$("filterEditLib").refresh(),$$("filterEditLib").disableOption($$("filterEditLib").getValue()),$$("filterEditLib").setValue(""))}))}catch(e){i(e,"filterTableForm","function deleteElement => removeOptionState")}}()):a("error","filterTableForm function userprefsData: "+e.err)})),n.fail((function(e){t(e,"filterTableForm","getLibraryData")}))}()}))}}()}))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбранный шаблон будет удален")}}},s={view:"form",id:"editFormPopup",css:"webix_edit-form-popup",borderless:!0,elements:[{rows:[{view:"tabbar",type:"top",id:"filterPopupTabbar",css:"webix_filter-popup-tabbar",multiview:!0,options:[{value:"<span class='webix_tabbar-filter-headline'>Поля</span>",id:"editFormScroll"},{value:"<span class=webix_tabbar-filter-headline'>Библиотека</span>",id:"editFormPopupLib"}],height:50,on:{onAfterTabClick:function(e){!function(e){function t(e){try{"enable"==e?$$("popupFilterSubmitBtn").isEnabled()||$$("popupFilterSubmitBtn").enable():"disable"==e&&$$("popupFilterSubmitBtn").isEnabled()&&$$("popupFilterSubmitBtn").disable()}catch(e){i(e,"filterTableForm","btnSubmitState")}}function n(e){$$("popupFilterClearBtn")&&$$("popupFilterClearBtn").isVisible()&&(e?$$("popupFilterClearBtn").show():$$("popupFilterClearBtn").hide())}function o(e){$$("editFormPopupLibRemoveBtn")&&!$$("editFormPopupLibRemoveBtn").isVisible()&&(e?$$("editFormPopupLibRemoveBtn").show():$$("editFormPopupLibRemoveBtn").hide())}try{"editFormPopupLib"==e&&function(){try{n(!1),""!==$$("filterEditLib").getValue()?t("enable"):t("disable"),o(!0)}catch(e){i(e,"filterTableForm","filterLibrary")}}(),"editFormScroll"==e&&function(){let e=$$("editFormPopup").getValues(),r=0;try{Object.values(e).forEach((function(e,t){e&&r++})),n(!0),o(!1),t(r>0?"enable":"disable")}catch(e){i(e,"filterTableForm","editFilter")}}()}catch(e){i(e,"filterTableForm","tabbarLogic")}}(e)}}},{height:200,cells:[{view:"scrollview",borderless:!0,css:"webix_multivew-cell",id:"editFormScroll",scroll:"y",body:{id:"editFormPopupScroll",rows:[]}},{view:"form",scroll:!0,id:"editFormPopupLib",css:"webix_multivew-cell",borderless:!0,elements:[{view:"radio",id:"filterEditLib",vertical:!0,options:[],on:{onChange:function(){this.getValue()?(ne=this.getValue(),$$("editFormPopupLibRemoveBtn").isEnabled()||$$("editFormPopupLibRemoveBtn").enable(),$$("popupFilterSubmitBtn").isEnabled()||r(!0)):$$("popupFilterSubmitBtn").isEnabled()&&r(!1)}}}]}]},{height:20},{cols:[{view:"button",id:"popupFilterSubmitBtn",height:48,minWidth:140,disabled:!0,css:"webix_primary",hotkey:"Enter",value:"Применить",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выбранные фильтры будут добавлены в рабочее поле, остальные скрыты")}},click:ie},{width:5},{view:"button",id:"popupFilterClearBtn",width:110,height:48,css:"webix_secondary",disabled:!0,value:"Сбросить",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Все фильтры будут очищены и удалены")}},click:ae},l]}]},{}]};webix.ui({view:"popup",id:"popupFilterEdit",css:"webix_popup-filter-container webix_popup-config",modal:!0,escHide:!0,position:"center",height:400,width:400,body:{scroll:"y",rows:[{css:"webix_filter-headline-wrapper",cols:[{template:"Редактор фильтров",css:"webix_template-recover",borderless:!0,height:40},{width:150},o]},{template:"Выберите нужные поля или шаблон из библиотеки",borderless:!0,height:47},s]}}).show(),function(){const o=webix.ajax("/init/default/api/userprefs/");o.then((function(o){let r=webix.storage.local.get("user");try{r||function(){let e=webix.ajax("/init/default/api/whoami");e.then((function(e){e=e.json().content;try{!function(){let t={};t.id=e.id,t.name=e.first_name,t.username=e.username,n("user",JSON.stringify(t))}(),r=webix.storage.local.get("user")}catch(e){i(e,"filterTableForm","function getUserData")}"e"==e.err_type?a("error",e.error):a("success","Рабочая область фильтра обновлена")})),e.fail((function(e){t(e,"filterTableForm","getUserData")}))}(),r&&(function(t){let n=o.json().content;try{n.forEach((function(i,n){if(i.name.includes("filter-template_")&&i.owner==t.id){let t=JSON.parse(i.prefs);t.table==e&&$$("filterEditLib").addOption({id:n+1,value:t.name})}}))}catch(e){i(e,"filterTableForm","function setTemplates")}}(r),$$("filterEditLib")&&0==$$("filterEditLib").data.options.length&&$$("filterEditLib").addOption({id:"radioNoneContent",disabled:!0,value:"Сохранённых шаблонов нет"}),function(){try{!function(){let e=0,t=$$("filterTableForm").elements;try{Object.values(t).forEach((function(t,i){t.config.hidden||e++}))}catch(e){i(e,"filterTableForm","function counterVisibleElements")}return e}()?$$("filterEmptyTempalte")&&!$$("filterEmptyTempalte").isVisible()&&$$("popupFilterClearBtn").isEnabled()&&$$("popupFilterClearBtn").disable():$$("popupFilterClearBtn")&&!$$("popupFilterClearBtn").isEnabled()&&$$("popupFilterClearBtn").enable()}catch(e){i(e,"filterTableForm","function setBtnState")}}())}catch(e){i(e,"filterTableForm","function userprefsData")}})),o.fail((function(e){console.log(e),a("error","filterTableForm function userprefsData: "+e.status+" "+e.statusText+" "+e.responseURL)}))}(),$$("filterEditLib")&&$$("filterEditLib").setValue(ne),window.innerWidth<1200&&function(){let e=window.innerWidth-500;try{$$("popupFilterEdit")&&$$("popupFilterEdit").$width>200&&($$("popupFilterEdit").config.width=e,$$("popupFilterEdit").resize())}catch(e){i(e,"filterTableForm","function userprefsData => popupSizeAdaptive")}}();const c={view:"checkbox",id:"selectAll",labelRight:"<div style='font-weight:600'>Выбрать всё</div>",labelWidth:0,name:"selectAll",on:{onChange:function(){!function(){try{$$("selectAll").getValue()?$$("popupFilterSubmitBtn").isEnabled()||r(!0):$$("popupFilterSubmitBtn").isEnabled()&&r(!1)}catch(e){i(e,"filterTableForm","function checkbox:onchange => setStateSubmitBtn")}}(),function(){let e=$$("editFormPopupScrollContent").getChildViews();try{e.forEach((function(e,t){e.config.id.includes("checkbox")&&($$("selectAll").getValue()?e.config.value=1:e.config.value=0,$$(e).refresh())}))}catch(e){i(e,"filterTableForm","function checkbox:onchange => setValueCheckbox")}}()}}};let u=function(){let e=[],t=$$("filterTableForm").elements;try{Object.values(t).forEach((function(t,i){e.push({id:t.config.id,label:t.config.label})}))}catch(e){i(e,"filterTableForm","function editFiltersBtn => getAllCheckboxes")}return e}();!function(){const e=[{cols:[{id:"editFormPopupScrollContent",css:"webix_edit-form-popup-scroll-content",rows:[c]}]}];try{u.forEach((function(t,n){if(!t.id.includes("child")){let n={view:"checkbox",id:t.id+"_checkbox",labelRight:t.label,labelWidth:0,name:t.id,on:{onChange:function(){!function(e){let t=$$(e.id+"_checkbox").getParentView().getChildViews(),n=0,o=0;try{!function(){try{t.forEach((function(e,t){e.config.id.includes("checkbox")&&(e.config.value&&""!=e.config.value||n++),e.config.value&&o++}))}catch(e){i(e,"filterTableForm","function checkboxOnChange => getStatusCheckboxes")}}(),function(){try{o>0?$$("popupFilterSubmitBtn").isEnabled()||r(!0):$$("popupFilterSubmitBtn").isEnabled()&&r(!1)}catch(e){i(e,"filterTableForm","function checkboxOnChange => setStateBtnSubmit")}}(),function(){try{0==n?($$("selectAll").config.value=1,$$("selectAll").refresh()):0!==$$("selectAll").config.value&&($$("selectAll").config.value=0,$$("selectAll").refresh())}catch(e){i(e,"filterTableForm","function checkboxOnChange => setSelectAllState")}}()}catch(e){i(e,"filterTableForm","function checkboxOnChange")}}(t)}}};$$(t.id)&&$$(t.id).isVisible()?(n.value=1,e[0].cols[0].rows.push(n)):e[0].cols[0].rows.push(n)}})),$$("editFormPopupScroll")&&$$("editFormPopupScroll").addView({rows:e},1)}catch(e){i(e,"filterTableForm","function createCheckboxes")}}();let d=0,f=$$("editFormPopupScrollContent").getChildViews();!function(){try{f.forEach((function(e,t){e.config.id.includes("checkbox")&&(e.config.value&&""!=e.config.value||d++)}))}catch(e){i(e,"filterTableForm","function countSelectCheckboxes")}}(),function(){try{0==d&&($$("selectAll").config.value=1,$$("selectAll").refresh())}catch(e){i(e,"filterTableForm","function stateSelectAll")}}()},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Добавить/удалить фильтры")}}},ue={view:"button",id:"btnFilterSubmit",height:48,minWidth:70,css:"webix_primary",hotkey:"Enter",disabled:!0,value:"Применить фильтры",click:function(){let e=$$("filterTableForm").getValues(),n=[];function o(e,t,o,r,a,l=!1){const s=ee();let c=$$(o+"-btnFilterOperations").config.value;function u(i){return"+and+"+s+"."+t+i+e}function d(i){return s+"."+t+i+e}function f(i){return"+"+r+"+"+t+i+e}try{"parent"==a?l?"="==c?n.push(u("+=+")):"!="==c?n.push(u("+!=+")):"<"==c?n.push(u("+<+")):">"==c?n.push(u("+>+")):"<="==c?n.push(u("+<=+")):">="==c?n.push(u("+>=+")):"⊆"==c&&n.push(u("+contains+")):"="==c?n.push(d("+=+")):"!="==c?n.push(d("+!=+")):"<"==c?n.push(d("+<+")):">"==c?n.push(d("+>+")):"<="==c?n.push(d("+<=+")):">="==c?n.push(d("+>=+")):"⊆"==c&&n.push(d("+contains+")):"child"==a&&("="==c?n.push(f("+=+")):"!="==c?n.push(f("+!=+")):"<"==c?n.push(f("+<+")):">"==c?n.push(f("+>+")):">="==c?n.push(f("+>=+")):"<="==c?n.push(f("+<=+")):"⊆"==c&&n.push(f("+contains+")))}catch(e){i(e,"filterTableForm","function filterSubmitBtn => getOperationVal")}}if($$("filterTableForm").validate()){!function(){let t,n,r=webix.Date.dateToStr("%d.%m.%Y %H:%i:%s"),a=0;Object.keys(e).sort().forEach((function(l,s){if(t=l,n=e[l],n)try{"datepicker"==$$(l).config.view&&(n=r(n)),$$(l).config.text&&"Нет"==$$(l).config.text&&(n=0),l.includes("filter")&&!l.includes("condition")&&(t=l.lastIndexOf("_"),t=l.slice(0,t)),function(){try{l.includes("condition")||l.includes("child")||""===e[l]||"selectAll"===l||!$$(l).isVisible()?l.includes("child")&&(l.includes("operAnd")?o(n,t,l,"and","child"):l.includes("operOr")&&o(n,t,l,"or","child")):(a>0?o(n,t,l,"and","parent",!0):o(n,t,l,"and","parent"),a++)}catch(e){i(e,"filterTableForm","function createQuery")}}()}catch(e){i(e,"filterTableForm","function createGetData")}}))}();const r=webix.ajax("/init/default/api/smarts?query="+n.join(""));r.then((function(e){let t=e.json().err_type,n=e.json().err;e=e.json().content,"i"==t?(function(){try{0!==e.length?($$("table").hideOverlay("Ничего не найдено"),$$("table").clearAll(),$$("table").parse(e)):($$("table").clearAll(),$$("table").showOverlay("Ничего не найдено"))}catch(e){i(e,"filterTableForm","function filterSubmitBtn => setData")}}(),function(){const e=$$("table").count().toString();try{$$("table-idFilterElements").setValues(e)}catch(e){i(e,"filterTableForm","function filterSubmitBtn => setCounterValue")}}(),re(),a("success","Фильтры успшено применены")):a("error",n)})),r.fail((function(e){t(e,"filterTableForm","createGetData")}))}else a("error","Не все поля формы заполнены")}},de={view:"button",id:"filterLibrarySaveBtn",disabled:!0,height:48,minWidth:50,width:65,hotkey:"shift+esc",type:"icon",icon:"wxi-file",click:function(){try{webix.prompt({title:"Название шаблона",ok:"Сохранить",cancel:"Отменить",css:"webix_prompt-filter-lib",input:{required:!0,placeholder:"Введите название шаблона..."},width:350}).then((function(e){!async function(){Z.userprefs||await te();let o=Z.userprefs.content,r=e,l={content:[]},s=!1;const c=ee(),u=$$("inputsFilter")._collection;let d={name:r,collection:l,values:$$("filterTableForm").getValues(),table:c},f={name:c+"_filter-template_"+r,prefs:d};Z.userprefs&&(u.forEach((function(e,t){let n=e.id.lastIndexOf("_rows"),o=e.id.slice(0,n);$$(o).isVisible()&&function(e,t){try{console.log(e),$$(e.id).getChildViews().forEach((function(i,n){let o=$$(i.config.id)._collection[0].id,r=e.id.lastIndexOf("_rows"),a=e.id.slice(0,r);i.config.id.includes("child")?(console.log(i.config.id,"(child.config.id"),function(){let e=$$(i.config.id).getChildViews()[1]._collection[0].id,t={parentField:$$(a).config,childValue:{id:e+"-btnFilterOperations",value:$$(e+"-btnFilterOperations").getValue()}};console.log(e,"idInput"),o.includes("and")?(t.condition="and",l.content.push(t)):o.includes("or")&&(t.condition="or",l.content.push(t))}()):l.content.push({condition:"parent",parentField:$$(e.id).config,parentValue:{id:t+"-btnFilterOperations",value:$$(t+"-btnFilterOperations").getValue()}})}))}catch(e){i(e,"filterTableForm","function filterLibraryBtn => childs:")}}(e,o)})),function(e){o.forEach((function(i,n){let o=c+"_filter-template_"+r;i.name==o&&(s=!0,g("Шаблон с таким именем существует","После сохранения предыдущие данные будут стёрты",["Отмена","Сохранить изменения"]).then((function(n){1==n&&function(){const n=webix.ajax().put("/init/default/api/userprefs/"+i.id,e);n.then((function(e){"i"==(e=e.json()).err_type?a("success","Шаблон «"+r+"»  сохранён в библиотеку"):a("error","filterTableForm function modalBoxExists: "+e.err)})),n.fail((function(e){t(e,"filterTableForm","saveExistsTemplate => putUserprefsData")}))}()})))}))}(f),s||function(){let e=webix.storage.local.get("user").id;e?f.owner=e:function(){const e=webix.ajax("/init/default/api/whoami");e.then((function(e){f.owner=e.json().content.id;let t={};t.id=e.json().content.id,t.name=e.json().content.first_name,t.username=e.json().content.username,n("user",JSON.stringify(t))})),e.fail((function(e){t(e,"filterTableForm","saveTemplate => setDataStorage")}))}();const i=webix.ajax().post("/init/default/api/userprefs/",f);i.then((function(e){"i"==(e=e.json()).err_type?a("success","Шаблон «"+r+"»  сохранён в библиотеку"):a("error",e.error)})),i.fail((function(e){t(e,"filterTableForm","saveTemplate => saveNewTemplate")}))}())}()})).fail((function(e){console.log(e),a("error","filterTableForm function saveTemplate fail modal box: "+e)}))}catch(e){i(e,"filterTableForm","function filterSubmitBtn")}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Сохранить шаблон с полями в библиотеку")}}},fe={view:"form",hidden:!0,id:"filterTableForm",minHeight:350,minWidth:210,width:320,scroll:!0,borderless:!0,elements:[{id:"form-adaptive",minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{margin:5,rows:[{responsive:"form-adaptive",margin:5,cols:[ce,{view:"button",id:"resetFilterBtn",disabled:!0,height:48,minWidth:50,width:65,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"wxi-trash",click:oe,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Сбросить фильтры")}}}]}]},{id:"btns-adaptive",css:{"margin-top":"5px!important"},rows:[{responsive:"btns-adaptive",margin:5,cols:[ue,de]},{height:10},{id:"filterEmptyTempalte",template:"<div style='color:#858585;font-size:13px!important'>Добавьте фильтры из редактора</div>",borderless:!0}]}]}],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}};function he(t){t||(function(){try{$$("dashboards")||$$("container").addView({view:"layout",id:"dashboards",hidden:!0,scroll:"auto",rows:[{view:"scrollview",id:"dashScroll",body:{view:"flexlayout",id:"dashboardContainer",cols:[{id:"dashboardInfoContainer",minWidth:250,rows:[]},{view:"resizer"},e]}}]},3)}catch(e){i(e,"router","createDashboards")}}(),function(){try{$$("tables")||$$("container").addView({id:"tables",hidden:!0,view:"scrollview",body:{view:"flexlayout",cols:[{id:"tableContainer",rows:[z("table"),{view:"resizer",class:"webix_resizers"},D("table",Y,!0)]},{view:"resizer",class:"webix_resizers"},{id:"editTableBarContainer",rows:[{id:"editTableBarAdaptive",rows:[A,k]}]},{id:"filterTableBarContainer",hidden:!0,rows:[{id:"editFilterBarAdaptive",rows:[{id:"editFilterBarHeadline",hidden:!0,cols:[le,se]},fe]}]}]}},5)}catch(e){i(e,"router","createTables")}}(),function(){try{$$("forms")||$$("container").addView({view:"layout",id:"forms",css:"webix_tableView",hidden:!0,rows:[z("table-view",!0),{view:"resizer",class:"webix_resizers"},{view:"scrollview",body:{view:"flexlayout",cols:[D("table-view"),{view:"resizer",class:"webix_resizers",id:"propResize",hidden:!0},("propTableView",{view:"property",id:"propTableView",tooltip:"Имя: #label#<br> Значение: #value#",width:350,nameWidth:150,editable:!0,scroll:!0,hidden:!0})]}}]},6)}catch(e){i(e,"router","createForms")}}()),function(){try{"treeTempl"==t&&($$("treeTempl")||($$("container").addView({view:"layout",id:"treeTempl",hidden:!0,scroll:"auto",rows:[{id:"treeEditContainer",cols:[{rows:[{view:"edittree",id:"treeEdit",editable:!0,editor:"text",editValue:"value",css:"webix_tree-edit",editaction:"dblclick",data:[],on:{onAfterEditStop:function(e,t,i){try{let i="/init/default/api/trees/";if(e.value!=e.old){let n=$$("treeEdit").getParentId(t.id),o={name:e.value,pid:n,id:t.id,owner:null,descr:"",ttype:1,value:"",cdt:null};webix.ajax().put(i+t.id,o).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?a("success","Данные изменены"):c("013-011",e.json().err,!0)})).fail((function(e){console.log(e),u("013-011",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),c("012-011",e)}}}}]},{}]}]},4),webix.ui({view:"contextmenu",id:"contextMenuEditTree",data:["Добавить","Переименовать",{$template:"Separator"},"Свернуть всё","Развернуть всё",{$template:"Separator"},"Удалить"],master:$$("treeEdit"),on:{onMenuItemClick:function(e){let t=this.getContext(),i=$$("treeEdit"),n=i.getItem(t.id),o=this.getMenu(e).getItem(e).value,r="/init/default/api/trees/",l={name:"",pid:"",owner:null,descr:"",ttype:1,value:"",cdt:null};try{switch(o){case"Добавить":{let e=prompt("Имя нового подэлемента '"+n.value+"'","");null!=e&&(console.log(n.id),l.name=e,l.pid=n.id,webix.ajax().post(r,l).then((function(t){if("e"!==t.json().err_type&&"x"!==t.json().err_type){let o=t.json().content.id;i.data.add({id:o,value:e,pid:n.id},0,n.id),i.open(n.id),a("success","Данные сохранены")}else c("013-001",t.json().err,!0)})).fail((function(e){console.log(e),u("013-001",e.status,e.statusText,e.responseURL)})));break}case"Переименовать":var s=prompt("Новое имя",n.value);null!=s&&(l.name=s,l.id=n.id,l.pid=n.pid,webix.ajax().put(r+n.id,l).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?(n.value=s,i.updateItem(n.id,n),a("success","Данные изменены")):c("013-011",e.json().err,!0)})).fail((function(e){console.log(e),u("013-011",e.status,e.statusText,e.responseURL)})));break;case"Удалить":console.log(r+n.id+".json"),console.log(n),webix.ajax().del(r+n.id,n).then((function(e){"e"!==e.json().err_type&&"x"!==e.json().err_type?(i.remove(n.id),a("success","Данные удалены")):c("013-002",e.json().err,!0)})).fail((function(e){console.log(e),u("013-002",e.status,e.statusText,e.responseURL)}));break;case"Развернуть всё":try{i.open(n.id),i.data.eachSubItem(n.id,(function(e){i.open(e.id)}))}catch(e){console.log(e),c("013-000",e)}break;case"Свернуть всё":try{i.close(n.id),i.data.eachSubItem(n.id,(function(e){i.close(e.id)}))}catch(e){console.log(e),c("013-000",e)}}}catch(e){console.log(e),c("013-000",e)}}}})))}catch(e){i(e,"router","createTreeTempl")}}(),function(){try{"cp"==t&&$$("container").addView({view:"layout",id:"user_auth",css:"webix_auth",hidden:!0,rows:[K,{}]},7)}catch(e){i(e,"router","createCp")}}(),function(){try{"userprefs"==t&&$$("container").addView({view:"layout",id:"userprefs",css:"webix_auth",hidden:!0,rows:[X]},8)}catch(e){i(e,"router","createUserprefs")}}()}function pe(){async function e(){o.mmenu||await r("mmenu"),function(){let e,t=[],n=[];try{e=o.mmenu.mmenu,e.forEach((function(e,o){t.push(function(e){let t;try{t={id:e.name,value:e.title,action:e.action},e.title||(t.value="Без названия"),"dbtable"!==e.action&&"tform"!==e.action&&"dashboard"!==e.action&&"none"!==e.action&&(0==e.childs.length?t.webix_kids=!0:t.data=function(e){let t=[];try{e.childs.forEach((function(e,i){t.push({id:e.name,value:e.title,action:e.action})}))}catch(e){i(e,"router","generateChildsTree")}return t}(e))}catch(e){i(e,"router","generateParentTree")}return t}(e)),0!==e.childs.length&&(n=function(e){let t=[];try{t.push({id:"userprefs",value:"Настройки"}),e.childs.forEach((function(e,i){let n={id:e.name,value:e.title};"logout"!==e.name&&t.push(n)})),t.push({id:"logout",value:"Выйти",css:"webix_logout"})}catch(e){i(e,"router","generateHeaderMenu")}return t}(e))})),$$("tree").clearAll(),$$("tree").parse(t),void 0!==$$("button-context-menu").config.popup.data&&($$("button-context-menu").config.popup.data=n,$$("button-context-menu").enable())}catch(e){i(e,"router","generateMenuTree")}}()}!async function(){o.whoami||await r("whoami"),o.whoami&&(function(){try{$$("userAuth").hide(),$$("mainLayout").show()}catch(e){window.alert("showMainContent: "+e+" (Подробности: ошибка в отрисовке контента)"),i(e,"router","showMainContent")}}(),function(){let e={};e.id=o.whoami.content.id,e.name=o.whoami.content.first_name,e.username=o.whoami.content.username,n("user",JSON.stringify(e))}(),he(),e())}()}function $e(){try{$$("container").getChildViews().forEach((function(e,t){"scrollview"!=e.config.view&&"layout"!=e.config.view||$$(e.config.id).isVisible()&&$$(e.config.id).hide()}))}catch(e){i(e,"router","hideAllElements")}}function be(){try{$$("webix__null-content")&&$$("container").removeView($$("webix__null-content"))}catch(e){i(e,"router","router function removeNullContent")}}function me(){try{$$("webix__none-content")&&$$("webix__none-content").hide()}catch(e){i(e,"router","router function hideNoneContent")}}function we(){try{0==$$("tree").data.order.length&&pe()}catch(e){i(e,"router","router function checkTreeOrder")}}function ge(){try{$$("tree")&&$$("tree").closeAll()}catch(e){i(e,"router","closeTree")}}function ve(){let e=new(Backbone.Router.extend({routes:{"":"index",content:"content",userprefs:"userprefs",cp:"cp",logout:"logout","tree/:id":"tree","experimental/:id":"experimental"},content:function(){try{pe()}catch(e){i(e,"router","router:content")}},index:function(){!async function(){o.whoami||await r("whoami"),o.whoami?function(){try{Backbone.history.navigate("content",{trigger:!0})}catch(e){i(e,"router","router:index function goToContentPage")}}():function(){try{$$("mainLayout")&&$$("mainLayout").hide(),$$("userAuth")&&$$("userAuth").show()}catch(e){window.alert("getAuth: "+e+" (Подробности: ошибка в отрисовке контента, router:index function showWorkspace)"),i(e,"router","router:index function showWorkspace")}}()}()},tree:function(e){function t(){let t,n=!1;function r(e){try{$$(e)&&$$(e).show()}catch(t){i(t,"router","router:tree function showTableData (element: "+e+")")}}t=o.fields.content,function(){try{Object.values(t).forEach((function(i,o){Object.keys(t)[o]==e&&(n=!0,"dbtable"!=i.type&&"tform"!=i.type&&"dashboard"!=i.type||(me(),"dbtable"==i.type?(r("tables"),$("table",e)):"tform"==i.type?(r("forms"),$("table-view",e)):"dashboard"==i.type&&(r("dashboards"),b(e))))}))}catch(e){i(e,"router","router:tree function createElem")}}(),n||function(){try{setTimeout((function(){!function(){const e={view:"button",id:"buttonClosePopup",css:"webix_close-btn",type:"icon",width:35,icon:"wxi-close",click:function(){try{$$("popupNotFound")&&$$("popupNotFound").hide()}catch(e){i(e,"router","router:tree, btnClosePopup click")}}},t={view:"button",css:"webix_btn-not-found-back",height:46,value:"Вернуться на главную",click:function(){!function(){try{$$("popupNotFound")&&$$("popupNotFound").destructor()}catch(e){i(e,"router","router:tree, mainBtnPopup click destructPopup")}}(),function(){try{Backbone.history.navigate("content",{trigger:!0}),window.location.reload()}catch(e){i(e,"router","router:tree, mainBtnPopup click navigate")}}()}};webix.ui({view:"popup",id:"popupNotFound",css:"webix_popup-prev-href",width:340,height:125,position:"center",body:{rows:[{rows:[{cols:[{template:"Что-то пошло не так...",width:250,css:"webix_template-not-found",borderless:!0,height:20},{},e]},{template:"Страница не найдена",css:"webix_template-not-found-descr",borderless:!0,height:35},t,{height:20}]}]}}).show()}()}),1500)}catch(e){i(e,"router","router:tree function showNotFoundPopup")}}()}function n(){if($$("table-templateHeadline"))try{o.tableNames.forEach((function(t,i){t.id==e&&$$("table-templateHeadline")&&$$("table-templateHeadline").setValues(t.name)}))}catch(e){i(e,"router","router:tree function setTableName element table-templateHeadline")}if($$("table-view-templateHeadline"))try{o.tableNames.forEach((function(t,i){t.id==e&&$$("table-view-templateHeadline")&&$$("table-view-templateHeadline").setValues(t.name)}))}catch(e){i(e,"router","router:tree function setTableName element table-view-templateHeadline")}}!function(){try{0==$$("tree").data.order.length&&async function(){await pe();try{$$("tree").attachEvent("onAfterLoad",(function(){let i;$$("tree").getItem(e)?(i=$$("tree").getParentId(e),$$("tree").open(i),$$("tree").select(e)):o.fields?o.fields&&(t(),n()):async function(){o.fields||await r("fields"),o.fields&&(t(),n())}()}))}catch(e){i(e,"router","router:tree function createTable")}}()}catch(e){i(e,"router","router:tree function checkTable")}}()},cp:function(){be(),$e(),me(),we(),$$("user_auth")||he("cp"),function(){try{$$("user_auth")&&$$("user_auth").show()}catch(e){i(e,"router","router:cp function showUserAuth")}}(),ge(),function(){let e=webix.storage.local.get("user");try{e&&$$("authName").setValues(e.name.toString())}catch(e){i(e,"router","router:cp function setUserValues")}}()},userprefs:function(){function e(){try{$$("userprefs").show()}catch(e){i(e,"router","router:userprefs function showUserprefs")}}if(be(),$e(),me(),we(),$$("userprefs"))e();else{he("userprefs");const n=webix.ajax().get("/init/default/api/userprefs/");n.then((function(e){e=e.json().content,function(){try{e.forEach((function(e,t){e.name.includes("userprefs")&&$$(e.name).setValues(JSON.parse(e.prefs))}))}catch(e){i(e,"router","router:cp function setUserValues")}}()})),n.fail((function(e){t(e,"router","router:userprefs userprefsData")})),e()}!function(){let e=webix.storage.local.get("user");try{e&&$$("userprefsName").setValues(e.name.toString())}catch(e){i(e,"router","router:userprefs function setUserprefsNameValue")}}(),ge()},experimental:function(){function e(){try{$$("treeTempl").show()}catch(e){i(e,"router","router:experimental function showTreeTempl")}}be(),$e(),me(),we(),$$("treeTempl")?(e(),m()):(he("treeTempl"),m(),e()),ge()},logout:function(){const e=webix.ajax().post("/init/default/logout/");e.then((function(e){!function(){try{history.back()}catch(e){i(e,"router","router:logout function backPage")}}(),function(){try{$$("webix__none-content")&&$$("webix__none-content").show()}catch(e){i(e,"router","router:logout function showNoneContent")}}(),function(){try{$$("tree")&&$$("tree").clearAll()}catch(e){i(e,"router","router:logout function clearTree")}}(),function(){try{webix.storage.local.clear()}catch(e){i(e,"router","router:logout function clearStorage")}}()})),e.fail((function(e){t(e,"router","router:logout logoutData")}))}}));return e}webix.UIManager.addHotKey("Ctrl+Shift+E",(function(){Backbone.history.navigate("experimental/treeEdit",{trigger:!0})})),function(){!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("underscore",t):(e="undefined"!=typeof globalThis?globalThis:e||self,function(){var i=e._,n=e._=t();n.noConflict=function(){return e._=i,n}}())}(this,(function(){var e="1.13.4",t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},i=Array.prototype,n=Object.prototype,o="undefined"!=typeof Symbol?Symbol.prototype:null,r=i.push,a=i.slice,l=n.toString,s=n.hasOwnProperty,c="undefined"!=typeof ArrayBuffer,u="undefined"!=typeof DataView,d=Array.isArray,f=Object.keys,h=Object.create,p=c&&ArrayBuffer.isView,$=isNaN,b=isFinite,m=!{toString:null}.propertyIsEnumerable("toString"),w=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],g=Math.pow(2,53)-1;function v(e,t){return t=null==t?e.length-1:+t,function(){for(var i=Math.max(arguments.length-t,0),n=Array(i),o=0;o<i;o++)n[o]=arguments[o+t];switch(t){case 0:return e.call(this,n);case 1:return e.call(this,arguments[0],n);case 2:return e.call(this,arguments[0],arguments[1],n)}var r=Array(t+1);for(o=0;o<t;o++)r[o]=arguments[o];return r[t]=n,e.apply(this,r)}}function y(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function x(e){return void 0===e}function _(e){return!0===e||!1===e||"[object Boolean]"===l.call(e)}function T(e){var t="[object "+e+"]";return function(e){return l.call(e)===t}}var F=T("String"),B=T("Number"),E=T("Date"),V=T("RegExp"),P=T("Error"),A=T("Symbol"),C=T("ArrayBuffer"),k=T("Function"),I=t.document&&t.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof I&&(k=function(e){return"function"==typeof e||!1});var S=k,j=T("Object"),O=u&&j(new DataView(new ArrayBuffer(8))),L="undefined"!=typeof Map&&j(new Map),R=T("DataView"),z=O?function(e){return null!=e&&S(e.getInt8)&&C(e.buffer)}:R,N=d||T("Array");function D(e,t){return null!=e&&s.call(e,t)}var H=T("Arguments");!function(){H(arguments)||(H=function(e){return D(e,"callee")})}();var W=H;function U(e){return B(e)&&$(e)}function M(e){return function(){return e}}function q(e){return function(t){var i=e(t);return"number"==typeof i&&i>=0&&i<=g}}function J(e){return function(t){return null==t?void 0:t[e]}}var Y=J("byteLength"),K=q(Y),G=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,Q=c?function(e){return p?p(e)&&!z(e):K(e)&&G.test(l.call(e))}:M(!1),X=J("length");function Z(e,t){t=function(e){for(var t={},i=e.length,n=0;n<i;++n)t[e[n]]=!0;return{contains:function(e){return!0===t[e]},push:function(i){return t[i]=!0,e.push(i)}}}(t);var i=w.length,o=e.constructor,r=S(o)&&o.prototype||n,a="constructor";for(D(e,a)&&!t.contains(a)&&t.push(a);i--;)(a=w[i])in e&&e[a]!==r[a]&&!t.contains(a)&&t.push(a)}function ee(e){if(!y(e))return[];if(f)return f(e);var t=[];for(var i in e)D(e,i)&&t.push(i);return m&&Z(e,t),t}function te(e,t){var i=ee(t),n=i.length;if(null==e)return!n;for(var o=Object(e),r=0;r<n;r++){var a=i[r];if(t[a]!==o[a]||!(a in o))return!1}return!0}function ie(e){return e instanceof ie?e:this instanceof ie?void(this._wrapped=e):new ie(e)}function ne(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,Y(e))}ie.VERSION=e,ie.prototype.value=function(){return this._wrapped},ie.prototype.valueOf=ie.prototype.toJSON=ie.prototype.value,ie.prototype.toString=function(){return String(this._wrapped)};var oe="[object DataView]";function re(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=typeof e;return("function"===o||"object"===o||"object"==typeof t)&&ae(e,t,i,n)}function ae(e,t,i,n){e instanceof ie&&(e=e._wrapped),t instanceof ie&&(t=t._wrapped);var r=l.call(e);if(r!==l.call(t))return!1;if(O&&"[object Object]"==r&&z(e)){if(!z(t))return!1;r=oe}switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return o.valueOf.call(e)===o.valueOf.call(t);case"[object ArrayBuffer]":case oe:return ae(ne(e),ne(t),i,n)}var a="[object Array]"===r;if(!a&&Q(e)){if(Y(e)!==Y(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;a=!0}if(!a){if("object"!=typeof e||"object"!=typeof t)return!1;var s=e.constructor,c=t.constructor;if(s!==c&&!(S(s)&&s instanceof s&&S(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}n=n||[];for(var u=(i=i||[]).length;u--;)if(i[u]===e)return n[u]===t;if(i.push(e),n.push(t),a){if((u=e.length)!==t.length)return!1;for(;u--;)if(!re(e[u],t[u],i,n))return!1}else{var d,f=ee(e);if(u=f.length,ee(t).length!==u)return!1;for(;u--;)if(!D(t,d=f[u])||!re(e[d],t[d],i,n))return!1}return i.pop(),n.pop(),!0}function le(e){if(!y(e))return[];var t=[];for(var i in e)t.push(i);return m&&Z(e,t),t}function se(e){var t=X(e);return function(i){if(null==i)return!1;var n=le(i);if(X(n))return!1;for(var o=0;o<t;o++)if(!S(i[e[o]]))return!1;return e!==he||!S(i[ce])}}var ce="forEach",ue=["clear","delete"],de=["get","has","set"],fe=ue.concat(ce,de),he=ue.concat(de),pe=["add"].concat(ue,ce,"has"),$e=L?se(fe):T("Map"),be=L?se(he):T("WeakMap"),me=L?se(pe):T("Set"),we=T("WeakSet");function ge(e){for(var t=ee(e),i=t.length,n=Array(i),o=0;o<i;o++)n[o]=e[t[o]];return n}function ve(e){for(var t={},i=ee(e),n=0,o=i.length;n<o;n++)t[e[i[n]]]=i[n];return t}function ye(e){var t=[];for(var i in e)S(e[i])&&t.push(i);return t.sort()}function xe(e,t){return function(i){var n=arguments.length;if(t&&(i=Object(i)),n<2||null==i)return i;for(var o=1;o<n;o++)for(var r=arguments[o],a=e(r),l=a.length,s=0;s<l;s++){var c=a[s];t&&void 0!==i[c]||(i[c]=r[c])}return i}}var _e=xe(le),Te=xe(ee),Fe=xe(le,!0);function Be(e){if(!y(e))return{};if(h)return h(e);var t=function(){};t.prototype=e;var i=new t;return t.prototype=null,i}function Ee(e){return N(e)?e:[e]}function Ve(e){return ie.toPath(e)}function Pe(e,t){for(var i=t.length,n=0;n<i;n++){if(null==e)return;e=e[t[n]]}return i?e:void 0}function Ae(e,t,i){var n=Pe(e,Ve(t));return x(n)?i:n}function Ce(e){return e}function ke(e){return e=Te({},e),function(t){return te(t,e)}}function Ie(e){return e=Ve(e),function(t){return Pe(t,e)}}function Se(e,t,i){if(void 0===t)return e;switch(null==i?3:i){case 1:return function(i){return e.call(t,i)};case 3:return function(i,n,o){return e.call(t,i,n,o)};case 4:return function(i,n,o,r){return e.call(t,i,n,o,r)}}return function(){return e.apply(t,arguments)}}function je(e,t,i){return null==e?Ce:S(e)?Se(e,t,i):y(e)&&!N(e)?ke(e):Ie(e)}function Oe(e,t){return je(e,t,1/0)}function Le(e,t,i){return ie.iteratee!==Oe?ie.iteratee(e,t):je(e,t,i)}function Re(){}function ze(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}ie.toPath=Ee,ie.iteratee=Oe;var Ne=Date.now||function(){return(new Date).getTime()};function De(e){var t=function(t){return e[t]},i="(?:"+ee(e).join("|")+")",n=RegExp(i),o=RegExp(i,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(o,t):e}}var He={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},We=De(He),Ue=De(ve(He)),Me=ie.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},qe=/(.)^/,Je={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Ye=/\\|'|\r|\n|\u2028|\u2029/g;function Ke(e){return"\\"+Je[e]}var Ge=/^\s*(\w|\$)+\s*$/,Qe=0;function Xe(e,t,i,n,o){if(!(n instanceof t))return e.apply(i,o);var r=Be(e.prototype),a=e.apply(r,o);return y(a)?a:r}var Ze=v((function(e,t){var i=Ze.placeholder,n=function(){for(var o=0,r=t.length,a=Array(r),l=0;l<r;l++)a[l]=t[l]===i?arguments[o++]:t[l];for(;o<arguments.length;)a.push(arguments[o++]);return Xe(e,n,this,this,a)};return n}));Ze.placeholder=ie;var et=v((function(e,t,i){if(!S(e))throw new TypeError("Bind must be called on a function");var n=v((function(o){return Xe(e,n,t,this,i.concat(o))}));return n})),tt=q(X);function it(e,t,i,n){if(n=n||[],t||0===t){if(t<=0)return n.concat(e)}else t=1/0;for(var o=n.length,r=0,a=X(e);r<a;r++){var l=e[r];if(tt(l)&&(N(l)||W(l)))if(t>1)it(l,t-1,i,n),o=n.length;else for(var s=0,c=l.length;s<c;)n[o++]=l[s++];else i||(n[o++]=l)}return n}var nt=v((function(e,t){var i=(t=it(t,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var n=t[i];e[n]=et(e[n],e)}return e})),ot=v((function(e,t,i){return setTimeout((function(){return e.apply(null,i)}),t)})),rt=Ze(ot,ie,1);function at(e){return function(){return!e.apply(this,arguments)}}function lt(e,t){var i;return function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=null),i}}var st=Ze(lt,2);function ct(e,t,i){t=Le(t,i);for(var n,o=ee(e),r=0,a=o.length;r<a;r++)if(t(e[n=o[r]],n,e))return n}function ut(e){return function(t,i,n){i=Le(i,n);for(var o=X(t),r=e>0?0:o-1;r>=0&&r<o;r+=e)if(i(t[r],r,t))return r;return-1}}var dt=ut(1),ft=ut(-1);function ht(e,t,i,n){for(var o=(i=Le(i,n,1))(t),r=0,a=X(e);r<a;){var l=Math.floor((r+a)/2);i(e[l])<o?r=l+1:a=l}return r}function pt(e,t,i){return function(n,o,r){var l=0,s=X(n);if("number"==typeof r)e>0?l=r>=0?r:Math.max(r+s,l):s=r>=0?Math.min(r+1,s):r+s+1;else if(i&&r&&s)return n[r=i(n,o)]===o?r:-1;if(o!=o)return(r=t(a.call(n,l,s),U))>=0?r+l:-1;for(r=e>0?l:s-1;r>=0&&r<s;r+=e)if(n[r]===o)return r;return-1}}var $t=pt(1,dt,ht),bt=pt(-1,ft);function mt(e,t,i){var n=(tt(e)?dt:ct)(e,t,i);if(void 0!==n&&-1!==n)return e[n]}function wt(e,t,i){var n,o;if(t=Se(t,i),tt(e))for(n=0,o=e.length;n<o;n++)t(e[n],n,e);else{var r=ee(e);for(n=0,o=r.length;n<o;n++)t(e[r[n]],r[n],e)}return e}function gt(e,t,i){t=Le(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=Array(o),a=0;a<o;a++){var l=n?n[a]:a;r[a]=t(e[l],l,e)}return r}function vt(e){var t=function(t,i,n,o){var r=!tt(t)&&ee(t),a=(r||t).length,l=e>0?0:a-1;for(o||(n=t[r?r[l]:l],l+=e);l>=0&&l<a;l+=e){var s=r?r[l]:l;n=i(n,t[s],s,t)}return n};return function(e,i,n,o){var r=arguments.length>=3;return t(e,Se(i,o,4),n,r)}}var yt=vt(1),xt=vt(-1);function _t(e,t,i){var n=[];return t=Le(t,i),wt(e,(function(e,i,o){t(e,i,o)&&n.push(e)})),n}function Tt(e,t,i){t=Le(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=0;r<o;r++){var a=n?n[r]:r;if(!t(e[a],a,e))return!1}return!0}function Ft(e,t,i){t=Le(t,i);for(var n=!tt(e)&&ee(e),o=(n||e).length,r=0;r<o;r++){var a=n?n[r]:r;if(t(e[a],a,e))return!0}return!1}function Bt(e,t,i,n){return tt(e)||(e=ge(e)),("number"!=typeof i||n)&&(i=0),$t(e,t,i)>=0}var Et=v((function(e,t,i){var n,o;return S(t)?o=t:(t=Ve(t),n=t.slice(0,-1),t=t[t.length-1]),gt(e,(function(e){var r=o;if(!r){if(n&&n.length&&(e=Pe(e,n)),null==e)return;r=e[t]}return null==r?r:r.apply(e,i)}))}));function Vt(e,t){return gt(e,Ie(t))}function Pt(e,t,i){var n,o,r=-1/0,a=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var l=0,s=(e=tt(e)?e:ge(e)).length;l<s;l++)null!=(n=e[l])&&n>r&&(r=n);else t=Le(t,i),wt(e,(function(e,i,n){((o=t(e,i,n))>a||o===-1/0&&r===-1/0)&&(r=e,a=o)}));return r}var At=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Ct(e){return e?N(e)?a.call(e):F(e)?e.match(At):tt(e)?gt(e,Ce):ge(e):[]}function kt(e,t,i){if(null==t||i)return tt(e)||(e=ge(e)),e[ze(e.length-1)];var n=Ct(e),o=X(n);t=Math.max(Math.min(t,o),0);for(var r=o-1,a=0;a<t;a++){var l=ze(a,r),s=n[a];n[a]=n[l],n[l]=s}return n.slice(0,t)}function It(e,t){return function(i,n,o){var r=t?[[],[]]:{};return n=Le(n,o),wt(i,(function(t,o){var a=n(t,o,i);e(r,t,a)})),r}}var St=It((function(e,t,i){D(e,i)?e[i].push(t):e[i]=[t]})),jt=It((function(e,t,i){e[i]=t})),Ot=It((function(e,t,i){D(e,i)?e[i]++:e[i]=1})),Lt=It((function(e,t,i){e[i?0:1].push(t)}),!0);function Rt(e,t,i){return t in i}var zt=v((function(e,t){var i={},n=t[0];if(null==e)return i;S(n)?(t.length>1&&(n=Se(n,t[1])),t=le(e)):(n=Rt,t=it(t,!1,!1),e=Object(e));for(var o=0,r=t.length;o<r;o++){var a=t[o],l=e[a];n(l,a,e)&&(i[a]=l)}return i})),Nt=v((function(e,t){var i,n=t[0];return S(n)?(n=at(n),t.length>1&&(i=t[1])):(t=gt(it(t,!1,!1),String),n=function(e,i){return!Bt(t,i)}),zt(e,n,i)}));function Dt(e,t,i){return a.call(e,0,Math.max(0,e.length-(null==t||i?1:t)))}function Ht(e,t,i){return null==e||e.length<1?null==t||i?void 0:[]:null==t||i?e[0]:Dt(e,e.length-t)}function Wt(e,t,i){return a.call(e,null==t||i?1:t)}var Ut=v((function(e,t){return t=it(t,!0,!0),_t(e,(function(e){return!Bt(t,e)}))})),Mt=v((function(e,t){return Ut(e,t)}));function qt(e,t,i,n){_(t)||(n=i,i=t,t=!1),null!=i&&(i=Le(i,n));for(var o=[],r=[],a=0,l=X(e);a<l;a++){var s=e[a],c=i?i(s,a,e):s;t&&!i?(a&&r===c||o.push(s),r=c):i?Bt(r,c)||(r.push(c),o.push(s)):Bt(o,s)||o.push(s)}return o}var Jt=v((function(e){return qt(it(e,!0,!0))}));function Yt(e){for(var t=e&&Pt(e,X).length||0,i=Array(t),n=0;n<t;n++)i[n]=Vt(e,n);return i}var Kt=v(Yt);function Gt(e,t){return e._chain?ie(t).chain():t}function Qt(e){return wt(ye(e),(function(t){var i=ie[t]=e[t];ie.prototype[t]=function(){var e=[this._wrapped];return r.apply(e,arguments),Gt(this,i.apply(ie,e))}})),ie}wt(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=i[e];ie.prototype[e]=function(){var i=this._wrapped;return null!=i&&(t.apply(i,arguments),"shift"!==e&&"splice"!==e||0!==i.length||delete i[0]),Gt(this,i)}})),wt(["concat","join","slice"],(function(e){var t=i[e];ie.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),Gt(this,e)}}));var Xt={__proto__:null,VERSION:e,restArguments:v,isObject:y,isNull:function(e){return null===e},isUndefined:x,isBoolean:_,isElement:function(e){return!(!e||1!==e.nodeType)},isString:F,isNumber:B,isDate:E,isRegExp:V,isError:P,isSymbol:A,isArrayBuffer:C,isDataView:z,isArray:N,isFunction:S,isArguments:W,isFinite:function(e){return!A(e)&&b(e)&&!isNaN(parseFloat(e))},isNaN:U,isTypedArray:Q,isEmpty:function(e){if(null==e)return!0;var t=X(e);return"number"==typeof t&&(N(e)||F(e)||W(e))?0===t:0===X(ee(e))},isMatch:te,isEqual:function(e,t){return re(e,t)},isMap:$e,isWeakMap:be,isSet:me,isWeakSet:we,keys:ee,allKeys:le,values:ge,pairs:function(e){for(var t=ee(e),i=t.length,n=Array(i),o=0;o<i;o++)n[o]=[t[o],e[t[o]]];return n},invert:ve,functions:ye,methods:ye,extend:_e,extendOwn:Te,assign:Te,defaults:Fe,create:function(e,t){var i=Be(e);return t&&Te(i,t),i},clone:function(e){return y(e)?N(e)?e.slice():_e({},e):e},tap:function(e,t){return t(e),e},get:Ae,has:function(e,t){for(var i=(t=Ve(t)).length,n=0;n<i;n++){var o=t[n];if(!D(e,o))return!1;e=e[o]}return!!i},mapObject:function(e,t,i){t=Le(t,i);for(var n=ee(e),o=n.length,r={},a=0;a<o;a++){var l=n[a];r[l]=t(e[l],l,e)}return r},identity:Ce,constant:M,noop:Re,toPath:Ee,property:Ie,propertyOf:function(e){return null==e?Re:function(t){return Ae(e,t)}},matcher:ke,matches:ke,times:function(e,t,i){var n=Array(Math.max(0,e));t=Se(t,i,1);for(var o=0;o<e;o++)n[o]=t(o);return n},random:ze,now:Ne,escape:We,unescape:Ue,templateSettings:Me,template:function(e,t,i){!t&&i&&(t=i),t=Fe({},t,ie.templateSettings);var n=RegExp([(t.escape||qe).source,(t.interpolate||qe).source,(t.evaluate||qe).source].join("|")+"|$","g"),o=0,r="__p+='";e.replace(n,(function(t,i,n,a,l){return r+=e.slice(o,l).replace(Ye,Ke),o=l+t.length,i?r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?r+="'+\n((__t=("+n+"))==null?'':__t)+\n'":a&&(r+="';\n"+a+"\n__p+='"),t})),r+="';\n";var a,l=t.variable;if(l){if(!Ge.test(l))throw new Error("variable is not a bare identifier: "+l)}else r="with(obj||{}){\n"+r+"}\n",l="obj";r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{a=new Function(l,"_",r)}catch(e){throw e.source=r,e}var s=function(e){return a.call(this,e,ie)};return s.source="function("+l+"){\n"+r+"}",s},result:function(e,t,i){var n=(t=Ve(t)).length;if(!n)return S(i)?i.call(e):i;for(var o=0;o<n;o++){var r=null==e?void 0:e[t[o]];void 0===r&&(r=i,o=n),e=S(r)?r.call(e):r}return e},uniqueId:function(e){var t=++Qe+"";return e?e+t:t},chain:function(e){var t=ie(e);return t._chain=!0,t},iteratee:Oe,partial:Ze,bind:et,bindAll:nt,memoize:function(e,t){var i=function(n){var o=i.cache,r=""+(t?t.apply(this,arguments):n);return D(o,r)||(o[r]=e.apply(this,arguments)),o[r]};return i.cache={},i},delay:ot,defer:rt,throttle:function(e,t,i){var n,o,r,a,l=0;i||(i={});var s=function(){l=!1===i.leading?0:Ne(),n=null,a=e.apply(o,r),n||(o=r=null)},c=function(){var c=Ne();l||!1!==i.leading||(l=c);var u=t-(c-l);return o=this,r=arguments,u<=0||u>t?(n&&(clearTimeout(n),n=null),l=c,a=e.apply(o,r),n||(o=r=null)):n||!1===i.trailing||(n=setTimeout(s,u)),a};return c.cancel=function(){clearTimeout(n),l=0,n=o=r=null},c},debounce:function(e,t,i){var n,o,r,a,l,s=function(){var c=Ne()-o;t>c?n=setTimeout(s,t-c):(n=null,i||(a=e.apply(l,r)),n||(r=l=null))},c=v((function(c){return l=this,r=c,o=Ne(),n||(n=setTimeout(s,t),i&&(a=e.apply(l,r))),a}));return c.cancel=function(){clearTimeout(n),n=r=l=null},c},wrap:function(e,t){return Ze(t,e)},negate:at,compose:function(){var e=arguments,t=e.length-1;return function(){for(var i=t,n=e[t].apply(this,arguments);i--;)n=e[i].call(this,n);return n}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:lt,once:st,findKey:ct,findIndex:dt,findLastIndex:ft,sortedIndex:ht,indexOf:$t,lastIndexOf:bt,find:mt,detect:mt,findWhere:function(e,t){return mt(e,ke(t))},each:wt,forEach:wt,map:gt,collect:gt,reduce:yt,foldl:yt,inject:yt,reduceRight:xt,foldr:xt,filter:_t,select:_t,reject:function(e,t,i){return _t(e,at(Le(t)),i)},every:Tt,all:Tt,some:Ft,any:Ft,contains:Bt,includes:Bt,include:Bt,invoke:Et,pluck:Vt,where:function(e,t){return _t(e,ke(t))},max:Pt,min:function(e,t,i){var n,o,r=1/0,a=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var l=0,s=(e=tt(e)?e:ge(e)).length;l<s;l++)null!=(n=e[l])&&n<r&&(r=n);else t=Le(t,i),wt(e,(function(e,i,n){((o=t(e,i,n))<a||o===1/0&&r===1/0)&&(r=e,a=o)}));return r},shuffle:function(e){return kt(e,1/0)},sample:kt,sortBy:function(e,t,i){var n=0;return t=Le(t,i),Vt(gt(e,(function(e,i,o){return{value:e,index:n++,criteria:t(e,i,o)}})).sort((function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index-t.index})),"value")},groupBy:St,indexBy:jt,countBy:Ot,partition:Lt,toArray:Ct,size:function(e){return null==e?0:tt(e)?e.length:ee(e).length},pick:zt,omit:Nt,first:Ht,head:Ht,take:Ht,initial:Dt,last:function(e,t,i){return null==e||e.length<1?null==t||i?void 0:[]:null==t||i?e[e.length-1]:Wt(e,Math.max(0,e.length-t))},rest:Wt,tail:Wt,drop:Wt,compact:function(e){return _t(e,Boolean)},flatten:function(e,t){return it(e,t,!1)},without:Mt,uniq:qt,unique:qt,union:Jt,intersection:function(e){for(var t=[],i=arguments.length,n=0,o=X(e);n<o;n++){var r=e[n];if(!Bt(t,r)){var a;for(a=1;a<i&&Bt(arguments[a],r);a++);a===i&&t.push(r)}}return t},difference:Ut,unzip:Yt,transpose:Yt,zip:Kt,object:function(e,t){for(var i={},n=0,o=X(e);n<o;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},range:function(e,t,i){null==t&&(t=e||0,e=0),i||(i=t<e?-1:1);for(var n=Math.max(Math.ceil((t-e)/i),0),o=Array(n),r=0;r<n;r++,e+=i)o[r]=e;return o},chunk:function(e,t){if(null==t||t<1)return[];for(var i=[],n=0,o=e.length;n<o;)i.push(a.call(e,n,n+=t));return i},mixin:Qt,default:ie},Zt=Qt(Xt);return Zt._=Zt,Zt})),function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],(function(i,n,o){t.Backbone=e(t,o,i,n)}));else if("undefined"!=typeof exports){var i,n=require("underscore");try{i=require("jquery")}catch(e){}e(t,exports,n,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}((function(e,t,i,n){var o=e.Backbone,r=Array.prototype.slice;t.VERSION="1.4.1",t.$=n,t.noConflict=function(){return e.Backbone=o,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a,l=t.Events={},s=/\s+/,c=function(e,t,n,o,r){var a,l=0;if(n&&"object"==typeof n){void 0!==o&&"context"in r&&void 0===r.context&&(r.context=o);for(a=i.keys(n);l<a.length;l++)t=c(e,t,a[l],n[a[l]],r)}else if(n&&s.test(n))for(a=n.split(s);l<a.length;l++)t=e(t,a[l],o,r);else t=e(t,n,o,r);return t};l.on=function(e,t,i){return this._events=c(u,this._events||{},e,t,{context:i,ctx:this,listening:a}),a&&((this._listeners||(this._listeners={}))[a.id]=a,a.interop=!1),this},l.listenTo=function(e,t,n){if(!e)return this;var o=e._listenId||(e._listenId=i.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),l=a=r[o];l||(this._listenId||(this._listenId=i.uniqueId("l")),l=a=r[o]=new b(this,e));var s=d(e,t,n,this);if(a=void 0,s)throw s;return l.interop&&l.on(t,n),this};var u=function(e,t,i,n){if(i){var o=e[t]||(e[t]=[]),r=n.context,a=n.ctx,l=n.listening;l&&l.count++,o.push({callback:i,context:r,ctx:r||a,listening:l})}return e},d=function(e,t,i,n){try{e.on(t,i,n)}catch(e){return e}};l.off=function(e,t,i){return this._events?(this._events=c(f,this._events,e,t,{context:i,listeners:this._listeners}),this):this},l.stopListening=function(e,t,n){var o=this._listeningTo;if(!o)return this;for(var r=e?[e._listenId]:i.keys(o),a=0;a<r.length;a++){var l=o[r[a]];if(!l)break;l.obj.off(t,n,this),l.interop&&l.off(t,n)}return i.isEmpty(o)&&(this._listeningTo=void 0),this};var f=function(e,t,n,o){if(e){var r,a=o.context,l=o.listeners,s=0;if(t||a||n){for(r=t?[t]:i.keys(e);s<r.length;s++){var c=e[t=r[s]];if(!c)break;for(var u=[],d=0;d<c.length;d++){var f=c[d];if(n&&n!==f.callback&&n!==f.callback._callback||a&&a!==f.context)u.push(f);else{var h=f.listening;h&&h.off(t,n)}}u.length?e[t]=u:delete e[t]}return e}for(r=i.keys(l);s<r.length;s++)l[r[s]].cleanup()}};l.once=function(e,t,i){var n=c(h,{},e,t,this.off.bind(this));return"string"==typeof e&&null==i&&(t=void 0),this.on(n,t,i)},l.listenToOnce=function(e,t,i){var n=c(h,{},t,i,this.stopListening.bind(this,e));return this.listenTo(e,n)};var h=function(e,t,n,o){if(n){var r=e[t]=i.once((function(){o(t,r),n.apply(this,arguments)}));r._callback=n}return e};l.trigger=function(e){if(!this._events)return this;for(var t=Math.max(0,arguments.length-1),i=Array(t),n=0;n<t;n++)i[n]=arguments[n+1];return c(p,this._events,e,void 0,i),this};var p=function(e,t,i,n){if(e){var o=e[t],r=e.all;o&&r&&(r=r.slice()),o&&$(o,n),r&&$(r,[t].concat(n))}return e},$=function(e,t){var i,n=-1,o=e.length,r=t[0],a=t[1],l=t[2];switch(t.length){case 0:for(;++n<o;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r);return;case 2:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r,a);return;case 3:for(;++n<o;)(i=e[n]).callback.call(i.ctx,r,a,l);return;default:for(;++n<o;)(i=e[n]).callback.apply(i.ctx,t);return}},b=function(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0};b.prototype.on=l.on,b.prototype.off=function(e,t){var i;this.interop?(this._events=c(f,this._events,e,t,{context:void 0,listeners:void 0}),i=!this._events):(this.count--,i=0===this.count),i&&this.cleanup()},b.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},l.bind=l.on,l.unbind=l.off,i.extend(t,l);var m=t.Model=function(e,t){var n=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});var o=i.result(this,"defaults");n=i.defaults(i.extend({},o,n),o),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(m.prototype,l,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!i.iteratee(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;var o;if("object"==typeof e?(o=e,n=t):(o={})[e]=t,n||(n={}),!this._validate(o,n))return!1;var r=n.unset,a=n.silent,l=[],s=this._changing;this._changing=!0,s||(this._previousAttributes=i.clone(this.attributes),this.changed={});var c=this.attributes,u=this.changed,d=this._previousAttributes;for(var f in o)t=o[f],i.isEqual(c[f],t)||l.push(f),i.isEqual(d[f],t)?delete u[f]:u[f]=t,r?delete c[f]:c[f]=t;if(this.idAttribute in o){var h=this.id;this.id=this.get(this.idAttribute),this.trigger("changeId",this,h,n)}if(!a){l.length&&(this._pending=n);for(var p=0;p<l.length;p++)this.trigger("change:"+l[p],this,c[l[p]],n)}if(s)return this;if(!a)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&i.clone(this.changed);var t,n=this._changing?this._previousAttributes:this.attributes,o={};for(var r in e){var a=e[r];i.isEqual(n[r],a)||(o[r]=a,t=!0)}return!!t&&o},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=i.extend({parse:!0},e);var t=this,n=e.success;return e.success=function(i){var o=e.parse?t.parse(i,e):i;if(!t.set(o,e))return!1;n&&n.call(e.context,t,i,e),t.trigger("sync",t,i,e)},U(this,e),this.sync("read",this,e)},save:function(e,t,n){var o;null==e||"object"==typeof e?(o=e,n=t):(o={})[e]=t;var r=(n=i.extend({validate:!0,parse:!0},n)).wait;if(o&&!r){if(!this.set(o,n))return!1}else if(!this._validate(o,n))return!1;var a=this,l=n.success,s=this.attributes;n.success=function(e){a.attributes=s;var t=n.parse?a.parse(e,n):e;if(r&&(t=i.extend({},o,t)),t&&!a.set(t,n))return!1;l&&l.call(n.context,a,e,n),a.trigger("sync",a,e,n)},U(this,n),o&&r&&(this.attributes=i.extend({},s,o));var c=this.isNew()?"create":n.patch?"patch":"update";"patch"!==c||n.attrs||(n.attrs=o);var u=this.sync(c,this,n);return this.attributes=s,u},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,o=e.wait,r=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(i){o&&r(),n&&n.call(e.context,t,i,e),t.isNew()||t.trigger("sync",t,i,e)};var a=!1;return this.isNew()?i.defer(e.success):(U(this,e),a=this.sync("delete",this,e)),o||r(),a},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||W();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1)}});var w=t.Collection=function(e,t){t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},v={add:!0,remove:!1},y=function(e,t,i){i=Math.min(Math.max(i,0),e.length);var n,o=Array(e.length-i),r=t.length;for(n=0;n<o.length;n++)o[n]=e[n+i];for(n=0;n<r;n++)e[n+i]=t[n];for(n=0;n<o.length;n++)e[n+r+i]=o[n]};i.extend(w.prototype,l,{model:m,preinitialize:function(){},initialize:function(){},toJSON:function(e){return this.map((function(t){return t.toJSON(e)}))},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,v))},remove:function(e,t){t=i.extend({},t);var n=!i.isArray(e);e=n?[e]:e.slice();var o=this._removeModels(e,t);return!t.silent&&o.length&&(t.changes={added:[],merged:[],removed:o},this.trigger("update",this,t)),n?o[0]:o},set:function(e,t){if(null!=e){(t=i.extend({},g,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var n=!i.isArray(e);e=n?[e]:e.slice();var o=t.at;null!=o&&(o=+o),o>this.length&&(o=this.length),o<0&&(o+=this.length+1);var r,a,l=[],s=[],c=[],u=[],d={},f=t.add,h=t.merge,p=t.remove,$=!1,b=this.comparator&&null==o&&!1!==t.sort,m=i.isString(this.comparator)?this.comparator:null;for(a=0;a<e.length;a++){r=e[a];var w=this.get(r);if(w){if(h&&r!==w){var v=this._isModel(r)?r.attributes:r;t.parse&&(v=w.parse(v,t)),w.set(v,t),c.push(w),b&&!$&&($=w.hasChanged(m))}d[w.cid]||(d[w.cid]=!0,l.push(w)),e[a]=w}else f&&(r=e[a]=this._prepareModel(r,t))&&(s.push(r),this._addReference(r,t),d[r.cid]=!0,l.push(r))}if(p){for(a=0;a<this.length;a++)d[(r=this.models[a]).cid]||u.push(r);u.length&&this._removeModels(u,t)}var x=!1,_=!b&&f&&p;if(l.length&&_?(x=this.length!==l.length||i.some(this.models,(function(e,t){return e!==l[t]})),this.models.length=0,y(this.models,l,0),this.length=this.models.length):s.length&&(b&&($=!0),y(this.models,s,null==o?this.length:o),this.length=this.models.length),$&&this.sort({silent:!0}),!t.silent){for(a=0;a<s.length;a++)null!=o&&(t.index=o+a),(r=s[a]).trigger("add",r,this,t);($||x)&&this.trigger("sort",this,t),(s.length||u.length||c.length)&&(t.changes={added:s,removed:u,merged:c},this.trigger("update",this,t))}return n?e[0]:e}},reset:function(e,t){t=t?i.clone(t):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return r.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e,e.idAttribute)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var n=t.length;return i.isFunction(t)&&(t=t.bind(this)),1===n||i.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){var t=(e=i.extend({parse:!0},e)).success,n=this;return e.success=function(i){var o=e.reset?"reset":"set";n[o](i,e),t&&t.call(e.context,n,i,e),n.trigger("sync",n,i,e)},U(this,e),this.sync("read",this,e)},create:function(e,t){var n=(t=t?i.clone(t):{}).wait;if(!(e=this._prepareModel(e,t)))return!1;n||this.add(e,t);var o=this,r=t.success;return t.success=function(e,t,i){n&&o.add(e,i),r&&r.call(i.context,e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e,t){return e[t||this.model.prototype.idAttribute||"id"]},values:function(){return new _(this,T)},keys:function(){return new _(this,F)},entries:function(){return new _(this,B)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){return this._isModel(e)?(e.collection||(e.collection=this),e):((t=t?i.clone(t):{}).collection=this,(n=this.model.prototype?new this.model(e,t):this.model(e,t)).validationError?(this.trigger("invalid",this,n.validationError,t),!1):n);var n},_removeModels:function(e,t){for(var i=[],n=0;n<e.length;n++){var o=this.get(e[n]);if(o){var r=this.indexOf(o);this.models.splice(r,1),this.length--,delete this._byId[o.cid];var a=this.modelId(o.attributes,o.idAttribute);null!=a&&delete this._byId[a],t.silent||(t.index=r,o.trigger("remove",o,this,t)),i.push(o),this._removeReference(o,t)}}return i},_isModel:function(e){return e instanceof m},_addReference:function(e,t){this._byId[e.cid]=e;var i=this.modelId(e.attributes,e.idAttribute);null!=i&&(this._byId[i]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var i=this.modelId(e.attributes,e.idAttribute);null!=i&&delete this._byId[i],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){if(t){if(("add"===e||"remove"===e)&&i!==this)return;if("destroy"===e&&this.remove(t,n),"changeId"===e){var o=this.modelId(t.previousAttributes(),t.idAttribute),r=this.modelId(t.attributes,t.idAttribute);null!=o&&delete this._byId[o],null!=r&&(this._byId[r]=t)}}this.trigger.apply(this,arguments)}});var x="function"==typeof Symbol&&Symbol.iterator;x&&(w.prototype[x]=w.prototype.values);var _=function(e,t){this._collection=e,this._kind=t,this._index=0},T=1,F=2,B=3;x&&(_.prototype[x]=function(){return this}),_.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var e,t=this._collection.at(this._index);if(this._index++,this._kind===T)e=t;else{var i=this._collection.modelId(t.attributes,t.idAttribute);e=this._kind===F?i:[i,t]}return{value:e,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var E=t.View=function(e){this.cid=i.uniqueId("view"),this.preinitialize.apply(this,arguments),i.extend(this,i.pick(e,P)),this._ensureElement(),this.initialize.apply(this,arguments)},V=/^(\S+)\s*(.*)$/,P=["model","collection","el","id","attributes","className","tagName","events"];i.extend(E.prototype,l,{tagName:"div",$:function(e){return this.$el.find(e)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=i.result(this,"events")),!e)return this;for(var t in this.undelegateEvents(),e){var n=e[t];if(i.isFunction(n)||(n=this[n]),n){var o=t.match(V);this.delegate(o[1],o[2],n.bind(this))}}return this},delegate:function(e,t,i){return this.$el.on(e+".delegateEvents"+this.cid,t,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,i){return this.$el.off(e+".delegateEvents"+this.cid,t,i),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e.class=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}});var A=function(e,t,n,o){i.each(n,(function(i,n){t[n]&&(e.prototype[n]=function(e,t,i,n){switch(t){case 1:return function(){return e[i](this[n])};case 2:return function(t){return e[i](this[n],t)};case 3:return function(t,o){return e[i](this[n],C(t,this),o)};case 4:return function(t,o,r){return e[i](this[n],C(t,this),o,r)};default:return function(){var t=r.call(arguments);return t.unshift(this[n]),e[i].apply(e,t)}}}(t,i,n,o))}))},C=function(e,t){return i.isFunction(e)?e:i.isObject(e)&&!t._isModel(e)?k(e):i.isString(e)?function(t){return t.get(e)}:e},k=function(e){var t=i.matches(e);return function(e){return t(e.attributes)}};i.each([[w,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"],[m,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],(function(e){var t=e[0],n=e[1],o=e[2];t.mixin=function(e){var n=i.reduce(i.functions(e),(function(e,t){return e[t]=0,e}),{});A(t,e,n,o)},A(t,i,n,o)})),t.sync=function(e,n,o){var r=I[e];i.defaults(o||(o={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var a={type:r,dataType:"json"};if(o.url||(a.url=i.result(n,"url")||W()),null!=o.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(o.attrs||n.toJSON(o))),o.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),o.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){a.type="POST",o.emulateJSON&&(a.data._method=r);var l=o.beforeSend;o.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",r),l)return l.apply(this,arguments)}}"GET"===a.type||o.emulateJSON||(a.processData=!1);var s=o.error;o.error=function(e,t,i){o.textStatus=t,o.errorThrown=i,s&&s.call(o.context,e,t,i)};var c=o.xhr=t.ajax(i.extend(a,o));return n.trigger("request",n,c,o),c};var I={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var S=t.Router=function(e){e||(e={}),this.preinitialize.apply(this,arguments),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},j=/\((.*?)\)/g,O=/(\(\?)?:\w+/g,L=/\*\w+/g,R=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(S.prototype,l,{preinitialize:function(){},initialize:function(){},route:function(e,n,o){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(o=n,n=""),o||(o=this[n]);var r=this;return t.history.route(e,(function(i){var a=r._extractParameters(e,i);!1!==r.execute(o,a,n)&&(r.trigger.apply(r,["route:"+n].concat(a)),r.trigger("route",n,a),t.history.trigger("route",r,n,a))})),this},execute:function(e,t,i){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(R,"\\$&").replace(j,"(?:$1)?").replace(O,(function(e,t){return t?e:"([^/?]+)"})).replace(L,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,(function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null}))}});var z=t.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},N=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,H=/#.*$/;z.started=!1,i.extend(z.prototype,l,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(N,"")},start:function(e){if(z.started)throw new Error("Backbone.history has already been started");if(z.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(D,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,o=n.insertBefore(this.iframe,n.firstChild).contentWindow;o.document.open(),o.document.close(),o.location.hash="#"+this.fragment}var r=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),z.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),i.some(this.handlers,(function(t){if(t.route.test(e))return t.callback(e),!0})))},navigate:function(e,t){if(!z.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");var i=this.root;""!==e&&"?"!==e.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+e;e=e.replace(H,"");var o=this.decodeFragment(e);if(this.fragment!==o){if(this.fragment=o,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;t.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new z,m.extend=w.extend=S.extend=E.extend=z.extend=function(e,t){var n,o=this;return n=e&&i.has(e,"constructor")?e.constructor:function(){return o.apply(this,arguments)},i.extend(n,o,t),n.prototype=i.create(o.prototype,e),n.prototype.constructor=n,n.__super__=o.prototype,n};var W=function(){throw new Error('A "url" property or function must be specified')},U=function(e,t){var i=t.error;t.error=function(n){i&&i.call(t.context,e,n,t),e.trigger("error",e,n,t)}};return t}))}();let ye="";function xe(){let e={view:"edittree",id:"tree",css:"webix_tree-main",minWidth:100,width:250,editable:!1,select:!0,editor:"text",editValue:"value",activeTitle:!0,clipboard:!0,data:[],on:{onSelectChange:function(e){ye=e[0];let t=$$("tree").getSelectedItem().id,i=$$("tree").getParentId(t),n=$$("tree").data.order,a=[],l="";try{$$("inputsTable")&&$$("EditEmptyTempalte").show(),$$("filterEmptyTempalte")&&$$("filterEmptyTempalte").show(),$$("table-editTableBtnId").isVisible()&&$$("table-editTableBtnId").hide(),$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").hide(),$$("editTableBarContainer")&&!$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").show(),$$("table-editForm")&&!$$("table-editForm").isVisible()&&$$("table-editForm").show(),$$("btnFilterSubmit").isEnabled()&&$$("btnFilterSubmit").disable(),$$("filterLibrarySaveBtn").isEnabled()&&$$("filterLibrarySaveBtn").disable(),$$("resetFilterBtn").isEnabled()&&$$("resetFilterBtn").disable(),$$("table-editForm")&&$$("table-editForm").config.width<320&&($$("table-editForm").config.width=320,$$("table-editForm").refresh());let o=document.querySelector(".webix_btn-filter");o&&o.classList.contains("webix_primary")&&(o.classList.add("webix_secondary"),o.classList.remove("webix_primary")),$$("treeTempl")&&!$$(e)&&$$("treeTempl").hide(),n.forEach((function(e,t){0==$$("tree").getParentId(e)&&a.push(e)})),t.includes("single")&&(l=$$("tree").getSelectedItem().typeof),(e[0]&&0!==i||l)&&$$("webix__none-content").hide()}catch(e){console.log(e),c("009-000",e)}function s(e,t){try{return $$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),$$("user_auth")&&$$("user_auth").isVisible()&&$$("user_auth").hide(),$$("userprefs")&&$$("userprefs").isVisible()&&$$("userprefs").hide(),void 0!==t?a.forEach((function(i,n){i.includes("single")?e&&$$(e).hide():("treeTempl"!==t?async function(){let e;if(o.fields||await r("fields"),o.fields){let i=o.fields.content;e=!1,i[t]&&(e=!0,"dbtable"==i[t].type?$$("tables")&&$$("tables").show():"tform"==i[t].type?$$("forms")&&$$("forms").show():"dashboard"==i[t].type&&$$("dashboards")&&$$("dashboards").show(),function(e){$$("table-templateHeadline")&&o.tableNames.forEach((function(t,i){t.id==e&&$$("table-templateHeadline").setValues(t.name)})),$$("table-view-templateHeadline")&&o.tableNames.forEach((function(t,i){t.id==e&&$$("table-view-templateHeadline").setValues(t.name)}))}(t))}return e}().then((function(e){e||($$("webix__none-content").isVisible()&&$$("webix__none-content").hide(),$$("webix__null-content")||$$("container").addView({view:"align",align:"middle,center",id:"webix__null-content",body:{borderless:!0,template:"Блок в процессе разработки",height:50,width:220,css:{color:"#858585","font-size":"14px!important"}}},2))})):$$("webix__none-content").isVisible()||($$("webix__none-content").show(),$$("container").getChildViews().forEach((function(e,t){"webix__none-content"!==e.config.id&&0==e.config.hidden&&$$(e.config.id).hide()}))),i!==t&&$$(i)&&$$(i).hide())})):a.forEach((function(t,n){t.includes("single")?e&&$$(e).show():t==i?$$(t)?$$(t).show():$$("webix__null-content")||$$("container").addView({view:"align",align:"middle,center",id:"webix__null-content",body:{borderless:!0,template:"Блок в процессе разработки",height:50,width:220,css:{color:"#858585","font-size":"14px!important"}}},2):($$(t)||"treeTempl"==t)&&$$(t)&&$$(t).hide()}))}catch(e){console.log(e),c("009-000",e)}}try{"tables"==i||"dbtable"==l?s("tables"):"dashboards"==i||"dashboard"==l?s("dashboards"):"forms"==i||"tform"==l?($$("propTableView")&&$$("propTableView").isVisible()&&$$("propTableView").hide(),s("forms")):"user_auth"==i?s():0!=i||"tables"===t||"user_auth"===t||"dashboards"===t||"forms"===t||l?"treeTempl"==i&&s():s(!1,e[0]),"tables"==i||"dbtable"==l?(P(),0!==Object.keys($$("table-editForm").elements).length&&$$("inputsTable").hide(),$("table",e[0])):"dashboards"==i?b():"dashboard"==l?b(e[0],!0):"forms"==i||"tform"==l?$("table-view",e[0]):"treeTempl"==i&&m()}catch(e){console.log(e),c("009-000",e)}$$("table-templateHeadline")&&$$("table-templateHeadline").isVisible()?o.tableNames.forEach((function(e,t){e.id==$$("tree").getSelectedId()&&$$("table-templateHeadline").setValues(e.name)})):$$("table-view-templateHeadline")&&$$("table-view-templateHeadline").isVisible()&&o.tableNames.forEach((function(e,t){e.id==$$("tree").getSelectedId()&&$$("table-view-templateHeadline").setValues(e.name)}))},onItemClick:function(e,t,i){let n=$$("editTableFormProperty").getValues(),o=function(){let e;if($$("tree").getSelectedItem())e=$$("tree").getSelectedItem().id;else{let t=window.location.pathname,i=t.lastIndexOf("/");e=t.slice(i+1)}return e}();function r(){$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh()}function l(){$$("propertyRefbtnsContainer")&&$$("propertyRefbtns").removeView($$("propertyRefbtnsContainer"))}function s(){y().forEach((function(e,t){let i;$$("table").getColumns().forEach((function(t,n){t.id==e.nameCol&&(i=t.label)})),a("error",e.textError+" (Поле: "+i+")")}))}if($$("editTableFormProperty").config.dirty){try{g().then((function(t){1==t?($$("table-saveNewBtn").isVisible()?$$("table-saveNewBtn").hide():$$("table-saveBtn").isVisible()&&$$("table-saveBtn").hide(),$$("table-delBtnId").disable(),$$("editTableFormProperty")&&$$("editTableFormProperty").isVisible()&&($$("editTableFormProperty").clear(),$$("editTableFormProperty").hide()),r(),$$("tree").select(e)):2==t&&($$("editTableFormProperty").getValues().id?y().length?s():n.id&&webix.ajax().put("/init/default/api/"+o+"/"+n.id,function(e){let t={};return Object.values(e).forEach((function(i,n){let o=$$("table").getItem(e.id),r=Object.keys(o);!function(){let i=Object.keys(e)[n];r.forEach((function(r){r==i&&o[r]!==Object.values(e)[n]&&(t[Object.keys(e)[n]]=Object.values(e)[n])}))}()})),t}(n),{success:function(t,i,n){"i"==(i=i.json()).err_type&&(r(),l(),$$("tree").select(e),a("success","Данные успешно добавлены",o)),"e"==i.err_type&&a("error",i.error)},error:function(e,t,i){a("error","table function putData: "+i.status+" "+i.statusText+" "+i.responseURL)}}).catch((e=>{console.log(e),a("error","table function putData ajax: "+e.status+" "+e.statusText+" "+e.responseURL)})):y().length?s():webix.ajax().post("/init/default/api/"+o,n,{success:function(t,i,n){if(null!==(i=i.json()).content.id)r(),l(),$$("tree").select(e),a("success","Данные успешно добавлены",o);else{let e=i.content.errors,t="";Object.values(e).forEach((function(i,n){t+=i+" (Поле: "+Object.keys(e)[n]+"); "})),a("error",t)}},error:function(e,t,i){a("error","table modalBox (post new data): "+i.status+" "+i.statusText+" "+i.responseURL)}}),r()),0!==t&&l()}))}catch(e){console.log(e),c("009-000",e)}return!1}},onBeforeSelect:function(e){if("tables"==$$("tree").getParentId(e)){if($$("filterTableForm")&&$$("filterTableForm").isVisible)try{$$("filterTableForm").hide(),$$("inputsFilter")&&$$("filterTableForm").removeView($$("inputsFilter"));let e=document.querySelector(".webix_btn-filter");e&&!e.classList.contains("webix_secondary")&&(e.classList.add("webix_secondary"),e.classList.remove("webix_primary")),$$("table-editTableBtnId").hide(),$$("table-editForm").show()}catch(e){console.log(e),c("009-000",e)}$$("propertyRefbtnsContainer")&&$$("propertyRefbtns").removeView($$("propertyRefbtnsContainer")),$$("editTableFormProperty")&&$$("editTableFormProperty").isVisible()&&$$("editTableFormProperty").hide()}!async function(){o.fields||await r("fields");let t=o.fields.content;Object.keys(t).forEach((function(i){i==e&&($$("webix__none-content").isVisible()&&$$("webix__none-content").hide(),$$("webix__null-content")&&$$("container").removeView($$("webix__null-content")),"dbtable"==t[i].type?($$("tables")&&$$("tables").show(),$("table",e)):"tform"==t[i].type?($$("forms")&&$$("forms").show(),$("table-view",e)):"dashboard"==t[i].type&&($$("dashboards")&&$$("dashboards").show(),b(e)))}))}()},onBeforeOpen:function(e){const t=$$("tree").getItem(e);if(-1===$$("tree").getItem(e).$count){async function i(){o.fields||await r("fields");let i=o.fields.content,n=Object.keys(i);if(t.action.includes("all_")){let r=t.action.indexOf("_"),l=t.action.slice(r+1);a=l,n.forEach((function(t){i[t].type!=a||function(e){let t=!1;return o.mmenu.mmenu.forEach((function(i,n){i.name==e&&(t=!0)})),t}(t)||$$("tree").data.add({id:t,value:i[t].plural?i[t].plural:i[t].singular,type:i[t].type},0,e)}))}var a}i()}},onAfterSelect:function(e){!async function(){o.mmenu||await r("fields"),o.fields&&Backbone.history.navigate("tree/"+e,{trigger:!0})}(),window.innerWidth<850&&this.hide()}}};return e}function _e(){function e(e,t=1.3){!function(){try{if($$(e)&&window.innerWidth/$$(e).$width<t&&$$(e).$width>100){let t=$$(e).$width-20;$$(e).config.width=t,$$(e).resize()}}catch(e){i(e,"adaptive"," autoResizePopup => decreasePopup")}}(),function(){try{if($$(e)&&window.innerWidth/$$(e).$width>t){let t=$$(e).$width+20;$$(e).config.width=t,$$(e).resize()}}catch(e){i(e,"adaptive","autoResizePopup => increasePopup")}}()}window.addEventListener("resize",(function(t){!async function(){function t(t){"forms"==t?(window.innerWidth<830&&!$$("contextActionsBtn")?$$("customInputsMain")&&function(){const e=$$("table-view-filterId").getParentView();let t=Object.values($$("customInputs")._collection),n=$$("customInputsMain").getParentView();t={id:"customInputsAdaptive",rows:[{id:"customInputs",rows:t}]},function(){try{t.length&&t.forEach((function(e,t){e.bottomPadding=10,e.width&&delete e.width,e.minWidth&&delete e.minWidth,e.maxWidth&&delete e.maxWidth}))}catch(e){i(e,"adaptive","resizeForms => createPopupForms")}}(),function(){try{$$("customInputsMain")&&n.removeView($$("customInputsMain"))}catch(e){i(e,"adaptive","resizeForms => removeInputs")}}();const o={view:"button",id:"buttonClosePopupActions",css:"webix_close-btn",type:"icon",hotkey:"esc",width:25,icon:"wxi-close",click:function(){try{$$("contextActionsPopup")&&$$("contextActionsPopup").hide()}catch(e){i(e,"adaptive","resizeForms => formPopupCloseBtn")}}},r={view:"scrollview",borderless:!0,scroll:"y",body:{id:"contextActionsPopupContainer",css:"webix_context-actions-popup",rows:[t]}},a={view:"button",id:"contextActionsBtnAdaptive",maxWidth:100,value:"Действия",css:"webix_primary",popup:webix.ui({view:"popup",css:"webix_popup-actions-container webix_popup-config",modal:!0,id:"contextActionsPopup",escHide:!0,position:"center",width:400,body:{rows:[{cols:[{template:"Доступные действия",css:"webix_template-actions",borderless:!0,height:40},o]},r]}}),click:function(){!function(){try{$$("contextActionsPopup").config.height!==$$("customInputsAdaptive").$height+60&&($$("contextActionsPopup").config.height=$$("customInputsAdaptive").$height+60,$$("contextActionsPopup").resize())}catch(e){i(e,"adaptive","resizeForms => popupShowBtn click")}}()}};!function(){try{$$(e.config.id)&&$$(e.config.id).addView(a,2)}catch(e){i(e,"adaptive","resizeForms => addAdaptiveFormView")}}()}():(window.innerWidth>830&&$$("contextActionsBtnAdaptive")||window.innerWidth>830&&$$("contextActionsBtn"))&&$$("customInputsAdaptive")&&function(){const e=$$("table-view-filterId").getParentView(),t={id:"customInputs",cols:$$("customInputsAdaptive")._collection[0].rows},n=$$("contextActionsBtnAdaptive").getParentView();!function(){try{$$("contextActionsBtnAdaptive")&&n.removeView($$("contextActionsBtnAdaptive"))}catch(e){i(e,"adaptive","resizeForms => removeAdaptiveBtn")}}(),function(){try{$$("contextActionsPopup")&&$$("contextActionsPopup").destructor()}catch(e){i(e,"adaptive","resizeForms => destructPopupForms")}}(),$$("customInputs")||function(){try{$$(e.config.id).addView({id:"customInputsMain",cols:[t]},2)}catch(e){i(e,"adaptive","resizeForms => addAdaptiveInputs")}}()}(),e("contextActionsPopup")):"dashboards"==t?(window.innerWidth<850&&function(){let e;$$("dashboard-tool-main")&&$$("dashboard-tool-main").isVisible()&&(function(){try{$$("dashboard-tool-main")&&$$("dashboard-tool-main").hide()}catch(e){i(e,"adaptive","resizeDashboards => hideDashTool")}}(),$$("dashFilterBtn")||function(){try{$$("dashboardInfoContainer").addView({id:"dashboard-tool-adaptive",cols:[{view:"button",id:"dashFilterBtn",value:"Фильтры",css:{margin:"10px 0px!important"},height:46,margin:10,popup:webix.ui({view:"popup",css:"webix_popup-dash-container webix_popup-config",modal:!0,id:"contextDashFilterPopup",escHide:!0,position:"center",body:{id:"contextDashFilterPopupContainer",rows:[]}}),click:function(){!function(){try{$$("contextDashFilterPopup")&&$$("contextDashFilterPopup").show()}catch(e){i(e,"adaptive","resizeDashboards => dashFilterBtn click showDashPopup")}}(),function(){try{$$("buttonClosePopupDashFilter")&&!$$("buttonClosePopupDashFilter").isVisible()&&$$("buttonClosePopupDashFilter").show()}catch(e){i(e,"adaptive","resizeDashboards => dashFilterBtn click showDashCloseBtn")}}()}}]},0)}catch(e){i(e,"adaptive","resizeDashboards => addDashAdaptive")}}(),function(){e=function(){let e;return $$("dashboard-tool-main")&&(e=$$("dashboard-tool-main")._collection),e}();const t=$$("dashboard-tool-main").getParentView();try{$$("dashboard-tool-main")&&t.removeView($$("dashboard-tool-main"))}catch(e){i(e,"adaptive","resizeDashboards => removeDashTool")}}(),$$("dashToolInputsAdaptive")||function(e){try{$$("contextDashFilterPopupContainer").addView({id:"dashToolInputsAdaptive",rows:e})}catch(e){i(e,"adaptive","resizeDashboards => addAdaptiveInputs")}}(e))}(),window.innerWidth>850&&function(){let e;$$("dashFilterBtn")&&(function(){e=$$("dashToolInputsAdaptive")._collection;const t=$$("dashboard-tool-adaptive").getParentView();try{$$("dashboard-tool-adaptive")&&t.removeView($$("dashboard-tool-adaptive"))}catch(e){i(e,"adaptive","resizeDashboards => removeDashAdaptiveTools")}}(),function(){try{$$("contextDashFilterPopup")&&$$("contextDashFilterPopup").destructor()}catch(e){i(e,"adaptive","resizeDashboards => destructDashPopup")}}(),function(){try{$$("dashFilterBtn")&&$$("dashFilterBtn").getParentView().removeView($$("dashFilterBtn"))}catch(e){i(e,"adaptive","resizeDashboards => removeDashAdaptiveBtn")}}(),function(){try{$$("dashboardTool").addView({id:"dashboard-tool-main",padding:20,minWidth:250,rows:e})}catch(e){i(e,"adaptive","resizeDashboards => addMainTool")}}(),function(){try{$$("buttonClosePopupDashFilter")&&$$("buttonClosePopupDashFilter").hide()}catch(e){i(e,"adaptive","resizeDashboards => hideBtnClosePopup")}}())}(),e("contextDashFilterPopupContainer")):"tables"==t&&(window.innerWidth<1200&&(function(){try{$$("table-editTableBtnId")&&!$$("table-editTableBtnId").isVisible()&&$$("table-editTableBtnId").show()}catch(e){i(e,"adaptive","resizeTableEditForm => showEditTableBtn")}}(),function(){try{$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide()}catch(e){i(e,"adaptive","resizeTableEditForm => hideEditFormContainer")}}(),$$("table-editForm")&&$$("table-editForm").isDirty()&&($$("tableEditPopup")?(function(){try{$$("tableEditPopup")&&$$("tableEditPopup").show()}catch(e){i(e,"adaptive","resizeTableEditForm => showTablePopup")}}(),$$("tableEditPopupContainer").getChildViews().length?(function(){try{$$("table-newAddBtnId")&&!$$("table-newAddBtnId").isEnabled()&&$$("table-newAddBtnId").enable()}catch(e){i(e,"adaptive","resizeTableEditForm => enableNewAddBtn")}}(),function(){try{$$("editTableBarContainer")&&$$("editTableBarContainer").show()}catch(e){i(e,"adaptive","resizeTableEditForm => showContainer")}}()):(function(){try{$$("tableEditPopupContainer")&&$$("tableEditPopupContainer").addView($$("editTableBarAdaptive"))}catch(e){i(e,"adaptive","resizeTableEditForm => addEditElements")}}(),function(){try{$$("editTableBarHeadline")&&!$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").show()}catch(e){i(e,"adaptive","resizeTableEditForm => showEditHeadline")}}())):(webix.ui({view:"popup",css:"webix_popup-table-container webix_popup-config",modal:!0,id:"tableEditPopup",escHide:!0,position:"center",body:{id:"tableEditPopupContainer",rows:[]}}).show(),function(){try{$$("tableEditPopupContainer")&&$$("tableEditPopupContainer").addView($$("editTableBarAdaptive"))}catch(e){i(e,"adaptive","resizeTableEditForm => addPopupElements")}}(),function(){try{$$("editTableBarHeadline")&&!$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").show()}catch(e){i(e,"adaptive","resizeTableEditForm => showTablePopupheadline")}}()),function(){try{$$("table-saveNewBtn").isEnabled()&&$$("table-newAddBtnId").isEnabled()?$$("table-newAddBtnId").disable():$$("table-newAddBtnId").enable()}catch(e){i(e,"adaptive","resizeTableEditForm => setBtnState")}}()),e("editFilterBarAdaptive",1.5)),window.innerWidth>1200&&(function(){try{$$("tableEditPopup")&&$$("tableEditPopup").hide()}catch(e){i(e,"adaptive","resizeTableEditForm => hidePopup")}}(),$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()||$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()||(function(){try{$$("editTableBarContainer")&&!$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").show()}catch(e){i(e,"adaptive","resizeTableEditForm => showContainer")}}(),function(){try{$$("filterTableForm")&&$$("filterTableForm").hide()}catch(e){i(e,"adaptive","resizeTableEditForm => hideFilterForm")}}(),function(){try{$$("table-editForm")&&$$("table-editForm").show()}catch(e){i(e,"adaptive","resizeTableEditForm => showEditForm")}}()),function(){try{$$("editTableBarContainer")&&$$("editTableBarContainer").addView($$("editTableBarAdaptive"))}catch(e){i(e,"adaptive","resizeTableEditForm => addEditElements")}}(),function(){try{$$("editTableBarAdaptive")&&!$$("editTableBarAdaptive").isVisible()&&$$("editTableBarAdaptive").show()}catch(e){i(e,"adaptive","resizeTableEditForm => showEditBar")}}(),function(){try{$$("table-editTableBtnId")&&$$("table-editTableBtnId").isVisible()&&$$("table-editTableBtnId").hide()}catch(e){i(e,"adaptive","resizeTableEditForm => hideEditFormBtn")}}(),function(){try{$$("editTableBarAdaptive")&&($$("editTableBarAdaptive").config.width=350,$$("editTableBarAdaptive").resize())}catch(e){i(e,"adaptive","resizeTableEditForm => setEditBarWidth")}}(),function(){try{$$("editTableBarHeadline")&&$$("editTableBarHeadline").isVisible()&&$$("editTableBarHeadline").hide()}catch(e){i(e,"adaptive","resizeTableEditForm => hideEditheadline")}}()),e("editTableBarAdaptive",1.5),window.innerWidth<1200&&(function(){let e=document.querySelector(".webix_btn-filter");try{e&&e.classList.contains("webix_primary")&&(e.classList.add("webix_secondary"),e.classList.remove("webix_primary"))}catch(e){i(e,"adaptive","resizeTableFilterForm => setBtnState")}}(),function(){try{$$("filterTableBarContainer")&&$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").hide()}catch(e){i(e,"adaptive","resizeTableFilterForm => hideFilterContainer")}}(),$$("filterTableForm")&&$$("filterTableForm").isDirty()&&(function(){try{$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide()}catch(e){i(e,"adaptive","resizeTableFilterForm => hideEditContainer")}}(),function(){try{$$("tableFilterPopup")&&$$("tableFilterPopup").show()}catch(e){i(e,"adaptive","resizeTableFilterForm => showFilterPopup")}}(),function(){try{$$("tableFilterPopupContainer")&&!$$("tableFilterPopupContainer").isVisible()&&$$("tableFilterPopupContainer").show()}catch(e){i(e,"adaptive","resizeTableFilterForm => showFilterPopup")}}(),function(){try{$$("tableFilterPopupContainer")&&$$("tableFilterPopupContainer").addView($$("editFilterBarAdaptive"))}catch(e){i(e,"adaptive","resizeTableFilterForm => addAdaptiveElements")}}(),function(){try{$$("editFilterBarHeadline")&&!$$("editFilterBarHeadline").isVisible()&&$$("editFilterBarHeadline").show()}catch(e){i(e,"adaptive","resizeTableFilterForm => showFilterHeadline")}}(),function(){try{$$("filterTableForm")&&$$("filterTableForm").show()}catch(e){i(e,"adaptive","resizeTableFilterForm => showFilterElements")}}(),function(){let e=function(){let e;try{$$("filterTableForm")&&$$("filterTableForm").getValues()&&(e=$$("filterTableForm").getValues())}catch(e){i(e,"adaptive","resizeTableFilterForm => getFilterValues")}return e}();try{e&&$$("filterTableForm")&&($$("filterTableForm").setValues(e),$$("filterTableForm").setDirty(),e=null)}catch(e){i(e,"adaptive","resizeTableFilterForm => setFilterValues")}}()),e("popupFilterEdit",1.5)),window.innerWidth>1200&&function(){if($$("tableFilterPopup").isVisible()){!function(){try{$$("tableFilterPopup")&&$$("tableFilterPopup").hide()}catch(e){i(e,"adaptive","resizeTableFilterForm => hideFilterPopup")}}();let e=function(){let e;try{$$("filterTableForm")&&$$("filterTableForm").getValues()&&(e=$$("filterTableForm").getValues())}catch(e){i(e,"adaptive","resizeTableFilterForm => getFormValues")}return e}();!function(){const e=$$("editFilterBarAdaptive").getParentView();try{"filterTableBarContainer"!==e.config.id&&$$("filterTableBarContainer").addView($$("editFilterBarAdaptive"))}catch(e){i(e,"adaptive","resizeTableFilterForm => addFilterElements")}}(),function(){try{$$("editFilterBarHeadline")&&$$("editFilterBarHeadline").hide()}catch(e){i(e,"adaptive","resizeTableFilterForm => hideFilterHeadline")}}(),function(){try{$$("editFilterBarAdaptive")&&($$("editFilterBarAdaptive").config.width=350,$$("editFilterBarAdaptive").resize())}catch(e){i(e,"adaptive","resizeTableFilterForm => hideFilterHeadline")}}(),$$("filterTableBarContainer")&&!$$("filterTableBarContainer").isVisible()&&(function(){try{$$("filterTableForm")&&$$("filterTableForm").show()}catch(e){i(e,"adaptive","resizeTableFilterForm => setBtnState")}}(),function(){try{$$("table-editForm")&&$$("table-editForm").hide()}catch(e){i(e,"adaptive","resizeTableFilterForm => setBtnState")}}(),function(e){try{e&&$$("filterTableForm")&&($$("filterTableForm").setValues(e),e=null)}catch(e){i(e,"adaptive","resizeTableFilterForm => setFilterValues")}}(e),function(){let e=document.querySelector(".webix_btn-filter");try{e.classList.add("webix_primary"),e.classList.remove("webix_secondary")}catch(e){i(e,"adaptive","resizeTableFilterForm => setBtnState")}}(),function(){try{$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide()}catch(e){i(e,"adaptive","resizeTableFilterForm => hideEditContainer")}}(),function(){try{$$("filterTableBarContainer")&&!$$("filterTableBarContainer").isVisible()&&$$("filterTableBarContainer").show()}catch(e){i(e,"adaptive","resizeTableFilterForm => showFilter")}}())}}())}o.mmenu||await r("mmenu"),o.mmenu&&o.mmenu.mmenu.forEach((function(e,i){$$(e.name)&&$$(e.name).isVisible()&&t(e.name)}))}(),window.innerWidth<850&&function(){try{$$("tree")&&$$("tree").isVisible()&&$$("tree").hide()}catch(e){i(e,"adaptive","resizeSidebar => hideTree")}}(),!$$("tree").isVisible()&&window.innerWidth<=800&&function(){try{$$("sideMenuResizer")&&$$("sideMenuResizer").hide()}catch(e){i(e,"adaptive","resizeSidebar => hideTreeResizer")}}(),window.innerWidth>850&&$$("tree")&&function(){try{$$("tree")&&($$("tree").config.width=250,$$("tree").resize())}catch(e){i(e,"adaptive","resizeSidebar => resizeTree")}}()}),!0)}console.log("expa 1.0.35");try{webix.ready((function(){webix.protoUI({name:"edittree"},webix.EditAbility,webix.ui.tree),webix.ui({view:"scrollview",type:"clean",id:"layout",css:"layoutContainer",scroll:"y",body:{cells:[{},{hidden:!0,id:"userAuth",cols:[{view:"align",align:"middle,center",body:(ve(),{view:"form",id:"formAuth",width:250,borderless:!0,elements:[{view:"text",label:"Логин",name:"username",invalidMessage:"Поле должно быть заполнено",on:{onItemClick:function(){$$("formAuth").clearValidation()}}},{view:"text",label:"Пароль",name:"password",invalidMessage:"Поле должно быть заполнено",type:"password",on:{onItemClick:function(){$$("formAuth").clearValidation()}}},{view:"button",value:"Войти",css:"webix_primary",hotkey:"enter",align:"center",click:function(){let e=$$("formAuth").getValues(),t={};try{$$("formAuth").validate(),t.un=e.username,t.np=e.password,webix.ajax().post("/init/default/login",t,{success:function(e,t,i){webix.ajax("/init/default/api/whoami",{success:function(e,t,i){try{let e={};e.id=t.json().content.id,e.name=t.json().content.first_name,e.username=t.json().content.username,n("user",JSON.stringify(e)),$$("formAuth")&&$$("formAuth").clear(),Backbone.history.navigate("content",{trigger:!0}),window.location.reload()}catch(e){console.log(e),c("007-005",e)}},error:function(e,t,i){$$("formAuth")&&$$("formAuth").isDirty()&&($$("formAuth").markInvalid("username",""),$$("formAuth").markInvalid("password","Неверный логин или пароль")),u("007-006",i.status,i.statusText,i.responseURL)}}).then((function(e){webix.ajax().get("/init/default/api/userprefs/",{success:function(e,t,i){},error:function(e,t,i){u("007-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),u("007-000",e.status,e.statusText,e.responseURL)}))}))},error:function(e,t,i){webix.message({type:"error",expire:3e3,text:"Не удалось выполнить выход"}),u("007-006",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),u("007-006",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),c("007-000",e)}}}],rules:{username:webix.rules.isNotEmpty,password:webix.rules.isNotEmpty},elementsConfig:{labelPosition:"top"}})}]},{hidden:!0,id:"mainLayout",rows:[{id:"mainContent",css:"webix_mainContent",cols:[{rows:[{view:"toolbar",id:"header",padding:10,css:"webix_header-style",elements:[{cols:[{view:"button",type:"icon",id:"collapseBtn",icon:"wxi-angle-double-left",css:"webix_collapse",title:"текст",height:45,width:40,click:function(){try{window.innerWidth>850?$$("tree").isVisible()?(this.config.icon="wxi-angle-double-right",this.refresh(),$$("tree").hide(),$$("sideMenuResizer")&&$$("sideMenuResizer").hide()):($$("tree").show(),this.config.icon="wxi-angle-double-left",this.refresh(),window.innerWidth>=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").show()):$$("tree").isVisible()?(this.config.icon="wxi-angle-double-right",this.refresh(),$$("tree").hide(),$$("sideMenuResizer")&&$$("sideMenuResizer").hide()):($$("tree").show(),console.log(window.innerHeight),$$("tree").config.width=window.innerWidth,$$("tree").resize(),this.config.icon="wxi-angle-double-left",this.refresh(),window.innerWidth>=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").show())}catch(e){console.log(e),c("009-000",e)}},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Видимость бокового меню")}}},{view:"label",label:"<img src='/init/static/images/expalogo.png' style='height:30px; margin: 10px;'>",height:30}]},{},{view:"search",placeholder:"Поиск",css:"searchTable",maxWidth:250,minWidth:40},{view:"button",id:"webix_log-btn",type:"icon",icon:"wxi-eye-slash",height:48,badge:0,width:60,css:"webix_log-btn",click:function(){1==this.getValue()?this.setValue(2):this.setValue(1)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть системные сообщения")},onChange:function(e,t,i){let n=$$("logBlock-list").getLastId();2==e?(this.config.badge="",$$("logBlock-list").showItem(n),$$("logLayout").config.height=90,$$("logLayout").resize(),this.config.icon="wxi-eye-slash",this.refresh()):($$("logLayout").config.height=5,$$("logLayout").resize(),this.config.icon="wxi-eye",this.refresh(),$$("webix_log-btn").config.badge="",$$("webix_log-btn").refresh())}}},{view:"button",id:"button-context-menu",type:"icon",disabled:!0,icon:"wxi-user",height:48,width:60,popup:{view:"contextmenu",id:"contextmenu",css:"webix_contextmenu",data:[],on:{onItemClick:function(e,t,i){function n(e){try{g().then((function(t){1==t?(Backbone.history.navigate(e,{trigger:!0}),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh()):2==t&&$$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty&&($$("editTableFormProperty").getValues().id?B(!1,!1):E(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),Backbone.history.navigate(e,{trigger:!0}))}))}catch(e){console.log(e),c("005-000",e)}}try{if("logout"==e){if($$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty||$$("cp-form")&&$$("cp-form").isDirty()){try{g().then((function(e){if(1==e)Backbone.history.navigate("logout",{trigger:!0}),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh();else if(2==e&&($$("cp-form")||$$("editTableFormProperty")))if($$("cp-form")&&$$("cp-form").isDirty()&&$$("cp-form").validate()){let e={op:"",np:""},t=$$("cp-form").getValues();e.np=t.newPass,e.op=t.oldPass,webix.ajax().post("/init/default/api/cp",e,{success:function(e,t,i){"i"==(t=t.json()).err_type?a("success",t.err):"e"==t.err_type&&a("error",t.err)},error:function(e,t,i){u("011-000",i.status,i.statusText,i.responseURL)}}),Backbone.history.navigate("logout",{trigger:!0})}else{if(!$$("editTableFormProperty")||!$$("editTableFormProperty").config.dirty)return a("error","Заполните пустые поля"),!1;$$("editTableFormProperty").getValues().id?B(!1,!1):E(),$$("editTableFormProperty").config.dirty=!1,$$("editTableFormProperty").refresh(),Backbone.history.navigate("logout",{trigger:!0})}}))}catch(e){console.log(e),c("005-000",e)}return!1}Backbone.history.navigate("logout",{trigger:!0})}else"cp"==e?$$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty?n("cp"):Backbone.history.navigate("cp",{trigger:!0}):"userprefs"==e&&($$("editTableFormProperty")&&$$("editTableFormProperty").config.dirty?n("userprefs"):Backbone.history.navigate("userprefs",{trigger:!0}))}catch(e){console.log(e),c("005-000",e)}}}},on:{onItemClick:function(){try{webix.ajax().get("/init/default/api/userprefs/",{success:function(e,t,i){if("e"==(t=t.json().content).err_type&&a("error",t.error),"/index.html/content"!==window.location.pathname&&"/init/default/spaw/content"!==window.location.pathname){let e=!1,i={};i.href=window.location.href;let o={name:"userLocationHref",prefs:i};try{t.forEach((function(t,i){"userLocationHref"==t.name&&(e=!0,webix.ajax().put("/init/default/api/userprefs/"+t.id,o,{success:function(e,t,i){"e"==(t=t.json()).err_type&&a("error",t.error)},error:function(e,t,i){u("005-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),u("005-011",e.status,e.statusText,e.responseURL)})))}))}catch(e){console.log(e),c("005-000",e)}try{if(!e){let e=webix.storage.local.get("user").id;e?o.owner=e:webix.ajax("/init/default/api/whoami",{success:function(e,t,i){o.owner=t.json().content.id;let r={};r.id=t.json().content.id,r.name=t.json().content.first_name,r.username=t.json().content.username,n("user",JSON.stringify(r))},error:function(e,t,i){u("005-011",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),u("005-000",e.status,e.statusText,e.responseURL)})),webix.ajax().post("/init/default/api/userprefs/",o,{success:function(e,t,i){"e"==(t=t.json()).err_type&&a("error",t.error)},error:function(e,t,i){u("005-001",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),u("005-001",e.status,e.statusText,e.responseURL)}))}}catch(e){console.log(e),c("005-000",e)}}},error:function(e,t,i){u("005-000",i.status,i.statusText,i.responseURL)}}).catch((e=>{console.log(e),u("005-000",e.status,e.statusText,e.responseURL)}))}catch(e){console.log(e),c("005-000",e)}}}}]},{id:"adaptive",rows:[]},{cols:[xe(),{id:"sideMenuResizer",view:"resizer",css:"webix_resizer-hide"},{id:"container",cols:[{view:"align",align:"middle,center",id:"webix__none-content",body:{borderless:!0,template:"Выберите элемент дерева",height:50,width:210,css:{color:"#858585","font-size":"14px!important"}}}]}]}]}]},{view:"resizer",id:"log-resizer"},s]}]}}),_e(),window.location.host.includes("localhost:3000")?Backbone.history.start({pushState:!0,root:"/index.html/"}):Backbone.history.start({pushState:!0,root:"/init/default/spaw/"}),window.innerWidth<850&&$$("tree")&&$$("tree").isVisible()&&$$("tree")&&$$("tree").hide(),window.innerWidth<1200&&($$("tree").attachEvent("onAfterLoad",(function(){$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide()})),$$("editTableBarContainer")&&$$("editTableBarContainer").isVisible()&&$$("editTableBarContainer").hide()),$$("tableFilterPopup")||webix.ui({view:"popup",css:"webix_popup-table-container webix_popup-config",modal:!0,id:"tableFilterPopup",escHide:!0,position:"center",body:{id:"tableFilterPopupContainer",rows:[]}}),function(){let e=null;webix.event(document.body,"mousedown",(t=>{const i=$$(t);i&&i.getInputNode&&(e=i)})),webix.event(document,"click",(t=>{const i=$$(t);e&&i&&i.config.id!==e.config.id&&(t.cancelBubble=!0,webix.html.preventEvent(t)),e=null}),{capture:!0})}(),function(){const e=webix.ajax("/init/default/api/userprefs/");e.then((function(e){let t=webix.storage.local.get("user");if(e=e.json().content,t&&(function(){try{e.forEach((function(e,i){e.owner==t.id&&n(e.name,e.prefs)}))}catch(e){i(e,"storageSettings","setDataToStorage")}}(),"/index.html/content"==window.location.pathname||"/init/default/spaw/content"==window.location.pathname)){let e=webix.storage.local.get("userprefsWorkspaceForm"),t=webix.storage.local.get("userLocationHref");const n=new URL(t.href);e&&e.LoginActionOpt&&n.origin==window.location.origin&&!n.pathname.includes("logout")&&function(e,t){try{2==t.LoginActionOpt&&e&&e.href&&e.href!==window.location.href&&window.location.replace(e.href)}catch(e){i(e,"storageSettings","setLoginActionPref")}}(t,e)}})),e.fail((function(e){t(e,"storageSettings","setUserPrefs")})),function(){let e=webix.storage.local.get("userprefsWorkspaceForm");try{e&&void 0!==e.logBlockOpt&&("2"==e.logBlockOpt?($$("logLayout").config.height=5,$$("logLayout").resize(),$$("webix_log-btn").config.icon="wxi-eye",$$("webix_log-btn").refresh()):"1"==e.logBlockOpt&&($$("logLayout").config.height=90,$$("logLayout").resize(),$$("webix_log-btn").config.icon="wxi-eye-slash",$$("webix_log-btn").refresh()))}catch(e){i(e,"storageSettings","userprefsWorkspace")}}()}(),window.addEventListener("popstate",(function(e){window.location.replace(window.location.href),window.location.reload()})),function(){let e;function n(){const e=webix.ajax().get("/init/default/api/userprefs/");e.then((function(e){"i"!==e.err_type&&i(e.json().err,"autoLogout","putUserPrefs"),e=e.json().content;let n=!1,o={};o.href=window.location.href;let r={name:"userLocationHref",prefs:o};"/index.html/content"!==window.location.pathname&&(function(){try{e.forEach((function(e,i){if("userLocationHref"==e.name){n=!0;const i=webix.ajax().put("/init/default/api/userprefs/"+e.id,r);i.then((function(e){"i"!==(e=e.json()).err_type&&a("error",e.err)})),i.fail((function(e){t(e,"autoLogout","putUserPrefs")}))}}))}catch(e){i(e,"autoLogout","putUserPrefs")}}(),n||(function(){let e=webix.storage.local.get("user").id;try{if(e)r.owner=e;else{const e=webix.ajax("/init/default/api/whoami");e.then((function(e){r.owner=e.json().content.id;let t={};t.id=e.json().content.id,t.name=e.json().content.first_name,t.username=e.json().content.username})),e.fail((function(e){t(e,"autoLogout","getWhoamiData")}))}}catch(e){i(e,"autoLogout","getWhoamiData")}}(),function(){const e=webix.ajax().post("/init/default/api/userprefs/",r);e.then((function(e){"i"!==(e=e.json()).err_type&&i(e.err,"autoLogout","putUserPrefs")})),e.fail((function(e){t(e,"autoLogout","postUserPrefs")}))}()))})),e.then((function(e){Backbone.history.navigate("logout",{trigger:!0})})),e.fail((function(e){t(e,"autoLogout","logout")}))}function o(){try{"/index.html"!==window.location.pathname&&"/"!==window.location.pathname&&"/init/default/spaw"!==window.location.pathname&&(clearTimeout(e),e=setTimeout(n,6e5))}catch(e){i(e,"autoLogout","resetTimer")}}window.onload=o,window.onmousemove=o,window.onmousedown=o,window.ontouchstart=o,window.onclick=o,window.onkeypress=o,window.addEventListener("scroll",o,!0)}(),webix.message.position="bottom",webix.i18n.setLocale("ru-RU"),webix.i18n.parseFormat="%d.%m.%Y %H:%i:%s",webix.i18n.setLocale(),webix.Date.startOnMonday=!0}))}catch(e){console.log(e),alert("Ошибка при выполнении "+e),c("007-005",e)}})();