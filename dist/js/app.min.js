(()=>{"use strict";let e="table",t="table-view",i="table-pager",l="table-search",o="table-findElemets",a="table-view-pager",n="table-view-search",s="table-view-findElemets",r="table-editForm",d="table-saveBtn",c="table-addBtn",u="table-delBtnId",h="table-cleanBtn",b="table-saveNewBtn";function p(){let t=$$(e).getColumns();if(0==Object.keys($$(r).elements).length){let e=[];t.forEach(((t,i)=>{if("datetime"==t.type)e.push({view:"datepicker",format:webix.Date.strToDate("%d.%m.%Y"),name:t.id,label:t.label,placeholder:"дд.мм.гг",timepicker:!0,labelPosition:"top"});else if(t.type.includes("reference")){let i=t.type.slice(10),l=new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get("/init/default/api/"+i).then((function(e){e=e.json().content;let t,i=[];return e.forEach(((e,l)=>{let o=0;for(console.log("1213",Object.keys(e)[1]);o<=Object.values(e).length;){if("string"==typeof Object.values(e)[o]){t=Object.keys(e)[o];break}o++}if(null==e[t])for(console.log("undef");o<=Object.values(e).length;){if("number"==typeof Object.values(e)[1]){t=Object.keys(e)[1];break}o++}i.push({id:e.id,value:e[t]}),console.log(i)})),i}))}}});e.push({view:"combo",placeholder:"Введите текст",label:t.label,name:t.id,labelPosition:"top",options:{data:l}})}else e.push({view:"text",name:t.id,label:t.label,labelPosition:"top"})}));let i={margin:8,id:"inputsTable",rows:e};return $$(h).enable(),$$(u).enable(),console.log(i,"edit"),$$(r).addView(i,1)}$$(h).enable(),$$(u).enable(),$$("inputsTable").show()}function $(){$$(r).clear(),$$(r).clearValidation(),w()}function w(){$$(b).isVisible()?$$(b).hide():$$(d).isVisible()&&$$(d).hide(),$$(c).show(),$$(u).disable(),$$(h).disable()}function f(e){return webix.confirm({width:300,ok:"Да",cancel:"Отмена",title:e,text:"Вы уверены, что хотите продолжить?"})}function m(e,t){webix.message.position="bottom",webix.message({type:e,text:t})}let g,v,y={view:"form",id:r,css:"webix_form-edit",container:"webix__form-container",minHeight:350,minWidth:210,width:320,scroll:!0,elements:[{id:"form-adaptive",margin:5,rows:[{margin:5,rows:[{responsive:"form-adaptive",margin:5,borderless:!0,cols:[{view:"button",id:h,height:48,minWidth:90,disabled:!0,hotkey:"esc",value:"Очистить форму",click:function(){$$(d).isVisible()&&$$(r).setDirty(!0),$$(r).isDirty()?f("Форма будет очищена").then((function(){$(),$$(e).clearSelection(),w(),$$("inputsTable").hide(),m("success","Форма очищена")})):m("debug","Форма пуста")}},{view:"button",id:u,disabled:!0,height:48,minWidth:90,width:100,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"wxi-trash",click:function(){f("Запись будет удалена").then((function(){$$(e).remove($$(r).getValues().id);let t=$$(r).getValues();webix.ajax().del("/init/default/api/"+V+"/"+t.id+".json",t,{success:function(){console.log(t.id),$(),w(),$$("inputsTable").hide(),m("success","Данные успешно удалены")},error:function(){m("error","Ошибка при удалении записи")}})}))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить запись из таблицы")}}}]}]},{margin:10,rows:[{view:"button",id:d,hidden:!0,value:"Сохранить",height:48,css:"webix_primary",click:function(){let t=$$(r).getValues();$$(r).validate()?t.id?webix.ajax().put("/init/default/api/"+V+"/"+t.id,t,{success:function(){console.log("success"),$$(e).updateItem(t.id,t),$(),m("success","Данные сохранены"),w(),$$("inputsTable").hide(),$$(e).clearSelection()},error:function(){m("error","Ошибка при сохранении данных")}}):($$(e).add(t),$(),m("success","Данные добавлены")):m("error","Заполните пустые поля")},hotkey:"enter"},{view:"button",id:c,value:"Добавить новую запись",height:48,disabled:!0,hotkey:"shift",css:"webix_primary",click:function(){$$(e).filter(!1),$$(e).hideOverlay("Ничего не найдено"),$$(l).setValue(""),p(),$$(u).disable(),$$(d).hide(),$$(c).hide(),$$(b).show()}},{view:"button",id:b,value:"Сохранить новую запись",hidden:!0,height:48,hotkey:"enter",css:"webix_primary",click:function(){if($$(r).validate())if($$(r).isDirty()){let t=$$(r).getValues();t.id=$$(e).count()+1,console.log(t),webix.ajax().post("/init/default/api/"+V,t,{success:function(){$$(e).add(t),$(),w(),$$("inputsTable").hide(),m("success","Данные успешно добавлены")},error:function(){m("error","Ошибка при добавлении данных")}})}else m("debug","Форма пуста");else m("error","Заполните пустые поля")}}]}]},{}],rules:{$all:webix.rules.isNotEmpty},on:{onChange:function(e,t){}},ready:function(){this.validate()}},x={treeHeadlines:[{id:"peopleOne",value:"Иванов Иван Иванович"}],peopleOne:{dataview:{data:[{id:1,title:"Иванов Иван Иванович",info1:1994,info2:9.2}]},property:{data:[{label:"Информация о партнёре",css:"webix_property-dashboard",type:"label"},{label:"Фамилия",type:"text",id:"name",value:"Иванов"},{label:"Имя",type:"text",id:"surname",value:"Иван"},{label:"Отчество",type:"text",id:"patronymic",value:"Иванович"}]},timeline:{data:[{id:1,value:"Действие №1",date:"2017-08-01"},{id:2,value:"Действие №2",details:"Пояснение",date:"2017-09-10"},{id:3,value:"Действие №3",date:"2017-12-11"},{id:5,value:"Действие №4",details:"Пояснение",date:"2018-02-10"},{id:6,value:"Действие №5",date:"2018-03-15"},{id:7,value:"Действие №6",date:"2018-03-21"}]},diagramBar:{data:[{id:1,sales:20,year:"02"},{id:2,sales:55,year:"03"},{id:3,sales:40,year:"04"},{id:4,sales:78,year:"05"},{id:5,sales:61,year:"06"},{id:6,sales:35,year:"07"},{id:7,sales:80,year:"08"},{id:8,sales:50,year:"09"},{id:9,sales:65,year:"10"},{id:10,sales:59,year:"11"}]},diagramArea:{data:[{sales:"20",sales2:"35",sales3:"55",year:"02"},{sales:"40",sales2:"24",sales3:"40",year:"03"},{sales:"44",sales2:"20",sales3:"27",year:"04"},{sales:"23",sales2:"50",sales3:"43",year:"05"},{sales:"21",sales2:"36",sales3:"31",year:"06"},{sales:"50",sales2:"40",sales3:"56",year:"07"},{sales:"30",sales2:"65",sales3:"75",year:"08"},{sales:"90",sales2:"62",sales3:"55",year:"09"},{sales:"55",sales2:"40",sales3:"60",year:"10"},{sales:"72",sales2:"45",sales3:"54",year:"11"}]}}},V="",k=!1;function j(e,i,l,o,a=""){let n=[];"get"==l&&("refresh"==o?(e.forEach(((e,t)=>{e.id.includes("customCombo")?(console.log(e),n.push(e.name+"="+$$(e.id).getText())):(e.id.includes("customInputs")||e.id.includes("customDatepicker"))&&(console.log(e),n.push(e.name+"="+$$(e.id).getValue()))})),webix.ajax(i+"?"+n.join("&")).then((function(e){console.log(e.json()),$$(t).clearAll(),0!==(e=e.json().content).length?($$(t).hideOverlay("Ничего не найдено"),$$(t).parse(e)):$$(t).showOverlay("Ничего не найдено"),g=$$(t).count(),$$(s).setValues(g.toString())}))):"download"==o&&webix.ajax().response("blob").get(i,(function(e,t,i){webix.html.download(t,"table.docx")})))}function A(e,i,l,o){V=l;let a=$$("tree").getItem(l);if($$(e).clearAll(),$$(i).setValue(""),null==a)webix.ajax().get("/init/default/api/fields.json").then((function(e){m("error","Данные не найдены")}));else{let i;e==t&&$$("filterBar").removeView("customInputs"),webix.ajax().get("/init/default/api/fields.json").then((function(o){let a,n=(o=o.json().content[l]).fields,s=Object.keys(o.fields),r=[];s.forEach((function(e,t){"datetime"==n[e].type&&(n[e].format=webix.i18n.fullDateFormatStr),n[e].id=e,n[e].fillspace=!0,n[e].header=n[e].label,"id"==n[e].id&&(n[e].hidden=!0),r.push(n[e])})),$$(e).refreshColumns(r),r.forEach((function(e,t){void 0!==e.type&&"action"==e.type&&(k=!0,a=t,v=o.actions[e.id].url)}));let d=Object.keys(o.inputs),c=[],u=[],h=o.inputs;d.forEach(((i,l)=>{if("string"==h[i].type)c.push({view:"text",placeholder:h[i].label,id:"customInputs"+l,maxWidth:300,minWidth:150,height:60,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",h[i].comment)}}});else if("apiselect"==h[i].type){let e=new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get("/init/default/api/"+h[i].apiname).then((function(e){console.log(e.json());let t=e.json().content,i=[];return void 0!==t[0].name?t.forEach((function(e,t){console.log(e),i.push({id:t+1,value:e.name})})):t.forEach((function(e,t){i.push({id:t+1,value:e})})),i}))}}});c.push({view:"combo",width:250,id:"customCombo"+l,placeholder:h[i].label,labelPosition:"top",options:{data:e},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",h[i].comment)}}})}else if("submit"==h[i].type||"button"==h[i].type){let t=h[i].action,a=o.actions[t];if("DELETE"==a.verb&&"submit"!==t){let t=$$(e).getColumns().length;$$(e).config.columns.splice(t,0,{id:"action"+l,header:"Действие",maxWidth:100,template:"{common.trashIcon()}"}),$$(e).refreshColumns()}else"DELETE"==a.verb?c.push({view:"button",id:"customBtnDel"+l,css:"webix_danger",type:"icon",icon:"wxi-trash",inputHeight:48,width:100,value:h[i].label,click:function(e){j(u,a.url,"delete"),console.log("delete")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",h[i].comment)}}}):c.push({view:"button",css:"webix_primary",id:"customBtn"+l,inputHeight:48,height:48,minWidth:100,maxWidth:250,value:h[i].label,click:function(e){"GET"==a.verb?"refresh"==a.rtype?(j(u,a.url,"get","refresh"),console.log("get")):"download"==a.rtype&&(j(u,a.url,"get","download"),console.log("get")):"POST"==a.verb?(j(u,a.url,"post"),console.log("post")):"download"==a.verb&&(j(u,a.url,"get","download",e),console.log("download"))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",h[i].comment)}}})}else"upload"==h[i].type?c.push({rows:[{},{view:"uploader",value:"Upload file",id:"customUploader"+l,height:50,link:t,upload:o.actions.submit.url,label:h[i].label,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",h[i].comment)},onFileUpload:function(){m("success","Файл успешно загружен")},onFileUploadError:function(){m("error","Ошибка при загрузке файла")}}}]}):"datetime"==h[i].type?c.push({view:"datepicker",format:webix.Date.strToDate("%d.%m.%Y"),placeholder:h[i].label,id:"customDatepicker"+l,timepicker:!0,labelPosition:"top",width:300,height:60,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",h[i].comment)}}}):"checkbox"==h[i].type&&c.push({view:"checkbox",id:"customСheckbox"+l,css:"webix_checkbox-style",labelRight:h[i].label,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",h[i].comment)}}});h[i].type,c.push({width:20})})),c.forEach(((e,t)=>{void 0!==e.id&&("text"==e.view?u.push({id:e.id,name:"substr"}):"combo"==e.view?u.push({id:e.id,name:"valtype"}):("uploader"==e.view||"datepicker"==e.view)&&u.push({id:e.id}))})),i={id:"customInputs",cols:c},$$("filterBar").addView(i,2)})),webix.ajax().get("/init/default/api/"+V).then((function(t){0!==(t=t.json().content).length?($$(e).hideOverlay("Ничего не найдено"),$$(e).parse(t)):$$(e).showOverlay("Ничего не найдено"),g=$$(e).count(),$$(o).setValues(g.toString())}))}}function _(e,t,i,l,o,a=!1){return{rows:[{id:"filterBar",padding:17,height:80,margin:5,cols:[{view:"search",placeholder:"Поиск",id:t,hidden:a,css:"searchTable",maxWidth:250,minWidth:40,on:{onTimedKeyPress(){let e=this.getValue().toLowerCase(),t=$$(o),i=t.config.columns,a=0;t.filter((function(t){for(let l=0;l<i.length;l++)if(-1!==t[i[l].id].toString().toLowerCase().indexOf(e))return a++,!0;return!1})),a?a&&$$(o).hideOverlay("Ничего не найдено"):$$(o).showOverlay("Ничего не найдено"),$$(l).setValues(a.toString())},onAfterRender:function(){this.getInputNode().setAttribute("title","Поиск по таблице")}}},{view:"pager",id:e,size:10,inputHeight:48,group:3,height:50,template:"{common.prev()} \n                {common.pages()} {common.next()}"},{view:"button",width:50,type:"icon",id:i,hidden:a,icon:"wxi-download",css:"webix_btn-download",title:"текст",height:50,click:function(){webix.toExcel(o,{filename:"Table",filterHTML:!0,styles:!0}),m("success","Таблица сохранена")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Экспорт таблицы")}}}]},{view:"template",id:l,css:"webix_style-template-count",height:30,template:function(){return 0!==Object.keys($$(l).getValues()).length?"<div style='color:#999898;'> Количество записей: "+$$(l).getValues()+" </div>":""}}]}}function E(e,t,i,l){return{view:"treetable",id:e,css:"webix_table-style webix_header_border webix_data_border",resizeColumn:!0,autoConfig:!0,pager:t,minHeight:300,footer:!0,minWidth:500,select:!0,minColumnWidth:200,on:i,onClick:{"wxi-trash":function(){f("Запись будет удалена").then((function(){let t=$$(e).getItem(id);webix.ajax().del("/init/default/api/"+V+"/"+t.id+".json",t,{success:function(){$$(e).remove($$(e).getSelectedId()),m("success","Данные успешно удалены")},error:function(){m("error","Ошибка при удалении записи")}})}))}}}}let O={onAfterSelect(t){let i=$$(e).getItem(t);function l(){$$(r).setValues(i),console.log(i),$$(b).hide(),$$(d).show(),$$(c).hide(),$$(r).clearValidation()}$$(r).isDirty()?f("Данные не сохранены").then((function(){$$(r).clear(),$$(u).enable(),l()})):(p(),l())},onAfterLoad:function(){$$(r).removeView("inputsTable"),w()},onAfterDelete:function(){$$(o).setValues($$(e).count().toString()),this.count()||this.showOverlay("Ничего не найдено"),this.count()&&this.hideOverlay()},onAfterAdd:function(){$$(o).setValues($$(e).count().toString()),this.hideOverlay()}},T={onAfterSelect:function(e){console.log(e),webix.ajax("http://localhost:3000/init/default/api/lic/D.200601.250131.ANY_HOST.000001.json",{success:function(e,t,i){console.log(t.json()),t=t.json().content;let l=[];t.forEach((function(e,t){l.push({type:"text",id:t+1,label:e.name,value:e.value})})),$$("propTableView").define("elements",l),$$("propTableView").show()}})}};webix.ready((function(){webix.protoUI({name:"edittree"},webix.EditAbility,webix.ui.tree),webix.ui({view:"scrollview",type:"clean",id:"layout",scroll:"y",body:{cells:[{id:"mainLayout",rows:[{id:"adaptive",rows:[]},{id:"mainContent",responsive:"adaptive",cols:[{id:"sideMenu",width:250,css:"webix_side-container",rows:[{cols:[{view:"button",type:"icon",id:"collapseBtn",icon:"wxi-angle-double-left",css:"webix_collapse",title:"текст",height:30,width:40,click:function(){$$("tree").isVisible()?($$("collapseBtn").config.icon="wxi-angle-double-right",$$("collapseBtn").refresh(),$$("tree").hide(),$$("sideMenu").config.width=55,$$("sideMenuHidden").show(),$$("sideMenuResizer").hide()):($$("tree").show(),$$("collapseBtn").config.icon="wxi-angle-double-left",$$("collapseBtn").refresh(),$$("sideMenu").config.width=250,$$("sideMenuHidden").hide(),$$("sideMenuResizer").show())},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Видимость бокового меню")}}},{view:"label",label:"<img src='/init/static/images/expalogo.png' style='height:30px; margin: 20px;'>",height:65}]},{view:"edittree",id:"tree",minWidth:100,width:300,minHeight:150,editable:!1,select:!0,editor:"text",editValue:"value",activeTitle:!0,clipboard:!0,data:webix.ajax().get("/init/default/api/fields.json").then((function(e){let t=e.json().content;console.log(e.json());let i,l=Object.keys(t),o=[],a=[],n=[];return l.forEach((function(e){t[e].actions&&(i=Object.keys(t[e].actions)[0]),"dbtable"==t[e].type?t[e].plural?a.push({id:e,value:t[e].plural,type:t[e].type}):t[e].singular&&a.push({id:e,value:t[e].singular,type:t[e].type}):"tform"==t[e].type&&(t[e].plural?n.push({id:e,value:t[e].plural,type:t[e].type}):t[e].singular&&n.push({id:e,value:t[e].singular,type:t[e].type}))})),o.push({id:"dashboardViewFolder",value:"Партнёры",data:x.treeHeadlines},{id:"tableEditFolder",value:"Таблицы",data:a},{id:"tableViewFolder",value:"Информация",data:n}),o})),on:{onSelectChange:function(i){i[0]&&$$("webix__none-content").hide(),$$("inputsTable")&&$$(r).removeView($$("inputsTable")),V=i[0];let a=$$("tree").getSelectedItem().id,d=$$("tree").getParentId(a);"tableEditFolder"!=i[0]&&"tableEditFolder"!=d||($$("dashboardView").hide(),$$("tableView").hide(),$$("tableEdit").show()),"dashboardViewFolder"!=i[0]&&"dashboardViewFolder"!=d||($$("tableEdit").hide(),$$("tableView").hide(),$$("dashboardView").show()),"tableViewFolder"!=i[0]&&"tableViewFolder"!=d||($$("propTableView")&&$$("propTableView").isVisible()&&$$("propTableView").hide(),$$("tableEdit").hide(),$$("dashboardView").hide(),$$("tableView").show()),"tableEditFolder"==d?($$(c).enable(),w(),0!==Object.keys($$(r).elements).length&&$$("inputsTable").hide(),A(e,l,i[0],o)):"dashboardViewFolder"==d||"tableViewFolder"==d&&A(t,n,i[0],s)},onBeforeSelect:function(e){if("tableEditFolder"==$$("tree").getParentId(e)&&$$(r).isDirty())return new webix.promise((function(e){webix.confirm({title:"Данные не сохранены",ok:"Да",width:300,cancel:"Отмена",text:"Вы уверены, что хотите продолжить?",callback:function(t){e(!!t)}})})).then((function(t){t&&($(),$$("tree").select(e))})),!1}}},{id:"sideMenuHidden",hidden:!0}]},{id:"sideMenuResizer",view:"resizer",class:"webix_resizers"},{rows:[{view:"toolbar",id:"header",padding:10,css:"webix_header-style",elements:[{},{view:"button",type:"icon",icon:"wxi-file",css:"webix_btn-import",label:"Импорт",height:48,width:130,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Импорт файла с таблицами")}}},{view:"button",label:"Выйти",height:48,width:120,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выйти из аккаунта")}},click:function(){history.back()}}]},{id:"webix__none-content"},{id:"adaptive-tableEdit",rows:[]},{id:"tableEdit",hidden:!0,cols:[{view:"scrollview",body:{view:"flexlayout",cols:[{id:"tableContainer",rows:[_(i,l,"tableexportBtn",o,e),{view:"resizer",class:"webix_resizers"},E(e,i,O)]},{view:"resizer",class:"webix_resizers"},y]}}]},{id:"dashboardView",hidden:!0,scroll:"auto",rows:[{view:"scrollview",body:{view:"flexlayout",cols:[{type:"clean",rows:[{css:"webix_accordion-container",view:"accordion",type:"line",collapsed:!0,rows:[{header:"Личная Информация",body:{view:"form",container:"webix__form-container",minHeight:350,width:400,margin:15,scroll:!0,elements:[{view:"text",placeholder:"Введите фамилию",label:"Фамилия",text:"Иванов",height:65,labelPosition:"top"},{view:"text",placeholder:"Введите имя",label:"Имя",text:"Иван",height:65,labelPosition:"top"},{view:"text",placeholder:"Введите отчество",label:"Отчество",text:"Иванович",height:65,labelPosition:"top"},{view:"datepicker",label:"Дата",value:"23.03.2021",placeholder:"дд.мм.гг",height:65,labelWidth:90,timepicker:!0,format:"%d.%m.%Y",labelPosition:"top"},{view:"radio",label:"Свойство",labelPosition:"top",value:2,options:[{id:1,value:"Параметр 1"},{id:2,value:"Параметр 2"}]},{view:"button",id:"my_button",value:"Сохранить изменения",css:"webix_primary",disabled:!0,height:48},{}]}},{header:"Данные №1",body:{view:"timeline",data:x.peopleOne.timeline.data}},{header:"Данные №2",body:"content 3"},{header:"Данные №3",body:"content 4"},{header:"Данные №4",body:"content 5"}]}]},{view:"resizer",class:"webix_resizers"},{rows:[{view:"chart",type:"bar",value:"#sales#",radius:3,minWidth:250,minHeight:170,height:250,tooltip:{template:"#sales#"},xAxis:{template:"'#year#",title:"Год"},yAxis:{title:"Свойство"},data:x.peopleOne.diagramBar.data},{view:"resizer",class:"webix_resizers"},{view:"chart",minHeight:170,minWidth:250,height:250,scroll:"auto",type:"area",xAxis:{template:"'#year#"},yAxis:{start:0,step:10,end:100},legend:{values:[{text:"Пар. №1",color:"#58dccd"},{text:"Пар. №2",color:"#914ad8"},{text:"Пар. №3",color:"#36abee"}],valign:"middle",align:"right",width:80,layout:"y"},eventRadius:5,series:[{alpha:.7,value:"#sales#",color:"#58dccd",tooltip:{template:"type: A<br/>value: #sales#"}},{alpha:.5,value:"#sales2#",color:"#914ad8",tooltip:{template:"type: B<br/>value: #sales2#"}},{alpha:.5,value:"#sales3#",color:"#36abee",tooltip:{template:"type: C<br/>value: #sales3#"}}],data:x.peopleOne.diagramArea.data}]}]}}]},{id:"tableView",hidden:!0,rows:[_(a,n,"table-viewexportBtn",s,t,!0),{view:"resizer",class:"webix_resizers"},{view:"scrollview",body:{view:"flexlayout",cols:[E(t,a,T),{view:"resizer",class:"webix_resizers"},("propTableView",{view:"property",id:"propTableView",tooltip:"Имя: #label#<br> Значение: #value#",width:350,nameWidth:150,editable:!0,scroll:!0,hidden:!0})]}}]}]}]}]}]}}),webix.i18n.setLocale("ru-RU"),webix.i18n.parseFormat="%d.%m.%Y %H:%i:%s",webix.i18n.setLocale()}))})();