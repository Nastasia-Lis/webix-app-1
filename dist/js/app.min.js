(()=>{"use strict";let t="table",e="table-view",n="table-pager",i="table-search",r="table-findElemets",o="table-view-pager",s="table-view-search",a="table-view-findElemets",l="table-editForm",u="table-saveBtn",c="table-delBtnId",h="table-saveNewBtn",f="table-newAddBtnId";function d(t,e){const n=new Date;let i,r=`${n.getDate()}.${String(n.getMonth()+1).padStart(2,"0")}.${n.getFullYear()} ${n.getHours()}:${String(n.getMinutes()).padStart(2,"0")}`;if(b){let t;w.forEach((function(e,n){e.id==b&&(t=e.name)})),$$("logBlock-list").add({date:r,value:e,src:t})}else $$("logBlock-list").add({date:r,value:e,src:"Expa v1.0.1"});document.querySelectorAll(".webix_list_item").forEach((function(t,e){i=e}));let o=document.querySelectorAll(".webix_list_item")[i];"error"==t&&o.style.setProperty("color","red","important")}const p={id:"logLayout",height:80,rows:[{template:"<div class='webix_log-headline'>Системные сообщения</div>",height:30},{id:"logBlock-list",css:"webix_log-block",view:"list",template:"#date# — #value#  (Источник: #src#)",data:[],on:{onAfterLoad:function(){d("success","Интерфейс загружен")}}}]};let g,v,b="",m=!1;function y(t,n,i,r){let o=[];"get"==i&&("refresh"==r?(t.forEach(((t,e)=>{t.id.includes("customCombo")?(console.log(t),o.push(t.name+"="+$$(t.id).getText())):(t.id.includes("customInputs")||t.id.includes("customDatepicker"))&&(console.log(t),o.push(t.name+"="+$$(t.id).getValue()))})),webix.ajax(n+"?"+o.join("&"),{success:function(t,n,i){$$(e).clearAll(),0!==(n=n.json().content).length?($$(e).hideOverlay("Ничего не найдено"),$$(e).parse(n)):$$(e).showOverlay("Ничего не найдено"),g=$$(e).count(),$$(a).setValues(g.toString())},error:function(t,e,n){A("error","Ошибка при загрузке данных",!0),$$(f).isEnabled()||$$(f).enable()}})):"download"==r&&webix.ajax().response("blob").get(n,(function(t,e,n){webix.html.download(e,"table.docx")})))}function $(t,n,i,r){b=i;let o=$$("tree").getItem(i);if($$(t).clearAll(),$$(n).setValue(""),null==o)A("error","Данные не найдены");else{let n;t==e&&$$("filterBar").removeView("customInputs"),webix.ajax().get("/init/default/api/fields.json").then((function(r){let o,s,a=(r=r.json().content[i]).fields,l=Object.keys(r.fields),u=[];l.forEach((function(t){"datetime"==a[t].type&&(a[t].format=webix.i18n.fullDateFormatStr),a[t].id=t,a[t].fillspace=!0,a[t].header=a[t].label,"id"==a[t].id&&(a[t].hidden=!0),u.push(a[t])})),$$(t).refreshColumns(u),m=!1,console.log(r),u.forEach((function(t,e){"action"==t.type&&"detail"==r.actions[t.id].rtype&&(m=!0,o=e,s=t.id)})),void 0!==s&&(v=r.actions[s].url,m)&&($$(t).config.columns.splice(0,0,{id:"action-first"+o,maxWidth:130,header:"Подробнее",template:"<span class='webix_icon wxi-angle-down'></span> "}),$$(t).refreshColumns());let c=Object.keys(r.inputs),h=[],f=[],d=r.inputs;c.forEach(((n,i)=>{if("string"==d[n].type)h.push({view:"text",placeholder:d[n].label,id:"customInputs"+i,maxWidth:300,minWidth:150,height:48,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",d[n].comment)}}});else if("apiselect"==d[n].type){let t=new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get("/init/default/api/"+d[n].apiname).then((function(t){console.log(t.json());let e=t.json().content,n=[];return void 0!==e[0].name?e.forEach((function(t,e){console.log(t),n.push({id:e+1,value:t.name})})):e.forEach((function(t,e){n.push({id:e+1,value:t})})),n}))}}});h.push({view:"combo",width:250,height:48,id:"customCombo"+i,placeholder:d[n].label,labelPosition:"top",options:{data:t},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",d[n].comment)}}})}else if("submit"==d[n].type||"button"==d[n].type){let e=d[n].action,o=r.actions[e];if("DELETE"==o.verb&&"submit"!==e){let e=$$(t).getColumns().length;$$(t).config.columns.splice(e,0,{id:"action"+i,header:"Действие",maxWidth:100,template:"{common.trashIcon()}"}),$$(t).refreshColumns()}else"DELETE"==o.verb?h.push({view:"button",id:"customBtnDel"+i,css:"webix_danger",type:"icon",icon:"wxi-trash",inputHeight:48,height:48,width:100,value:d[n].label,click:function(t){y(f,o.url,"delete")},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",d[n].comment)}}}):h.push({view:"button",css:"webix_primary",id:"customBtn"+i,inputHeight:48,height:48,minWidth:100,maxWidth:550,value:d[n].label,click:function(t){"GET"==o.verb?"refresh"==o.rtype?(y(f,o.url,"get","refresh"),console.log("get")):"download"==o.rtype&&(y(f,o.url,"get","download"),console.log("get")):"POST"==o.verb?(y(f,o.url,"post"),console.log("post")):"download"==o.verb&&(y(f,o.url,"get","download"),console.log("download"))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",d[n].comment)}}})}else"upload"==d[n].type?h.push({rows:[{},{view:"uploader",value:"Upload file",id:"customUploader"+i,height:48,link:e,upload:r.actions.submit.url,label:d[n].label,labelPosition:"top",on:{onAfterRender:function(){this.getInputNode().setAttribute("title",d[n].comment)},onFileUpload:function(){A("success","Файл успешно загружен",!0)},onFileUploadError:function(){A("error","Ошибка при загрузке файла",!0)}}}]}):"datetime"==d[n].type?h.push({view:"datepicker",format:webix.Date.strToDate("%d.%m.%Y"),placeholder:d[n].label,id:"customDatepicker"+i,timepicker:!0,labelPosition:"top",width:300,minWidth:100,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",d[n].comment)}}}):"checkbox"==d[n].type&&h.push({view:"checkbox",id:"customСheckbox"+i,minWidth:220,css:"webix_checkbox-style",labelRight:d[n].label,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",d[n].comment)}}});h.push({width:10})})),h.forEach(((t,e)=>{void 0!==t.id&&("text"==t.view?f.push({id:t.id,name:"substr"}):"combo"==t.view?f.push({id:t.id,name:"valtype"}):("uploader"==t.view||"datepicker"==t.view)&&f.push({id:t.id}))})),n={id:"customInputs",css:"webix_custom-inp",cols:h},$$("filterBar").addView(n,2)})),webix.ajax().get("/init/default/api/"+b,{success:function(e,n,i){$$(f).isEnabled()||$$(f).enable(),$$(t).showProgress({type:"bottom",hide:!0}),0!==(n=n.json().content).length?($$(t).hideOverlay("Ничего не найдено"),$$(t).parse(n)):$$(t).showOverlay("Ничего не найдено"),g=$$(t).count(),$$(r).setValues(g.toString())},error:function(t,e,n){A("error","Ошибка при загрузке данных",!0),$$(f).isEnabled()&&$$(f).disable()}})}}let w=[];function x(){let e=$$(t).getColumns();if(0==Object.keys($$(l).elements).length){let t=[];e.forEach(((e,n)=>{if("datetime"==e.type)t.push({view:"datepicker",format:webix.Date.strToDate("%d.%m.%Y"),name:e.id,label:e.label,placeholder:"дд.мм.гг",timepicker:!0,labelPosition:"top",on:{onItemClick:function(){$$(l).clearValidation()}}});else if(e.type.includes("reference")){let n=e.type.slice(10),i=new webix.DataCollection({url:{$proxy:!0,load:function(){return webix.ajax().get("/init/default/api/"+n).then((function(t){t=t.json().content;let e,n=[];return t.forEach(((t,i)=>{let r=0;for(;r<=Object.values(t).length;){if("string"==typeof Object.values(t)[r]){e=Object.keys(t)[r];break}r++}if(null==t[e])for(;r<=Object.values(t).length;){if("number"==typeof Object.values(t)[1]){e=Object.keys(t)[1];break}r++}n.push({id:t.id,value:t[e]})})),n}))}}});t.push({view:"combo",placeholder:"Введите текст",label:e.label,name:e.id,labelPosition:"top",options:{data:i},on:{onItemClick:function(){$$(l).clearValidation()}}})}else t.push({view:"text",name:e.id,label:e.label,labelPosition:"top",on:{onKeyPress:function(){$$(l).clearValidation()}}})}));let n={margin:8,id:"inputsTable",rows:t};return $$(c).enable(),$$(l).addView(n,1)}console.log($$(l).isDirty()),$$(l).clear(),$$(l).clearValidation(),$$(c).enable(),$$("inputsTable").show()}function _(){$$(l).clear(),$$(l).clearValidation(),j()}function j(){$$(h).isVisible()?$$(h).hide():$$(u).isVisible()&&$$(u).hide(),$$(c).disable()}function E(t){return webix.confirm({width:300,ok:"Да",cancel:"Отмена",title:t,text:"Вы уверены, что хотите продолжить?"})}function A(t,e,n=!1){webix.message.position="bottom",webix.message({type:t,text:e}),n&&d(t,e)}let k={view:"form",id:l,css:"webix_form-edit",container:"webix__form-container",minHeight:350,minWidth:210,width:320,scroll:!0,elements:[{id:"form-adaptive",minHeight:48,css:"webix_form-adaptive",margin:5,rows:[{margin:5,rows:[{responsive:"form-adaptive",margin:5,cols:[{view:"button",id:f,height:48,minWidth:90,hotkey:"shift",value:"Новая запись",click:function(){$$(l).isDirty()?E("Данные не сохранены").then((function(){$$(t).filter(!1),$$(t).hideOverlay("Ничего не найдено"),$$(i).setValue(""),x(),$$(c).disable(),$$(u).hide(),$$(h).show()})):($$(t).filter(!1),$$(t).hideOverlay("Ничего не найдено"),$$(i).setValue(""),x(),$$(c).disable(),$$(u).hide(),$$(h).show(),$$(f).disable())}},{view:"button",id:c,disabled:!0,height:48,minWidth:90,width:100,hotkey:"shift+esc",css:"webix_danger",type:"icon",icon:"wxi-trash",click:function(){E("Запись будет удалена").then((function(){$$(t).remove($$(l).getValues().id);let e=$$(l).getValues();webix.ajax().del("/init/default/api/"+b+"/"+e.id+".json",e,{success:function(){console.log(e.id),_(),j(),$$("inputsTable").hide(),A("success","Данные успешно удалены",!0)},error:function(){A("error","Ошибка при удалении записи",!0)}})}))},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Удалить запись из таблицы")}}}]}]},{margin:10,rows:[{view:"button",id:u,hidden:!0,value:"Сохранить",height:48,css:"webix_primary",click:function(){let e=$$(l).getValues();$$(l).validate()?e.id&&webix.ajax().put("/init/default/api/"+b+"/"+e.id,e,{success:function(){$$(t).updateItem(e.id,e),_(),A("success","Данные сохранены",!0),j(),$$("inputsTable").hide(),$$(t).clearSelection(),$$(f).enable()},error:function(){A("error","Ошибка при сохранении данных",!0)}}):A("error","Заполните пустые поля",!0)},hotkey:"enter"},{view:"button",id:h,value:"Сохранить новую запись",hidden:!0,height:48,hotkey:"enter",css:"webix_primary",click:function(){if($$(l).validate())if($$(l).isDirty()){let e=$$(l).getValues();e.id=$$(t).count()+1,console.log(e),webix.ajax().post("/init/default/api/"+b,e,{success:function(){$$(t).add(e),_(),j(),$$("inputsTable").hide(),$$(f).enable(),A("success","Данные успешно добавлены",!0)},error:function(){A("error","Ошибка при добавлении данных",!0)}})}else A("debug","Форма пуста");else A("error","Заполните пустые поля",!0)}}]}]},{}],rules:{$all:webix.rules.isNotEmpty},ready:function(){this.validate()}};function S(){let t=new(Backbone.Router.extend({routes:{"":"index",content:"content"},content:function(){$$("mainLayout").show()},index:function(){$$("userAuth").show()}}));return{view:"form",id:"formAuth",maxWidth:300,borderless:!0,elements:[{view:"text",label:"Логин",name:"username",invalidMessage:"Поле должно быть заполнено"},{view:"text",label:"Пароль",name:"password",invalidMessage:"Поле должно быть заполнено",type:"password"},{view:"button",value:"Войти",css:"webix_primary",hotkey:"enter",align:"center",click:function(){$$("formAuth").validate();let e=$$("formAuth").getValues(),n=[];n.push("un="+e.username),n.push("np="+e.password),webix.ajax("/init/default/login?"+n.join("&"),{success:function(e,n,i){console.log(n.json(),"login"),webix.ajax("/init/default/api/whoami",{success:function(e,n,i){t.navigate("content",{trigger:!0}),console.log(n.json())},error:function(t,e,n){$$("formAuth").isDirty()&&A("error","Неверный логин или пароль")}})},error:function(t,e,n){}})}}],rules:{username:webix.rules.isNotEmpty,password:webix.rules.isNotEmpty},elementsConfig:{labelPosition:"top"}}}function I(t,e){"undefined"!=typeof Storage&&localStorage.setItem(t,e)}const T={id:"dashboardBody",rows:[{id:"dashEmpty"}]},O={id:"dashboardTool",css:"webix_dashTool",rows:[]};function V(t,e,n,i,r,o=!1){return{id:"adaptive-toolbar",rows:[{id:"filterBar",responsive:"adaptive-toolbar",css:"webix_filterBar",padding:17,height:80,margin:5,cols:[{view:"search",placeholder:"Поиск",id:e,hidden:o,css:"searchTable",maxWidth:250,minWidth:40,on:{onTimedKeyPress(){let t=this.getValue().toLowerCase(),e=$$(r),n=e.config.columns,o=0;e.filter((function(e){for(let i=0;i<n.length;i++)if(-1!==e[n[i].id].toString().toLowerCase().indexOf(t))return o++,!0;return!1})),o?o&&$$(r).hideOverlay("Ничего не найдено"):$$(r).showOverlay("Ничего не найдено"),$$(i).setValues(o.toString())},onAfterRender:function(){this.getInputNode().setAttribute("title","Поиск по таблице")}}},{view:"pager",id:t,size:100,inputHeight:48,inputWidth:50,group:3,height:50,template:"{common.prev()} \n                {common.pages()} {common.next()}"},{view:"button",width:50,type:"icon",id:n,hidden:o,icon:"wxi-download",css:"webix_btn-download",title:"текст",height:50,click:function(){webix.toExcel(r,{filename:"Table",filterHTML:!0,styles:!0}),A("success","Таблица сохранена",!0)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Экспорт таблицы")}}}]},{view:"template",id:i,css:"webix_style-template-count",height:30,template:function(){return 0!==Object.keys($$(i).getValues()).length?"<div style='color:#999898;'> Количество записей: "+$$(i).getValues()+" </div>":""}}]}}function R(t,e,n,i){return{view:"datatable",id:t,css:"webix_table-style webix_header_border webix_data_border",resizeColumn:!0,autoConfig:!0,pager:e,minHeight:350,footer:!0,minWidth:500,select:!0,minColumnWidth:200,on:n,onClick:{"wxi-trash":function(){E("Запись будет удалена").then((function(){let e=$$(t).getItem(id);webix.ajax().del("/init/default/api/"+b+"/"+e.id+".json",e,{success:function(){$$(t).remove($$(t).getSelectedId()),A("success","Данные успешно удалены",!0)},error:function(){A("error","Ошибка при удалении записи",!0)}})}))},"wxi-angle-down":function(t,e,n){if($$("propTableView").isVisible())$$("propTableView").hide(),$$("propResize").hide();else{let t=e.row,n=v.search("{"),i=v.slice(0,n);webix.ajax(i+t+".json",{success:function(t,e,n){console.log(e.json()),e=e.json().content;let i=[];e.forEach((function(t,e){i.push({type:"text",id:e+1,label:t.name,value:t.value})})),$$("propTableView").define("elements",i),$$("propTableView").show(),$$("propResize").show()},error:function(t,e,n){A("error","Ошибка при загрузке")}})}}}}}let B={onBeforeLoad:function(){this.showOverlay("Loading...")},onAfterSelect(e){let n=$$(t).getItem(e);function i(){$$(l).setValues(n),console.log(n),$$(h).hide(),$$(u).show(),$$(l).clearValidation()}$$(l).isDirty()?E("Данные не сохранены").then((function(){$$(l).clear(),$$(c).enable(),i()})):(x(),i())},onAfterLoad:function(){this.hideOverlay(),$$(l).removeView("inputsTable"),j()},onAfterDelete:function(){$$(r).setValues($$(t).count().toString()),this.count()||this.showOverlay("Ничего не найдено"),this.count()&&this.hideOverlay()},onAfterAdd:function(){$$(r).setValues($$(t).count().toString()),this.hideOverlay()}},M={onAfterSelect:function(t){console.log(this.getItem(t))}};console.log("expa 1.0.1"),function(){!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("underscore",e):(t="undefined"!=typeof globalThis?globalThis:t||self,function(){var n=t._,i=t._=e();i.noConflict=function(){return t._=n,i}}())}(this,(function(){var t="1.13.4",e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},n=Array.prototype,i=Object.prototype,r="undefined"!=typeof Symbol?Symbol.prototype:null,o=n.push,s=n.slice,a=i.toString,l=i.hasOwnProperty,u="undefined"!=typeof ArrayBuffer,c="undefined"!=typeof DataView,h=Array.isArray,f=Object.keys,d=Object.create,p=u&&ArrayBuffer.isView,g=isNaN,v=isFinite,b=!{toString:null}.propertyIsEnumerable("toString"),m=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],y=Math.pow(2,53)-1;function $(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),i=Array(n),r=0;r<n;r++)i[r]=arguments[r+e];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,arguments[0],i);case 2:return t.call(this,arguments[0],arguments[1],i)}var o=Array(e+1);for(r=0;r<e;r++)o[r]=arguments[r];return o[e]=i,t.apply(this,o)}}function w(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function x(t){return void 0===t}function _(t){return!0===t||!1===t||"[object Boolean]"===a.call(t)}function j(t){var e="[object "+t+"]";return function(t){return a.call(t)===e}}var E=j("String"),A=j("Number"),k=j("Date"),S=j("RegExp"),I=j("Error"),T=j("Symbol"),O=j("ArrayBuffer"),V=j("Function"),R=e.document&&e.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof R&&(V=function(t){return"function"==typeof t||!1});var B=V,M=j("Object"),N=c&&M(new DataView(new ArrayBuffer(8))),P="undefined"!=typeof Map&&M(new Map),z=j("DataView"),C=N?function(t){return null!=t&&B(t.getInt8)&&O(t.buffer)}:z,H=h||j("Array");function D(t,e){return null!=t&&l.call(t,e)}var W=j("Arguments");!function(){W(arguments)||(W=function(t){return D(t,"callee")})}();var L=W;function U(t){return A(t)&&g(t)}function F(t){return function(){return t}}function q(t){return function(e){var n=t(e);return"number"==typeof n&&n>=0&&n<=y}}function J(t){return function(e){return null==e?void 0:e[t]}}var Y=J("byteLength"),K=q(Y),G=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,Q=u?function(t){return p?p(t)&&!C(t):K(t)&&G.test(a.call(t))}:F(!1),X=J("length");function Z(t,e){e=function(t){for(var e={},n=t.length,i=0;i<n;++i)e[t[i]]=!0;return{contains:function(t){return!0===e[t]},push:function(n){return e[n]=!0,t.push(n)}}}(e);var n=m.length,r=t.constructor,o=B(r)&&r.prototype||i,s="constructor";for(D(t,s)&&!e.contains(s)&&e.push(s);n--;)(s=m[n])in t&&t[s]!==o[s]&&!e.contains(s)&&e.push(s)}function tt(t){if(!w(t))return[];if(f)return f(t);var e=[];for(var n in t)D(t,n)&&e.push(n);return b&&Z(t,e),e}function et(t,e){var n=tt(e),i=n.length;if(null==t)return!i;for(var r=Object(t),o=0;o<i;o++){var s=n[o];if(e[s]!==r[s]||!(s in r))return!1}return!0}function nt(t){return t instanceof nt?t:this instanceof nt?void(this._wrapped=t):new nt(t)}function it(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,Y(t))}nt.VERSION=t,nt.prototype.value=function(){return this._wrapped},nt.prototype.valueOf=nt.prototype.toJSON=nt.prototype.value,nt.prototype.toString=function(){return String(this._wrapped)};var rt="[object DataView]";function ot(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var r=typeof t;return("function"===r||"object"===r||"object"==typeof e)&&st(t,e,n,i)}function st(t,e,n,i){t instanceof nt&&(t=t._wrapped),e instanceof nt&&(e=e._wrapped);var o=a.call(t);if(o!==a.call(e))return!1;if(N&&"[object Object]"==o&&C(t)){if(!C(e))return!1;o=rt}switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return r.valueOf.call(t)===r.valueOf.call(e);case"[object ArrayBuffer]":case rt:return st(it(t),it(e),n,i)}var s="[object Array]"===o;if(!s&&Q(t)){if(Y(t)!==Y(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;s=!0}if(!s){if("object"!=typeof t||"object"!=typeof e)return!1;var l=t.constructor,u=e.constructor;if(l!==u&&!(B(l)&&l instanceof l&&B(u)&&u instanceof u)&&"constructor"in t&&"constructor"in e)return!1}i=i||[];for(var c=(n=n||[]).length;c--;)if(n[c]===t)return i[c]===e;if(n.push(t),i.push(e),s){if((c=t.length)!==e.length)return!1;for(;c--;)if(!ot(t[c],e[c],n,i))return!1}else{var h,f=tt(t);if(c=f.length,tt(e).length!==c)return!1;for(;c--;)if(!D(e,h=f[c])||!ot(t[h],e[h],n,i))return!1}return n.pop(),i.pop(),!0}function at(t){if(!w(t))return[];var e=[];for(var n in t)e.push(n);return b&&Z(t,e),e}function lt(t){var e=X(t);return function(n){if(null==n)return!1;var i=at(n);if(X(i))return!1;for(var r=0;r<e;r++)if(!B(n[t[r]]))return!1;return t!==dt||!B(n[ut])}}var ut="forEach",ct=["clear","delete"],ht=["get","has","set"],ft=ct.concat(ut,ht),dt=ct.concat(ht),pt=["add"].concat(ct,ut,"has"),gt=P?lt(ft):j("Map"),vt=P?lt(dt):j("WeakMap"),bt=P?lt(pt):j("Set"),mt=j("WeakSet");function yt(t){for(var e=tt(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=t[e[r]];return i}function $t(t){for(var e={},n=tt(t),i=0,r=n.length;i<r;i++)e[t[n[i]]]=n[i];return e}function wt(t){var e=[];for(var n in t)B(t[n])&&e.push(n);return e.sort()}function xt(t,e){return function(n){var i=arguments.length;if(e&&(n=Object(n)),i<2||null==n)return n;for(var r=1;r<i;r++)for(var o=arguments[r],s=t(o),a=s.length,l=0;l<a;l++){var u=s[l];e&&void 0!==n[u]||(n[u]=o[u])}return n}}var _t=xt(at),jt=xt(tt),Et=xt(at,!0);function At(t){if(!w(t))return{};if(d)return d(t);var e=function(){};e.prototype=t;var n=new e;return e.prototype=null,n}function kt(t){return H(t)?t:[t]}function St(t){return nt.toPath(t)}function It(t,e){for(var n=e.length,i=0;i<n;i++){if(null==t)return;t=t[e[i]]}return n?t:void 0}function Tt(t,e,n){var i=It(t,St(e));return x(i)?n:i}function Ot(t){return t}function Vt(t){return t=jt({},t),function(e){return et(e,t)}}function Rt(t){return t=St(t),function(e){return It(e,t)}}function Bt(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,o){return t.call(e,n,i,r,o)}}return function(){return t.apply(e,arguments)}}function Mt(t,e,n){return null==t?Ot:B(t)?Bt(t,e,n):w(t)&&!H(t)?Vt(t):Rt(t)}function Nt(t,e){return Mt(t,e,1/0)}function Pt(t,e,n){return nt.iteratee!==Nt?nt.iteratee(t,e):Mt(t,e,n)}function zt(){}function Ct(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}nt.toPath=kt,nt.iteratee=Nt;var Ht=Date.now||function(){return(new Date).getTime()};function Dt(t){var e=function(e){return t[e]},n="(?:"+tt(t).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(r,e):t}}var Wt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Lt=Dt(Wt),Ut=Dt($t(Wt)),Ft=nt.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},qt=/(.)^/,Jt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Yt=/\\|'|\r|\n|\u2028|\u2029/g;function Kt(t){return"\\"+Jt[t]}var Gt=/^\s*(\w|\$)+\s*$/,Qt=0;function Xt(t,e,n,i,r){if(!(i instanceof e))return t.apply(n,r);var o=At(t.prototype),s=t.apply(o,r);return w(s)?s:o}var Zt=$((function(t,e){var n=Zt.placeholder,i=function(){for(var r=0,o=e.length,s=Array(o),a=0;a<o;a++)s[a]=e[a]===n?arguments[r++]:e[a];for(;r<arguments.length;)s.push(arguments[r++]);return Xt(t,i,this,this,s)};return i}));Zt.placeholder=nt;var te=$((function(t,e,n){if(!B(t))throw new TypeError("Bind must be called on a function");var i=$((function(r){return Xt(t,i,e,this,n.concat(r))}));return i})),ee=q(X);function ne(t,e,n,i){if(i=i||[],e||0===e){if(e<=0)return i.concat(t)}else e=1/0;for(var r=i.length,o=0,s=X(t);o<s;o++){var a=t[o];if(ee(a)&&(H(a)||L(a)))if(e>1)ne(a,e-1,n,i),r=i.length;else for(var l=0,u=a.length;l<u;)i[r++]=a[l++];else n||(i[r++]=a)}return i}var ie=$((function(t,e){var n=(e=ne(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var i=e[n];t[i]=te(t[i],t)}return t})),re=$((function(t,e,n){return setTimeout((function(){return t.apply(null,n)}),e)})),oe=Zt(re,nt,1);function se(t){return function(){return!t.apply(this,arguments)}}function ae(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}var le=Zt(ae,2);function ue(t,e,n){e=Pt(e,n);for(var i,r=tt(t),o=0,s=r.length;o<s;o++)if(e(t[i=r[o]],i,t))return i}function ce(t){return function(e,n,i){n=Pt(n,i);for(var r=X(e),o=t>0?0:r-1;o>=0&&o<r;o+=t)if(n(e[o],o,e))return o;return-1}}var he=ce(1),fe=ce(-1);function de(t,e,n,i){for(var r=(n=Pt(n,i,1))(e),o=0,s=X(t);o<s;){var a=Math.floor((o+s)/2);n(t[a])<r?o=a+1:s=a}return o}function pe(t,e,n){return function(i,r,o){var a=0,l=X(i);if("number"==typeof o)t>0?a=o>=0?o:Math.max(o+l,a):l=o>=0?Math.min(o+1,l):o+l+1;else if(n&&o&&l)return i[o=n(i,r)]===r?o:-1;if(r!=r)return(o=e(s.call(i,a,l),U))>=0?o+a:-1;for(o=t>0?a:l-1;o>=0&&o<l;o+=t)if(i[o]===r)return o;return-1}}var ge=pe(1,he,de),ve=pe(-1,fe);function be(t,e,n){var i=(ee(t)?he:ue)(t,e,n);if(void 0!==i&&-1!==i)return t[i]}function me(t,e,n){var i,r;if(e=Bt(e,n),ee(t))for(i=0,r=t.length;i<r;i++)e(t[i],i,t);else{var o=tt(t);for(i=0,r=o.length;i<r;i++)e(t[o[i]],o[i],t)}return t}function ye(t,e,n){e=Pt(e,n);for(var i=!ee(t)&&tt(t),r=(i||t).length,o=Array(r),s=0;s<r;s++){var a=i?i[s]:s;o[s]=e(t[a],a,t)}return o}function $e(t){var e=function(e,n,i,r){var o=!ee(e)&&tt(e),s=(o||e).length,a=t>0?0:s-1;for(r||(i=e[o?o[a]:a],a+=t);a>=0&&a<s;a+=t){var l=o?o[a]:a;i=n(i,e[l],l,e)}return i};return function(t,n,i,r){var o=arguments.length>=3;return e(t,Bt(n,r,4),i,o)}}var we=$e(1),xe=$e(-1);function _e(t,e,n){var i=[];return e=Pt(e,n),me(t,(function(t,n,r){e(t,n,r)&&i.push(t)})),i}function je(t,e,n){e=Pt(e,n);for(var i=!ee(t)&&tt(t),r=(i||t).length,o=0;o<r;o++){var s=i?i[o]:o;if(!e(t[s],s,t))return!1}return!0}function Ee(t,e,n){e=Pt(e,n);for(var i=!ee(t)&&tt(t),r=(i||t).length,o=0;o<r;o++){var s=i?i[o]:o;if(e(t[s],s,t))return!0}return!1}function Ae(t,e,n,i){return ee(t)||(t=yt(t)),("number"!=typeof n||i)&&(n=0),ge(t,e,n)>=0}var ke=$((function(t,e,n){var i,r;return B(e)?r=e:(e=St(e),i=e.slice(0,-1),e=e[e.length-1]),ye(t,(function(t){var o=r;if(!o){if(i&&i.length&&(t=It(t,i)),null==t)return;o=t[e]}return null==o?o:o.apply(t,n)}))}));function Se(t,e){return ye(t,Rt(e))}function Ie(t,e,n){var i,r,o=-1/0,s=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,l=(t=ee(t)?t:yt(t)).length;a<l;a++)null!=(i=t[a])&&i>o&&(o=i);else e=Pt(e,n),me(t,(function(t,n,i){((r=e(t,n,i))>s||r===-1/0&&o===-1/0)&&(o=t,s=r)}));return o}var Te=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Oe(t){return t?H(t)?s.call(t):E(t)?t.match(Te):ee(t)?ye(t,Ot):yt(t):[]}function Ve(t,e,n){if(null==e||n)return ee(t)||(t=yt(t)),t[Ct(t.length-1)];var i=Oe(t),r=X(i);e=Math.max(Math.min(e,r),0);for(var o=r-1,s=0;s<e;s++){var a=Ct(s,o),l=i[s];i[s]=i[a],i[a]=l}return i.slice(0,e)}function Re(t,e){return function(n,i,r){var o=e?[[],[]]:{};return i=Pt(i,r),me(n,(function(e,r){var s=i(e,r,n);t(o,e,s)})),o}}var Be=Re((function(t,e,n){D(t,n)?t[n].push(e):t[n]=[e]})),Me=Re((function(t,e,n){t[n]=e})),Ne=Re((function(t,e,n){D(t,n)?t[n]++:t[n]=1})),Pe=Re((function(t,e,n){t[n?0:1].push(e)}),!0);function ze(t,e,n){return e in n}var Ce=$((function(t,e){var n={},i=e[0];if(null==t)return n;B(i)?(e.length>1&&(i=Bt(i,e[1])),e=at(t)):(i=ze,e=ne(e,!1,!1),t=Object(t));for(var r=0,o=e.length;r<o;r++){var s=e[r],a=t[s];i(a,s,t)&&(n[s]=a)}return n})),He=$((function(t,e){var n,i=e[0];return B(i)?(i=se(i),e.length>1&&(n=e[1])):(e=ye(ne(e,!1,!1),String),i=function(t,n){return!Ae(e,n)}),Ce(t,i,n)}));function De(t,e,n){return s.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))}function We(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[0]:De(t,t.length-e)}function Le(t,e,n){return s.call(t,null==e||n?1:e)}var Ue=$((function(t,e){return e=ne(e,!0,!0),_e(t,(function(t){return!Ae(e,t)}))})),Fe=$((function(t,e){return Ue(t,e)}));function qe(t,e,n,i){_(e)||(i=n,n=e,e=!1),null!=n&&(n=Pt(n,i));for(var r=[],o=[],s=0,a=X(t);s<a;s++){var l=t[s],u=n?n(l,s,t):l;e&&!n?(s&&o===u||r.push(l),o=u):n?Ae(o,u)||(o.push(u),r.push(l)):Ae(r,l)||r.push(l)}return r}var Je=$((function(t){return qe(ne(t,!0,!0))}));function Ye(t){for(var e=t&&Ie(t,X).length||0,n=Array(e),i=0;i<e;i++)n[i]=Se(t,i);return n}var Ke=$(Ye);function Ge(t,e){return t._chain?nt(e).chain():e}function Qe(t){return me(wt(t),(function(e){var n=nt[e]=t[e];nt.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),Ge(this,n.apply(nt,t))}})),nt}me(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=n[t];nt.prototype[t]=function(){var n=this._wrapped;return null!=n&&(e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0]),Ge(this,n)}})),me(["concat","join","slice"],(function(t){var e=n[t];nt.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=e.apply(t,arguments)),Ge(this,t)}}));var Xe={__proto__:null,VERSION:t,restArguments:$,isObject:w,isNull:function(t){return null===t},isUndefined:x,isBoolean:_,isElement:function(t){return!(!t||1!==t.nodeType)},isString:E,isNumber:A,isDate:k,isRegExp:S,isError:I,isSymbol:T,isArrayBuffer:O,isDataView:C,isArray:H,isFunction:B,isArguments:L,isFinite:function(t){return!T(t)&&v(t)&&!isNaN(parseFloat(t))},isNaN:U,isTypedArray:Q,isEmpty:function(t){if(null==t)return!0;var e=X(t);return"number"==typeof e&&(H(t)||E(t)||L(t))?0===e:0===X(tt(t))},isMatch:et,isEqual:function(t,e){return ot(t,e)},isMap:gt,isWeakMap:vt,isSet:bt,isWeakSet:mt,keys:tt,allKeys:at,values:yt,pairs:function(t){for(var e=tt(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=[e[r],t[e[r]]];return i},invert:$t,functions:wt,methods:wt,extend:_t,extendOwn:jt,assign:jt,defaults:Et,create:function(t,e){var n=At(t);return e&&jt(n,e),n},clone:function(t){return w(t)?H(t)?t.slice():_t({},t):t},tap:function(t,e){return e(t),t},get:Tt,has:function(t,e){for(var n=(e=St(e)).length,i=0;i<n;i++){var r=e[i];if(!D(t,r))return!1;t=t[r]}return!!n},mapObject:function(t,e,n){e=Pt(e,n);for(var i=tt(t),r=i.length,o={},s=0;s<r;s++){var a=i[s];o[a]=e(t[a],a,t)}return o},identity:Ot,constant:F,noop:zt,toPath:kt,property:Rt,propertyOf:function(t){return null==t?zt:function(e){return Tt(t,e)}},matcher:Vt,matches:Vt,times:function(t,e,n){var i=Array(Math.max(0,t));e=Bt(e,n,1);for(var r=0;r<t;r++)i[r]=e(r);return i},random:Ct,now:Ht,escape:Lt,unescape:Ut,templateSettings:Ft,template:function(t,e,n){!e&&n&&(e=n),e=Et({},e,nt.templateSettings);var i=RegExp([(e.escape||qt).source,(e.interpolate||qt).source,(e.evaluate||qt).source].join("|")+"|$","g"),r=0,o="__p+='";t.replace(i,(function(e,n,i,s,a){return o+=t.slice(r,a).replace(Yt,Kt),r=a+e.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?o+="'+\n((__t=("+i+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),e})),o+="';\n";var s,a=e.variable;if(a){if(!Gt.test(a))throw new Error("variable is not a bare identifier: "+a)}else o="with(obj||{}){\n"+o+"}\n",a="obj";o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{s=new Function(a,"_",o)}catch(t){throw t.source=o,t}var l=function(t){return s.call(this,t,nt)};return l.source="function("+a+"){\n"+o+"}",l},result:function(t,e,n){var i=(e=St(e)).length;if(!i)return B(n)?n.call(t):n;for(var r=0;r<i;r++){var o=null==t?void 0:t[e[r]];void 0===o&&(o=n,r=i),t=B(o)?o.call(t):o}return t},uniqueId:function(t){var e=++Qt+"";return t?t+e:e},chain:function(t){var e=nt(t);return e._chain=!0,e},iteratee:Nt,partial:Zt,bind:te,bindAll:ie,memoize:function(t,e){var n=function(i){var r=n.cache,o=""+(e?e.apply(this,arguments):i);return D(r,o)||(r[o]=t.apply(this,arguments)),r[o]};return n.cache={},n},delay:re,defer:oe,throttle:function(t,e,n){var i,r,o,s,a=0;n||(n={});var l=function(){a=!1===n.leading?0:Ht(),i=null,s=t.apply(r,o),i||(r=o=null)},u=function(){var u=Ht();a||!1!==n.leading||(a=u);var c=e-(u-a);return r=this,o=arguments,c<=0||c>e?(i&&(clearTimeout(i),i=null),a=u,s=t.apply(r,o),i||(r=o=null)):i||!1===n.trailing||(i=setTimeout(l,c)),s};return u.cancel=function(){clearTimeout(i),a=0,i=r=o=null},u},debounce:function(t,e,n){var i,r,o,s,a,l=function(){var u=Ht()-r;e>u?i=setTimeout(l,e-u):(i=null,n||(s=t.apply(a,o)),i||(o=a=null))},u=$((function(u){return a=this,o=u,r=Ht(),i||(i=setTimeout(l,e),n&&(s=t.apply(a,o))),s}));return u.cancel=function(){clearTimeout(i),i=o=a=null},u},wrap:function(t,e){return Zt(e,t)},negate:se,compose:function(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}},after:function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},before:ae,once:le,findKey:ue,findIndex:he,findLastIndex:fe,sortedIndex:de,indexOf:ge,lastIndexOf:ve,find:be,detect:be,findWhere:function(t,e){return be(t,Vt(e))},each:me,forEach:me,map:ye,collect:ye,reduce:we,foldl:we,inject:we,reduceRight:xe,foldr:xe,filter:_e,select:_e,reject:function(t,e,n){return _e(t,se(Pt(e)),n)},every:je,all:je,some:Ee,any:Ee,contains:Ae,includes:Ae,include:Ae,invoke:ke,pluck:Se,where:function(t,e){return _e(t,Vt(e))},max:Ie,min:function(t,e,n){var i,r,o=1/0,s=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var a=0,l=(t=ee(t)?t:yt(t)).length;a<l;a++)null!=(i=t[a])&&i<o&&(o=i);else e=Pt(e,n),me(t,(function(t,n,i){((r=e(t,n,i))<s||r===1/0&&o===1/0)&&(o=t,s=r)}));return o},shuffle:function(t){return Ve(t,1/0)},sample:Ve,sortBy:function(t,e,n){var i=0;return e=Pt(e,n),Se(ye(t,(function(t,n,r){return{value:t,index:i++,criteria:e(t,n,r)}})).sort((function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index})),"value")},groupBy:Be,indexBy:Me,countBy:Ne,partition:Pe,toArray:Oe,size:function(t){return null==t?0:ee(t)?t.length:tt(t).length},pick:Ce,omit:He,first:We,head:We,take:We,initial:De,last:function(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[t.length-1]:Le(t,Math.max(0,t.length-e))},rest:Le,tail:Le,drop:Le,compact:function(t){return _e(t,Boolean)},flatten:function(t,e){return ne(t,e,!1)},without:Fe,uniq:qe,unique:qe,union:Je,intersection:function(t){for(var e=[],n=arguments.length,i=0,r=X(t);i<r;i++){var o=t[i];if(!Ae(e,o)){var s;for(s=1;s<n&&Ae(arguments[s],o);s++);s===n&&e.push(o)}}return e},difference:Ue,unzip:Ye,transpose:Ye,zip:Ke,object:function(t,e){for(var n={},i=0,r=X(t);i<r;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},range:function(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var i=Math.max(Math.ceil((e-t)/n),0),r=Array(i),o=0;o<i;o++,t+=n)r[o]=t;return r},chunk:function(t,e){if(null==e||e<1)return[];for(var n=[],i=0,r=t.length;i<r;)n.push(s.call(t,i,i+=e));return n},mixin:Qe,default:nt},Ze=Qe(Xe);return Ze._=Ze,Ze})),function(t){var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],(function(n,i,r){e.Backbone=t(e,r,n,i)}));else if("undefined"!=typeof exports){var n,i=require("underscore");try{n=require("jquery")}catch(t){}t(e,exports,i,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}((function(t,e,n,i){var r=t.Backbone,o=Array.prototype.slice;e.VERSION="1.4.1",e.$=i,e.noConflict=function(){return t.Backbone=r,this},e.emulateHTTP=!1,e.emulateJSON=!1;var s,a=e.Events={},l=/\s+/,u=function(t,e,i,r,o){var s,a=0;if(i&&"object"==typeof i){void 0!==r&&"context"in o&&void 0===o.context&&(o.context=r);for(s=n.keys(i);a<s.length;a++)e=u(t,e,s[a],i[s[a]],o)}else if(i&&l.test(i))for(s=i.split(l);a<s.length;a++)e=t(e,s[a],r,o);else e=t(e,i,r,o);return e};a.on=function(t,e,n){return this._events=u(c,this._events||{},t,e,{context:n,ctx:this,listening:s}),s&&((this._listeners||(this._listeners={}))[s.id]=s,s.interop=!1),this},a.listenTo=function(t,e,i){if(!t)return this;var r=t._listenId||(t._listenId=n.uniqueId("l")),o=this._listeningTo||(this._listeningTo={}),a=s=o[r];a||(this._listenId||(this._listenId=n.uniqueId("l")),a=s=o[r]=new v(this,t));var l=h(t,e,i,this);if(s=void 0,l)throw l;return a.interop&&a.on(e,i),this};var c=function(t,e,n,i){if(n){var r=t[e]||(t[e]=[]),o=i.context,s=i.ctx,a=i.listening;a&&a.count++,r.push({callback:n,context:o,ctx:o||s,listening:a})}return t},h=function(t,e,n,i){try{t.on(e,n,i)}catch(t){return t}};a.off=function(t,e,n){return this._events?(this._events=u(f,this._events,t,e,{context:n,listeners:this._listeners}),this):this},a.stopListening=function(t,e,i){var r=this._listeningTo;if(!r)return this;for(var o=t?[t._listenId]:n.keys(r),s=0;s<o.length;s++){var a=r[o[s]];if(!a)break;a.obj.off(e,i,this),a.interop&&a.off(e,i)}return n.isEmpty(r)&&(this._listeningTo=void 0),this};var f=function(t,e,i,r){if(t){var o,s=r.context,a=r.listeners,l=0;if(e||s||i){for(o=e?[e]:n.keys(t);l<o.length;l++){var u=t[e=o[l]];if(!u)break;for(var c=[],h=0;h<u.length;h++){var f=u[h];if(i&&i!==f.callback&&i!==f.callback._callback||s&&s!==f.context)c.push(f);else{var d=f.listening;d&&d.off(e,i)}}c.length?t[e]=c:delete t[e]}return t}for(o=n.keys(a);l<o.length;l++)a[o[l]].cleanup()}};a.once=function(t,e,n){var i=u(d,{},t,e,this.off.bind(this));return"string"==typeof t&&null==n&&(e=void 0),this.on(i,e,n)},a.listenToOnce=function(t,e,n){var i=u(d,{},e,n,this.stopListening.bind(this,t));return this.listenTo(t,i)};var d=function(t,e,i,r){if(i){var o=t[e]=n.once((function(){r(e,o),i.apply(this,arguments)}));o._callback=i}return t};a.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),n=Array(e),i=0;i<e;i++)n[i]=arguments[i+1];return u(p,this._events,t,void 0,n),this};var p=function(t,e,n,i){if(t){var r=t[e],o=t.all;r&&o&&(o=o.slice()),r&&g(r,i),o&&g(o,[e].concat(i))}return t},g=function(t,e){var n,i=-1,r=t.length,o=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++i<r;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=t[i]).callback.call(n.ctx,o);return;case 2:for(;++i<r;)(n=t[i]).callback.call(n.ctx,o,s);return;case 3:for(;++i<r;)(n=t[i]).callback.call(n.ctx,o,s,a);return;default:for(;++i<r;)(n=t[i]).callback.apply(n.ctx,e);return}},v=function(t,e){this.id=t._listenId,this.listener=t,this.obj=e,this.interop=!0,this.count=0,this._events=void 0};v.prototype.on=a.on,v.prototype.off=function(t,e){var n;this.interop?(this._events=u(f,this._events,t,e,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()},v.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},a.bind=a.on,a.unbind=a.off,n.extend(e,a);var b=e.Model=function(t,e){var i=t||{};e||(e={}),this.preinitialize.apply(this,arguments),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{});var r=n.result(this,"defaults");i=n.defaults(n.extend({},r,i),r),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};n.extend(b.prototype,a,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(t){return n.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return n.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!n.iteratee(t,this)(this.attributes)},set:function(t,e,i){if(null==t)return this;var r;if("object"==typeof t?(r=t,i=e):(r={})[t]=e,i||(i={}),!this._validate(r,i))return!1;var o=i.unset,s=i.silent,a=[],l=this._changing;this._changing=!0,l||(this._previousAttributes=n.clone(this.attributes),this.changed={});var u=this.attributes,c=this.changed,h=this._previousAttributes;for(var f in r)e=r[f],n.isEqual(u[f],e)||a.push(f),n.isEqual(h[f],e)?delete c[f]:c[f]=e,o?delete u[f]:u[f]=e;if(this.idAttribute in r){var d=this.id;this.id=this.get(this.idAttribute),this.trigger("changeId",this,d,i)}if(!s){a.length&&(this._pending=i);for(var p=0;p<a.length;p++)this.trigger("change:"+a[p],this,u[a[p]],i)}if(l)return this;if(!s)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,n.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,n.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!n.isEmpty(this.changed):n.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&n.clone(this.changed);var e,i=this._changing?this._previousAttributes:this.attributes,r={};for(var o in t){var s=t[o];n.isEqual(i[o],s)||(r[o]=s,e=!0)}return!!e&&r},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(t){t=n.extend({parse:!0},t);var e=this,i=t.success;return t.success=function(n){var r=t.parse?e.parse(n,t):n;if(!e.set(r,t))return!1;i&&i.call(t.context,e,n,t),e.trigger("sync",e,n,t)},U(this,t),this.sync("read",this,t)},save:function(t,e,i){var r;null==t||"object"==typeof t?(r=t,i=e):(r={})[t]=e;var o=(i=n.extend({validate:!0,parse:!0},i)).wait;if(r&&!o){if(!this.set(r,i))return!1}else if(!this._validate(r,i))return!1;var s=this,a=i.success,l=this.attributes;i.success=function(t){s.attributes=l;var e=i.parse?s.parse(t,i):t;if(o&&(e=n.extend({},r,e)),e&&!s.set(e,i))return!1;a&&a.call(i.context,s,t,i),s.trigger("sync",s,t,i)},U(this,i),r&&o&&(this.attributes=n.extend({},l,r));var u=this.isNew()?"create":i.patch?"patch":"update";"patch"!==u||i.attrs||(i.attrs=r);var c=this.sync(u,this,i);return this.attributes=l,c},destroy:function(t){t=t?n.clone(t):{};var e=this,i=t.success,r=t.wait,o=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(n){r&&o(),i&&i.call(t.context,e,n,t),e.isNew()||e.trigger("sync",e,n,t)};var s=!1;return this.isNew()?n.defer(t.success):(U(this,t),s=this.sync("delete",this,t)),r||o(),s},url:function(){var t=n.result(this,"urlRoot")||n.result(this.collection,"url")||L();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},n.extend({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=n.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;return!i||(this.trigger("invalid",this,i,n.extend(e,{validationError:i})),!1)}});var m=e.Collection=function(t,e){e||(e={}),this.preinitialize.apply(this,arguments),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,n.extend({silent:!0},e))},y={add:!0,remove:!0,merge:!0},$={add:!0,remove:!1},w=function(t,e,n){n=Math.min(Math.max(n,0),t.length);var i,r=Array(t.length-n),o=e.length;for(i=0;i<r.length;i++)r[i]=t[i+n];for(i=0;i<o;i++)t[i+n]=e[i];for(i=0;i<r.length;i++)t[i+o+n]=r[i]};n.extend(m.prototype,a,{model:b,preinitialize:function(){},initialize:function(){},toJSON:function(t){return this.map((function(e){return e.toJSON(t)}))},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,n.extend({merge:!1},e,$))},remove:function(t,e){e=n.extend({},e);var i=!n.isArray(t);t=i?[t]:t.slice();var r=this._removeModels(t,e);return!e.silent&&r.length&&(e.changes={added:[],merged:[],removed:r},this.trigger("update",this,e)),i?r[0]:r},set:function(t,e){if(null!=t){(e=n.extend({},y,e)).parse&&!this._isModel(t)&&(t=this.parse(t,e)||[]);var i=!n.isArray(t);t=i?[t]:t.slice();var r=e.at;null!=r&&(r=+r),r>this.length&&(r=this.length),r<0&&(r+=this.length+1);var o,s,a=[],l=[],u=[],c=[],h={},f=e.add,d=e.merge,p=e.remove,g=!1,v=this.comparator&&null==r&&!1!==e.sort,b=n.isString(this.comparator)?this.comparator:null;for(s=0;s<t.length;s++){o=t[s];var m=this.get(o);if(m){if(d&&o!==m){var $=this._isModel(o)?o.attributes:o;e.parse&&($=m.parse($,e)),m.set($,e),u.push(m),v&&!g&&(g=m.hasChanged(b))}h[m.cid]||(h[m.cid]=!0,a.push(m)),t[s]=m}else f&&(o=t[s]=this._prepareModel(o,e))&&(l.push(o),this._addReference(o,e),h[o.cid]=!0,a.push(o))}if(p){for(s=0;s<this.length;s++)h[(o=this.models[s]).cid]||c.push(o);c.length&&this._removeModels(c,e)}var x=!1,_=!v&&f&&p;if(a.length&&_?(x=this.length!==a.length||n.some(this.models,(function(t,e){return t!==a[e]})),this.models.length=0,w(this.models,a,0),this.length=this.models.length):l.length&&(v&&(g=!0),w(this.models,l,null==r?this.length:r),this.length=this.models.length),g&&this.sort({silent:!0}),!e.silent){for(s=0;s<l.length;s++)null!=r&&(e.index=r+s),(o=l[s]).trigger("add",o,this,e);(g||x)&&this.trigger("sort",this,e),(l.length||c.length||u.length)&&(e.changes={added:l,removed:c,merged:u},this.trigger("update",this,e))}return i?t[0]:t}},reset:function(t,e){e=e?n.clone(e):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],e);return e.previousModels=this.models,this._reset(),t=this.add(t,n.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,n.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,n.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return o.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.modelId(this._isModel(t)?t.attributes:t,t.idAttribute)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var i=e.length;return n.isFunction(e)&&(e=e.bind(this)),1===i||n.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(t){var e=(t=n.extend({parse:!0},t)).success,i=this;return t.success=function(n){var r=t.reset?"reset":"set";i[r](n,t),e&&e.call(t.context,i,n,t),i.trigger("sync",i,n,t)},U(this,t),this.sync("read",this,t)},create:function(t,e){var i=(e=e?n.clone(e):{}).wait;if(!(t=this._prepareModel(t,e)))return!1;i||this.add(t,e);var r=this,o=e.success;return e.success=function(t,e,n){i&&r.add(t,n),o&&o.call(n.context,t,e,n)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t,e){return t[e||this.model.prototype.idAttribute||"id"]},values:function(){return new _(this,j)},keys:function(){return new _(this,E)},entries:function(){return new _(this,A)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){return this._isModel(t)?(t.collection||(t.collection=this),t):((e=e?n.clone(e):{}).collection=this,(i=this.model.prototype?new this.model(t,e):this.model(t,e)).validationError?(this.trigger("invalid",this,i.validationError,e),!1):i);var i},_removeModels:function(t,e){for(var n=[],i=0;i<t.length;i++){var r=this.get(t[i]);if(r){var o=this.indexOf(r);this.models.splice(o,1),this.length--,delete this._byId[r.cid];var s=this.modelId(r.attributes,r.idAttribute);null!=s&&delete this._byId[s],e.silent||(e.index=o,r.trigger("remove",r,this,e)),n.push(r),this._removeReference(r,e)}}return n},_isModel:function(t){return t instanceof b},_addReference:function(t,e){this._byId[t.cid]=t;var n=this.modelId(t.attributes,t.idAttribute);null!=n&&(this._byId[n]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var n=this.modelId(t.attributes,t.idAttribute);null!=n&&delete this._byId[n],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){if(e){if(("add"===t||"remove"===t)&&n!==this)return;if("destroy"===t&&this.remove(e,i),"changeId"===t){var r=this.modelId(e.previousAttributes(),e.idAttribute),o=this.modelId(e.attributes,e.idAttribute);null!=r&&delete this._byId[r],null!=o&&(this._byId[o]=e)}}this.trigger.apply(this,arguments)}});var x="function"==typeof Symbol&&Symbol.iterator;x&&(m.prototype[x]=m.prototype.values);var _=function(t,e){this._collection=t,this._kind=e,this._index=0},j=1,E=2,A=3;x&&(_.prototype[x]=function(){return this}),_.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var t,e=this._collection.at(this._index);if(this._index++,this._kind===j)t=e;else{var n=this._collection.modelId(e.attributes,e.idAttribute);t=this._kind===E?n:[n,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var k=e.View=function(t){this.cid=n.uniqueId("view"),this.preinitialize.apply(this,arguments),n.extend(this,n.pick(t,I)),this._ensureElement(),this.initialize.apply(this,arguments)},S=/^(\S+)\s*(.*)$/,I=["model","collection","el","id","attributes","className","tagName","events"];n.extend(k.prototype,a,{tagName:"div",$:function(t){return this.$el.find(t)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=n.result(this,"events")),!t)return this;for(var e in this.undelegateEvents(),t){var i=t[e];if(n.isFunction(i)||(i=this[i]),i){var r=e.match(S);this.delegate(r[1],r[2],i.bind(this))}}return this},delegate:function(t,e,n){return this.$el.on(t+".delegateEvents"+this.cid,e,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,n){return this.$el.off(t+".delegateEvents"+this.cid,e,n),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"));else{var t=n.extend({},n.result(this,"attributes"));this.id&&(t.id=n.result(this,"id")),this.className&&(t.class=n.result(this,"className")),this.setElement(this._createElement(n.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}});var T=function(t,e,i,r){n.each(i,(function(n,i){e[i]&&(t.prototype[i]=function(t,e,n,i){switch(e){case 1:return function(){return t[n](this[i])};case 2:return function(e){return t[n](this[i],e)};case 3:return function(e,r){return t[n](this[i],O(e,this),r)};case 4:return function(e,r,o){return t[n](this[i],O(e,this),r,o)};default:return function(){var e=o.call(arguments);return e.unshift(this[i]),t[n].apply(t,e)}}}(e,n,i,r))}))},O=function(t,e){return n.isFunction(t)?t:n.isObject(t)&&!e._isModel(t)?V(t):n.isString(t)?function(e){return e.get(t)}:t},V=function(t){var e=n.matches(t);return function(t){return e(t.attributes)}};n.each([[m,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"],[b,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],(function(t){var e=t[0],i=t[1],r=t[2];e.mixin=function(t){var i=n.reduce(n.functions(t),(function(t,e){return t[e]=0,t}),{});T(e,t,i,r)},T(e,n,i,r)})),e.sync=function(t,i,r){var o=R[t];n.defaults(r||(r={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var s={type:o,dataType:"json"};if(r.url||(s.url=n.result(i,"url")||L()),null!=r.data||!i||"create"!==t&&"update"!==t&&"patch"!==t||(s.contentType="application/json",s.data=JSON.stringify(r.attrs||i.toJSON(r))),r.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),r.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){s.type="POST",r.emulateJSON&&(s.data._method=o);var a=r.beforeSend;r.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",o),a)return a.apply(this,arguments)}}"GET"===s.type||r.emulateJSON||(s.processData=!1);var l=r.error;r.error=function(t,e,n){r.textStatus=e,r.errorThrown=n,l&&l.call(r.context,t,e,n)};var u=r.xhr=e.ajax(n.extend(s,r));return i.trigger("request",i,u,r),u};var R={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var B=e.Router=function(t){t||(t={}),this.preinitialize.apply(this,arguments),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},M=/\((.*?)\)/g,N=/(\(\?)?:\w+/g,P=/\*\w+/g,z=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(B.prototype,a,{preinitialize:function(){},initialize:function(){},route:function(t,i,r){n.isRegExp(t)||(t=this._routeToRegExp(t)),n.isFunction(i)&&(r=i,i=""),r||(r=this[i]);var o=this;return e.history.route(t,(function(n){var s=o._extractParameters(t,n);!1!==o.execute(r,s,i)&&(o.trigger.apply(o,["route:"+i].concat(s)),o.trigger("route",i,s),e.history.trigger("route",o,i,s))})),this},execute:function(t,e,n){t&&t.apply(this,e)},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var t,e=n.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(z,"\\$&").replace(M,"(?:$1)?").replace(N,(function(t,e){return e?t:"([^/?]+)"})).replace(P,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return n.map(i,(function(t,e){return e===i.length-1?t||null:t?decodeURIComponent(t):null}))}});var C=e.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},H=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,W=/#.*$/;C.started=!1,n.extend(C.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(H,"")},start:function(t){if(C.started)throw new Error("Backbone.history has already been started");if(C.started=!0,this.options=n.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(D,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,r=i.insertBefore(this.iframe,i.firstChild).contentWindow;r.document.open(),r.document.close(),r.location.hash="#"+this.fragment}var o=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?o("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?o("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),C.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(t){return!!this.matchRoot()&&(t=this.fragment=this.getFragment(t),n.some(this.handlers,(function(e){if(e.route.test(t))return e.callback(t),!0})))},navigate:function(t,e){if(!C.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var n=this.root;""!==t&&"?"!==t.charAt(0)||(n=n.slice(0,-1)||"/");var i=n+t;t=t.replace(W,"");var r=this.decodeFragment(t);if(this.fragment!==r){if(this.fragment=r,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var o=this.iframe.contentWindow;e.replace||(o.document.open(),o.document.close()),this._updateHash(o.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),e.history=new C,b.extend=m.extend=B.extend=k.extend=C.extend=function(t,e){var i,r=this;return i=t&&n.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},n.extend(i,r,e),i.prototype=n.create(r.prototype,t),i.prototype.constructor=i,i.__super__=r.prototype,i};var L=function(){throw new Error('A "url" property or function must be specified')},U=function(t,e){var n=e.error;e.error=function(i){n&&n.call(e.context,t,i,e),t.trigger("error",t,i,e)}};return e}))}(),webix.ready((function(){webix.protoUI({name:"edittree"},webix.EditAbility,webix.ui.tree),webix.ui({view:"scrollview",type:"clean",id:"layout",scroll:"y",body:{cells:[{id:"userAuth",cols:[{},{rows:[{},S(),{}]},{}]},{id:"mainLayout",rows:[{id:"mainContent",css:"webix_mainContent",cols:[{rows:[{view:"toolbar",id:"header",padding:10,css:"webix_header-style",elements:[{cols:[{view:"button",type:"icon",id:"collapseBtn",icon:"wxi-angle-double-left",css:"webix_collapse",title:"текст",height:45,width:40,click:function(){$$("tree").isVisible()?($$("collapseBtn").config.icon="wxi-angle-double-right",$$("collapseBtn").refresh(),$$("tree").hide(),$$("sideMenuResizer")?(console.log("есть"),$$("sideMenuResizer").hide()):console.log("ytn")):($$("tree").show(),$$("collapseBtn").config.icon="wxi-angle-double-left",$$("collapseBtn").refresh(),window.innerWidth>=800&&$$("sideMenuResizer")&&$$("sideMenuResizer").show())},on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Видимость бокового меню")}}},{view:"label",label:"<img src='/init/static/images/expalogo.png' style='height:30px; margin: 10px;'>",height:30}]},{},{view:"button",id:"webix_log-btn",type:"icon",icon:"wxi-eye-slash",height:48,width:60,css:"webix_log-btn",on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Показать/скрыть системные сообщения")}},click:function(){$$("logLayout").isVisible()?($$("logLayout").hide(),$$("log-resizer").hide(),this.config.icon="wxi-eye",this.refresh(),I("LogVisible",JSON.stringify("hide"))):($$("logLayout").show(),$$("log-resizer").show(),this.config.icon="wxi-eye-slash",this.refresh(),I("LogVisible",JSON.stringify("show")))}},{view:"button",label:"Выйти",height:48,width:120,on:{onAfterRender:function(){this.getInputNode().setAttribute("title","Выйти из аккаунта")}},click:function(){webix.ajax().post("/init/default/logout/"),history.back()}}]},{id:"adaptive",rows:[]},{responsive:"adaptive",cols:[{view:"edittree",id:"tree",minWidth:100,width:250,editable:!1,select:!0,editor:"text",editValue:"value",activeTitle:!0,clipboard:!0,data:webix.ajax().get("/init/default/api/fields.json").then((function(t){let e,n=t.json().content,i=Object.keys(n),r={tables:[],forms:[],dashboards:[]};return i.forEach((function(t){n[t].actions&&(e=Object.keys(n[t].actions)[0]),"dbtable"==n[t].type?n[t].plural?(r.tables.push({id:t,value:n[t].plural,type:n[t].type}),w.push({name:n[t].plural,id:t})):n[t].singular&&(r.tables.push({id:t,value:n[t].singular,type:n[t].type}),w.push({name:n[t].singular,id:t})):"tform"==n[t].type?n[t].plural?(r.forms.push({id:t,value:n[t].plural,type:n[t].type}),w.push({name:n[t].plural,id:t})):n[t].singular&&(r.forms.push({id:t,value:n[t].singular,type:n[t].type}),w.push({name:n[t].singular,id:t})):"dashboard"==n[t].type&&(n[t].plural?(r.dashboards.push({id:t,value:n[t].plural,type:n[t].type}),w.push({name:n[t].plural,id:t})):n[t].singular&&(r.dashboards.push({id:t,value:n[t].singular,type:n[t].type}),w.push({name:n[t].singular,id:t})))})),webix.ajax().get("/init/default/api/mmenu.json").then((function(t){console.log(t.json().mmenu);let e=t.json().mmenu,n=[];return e.forEach((function(t,e){t.childs.length>0&&(r[t.name]=[],t.childs.forEach((function(e,n){r[t.name].push({id:e.name,value:e.title})}))),t.name.includes("delim")||(t.title?n.push({id:t.name,value:t.title,data:r[t.name]}):n.push({id:t.name,value:"Без названия",data:r[t.name]}))})),n}))})),on:{onSelectChange:function(n){$$("inputsTable")&&$$(l).removeView($$("inputsTable")),b=n[0];let o=$$("tree").getSelectedItem().id,u=$$("tree").getParentId(o);n[0]&&0!==u&&$$("webix__none-content").hide(),"tables"==u&&($$("dashboards").hide(),$$("forms").hide(),$$("tables").show()),"dashboards"==u&&($$("tables").hide(),$$("forms").hide(),$$("dashboards").show()),"forms"==u&&($$("propTableView")&&$$("propTableView").isVisible()&&$$("propTableView").hide(),$$("tables").hide(),$$("dashboards").hide(),$$("forms").show()),"tables"==u?(j(),0!==Object.keys($$(l).elements).length&&$$("inputsTable").hide(),$(t,i,n[0],r)):"dashboards"==u?function(){function t(t,e,n=!1){webix.ajax().get(t,{success:function(t,i,r){let o=[],s=i.json().charts,a={};s.forEach((function(t,e){a=t.title,delete t.title,t.borderless=!0,t.minWidth=300,o.push({rows:[{template:a,borderless:!0,css:{"margin-top":"20px!important","font-weight":"600!important","font-size":"18px!important"},height:30},t]})})),n?($$("dashboardBody").removeView($$("dashboard-charts")),$$("dashboardBody").addView({view:"scrollview",id:"dashboard-charts",height:300,borderless:!0,css:{margin:"10px!important"},body:{view:"flexlayout",cols:o}},2),$$("dashboard-charts")?A("success","Данные обновлены",!0):A("error","Ошибка при загрузке данных",!0)):($$("dashboardTool").addView({view:"scrollview",id:"dashboard-tool",borderless:!0,css:{margin:"20px!important",height:"50px!important"},body:{view:"flexlayout",rows:e}},0),$$("dashboardTool").addView({rows:[{template:"",css:"webix_style-template-count",borderless:!1,height:30}]},1),$$("dashboardBody").addView({view:"scrollview",height:300,id:"dashboard-charts",borderless:!0,body:{view:"flexlayout",cols:o}},2),$$("dashboardBody").removeView($$("dashEmpty")))},error:function(t,e,n){A("error","Ошибка при сохранении данных",!0)}})}$$("dashboard-charts")||webix.ajax().get("/init/default/api/fields").then((function(e){let n,i,r=e.json().content,o=[];Object.values(r).forEach((function(e,r){if("dashboard"==e.type){let r=e.inputs;o.push({width:20}),Object.values(r).forEach((function(r,s){"datetime"==r.type?o.push({view:"datepicker",format:webix.Date.strToDate("%d.%m.%Y"),id:"dashDatepicker"+s,timepicker:!0,placeholder:r.label,width:300,minWidth:100,height:48,on:{onAfterRender:function(){this.getInputNode().setAttribute("title",r.comment)}}}):"submit"==r.type&&(n=r.action,i=e.actions[n],console.log(i),o.push({view:"button",css:"webix_primary",id:"dashBtn"+s,inputHeight:48,height:48,minWidth:100,maxWidth:200,value:r.label,click:function(){t(i.url,o,!0)},on:{onAfterRender:function(){this.getInputNode().setAttribute("title",r.comment)}}})),o.push({width:20})}))}})),t(i.url,o)}))}():"forms"==u&&$(e,s,n[0],a)},onBeforeSelect:function(t){if("tables"==$$("tree").getParentId(t)&&$$(l).isDirty())return new webix.promise((function(t){webix.confirm({title:"Данные не сохранены",ok:"Да",width:300,cancel:"Отмена",text:"Вы уверены, что хотите продолжить?",callback:function(e){t(!!e)}})})).then((function(e){e&&(_(),$$("tree").select(t))})),!1},onBeforeRender:function(){window.innerWidth<=550?$$("sideMenuResizer").hide():$$("sideMenuResizer").show()}}},{id:"sideMenuResizer",view:"resizer",css:"webix_resizer-hide"},{id:"webix__none-content"},{id:"tables",hidden:!0,view:"scrollview",body:{view:"flexlayout",cols:[{id:"tableContainer",rows:[V(n,i,"tableexportBtn",r,t),{view:"resizer",class:"webix_resizers"},R(t,n,B)]},{view:"resizer",class:"webix_resizers"},k]}},{id:"dashboards",hidden:!0,scroll:"auto",rows:[{id:"dashboardContainer",cols:[{rows:[O,T]}]}]},{id:"forms",css:"webix_tableView",hidden:!0,rows:[V(o,s,"table-viewexportBtn",a,e,!0),{view:"resizer",class:"webix_resizers"},{view:"scrollview",body:{view:"flexlayout",cols:[R(e,o,M),{view:"resizer",class:"webix_resizers",id:"propResize",hidden:!0},("propTableView",{view:"property",id:"propTableView",tooltip:"Имя: #label#<br> Значение: #value#",width:350,nameWidth:150,editable:!0,scroll:!0,hidden:!0})]}}]}]}]}]},{view:"resizer",id:"log-resizer"},p]}]}}),function(){let t=webix.storage.local.get("LogVisible");t&&("hide"==t?($$("logLayout").hide(),$$("log-resizer").hide(),$$("webix_log-btn").config.icon="wxi-eye",$$("webix_log-btn").refresh()):"show"==t&&($$("logLayout").show(),$$("log-resizer").show(),$$("webix_log-btn").config.icon="wxi-eye-slash",$$("webix_log-btn").refresh()))}(),window.addEventListener("resize",(function(t){$$("tree").isVisible()||window.innerWidth<=600&&$$("sideMenuResizer")&&$$("sideMenuResizer").hide()}),!0),Backbone.history.start(),webix.extend($$(t),webix.ProgressBar),webix.extend($$(e),webix.ProgressBar),webix.i18n.setLocale("ru-RU"),webix.i18n.parseFormat="%d.%m.%Y %H:%i:%s",webix.i18n.setLocale()}))})();